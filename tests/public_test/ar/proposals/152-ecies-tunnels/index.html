<!DOCTYPE html>
<html lang="ar" data-theme="light">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <title>أنفاق ECIES | I2P - مشروع الإنترنت غير المرئي</title>

    <meta name="description" content="The Invisible Internet Project - A privacy-focused, anonymous network layer">
    <meta name="keywords" content="i2p, privacy, anonymity, dark net, encryption, security">

    
    <meta property="og:title" content="أنفاق ECIES | I2P - مشروع الإنترنت غير المرئي">
    <meta property="og:description" content="The Invisible Internet Project - A privacy-focused, anonymous network layer">
    <meta property="og:type" content="website">
    <meta property="og:url" content="/ar/proposals/152-ecies-tunnels/">

    
    <link rel="icon" type="image/svg+xml" href="../../../images/favicon.svg">
    <link rel="icon" type="image/png" href="../../../images/i2plogo.png" sizes="32x32">

    
    
    
    
    <link rel="stylesheet" href="../../../css/main.min.be6880f32f5ff44e57579da7b11513b973319944ebe38748e3ac7f3268662d18.css" integrity="sha256-vmiA8y9f9E5XV52nsRUTuXMxmUTr44dI46x/MmhmLRg=">
    


    
</head>

<body>
    
    <input type="checkbox" id="theme-toggle-checkbox" class="theme-checkbox" aria-hidden="true">

    
<div class="site-banner" id="site-banner" data-banner-id="banner-3" role="alert" aria-live="polite">
    <div class="container">
        <div class="banner-content">
            <span class="banner-message">موقع I2P التجريبي متاح الآن - أرسل المشاكل إلى stormycloud@mail.i2p</span>
            
        </div>
        
        <form method="GET" action="../../../api/banner/dismiss" style="display: inline;">
            <input type="hidden" name="id" value="banner-3">
            <button type="submit" class="banner-close" aria-label="إغلاق الشريط" title="إغلاق الشريط">
                <span aria-hidden="true">&times;</span>
            </button>
        </form>
        
    </div>
</div>


    <header class="site-header">
    <div class="container">
        <nav class="main-nav">
            <div class="nav-brand">
                <a href="../../../ar/" class="logo-link">
                    <img src="../../../images/i2plogo_lightmode.svg" alt="I2P Logo" class="logo logo-light">
                    <img src="../../../images/i2plogo_darkmode.svg" alt="I2P Logo" class="logo logo-dark">
                </a>
            </div>

            
            <input type="checkbox" id="mobile-menu-checkbox" class="mobile-menu-checkbox"
                aria-label="Toggle navigation menu">
            <label for="mobile-menu-checkbox" class="mobile-menu-toggle" aria-label="Toggle navigation menu">
                <span class="hamburger"></span>
            </label>

            <div class="nav-menu">
                <ul class="nav-links">
                    <li class="nav-dropdown">
                        <a href="../../../ar/about/" class="">حول</a>
                        <ul class="dropdown-menu">
                            <li><a href="../../../ar/about/">نظرة عامة</a></li>
                            <li><a href="../../../ar/papers/">أبحاث</a></li>
                            <li><a href="../../../ar/about/media/">الصحافة</a></li>
                            <li><a href="../../../ar/contact/">اتصل بنا</a></li>
                        </ul>
                    </li>
                    <li><a href="../../../ar/docs/" class="">المستندات</a></li>
                    <li><a href="../../../ar/downloads/" class="">التنزيلات</a></li>
                    <li><a href="../../../ar/blog/" class="">مدونة</a></li>
                    <li class="nav-dropdown">
                        <a href="../../../ar/get-involved/" class="">شارك معنا</a>
                        <ul class="dropdown-menu">
                            <li><a href="../../../ar/get-involved/">نظرة عامة</a></li>
                            <li><a href="../../../ar/feedback/">اقتراحات الميزات</a></li>
                        </ul>
                    </li>
                </ul>

                <div class="nav-actions">
                    
                    <div class="language-selector">
                        <button class="language-toggle" aria-label="Select language" title="Language">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none"
                                xmlns="http://www.w3.org/2000/svg">
                                <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2" />
                                <path
                                    d="M2 12h20M12 2a15.3 15.3 0 014 10 15.3 15.3 0 01-4 10 15.3 15.3 0 01-4-10 15.3 15.3 0 014-10z"
                                    stroke="currentColor" stroke-width="2" />
                            </svg>
                            <span class="current-lang">ar</span>
                        </button>
                        <div class="language-dropdown">
                            
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../en/proposals/152-ecies-tunnels/"
                                class="lang-option">الإنجليزية</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../es/proposals/152-ecies-tunnels/"
                                class="lang-option">الإسبانية</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../ko/proposals/152-ecies-tunnels/"
                                class="lang-option">الكورية</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../zh/proposals/152-ecies-tunnels/"
                                class="lang-option">الصينية</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../ru/proposals/152-ecies-tunnels/"
                                class="lang-option">الروسية</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../cs/proposals/152-ecies-tunnels/"
                                class="lang-option">التشيكية</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../de/proposals/152-ecies-tunnels/"
                                class="lang-option">الألمانية</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../fr/proposals/152-ecies-tunnels/"
                                class="lang-option">الفرنسية</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../tr/proposals/152-ecies-tunnels/"
                                class="lang-option">التركية</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../vi/proposals/152-ecies-tunnels/"
                                class="lang-option">الفيتنامية</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../hi/proposals/152-ecies-tunnels/"
                                class="lang-option">الهندية</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../ar/proposals/152-ecies-tunnels/"
                                class="lang-option active">العربية</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../pt/proposals/152-ecies-tunnels/"
                                class="lang-option">البرتغالية</a>
                            
                            
                        </div>
                    </div>

                    
                    <label for="theme-toggle-checkbox" class="theme-toggle" aria-label="Toggle dark mode"
                        title="Toggle theme">
                        <svg class="sun-icon" width="20" height="20" viewBox="0 0 20 20" fill="none"
                            xmlns="http://www.w3.org/2000/svg">
                            <circle cx="10" cy="10" r="4" stroke="currentColor" stroke-width="2" />
                            <path
                                d="M10 2V4M10 16V18M18 10H16M4 10H2M15.657 4.343L14.243 5.757M5.757 14.243L4.343 15.657M15.657 15.657L14.243 14.243M5.757 5.757L4.343 4.343"
                                stroke="currentColor" stroke-width="2" stroke-linecap="round" />
                        </svg>
                        <svg class="moon-icon" width="20" height="20" viewBox="0 0 20 20" fill="none"
                            xmlns="http://www.w3.org/2000/svg">
                            <path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"
                                stroke="currentColor" stroke-width="2" stroke-linejoin="round" />
                        </svg>
                    </label>

                    
                    <a href="../../../ar/financial-support/" class="btn btn-primary" id="donate-btn">Donate</a>

                    
                    <a href="../../../ar/downloads/" class="btn btn-primary">احصل على I2P</a>
                </div>
            </div>
        </nav>
    </div>
</header>

    <main id="main-content">
        



<div class="proposals-page">
    <div class="container">
        
        <nav class="breadcrumbs">
            <a href="../../../ar/">Home</a>
            <span class="separator">/</span>
            <a href="../../../ar/proposals/">Proposals</a>
            <span class="separator">/</span>
            <span class="current">أنفاق ECIES</span>
        </nav>

        
<div class="translation-disclaimer" role="note">
    <span class="disclaimer-message">تم إنشاء هذه الترجمة باستخدام التعلم الآلي وقد لا تكون دقيقة بنسبة 100%.</span>
    
    
    <a href="../../../en/proposals/152-ecies-tunnels/" class="disclaimer-link">عرض النسخة الإنجليزية</a>
    
</div>



        
        <header class="proposal-header">
            <div class="proposal-title-section">
                <h1 class="proposal-title">أنفاق ECIES</h1>
                <div class="proposal-number">Proposal 152</div>
            </div>

            
            <div class="proposal-meta-box">
                <div class="proposal-status status-مغلق">
                    مغلق
                </div>

                
                <div class="proposal-info-grid">
                    
                    <div class="info-item">
                        <span class="info-label">Author</span>
                        <span class="info-value">chisana, zzz, orignal</span>
                    </div>
                    

                    
                    <div class="info-item">
                        <span class="info-label">Created</span>
                        <span class="info-value">2019-07-04</span>
                    </div>
                    

                    
                    <div class="info-item">
                        <span class="info-label">Last Updated</span>
                        <span class="info-value">2025-03-05</span>
                    </div>
                    

                    
                    <div class="info-item">
                        <span class="info-label">Target Version</span>
                        <span class="info-value">0.9.48</span>
                    </div>
                    

                    
                    <div class="info-item">
                        <span class="info-label">Implemented In</span>
                        <span class="info-value">0.9.48</span>
                    </div>
                    
                </div>

                
                
            </div>
        </header>

        
        <div class="proposal-layout proposal-layout--with-toc">
            
            
            <aside class="proposal-toc-sidebar">
                <nav class="toc-nav">
                    <div class="toc-header">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                            <path d="M4 6h16M4 12h16M4 18h16" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                        </svg>
                        On This Page
                    </div>
                    <div class="toc-content">
                        <nav id="TableOfContents">
  <ul>
    <li><a href="#ملاحظة">ملاحظة</a></li>
    <li><a href="#نظرة-عامة">نظرة عامة</a>
      <ul>
        <li><a href="#cryptographic-primitives">Cryptographic Primitives</a></li>
        <li><a href="#goals">Goals</a></li>
        <li><a href="#البدائيات-التشفيرية">البدائيات التشفيرية</a></li>
      </ul>
    </li>
    <li><a href="#threat-model">Threat Model</a>
      <ul>
        <li><a href="#الأهداف">الأهداف</a></li>
        <li><a href="#الأهداف-غير-المطلوبة">الأهداف غير المطلوبة</a></li>
      </ul>
    </li>
    <li><a href="#design">Design</a>
      <ul>
        <li><a href="#noise-protocol-framework">Noise Protocol Framework</a></li>
        <li><a href="#أهداف-التصميم">أهداف التصميم</a></li>
        <li><a href="#هجمات-وضع-العلامات">هجمات وضع العلامات</a></li>
        <li><a href="#reply-encryption">Reply encryption</a></li>
        <li><a href="#إطار-عمل-بروتوكول-noise">إطار عمل بروتوكول Noise</a></li>
      </ul>
    </li>
    <li><a href="#specification">Specification</a>
      <ul>
        <li><a href="#build-request-records">Build Request Records</a></li>
        <li><a href="#أنماط-المصافحة">أنماط المصافحة</a></li>
        <li><a href="#تشفير-الطلبات">تشفير الطلبات</a></li>
        <li><a href="#تشفير-الرد">تشفير الرد</a></li>
        <li><a href="#المبرر">المبرر</a></li>
        <li><a href="#reply-record-encryption-ecies">Reply Record Encryption (ECIES)</a></li>
        <li><a href="#سجلات-طلب-البناء">سجلات طلب البناء</a></li>
        <li><a href="#security-analysis">Security Analysis</a></li>
      </ul>
    </li>
    <li><a href="#نموذج-التهديد">نموذج التهديد</a></li>
    <li><a href="#implementation-notes">Implementation Notes</a></li>
    <li><a href="#issues">Issues</a></li>
    <li><a href="#التصميم">التصميم</a></li>
  </ul>
</nav>
                    </div>
                </nav>
            </aside>
            

            
            <div class="proposal-main">
                <article class="proposal-content">
                    <h2 id="ملاحظة">ملاحظة</h2>
<p>نشر الشبكة والاختبار قيد التقدم. قابل للمراجعات الطفيفة. راجع <a href="../../../ar/docs/specs/implementation/">SPEC</a>
 للمواصفات الرسمية.</p>
<h2 id="نظرة-عامة">نظرة عامة</h2>
<p>تقترح هذه الوثيقة تغييرات على تشفير رسائل Tunnel Build باستخدام العناصر التشفيرية الأساسية المقدمة بواسطة <a href="../../../ar/docs/specs/ecies/">ECIES-X25519</a>
. إنها جزء من الاقتراح الشامل <a href="../../../ar/proposals/156-ecies-routers">Proposal 156</a>
 لتحويل أجهزة router من مفاتيح ElGamal إلى مفاتيح ECIES-X25519.</p>
<p>لأغراض نقل الشبكة من ElGamal + AES256 إلى ECIES + ChaCha20، تُعتبر الأنفاق التي تحتوي على مزيج من موجهات ElGamal و ECIES ضرورية. يتم توفير مواصفات للتعامل مع القفزات المختلطة للأنفاق. لن يتم إجراء أي تغييرات على تنسيق أو معالجة أو تشفير قفزات ElGamal.</p>
<p>منشئو أنفاق ElGamal سيحتاجون إلى إنشاء أزواج مفاتيح X25519 مؤقتة لكل قفزة، واتباع هذه المواصفات لإنشاء الأنفاق التي تحتوي على قفزات ECIES.</p>
<p>يحدد هذا الاقتراح التغييرات المطلوبة لبناء الأنفاق ECIES-X25519. للاطلاع على نظرة عامة على جميع التغييرات المطلوبة لأجهزة router الخاصة بـ ECIES، راجع الاقتراح 156 <a href="../../../ar/proposals/156-ecies-routers">Proposal 156</a>
.</p>
<p>يحافظ هذا الاقتراح على نفس الحجم لسجلات بناء الأنفاق، كما هو مطلوب للتوافق. ستتم تنفيذ سجلات البناء والرسائل الأصغر لاحقاً - انظر <a href="../../../ar/proposals/157-new-tbm">الاقتراح 157</a>
.</p>
<h3 id="cryptographic-primitives">Cryptographic Primitives</h3>
<p>لا يتم تقديم أي عناصر تشفيرية جديدة. العناصر التشفيرية المطلوبة لتنفيذ هذا الاقتراح هي:</p>
<ul>
<li>AES-256-CBC كما هو موضح في <a href="../../../ar/docs/specs/cryptography/">التشفير</a>
</li>
<li>دوال STREAM ChaCha20/Poly1305:
ENCRYPT(k, n, plaintext, ad) و DECRYPT(k, n, ciphertext, ad) - كما هو موضح في <a href="../../../ar/docs/specs/ntcp2/">NTCP2</a>
 <a href="../../../ar/docs/specs/ecies/">ECIES-X25519</a>
 و <a href="https://tools.ietf.org/html/rfc7539">RFC-7539</a>
</li>
<li>دوال X25519 DH - كما هو موضح في <a href="../../../ar/docs/specs/ntcp2/">NTCP2</a>
 و <a href="../../../ar/docs/specs/ecies/">ECIES-X25519</a>
</li>
<li>HKDF(salt, ikm, info, n) - كما هو موضح في <a href="../../../ar/docs/specs/ntcp2/">NTCP2</a>
 و <a href="../../../ar/docs/specs/ecies/">ECIES-X25519</a>
</li>
</ul>
<p>وظائف Noise الأخرى المُعرَّفة في مكان آخر:</p>
<ul>
<li>MixHash(d) - كما في <a href="../../../ar/docs/specs/ntcp2/">NTCP2</a>
 و <a href="../../../ar/docs/specs/ecies/">ECIES-X25519</a>
</li>
<li>MixKey(d) - كما في <a href="../../../ar/docs/specs/ntcp2/">NTCP2</a>
 و <a href="../../../ar/docs/specs/ecies/">ECIES-X25519</a>
</li>
</ul>
<h3 id="goals">Goals</h3>
<ul>
<li>زيادة سرعة العمليات التشفيرية</li>
<li>استبدال ElGamal + AES256/CBC بـ ECIES primitives لـ tunnel BuildRequestRecords و BuildReplyRecords</li>
<li>عدم تغيير حجم BuildRequestRecords و BuildReplyRecords المشفرة (528 بايت) للتوافق</li>
<li>لا توجد رسائل I2NP جديدة</li>
<li>الحفاظ على حجم سجل البناء المشفر للتوافق</li>
<li>إضافة السرية الأمامية لـ Tunnel Build Messages</li>
<li>إضافة التشفير المصادق عليه</li>
<li>كشف إعادة ترتيب hops لـ BuildRequestRecords</li>
<li>زيادة دقة الطوابع الزمنية بحيث يمكن تقليل حجم مرشح Bloom</li>
<li>إضافة حقل لانتهاء صلاحية النفق بحيث تصبح أعمار الأنفاق المتغيرة ممكنة (أنفاق ECIES الكاملة فقط)</li>
<li>إضافة حقل خيارات قابل للتوسع للميزات المستقبلية</li>
<li>إعادة استخدام العناصر التشفيرية الموجودة</li>
<li>تحسين أمان رسائل بناء النفق حيثما أمكن مع الحفاظ على التوافق</li>
<li>دعم الأنفاق مع peers مختلطة ElGamal/ECIES</li>
<li>تحسين الدفاعات ضد هجمات &ldquo;التوسيم&rdquo; على رسائل البناء</li>
<li>لا تحتاج hops لمعرفة نوع التشفير للـ hop التالي قبل معالجة رسالة البناء،
حيث قد لا تملك RI الخاص بالـ hop التالي في ذلك الوقت</li>
<li>زيادة التوافق مع الشبكة الحالية إلى أقصى حد</li>
<li>عدم تغيير تشفير AES للطلب/الرد لبناء النفق لـ routers ElGamal</li>
<li>عدم تغيير تشفير &ldquo;الطبقة&rdquo; AES للنفق، لذلك راجع <a href="../../../ar/proposals/153-chacha20-layer-encryption">الاقتراح 153</a>
</li>
<li>الاستمرار في دعم كل من TBM/TBRM بـ 8 سجلات و VTBM/VTBRM متغيرة الحجم</li>
<li>عدم طلب ترقية &ldquo;يوم العلم&rdquo; للشبكة بالكامل</li>
</ul>
<h3 id="البدائيات-التشفيرية">البدائيات التشفيرية</h3>
<ul>
<li>إعادة تصميم كاملة لرسائل بناء tunnel تتطلب &ldquo;يوم علم&rdquo;.</li>
<li>تقليص رسائل بناء tunnel (يتطلب جميع القفزات ECIES واقتراح جديد)</li>
<li>استخدام خيارات بناء tunnel كما هو محدد في <a href="../../../ar/proposals/143-build-message-options">الاقتراح 143</a>
، مطلوب فقط للرسائل الصغيرة</li>
<li>Tunnels ثنائية الاتجاه - لذلك انظر <a href="../../../ar/proposals/119-bidirectional-tunnels">الاقتراح 119</a>
</li>
<li>رسائل بناء tunnel أصغر - لذلك انظر <a href="../../../ar/proposals/157-new-tbm">الاقتراح 157</a>
</li>
</ul>
<h2 id="threat-model">Threat Model</h2>
<h3 id="الأهداف">الأهداف</h3>
<ul>
<li>
<p>لا يمكن لأي من القفزات تحديد منشئ النفق.</p>
</li>
<li>
<p>العقد الوسطى يجب ألا تكون قادرة على تحديد اتجاه النفق أو موقعها في النفق.</p>
</li>
<li>
<p>لا يمكن لأي من النقاط الوسطية قراءة محتويات سجلات الطلبات أو الردود الأخرى، باستثناء router hash المقطوع والمفتاح المؤقت للنقطة التالية</p>
</li>
<li>
<p>لا يمكن لأي عضو في tunnel الرد للبناء الصادر قراءة أي سجلات رد.</p>
</li>
<li>
<p>لا يمكن لأي عضو في النفق الصادر للبناء الداخل قراءة أي سجلات طلب،
باستثناء أن OBEP يمكنه رؤية router hash المقطوع والمفتاح المؤقت لـ IBGW</p>
</li>
</ul>
<h3 id="الأهداف-غير-المطلوبة">الأهداف غير المطلوبة</h3>
<p>هدف رئيسي من تصميم بناء الأنفاق هو جعل الأمر أكثر صعوبة على الـ routers المتواطئة X و Y لمعرفة أنها في نفق واحد. إذا كان الـ router X في القفزة m والـ router Y في القفزة m+1، فسيعرفان ذلك بوضوح. لكن إذا كان الـ router X في القفزة m والـ router Y في القفزة m+n حيث n&gt;1، فيجب أن يكون هذا أصعب بكثير.</p>
<p>هجمات الوسم هي حيث يقوم router الوسيط X بتعديل رسالة بناء tunnel بطريقة تجعل router Y قادراً على اكتشاف التعديل عندما تصل إليه رسالة البناء. الهدف هو أن أي رسالة معدلة يتم إسقاطها بواسطة router بين X و Y قبل أن تصل إلى router Y. بالنسبة للتعديلات التي لا يتم إسقاطها قبل router Y، يجب على منشئ tunnel اكتشاف التلف في الرد وتجاهل tunnel.</p>
<p>الهجمات المحتملة:</p>
<ul>
<li>تعديل سجل البناء</li>
<li>استبدال سجل البناء</li>
<li>إضافة أو إزالة سجل البناء</li>
<li>إعادة ترتيب سجلات البناء</li>
</ul>
<p>TODO: هل يمنع التصميم الحالي جميع هذه الهجمات؟</p>
<h2 id="design">Design</h2>
<h3 id="noise-protocol-framework">Noise Protocol Framework</h3>
<p>هذا الاقتراح يوفر المتطلبات المبنية على إطار عمل بروتوكول Noise Protocol Framework <a href="https://noiseprotocol.org/noise.html">NOISE</a>
 (المراجعة 34، 2018-07-11). في مصطلحات Noise، Alice هي المُبادِرة، وBob هو المُستجيب.</p>
<p>يعتمد هذا الاقتراح على بروتوكول Noise وهو Noise_N_25519_ChaChaPoly_SHA256. يستخدم بروتوكول Noise هذا العناصر الأولية التالية:</p>
<ul>
<li>
<p>One-Way Handshake Pattern: N
أليس لا ترسل مفتاحها الثابت إلى بوب (N)</p>
</li>
<li>
<p>DH Function: X25519
X25519 DH بطول مفتاح 32 بايت كما هو محدد في <a href="https://tools.ietf.org/html/rfc7748">RFC-7748</a>
.</p>
</li>
<li>
<p>دالة التشفير: ChaChaPoly
AEAD_CHACHA20_POLY1305 كما هو محدد في <a href="https://tools.ietf.org/html/rfc7539">RFC-7539</a>
 القسم 2.8.
nonce بحجم 12 بايت، مع تعيين أول 4 بايتات إلى الصفر.
مطابق لذلك الموجود في <a href="../../../ar/docs/specs/ntcp2/">NTCP2</a>
.</p>
</li>
<li>
<p>Hash Function: SHA256
دالة تجزئة قياسية بحجم 32 بايت، مستخدمة بالفعل على نطاق واسع في I2P.</p>
</li>
</ul>
<h4 id="additions-to-the-framework">Additions to the Framework</h4>
<p>لا شيء.</p>
<h3 id="أهداف-التصميم">أهداف التصميم</h3>
<p>تستخدم عمليات المصافحة أنماط مصافحة <a href="https://noiseprotocol.org/noise.html">Noise</a>
.</p>
<p>يتم استخدام تطابق الأحرف التالي:</p>
<ul>
<li>e = مفتاح مؤقت لاستخدام واحد</li>
<li>s = مفتاح ثابت</li>
<li>p = حمولة الرسالة</li>
</ul>
<p>طلب البناء مطابق لنمط Noise N. وهذا مطابق أيضاً لأول رسالة (طلب الجلسة) في نمط XK المستخدم في <a href="../../../ar/docs/specs/ntcp2/">NTCP2</a>
.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>&lt;- s
</span></span><span style="display:flex;"><span>  ...
</span></span><span style="display:flex;"><span>  e es p -&gt;
</span></span></code></pre></div><h3 id="هجمات-وضع-العلامات">هجمات وضع العلامات</h3>
<p>سجلات طلبات البناء يتم إنشاؤها بواسطة منشئ النفق ويتم تشفيرها بشكل غير متماثل للقفزة الفردية. هذا التشفير غير المتماثل لسجلات الطلبات هو حاليًا ElGamal كما هو محدد في <a href="../../../ar/docs/specs/cryptography/">التشفير</a>
 ويحتوي على مجموع اختبار SHA-256. هذا التصميم ليس سريًا للأمام.</p>
<p>التصميم الجديد سيستخدم نمط Noise أحادي الاتجاه &ldquo;N&rdquo; مع ECIES-X25519 ephemeral-static DH، مع HKDF، و ChaCha20/Poly1305 AEAD للسرية المستقبلية والتكامل والمصادقة. Alice هي طالبة بناء النفق. كل hop في النفق هو Bob.</p>
<p>(خصائص أمان الحمولة)</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>N:                      Authentication   Confidentiality
</span></span><span style="display:flex;"><span>    -&gt; e, es                  0                2
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    Authentication: None (0).
</span></span><span style="display:flex;"><span>    This payload may have been sent by any party, including an active attacker.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    Confidentiality: 2.
</span></span><span style="display:flex;"><span>    Encryption to a known recipient, forward secrecy for sender compromise
</span></span><span style="display:flex;"><span>    only, vulnerable to replay.  This payload is encrypted based only on DHs
</span></span><span style="display:flex;"><span>    involving the recipient&#39;s static key pair.  If the recipient&#39;s static
</span></span><span style="display:flex;"><span>    private key is compromised, even at a later date, this payload can be
</span></span><span style="display:flex;"><span>    decrypted.  This message can also be replayed, since there&#39;s no ephemeral
</span></span><span style="display:flex;"><span>    contribution from the recipient.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    &#34;e&#34;: Alice generates a new ephemeral key pair and stores it in the e
</span></span><span style="display:flex;"><span>         variable, writes the ephemeral public key as cleartext into the
</span></span><span style="display:flex;"><span>         message buffer, and hashes the public key along with the old h to
</span></span><span style="display:flex;"><span>         derive a new h.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    &#34;es&#34;: A DH is performed between the Alice&#39;s ephemeral key pair and the
</span></span><span style="display:flex;"><span>          Bob&#39;s static key pair.  The result is hashed along with the old ck to
</span></span><span style="display:flex;"><span>          derive a new ck and k, and n is set to zero.
</span></span></code></pre></div><h3 id="reply-encryption">Reply encryption</h3>
<p>سجلات الرد يتم إنشاؤها بواسطة منشئ hops ويتم تشفيرها بشكل متماثل للمنشئ. هذا التشفير المتماثل لسجلات الرد يستخدم حالياً AES مع checksum SHA-256 مُقدم مسبقاً. ويحتوي على checksum SHA-256. هذا التصميم لا يوفر السرية المستقبلية (forward-secret).</p>
<p>سيستخدم التصميم الجديد ChaCha20/Poly1305 AEAD للحفاظ على التكامل والمصادقة.</p>
<h3 id="إطار-عمل-بروتوكول-noise">إطار عمل بروتوكول Noise</h3>
<p>المفتاح العام المؤقت في الطلب لا يحتاج إلى إخفاء بـ AES أو Elligator2. القفزة السابقة هي الوحيدة التي يمكنها رؤيته، وتلك القفزة تعلم أن القفزة التالية هي ECIES.</p>
<p>سجلات الرد لا تحتاج إلى تشفير غير متماثل كامل مع DH آخر.</p>
<h2 id="specification">Specification</h2>
<h3 id="build-request-records">Build Request Records</h3>
<p>سجلات BuildRequestRecords المشفرة هي 528 بايت لكل من ElGamal و ECIES، من أجل التوافق.</p>
<h4 id="request-record-unencrypted-elgamal">Request Record Unencrypted (ElGamal)</h4>
<p>للمرجعية، هذه هي المواصفة الحالية لـ tunnel BuildRequestRecord لـ routers ElGamal، مأخوذة من <a href="../../../ar/docs/specs/i2np/">I2NP</a>
. البيانات غير المشفرة مُقدمة ببايت غير صفري و SHA-256 hash للبيانات قبل التشفير، كما هو محدد في <a href="../../../ar/docs/specs/cryptography/">Cryptography</a>
.</p>
<p>جميع الحقول تستخدم الترتيب big-endian.</p>
<p>الحجم غير المشفر: 222 بايت</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>bytes     0-3: tunnel ID to receive messages as, nonzero
</span></span><span style="display:flex;"><span>  bytes    4-35: local router identity hash
</span></span><span style="display:flex;"><span>  bytes   36-39: next tunnel ID, nonzero
</span></span><span style="display:flex;"><span>  bytes   40-71: next router identity hash
</span></span><span style="display:flex;"><span>  bytes  72-103: AES-256 tunnel layer key
</span></span><span style="display:flex;"><span>  bytes 104-135: AES-256 tunnel IV key
</span></span><span style="display:flex;"><span>  bytes 136-167: AES-256 reply key
</span></span><span style="display:flex;"><span>  bytes 168-183: AES-256 reply IV
</span></span><span style="display:flex;"><span>  byte      184: flags
</span></span><span style="display:flex;"><span>  bytes 185-188: request time (in hours since the epoch, rounded down)
</span></span><span style="display:flex;"><span>  bytes 189-192: next message ID
</span></span><span style="display:flex;"><span>  bytes 193-221: uninterpreted / random padding
</span></span></code></pre></div><h4 id="request-record-encrypted-elgamal">Request Record Encrypted (ElGamal)</h4>
<p>للمرجع، هذه هي المواصفة الحالية لـ tunnel BuildRequestRecord لأجهزة التوجيه ElGamal، مأخوذة من <a href="../../../ar/docs/specs/i2np/">I2NP</a>
.</p>
<p>الحجم المشفر: 528 بايت</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>bytes    0-15: Hop&#39;s truncated identity hash
</span></span><span style="display:flex;"><span>  bytes  16-528: ElGamal encrypted BuildRequestRecord
</span></span></code></pre></div><h4 id="request-record-unencrypted-ecies">Request Record Unencrypted (ECIES)</h4>
<p>هذه هي المواصفات المقترحة لـ tunnel BuildRequestRecord لأجهزة router من نوع ECIES-X25519. ملخص التغييرات:</p>
<ul>
<li>إزالة hash الموجه غير المستخدم بحجم 32 بايت</li>
<li>تغيير وقت الطلب من ساعات إلى دقائق</li>
<li>إضافة حقل انتهاء الصلاحية لوقت tunnel متغير مستقبلي</li>
<li>إضافة مساحة أكبر للـ flags</li>
<li>إضافة Mapping لخيارات بناء إضافية</li>
<li>مفتاح الرد AES-256 والـ IV غير مستخدمين لسجل الرد الخاص بالـ hop نفسه</li>
<li>السجل غير المشفر أطول لأن هناك عبء تشفير أقل</li>
</ul>
<p>سجل الطلب لا يحتوي على أي مفاتيح رد ChaCha. هذه المفاتيح مشتقة من KDF. انظر أدناه.</p>
<p>جميع الحقول بترتيب البايت الكبير (big-endian).</p>
<p>الحجم غير المشفر: 464 بايت</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>bytes     0-3: tunnel ID to receive messages as, nonzero
</span></span><span style="display:flex;"><span>  bytes     4-7: next tunnel ID, nonzero
</span></span><span style="display:flex;"><span>  bytes    8-39: next router identity hash
</span></span><span style="display:flex;"><span>  bytes   40-71: AES-256 tunnel layer key
</span></span><span style="display:flex;"><span>  bytes  72-103: AES-256 tunnel IV key
</span></span><span style="display:flex;"><span>  bytes 104-135: AES-256 reply key
</span></span><span style="display:flex;"><span>  bytes 136-151: AES-256 reply IV
</span></span><span style="display:flex;"><span>  byte      152: flags
</span></span><span style="display:flex;"><span>  bytes 153-155: more flags, unused, set to 0 for compatibility
</span></span><span style="display:flex;"><span>  bytes 156-159: request time (in minutes since the epoch, rounded down)
</span></span><span style="display:flex;"><span>  bytes 160-163: request expiration (in seconds since creation)
</span></span><span style="display:flex;"><span>  bytes 164-167: next message ID
</span></span><span style="display:flex;"><span>  bytes   168-x: tunnel build options (Mapping)
</span></span><span style="display:flex;"><span>  bytes     x-x: other data as implied by flags or options
</span></span><span style="display:flex;"><span>  bytes   x-463: random padding
</span></span></code></pre></div><p>حقل الأعلام هو نفسه كما هو معرّف في <a href="../../../ar/docs/specs/implementation/">إنشاء الأنفاق</a>
 ويحتوي على ما يلي::</p>
<p>ترتيب البت: 76543210 (البت 7 هو MSB)  البت 7: إذا تم تعيينه، السماح بالرسائل من أي شخص  البت 6: إذا تم تعيينه، السماح بالرسائل إلى أي شخص، وإرسال الرد إلى</p>
<pre><code>    specified next hop in a Tunnel Build Reply Message
</code></pre>
<p>البتات 5-0: غير محددة، يجب تعيينها إلى 0 للتوافق مع الخيارات المستقبلية</p>
<p>البت 7 يشير إلى أن القفزة ستكون بوابة دخول (IBGW). البت 6 يشير إلى أن القفزة ستكون نقطة نهاية خروج (OBEP). إذا لم يتم تعيين أي من البتين، فإن القفزة ستكون مشاركًا وسيطًا. لا يمكن تعيين كليهما في نفس الوقت.</p>
<p>انتهاء صلاحية الطلب مخصص لمدة tunnel متغيرة مستقبلية. في الوقت الحالي، القيمة الوحيدة المدعومة هي 600 (10 دقائق).</p>
<p>خيارات بناء tunnel هي هيكل Mapping كما هو محدد في <a href="../../../ar/docs/specs/common-structures/">الهياكل المشتركة</a>
. هذا للاستخدام المستقبلي. لا توجد خيارات محددة حاليًا. إذا كان هيكل Mapping فارغًا، فهذا يعني بايتين 0x00 0x00. الحد الأقصى لحجم Mapping (بما في ذلك حقل الطول) هو 296 بايت، والقيمة القصوى لحقل طول Mapping هي 294.</p>
<h4 id="request-record-encrypted-ecies">Request Record Encrypted (ECIES)</h4>
<p>جميع الحقول بترتيب البايت الكبير (big-endian) باستثناء المفتاح العام المؤقت (ephemeral public key) الذي يكون بترتيب البايت الصغير (little-endian).</p>
<p>الحجم المشفر: 528 بايت</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>bytes    0-15: Hop&#39;s truncated identity hash
</span></span><span style="display:flex;"><span>  bytes   16-47: Sender&#39;s ephemeral X25519 public key
</span></span><span style="display:flex;"><span>  bytes  48-511: ChaCha20 encrypted BuildRequestRecord
</span></span><span style="display:flex;"><span>  bytes 512-527: Poly1305 MAC
</span></span></code></pre></div><h3 id="أنماط-المصافحة">أنماط المصافحة</h3>
<p>سجلات BuildReplyRecords المشفرة هي 528 بايت لكل من ElGamal و ECIES، من أجل التوافق.</p>
<h4 id="reply-record-unencrypted-elgamal">Reply Record Unencrypted (ElGamal)</h4>
<p>ردود ElGamal مشفرة باستخدام AES.</p>
<p>جميع الحقول بصيغة big-endian.</p>
<p>الحجم غير المُشفّر: 528 بايت</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>bytes   0-31: SHA-256 Hash of bytes 32-527
</span></span><span style="display:flex;"><span>  bytes 32-526: random data
</span></span><span style="display:flex;"><span>  byte     527: reply
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  total length: 528
</span></span></code></pre></div><h4 id="reply-record-unencrypted-ecies">Reply Record Unencrypted (ECIES)</h4>
<p>هذه هي المواصفة المقترحة لـ tunnel BuildReplyRecord لـ routers ECIES-X25519. ملخص التغييرات:</p>
<ul>
<li>إضافة تعيين لخيارات رد البناء</li>
<li>السجل غير المشفر أطول لأن هناك عبء تشفير أقل</li>
</ul>
<p>ردود ECIES مشفرة بـ ChaCha20/Poly1305.</p>
<p>جميع الحقول بصيغة big-endian.</p>
<p>الحجم غير المشفر: 512 بايت</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>bytes    0-x: Tunnel Build Reply Options (Mapping)
</span></span><span style="display:flex;"><span>  bytes    x-x: other data as implied by options
</span></span><span style="display:flex;"><span>  bytes  x-510: Random padding
</span></span><span style="display:flex;"><span>  byte     511: Reply byte
</span></span></code></pre></div><p>خيارات رد بناء tunnel هي هيكل Mapping كما هو محدد في <a href="../../../ar/docs/specs/common-structures/">الهياكل المشتركة</a>
. هذا للاستخدام المستقبلي. لا توجد خيارات محددة حالياً. إذا كان هيكل Mapping فارغاً، فهذا يكون بايتين 0x00 0x00. الحد الأقصى لحجم Mapping (بما في ذلك حقل الطول) هو 511 بايت، والقيمة القصوى لحقل طول Mapping هي 509.</p>
<p>بايت الرد هو إحدى القيم التالية كما هو محدد في <a href="../../../ar/docs/specs/implementation/">إنشاء الأنفاق</a>
 لتجنب بصمة الهوية:</p>
<ul>
<li>0x00 (قبول)</li>
<li>30 (TUNNEL_REJECT_BANDWIDTH)</li>
</ul>
<h4 id="reply-record-encrypted-ecies">Reply Record Encrypted (ECIES)</h4>
<p>الحجم المشفر: 528 بايت</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>bytes   0-511: ChaCha20 encrypted BuildReplyRecord
</span></span><span style="display:flex;"><span>  bytes 512-527: Poly1305 MAC
</span></span></code></pre></div><p>بعد الانتقال الكامل إلى سجلات ECIES، تكون قواعد الحشو المحدود النطاق هي نفسها المستخدمة لسجلات الطلبات.</p>
<h3 id="تشفير-الطلبات">تشفير الطلبات</h3>
<p>الأنفاق المختلطة مسموحة وضرورية للانتقال من ElGamal إلى ECIES. خلال الفترة الانتقالية، سيزداد عدد أجهزة router التي تستخدم مفاتيح ECIES.</p>
<p>المعالجة المسبقة للتشفير المتماثل ستعمل بنفس الطريقة:</p>
<ul>
<li>
<p>&ldquo;التشفير&rdquo;:</p>
</li>
<li>
<p>cipher يعمل في وضع فك التشفير</p>
</li>
<li>
<p>سجلات الطلبات يتم فك تشفيرها بشكل استباقي في المعالجة المسبقة (إخفاء سجلات الطلبات المشفرة)</p>
</li>
<li>
<p>&ldquo;decryption&rdquo;:</p>
</li>
<li>
<p>تشغيل التشفير في وضع التشفير</p>
</li>
<li>
<p>سجلات الطلبات مشفرة (تكشف سجل طلب النص العادي التالي) بواسطة قفزات المشاركين</p>
</li>
<li>
<p>ChaCha20 ليس لديه &ldquo;أوضاع&rdquo;، لذلك يتم تشغيله ببساطة ثلاث مرات:</p>
</li>
<li>
<p>مرة واحدة في المعالجة المسبقة</p>
</li>
<li>
<p>مرة واحدة بواسطة الـ hop</p>
</li>
<li>
<p>مرة واحدة في معالجة الرد النهائي</p>
</li>
</ul>
<p>عند استخدام الأنفاق المختلطة، سيحتاج منشئو الأنفاق إلى تأسيس التشفير المتماثل لـ BuildRequestRecord على نوع التشفير للقفزة الحالية والسابقة.</p>
<p>كل hop سيستخدم نوع التشفير الخاص به لتشفير BuildReplyRecords، والسجلات الأخرى في VariableTunnelBuildMessage (VTBM).</p>
<p>في مسار الرد، ستحتاج نقطة النهاية (المرسل) إلى إلغاء <a href="https://en.wikipedia.org/wiki/Multiple_encryption">التشفير المتعدد</a>
، باستخدام مفتاح الرد الخاص بكل قفزة.</p>
<p>كمثال توضيحي، دعونا ننظر إلى tunnel صادر مع ECIES محاط بـ ElGamal:</p>
<ul>
<li>المرسل (OBGW) -&gt; ElGamal (H1) -&gt; ECIES (H2) -&gt; ElGamal (H3)</li>
</ul>
<p>جميع سجلات BuildRequestRecords في حالتها المشفرة (باستخدام ElGamal أو ECIES).</p>
<p>يتم استخدام تشفير AES256/CBC، عند استخدامه، لكل سجل على حدة، دون ربط عبر سجلات متعددة.</p>
<p>وبالمثل، سيتم استخدام ChaCha20 لتشفير كل سجل، وليس بث مستمر عبر VTBM بأكمله.</p>
<p>يتم معالجة سجلات الطلبات مسبقاً بواسطة المرسل (OBGW):</p>
<ul>
<li>
<p>سجل H3 &ldquo;مُشفر&rdquo; باستخدام:</p>
</li>
<li>
<p>مفتاح الرد الخاص بـ H2 (ChaCha20)</p>
</li>
<li>
<p>مفتاح الرد الخاص بـ H1 (AES256/CBC)</p>
</li>
<li>
<p>سجل H2 &ldquo;مُشفر&rdquo; باستخدام:</p>
</li>
<li>
<p>مفتاح الرد للـ H1 (AES256/CBC)</p>
</li>
<li>
<p>يتم إرسال سجل H1 بدون تشفير متماثل</p>
</li>
</ul>
<p>فقط H2 يفحص علامة تشفير الرد، ويرى أنها متبوعة بـ AES256/CBC.</p>
<p>بعد معالجتها من قبل كل hop، تكون السجلات في حالة &ldquo;مفكوكة التشفير&rdquo;:</p>
<ul>
<li>
<p>يتم &ldquo;فك تشفير&rdquo; سجل H3 باستخدام:</p>
</li>
<li>
<p>مفتاح الرد الخاص بـ H3 (AES256/CBC)</p>
</li>
<li>
<p>يتم &ldquo;فك تشفير&rdquo; سجل H2 باستخدام:</p>
</li>
<li>
<p>مفتاح الرد الخاص بـ H3 (AES256/CBC)</p>
</li>
<li>
<p>مفتاح الرد الخاص بـ H2 (ChaCha20-Poly1305)</p>
</li>
<li>
<p>يتم &ldquo;فك تشفير&rdquo; سجل H1 باستخدام:</p>
</li>
<li>
<p>مفتاح الرد الخاص بـ H3 (AES256/CBC)</p>
</li>
<li>
<p>مفتاح الرد الخاص بـ H2 (ChaCha20)</p>
</li>
<li>
<p>مفتاح الرد الخاص بـ H1 (AES256/CBC)</p>
</li>
</ul>
<p>منشئ tunnel، المعروف أيضاً باسم Inbound Endpoint (IBEP)، يقوم بمعالجة الرد لاحقاً:</p>
<ul>
<li>
<p>سجل H3 &ldquo;مشفر&rdquo; باستخدام:</p>
</li>
<li>
<p>مفتاح الرد الخاص بـ H3 (AES256/CBC)</p>
</li>
<li>
<p>سجل H2 &ldquo;مشفر&rdquo; باستخدام:</p>
</li>
<li>
<p>مفتاح الرد الخاص بـ H3 (AES256/CBC)</p>
</li>
<li>
<p>مفتاح الرد الخاص بـ H2 (ChaCha20-Poly1305)</p>
</li>
<li>
<p>سجل H1 &ldquo;مُشفر&rdquo; باستخدام:</p>
</li>
<li>
<p>مفتاح الرد الخاص بـ H3 (AES256/CBC)</p>
</li>
<li>
<p>مفتاح الرد الخاص بـ H2 (ChaCha20)</p>
</li>
<li>
<p>مفتاح الرد الخاص بـ H1 (AES256/CBC)</p>
</li>
</ul>
<h3 id="تشفير-الرد">تشفير الرد</h3>
<p>هذه المفاتيح مُضمنة صراحة في ElGamal BuildRequestRecords. بالنسبة لـ ECIES BuildRequestRecords، يتم تضمين مفاتيح tunnel ومفاتيح AES reply، لكن مفاتيح ChaCha reply مُشتقة من تبادل DH. راجع <a href="../../../ar/proposals/156-ecies-routers">الاقتراح 156</a>
 لتفاصيل مفاتيح router الثابتة ECIES.</p>
<p>فيما يلي وصف لكيفية اشتقاق المفاتيح المرسلة مسبقاً في سجلات الطلبات.</p>
<h4 id="kdf-for-initial-ck-and-h">KDF for Initial ck and h</h4>
<p>هذا هو <a href="https://noiseprotocol.org/noise.html">NOISE</a>
 قياسي للنمط &ldquo;N&rdquo; مع اسم بروتوكول قياسي.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>This is the &#34;e&#34; message pattern:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  // Define protocol_name.
</span></span><span style="display:flex;"><span>  Set protocol_name = &#34;Noise_N_25519_ChaChaPoly_SHA256&#34;
</span></span><span style="display:flex;"><span>  (31 bytes, US-ASCII encoded, no NULL termination).
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  // Define Hash h = 32 bytes
</span></span><span style="display:flex;"><span>  // Pad to 32 bytes. Do NOT hash it, because it is not more than 32 bytes.
</span></span><span style="display:flex;"><span>  h = protocol_name || 0
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  Define ck = 32 byte chaining key. Copy the h data to ck.
</span></span><span style="display:flex;"><span>  Set chainKey = h
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  // MixHash(null prologue)
</span></span><span style="display:flex;"><span>  h = SHA256(h);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  // up until here, can all be precalculated by all routers.
</span></span></code></pre></div><h4 id="kdf-for-request-record">KDF for Request Record</h4>
<p>منشئو أنفاق ElGamal يولدون زوج مفاتيح X25519 مؤقت لكل قفزة ECIES في النفق، ويستخدمون المخطط أعلاه لتشفير BuildRequestRecord الخاص بهم. سيستخدم منشئو أنفاق ElGamal المخطط السابق لهذه المواصفة للتشفير إلى قفزات ElGamal.</p>
<p>منشئو أنفاق ECIES سيحتاجون إلى التشفير لكل مفتاح عام لقفزة ElGamal باستخدام المخطط المحدد في <a href="../../../ar/docs/specs/implementation/">إنشاء الأنفاق</a>
. سيستخدم منشئو أنفاق ECIES المخطط أعلاه للتشفير إلى قفزات ECIES.</p>
<p>هذا يعني أن قفزات tunnel ستشاهد فقط السجلات المشفرة من نفس نوع التشفير الخاص بها.</p>
<p>بالنسبة لمُنشِئي tunnel من نوع ElGamal و ECIES، فسيقومون بإنتاج أزواج مفاتيح X25519 مؤقتة فريدة لكل hop لتشفير hops من نوع ECIES.</p>
<p><strong>مهم</strong>: يجب أن تكون المفاتيح المؤقتة فريدة لكل hop في ECIES، ولكل سجل بناء. عدم استخدام مفاتيح فريدة يفتح ثغرة أمنية للـ hops المتواطئة لتأكيد أنها في نفس الـ tunnel.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>// Each hop&#39;s X25519 static keypair (hesk, hepk) from the Router Identity
</span></span><span style="display:flex;"><span>  hesk = GENERATE_PRIVATE()
</span></span><span style="display:flex;"><span>  hepk = DERIVE_PUBLIC(hesk)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  // MixHash(hepk)
</span></span><span style="display:flex;"><span>  // || below means append
</span></span><span style="display:flex;"><span>  h = SHA256(h || hepk);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  // up until here, can all be precalculated by each router
</span></span><span style="display:flex;"><span>  // for all incoming build requests
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  // Sender generates an X25519 ephemeral keypair per ECIES hop in the VTBM (sesk, sepk)
</span></span><span style="display:flex;"><span>  sesk = GENERATE_PRIVATE()
</span></span><span style="display:flex;"><span>  sepk = DERIVE_PUBLIC(sesk)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  // MixHash(sepk)
</span></span><span style="display:flex;"><span>  h = SHA256(h || sepk);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  End of &#34;e&#34; message pattern.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  This is the &#34;es&#34; message pattern:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  // Noise es
</span></span><span style="display:flex;"><span>  // Sender performs an X25519 DH with Hop&#39;s static public key.
</span></span><span style="display:flex;"><span>  // Each Hop, finds the record w/ their truncated identity hash,
</span></span><span style="display:flex;"><span>  // and extracts the Sender&#39;s ephemeral key preceding the encrypted record.
</span></span><span style="display:flex;"><span>  sharedSecret = DH(sesk, hepk) = DH(hesk, sepk)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  // MixKey(DH())
</span></span><span style="display:flex;"><span>  //[chainKey, k] = MixKey(sharedSecret)
</span></span><span style="display:flex;"><span>  // ChaChaPoly parameters to encrypt/decrypt
</span></span><span style="display:flex;"><span>  keydata = HKDF(chainKey, sharedSecret, &#34;&#34;, 64)
</span></span><span style="display:flex;"><span>  // Save for Reply Record KDF
</span></span><span style="display:flex;"><span>  chainKey = keydata[0:31]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  // AEAD parameters
</span></span><span style="display:flex;"><span>  k = keydata[32:63]
</span></span><span style="display:flex;"><span>  n = 0
</span></span><span style="display:flex;"><span>  plaintext = 464 byte build request record
</span></span><span style="display:flex;"><span>  ad = h
</span></span><span style="display:flex;"><span>  ciphertext = ENCRYPT(k, n, plaintext, ad)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  End of &#34;es&#34; message pattern.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  // MixHash(ciphertext)
</span></span><span style="display:flex;"><span>  // Save for Reply Record KDF
</span></span><span style="display:flex;"><span>  h = SHA256(h || ciphertext)
</span></span></code></pre></div><p><code>replyKey</code> و <code>layerKey</code> و <code>layerIV</code> يجب أن تُضمَّن أيضاً داخل سجلات ElGamal، ويمكن توليدها عشوائياً.</p>
<h3 id="المبرر">المبرر</h3>
<p>كما هو محدد في <a href="../../../ar/docs/specs/implementation/">إنشاء الأنفاق</a>
. لا توجد تغييرات على التشفير لقفزات ElGamal.</p>
<h3 id="reply-record-encryption-ecies">Reply Record Encryption (ECIES)</h3>
<p>سجل الرد مُشفر بـ ChaCha20/Poly1305.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>// AEAD parameters
</span></span><span style="display:flex;"><span>  k = chainkey from build request
</span></span><span style="display:flex;"><span>  n = 0
</span></span><span style="display:flex;"><span>  plaintext = 512 byte build reply record
</span></span><span style="display:flex;"><span>  ad = h from build request
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  ciphertext = ENCRYPT(k, n, plaintext, ad)
</span></span></code></pre></div><h3 id="سجلات-طلب-البناء">سجلات طلب البناء</h3>
<p>كما هو محدد في <a href="../../../ar/docs/specs/implementation/">Tunnel Creation</a>
. لا توجد تغييرات على التشفير لقفزات ElGamal.</p>
<h3 id="security-analysis">Security Analysis</h3>
<p>ElGamal لا يوفر السرية الأمامية لرسائل بناء الأنفاق.</p>
<p>AES256/CBC في وضع أفضل قليلاً، حيث أنه معرض فقط لضعف نظري من هجوم <code>biclique</code> معروف النص الأصلي.</p>
<p>الهجوم العملي الوحيد المعروف ضد AES256/CBC هو هجوم padding oracle، عندما يكون الـ IV معروفاً للمهاجم.</p>
<p>المهاجم سيحتاج إلى كسر تشفير ElGamal للقفزة التالية للحصول على معلومات مفتاح AES256/CBC (مفتاح الرد و IV).</p>
<p>ElGamal يستهلك موارد المعالج بشكل أكبر بكثير من ECIES، مما يؤدي إلى استنزاف محتمل للموارد.</p>
<p>ECIES، المستخدم مع مفاتيح ephemeral جديدة لكل BuildRequestRecord أو VariableTunnelBuildMessage، يوفر forward-secrecy.</p>
<p>يوفر ChaCha20Poly1305 تشفير AEAD، مما يسمح للمستقبل بالتحقق من سلامة الرسالة قبل محاولة فك التشفير.</p>
<h2 id="نموذج-التهديد">نموذج التهديد</h2>
<p>يهدف هذا التصميم إلى تعظيم إعادة استخدام العمليات التشفيرية والبروتوكولات والكود الموجودة. يقلل هذا التصميم من المخاطر.</p>
<h2 id="implementation-notes">Implementation Notes</h2>
<ul>
<li>أجهزة التوجيه الأقدم لا تتحقق من نوع التشفير للقفزة وسترسل سجلات مشفرة بـ ElGamal. بعض أجهزة التوجيه الحديثة تحتوي على أخطاء وسترسل أنواع مختلفة من السجلات المشوهة. يجب على المطورين اكتشاف ورفض هذه السجلات قبل عملية DH إن أمكن، لتقليل استخدام المعالج.</li>
</ul>
<h2 id="issues">Issues</h2>
<h2 id="التصميم">التصميم</h2>
<p>راجع <a href="../../../ar/proposals/156-ecies-routers">Proposal 156</a>
.</p>

                </article>

                
                <nav class="page-nav">
                    <a href="../../../ar/proposals/" class="page-nav-link">
                        ← Back to Proposals
                    </a>
                    
                    
                    
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                            
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                    <a href="../../../proposals/152-ecies-tunnels.txt" class="page-nav-link" download>
                        Download Source (.txt)
                    </a>
                    
                </nav>
            </div>
        </div>
    </div>
</div>

<style>
.proposals-page {
    min-height: 100vh;
    padding: var(--spacing-xl) 0;
}

.breadcrumbs {
    display: flex;
    align-items: center;
    gap: var(--spacing-xs);
    margin-bottom: var(--spacing-lg);
    font-size: 0.875rem;
    color: var(--color-text-muted);
}

.breadcrumbs a {
    color: var(--color-text-muted);
    text-decoration: none;
    transition: color var(--transition-fast);
}

.breadcrumbs a:hover {
    color: var(--color-primary);
}

.separator {
    color: var(--color-border);
}

.current {
    color: var(--color-text);
}

 
.translation-disclaimer {
    background: #fef3c7;
    border: 1px solid #f59e0b;
    border-radius: var(--radius-md);
    padding: var(--spacing-md);
    margin-bottom: var(--spacing-lg);
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: var(--spacing-md);
    flex-wrap: wrap;
}

.dark .translation-disclaimer {
    background: #78350f;
    border-color: #d97706;
}

.disclaimer-message {
    color: #92400e;
    font-size: 0.875rem;
}

.dark .disclaimer-message {
    color: #fde047;
}

.disclaimer-link {
    color: #92400e;
    font-weight: 600;
    text-decoration: underline;
    white-space: nowrap;
}

.dark .disclaimer-link {
    color: #fde047;
}

 
.proposal-header {
    margin-bottom: var(--spacing-2xl);
}

.proposal-title-section {
    margin-bottom: var(--spacing-lg);
}

.proposal-title {
    font-size: 2.5rem;
    margin: 0 0 var(--spacing-sm) 0;
    color: var(--color-text);
}

.proposal-number {
    font-size: 0.875rem;
    color: var(--color-text-muted);
    font-weight: 600;
}

 
.proposal-meta-box {
    background: var(--color-bg-secondary);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-lg);
    padding: var(--spacing-lg);
}

.proposal-status {
    display: inline-block;
    padding: var(--spacing-xs) var(--spacing-md);
    border-radius: var(--radius-md);
    font-weight: 600;
    font-size: 0.875rem;
    margin-bottom: var(--spacing-md);
    text-transform: uppercase;
    letter-spacing: 0.05em;
}

 
.status-open {
    background: #dbeafe;
    color: #0369a1;
}

.dark .status-open {
    background: #0c4a6e;
    color: #7dd3fc;
}

.status-accepted {
    background: #dbeafe;
    color: #0369a1;
}

.dark .status-accepted {
    background: #0c4a6e;
    color: #7dd3fc;
}

.status-finished {
    background: #dcfce7;
    color: #15803d;
}

.dark .status-finished {
    background: #164e63;
    color: #86efac;
}

.status-closed {
    background: #dcfce7;
    color: #15803d;
}

.dark .status-closed {
    background: #164e63;
    color: #86efac;
}

.status-rejected {
    background: #fee2e2;
    color: #991b1b;
}

.dark .status-rejected {
    background: #7f1d1d;
    color: #fca5a5;
}

.status-draft,
.status-needs-revision,
.status-dead,
.status-needs-research {
    background: #fef3c7;
    color: #92400e;
}

.dark .status-draft,
.dark .status-needs-revision,
.dark .status-dead,
.dark .status-needs-research {
    background: #78350f;
    color: #fde047;
}

.status-meta,
.status-informational,
.status-reserve {
    background: #e9d5ff;
    color: #6b21a8;
}

.dark .status-meta,
.dark .status-informational,
.dark .status-reserve {
    background: #581c87;
    color: #e879f9;
}

 
.proposal-info-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: var(--spacing-md);
    margin-bottom: var(--spacing-lg);
}

.info-item {
    display: flex;
    flex-direction: column;
    gap: var(--spacing-xs);
}

.info-label {
    font-size: 0.75rem;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    color: var(--color-text-muted);
}

.info-value {
    font-size: 0.9375rem;
    color: var(--color-text);
    font-weight: 500;
}

 
.proposal-relationships {
    border-top: 1px solid var(--color-border);
    padding-top: var(--spacing-md);
}

.relationship {
    display: flex;
    gap: var(--spacing-md);
    margin-bottom: var(--spacing-sm);
}

.relationship:last-child {
    margin-bottom: 0;
}

.relationship-label {
    font-weight: 600;
    color: var(--color-text-muted);
    min-width: 120px;
}

.relationship-value {
    color: var(--color-text);
}

 
.proposal-layout {
    display: block;
}

.proposal-layout--with-toc {
    display: grid;
    grid-template-columns: 260px 1fr;
    gap: var(--spacing-2xl);
    align-items: start;
}

 
.proposal-toc-sidebar {
    position: sticky;
    top: 100px;
    max-height: calc(100vh - 120px);
    overflow-y: auto;
}

.toc-nav {
    background: var(--color-bg-secondary);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-lg);
    padding: var(--spacing-md);
}

.toc-header {
    display: flex;
    align-items: center;
    gap: var(--spacing-sm);
    font-weight: 700;
    font-size: 0.875rem;
    color: var(--color-text);
    padding-bottom: var(--spacing-md);
    margin-bottom: var(--spacing-md);
    border-bottom: 1px solid var(--color-border);
}

.toc-content {
    max-height: calc(100vh - 250px);
    overflow-y: auto;
}

.toc-content::-webkit-scrollbar {
    width: 4px;
}

.toc-content::-webkit-scrollbar-track {
    background: transparent;
}

.toc-content::-webkit-scrollbar-thumb {
    background: var(--color-border);
    border-radius: 2px;
}

.toc-content::-webkit-scrollbar-thumb:hover {
    background: var(--color-text-muted);
}

.toc-nav ul {
    list-style: none;
    padding-left: 0;
    margin: 0;
}

.toc-nav li {
    margin-bottom: 0.25rem;
}

.toc-nav ul ul {
    padding-left: var(--spacing-md);
    margin-top: 0.25rem;
}

.toc-nav a {
    color: var(--color-text-secondary);
    text-decoration: none;
    font-size: 0.8125rem;
    display: block;
    padding: 0.25rem 0.5rem;
    border-radius: var(--radius-sm);
    transition: all var(--transition-fast);
    line-height: 1.4;
}

.toc-nav a:hover {
    color: var(--color-primary);
    background: var(--color-bg-tertiary);
}

 
.proposal-main {
    min-width: 0;
}

 
.proposal-content {
    line-height: 1.8;
    color: var(--color-text);
    max-width: 900px;
}

.proposal-content h2 {
    margin-top: var(--spacing-2xl);
    margin-bottom: var(--spacing-md);
    font-size: 1.75rem;
    scroll-margin-top: 100px;
}

.proposal-content h3 {
    margin-top: var(--spacing-xl);
    margin-bottom: var(--spacing-sm);
    font-size: 1.375rem;
    scroll-margin-top: 100px;
}

.proposal-content h4 {
    margin-top: var(--spacing-lg);
    margin-bottom: var(--spacing-xs);
    font-size: 1.125rem;
    scroll-margin-top: 100px;
}

.proposal-content p {
    margin-bottom: var(--spacing-md);
}

.proposal-content ul,
.proposal-content ol {
    margin-bottom: var(--spacing-md);
    padding-left: var(--spacing-xl);
}

.proposal-content li {
    margin-bottom: var(--spacing-xs);
}

.proposal-content code {
    background: var(--color-bg-secondary);
    padding: 0.125rem 0.375rem;
    border-radius: var(--radius-sm);
    font-size: 0.875em;
    font-family: 'Courier New', monospace;
}

.proposal-content pre {
    background: var(--color-bg-secondary);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-md);
    padding: var(--spacing-md);
    overflow-x: auto;
    margin-bottom: var(--spacing-md);
    font-size: 0.875rem;
}

.proposal-content pre code {
    background: none;
    padding: 0;
}

.proposal-content blockquote {
    border-left: 4px solid var(--color-primary);
    padding-left: var(--spacing-md);
    margin-left: 0;
    margin-bottom: var(--spacing-md);
    font-style: italic;
    color: var(--color-text-secondary);
}

.proposal-content a {
    color: var(--color-primary);
    text-decoration: none;
    border-bottom: 1px solid transparent;
    transition: border-color var(--transition-fast);
}

.proposal-content a:hover {
    border-bottom-color: var(--color-primary);
}

.proposal-content table {
    width: 100%;
    border-collapse: collapse;
    margin-bottom: var(--spacing-md);
}

.proposal-content table th {
    background: var(--color-bg-secondary);
    padding: var(--spacing-sm);
    text-align: left;
    font-weight: 600;
    border-bottom: 2px solid var(--color-border);
}

.proposal-content table td {
    padding: var(--spacing-sm);
    border-bottom: 1px solid var(--color-border);
}

.proposal-content img {
    max-width: 100%;
    height: auto;
    border-radius: var(--radius-md);
    border: 1px solid var(--color-border);
    margin: var(--spacing-lg) 0;
    display: block;
}

 
.page-nav {
    margin-top: var(--spacing-2xl);
    padding-top: var(--spacing-xl);
    border-top: 1px solid var(--color-border);
    display: flex;
    gap: var(--spacing-md);
    flex-wrap: wrap;
}

.page-nav-link {
    display: inline-block;
    padding: var(--spacing-md) var(--spacing-lg);
    background: var(--color-bg-secondary);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-md);
    color: var(--color-text);
    text-decoration: none;
    transition: all var(--transition-fast);
}

.page-nav-link:hover {
    border-color: var(--color-primary);
    color: var(--color-primary);
}

 
@media (max-width: 1024px) {
    .proposal-layout--with-toc {
        grid-template-columns: 1fr;
    }

    .proposal-toc-sidebar {
        position: static;
        max-height: none;
        margin-bottom: var(--spacing-xl);
    }

    .toc-content {
        max-height: 300px;
    }
}

@media (max-width: 768px) {
    .proposal-title {
        font-size: 1.75rem;
    }

    .proposal-info-grid {
        grid-template-columns: 1fr;
    }
}
</style>



<script>
document.addEventListener('DOMContentLoaded', function() {
    const tocLinks = document.querySelectorAll('.toc-nav a');
    const headings = [];

    tocLinks.forEach(link => {
        const href = link.getAttribute('href');
        if (href && href.startsWith('#')) {
            const heading = document.getElementById(href.slice(1));
            if (heading) {
                headings.push({ element: heading, link: link });
            }
        }
    });

    function updateActiveLink() {
        const scrollPos = window.scrollY + 120;
        let activeIndex = 0;

        for (let i = 0; i < headings.length; i++) {
            if (headings[i].element.offsetTop <= scrollPos) {
                activeIndex = i;
            }
        }

        tocLinks.forEach(link => link.classList.remove('active'));
        if (headings[activeIndex]) {
            headings[activeIndex].link.classList.add('active');
        }
    }

    window.addEventListener('scroll', updateActiveLink);
    updateActiveLink();
});
</script>
<style>
.toc-nav a.active {
    color: var(--color-primary);
    background: var(--color-bg-tertiary);
    font-weight: 600;
}
</style>



    </main>

    <footer class="site-footer">
    <div class="container">
        <div class="footer-grid">
            <div class="footer-col footer-brand">
                <img src="../../../images/i2plogo_lightmode.svg" alt="I2P Logo" class="footer-logo logo-light" loading="lazy" decoding="async">
                <img src="../../../images/i2plogo_darkmode.svg" alt="I2P Logo" class="footer-logo logo-dark" loading="lazy" decoding="async">
                <p class="footer-tagline">Privacy. Security. Freedom.</p>
                <p class="footer-description">The Invisible Internet Project - A privacy-focused, anonymous network layer</p>

                <div class="footer-social-newsletter">
                    <div class="social-links">
                        <a href="https://mastodon.social/@i2p" target="_blank" rel="noopener" aria-label="Mastodon">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M21.327 8.566c0-4.339-2.843-5.61-2.843-5.61-1.433-.658-3.894-.935-6.451-.956h-.063c-2.557.021-5.016.298-6.45.956 0 0-2.843 1.272-2.843 5.61 0 .993-.019 2.181.012 3.441.103 4.243.778 8.425 4.701 9.463 1.809.479 3.362.579 4.612.51 2.268-.126 3.541-.809 3.541-.809l-.075-1.646s-1.621.511-3.441.449c-1.804-.062-3.707-.194-3.999-2.409a4.523 4.523 0 0 1-.04-.621s1.77.433 4.014.536c1.372.063 2.658-.08 3.965-.236 2.506-.299 4.688-1.843 4.962-3.254.434-2.223.398-5.424.398-5.424zm-3.353 5.59h-2.081V9.057c0-1.075-.452-1.62-1.357-1.62-1 0-1.501.647-1.501 1.927v2.791h-2.069V9.364c0-1.28-.501-1.927-1.502-1.927-.905 0-1.357.546-1.357 1.62v5.099H6.026V8.903c0-1.074.273-1.927.823-2.558.566-.631 1.307-.955 2.228-.955 1.065 0 1.872.409 2.405 1.228l.518.869.519-.869c.533-.819 1.34-1.228 2.405-1.228.92 0 1.662.324 2.228.955.549.631.822 1.484.822 2.558v5.253z"/>
                            </svg>
                        </a>
                        <a href="https://twitter.com/GetI2P" target="_blank" rel="noopener" aria-label="Twitter">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/>
                            </svg>
                        </a>
                        <a href="https://old.reddit.com/r/i2p" target="_blank" rel="noopener" aria-label="Reddit">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M12 0A12 12 0 0 0 0 12a12 12 0 0 0 12 12 12 12 0 0 0 12-12A12 12 0 0 0 12 0zm5.01 4.744c.688 0 1.25.561 1.25 1.249a1.25 1.25 0 0 1-2.498.056l-2.597-.547-.8 3.747c1.824.07 3.48.632 4.674 1.488.308-.309.73-.491 1.207-.491.968 0 1.754.786 1.754 1.754 0 .716-.435 1.333-1.01 1.614a3.111 3.111 0 0 1 .042.52c0 2.694-3.13 4.87-7.004 4.87-3.874 0-7.004-2.176-7.004-4.87 0-.183.015-.366.043-.534A1.748 1.748 0 0 1 4.028 12c0-.968.786-1.754 1.754-1.754.463 0 .898.196 1.207.49 1.207-.883 2.878-1.43 4.744-1.487l.885-4.182a.342.342 0 0 1 .14-.197.35.35 0 0 1 .238-.042l2.906.617a1.214 1.214 0 0 1 1.108-.701zM9.25 12C8.561 12 8 12.562 8 13.25c0 .687.561 1.248 1.25 1.248.687 0 1.248-.561 1.248-1.249 0-.688-.561-1.249-1.249-1.249zm5.5 0c-.687 0-1.248.561-1.248 1.25 0 .687.561 1.248 1.249 1.248.688 0 1.249-.561 1.249-1.249 0-.687-.562-1.249-1.25-1.249zm-5.466 3.99a.327.327 0 0 0-.231.094.33.33 0 0 0 0 .463c.842.842 2.484.913 2.961.913.477 0 2.105-.056 2.961-.913a.361.361 0 0 0 .029-.463.33.33 0 0 0-.464 0c-.547.533-1.684.73-2.512.73-.828 0-1.979-.196-2.512-.73a.326.326 0 0 0-.232-.095z"/>
                            </svg>
                        </a>
                        <a href="https://signal.group/#CjQKIOSUTtxlhbumAKcRsthPFkxkTUrkWcX39bbN6njLEgAIEhCTNsR0KDuiehAXZnkt42v5" target="_blank" rel="noopener" aria-label="Signal" class="signal-link">
                            <img src="../../../images/Signal-Logo-Black.svg" alt="Signal" class="signal-logo signal-logo-light" loading="lazy" decoding="async">
                            <img src="../../../images/Signal-Logo-White.svg" alt="Signal" class="signal-logo signal-logo-dark" loading="lazy" decoding="async">
                        </a>
                    </div>

                    
                    <div class="footer-newsletter-inline">
                        <p class="newsletter-description">ابقَ على اطلاع بأخبار I2P:</p>
                        <form action="https://feedback.i2p.net/api/mailing-list/subscribe" method="POST" class="newsletter-form">
                            <input type="email" name="email" placeholder="أدخل بريدك الإلكتروني" required>
                            <button type="submit">اشترك</button>
                        </form>
                    </div>
                </div>
            </div>

            <div class="footer-col">
                <h3>روابط سريعة</h3>
                <ul>
                    <li><a href="../../../ar/financial-support/">تبرع</a></li>
                    <li><a href="../../../ar/docs/overview/intro/">مقدمة I2P</a></li>
                </ul>
            </div>

            <div class="footer-col">
                <h3>المجتمع</h3>
                <ul>
                    <li><a href="../../../ar/get-involved/">شارك معنا</a></li>
                    <li><a href="../../../ar/blog/">مدونة</a></li>
                    <li><a href="http://i2pforum.net/" target="_blank" rel="noopener">المنتديات الرسمية</a></li>
                    <li><a href="../../../ar/contact/">اتصل بنا</a></li>
                </ul>
            </div>

            <div class="footer-col">
                <h3>الموارد</h3>
                <ul>
                    <li><a href="https://i2p-metrics.np-tokumei.net/" target="_blank" rel="noopener">إحصائيات I2P</a></li>
                    <li><a href="../../../ar/papers/">بحث</a></li>
                    <li><a href="https://i2pgit.org/" target="_blank" rel="noopener">GitLab</a></li>
                    <li><a href="https://www.stormycloud.org/" target="_blank" rel="noopener">ستورمي كلاود</a></li>
                </ul>
            </div>
        </div>

        <div class="footer-bottom">
            <p class="copyright">&copy; 2025 مشروع الإنترنت الخفي. مرخص تحت Creative Commons.</p>
            <div class="footer-links">
                <a href="../../../ar/privacy/">الخصوصية</a>
                <a href="../../../ar/terms/">الشروط</a>
                <a href="../../../ar/about/media/">الصحافة</a>
            </div>
        </div>
    </div>
</footer>


    
    
<div class="modal-overlay" id="poll">
    <div class="modal-content poll-modal-content">
        <a href="#" class="modal-close" aria-label="إغلاق">
            <span aria-hidden="true">&times;</span>
        </a>

        <div class="modal-header">
            <h2>استطلاع المجتمع</h2>
            <p class="modal-subtitle">نود أن نسمع منك</p>
        </div>

        <div class="modal-body">
            
            <iframe 
                id="poll-iframe"
                data-poll-id="2"
                data-api-url="https://feedback.i2p.net"
                frameborder="0"
                scrolling="no"
                style="width: 100%; border: none; min-height: 400px;">
            </iframe>
        </div>

        <div class="modal-footer">
            <p class="modal-disclaimer">
                يساعد تصويتك في تشكيل مستقبل I2P.
            </p>
        </div>
    </div>
</div>


<script>
(function() {
    const iframe = document.getElementById('poll-iframe');
    if (!iframe) return;
    
    const hostname = window.location.hostname;
    let apiUrl = 'https://feedback.i2p.net';
    const pollId = iframe.getAttribute('data-poll-id') || '1';

    
    if (hostname.endsWith('.b32.i2p') || hostname.endsWith('.i2p')) {
        apiUrl = 'http://5kwyynf3eetgqa2nors6ctwo7doi7yu73k7uvypy5eqmm326zkiq.b32.i2p';
    }
    
    else if (hostname.endsWith('.onion')) {
        apiUrl = 'http://gfonxmohvarpmocsvllscsuszdu5rikipm6innvcwq4vpng7zzqmmfyd.onion';
    }

    
    const pollUrl = apiUrl + '/widgets/poll.html?poll_id=' + encodeURIComponent(pollId) + '&api_url=' + encodeURIComponent(apiUrl);
    iframe.src = pollUrl;
})();
</script>



    
    



    
    <script>
        (function () {
            'use strict';
            var hostname = window.location.hostname;
            var baseUrl;

            
            if (hostname.endsWith('.b32.i2p') || hostname.endsWith('.i2p')) {
                baseUrl = 'http://5kwyynf3eetgqa2nors6ctwo7doi7yu73k7uvypy5eqmm326zkiq.b32.i2p';
            } else if (hostname.endsWith('.onion')) {
                baseUrl = 'http://gfonxmohvarpmocsvllscsuszdu5rikipm6innvcwq4vpng7zzqmmfyd.onion';
            } else {
                baseUrl = 'https://feedback.i2p.net';
            }

            window.feedbackBaseUrl = baseUrl;

            
            document.querySelectorAll('[data-api-url]').forEach(function (widget) {
                widget.setAttribute('data-api-url', baseUrl);
            });

            
            document.write('<link rel="stylesheet" href="' + baseUrl + '/widgets/styles.css">');
            
        })();
    </script>

    

    
    
    

    

</body>

</html>
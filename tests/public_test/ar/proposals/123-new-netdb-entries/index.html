<!DOCTYPE html>
<html lang="ar" data-theme="light">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <title>إدخالات netDB جديدة | I2P - مشروع الإنترنت غير المرئي</title>

    <meta name="description" content="The Invisible Internet Project - A privacy-focused, anonymous network layer">
    <meta name="keywords" content="i2p, privacy, anonymity, dark net, encryption, security">

    
    <meta property="og:title" content="إدخالات netDB جديدة | I2P - مشروع الإنترنت غير المرئي">
    <meta property="og:description" content="The Invisible Internet Project - A privacy-focused, anonymous network layer">
    <meta property="og:type" content="website">
    <meta property="og:url" content="/ar/proposals/123-new-netdb-entries/">

    
    <link rel="icon" type="image/svg+xml" href="../../../images/favicon.svg">
    <link rel="icon" type="image/png" href="../../../images/i2plogo.png" sizes="32x32">

    
    
    
    
    <link rel="stylesheet" href="../../../css/main.min.be6880f32f5ff44e57579da7b11513b973319944ebe38748e3ac7f3268662d18.css" integrity="sha256-vmiA8y9f9E5XV52nsRUTuXMxmUTr44dI46x/MmhmLRg=">
    


    
</head>

<body>
    
    <input type="checkbox" id="theme-toggle-checkbox" class="theme-checkbox" aria-hidden="true">

    
<div class="site-banner" id="site-banner" data-banner-id="banner-3" role="alert" aria-live="polite">
    <div class="container">
        <div class="banner-content">
            <span class="banner-message">موقع I2P التجريبي متاح الآن - أرسل المشاكل إلى stormycloud@mail.i2p</span>
            
        </div>
        
        <form method="GET" action="../../../api/banner/dismiss" style="display: inline;">
            <input type="hidden" name="id" value="banner-3">
            <button type="submit" class="banner-close" aria-label="إغلاق الشريط" title="إغلاق الشريط">
                <span aria-hidden="true">&times;</span>
            </button>
        </form>
        
    </div>
</div>


    <header class="site-header">
    <div class="container">
        <nav class="main-nav">
            <div class="nav-brand">
                <a href="../../../ar/" class="logo-link">
                    <img src="../../../images/i2plogo_lightmode.svg" alt="I2P Logo" class="logo logo-light">
                    <img src="../../../images/i2plogo_darkmode.svg" alt="I2P Logo" class="logo logo-dark">
                </a>
            </div>

            
            <input type="checkbox" id="mobile-menu-checkbox" class="mobile-menu-checkbox"
                aria-label="Toggle navigation menu">
            <label for="mobile-menu-checkbox" class="mobile-menu-toggle" aria-label="Toggle navigation menu">
                <span class="hamburger"></span>
            </label>

            <div class="nav-menu">
                <ul class="nav-links">
                    <li class="nav-dropdown">
                        <a href="../../../ar/about/" class="">حول</a>
                        <ul class="dropdown-menu">
                            <li><a href="../../../ar/about/">نظرة عامة</a></li>
                            <li><a href="../../../ar/papers/">أبحاث</a></li>
                            <li><a href="../../../ar/about/media/">الصحافة</a></li>
                            <li><a href="../../../ar/contact/">اتصل بنا</a></li>
                        </ul>
                    </li>
                    <li><a href="../../../ar/docs/" class="">المستندات</a></li>
                    <li><a href="../../../ar/downloads/" class="">التنزيلات</a></li>
                    <li><a href="../../../ar/blog/" class="">مدونة</a></li>
                    <li class="nav-dropdown">
                        <a href="../../../ar/get-involved/" class="">شارك معنا</a>
                        <ul class="dropdown-menu">
                            <li><a href="../../../ar/get-involved/">نظرة عامة</a></li>
                            <li><a href="../../../ar/feedback/">اقتراحات الميزات</a></li>
                        </ul>
                    </li>
                </ul>

                <div class="nav-actions">
                    
                    <div class="language-selector">
                        <button class="language-toggle" aria-label="Select language" title="Language">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none"
                                xmlns="http://www.w3.org/2000/svg">
                                <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2" />
                                <path
                                    d="M2 12h20M12 2a15.3 15.3 0 014 10 15.3 15.3 0 01-4 10 15.3 15.3 0 01-4-10 15.3 15.3 0 014-10z"
                                    stroke="currentColor" stroke-width="2" />
                            </svg>
                            <span class="current-lang">ar</span>
                        </button>
                        <div class="language-dropdown">
                            
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../en/proposals/123-new-netdb-entries/"
                                class="lang-option">الإنجليزية</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../es/proposals/123-new-netdb-entries/"
                                class="lang-option">الإسبانية</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../ko/proposals/123-new-netdb-entries/"
                                class="lang-option">الكورية</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../zh/proposals/123-new-netdb-entries/"
                                class="lang-option">الصينية</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../ru/proposals/123-new-netdb-entries/"
                                class="lang-option">الروسية</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../cs/proposals/123-new-netdb-entries/"
                                class="lang-option">التشيكية</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../de/proposals/123-new-netdb-entries/"
                                class="lang-option">الألمانية</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../fr/proposals/123-new-netdb-entries/"
                                class="lang-option">الفرنسية</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../tr/proposals/123-new-netdb-entries/"
                                class="lang-option">التركية</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../vi/proposals/123-new-netdb-entries/"
                                class="lang-option">الفيتنامية</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../hi/proposals/123-new-netdb-entries/"
                                class="lang-option">الهندية</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../ar/proposals/123-new-netdb-entries/"
                                class="lang-option active">العربية</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../pt/proposals/123-new-netdb-entries/"
                                class="lang-option">البرتغالية</a>
                            
                            
                        </div>
                    </div>

                    
                    <label for="theme-toggle-checkbox" class="theme-toggle" aria-label="Toggle dark mode"
                        title="Toggle theme">
                        <svg class="sun-icon" width="20" height="20" viewBox="0 0 20 20" fill="none"
                            xmlns="http://www.w3.org/2000/svg">
                            <circle cx="10" cy="10" r="4" stroke="currentColor" stroke-width="2" />
                            <path
                                d="M10 2V4M10 16V18M18 10H16M4 10H2M15.657 4.343L14.243 5.757M5.757 14.243L4.343 15.657M15.657 15.657L14.243 14.243M5.757 5.757L4.343 4.343"
                                stroke="currentColor" stroke-width="2" stroke-linecap="round" />
                        </svg>
                        <svg class="moon-icon" width="20" height="20" viewBox="0 0 20 20" fill="none"
                            xmlns="http://www.w3.org/2000/svg">
                            <path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"
                                stroke="currentColor" stroke-width="2" stroke-linejoin="round" />
                        </svg>
                    </label>

                    
                    <a href="../../../ar/financial-support/" class="btn btn-primary" id="donate-btn">Donate</a>

                    
                    <a href="../../../ar/downloads/" class="btn btn-primary">احصل على I2P</a>
                </div>
            </div>
        </nav>
    </div>
</header>

    <main id="main-content">
        



<div class="proposals-page">
    <div class="container">
        
        <nav class="breadcrumbs">
            <a href="../../../ar/">Home</a>
            <span class="separator">/</span>
            <a href="../../../ar/proposals/">Proposals</a>
            <span class="separator">/</span>
            <span class="current">إدخالات netDB جديدة</span>
        </nav>

        
<div class="translation-disclaimer" role="note">
    <span class="disclaimer-message">تم إنشاء هذه الترجمة باستخدام التعلم الآلي وقد لا تكون دقيقة بنسبة 100%.</span>
    
    
    <a href="../../../en/proposals/123-new-netdb-entries/" class="disclaimer-link">عرض النسخة الإنجليزية</a>
    
</div>



        
        <header class="proposal-header">
            <div class="proposal-title-section">
                <h1 class="proposal-title">إدخالات netDB جديدة</h1>
                <div class="proposal-number">Proposal 123</div>
            </div>

            
            <div class="proposal-meta-box">
                <div class="proposal-status status-مفتوح">
                    مفتوح
                </div>

                
                <div class="proposal-info-grid">
                    
                    <div class="info-item">
                        <span class="info-label">Author</span>
                        <span class="info-value">zzz, str4d, orignal</span>
                    </div>
                    

                    
                    <div class="info-item">
                        <span class="info-label">Created</span>
                        <span class="info-value">2016-01-16</span>
                    </div>
                    

                    
                    <div class="info-item">
                        <span class="info-label">Last Updated</span>
                        <span class="info-value">2020-07-18</span>
                    </div>
                    

                    

                    
                </div>

                
                
                <div class="proposal-relationships">
                    
                    <div class="relationship">
                        <span class="relationship-label">Supercedes:</span>
                        <span class="relationship-value">110, 120, 121, 122</span>
                    </div>
                    
                    
                </div>
                
            </div>
        </header>

        
        <div class="proposal-layout proposal-layout--with-toc">
            
            
            <aside class="proposal-toc-sidebar">
                <nav class="toc-nav">
                    <div class="toc-header">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                            <path d="M4 6h16M4 12h16M4 18h16" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                        </svg>
                        On This Page
                    </div>
                    <div class="toc-content">
                        <nav id="TableOfContents">
  <ul>
    <li><a href="#الحالة">الحالة</a></li>
    <li><a href="#نظرة-عامة">نظرة عامة</a></li>
    <li><a href="#اقتراح">اقتراح</a>
      <ul>
        <li><a href="#goals">Goals</a></li>
        <li><a href="#non-goals--out-of-scope">Non-Goals / Out-of-scope</a></li>
        <li><a href="#justification">Justification</a></li>
        <li><a href="#الأهداف">الأهداف</a></li>
        <li><a href="#الأهداف-غير-المطلوبة--خارج-النطاق">الأهداف غير المطلوبة / خارج النطاق</a></li>
        <li><a href="#مبرر">مبرر</a></li>
        <li><a href="#أنواع-بيانات-netdb">أنواع بيانات NetDB</a></li>
        <li><a href="#ملاحظات">ملاحظات</a></li>
      </ul>
    </li>
    <li><a href="#standard-ls2-header">Standard LS2 Header</a>
      <ul>
        <li><a href="#عملية-البحثالتخزين">عملية البحث/التخزين</a></li>
        <li><a href="#تنسيق">تنسيق</a></li>
        <li><a href="#اعتبارات-الخصوصيةالأمان">اعتبارات الخصوصية/الأمان</a></li>
        <li><a href="#notes">Notes</a></li>
      </ul>
    </li>
    <li><a href="#new-databaseentry-types">New DatabaseEntry types</a>
      <ul>
        <li><a href="#تنسيق-1">تنسيق</a></li>
        <li><a href="#التبرير">التبرير</a></li>
        <li><a href="#المشاكل">المشاكل</a></li>
        <li><a href="#ملاحظات-1">ملاحظات</a></li>
        <li><a href="#new-encryption-issues">New Encryption Issues</a></li>
        <li><a href="#leaseset-2">LeaseSet 2</a></li>
        <li><a href="#تنسيق-2">تنسيق</a></li>
        <li><a href="#المبرر">المبرر</a></li>
        <li><a href="#المناقشة">المناقشة</a></li>
        <li><a href="#مشاكل-التشفير-الجديدة">مشاكل التشفير الجديدة</a></li>
        <li><a href="#ملاحظات-2">ملاحظات</a></li>
        <li><a href="#ls2-مشفرة">LS2 مشفرة</a></li>
        <li><a href="#تعريفات">تعريفات</a></li>
        <li><a href="#تنسيق-3">تنسيق</a></li>
        <li><a href="#notes-1">Notes</a></li>
        <li><a href="#meta-ls2">Meta LS2</a></li>
        <li><a href="#format">Format</a></li>
        <li><a href="#اشتقاق-مفتاح-الإخفاء">اشتقاق مفتاح الإخفاء</a></li>
        <li><a href="#service-record">Service Record</a></li>
        <li><a href="#format-1">Format</a></li>
        <li><a href="#notes-2">Notes</a></li>
        <li><a href="#service-list">Service List</a></li>
        <li><a href="#format-2">Format</a></li>
        <li><a href="#notes-3">Notes</a></li>
      </ul>
    </li>
    <li><a href="#common-structures-spec-changes-required">Common Structures Spec Changes Required</a>
      <ul>
        <li><a href="#التشفير-والمعالجة">التشفير والمعالجة</a></li>
        <li><a href="#new-intermediate-structures">New Intermediate Structures</a></li>
        <li><a href="#new-netdb-types">New NetDB Types</a></li>
        <li><a href="#new-signature-type">New Signature Type</a></li>
      </ul>
    </li>
    <li><a href="#encryption-spec-changes-required">Encryption Spec Changes Required</a></li>
    <li><a href="#i2np-changes-required">I2NP Changes Required</a>
      <ul>
        <li><a href="#database-lookup-message">Database Lookup Message</a></li>
        <li><a href="#changes">Changes</a></li>
        <li><a href="#ترخيص-لكل-عميل">ترخيص لكل عميل</a></li>
        <li><a href="#changes-1">Changes</a></li>
      </ul>
    </li>
    <li><a href="#i2cp-changes-required">I2CP Changes Required</a>
      <ul>
        <li><a href="#i2cp-options">I2CP Options</a></li>
        <li><a href="#session-config">Session Config</a></li>
        <li><a href="#عناوين-ls-مشفرة-مع-base-32">عناوين LS مشفرة مع Base 32</a></li>
        <li><a href="#مجموعة-الإيجار-المشفرة-encrypted-ls-مع-المفاتيح-غير-المتصلة">مجموعة الإيجار المشفرة (Encrypted LS) مع المفاتيح غير المتصلة</a></li>
        <li><a href="#ملاحظات-3">ملاحظات</a></li>
        <li><a href="#meta-ls2-1">Meta LS2</a></li>
        <li><a href="#التنسيق">التنسيق</a></li>
        <li><a href="#ملاحظات-4">ملاحظات</a></li>
        <li><a href="#سجل-الخدمة">سجل الخدمة</a></li>
        <li><a href="#تنسيق-4">تنسيق</a></li>
        <li><a href="#ملاحظات-5">ملاحظات</a></li>
        <li><a href="#قائمة-الخدمات">قائمة الخدمات</a></li>
        <li><a href="#تنسيق-5">تنسيق</a></li>
        <li><a href="#ملاحظات-6">ملاحظات</a></li>
        <li><a href="#format-3">Format</a></li>
        <li><a href="#شهادات-المفاتيح">شهادات المفاتيح</a></li>
        <li><a href="#هياكل-وسيطة-جديدة">هياكل وسيطة جديدة</a></li>
        <li><a href="#أنواع-netdb-الجديدة">أنواع NetDB الجديدة</a></li>
        <li><a href="#نوع-التوقيع-الجديد">نوع التوقيع الجديد</a></li>
        <li><a href="#justification-1">Justification</a></li>
        <li><a href="#usage">Usage</a></li>
        <li><a href="#رسالة-البحث-في-قاعدة-البيانات">رسالة البحث في قاعدة البيانات</a></li>
        <li><a href="#التغييرات">التغييرات</a></li>
        <li><a href="#رسالة-تخزين-قاعدة-البيانات">رسالة تخزين قاعدة البيانات</a></li>
        <li><a href="#التغييرات-1">التغييرات</a></li>
      </ul>
    </li>
    <li><a href="#private-key-file-changes-required">Private Key File Changes Required</a>
      <ul>
        <li><a href="#changes-2">Changes</a></li>
        <li><a href="#خيارات-i2cp">خيارات I2CP</a></li>
      </ul>
    </li>
    <li><a href="#streaming-changes-required">Streaming Changes Required</a>
      <ul>
        <li><a href="#إعداد-الجلسة">إعداد الجلسة</a></li>
        <li><a href="#رسالة-طلب-leaseset">رسالة طلب Leaseset</a></li>
      </ul>
    </li>
    <li><a href="#عنوان-ls2-القياسي">عنوان LS2 القياسي</a>
      <ul>
        <li><a href="#رسالة-طلب-leaseset-متغير">رسالة طلب LeaseSet متغير</a></li>
        <li><a href="#إنشاء-رسالة-leaseset2">إنشاء رسالة Leaseset2</a></li>
      </ul>
    </li>
    <li><a href="#sam-v3-changes-required">SAM V3 Changes Required</a>
      <ul>
        <li><a href="#التبرير-1">التبرير</a></li>
        <li><a href="#نوع-الرسالة">نوع الرسالة</a></li>
      </ul>
    </li>
    <li><a href="#bob-changes-required">BOB Changes Required</a></li>
    <li><a href="#publishing-migration-compatibility">Publishing, Migration, Compatibility</a></li>
    <li><a href="#rollout">Rollout</a></li>
    <li><a href="#أنواع-databaseentry-الجديدة">أنواع DatabaseEntry الجديدة</a></li>
  </ul>
</nav>
                    </div>
                </nav>
            </aside>
            

            
            <div class="proposal-main">
                <article class="proposal-content">
                    <h2 id="الحالة">الحالة</h2>
<p>أجزاء من هذا الاقتراح مكتملة، ومُنفذة في الإصدارين 0.9.38 و 0.9.39. مواصفات Common Structures و I2CP و I2NP والمواصفات الأخرى محدثة الآن لتعكس التغييرات المدعومة حالياً.</p>
<p>الأجزاء المكتملة لا تزال عرضة لمراجعات طفيفة. الأجزاء الأخرى من هذا الاقتراح لا تزال قيد التطوير وعرضة لمراجعات جوهرية.</p>
<p>البحث عن الخدمة (الأنواع 9 و 11) هي منخفضة الأولوية وغير مجدولة، وقد يتم فصلها إلى اقتراح منفصل.</p>
<h2 id="نظرة-عامة">نظرة عامة</h2>
<p>هذا تحديث وتجميع للاقتراحات الأربعة التالية:</p>
<ul>
<li>110 LS2</li>
<li>120 Meta LS2 للاستضافة المتعددة الضخمة</li>
<li>121 LS2 مشفر</li>
<li>122 البحث عن الخدمة غير المصادق عليه (anycasting)</li>
</ul>
<p>هذه المقترحات مستقلة في الغالب، ولكن من أجل الوضوح نقوم بتعريف واستخدام تنسيق موحد لعدة منها.</p>
<p>الاقتراحات التالية مترابطة إلى حد ما:</p>
<ul>
<li>140 Invisible Multihoming (غير متوافق مع هذا الاقتراح)</li>
<li>142 New Crypto Template (لتشفير متماثل جديد)</li>
<li>144 ECIES-X25519-AEAD-Ratchet</li>
<li>145 ECIES-P256</li>
<li>146 Red25519</li>
<li>148 EdDSA-BLAKE2b-Ed25519</li>
<li>149 B32 for Encrypted LS2</li>
<li>150 Garlic Farm Protocol</li>
<li>151 ECDSA Blinding</li>
</ul>
<h2 id="اقتراح">اقتراح</h2>
<p>هذا الاقتراح يحدد 5 أنواع جديدة من DatabaseEntry والعملية لتخزينها في واسترجاعها من قاعدة بيانات الشبكة، بالإضافة إلى طريقة توقيعها والتحقق من تلك التوقيعات.</p>
<h3 id="goals">Goals</h3>
<ul>
<li>متوافق مع الإصدارات السابقة</li>
<li>LS2 قابل للاستخدام مع الاستضافة المتعددة القديمة</li>
<li>لا تتطلب تشفير أو أساسيات جديدة للدعم</li>
<li>الحفاظ على فصل التشفير والتوقيع؛ دعم جميع الإصدارات الحالية والمستقبلية</li>
<li>تمكين مفاتيح التوقيع غير المتصلة الاختيارية</li>
<li>تقليل دقة الطوابع الزمنية لتقليل بصمات الأصابع</li>
<li>تمكين التشفير الجديد للوجهات</li>
<li>تمكين الاستضافة المتعددة الضخمة</li>
<li>إصلاح مشاكل متعددة مع LS المشفر الموجود</li>
<li>إخفاء اختياري لتقليل الرؤية بواسطة floodfills</li>
<li>المشفر يدعم كلاً من المفتاح الواحد والمفاتيح المتعددة القابلة للإلغاء</li>
<li>البحث عن الخدمة لتسهيل البحث عن outproxies، وتشغيل تطبيق DHT،
والاستخدامات الأخرى</li>
<li>عدم كسر أي شيء يعتمد على hashes الوجهة الثنائية 32-byte، مثل bittorrent</li>
<li>إضافة مرونة إلى leasesets عبر الخصائص، كما لدينا في routerinfos</li>
<li>وضع الطابع الزمني المنشور والانتهاء المتغير في الرأس، حتى يعمل حتى
إذا كان المحتوى مشفراً (لا تستمد الطابع الزمني من أقرب lease)</li>
<li>جميع الأنواع الجديدة تعيش في نفس مساحة DHT ونفس المواقع مثل leasesets الموجودة،
بحيث يمكن للمستخدمين الانتقال من LS القديم إلى LS2،
أو التغيير بين LS2 وMeta وEncrypted،
دون تغيير الوجهة أو hash</li>
<li>يمكن تحويل وجهة موجودة لاستخدام المفاتيح غير المتصلة،
أو العودة إلى المفاتيح المتصلة، دون تغيير الوجهة أو hash</li>
</ul>
<h3 id="non-goals--out-of-scope">Non-Goals / Out-of-scope</h3>
<ul>
<li>خوارزمية تدوير DHT جديدة أو توليد عشوائي مشترك</li>
<li>نوع التشفير الجديد المحدد ونظام التشفير من النهاية إلى النهاية
لاستخدام هذا النوع الجديد سيكون في اقتراح منفصل.
لا يتم تحديد أو مناقشة أي تشفير جديد هنا.</li>
<li>تشفير جديد لـ RIs أو بناء الأنفاق.
سيكون ذلك في اقتراح منفصل.</li>
<li>طرق تشفير ونقل واستقبال رسائل I2NP DLM / DSM / DSRM.
لا يتم التغيير.</li>
<li>كيفية توليد ودعم Meta، بما في ذلك التواصل بين الـ router في الخلفية، والإدارة، والتعافي من الأعطال، والتنسيق.
قد يتم إضافة الدعم إلى I2CP، أو i2pcontrol، أو بروتوكول جديد.
قد يتم توحيد هذا أو لا.</li>
<li>كيفية تنفيذ وإدارة الأنفاق طويلة الانتهاء فعلياً، أو إلغاء الأنفاق الموجودة.
هذا صعب للغاية، وبدونه، لا يمكن الحصول على إغلاق سلس معقول.</li>
<li>تغييرات نموذج التهديد</li>
<li>تنسيق التخزين غير المتصل، أو طرق تخزين/استرجاع/مشاركة البيانات.</li>
<li>تفاصيل التنفيذ لا تُناقش هنا وتُترك لكل مشروع.</li>
</ul>
<h3 id="justification">Justification</h3>
<p>LS2 يضيف حقول لتغيير نوع التشفير وللتغييرات المستقبلية في البروتوكول.</p>
<p>يعمل LS2 المشفر على إصلاح عدة مشاكل أمنية موجودة في LS المشفر الحالي من خلال استخدام التشفير غير المتماثل لمجموعة leases بأكملها.</p>
<p>يوفر Meta LS2 تعدد الاستضافة المرن والفعال والمؤثر واسع النطاق.</p>
<p>سجل الخدمة وقائمة الخدمة توفر خدمات anycast مثل البحث عن الأسماء وتهيئة DHT الأولية.</p>
<h3 id="الأهداف">الأهداف</h3>
<p>أرقام الأنواع تُستخدم في رسائل I2NP Database Lookup/Store Messages.</p>
<p>يشير عمود الطرف إلى الطرف إلى ما إذا كانت الاستعلامات/الاستجابات يتم إرسالها إلى Destination في Garlic Message.</p>
<p>الأنواع الموجودة:</p>
<table>
  <thead>
      <tr>
          <th>NetDB Data</th>
          <th>Lookup Type</th>
          <th>Store Type</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>any</td>
          <td>0</td>
          <td>any</td>
      </tr>
      <tr>
          <td>LS</td>
          <td>1</td>
          <td>1</td>
      </tr>
      <tr>
          <td>RI</td>
          <td>2</td>
          <td>0</td>
      </tr>
      <tr>
          <td>exploratory</td>
          <td>3</td>
          <td>DSRM</td>
      </tr>
      <tr>
          <td>أنواع جديدة:</td>
          <td></td>
          <td></td>
      </tr>
  </tbody>
</table>
<table>
  <thead>
      <tr>
          <th>NetDB Data</th>
          <th>Lookup Type</th>
          <th>Store Type</th>
          <th>Std. LS2 Header?</th>
          <th>Sent end-to-end?</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>LS2</td>
          <td>1</td>
          <td>3</td>
          <td>yes</td>
          <td>yes</td>
      </tr>
      <tr>
          <td>Encrypted LS2</td>
          <td>1</td>
          <td>5</td>
          <td>no</td>
          <td>no</td>
      </tr>
      <tr>
          <td>Meta LS2</td>
          <td>1</td>
          <td>7</td>
          <td>yes</td>
          <td>no</td>
      </tr>
      <tr>
          <td>Service Record</td>
          <td>n/a</td>
          <td>9</td>
          <td>yes</td>
          <td>no</td>
      </tr>
      <tr>
          <td>Service List</td>
          <td>4</td>
          <td>11</td>
          <td>no</td>
          <td>no</td>
      </tr>
  </tbody>
</table>
<h3 id="الأهداف-غير-المطلوبة--خارج-النطاق">الأهداف غير المطلوبة / خارج النطاق</h3>
<ul>
<li>
<p>أنواع البحث حالياً هي البتات 3-2 في رسالة البحث في قاعدة البيانات.
أي أنواع إضافية ستتطلب استخدام البت 4.</p>
</li>
<li>
<p>جميع أنواع المتاجر فردية لأن البتات العلوية في حقل نوع رسالة Database Store Message
يتم تجاهلها بواسطة الموجهات القديمة.
نفضل أن يفشل التحليل كـ LS بدلاً من RI مضغوط.</p>
</li>
<li>
<p>هل يجب أن يكون النوع صريحًا أم ضمنيًا أم لا هذا ولا ذاك في البيانات المشمولة بالتوقيع؟</p>
</li>
</ul>
<h3 id="مبرر">مبرر</h3>
<p>الأنواع 3 و 5 و 7 قد يتم إرجاعها استجابة لبحث leaseset قياسي (النوع 1). النوع 9 لا يتم إرجاعه أبداً استجابة للبحث. النوع 11 يتم إرجاعه استجابة لنوع بحث خدمة جديد (النوع 11).</p>
<p>يمكن إرسال النوع 3 فقط في رسالة Garlic من عميل إلى عميل.</p>
<h3 id="أنواع-بيانات-netdb">أنواع بيانات NetDB</h3>
<p>الأنواع 3 و 7 و 9 جميعها لها تنسيق مشترك::</p>
<p>رأس LS2 المعياري - كما هو محدد أدناه</p>
<p>الجزء الخاص بالنوع - كما هو محدد أدناه في كل جزء</p>
<p>التوقيع القياسي LS2:   - الطول كما هو مضمن في نوع التوقيع لمفتاح التوقيع</p>
<p>النوع 5 (المُشفر) لا يبدأ بـ Destination وله تنسيق مختلف. انظر أدناه.</p>
<p>النوع 11 (قائمة الخدمات) هو تجميع لعدة Service Records وله تنسيق مختلف. انظر أدناه.</p>
<h3 id="ملاحظات">ملاحظات</h3>
<p>سيتم تحديدها لاحقاً</p>
<h2 id="standard-ls2-header">Standard LS2 Header</h2>
<p>الأنواع 3 و 7 و 9 تستخدم رأس LS2 المعياري، المحدد أدناه:</p>
<h3 id="عملية-البحثالتخزين">عملية البحث/التخزين</h3>
<pre tabindex="0"><code>Standard LS2 Header:
  - Type (1 byte)
    Not actually in header, but part of data covered by signature.
    Take from field in Database Store Message.
  - Destination (387+ bytes)
  - Published timestamp (4 bytes, big endian, seconds since epoch, rolls over in 2106)
  - Expires (2 bytes, big endian) (offset from published timestamp in seconds, 18.2 hours max)
  - Flags (2 bytes)
    Bit order: 15 14 ... 3 2 1 0
    Bit 0: If 0, no offline keys; if 1, offline keys
    Bit 1: If 0, a standard published leaseset.
           If 1, an unpublished leaseset. Should not be flooded, published, or
           sent in response to a query. If this leaseset expires, do not query the
           netdb for a new one, unless bit 2 is set.
    Bit 2: If 0, a standard published leaseset.
           If 1, this unencrypted leaseset will be blinded and encrypted when published.
           If this leaseset expires, query the blinded location in the netdb for a new one.
           If this bit is set to 1, set bit 1 to 1 also.
           As of release 0.9.42.
    Bits 3-15: set to 0 for compatibility with future uses
  - If flag indicates offline keys, the offline signature section:
    Expires timestamp (4 bytes, big endian, seconds since epoch, rolls over in 2106)
    Transient sig type (2 bytes, big endian)
    Transient signing public key (length as implied by sig type)
    Signature of expires timestamp, transient sig type, and public key,
    by the destination public key,
    length as implied by destination public key sig type.
    This section can, and should, be generated offline.
</code></pre><h3 id="تنسيق">تنسيق</h3>
<ul>
<li>
<p>غير منشور/منشور: للاستخدام عند إرسال database store من نقطة إلى نقطة،
قد يرغب الـ router المرسل في الإشارة إلى أن هذا الـ leaseset يجب ألا يُرسل
إلى آخرين. نحن نستخدم حالياً heuristics للحفاظ على هذه الحالة.</p>
</li>
<li>
<p>منشور: يستبدل المنطق المعقد المطلوب لتحديد &lsquo;الإصدار&rsquo; الخاص بـ
leaseset. حالياً، الإصدار هو انتهاء صلاحية آخر lease منتهي الصلاحية،
ويجب على router النشر زيادة انتهاء الصلاحية هذا بما لا يقل عن 1ms عند
نشر leaseset يزيل فقط lease أقدم.</p>
</li>
<li>
<p>Expires: يسمح بانتهاء صلاحية إدخال netDb قبل انتهاء صلاحية آخر leaseset منتهي الصلاحية الخاص به. قد لا يكون مفيداً لـ LS2، حيث من المتوقع أن تبقى leasesets بحد أقصى 11 دقيقة لانتهاء الصلاحية، ولكن للأنواع الجديدة الأخرى، فهو ضروري (انظر Meta LS وService Record أدناه).</p>
</li>
<li>
<p>المفاتيح غير المتصلة اختيارية، لتقليل تعقيد التنفيذ الأولي/المطلوب.</p>
</li>
</ul>
<h3 id="اعتبارات-الخصوصيةالأمان">اعتبارات الخصوصية/الأمان</h3>
<ul>
<li>
<p>يمكن تقليل دقة الطوابع الزمنية أكثر (10 دقائق؟) ولكن سيتعين إضافة رقم الإصدار. قد يؤدي هذا إلى كسر multihoming، ما لم يكن لدينا تشفير يحافظ على الترتيب؟ ربما لا يمكننا الاستغناء عن الطوابع الزمنية تماماً.</p>
</li>
<li>
<p>البديل: طابع زمني 3 بايت (epoch / 10 دقائق)، إصدار 1-بايت، انتهاء الصلاحية 2-بايت</p>
</li>
<li>
<p>هل النوع صريح أم ضمني في البيانات / التوقيع؟ ثوابت &ldquo;Domain&rdquo; للتوقيع؟</p>
</li>
</ul>
<h3 id="notes">Notes</h3>
<ul>
<li>
<p>يجب على الـ routers عدم نشر LS أكثر من مرة واحدة في الثانية.
إذا فعلوا ذلك، يجب عليهم زيادة الطابع الزمني المنشور بشكل اصطناعي بمقدار 1
عن الـ LS المنشور سابقاً.</p>
</li>
<li>
<p>يمكن لتنفيذات الـ router تخزين المفاتيح المؤقتة والتوقيع في الذاكرة المؤقتة لتجنب التحقق في كل مرة. على وجه الخصوص، يمكن أن تستفيد الـ floodfills والـ routers في كلا طرفي الاتصالات طويلة المدى من هذا.</p>
</li>
<li>
<p>المفاتيح غير المتصلة والتوقيع مناسبان فقط للوجهات طويلة المدى،
أي الخوادم وليس العملاء.</p>
</li>
</ul>
<h2 id="new-databaseentry-types">New DatabaseEntry types</h2>
<h3 id="تنسيق-1">تنسيق</h3>
<p>التغييرات من LeaseSet الموجود:</p>
<ul>
<li>إضافة الطابع الزمني للنشر، الطابع الزمني لانتهاء الصلاحية، العلامات، والخصائص</li>
<li>إضافة نوع التشفير</li>
<li>إزالة مفتاح الإلغاء</li>
</ul>
<p>البحث باستخدام</p>
<pre><code>Standard LS flag (1)
</code></pre>
<p>متجر مع</p>
<pre><code>Standard LS2 type (3)
</code></pre>
<p>احفظ في</p>
<pre><code>Hash of destination
This hash is then used to generate the daily &quot;routing key&quot;, as in LS1
</code></pre>
<p>انتهاء الصلاحية النموذجي</p>
<pre><code>10 minutes, as in a regular LS.
</code></pre>
<p>نُشر بواسطة</p>
<pre><code>Destination
</code></pre>
<h3 id="التبرير">التبرير</h3>
<pre tabindex="0"><code>Standard LS2 Header as specified above

  Standard LS2 Type-Specific Part
  - Properties (Mapping as specified in common structures spec, 2 zero bytes if none)
  - Number of key sections to follow (1 byte, max TBD)
  - Key sections:
    - Encryption type (2 bytes, big endian)
    - Encryption key length (2 bytes, big endian)
      This is explicit, so floodfills can parse LS2 with unknown encryption types.
    - Encryption key (number of bytes specified)
  - Number of lease2s (1 byte)
  - Lease2s (40 bytes each)
    These are leases, but with a 4-byte instead of an 8-byte expiration,
    seconds since the epoch (rolls over in 2106)

  Standard LS2 Signature:
  - Signature
    If flag indicates offline keys, this is signed by the transient pubkey,
    otherwise, by the destination pubkey
    Length as implied by sig type of signing key
    The signature is of everything above.
</code></pre><h3 id="المشاكل">المشاكل</h3>
<ul>
<li>
<p>الخصائص: التوسع المستقبلي والمرونة.
يتم وضعها أولاً في حالة الحاجة إليها لتحليل البيانات المتبقية.</p>
</li>
<li>
<p>أزواج متعددة من نوع التشفير/المفتاح العام
لتسهيل الانتقال إلى أنواع تشفير جديدة. الطريقة الأخرى للقيام بذلك
هي نشر عدة leasesets، ربما باستخدام نفس الأنفاق،
كما نفعل الآن لوجهات DSA و EdDSA.
يمكن التعرف على نوع التشفير الواردة في النفق
باستخدام آلية session tag الموجودة،
و/أو فك التشفير التجريبي باستخدام كل مفتاح. أطوال الرسائل الواردة
قد توفر أيضاً دليلاً.</p>
</li>
</ul>
<h3 id="ملاحظات-1">ملاحظات</h3>
<p>تستمر هذه المقترحة في استخدام المفتاح العام في الـ leaseset لمفتاح التشفير من النهاية إلى النهاية، وتترك حقل المفتاح العام في الـ Destination غير مستخدم، كما هو الحال الآن. نوع التشفير غير محدد في شهادة مفتاح الـ Destination، وسيبقى 0.</p>
<p>البديل المرفوض هو تحديد نوع التشفير في شهادة مفتاح الوجهة، واستخدام المفتاح العام في الوجهة، وعدم استخدام المفتاح العام في leaseSet. لا نخطط للقيام بذلك.</p>
<p>فوائد LS2:</p>
<ul>
<li>موقع المفتاح العام الفعلي لا يتغير.</li>
<li>نوع التشفير، أو المفتاح العام، قد يتغير دون تغيير الوجهة.</li>
<li>يزيل حقل الإلغاء غير المستخدم</li>
<li>توافق أساسي مع أنواع DatabaseEntry الأخرى في هذا الاقتراح</li>
<li>يسمح بأنواع تشفير متعددة</li>
</ul>
<p>عيوب LS2:</p>
<ul>
<li>موقع المفتاح العام ونوع التشفير يختلف عن RouterInfo</li>
<li>يحتفظ بمفتاح عام غير مستخدم في leaseset</li>
<li>يتطلب تطبيقاً عبر الشبكة؛ كبديل، يمكن استخدام أنواع التشفير التجريبية،
إذا سمحت بذلك floodfills
(لكن انظر الاقتراحات ذات الصلة 136 و 137 حول دعم أنواع sig التجريبية).
الاقتراح البديل قد يكون أسهل للتطبيق والاختبار لأنواع التشفير التجريبية.</li>
</ul>
<h3 id="new-encryption-issues">New Encryption Issues</h3>
<p>بعض هذا خارج نطاق هذا الاقتراح، لكن نضع الملاحظات هنا الآن حيث لا يوجد لدينا اقتراح تشفير منفصل بعد. انظر أيضاً اقتراحات ECIES 144 و 145.</p>
<ul>
<li>
<p>يمثل نوع التشفير المزيج
من المنحنى وطول المفتاح ونظام التشفير من طرف إلى طرف،
بما في ذلك KDF و MAC، إن وجد.</p>
</li>
<li>
<p>لقد قمنا بتضمين حقل طول المفتاح، بحيث يكون LS2 قابلاً للتحليل والتحقق بواسطة floodfill حتى لأنواع التشفير غير المعروفة.</p>
</li>
<li>
<p>نوع التشفير الجديد الأول المقترح سيكون على الأرجح
ECIES/X25519. كيفية استخدامه من النهاية إلى النهاية
(إما نسخة معدلة قليلاً من ElGamal/AES+SessionTag
أو شيء جديد تماماً، مثل ChaCha/Poly) سيتم تحديده
في اقتراح واحد أو أكثر منفصل.
انظر أيضاً اقتراحي ECIES رقم 144 و145.</p>
</li>
</ul>
<h3 id="leaseset-2">LeaseSet 2</h3>
<ul>
<li>
<p>انتهاء الصلاحية 8-byte في leases تم تغييره إلى 4 bytes.</p>
</li>
<li>
<p>إذا قمنا بتنفيذ الإلغاء في أي وقت، يمكننا القيام بذلك باستخدام حقل انتهاء صلاحية بقيمة صفر،
أو صفر leases، أو كليهما. لا حاجة لمفتاح إلغاء منفصل.</p>
</li>
<li>
<p>مفاتيح التشفير مرتبة حسب تفضيل الخادم، الأكثر تفضيلاً أولاً.
السلوك الافتراضي للعميل هو اختيار المفتاح الأول الذي يحتوي على
نوع تشفير مدعوم. قد تستخدم العملاء خوارزميات اختيار أخرى
بناءً على دعم التشفير والأداء النسبي وعوامل أخرى.</p>
</li>
</ul>
<h3 id="تنسيق-2">تنسيق</h3>
<p>الأهداف:</p>
<ul>
<li>إضافة التعمية (blinding)</li>
<li>السماح بأنواع متعددة من التوقيعات</li>
<li>عدم الحاجة إلى أي عمليات تشفير أساسية جديدة</li>
<li>تشفير اختياري لكل مستقبل، قابل للإلغاء</li>
<li>دعم تشفير Standard LS2 و Meta LS2 فقط</li>
</ul>
<p>الـ LS2 المشفر لا يتم إرساله أبداً في رسالة garlic من نقطة إلى أخرى. استخدم الـ LS2 القياسي كما هو موضح أعلاه.</p>
<p>التغييرات من LeaseSet المشفر الموجود:</p>
<ul>
<li>تشفير كامل الرسالة للأمان</li>
<li>التشفير الآمن، وليس باستخدام AES فقط.</li>
<li>التشفير لكل مستقبِل</li>
</ul>
<p>البحث باستخدام</p>
<pre><code>Standard LS flag (1)
</code></pre>
<p>احفظ مع</p>
<pre><code>Encrypted LS2 type (5)
</code></pre>
<p>احفظ في</p>
<pre><code>Hash of blinded sig type and blinded public key
Two byte sig type (big endian, e.g. 0x000b) || blinded public key
This hash is then used to generate the daily &quot;routing key&quot;, as in LS1
</code></pre>
<p>انتهاء الصلاحية المعتاد</p>
<pre><code>10 minutes, as in a regular LS, or hours, as in a meta LS.
</code></pre>
<p>نُشر بواسطة</p>
<pre><code>Destination
</code></pre>
<h3 id="المبرر">المبرر</h3>
<p>نحدد الوظائف التالية المقابلة للكتل البنائية التشفيرية المستخدمة لـ LS2 المشفرة:</p>
<p>CSRNG(n)</p>
<pre><code>n-byte output from a cryptographically-secure random number generator.

In addition to the requirement of CSRNG being cryptographically-secure (and thus
suitable for generating key material), it MUST be safe
for some n-byte output to be used for key material when the byte sequences immediately
preceding and following it are exposed on the network (such as in a salt, or encrypted
padding). Implementations that rely on a potentially-untrustworthy source should hash
any output that is to be exposed on the network. See [PRNG references](http://projectbullrun.org/dual-ec/ext-rand.html) and [Tor dev discussion](https://lists.torproject.org/pipermail/tor-dev/2015-November/009954.html).
</code></pre>
<p>H(p, d)</p>
<pre><code>SHA-256 hash function that takes a personalization string p and data d, and
produces an output of length 32 bytes.

Use SHA-256 as follows::

    H(p, d) := SHA-256(p || d)
</code></pre>
<p>STREAM</p>
<pre><code>The ChaCha20 stream cipher as specified in [RFC 7539 Section 2.4](https://tools.ietf.org/html/rfc7539#section-2.4), with the initial counter
set to 1. S_KEY_LEN = 32 and S_IV_LEN = 12.

ENCRYPT(k, iv, plaintext)
    Encrypts plaintext using the cipher key k, and nonce iv which MUST be unique for
    the key k. Returns a ciphertext that is the same size as the plaintext.

    The entire ciphertext must be indistinguishable from random if the key is secret.

DECRYPT(k, iv, ciphertext)
    Decrypts ciphertext using the cipher key k, and nonce iv. Returns the plaintext.
</code></pre>
<p>SIG</p>
<pre><code>The RedDSA signature scheme (corresponding to SigType 11) with key blinding.
It has the following functions:

DERIVE_PUBLIC(privkey)
    Returns the public key corresponding to the given private key.

SIGN(privkey, m)
    Returns a signature by the private key privkey over the given message m.

VERIFY(pubkey, m, sig)
    Verifies the signature sig against the public key pubkey and message m. Returns
    true if the signature is valid, false otherwise.

It must also support the following key blinding operations:

GENERATE_ALPHA(data, secret)
    Generate alpha for those who know the data and an optional secret.
    The result must be identically distributed as the private keys.

BLIND_PRIVKEY(privkey, alpha)
    Blinds a private key, using a secret alpha.

BLIND_PUBKEY(pubkey, alpha)
    Blinds a public key, using a secret alpha.
    For a given keypair (privkey, pubkey) the following relationship holds::

        BLIND_PUBKEY(pubkey, alpha) ==
        DERIVE_PUBLIC(BLIND_PRIVKEY(privkey, alpha))
</code></pre>
<p>DH</p>
<pre><code>X25519 public key agreement system. Private keys of 32 bytes, public keys of 32
bytes, produces outputs of 32 bytes. It has the following
functions:

GENERATE_PRIVATE()
    Generates a new private key.

DERIVE_PUBLIC(privkey)
    Returns the public key corresponding to the given private key.

DH(privkey, pubkey)
    Generates a shared secret from the given private and public keys.
</code></pre>
<p>HKDF(salt, ikm, info, n)</p>
<pre><code>A cryptographic key derivation function which takes some input key material ikm (which
should have good entropy but is not required to be a uniformly random string), a salt
of length 32 bytes, and a context-specific 'info' value, and produces an output
of n bytes suitable for use as key material.

Use HKDF as specified in [RFC 5869](https://tools.ietf.org/html/rfc5869), using the HMAC hash function SHA-256
as specified in [RFC 2104](https://tools.ietf.org/html/rfc2104). This means that SALT_LEN is 32 bytes max.
</code></pre>
<h3 id="المناقشة">المناقشة</h3>
<p>يتكون تنسيق LS2 المشفر من ثلاث طبقات متداخلة:</p>
<ul>
<li>طبقة خارجية تحتوي على المعلومات النصية العادية اللازمة للتخزين والاسترجاع.</li>
<li>طبقة وسطى تتعامل مع مصادقة العميل.</li>
<li>طبقة داخلية تحتوي على بيانات LS2 الفعلية.</li>
</ul>
<p>التنسيق الإجمالي يبدو كما يلي::</p>
<pre><code>Layer 0 data + Enc(layer 1 data + Enc(layer 2 data)) + Signature
</code></pre>
<p>ملاحظة أن LS2 المشفر مخفي. الوجهة ليست في الرأس. موقع تخزين DHT هو SHA-256(نوع التوقيع || المفتاح العام المخفي)، ويتم تدويره يومياً.</p>
<p>لا يستخدم رأس LS2 القياسي المحدد أعلاه.</p>
<h4 id="layer-0-outer">Layer 0 (outer)</h4>
<p>النوع</p>
<pre><code>1 byte

Not actually in header, but part of data covered by signature.
Take from field in Database Store Message.
</code></pre>
<p>نوع توقيع المفتاح العام المُعمى</p>
<pre><code>2 bytes, big endian
This will always be type 11, identifying a Red25519 blinded key.
</code></pre>
<p>مفتاح عام مُعمّى</p>
<pre><code>Length as implied by sig type
</code></pre>
<p>الطابع الزمني للنشر</p>
<pre><code>4 bytes, big endian

Seconds since epoch, rolls over in 2106
</code></pre>
<p>ينتهي في</p>
<pre><code>2 bytes, big endian

Offset from published timestamp in seconds, 18.2 hours max
</code></pre>
<p>الأعلام</p>
<pre><code>2 bytes

Bit order: 15 14 ... 3 2 1 0

Bit 0: If 0, no offline keys; if 1, offline keys

Other bits: set to 0 for compatibility with future uses
</code></pre>
<p>بيانات المفاتيح المؤقتة</p>
<pre><code>Present if flag indicates offline keys

Expires timestamp
    4 bytes, big endian

    Seconds since epoch, rolls over in 2106

Transient sig type
    2 bytes, big endian

Transient signing public key
    Length as implied by sig type

Signature
    Length as implied by blinded public key sig type

    Over expires timestamp, transient sig type, and transient public key.

    Verified with the blinded public key.
</code></pre>
<p>lenOuterCiphertext</p>
<pre><code>2 bytes, big endian
</code></pre>
<p>outerCiphertext</p>
<pre><code>lenOuterCiphertext bytes

Encrypted layer 1 data. See below for key derivation and encryption algorithms.
</code></pre>
<p>التوقيع</p>
<pre><code>Length as implied by sig type of the signing key used

The signature is of everything above.

If the flag indicates offline keys, the signature is verified with the transient
public key. Otherwise, the signature is verified with the blinded public key.
</code></pre>
<h4 id="layer-1-middle">Layer 1 (middle)</h4>
<p>الأعلام</p>
<pre><code>1 byte

Bit order: 76543210

Bit 0: 0 for everybody, 1 for per-client, auth section to follow

Bits 3-1: Authentication scheme, only if bit 0 is set to 1 for per-client, otherwise 000
          000: DH client authentication (or no per-client authentication)
          001: PSK client authentication

Bits 7-4: Unused, set to 0 for future compatibility
</code></pre>
<p>بيانات مصادقة عميل DH</p>
<pre><code>Present if flag bit 0 is set to 1 and flag bits 3-1 are set to 000.

ephemeralPublicKey
    32 bytes

clients
    2 bytes, big endian

    Number of authClient entries to follow, 40 bytes each

authClient
    Authorization data for a single client.
    See below for the per-client authorization algorithm.

    clientID_i
        8 bytes

    clientCookie_i
        32 bytes
</code></pre>
<p>بيانات مصادقة عميل PSK</p>
<pre><code>Present if flag bit 0 is set to 1 and flag bits 3-1 are set to 001.

authSalt
    32 bytes

clients
    2 bytes, big endian

    Number of authClient entries to follow, 40 bytes each

authClient
    Authorization data for a single client.
    See below for the per-client authorization algorithm.

    clientID_i
        8 bytes

    clientCookie_i
        32 bytes
</code></pre>
<p>innerCiphertext</p>
<pre><code>Length implied by lenOuterCiphertext (whatever data remains)

Encrypted layer 2 data. See below for key derivation and encryption algorithms.
</code></pre>
<h4 id="layer-2-inner">Layer 2 (inner)</h4>
<p>النوع</p>
<pre><code>1 byte

Either 3 (LS2) or 7 (Meta LS2)
</code></pre>
<p>البيانات</p>
<pre><code>LeaseSet2 data for the given type.

Includes the header and signature.
</code></pre>
<h3 id="مشاكل-التشفير-الجديدة">مشاكل التشفير الجديدة</h3>
<p>نستخدم المخطط التالي لإخفاء المفاتيح، بناءً على Ed25519 و<a href="https://github.com/zcash/zips/tree/master/protocol/protocol.pdf">ZCash RedDSA</a>
. توقيعات Re25519 تتم عبر منحنى Ed25519، باستخدام SHA-512 للهاش.</p>
<p>نحن لا نستخدم <a href="https://spec.torproject.org/rend-spec-v3">Tor&rsquo;s rend-spec-v3.txt appendix A.2</a>
، والذي له أهداف تصميم مماثلة، لأن المفاتيح العامة المعماة الخاصة به قد تكون خارج المجموعة الفرعية ذات الترتيب الأولي، مما يحمل آثارًا أمنية غير معروفة.</p>
<h4 id="goals-1">Goals</h4>
<ul>
<li>مفتاح التوقيع العام في الوجهة غير المُعمّاة يجب أن يكون
Ed25519 (نوع التوقيع 7) أو Red25519 (نوع التوقيع 11)؛
لا يتم دعم أنواع توقيعات أخرى</li>
<li>إذا كان مفتاح التوقيع العام غير متصل، فإن مفتاح التوقيع العام المؤقت يجب أن يكون Ed25519 أيضاً</li>
<li>التعمية حاسوبياً بسيطة</li>
<li>استخدام العمليات التشفيرية الموجودة</li>
<li>المفاتيح العامة المُعمّاة لا يمكن إلغاء تعميتها</li>
<li>المفاتيح العامة المُعمّاة يجب أن تكون على منحنى Ed25519 والمجموعة الفرعية ذات الترتيب الأولي</li>
<li>يجب معرفة مفتاح التوقيع العام للوجهة
(الوجهة الكاملة غير مطلوبة) لاشتقاق المفتاح العام المُعمّى</li>
<li>اختيارياً توفير سر إضافي مطلوب لاشتقاق المفتاح العام المُعمّى</li>
</ul>
<h4 id="security">Security</h4>
<p>أمان مخطط التعمية (blinding scheme) يتطلب أن يكون توزيع alpha نفس توزيع المفاتيح الخاصة غير المعماة. ومع ذلك، عندما نقوم بتعمية مفتاح Ed25519 خاص (sig type 7) إلى مفتاح Red25519 خاص (sig type 11)، يكون التوزيع مختلفاً. لتلبية متطلبات <a href="https://github.com/zcash/zips/tree/master/protocol/protocol.pdf">zcash section 4.1.6.1</a>
، يجب استخدام Red25519 (sig type 11) للمفاتيح غير المعماة أيضاً، بحيث &ldquo;لا يكشف الجمع بين مفتاح عام معاد العشوائية والتوقيع(ات) تحت ذلك المفتاح عن المفتاح الذي تمت إعادة عشوائيته منه.&rdquo; نحن نسمح بالنوع 7 للوجهات الموجودة، لكننا نوصي بالنوع 11 للوجهات الجديدة التي ستكون مشفرة.</p>
<h4 id="definitions">Definitions</h4>
<p>ب</p>
<pre><code>The Ed25519 base point (generator) 2^255 - 19 as in [Ed25519](http://cr.yp.to/papers.html#ed25519)
</code></pre>
<p>L</p>
<pre><code>The Ed25519 order 2^252 + 27742317777372353535851937790883648493
as in [Ed25519](http://cr.yp.to/papers.html#ed25519)
</code></pre>
<p>DERIVE_PUBLIC(a)</p>
<pre><code>Convert a private key to public, as in Ed25519 (mulitply by G)
</code></pre>
<p>alpha</p>
<pre><code>A 32-byte random number known to those who know the destination.
</code></pre>
<p>GENERATE_ALPHA(destination, date, secret)</p>
<pre><code>Generate alpha for the current date, for those who know the destination and the secret.
The result must be identically distributed as Ed25519 private keys.
</code></pre>
<p>a</p>
<pre><code>The unblinded 32-byte EdDSA or RedDSA signing private key used to sign the destination
</code></pre>
<p>أ</p>
<pre><code>The unblinded 32-byte EdDSA or RedDSA signing public key in the destination,
= DERIVE_PUBLIC(a), as in Ed25519
</code></pre>
<p>أ&rsquo;</p>
<pre><code>The blinded 32-byte EdDSA signing private key used to sign the encrypted leaseset
This is a valid EdDSA private key.
</code></pre>
<p>A'</p>
<pre><code>The blinded 32-byte EdDSA signing public key in the Destination,
may be generated with DERIVE_PUBLIC(a'), or from A and alpha.
This is a valid EdDSA public key, on the curve and on the prime-order subgroup.
</code></pre>
<p>LEOS2IP(x)</p>
<pre><code>Flip the order of the input bytes to little-endian
</code></pre>
<p>H*(x)</p>
<pre><code>32 bytes = (LEOS2IP(SHA512(x))) mod B, same as in Ed25519 hash-and-reduce
</code></pre>
<h4 id="blinding-calculations">Blinding Calculations</h4>
<p>يجب إنشاء secret alpha وblinded keys جديدة كل يوم (UTC). يتم حساب الـ secret alpha والـ blinded keys كما يلي.</p>
<p>GENERATE_ALPHA(destination, date, secret)، لجميع الأطراف:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>// GENERATE_ALPHA(destination, date, secret)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  // secret is optional, else zero-length
</span></span><span style="display:flex;"><span>  A = destination&#39;s signing public key
</span></span><span style="display:flex;"><span>  stA = signature type of A, 2 bytes big endian (0x0007 or 0x000b)
</span></span><span style="display:flex;"><span>  stA&#39; = signature type of blinded public key A&#39;, 2 bytes big endian (0x000b)
</span></span><span style="display:flex;"><span>  keydata = A || stA || stA&#39;
</span></span><span style="display:flex;"><span>  datestring = 8 bytes ASCII YYYYMMDD from the current date UTC
</span></span><span style="display:flex;"><span>  secret = UTF-8 encoded string
</span></span><span style="display:flex;"><span>  seed = HKDF(H(&#34;I2PGenerateAlpha&#34;, keydata), datestring || secret, &#34;i2pblinding1&#34;, 64)
</span></span><span style="display:flex;"><span>  // treat seed as a 64 byte little-endian value
</span></span><span style="display:flex;"><span>  alpha = seed mod L
</span></span></code></pre></div><p>BLIND_PRIVKEY()، لمالك النشر الخاص بـ leaseset:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>// BLIND_PRIVKEY()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  alpha = GENERATE_ALPHA(destination, date, secret)
</span></span><span style="display:flex;"><span>  // If for a Ed25519 private key (type 7)
</span></span><span style="display:flex;"><span>  seed = destination&#39;s signing private key
</span></span><span style="display:flex;"><span>  a = left half of SHA512(seed) and clamped as usual for Ed25519
</span></span><span style="display:flex;"><span>  // else, for a Red25519 private key (type 11)
</span></span><span style="display:flex;"><span>  a = destination&#39;s signing private key
</span></span><span style="display:flex;"><span>  // Addition using scalar arithmentic
</span></span><span style="display:flex;"><span>  blinded signing private key = a&#39; = BLIND_PRIVKEY(a, alpha) = (a + alpha) mod L
</span></span><span style="display:flex;"><span>  blinded signing public key = A&#39; = DERIVE_PUBLIC(a&#39;)
</span></span></code></pre></div><p>BLIND_PUBKEY()، للعملاء الذين يسترجعون الـ leaseset:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>// BLIND_PUBKEY()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  alpha = GENERATE_ALPHA(destination, date, secret)
</span></span><span style="display:flex;"><span>  A = destination&#39;s signing public key
</span></span><span style="display:flex;"><span>  // Addition using group elements (points on the curve)
</span></span><span style="display:flex;"><span>  blinded public key = A&#39; = BLIND_PUBKEY(A, alpha) = A + DERIVE_PUBLIC(alpha)
</span></span></code></pre></div><p>كلا الطريقتين لحساب A&rsquo; تعطيان نفس النتيجة، كما هو مطلوب.</p>
<h4 id="signing">Signing</h4>
<p>يتم توقيع الـ leaseset غير المُعمّى بواسطة المفتاح الخاص للتوقيع Ed25519 أو Red25519 غير المُعمّى ويتم التحقق منه باستخدام المفتاح العام للتوقيع Ed25519 أو Red25519 غير المُعمّى (أنواع التوقيع 7 أو 11) كالمعتاد.</p>
<p>إذا كان المفتاح العام للتوقيع غير متصل، يتم توقيع الـ leaseset غير المخفي بواسطة المفتاح الخاص المؤقت للتوقيع Ed25519 أو Red25519 غير المخفي والتحقق منه باستخدام المفتاح العام المؤقت للتوقيع Ed25519 أو Red25519 غير المخفي (أنواع التوقيع 7 أو 11) كالمعتاد. انظر أدناه للحصول على ملاحظات إضافية حول المفاتيح غير المتصلة للـ leaseset المشفرة.</p>
<p>لتوقيع مجموعة الإيجار المشفرة (encrypted leaseset)، نستخدم Red25519، المبني على <a href="https://github.com/zcash/zips/tree/master/protocol/protocol.pdf">RedDSA</a>
 للتوقيع والتحقق باستخدام مفاتيح معماة (blinded keys). توقيعات Red25519 تتم عبر منحنى Ed25519، باستخدام SHA-512 للتشفير التجميعي (hash).</p>
<p>Red25519 مطابق تماماً لمعيار Ed25519 باستثناء ما هو محدد أدناه.</p>
<h4 id="signverify-calculations">Sign/Verify Calculations</h4>
<p>يستخدم الجزء الخارجي من leaseset المشفر مفاتيح وتوقيعات Red25519.</p>
<p>Red25519 مطابق تقريباً لـ Ed25519. هناك اختلافان:</p>
<p>مفاتيح Red25519 الخاصة يتم توليدها من أرقام عشوائية ثم يجب تقليلها mod L، حيث L معرّف أعلاه. مفاتيح Ed25519 الخاصة يتم توليدها من أرقام عشوائية ثم يتم &ldquo;تثبيتها&rdquo; باستخدام القناع البتي للبايتات 0 و 31. هذا لا يتم فعله لـ Red25519. الدالتان <code>GENERATE_ALPHA()</code> و <code>BLIND_PRIVKEY()</code> المعرّفتان أعلاه تولّدان مفاتيح Red25519 خاصة صحيحة باستخدام mod L.</p>
<p>في Red25519، حساب r للتوقيع يستخدم بيانات عشوائية إضافية، ويستخدم قيمة المفتاح العام بدلاً من hash المفتاح الخاص. بسبب البيانات العشوائية، كل توقيع Red25519 مختلف، حتى عند توقيع نفس البيانات بنفس المفتاح.</p>
<p>التوقيع:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>T = 80 random bytes
</span></span><span style="display:flex;"><span>  r = H*(T || publickey || message)
</span></span><span style="display:flex;"><span>  // rest is the same as in Ed25519
</span></span></code></pre></div><p>التحقق:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>// same as in Ed25519
</span></span></code></pre></div><h3 id="ملاحظات-2">ملاحظات</h3>
<h4 id="derivation-of-subcredentials">Derivation of subcredentials</h4>
<p>كجزء من عملية الإخفاء، نحتاج للتأكد من أن LS2 المشفر يمكن فك تشفيره فقط من قبل شخص يعرف مفتاح التوقيع العام المقابل لـ Destination. لا يتطلب الأمر Destination كاملاً. لتحقيق هذا، نشتق credential من مفتاح التوقيع العام:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>A = destination&#39;s signing public key
</span></span><span style="display:flex;"><span>  stA = signature type of A, 2 bytes big endian (0x0007 or 0x000b)
</span></span><span style="display:flex;"><span>  stA&#39; = signature type of A&#39;, 2 bytes big endian (0x000b)
</span></span><span style="display:flex;"><span>  keydata = A || stA || stA&#39;
</span></span><span style="display:flex;"><span>  credential = H(&#34;credential&#34;, keydata)
</span></span></code></pre></div><p>سلسلة التخصيص تضمن أن الاعتماد لا يتصادم مع أي hash مستخدم كمفتاح بحث DHT، مثل hash الوجهة العادي.</p>
<p>بالنسبة لمفتاح أعمى معين، يمكننا حينها اشتقاق subcredential:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>subcredential = H(&#34;subcredential&#34;, credential || blindedPublicKey)
</span></span></code></pre></div><p>يتم تضمين الـ subcredential في عمليات اشتقاق المفاتيح أدناه، مما يربط تلك المفاتيح بمعرفة مفتاح التوقيع العام الخاص بالـ Destination.</p>
<h4 id="layer-1-encryption">Layer 1 encryption</h4>
<p>أولاً، يتم إعداد المدخل لعملية اشتقاق المفتاح:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>outerInput = subcredential || publishedTimestamp
</span></span></code></pre></div><p>بعد ذلك، يتم إنشاء salt عشوائي:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>outerSalt = CSRNG(32)
</span></span></code></pre></div><p>ثم يتم اشتقاق المفتاح المستخدم لتشفير الطبقة 1:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>keys = HKDF(outerSalt, outerInput, &#34;ELS2_L1K&#34;, 44)
</span></span><span style="display:flex;"><span>  outerKey = keys[0:31]
</span></span><span style="display:flex;"><span>  outerIV = keys[32:43]
</span></span></code></pre></div><p>أخيراً، يتم تشفير وتسلسل النص الخام للطبقة 1:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>outerCiphertext = outerSalt || ENCRYPT(outerKey, outerIV, outerPlaintext)
</span></span></code></pre></div><h4 id="layer-1-decryption">Layer 1 decryption</h4>
<p>يتم تحليل الملح (salt) من النص المشفر للطبقة الأولى:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>outerSalt = outerCiphertext[0:31]
</span></span></code></pre></div><p>ثم يتم اشتقاق المفتاح المستخدم لتشفير الطبقة 1:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>outerInput = subcredential || publishedTimestamp
</span></span><span style="display:flex;"><span>  keys = HKDF(outerSalt, outerInput, &#34;ELS2_L1K&#34;, 44)
</span></span><span style="display:flex;"><span>  outerKey = keys[0:31]
</span></span><span style="display:flex;"><span>  outerIV = keys[32:43]
</span></span></code></pre></div><p>أخيراً، يتم فك تشفير النص المشفر للطبقة 1:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>outerPlaintext = DECRYPT(outerKey, outerIV, outerCiphertext[32:end])
</span></span></code></pre></div><h4 id="layer-2-encryption">Layer 2 encryption</h4>
<p>عندما يتم تفعيل تفويض العميل، يتم حساب <code>authCookie</code> كما هو موضح أدناه. عندما يتم تعطيل تفويض العميل، فإن <code>authCookie</code> هو مصفوفة البايت بطول صفر.</p>
<p>يتم التشفير بطريقة مشابهة للطبقة 1:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>innerInput = authCookie || subcredential || publishedTimestamp
</span></span><span style="display:flex;"><span>  innerSalt = CSRNG(32)
</span></span><span style="display:flex;"><span>  keys = HKDF(innerSalt, innerInput, &#34;ELS2_L2K&#34;, 44)
</span></span><span style="display:flex;"><span>  innerKey = keys[0:31]
</span></span><span style="display:flex;"><span>  innerIV = keys[32:43]
</span></span><span style="display:flex;"><span>  innerCiphertext = innerSalt || ENCRYPT(innerKey, innerIV, innerPlaintext)
</span></span></code></pre></div><h4 id="layer-2-decryption">Layer 2 decryption</h4>
<p>عندما يتم تمكين تفويض العميل، يتم حساب <code>authCookie</code> كما هو موضح أدناه. عندما يتم تعطيل تفويض العميل، فإن <code>authCookie</code> هو مصفوفة البايتات ذات الطول الصفري.</p>
<p>فك التشفير يتم بطريقة مشابهة للطبقة 1:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>innerInput = authCookie || subcredential || publishedTimestamp
</span></span><span style="display:flex;"><span>  innerSalt = innerCiphertext[0:31]
</span></span><span style="display:flex;"><span>  keys = HKDF(innerSalt, innerInput, &#34;ELS2_L2K&#34;, 44)
</span></span><span style="display:flex;"><span>  innerKey = keys[0:31]
</span></span><span style="display:flex;"><span>  innerIV = keys[32:43]
</span></span><span style="display:flex;"><span>  innerPlaintext = DECRYPT(innerKey, innerIV, innerCiphertext[32:end])
</span></span></code></pre></div><h3 id="ls2-مشفرة">LS2 مشفرة</h3>
<p>عندما يتم تمكين تخويل العميل لوجهة معينة، يحتفظ الخادم بقائمة من العملاء المخولين لفك تشفير بيانات LS2 المشفرة. تعتمد البيانات المخزنة لكل عميل على آلية التخويل، وتتضمن شكلاً من أشكال المواد المفتاحية التي ينشئها كل عميل ويرسلها إلى الخادم عبر آلية آمنة خارج النطاق.</p>
<p>هناك بديلان لتنفيذ التصريح لكل عميل:</p>
<h4 id="dh-client-authorization">DH client authorization</h4>
<p>كل عميل ينشئ زوج مفاتيح DH <code>[csk_i, cpk_i]</code>، ويرسل المفتاح العام <code>cpk_i</code> إلى الخادم.</p>
<p>معالجة الخادم
^^^^^^^^^^^^^^^^^</p>
<p>ينشئ الخادم <code>authCookie</code> جديد وزوج مفاتيح DH مؤقت:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>authCookie = CSRNG(32)
</span></span><span style="display:flex;"><span>  esk = GENERATE_PRIVATE()
</span></span><span style="display:flex;"><span>  epk = DERIVE_PUBLIC(esk)
</span></span></code></pre></div><p>ثم لكل عميل مُخوَّل، يقوم الخادم بتشفير <code>authCookie</code> إلى مفتاحه العام:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>sharedSecret = DH(esk, cpk_i)
</span></span><span style="display:flex;"><span>  authInput = sharedSecret || cpk_i || subcredential || publishedTimestamp
</span></span><span style="display:flex;"><span>  okm = HKDF(epk, authInput, &#34;ELS2_XCA&#34;, 52)
</span></span><span style="display:flex;"><span>  clientKey_i = okm[0:31]
</span></span><span style="display:flex;"><span>  clientIV_i = okm[32:43]
</span></span><span style="display:flex;"><span>  clientID_i = okm[44:51]
</span></span><span style="display:flex;"><span>  clientCookie_i = ENCRYPT(clientKey_i, clientIV_i, authCookie)
</span></span></code></pre></div><p>يضع الخادم كل مجموعة <code>[clientID_i, clientCookie_i]</code> في الطبقة 1 من ال LS2 المشفر، بالإضافة إلى <code>epk</code>.</p>
<p>معالجة العميل
^^^^^^^^^^^^^^^^^</p>
<p>يستخدم العميل مفتاحه الخاص لاشتقاق معرف العميل المتوقع <code>clientID_i</code> ومفتاح التشفير <code>clientKey_i</code> ومتجه التهيئة للتشفير <code>clientIV_i</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>sharedSecret = DH(csk_i, epk)
</span></span><span style="display:flex;"><span>  authInput = sharedSecret || cpk_i || subcredential || publishedTimestamp
</span></span><span style="display:flex;"><span>  okm = HKDF(epk, authInput, &#34;ELS2_XCA&#34;, 52)
</span></span><span style="display:flex;"><span>  clientKey_i = okm[0:31]
</span></span><span style="display:flex;"><span>  clientIV_i = okm[32:43]
</span></span><span style="display:flex;"><span>  clientID_i = okm[44:51]
</span></span></code></pre></div><p>ثم يبحث العميل في بيانات التفويض للطبقة 1 عن إدخال يحتوي على <code>clientID_i</code>. إذا وُجد إدخال مطابق، يقوم العميل بفك تشفيره للحصول على <code>authCookie</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>authCookie = DECRYPT(clientKey_i, clientIV_i, clientCookie_i)
</span></span></code></pre></div><h4 id="pre-shared-key-client-authorization">Pre-shared key client authorization</h4>
<p>كل عميل ينشئ مفتاحًا سريًا بحجم 32 بايت <code>psk_i</code>، ويرسله إلى الخادم. بدلاً من ذلك، يمكن للخادم أن ينشئ المفتاح السري، ويرسله إلى عميل واحد أو أكثر.</p>
<p>معالجة الخادم
^^^^^^^^^^^^^^^^^</p>
<p>يولد الخادم <code>authCookie</code> وملح جديدين:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>authCookie = CSRNG(32)
</span></span><span style="display:flex;"><span>  authSalt = CSRNG(32)
</span></span></code></pre></div><p>ثم لكل عميل مُصرح له، يقوم الخادم بتشفير <code>authCookie</code> باستخدام مفتاحه المُشارك مسبقاً:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>authInput = psk_i || subcredential || publishedTimestamp
</span></span><span style="display:flex;"><span>  okm = HKDF(authSalt, authInput, &#34;ELS2PSKA&#34;, 52)
</span></span><span style="display:flex;"><span>  clientKey_i = okm[0:31]
</span></span><span style="display:flex;"><span>  clientIV_i = okm[32:43]
</span></span><span style="display:flex;"><span>  clientID_i = okm[44:51]
</span></span><span style="display:flex;"><span>  clientCookie_i = ENCRYPT(clientKey_i, clientIV_i, authCookie)
</span></span></code></pre></div><p>يضع الخادم كل tuple من <code>[clientID_i, clientCookie_i]</code> في الطبقة 1 من LS2 المشفر، مع <code>authSalt</code>.</p>
<p>معالجة العميل
^^^^^^^^^^^^^^^^^</p>
<p>يستخدم العميل مفتاحه المشترك مسبقاً لاشتقاق معرف العميل المتوقع <code>clientID_i</code> ومفتاح التشفير <code>clientKey_i</code> ومتجه التهيئة للتشفير <code>clientIV_i</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>authInput = psk_i || subcredential || publishedTimestamp
</span></span><span style="display:flex;"><span>  okm = HKDF(authSalt, authInput, &#34;ELS2PSKA&#34;, 52)
</span></span><span style="display:flex;"><span>  clientKey_i = okm[0:31]
</span></span><span style="display:flex;"><span>  clientIV_i = okm[32:43]
</span></span><span style="display:flex;"><span>  clientID_i = okm[44:51]
</span></span></code></pre></div><p>ثم يبحث العميل في بيانات التفويض للطبقة الأولى عن إدخال يحتوي على <code>clientID_i</code>. إذا كان هناك إدخال مطابق، يقوم العميل بفك تشفيره للحصول على <code>authCookie</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>authCookie = DECRYPT(clientKey_i, clientIV_i, clientCookie_i)
</span></span></code></pre></div><h4 id="security-considerations">Security considerations</h4>
<p>كلا آليتي تفويض العميل المذكورتين أعلاه توفران الخصوصية لعضوية العميل. الكيان الذي يعرف فقط الـ Destination يمكنه رؤية عدد العملاء المشتركين في أي وقت، لكن لا يمكنه تتبع العملاء الذين يتم إضافتهم أو إلغاؤهم.</p>
<p>يجب على الخوادم أن تقوم بعشوائية ترتيب العملاء في كل مرة تقوم فيها بإنشاء LS2 مشفر، لمنع العملاء من معرفة موقعهم في القائمة واستنتاج متى تمت إضافة أو إلغاء عملاء آخرين.</p>
<p>قد يختار الخادم إخفاء عدد العملاء المشتركين من خلال إدراج إدخالات عشوائية في قائمة بيانات التفويض.</p>
<p>مزايا تفويض العميل DH
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</p>
<ul>
<li>أمان المخطط لا يعتمد بشكل كامل على التبادل خارج النطاق لمواد مفتاح العميل. المفتاح الخاص للعميل لا يحتاج أبداً لمغادرة جهازه، وبالتالي فإن المهاجم الذي يستطيع اعتراض التبادل خارج النطاق، ولكن لا يستطيع كسر خوارزمية DH، لا يمكنه فك تشفير LS2 المشفر، أو تحديد المدة التي يُمنح فيها العميل الوصول.</li>
</ul>
<p>عيوب تفويض العميل DH
^^^^^^^^^^^^^^^^^^^^^^^^^^^^</p>
<ul>
<li>يتطلب N + 1 من عمليات DH على جانب الخادم لـ N من العملاء.</li>
<li>يتطلب عملية DH واحدة على جانب العميل.</li>
<li>يتطلب من العميل توليد المفتاح السري.</li>
</ul>
<p>مزايا تخويل العميل PSK
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</p>
<ul>
<li>لا يتطلب عمليات DH.</li>
<li>يسمح للخادم بتوليد المفتاح السري.</li>
<li>يسمح للخادم بمشاركة نفس المفتاح مع عدة عملاء، إذا رغب في ذلك.</li>
</ul>
<p>عيوب تخويل العميل PSK
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</p>
<ul>
<li>أمان المخطط يعتمد بشكل حرج على التبادل خارج النطاق لمواد مفتاح العميل. خصم يعترض التبادل لعميل معين يمكنه فك تشفير أي LS2 مشفر لاحق مخول لذلك العميل، بالإضافة إلى تحديد متى يتم إلغاء وصول العميل.</li>
</ul>
<h3 id="تعريفات">تعريفات</h3>
<p>راجع الاقتراح 149.</p>
<p>لا يمكنك استخدام LS2 مشفر للـ bittorrent، بسبب الردود المضغوطة للإعلان التي تبلغ 32 بايت. الـ 32 بايت تحتوي فقط على الـ hash. لا توجد مساحة لإشارة تدل على أن الـ leaseset مشفر، أو أنواع التوقيع.</p>
<h3 id="تنسيق-3">تنسيق</h3>
<p>بالنسبة لـ leaseSets المشفرة مع المفاتيح غير المتصلة، يجب أيضاً إنشاء المفاتيح الخاصة المُعماة (blinded private keys) في وضع عدم الاتصال، مفتاح واحد لكل يوم.</p>
<p>نظرًا لأن كتلة التوقيع الاختيارية غير المتصلة بالإنترنت موجودة في الجزء النصي الواضح من leaseset المشفر، يمكن لأي شخص يقوم بكشط floodfills استخدام هذا لتتبع leaseset (لكن ليس فك تشفيره) على مدار عدة أيام. لمنع هذا، يجب على مالك المفاتيح أيضًا إنشاء مفاتيح عابرة جديدة لكل يوم. يمكن إنشاء كل من المفاتيح العابرة والمفاتيح المعماة مسبقًا، وتسليمها إلى router في دفعة واحدة.</p>
<p>لا يوجد تنسيق ملف محدد في هذا الاقتراح لتجميع مفاتيح متعددة مؤقتة ومُعمّاة وتوفيرها للعميل أو router. لا يوجد تحسين محدد لبروتوكول I2CP في هذا الاقتراح لدعم leasesets المشفرة مع المفاتيح غير المتصلة.</p>
<h3 id="notes-1">Notes</h3>
<ul>
<li>
<p>خدمة تستخدم leasesets مشفرة ستنشر النسخة المشفرة إلى floodfills. ومع ذلك، من أجل الكفاءة، ستقوم بإرسال leasesets غير مشفرة إلى العملاء في رسالة garlic المُغلفة، بمجرد التوثق (عبر القائمة البيضاء، على سبيل المثال).</p>
</li>
<li>
<p>قد تقوم عقد Floodfill بتحديد الحد الأقصى للحجم إلى قيمة معقولة لمنع إساءة الاستخدام.</p>
</li>
<li>
<p>بعد فك التشفير، يجب إجراء عدة فحوصات، بما في ذلك التأكد من أن
الطابع الزمني الداخلي وتاريخ انتهاء الصلاحية يتطابقان مع تلك الموجودة في المستوى الأعلى.</p>
</li>
<li>
<p>تم اختيار ChaCha20 بدلاً من AES. بينما تكون السرعات متشابهة إذا كان دعم الأجهزة لـ AES متاحاً، فإن ChaCha20 أسرع بـ 2.5-3 مرات عندما لا يكون دعم الأجهزة لـ AES متاحاً، كما هو الحال في أجهزة ARM منخفضة الأداء.</p>
</li>
<li>
<p>نحن لا نهتم بالسرعة بما يكفي لاستخدام keyed BLAKE2b. لديه حجم إخراج كبير بما يكفي لاستيعاب أكبر n نحتاجه (أو يمكننا استدعاؤه مرة واحدة لكل مفتاح مرغوب مع معامل عداد). BLAKE2b أسرع بكثير من SHA-256، و keyed-BLAKE2b سيقلل من العدد الإجمالي لاستدعاءات دالة التشفير.
ومع ذلك، انظر الاقتراح 148، حيث يُقترح أن ننتقل إلى BLAKE2b لأسباب أخرى.
انظر <a href="https://www.lvh.io/posts/secure-key-derivation-performance.html">Secure key derivation performance</a>
.</p>
</li>
</ul>
<h3 id="meta-ls2">Meta LS2</h3>
<p>يُستخدم هذا لاستبدال multihoming. مثل أي leaseset، يتم توقيع هذا من قبل المُنشئ. هذه قائمة مُصادق عليها من hashes الوجهة.</p>
<p>الـ Meta LS2 هو قمة، وربما العقد الوسطية، لهيكل شجري. يحتوي على عدد من الإدخالات، كل منها يشير إلى LS أو LS2 أو Meta LS2 آخر لدعم التعدد الضخم للشبكات المنزلية. قد يحتوي الـ Meta LS2 على مزيج من إدخالات LS وLS2 وMeta LS2. أوراق الشجرة هي دائماً LS أو LS2. الشجرة عبارة عن DAG؛ الحلقات محظورة؛ يجب على العملاء الذين يقومون بعمليات البحث اكتشاف ورفض اتباع الحلقات.</p>
<p>قد يكون لـ Meta LS2 انتهاء صلاحية أطول بكثير من LS أو LS2 العادي. قد يكون للمستوى العلوي انتهاء صلاحية بعد عدة ساعات من تاريخ النشر. سيتم فرض الحد الأقصى لوقت انتهاء الصلاحية بواسطة floodfills والعملاء، وهو قيد التحديد.</p>
<p>حالة الاستخدام لـ Meta LS2 هي التعدد الضخم للاتصال المنزلي (massive multihoming)، ولكن بدون حماية إضافية لربط أجهزة router بـ leasesets (في وقت إعادة تشغيل router) أكثر مما هو متوفر حالياً مع LS أو LS2. هذا مكافئ لحالة استخدام &ldquo;facebook&rdquo;، والتي على الأرجح لا تحتاج لحماية الربط. حالة الاستخدام هذه تحتاج على الأرجح لمفاتيح غير متصلة (offline keys)، والتي يتم توفيرها في الرأسية القياسية (standard header) في كل عقدة من عقد الشجرة.</p>
<p>البروتوكول الخلفي للتنسيق بين routers الأوراق، والموقعين الوسطيين وموقعي Meta LS الرئيسيين غير محدد هنا. المتطلبات بسيطة للغاية - فقط التحقق من أن النظير متصل، ونشر LS جديد كل بضع ساعات. التعقيد الوحيد هو في اختيار ناشرين جدد لـ Meta LSes على المستوى الأعلى أو المستوى الوسطي عند الفشل.</p>
<p>مجموعات الإيجار المختلطة حيث يتم دمج الإيجارات من عدة routers وتوقيعها ونشرها في leaseset واحد موثقة في الاقتراح 140، &ldquo;multihoming غير مرئي&rdquo;. هذا الاقتراح غير قابل للتطبيق كما هو مكتوب، لأن اتصالات streaming لن تكون &ldquo;ثابتة&rdquo; على router واحد، انظر <a href="http://zzz.i">http://zzz.i</a>
2p/topics/2335 .</p>
<p>البروتوكول الخلفي، والتفاعل مع العناصر الداخلية للـ router والعميل، سيكون معقداً جداً للـ invisible multihoming.</p>
<p>لتجنب إرهاق floodfill للمستوى العلوي Meta LS، يجب أن تكون مدة انتهاء الصلاحية عدة ساعات على الأقل. يجب على العملاء تخزين Meta LS للمستوى العلوي مؤقتاً، والاحتفاظ به عبر عمليات إعادة التشغيل إذا لم تنته صلاحيته.</p>
<p>نحتاج إلى تعريف خوارزمية للعملاء لاجتياز الشجرة، بما في ذلك البدائل الاحتياطية، بحيث يكون الاستخدام موزعًا. دالة تعتمد على مسافة التجمع، والتكلفة، والعشوائية. إذا كان لدى عقدة كل من LS أو LS2 و Meta LS، فنحتاج إلى معرفة متى يُسمح باستخدام تلك الـ leasesets، ومتى نواصل اجتياز الشجرة.</p>
<p>البحث باستخدام</p>
<pre><code>Standard LS flag (1)
</code></pre>
<p>تخزين مع</p>
<pre><code>Meta LS2 type (7)
</code></pre>
<p>احفظ في</p>
<pre><code>Hash of destination
This hash is then used to generate the daily &quot;routing key&quot;, as in LS1
</code></pre>
<p>انتهاء الصلاحية النموذجي</p>
<pre><code>Hours. Max 18.2 hours (65535 seconds)
</code></pre>
<p>نُشر بواسطة</p>
<pre><code>&quot;master&quot; Destination or coordinator, or intermediate coordinators
</code></pre>
<h3 id="format">Format</h3>
<pre tabindex="0"><code>Standard LS2 Header as specified above

  Meta LS2 Type-Specific Part
  - Properties (Mapping as specified in common structures spec, 2 zero bytes if none)
  - Number of entries (1 byte) Maximum TBD
  - Entries. Each entry contains: (40 bytes)
    - Hash (32 bytes)
    - Flags (2 bytes)
      TBD. Set all to zero for compatibility with future uses.
    - Type (1 byte) The type of LS it is referencing;
      1 for LS, 3 for LS2, 5 for encrypted, 7 for meta, 0 for unknown.
    - Cost (priority) (1 byte)
    - Expires (4 bytes) (4 bytes, big endian, seconds since epoch, rolls over in 2106)
  - Number of revocations (1 byte) Maximum TBD
  - Revocations: Each revocation contains: (32 bytes)
    - Hash (32 bytes)

  Standard LS2 Signature:
  - Signature (40+ bytes)
    The signature is of everything above.
</code></pre><p>الأعلام والخصائص: للاستخدام المستقبلي</p>
<h3 id="اشتقاق-مفتاح-الإخفاء">اشتقاق مفتاح الإخفاء</h3>
<ul>
<li>
<p>خدمة موزعة تستخدم هذا النهج ستحتوي على &ldquo;سيد&rdquo; واحد أو أكثر يمتلك المفتاح الخاص لوجهة الخدمة. سيقومون (خارج النطاق) بتحديد القائمة الحالية للوجهات النشطة وسينشرون Meta LS2. لضمان التكرار، يمكن لعدة أسياد استخدام multihome (أي النشر المتزامن) لـ Meta LS2.</p>
</li>
<li>
<p>يمكن لخدمة موزعة أن تبدأ بوجهة واحدة أو تستخدم multihoming بالطريقة القديمة، ثم تنتقل إلى Meta LS2. يمكن لعملية البحث القياسية LS أن ترجع أي واحد من LS أو LS2 أو Meta LS2.</p>
</li>
<li>
<p>عندما تستخدم خدمة Meta LS2، فإنها لا تحتوي على أنفاق (leases).</p>
</li>
</ul>
<h3 id="service-record">Service Record</h3>
<p>هذا سجل فردي يشير إلى أن وجهة معينة تشارك في خدمة. يتم إرساله من المشارك إلى الـ floodfill. لا يتم إرساله بشكل منفرد من قبل الـ floodfill أبداً، بل فقط كجزء من قائمة الخدمات. يُستخدم سجل الخدمة أيضاً لإلغاء المشاركة في خدمة، وذلك بتعيين انتهاء الصلاحية إلى الصفر.</p>
<p>هذا ليس LS2 ولكنه يستخدم ترويسة LS2 المعيارية وتنسيق التوقيع.</p>
<p>البحث باستخدام</p>
<pre><code>n/a, see Service List
</code></pre>
<p>تخزين مع</p>
<pre><code>Service Record type (9)
</code></pre>
<p>احفظ في</p>
<pre><code>Hash of service name
This hash is then used to generate the daily &quot;routing key&quot;, as in LS1
</code></pre>
<p>انتهاء الصلاحية النموذجي</p>
<pre><code>Hours. Max 18.2 hours (65535 seconds)
</code></pre>
<p>نُشر بواسطة</p>
<pre><code>Destination
</code></pre>
<h3 id="format-1">Format</h3>
<pre tabindex="0"><code>Standard LS2 Header as specified above

  Service Record Type-Specific Part
  - Port (2 bytes, big endian) (0 if unspecified)
  - Hash of service name (32 bytes)

  Standard LS2 Signature:
  - Signature (40+ bytes)
    The signature is of everything above.
</code></pre><h3 id="notes-2">Notes</h3>
<ul>
<li>
<p>إذا كانت قيمة expires تساوي أصفارًا فقط، يجب على الـ floodfill إلغاء السجل وعدم تضمينه في قائمة الخدمات.</p>
</li>
<li>
<p>التخزين: قد يقوم الـ floodfill بتقييد تخزين هذه السجلات بصرامة وتحديد عدد السجلات المخزنة لكل hash وانتهاء صلاحيتها. كما يمكن استخدام قائمة بيضاء من الـ hashes.</p>
</li>
<li>
<p>أي نوع آخر من netdb في نفس الـ hash له أولوية، لذلك سجل الخدمة لا يمكنه أبداً
الكتابة فوق LS/RI، لكن LS/RI سوف يكتب فوق جميع سجلات الخدمة في ذلك الـ hash.</p>
</li>
</ul>
<h3 id="service-list">Service List</h3>
<p>هذا لا يشبه LS2 على الإطلاق ويستخدم تنسيقاً مختلفاً.</p>
<p>يتم إنشاء قائمة الخدمات وتوقيعها بواسطة floodfill. وهي غير مصادق عليها بمعنى أن أي شخص يمكنه الانضمام إلى خدمة عن طريق نشر Service Record إلى floodfill.</p>
<p>قائمة الخدمات تحتوي على سجلات خدمات مختصرة، وليس سجلات خدمات كاملة. هذه تحتوي على توقيعات ولكن فقط hashes، وليس destinations كاملة، لذلك لا يمكن التحقق منها بدون الـ destination الكامل.</p>
<p>الأمان، إن وُجد، ومرغوبية قوائم الخدمات لا تزال قيد التحديد. يمكن لعقد floodfill أن تحد من النشر، والاستعلامات، إلى قائمة بيضاء من الخدمات، لكن تلك القائمة البيضاء قد تختلف بناءً على التنفيذ، أو تفضيل المشغل. قد لا يكون من الممكن تحقيق إجماع على قائمة بيضاء أساسية مشتركة عبر التنفيذات المختلفة.</p>
<p>إذا كان اسم الخدمة مُدرجاً في سجل الخدمة أعلاه، فقد يعترض مشغلو floodfill؛ وإذا كان الـ hash فقط مُدرجاً، فلا يوجد تحقق، ويمكن لسجل الخدمة أن &ldquo;يدخل&rdquo; قبل أي نوع آخر من netDb ويتم تخزينه في floodfill.</p>
<p>البحث باستخدام</p>
<pre><code>Service List lookup type (11)
</code></pre>
<p>تخزين مع</p>
<pre><code>Service List type (11)
</code></pre>
<p>احفظ في</p>
<pre><code>Hash of service name
This hash is then used to generate the daily &quot;routing key&quot;, as in LS1
</code></pre>
<p>انتهاء الصلاحية النموذجي</p>
<pre><code>Hours, not specified in the list itself, up to local policy
</code></pre>
<p>نُشر بواسطة</p>
<pre><code>Nobody, never sent to floodfill, never flooded.
</code></pre>
<h3 id="format-2">Format</h3>
<p>لا تستخدم ترويسة LS2 المعيارية المحددة أعلاه.</p>
<pre tabindex="0"><code>- Type (1 byte)
    Not actually in header, but part of data covered by signature.
    Take from field in Database Store Message.
  - Hash of the service name (implicit, in the Database Store message)
  - Hash of the Creator (floodfill) (32 bytes)
  - Published timestamp (8 bytes, big endian)

  - Number of Short Service Records (1 byte)
  - List of Short Service Records:
    Each Short Service Record contains (90+ bytes)
    - Dest hash (32 bytes)
    - Published timestamp (8 bytes, big endian)
    - Expires (4 bytes, big endian) (offset from published in ms)
    - Flags (2 bytes)
    - Port (2 bytes, big endian)
    - Sig length (2 bytes, big endian)
    - Signature of dest (40+ bytes)

  - Number of Revocation Records (1 byte)
  - List of Revocation Records:
    Each Revocation Record contains (86+ bytes)
    - Dest hash (32 bytes)
    - Published timestamp (8 bytes, big endian)
    - Flags (2 bytes)
    - Port (2 bytes, big endian)
    - Sig length (2 bytes, big endian)
    - Signature of dest (40+ bytes)

  - Signature of floodfill (40+ bytes)
    The signature is of everything above.
</code></pre><p>للتحقق من توقيع قائمة الخدمة:</p>
<ul>
<li>إضافة هاش اسم الخدمة في المقدمة</li>
<li>إزالة هاش المنشئ</li>
<li>التحقق من توقيع المحتويات المعدلة</li>
</ul>
<p>للتحقق من توقيع كل Short Service Record:</p>
<ul>
<li>جلب الوجهة</li>
<li>التحقق من التوقيع لـ (الطابع الزمني المنشور + انتهاء الصلاحية + العلامات + المنفذ + Hash لاسم الخدمة)</li>
</ul>
<p>للتحقق من توقيع كل سجل إلغاء (Revocation Record):</p>
<ul>
<li>جلب الوجهة</li>
<li>التحقق من توقيع (الطابع الزمني المنشور + 4 بايتات صفرية + العلامات + المنفذ + Hash
لاسم الخدمة)</li>
</ul>
<h3 id="notes-3">Notes</h3>
<ul>
<li>
<p>نحن نستخدم طول التوقيع بدلاً من نوع التوقيع حتى نتمكن من دعم أنواع التوقيع غير المعروفة.</p>
</li>
<li>
<p>لا يوجد انتهاء صلاحية لقائمة الخدمة، يمكن للمستقبلين اتخاذ قرارهم الخاص بناءً على السياسة أو انتهاء صلاحية السجلات الفردية.</p>
</li>
<li>
<p>قوائم الخدمات لا يتم إغراقها، فقط سجلات الخدمة الفردية يتم إغراقها. كل floodfill ينشئ ويوقع ويخزن مؤقتاً قائمة خدمات. يستخدم الـ floodfill سياسته الخاصة لوقت التخزين المؤقت والعدد الأقصى لسجلات الخدمة والإلغاء.</p>
</li>
</ul>
<h2 id="common-structures-spec-changes-required">Common Structures Spec Changes Required</h2>
<h3 id="التشفير-والمعالجة">التشفير والمعالجة</h3>
<p>خارج نطاق هذا الاقتراح. أضف إلى مقترحات ECIES 144 و 145.</p>
<h3 id="new-intermediate-structures">New Intermediate Structures</h3>
<p>أضف هياكل جديدة لـ Lease2 و MetaLease و LeaseSet2Header و OfflineSignature. فعال اعتباراً من الإصدار 0.9.38.</p>
<h3 id="new-netdb-types">New NetDB Types</h3>
<p>أضف هياكل لكل نوع جديد من leaseSet، مدمجة من أعلاه. بالنسبة لـ LeaseSet2 وEncryptedLeaseSet وMetaLeaseSet، سارية اعتباراً من الإصدار 0.9.38. بالنسبة لـ Service Record وService List، أولية وغير مجدولة.</p>
<h3 id="new-signature-type">New Signature Type</h3>
<p>أضف RedDSA_SHA512_Ed25519 النوع 11. المفتاح العام 32 بايت؛ المفتاح الخاص 32 بايت؛ الهاش 64 بايت؛ التوقيع 64 بايت.</p>
<h2 id="encryption-spec-changes-required">Encryption Spec Changes Required</h2>
<p>خارج نطاق هذا الاقتراح. راجع الاقتراحات 144 و 145.</p>
<h2 id="i2np-changes-required">I2NP Changes Required</h2>
<p>أضف ملاحظة: لا يمكن نشر LS2 إلا إلى floodfills بحد أدنى من الإصدار.</p>
<h3 id="database-lookup-message">Database Lookup Message</h3>
<p>أضف نوع البحث في قائمة الخدمات.</p>
<h3 id="changes">Changes</h3>
<pre tabindex="0"><code>Flags byte: Lookup type field, currently bits 3-2, expands to bits 4-2.
  Lookup type 0x04 is defined as the service list lookup.

  Add note: Service list loookup may only be sent to floodfills with a minimum version.
  Minimum version is 0.9.38.
</code></pre><h3 id="ترخيص-لكل-عميل">ترخيص لكل عميل</h3>
<p>أضف جميع أنواع المتاجر الجديدة.</p>
<h3 id="changes-1">Changes</h3>
<pre tabindex="0"><code>Type byte: Type field, currently bit 0, expands to bits 3-0.
  Type 3 is defined as a LS2 store.
  Type 5 is defined as a encrypted LS2 store.
  Type 7 is defined as a meta LS2 store.
  Type 9 is defined as a service record store.
  Type 11 is defined as a service list store.
  Other types are undefined and invalid.

  Add note: All new types may only be published to floodfills with a minimum version.
  Minimum version is 0.9.38.
</code></pre><h2 id="i2cp-changes-required">I2CP Changes Required</h2>
<h3 id="i2cp-options">I2CP Options</h3>
<p>الخيارات الجديدة المُفسرة من جانب الـ router، المُرسلة في SessionConfig Mapping:</p>
<pre tabindex="0"><code>
  i2cp.leaseSetType=nnn       The type of leaseset to be sent in the Create Leaseset Message
                              Value is the same as the netdb store type in the table above.
                              Interpreted client-side, but also passed to the router in the
                              SessionConfig, to declare intent and check support.

  i2cp.leaseSetEncType=nnn[,nnn]  The encryption types to be used.
                                  Interpreted client-side, but also passed to the router in
                                  the SessionConfig, to declare intent and check support.
                                  See proposals 144 and 145.

  i2cp.leaseSetOfflineExpiration=nnn  The expiration of the offline signature, ASCII,
                                      seconds since the epoch.

  i2cp.leaseSetTransientPublicKey=[type:]b64  The base 64 of the transient private key,
                                              prefixed by an optional sig type number
                                              or name, default DSA_SHA1.
                                              Length as inferred from the sig type

  i2cp.leaseSetOfflineSignature=b64   The base 64 of the offline signature.
                                      Length as inferred from the destination
                                      signing public key type

  i2cp.leaseSetSecret=b64     The base 64 of a secret used to blind the
                              address of the leaseset, default &#34;&#34;

  i2cp.leaseSetAuthType=nnn   The type of authentication for encrypted LS2.
                              0 for no per-client authentication (the default)
                              1 for DH per-client authentication
                              2 for PSK per-client authentication

  i2cp.leaseSetPrivKey=b64    A base 64 private key for the router to use to
                              decrypt the encrypted LS2,
                              only if per-client authentication is enabled
</code></pre><p>الخيارات الجديدة المُفسَّرة من جانب العميل:</p>
<pre tabindex="0"><code>
  i2cp.leaseSetType=nnn     The type of leaseset to be sent in the Create Leaseset Message
                            Value is the same as the netdb store type in the table above.
                            Interpreted client-side, but also passed to the router in the
                            SessionConfig, to declare intent and check support.

  i2cp.leaseSetEncType=nnn[,nnn]  The encryption types to be used.
                                  Interpreted client-side, but also passed to the router in
                                  the SessionConfig, to declare intent and check support.
                                  See proposals 144 and 145.

  i2cp.leaseSetSecret=b64     The base 64 of a secret used to blind the
                              address of the leaseset, default &#34;&#34;

  i2cp.leaseSetAuthType=nnn       The type of authentication for encrypted LS2.
                                  0 for no per-client authentication (the default)
                                  1 for DH per-client authentication
                                  2 for PSK per-client authentication

  i2cp.leaseSetBlindedType=nnn   The sig type of the blinded key for encrypted LS2.
                                 Default depends on the destination sig type.

  i2cp.leaseSetClient.dh.nnn=b64name:b64pubkey   The base 64 of the client name (ignored, UI use only),
                                                 followed by a &#39;:&#39;, followed by the base 64 of the public
                                                 key to use for DH per-client auth. nnn starts with 0

  i2cp.leaseSetClient.psk.nnn=b64name:b64privkey   The base 64 of the client name (ignored, UI use only),
                                                   followed by a &#39;:&#39;, followed by the base 64 of the private
                                                   key to use for PSK per-client auth. nnn starts with 0
</code></pre><h3 id="session-config">Session Config</h3>
<p>لاحظ أنه للتوقيعات غير المتصلة، الخيارات i2cp.leaseSetOfflineExpiration و i2cp.leaseSetTransientPublicKey و i2cp.leaseSetOfflineSignature مطلوبة، والتوقيع يتم بواسطة المفتاح الخاص للتوقيع المؤقت.</p>
<h3 id="عناوين-ls-مشفرة-مع-base-32">عناوين LS مشفرة مع Base 32</h3>
<p>الموجه إلى العميل. لا توجد تغييرات. يتم إرسال الـ leases مع طوابع زمنية بحجم 8 بايت، حتى لو كان الـ leaseset المُرجع سيكون LS2 بطوابع زمنية بحجم 4 بايت. لاحظ أن الاستجابة قد تكون رسالة Create Leaseset أو Create Leaseset2 Message.</p>
<h3 id="مجموعة-الإيجار-المشفرة-encrypted-ls-مع-المفاتيح-غير-المتصلة">مجموعة الإيجار المشفرة (Encrypted LS) مع المفاتيح غير المتصلة</h3>
<p>من الـ router إلى العميل. لا توجد تغييرات. يتم إرسال الـ leases مع طوابع زمنية بحجم 8 بايت، حتى لو كان الـ leaseset المُعاد سيكون LS2 مع طوابع زمنية بحجم 4 بايت. لاحظ أن الاستجابة قد تكون رسالة Create Leaseset أو Create Leaseset2.</p>
<h3 id="ملاحظات-3">ملاحظات</h3>
<p>العميل إلى الموجه. رسالة جديدة، لاستخدامها بدلاً من رسالة Create Leaseset.</p>
<h3 id="meta-ls2-1">Meta LS2</h3>
<ul>
<li>
<p>لكي يتمكن الـ router من تحليل نوع المتجر، يجب أن يكون النوع موجوداً في الرسالة،
إلا إذا تم تمريره إلى الـ router مسبقاً في إعدادات الجلسة.
لتبسيط كود التحليل المشترك، من الأسهل وجوده في الرسالة نفسها.</p>
</li>
<li>
<p>لكي يعرف الراوتر نوع وطول المفتاح الخاص،
يجب أن يكون بعد الـ lease set، إلا إذا كان المحلل يعرف النوع مسبقاً
في إعداد الجلسة.
بالنسبة لكود التحليل الشائع، من الأسهل معرفة ذلك من الرسالة نفسها.</p>
</li>
<li>
<p>مفتاح التوقيع الخاص، المُعرَّف مسبقاً للإلغاء وغير المستخدم،
غير موجود في LS2.</p>
</li>
</ul>
<h3 id="التنسيق">التنسيق</h3>
<p>نوع الرسالة لرسالة Create Leaseset2 هو 41.</p>
<h3 id="ملاحظات-4">ملاحظات</h3>
<pre tabindex="0"><code>Session ID
  Type byte: Type of lease set to follow
             Type 1 is a LS
             Type 3 is a LS2
             Type 5 is a encrypted LS2
             Type 7 is a meta LS2
  LeaseSet: type specified above
  Number of private keys to follow (1 byte)
  Encryption Private Keys: For each public key in the lease set,
                           in the same order
                           (Not present for Meta LS2)
                           - Encryption type (2 bytes, big endian)
                           - Encryption key length (2 bytes, big endian)
                           - Encryption key (number of bytes specified)
</code></pre><h3 id="سجل-الخدمة">سجل الخدمة</h3>
<ul>
<li>الحد الأدنى لإصدار router هو 0.9.39.</li>
<li>الإصدار الأولي مع نوع الرسالة 40 كان في 0.9.38 لكن تم تغيير التنسيق.
النوع 40 مهجور وغير مدعوم.</li>
</ul>
<h3 id="تنسيق-4">تنسيق</h3>
<ul>
<li>هناك حاجة لمزيد من التغييرات لدعم LS المشفر والوصفي.</li>
</ul>
<h3 id="ملاحظات-5">ملاحظات</h3>
<p>من العميل إلى الموجه. رسالة جديدة.</p>
<h3 id="قائمة-الخدمات">قائمة الخدمات</h3>
<ul>
<li>
<p>يحتاج الـ router إلى معرفة ما إذا كان الوجهة مُعمى.
إذا كان مُعمى ويستخدم مصادقة سرية أو لكل عميل،
فإنه يحتاج إلى الحصول على تلك المعلومات أيضاً.</p>
</li>
<li>
<p>البحث عن المضيف (Host Lookup) لعنوان b32 بتنسيق جديد (&ldquo;b33&rdquo;)
يخبر الموجه (router) أن العنوان مخفي، لكن لا توجد آلية لتمرير
المفتاح السري أو المفتاح الخاص إلى الموجه في رسالة البحث عن المضيف.
بينما يمكننا توسيع رسالة البحث عن المضيف لإضافة تلك المعلومات،
من الأنظف تعريف رسالة جديدة.</p>
</li>
<li>
<p>نحتاج إلى طريقة برمجية للعميل لإخبار الـ router.
وإلا، سيتوجب على المستخدم تكوين كل وجهة يدوياً.</p>
</li>
</ul>
<h3 id="تنسيق-5">تنسيق</h3>
<p>قبل أن يرسل العميل رسالة إلى وجهة مُعماة، يجب عليه إما البحث عن &ldquo;b33&rdquo; في رسالة البحث عن المضيف (Host Lookup message)، أو إرسال رسالة معلومات التعمية (Blinding Info message). إذا كانت الوجهة المُعماة تتطلب سرًا أو مصادقة خاصة بكل عميل، فيجب على العميل إرسال رسالة معلومات التعمية (Blinding Info message).</p>
<p>الراوتر لا يرسل ردًا على هذه الرسالة.</p>
<h3 id="ملاحظات-6">ملاحظات</h3>
<p>نوع الرسالة لرسالة معلومات الإخفاء (Blinding Info Message) هو 42.</p>
<h3 id="format-3">Format</h3>
<pre tabindex="0"><code>Session ID
  Flags:       1 byte
               Bit order: 76543210
               Bit 0: 0 for everybody, 1 for per-client
               Bits 3-1: Authentication scheme, if bit 0 is set to 1 for per-client, otherwise 000
                         000: DH client authentication (or no per-client authentication)
                         001: PSK client authentication
               Bit 4: 1 if secret required, 0 if no secret required
               Bits 7-5: Unused, set to 0 for future compatibility
  Type byte:   Endpoint type to follow
               Type 0 is a Hash
               Type 1 is a host name String
               Type 2 is a Destination
               Type 3 is a Sig Type and Signing Public Key
  Blind Type:  2 byte blinded sig type (big endian)
  Expiration:  4 bytes, big endian, seconds since epoch
  Endpoint:    Data as specified above
               For type 0: 32 byte binary hash
               For type 1: host name String
               For type 2: binary Destination
               For type 3: 2 byte sig type (big endian)
                           Signing Public Key (length as implied by sig type)
  Private Key: Only if flag bit 0 is set to 1
               A 32-byte ECIES_X25519 private key
  Secret:      Only if flag bit 4 is set to 1
               A secret String
</code></pre><h3 id="شهادات-المفاتيح">شهادات المفاتيح</h3>
<ul>
<li>الحد الأدنى لإصدار الـ router هو 0.9.43</li>
</ul>
<h3 id="هياكل-وسيطة-جديدة">هياكل وسيطة جديدة</h3>
<h3 id="أنواع-netdb-الجديدة">أنواع NetDB الجديدة</h3>
<p>لدعم البحث عن أسماء المضيفين &ldquo;b33&rdquo; وإرجاع إشارة في حالة عدم امتلاك الـ router للمعلومات المطلوبة، نحدد رموز نتائج إضافية لرسالة Host Reply Message، كما يلي:</p>
<pre tabindex="0"><code>2: Lookup password required
   3: Private key required
   4: Lookup password and private key required
   5: Leaseset decryption failure
</code></pre><p>القيم من 1-255 معرّفة بالفعل كأخطاء، لذلك لا توجد مشكلة في التوافق مع الإصدارات السابقة.</p>
<h3 id="نوع-التوقيع-الجديد">نوع التوقيع الجديد</h3>
<p>جهاز التوجيه إلى العميل. رسالة جديدة.</p>
<h3 id="justification-1">Justification</h3>
<p>العميل لا يعرف مسبقاً أن Hash معين سيتم حله إلى Meta LS.</p>
<p>إذا أرجع البحث عن leaseset لوجهة معينة Meta LS، فإن الـ router سيقوم بالحل التكراري. بالنسبة للـ datagrams، لا يحتاج الجانب العميل إلى المعرفة؛ ومع ذلك، بالنسبة للـ streaming، حيث يتحقق البروتوكول من الوجهة في SYN ACK، يجب أن يعرف ما هي الوجهة &ldquo;الحقيقية&rdquo;. لذلك، نحتاج إلى رسالة جديدة.</p>
<h3 id="usage">Usage</h3>
<p>يحتفظ الـ router بذاكرة تخزين مؤقت للوجهة الفعلية المستخدمة من meta LS. عندما يرسل العميل رسالة إلى وجهة تُحل إلى meta LS، يتحقق الـ router من ذاكرة التخزين المؤقت للوجهة الفعلية المستخدمة مؤخراً. إذا كانت ذاكرة التخزين المؤقت فارغة، يختار الـ router وجهة من الـ meta LS، ويبحث عن الـ leaseset. إذا نجح البحث عن الـ leaseset، يضيف الـ router تلك الوجهة إلى ذاكرة التخزين المؤقت، ويرسل للعميل رسالة Meta Redirect Message. هذا يتم مرة واحدة فقط، إلا إذا انتهت صلاحية الوجهة ويجب تغييرها. يجب على العميل أيضاً تخزين المعلومات مؤقتاً إذا لزم الأمر. رسالة Meta Redirect Message لا يتم إرسالها رداً على كل SendMessage.</p>
<p>يرسل الموجه هذه الرسالة فقط للعملاء الذين يستخدمون الإصدار 0.9.47 أو أحدث.</p>
<p>العميل لا يرسل رداً على هذه الرسالة.</p>
<h3 id="رسالة-البحث-في-قاعدة-البيانات">رسالة البحث في قاعدة البيانات</h3>
<p>نوع الرسالة لرسالة Meta Redirect Message هو 43.</p>
<h3 id="التغييرات">التغييرات</h3>
<pre tabindex="0"><code>Session ID (2 bytes) The value from the Send Message.
  Message ID generated by the router (4 bytes)
  4 byte nonce previously generated by the client
               (the value from the Send Message, may be zero)
  Flags:       2 bytes, bit order 15...0
               Unused, set to 0 for future compatibility
               Bit 0: 0 - the destination is no longer meta
                      1 - the destination is now meta
               Bits 15-1: Unused, set to 0 for future compatibility
  Original Destination (387+ bytes)
  (following fields only present if flags bit 0 is 1)
  MFlags:      2 bytes
               Unused, set to 0 for future compatibility
               From the Meta Lease for the actual Destination
  Expiration:  4 bytes, big endian, seconds since epoch
               From the Meta Lease for the actual Destination
  Cost (priority) 1 byte
               From the Meta Lease for the actual Destination
  Actual (real) Destination (387+ bytes)
</code></pre><h3 id="رسالة-تخزين-قاعدة-البيانات">رسالة تخزين قاعدة البيانات</h3>
<p>كيفية إنشاء ودعم Meta، بما في ذلك التواصل والتنسيق بين أجهزة router، خارج نطاق هذا الاقتراح. راجع الاقتراح ذي الصلة 150.</p>
<h3 id="التغييرات-1">التغييرات</h3>
<p>التوقيعات غير المتصلة (offline signatures) لا يمكن التحقق منها في streaming أو repliable datagrams. انظر الأقسام أدناه.</p>
<h2 id="private-key-file-changes-required">Private Key File Changes Required</h2>
<p>ملف المفتاح الخاص (eepPriv.dat) ليس جزءاً رسمياً من مواصفاتنا ولكنه موثق في <a href="http://idk.i2p/javadoc-i2p/net/i2p/data/PrivateKeyFile.html">Java I2P javadocs</a>
 والتطبيقات الأخرى تدعمه. هذا يُمكّن من نقل المفاتيح الخاصة إلى تطبيقات مختلفة.</p>
<p>يجب إجراء تغييرات لتخزين المفتاح العام المؤقت ومعلومات التوقيع غير المتصل.</p>
<h3 id="changes-2">Changes</h3>
<pre tabindex="0"><code>If the signing private key is all zeros, the offline information section follows:

  - Expires timestamp
    (4 bytes, big endian, seconds since epoch, rolls over in 2106)
  - Sig type of transient Signing Public Key (2 bytes, big endian)
  - Transient Signing Public key
    (length as specified by transient sig type)
  - Signature of above three fields by offline key
    (length as specified by destination sig type)
  - Transient Signing Private key
    (length as specified by transient sig type)
</code></pre><h3 id="خيارات-i2cp">خيارات I2CP</h3>
<p>أضف الدعم للخيارات التالية:</p>
<pre tabindex="0"><code>-d days              (specify expiration in days of offline sig, default 365)
      -o offlinedestfile   (generate the online key file,
                            using the offline key file specified)
      -r sigtype           (specify sig type of transient key, default Ed25519)
</code></pre><h2 id="streaming-changes-required">Streaming Changes Required</h2>
<p>التوقيعات غير المتصلة لا يمكن التحقق منها حالياً في streaming. التغيير أدناه يضيف كتلة التوقيع غير المتصل إلى الخيارات. هذا يتجنب الحاجة لاسترداد هذه المعلومات عبر I2CP.</p>
<h3 id="إعداد-الجلسة">إعداد الجلسة</h3>
<pre tabindex="0"><code>Add new option:
  Bit:          11
  Flag:         OFFLINE_SIGNATURE
  Option order: 4
  Option data:  Variable bytes
  Function:     Contains the offline signature section from LS2.
                FROM_INCLUDED must also be set.
                Expires timestamp
                (4 bytes, big endian, seconds since epoch, rolls over in 2106)
                Transient sig type (2 bytes, big endian)
                Transient signing public key (length as implied by sig type)
                Signature of expires timestamp, transient sig type,
                and public key, by the destination public key,
                length as implied by destination public key sig type.

  Change option:
  Bit:          3
  Flag:         SIGNATURE_INCLUDED
  Option order: Change from 4 to 5

  Add information about transient keys to the
  Variable Length Signature Notes section:
  The offline signature option does not needed to be added for a CLOSE packet if
  a SYN packet containing the option was previously acked.
  More info TODO
</code></pre><h3 id="رسالة-طلب-leaseset">رسالة طلب Leaseset</h3>
<ul>
<li>البديل هو إضافة علم فقط، واسترداد المفتاح العام المؤقت عبر I2CP
(انظر أقسام البحث عن المضيف / رسالة رد المضيف أعلاه)</li>
</ul>
<h2 id="عنوان-ls2-القياسي">عنوان LS2 القياسي</h2>
<p>التوقيعات غير المتصلة لا يمكن التحقق منها في معالجة الرسائل القابلة للرد. تحتاج إلى علامة للإشارة إلى التوقيع غير المتصل ولكن لا يوجد مكان لوضع العلامة. سيتطلب رقم بروتوكول وتنسيق جديد تماماً.</p>
<h3 id="رسالة-طلب-leaseset-متغير">رسالة طلب LeaseSet متغير</h3>
<pre tabindex="0"><code>Define new protocol 19 - Repliable datagram with options?
  - Destination (387+ bytes)
  - Flags (2 bytes)
    Bit order: 15 14 ... 3 2 1 0
    Bit 0: If 0, no offline keys; if 1, offline keys
    Bits 1-15: set to 0 for compatibility with future uses
  - If flag indicates offline keys, the offline signature section:
    Expires timestamp
    (4 bytes, big endian, seconds since epoch, rolls over in 2106)
    Transient sig type (2 bytes, big endian)
    Transient signing public key (length as implied by sig type)
    Signature of expires timestamp, transient sig type,
    and public key, by the destination public key,
    length as implied by destination public key sig type.
    This section can, and should, be generated offline.
  - Data
</code></pre><h3 id="إنشاء-رسالة-leaseset2">إنشاء رسالة Leaseset2</h3>
<ul>
<li>البديل هو مجرد إضافة علامة، واسترجاع المفتاح العام المؤقت عبر I2CP
(انظر أقسام رسالة البحث عن المضيف / رد المضيف أعلاه)</li>
<li>أي خيارات أخرى يجب أن نضيفها الآن بعد أن أصبح لدينا بايتات العلامات؟</li>
</ul>
<h2 id="sam-v3-changes-required">SAM V3 Changes Required</h2>
<p>يجب تحسين SAM لدعم التوقيعات غير المتصلة في DESTINATION base 64.</p>
<h3 id="التبرير-1">التبرير</h3>
<pre tabindex="0"><code>Note that in the SESSION CREATE DESTINATION=$privkey,
  the $privkey raw data (before base64 conversion)
  may be optionally followed by the Offline Signature as specified in the
  Common Structures Specification.

  If the signing private key is all zeros, the offline information section follows:

  - Expires timestamp
    (4 bytes, big endian, seconds since epoch, rolls over in 2106)
  - Sig type of transient Signing Public Key (2 bytes, big endian)
  - Transient Signing Public key
    (length as specified by transient sig type)
  - Signature of above three fields by offline key
    (length as specified by destination sig type)
  - Transient Signing Private key (length as specified by transient sig type)
</code></pre><p>لاحظ أن التواقيع غير المتصلة مدعومة فقط لـ STREAM وَ RAW، وليس لـ DATAGRAM (حتى نقوم بتعريف بروتوكول DATAGRAM جديد).</p>
<p>لاحظ أن SESSION STATUS ستُرجع Signing Private Key من جميع الأصفار وبيانات Offline Signature تماماً كما تم توفيرها في SESSION CREATE.</p>
<p>لاحظ أنه لا يمكن استخدام DEST GENERATE و SESSION CREATE DESTINATION=TRANSIENT لإنشاء وجهة موقعة غير متصلة (offline signed destination).</p>
<h3 id="نوع-الرسالة">نوع الرسالة</h3>
<p>ارفع الإصدار إلى 3.4، أم اتركه عند 3.1/3.2/3.3 حتى يمكن إضافته دون الحاجة لكل أشياء 3.2/3.3؟</p>
<p>التغييرات الأخرى لم يتم تحديدها بعد. راجع قسم رسالة رد المضيف I2CP أعلاه.</p>
<h2 id="bob-changes-required">BOB Changes Required</h2>
<p>BOB سيحتاج إلى تحسينات لدعم التوقيعات غير المتصلة و/أو Meta LS. هذا أولوية منخفضة وربما لن يتم تحديده أو تنفيذه أبداً. SAM V3 هي الواجهة المفضلة.</p>
<h2 id="publishing-migration-compatibility">Publishing, Migration, Compatibility</h2>
<p>LS2 (بخلاف LS2 المشفر) يتم نشره في نفس موقع DHT كما هو الحال مع LS1. لا توجد طريقة لنشر كل من LS1 و LS2، إلا إذا كان LS2 في موقع مختلف.</p>
<p>يتم نشر LS2 المشفر في hash المفتاح المقنع (blinded key) ونوعه وبياناته. يُستخدم هذا الـ hash بعد ذلك لتوليد &ldquo;مفتاح التوجيه&rdquo; اليومي، كما هو الحال في LS1.</p>
<p>LS2 ستستخدم فقط عندما تكون الميزات الجديدة مطلوبة (التشفير الجديد، LS المشفر، البيانات الوصفية، إلخ). يمكن نشر LS2 فقط إلى floodfills من إصدار محدد أو أعلى.</p>
<p>الخوادم التي تنشر LS2 ستعلم أن أي عملاء متصلين يدعمون LS2. يمكنها إرسال LS2 في garlic encryption.</p>
<p>العملاء سيرسلون LS2 في garlics فقط إذا كانوا يستخدمون التشفير الجديد. العملاء المشتركون سيستخدمون LS1 إلى أجل غير مسمى؟ TODO: كيف يمكن الحصول على عملاء مشتركين يدعمون كلاً من التشفير القديم والجديد؟</p>
<h2 id="rollout">Rollout</h2>
<p>0.9.38 يحتوي على دعم floodfill لمعيار LS2، بما في ذلك المفاتيح غير المتصلة.</p>
<p>0.9.39 يحتوي على دعم I2CP لـ LS2 و Encrypted LS2، وتوقيع/التحقق من sig type 11، ودعم floodfill لـ Encrypted LS2 (أنواع التوقيع 7 و 11، بدون مفاتيح غير متصلة)، وتشفير/فك تشفير LS2 (بدون تفويض لكل عميل).</p>
<p>0.9.40 مجدول لأن يحتوي على دعم لتشفير/فك تشفير LS2 مع التخويل لكل عميل، ودعم floodfill و I2CP لـ Meta LS2، ودعم LS2 المشفر بمفاتيح غير متصلة، ودعم b32 لـ LS2 المشفر.</p>
<h2 id="أنواع-databaseentry-الجديدة">أنواع DatabaseEntry الجديدة</h2>
<p>التصميم المشفر لـ LS2 متأثر بشدة بـ <a href="https://spec.torproject.org/rend-spec-v3">واصفات الخدمة المخفية v3 الخاصة بـ Tor</a>
، والتي كانت لها أهداف تصميم مشابهة.</p>

                </article>

                
                <nav class="page-nav">
                    <a href="../../../ar/proposals/" class="page-nav-link">
                        ← Back to Proposals
                    </a>
                    
                    
                    
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                            
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                    <a href="../../../proposals/123-new-netdb-entries.txt" class="page-nav-link" download>
                        Download Source (.txt)
                    </a>
                    
                </nav>
            </div>
        </div>
    </div>
</div>

<style>
.proposals-page {
    min-height: 100vh;
    padding: var(--spacing-xl) 0;
}

.breadcrumbs {
    display: flex;
    align-items: center;
    gap: var(--spacing-xs);
    margin-bottom: var(--spacing-lg);
    font-size: 0.875rem;
    color: var(--color-text-muted);
}

.breadcrumbs a {
    color: var(--color-text-muted);
    text-decoration: none;
    transition: color var(--transition-fast);
}

.breadcrumbs a:hover {
    color: var(--color-primary);
}

.separator {
    color: var(--color-border);
}

.current {
    color: var(--color-text);
}

 
.translation-disclaimer {
    background: #fef3c7;
    border: 1px solid #f59e0b;
    border-radius: var(--radius-md);
    padding: var(--spacing-md);
    margin-bottom: var(--spacing-lg);
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: var(--spacing-md);
    flex-wrap: wrap;
}

.dark .translation-disclaimer {
    background: #78350f;
    border-color: #d97706;
}

.disclaimer-message {
    color: #92400e;
    font-size: 0.875rem;
}

.dark .disclaimer-message {
    color: #fde047;
}

.disclaimer-link {
    color: #92400e;
    font-weight: 600;
    text-decoration: underline;
    white-space: nowrap;
}

.dark .disclaimer-link {
    color: #fde047;
}

 
.proposal-header {
    margin-bottom: var(--spacing-2xl);
}

.proposal-title-section {
    margin-bottom: var(--spacing-lg);
}

.proposal-title {
    font-size: 2.5rem;
    margin: 0 0 var(--spacing-sm) 0;
    color: var(--color-text);
}

.proposal-number {
    font-size: 0.875rem;
    color: var(--color-text-muted);
    font-weight: 600;
}

 
.proposal-meta-box {
    background: var(--color-bg-secondary);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-lg);
    padding: var(--spacing-lg);
}

.proposal-status {
    display: inline-block;
    padding: var(--spacing-xs) var(--spacing-md);
    border-radius: var(--radius-md);
    font-weight: 600;
    font-size: 0.875rem;
    margin-bottom: var(--spacing-md);
    text-transform: uppercase;
    letter-spacing: 0.05em;
}

 
.status-open {
    background: #dbeafe;
    color: #0369a1;
}

.dark .status-open {
    background: #0c4a6e;
    color: #7dd3fc;
}

.status-accepted {
    background: #dbeafe;
    color: #0369a1;
}

.dark .status-accepted {
    background: #0c4a6e;
    color: #7dd3fc;
}

.status-finished {
    background: #dcfce7;
    color: #15803d;
}

.dark .status-finished {
    background: #164e63;
    color: #86efac;
}

.status-closed {
    background: #dcfce7;
    color: #15803d;
}

.dark .status-closed {
    background: #164e63;
    color: #86efac;
}

.status-rejected {
    background: #fee2e2;
    color: #991b1b;
}

.dark .status-rejected {
    background: #7f1d1d;
    color: #fca5a5;
}

.status-draft,
.status-needs-revision,
.status-dead,
.status-needs-research {
    background: #fef3c7;
    color: #92400e;
}

.dark .status-draft,
.dark .status-needs-revision,
.dark .status-dead,
.dark .status-needs-research {
    background: #78350f;
    color: #fde047;
}

.status-meta,
.status-informational,
.status-reserve {
    background: #e9d5ff;
    color: #6b21a8;
}

.dark .status-meta,
.dark .status-informational,
.dark .status-reserve {
    background: #581c87;
    color: #e879f9;
}

 
.proposal-info-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: var(--spacing-md);
    margin-bottom: var(--spacing-lg);
}

.info-item {
    display: flex;
    flex-direction: column;
    gap: var(--spacing-xs);
}

.info-label {
    font-size: 0.75rem;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    color: var(--color-text-muted);
}

.info-value {
    font-size: 0.9375rem;
    color: var(--color-text);
    font-weight: 500;
}

 
.proposal-relationships {
    border-top: 1px solid var(--color-border);
    padding-top: var(--spacing-md);
}

.relationship {
    display: flex;
    gap: var(--spacing-md);
    margin-bottom: var(--spacing-sm);
}

.relationship:last-child {
    margin-bottom: 0;
}

.relationship-label {
    font-weight: 600;
    color: var(--color-text-muted);
    min-width: 120px;
}

.relationship-value {
    color: var(--color-text);
}

 
.proposal-layout {
    display: block;
}

.proposal-layout--with-toc {
    display: grid;
    grid-template-columns: 260px 1fr;
    gap: var(--spacing-2xl);
    align-items: start;
}

 
.proposal-toc-sidebar {
    position: sticky;
    top: 100px;
    max-height: calc(100vh - 120px);
    overflow-y: auto;
}

.toc-nav {
    background: var(--color-bg-secondary);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-lg);
    padding: var(--spacing-md);
}

.toc-header {
    display: flex;
    align-items: center;
    gap: var(--spacing-sm);
    font-weight: 700;
    font-size: 0.875rem;
    color: var(--color-text);
    padding-bottom: var(--spacing-md);
    margin-bottom: var(--spacing-md);
    border-bottom: 1px solid var(--color-border);
}

.toc-content {
    max-height: calc(100vh - 250px);
    overflow-y: auto;
}

.toc-content::-webkit-scrollbar {
    width: 4px;
}

.toc-content::-webkit-scrollbar-track {
    background: transparent;
}

.toc-content::-webkit-scrollbar-thumb {
    background: var(--color-border);
    border-radius: 2px;
}

.toc-content::-webkit-scrollbar-thumb:hover {
    background: var(--color-text-muted);
}

.toc-nav ul {
    list-style: none;
    padding-left: 0;
    margin: 0;
}

.toc-nav li {
    margin-bottom: 0.25rem;
}

.toc-nav ul ul {
    padding-left: var(--spacing-md);
    margin-top: 0.25rem;
}

.toc-nav a {
    color: var(--color-text-secondary);
    text-decoration: none;
    font-size: 0.8125rem;
    display: block;
    padding: 0.25rem 0.5rem;
    border-radius: var(--radius-sm);
    transition: all var(--transition-fast);
    line-height: 1.4;
}

.toc-nav a:hover {
    color: var(--color-primary);
    background: var(--color-bg-tertiary);
}

 
.proposal-main {
    min-width: 0;
}

 
.proposal-content {
    line-height: 1.8;
    color: var(--color-text);
    max-width: 900px;
}

.proposal-content h2 {
    margin-top: var(--spacing-2xl);
    margin-bottom: var(--spacing-md);
    font-size: 1.75rem;
    scroll-margin-top: 100px;
}

.proposal-content h3 {
    margin-top: var(--spacing-xl);
    margin-bottom: var(--spacing-sm);
    font-size: 1.375rem;
    scroll-margin-top: 100px;
}

.proposal-content h4 {
    margin-top: var(--spacing-lg);
    margin-bottom: var(--spacing-xs);
    font-size: 1.125rem;
    scroll-margin-top: 100px;
}

.proposal-content p {
    margin-bottom: var(--spacing-md);
}

.proposal-content ul,
.proposal-content ol {
    margin-bottom: var(--spacing-md);
    padding-left: var(--spacing-xl);
}

.proposal-content li {
    margin-bottom: var(--spacing-xs);
}

.proposal-content code {
    background: var(--color-bg-secondary);
    padding: 0.125rem 0.375rem;
    border-radius: var(--radius-sm);
    font-size: 0.875em;
    font-family: 'Courier New', monospace;
}

.proposal-content pre {
    background: var(--color-bg-secondary);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-md);
    padding: var(--spacing-md);
    overflow-x: auto;
    margin-bottom: var(--spacing-md);
    font-size: 0.875rem;
}

.proposal-content pre code {
    background: none;
    padding: 0;
}

.proposal-content blockquote {
    border-left: 4px solid var(--color-primary);
    padding-left: var(--spacing-md);
    margin-left: 0;
    margin-bottom: var(--spacing-md);
    font-style: italic;
    color: var(--color-text-secondary);
}

.proposal-content a {
    color: var(--color-primary);
    text-decoration: none;
    border-bottom: 1px solid transparent;
    transition: border-color var(--transition-fast);
}

.proposal-content a:hover {
    border-bottom-color: var(--color-primary);
}

.proposal-content table {
    width: 100%;
    border-collapse: collapse;
    margin-bottom: var(--spacing-md);
}

.proposal-content table th {
    background: var(--color-bg-secondary);
    padding: var(--spacing-sm);
    text-align: left;
    font-weight: 600;
    border-bottom: 2px solid var(--color-border);
}

.proposal-content table td {
    padding: var(--spacing-sm);
    border-bottom: 1px solid var(--color-border);
}

.proposal-content img {
    max-width: 100%;
    height: auto;
    border-radius: var(--radius-md);
    border: 1px solid var(--color-border);
    margin: var(--spacing-lg) 0;
    display: block;
}

 
.page-nav {
    margin-top: var(--spacing-2xl);
    padding-top: var(--spacing-xl);
    border-top: 1px solid var(--color-border);
    display: flex;
    gap: var(--spacing-md);
    flex-wrap: wrap;
}

.page-nav-link {
    display: inline-block;
    padding: var(--spacing-md) var(--spacing-lg);
    background: var(--color-bg-secondary);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-md);
    color: var(--color-text);
    text-decoration: none;
    transition: all var(--transition-fast);
}

.page-nav-link:hover {
    border-color: var(--color-primary);
    color: var(--color-primary);
}

 
@media (max-width: 1024px) {
    .proposal-layout--with-toc {
        grid-template-columns: 1fr;
    }

    .proposal-toc-sidebar {
        position: static;
        max-height: none;
        margin-bottom: var(--spacing-xl);
    }

    .toc-content {
        max-height: 300px;
    }
}

@media (max-width: 768px) {
    .proposal-title {
        font-size: 1.75rem;
    }

    .proposal-info-grid {
        grid-template-columns: 1fr;
    }
}
</style>



<script>
document.addEventListener('DOMContentLoaded', function() {
    const tocLinks = document.querySelectorAll('.toc-nav a');
    const headings = [];

    tocLinks.forEach(link => {
        const href = link.getAttribute('href');
        if (href && href.startsWith('#')) {
            const heading = document.getElementById(href.slice(1));
            if (heading) {
                headings.push({ element: heading, link: link });
            }
        }
    });

    function updateActiveLink() {
        const scrollPos = window.scrollY + 120;
        let activeIndex = 0;

        for (let i = 0; i < headings.length; i++) {
            if (headings[i].element.offsetTop <= scrollPos) {
                activeIndex = i;
            }
        }

        tocLinks.forEach(link => link.classList.remove('active'));
        if (headings[activeIndex]) {
            headings[activeIndex].link.classList.add('active');
        }
    }

    window.addEventListener('scroll', updateActiveLink);
    updateActiveLink();
});
</script>
<style>
.toc-nav a.active {
    color: var(--color-primary);
    background: var(--color-bg-tertiary);
    font-weight: 600;
}
</style>



    </main>

    <footer class="site-footer">
    <div class="container">
        <div class="footer-grid">
            <div class="footer-col footer-brand">
                <img src="../../../images/i2plogo_lightmode.svg" alt="I2P Logo" class="footer-logo logo-light" loading="lazy" decoding="async">
                <img src="../../../images/i2plogo_darkmode.svg" alt="I2P Logo" class="footer-logo logo-dark" loading="lazy" decoding="async">
                <p class="footer-tagline">Privacy. Security. Freedom.</p>
                <p class="footer-description">The Invisible Internet Project - A privacy-focused, anonymous network layer</p>

                <div class="footer-social-newsletter">
                    <div class="social-links">
                        <a href="https://mastodon.social/@i2p" target="_blank" rel="noopener" aria-label="Mastodon">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M21.327 8.566c0-4.339-2.843-5.61-2.843-5.61-1.433-.658-3.894-.935-6.451-.956h-.063c-2.557.021-5.016.298-6.45.956 0 0-2.843 1.272-2.843 5.61 0 .993-.019 2.181.012 3.441.103 4.243.778 8.425 4.701 9.463 1.809.479 3.362.579 4.612.51 2.268-.126 3.541-.809 3.541-.809l-.075-1.646s-1.621.511-3.441.449c-1.804-.062-3.707-.194-3.999-2.409a4.523 4.523 0 0 1-.04-.621s1.77.433 4.014.536c1.372.063 2.658-.08 3.965-.236 2.506-.299 4.688-1.843 4.962-3.254.434-2.223.398-5.424.398-5.424zm-3.353 5.59h-2.081V9.057c0-1.075-.452-1.62-1.357-1.62-1 0-1.501.647-1.501 1.927v2.791h-2.069V9.364c0-1.28-.501-1.927-1.502-1.927-.905 0-1.357.546-1.357 1.62v5.099H6.026V8.903c0-1.074.273-1.927.823-2.558.566-.631 1.307-.955 2.228-.955 1.065 0 1.872.409 2.405 1.228l.518.869.519-.869c.533-.819 1.34-1.228 2.405-1.228.92 0 1.662.324 2.228.955.549.631.822 1.484.822 2.558v5.253z"/>
                            </svg>
                        </a>
                        <a href="https://twitter.com/GetI2P" target="_blank" rel="noopener" aria-label="Twitter">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/>
                            </svg>
                        </a>
                        <a href="https://old.reddit.com/r/i2p" target="_blank" rel="noopener" aria-label="Reddit">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M12 0A12 12 0 0 0 0 12a12 12 0 0 0 12 12 12 12 0 0 0 12-12A12 12 0 0 0 12 0zm5.01 4.744c.688 0 1.25.561 1.25 1.249a1.25 1.25 0 0 1-2.498.056l-2.597-.547-.8 3.747c1.824.07 3.48.632 4.674 1.488.308-.309.73-.491 1.207-.491.968 0 1.754.786 1.754 1.754 0 .716-.435 1.333-1.01 1.614a3.111 3.111 0 0 1 .042.52c0 2.694-3.13 4.87-7.004 4.87-3.874 0-7.004-2.176-7.004-4.87 0-.183.015-.366.043-.534A1.748 1.748 0 0 1 4.028 12c0-.968.786-1.754 1.754-1.754.463 0 .898.196 1.207.49 1.207-.883 2.878-1.43 4.744-1.487l.885-4.182a.342.342 0 0 1 .14-.197.35.35 0 0 1 .238-.042l2.906.617a1.214 1.214 0 0 1 1.108-.701zM9.25 12C8.561 12 8 12.562 8 13.25c0 .687.561 1.248 1.25 1.248.687 0 1.248-.561 1.248-1.249 0-.688-.561-1.249-1.249-1.249zm5.5 0c-.687 0-1.248.561-1.248 1.25 0 .687.561 1.248 1.249 1.248.688 0 1.249-.561 1.249-1.249 0-.687-.562-1.249-1.25-1.249zm-5.466 3.99a.327.327 0 0 0-.231.094.33.33 0 0 0 0 .463c.842.842 2.484.913 2.961.913.477 0 2.105-.056 2.961-.913a.361.361 0 0 0 .029-.463.33.33 0 0 0-.464 0c-.547.533-1.684.73-2.512.73-.828 0-1.979-.196-2.512-.73a.326.326 0 0 0-.232-.095z"/>
                            </svg>
                        </a>
                        <a href="https://signal.group/#CjQKIOSUTtxlhbumAKcRsthPFkxkTUrkWcX39bbN6njLEgAIEhCTNsR0KDuiehAXZnkt42v5" target="_blank" rel="noopener" aria-label="Signal" class="signal-link">
                            <img src="../../../images/Signal-Logo-Black.svg" alt="Signal" class="signal-logo signal-logo-light" loading="lazy" decoding="async">
                            <img src="../../../images/Signal-Logo-White.svg" alt="Signal" class="signal-logo signal-logo-dark" loading="lazy" decoding="async">
                        </a>
                    </div>

                    
                    <div class="footer-newsletter-inline">
                        <p class="newsletter-description">ابقَ على اطلاع بأخبار I2P:</p>
                        <form action="https://feedback.i2p.net/api/mailing-list/subscribe" method="POST" class="newsletter-form">
                            <input type="email" name="email" placeholder="أدخل بريدك الإلكتروني" required>
                            <button type="submit">اشترك</button>
                        </form>
                    </div>
                </div>
            </div>

            <div class="footer-col">
                <h3>روابط سريعة</h3>
                <ul>
                    <li><a href="../../../ar/financial-support/">تبرع</a></li>
                    <li><a href="../../../ar/docs/overview/intro/">مقدمة I2P</a></li>
                </ul>
            </div>

            <div class="footer-col">
                <h3>المجتمع</h3>
                <ul>
                    <li><a href="../../../ar/get-involved/">شارك معنا</a></li>
                    <li><a href="../../../ar/blog/">مدونة</a></li>
                    <li><a href="http://i2pforum.net/" target="_blank" rel="noopener">المنتديات الرسمية</a></li>
                    <li><a href="../../../ar/contact/">اتصل بنا</a></li>
                </ul>
            </div>

            <div class="footer-col">
                <h3>الموارد</h3>
                <ul>
                    <li><a href="https://i2p-metrics.np-tokumei.net/" target="_blank" rel="noopener">إحصائيات I2P</a></li>
                    <li><a href="../../../ar/papers/">بحث</a></li>
                    <li><a href="https://i2pgit.org/" target="_blank" rel="noopener">GitLab</a></li>
                    <li><a href="https://www.stormycloud.org/" target="_blank" rel="noopener">ستورمي كلاود</a></li>
                </ul>
            </div>
        </div>

        <div class="footer-bottom">
            <p class="copyright">&copy; 2025 مشروع الإنترنت الخفي. مرخص تحت Creative Commons.</p>
            <div class="footer-links">
                <a href="../../../ar/privacy/">الخصوصية</a>
                <a href="../../../ar/terms/">الشروط</a>
                <a href="../../../ar/about/media/">الصحافة</a>
            </div>
        </div>
    </div>
</footer>


    
    
<div class="modal-overlay" id="poll">
    <div class="modal-content poll-modal-content">
        <a href="#" class="modal-close" aria-label="إغلاق">
            <span aria-hidden="true">&times;</span>
        </a>

        <div class="modal-header">
            <h2>استطلاع المجتمع</h2>
            <p class="modal-subtitle">نود أن نسمع منك</p>
        </div>

        <div class="modal-body">
            
            <iframe 
                id="poll-iframe"
                data-poll-id="2"
                data-api-url="https://feedback.i2p.net"
                frameborder="0"
                scrolling="no"
                style="width: 100%; border: none; min-height: 400px;">
            </iframe>
        </div>

        <div class="modal-footer">
            <p class="modal-disclaimer">
                يساعد تصويتك في تشكيل مستقبل I2P.
            </p>
        </div>
    </div>
</div>


<script>
(function() {
    const iframe = document.getElementById('poll-iframe');
    if (!iframe) return;
    
    const hostname = window.location.hostname;
    let apiUrl = 'https://feedback.i2p.net';
    const pollId = iframe.getAttribute('data-poll-id') || '1';

    
    if (hostname.endsWith('.b32.i2p') || hostname.endsWith('.i2p')) {
        apiUrl = 'http://5kwyynf3eetgqa2nors6ctwo7doi7yu73k7uvypy5eqmm326zkiq.b32.i2p';
    }
    
    else if (hostname.endsWith('.onion')) {
        apiUrl = 'http://gfonxmohvarpmocsvllscsuszdu5rikipm6innvcwq4vpng7zzqmmfyd.onion';
    }

    
    const pollUrl = apiUrl + '/widgets/poll.html?poll_id=' + encodeURIComponent(pollId) + '&api_url=' + encodeURIComponent(apiUrl);
    iframe.src = pollUrl;
})();
</script>



    
    



    
    <script>
        (function () {
            'use strict';
            var hostname = window.location.hostname;
            var baseUrl;

            
            if (hostname.endsWith('.b32.i2p') || hostname.endsWith('.i2p')) {
                baseUrl = 'http://5kwyynf3eetgqa2nors6ctwo7doi7yu73k7uvypy5eqmm326zkiq.b32.i2p';
            } else if (hostname.endsWith('.onion')) {
                baseUrl = 'http://gfonxmohvarpmocsvllscsuszdu5rikipm6innvcwq4vpng7zzqmmfyd.onion';
            } else {
                baseUrl = 'https://feedback.i2p.net';
            }

            window.feedbackBaseUrl = baseUrl;

            
            document.querySelectorAll('[data-api-url]').forEach(function (widget) {
                widget.setAttribute('data-api-url', baseUrl);
            });

            
            document.write('<link rel="stylesheet" href="' + baseUrl + '/widgets/styles.css">');
            
        })();
    </script>

    

    
    
    

    

</body>

</html>
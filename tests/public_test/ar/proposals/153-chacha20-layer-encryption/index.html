<!DOCTYPE html>
<html lang="ar" data-theme="light">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <title>تشفير طبقة النفق في ChaCha | I2P - مشروع الإنترنت غير المرئي</title>

    <meta name="description" content="The Invisible Internet Project - A privacy-focused, anonymous network layer">
    <meta name="keywords" content="i2p, privacy, anonymity, dark net, encryption, security">

    
    <meta property="og:title" content="تشفير طبقة النفق في ChaCha | I2P - مشروع الإنترنت غير المرئي">
    <meta property="og:description" content="The Invisible Internet Project - A privacy-focused, anonymous network layer">
    <meta property="og:type" content="website">
    <meta property="og:url" content="/ar/proposals/153-chacha20-layer-encryption/">

    
    <link rel="icon" type="image/svg+xml" href="../../../images/favicon.svg">
    <link rel="icon" type="image/png" href="../../../images/i2plogo.png" sizes="32x32">

    
    
    
    
    <link rel="stylesheet" href="../../../css/main.min.be6880f32f5ff44e57579da7b11513b973319944ebe38748e3ac7f3268662d18.css" integrity="sha256-vmiA8y9f9E5XV52nsRUTuXMxmUTr44dI46x/MmhmLRg=">
    


    
</head>

<body>
    
    <input type="checkbox" id="theme-toggle-checkbox" class="theme-checkbox" aria-hidden="true">

    
<div class="site-banner" id="site-banner" data-banner-id="banner-3" role="alert" aria-live="polite">
    <div class="container">
        <div class="banner-content">
            <span class="banner-message">موقع I2P التجريبي متاح الآن - أرسل المشاكل إلى stormycloud@mail.i2p</span>
            
        </div>
        
        <form method="GET" action="../../../api/banner/dismiss" style="display: inline;">
            <input type="hidden" name="id" value="banner-3">
            <button type="submit" class="banner-close" aria-label="إغلاق الشريط" title="إغلاق الشريط">
                <span aria-hidden="true">&times;</span>
            </button>
        </form>
        
    </div>
</div>


    <header class="site-header">
    <div class="container">
        <nav class="main-nav">
            <div class="nav-brand">
                <a href="../../../ar/" class="logo-link">
                    <img src="../../../images/i2plogo_lightmode.svg" alt="I2P Logo" class="logo logo-light">
                    <img src="../../../images/i2plogo_darkmode.svg" alt="I2P Logo" class="logo logo-dark">
                </a>
            </div>

            
            <input type="checkbox" id="mobile-menu-checkbox" class="mobile-menu-checkbox"
                aria-label="Toggle navigation menu">
            <label for="mobile-menu-checkbox" class="mobile-menu-toggle" aria-label="Toggle navigation menu">
                <span class="hamburger"></span>
            </label>

            <div class="nav-menu">
                <ul class="nav-links">
                    <li class="nav-dropdown">
                        <a href="../../../ar/about/" class="">حول</a>
                        <ul class="dropdown-menu">
                            <li><a href="../../../ar/about/">نظرة عامة</a></li>
                            <li><a href="../../../ar/papers/">أبحاث</a></li>
                            <li><a href="../../../ar/about/media/">الصحافة</a></li>
                            <li><a href="../../../ar/contact/">اتصل بنا</a></li>
                        </ul>
                    </li>
                    <li><a href="../../../ar/docs/" class="">المستندات</a></li>
                    <li><a href="../../../ar/downloads/" class="">التنزيلات</a></li>
                    <li><a href="../../../ar/blog/" class="">مدونة</a></li>
                    <li class="nav-dropdown">
                        <a href="../../../ar/get-involved/" class="">شارك معنا</a>
                        <ul class="dropdown-menu">
                            <li><a href="../../../ar/get-involved/">نظرة عامة</a></li>
                            <li><a href="../../../ar/feedback/">اقتراحات الميزات</a></li>
                        </ul>
                    </li>
                </ul>

                <div class="nav-actions">
                    
                    <div class="language-selector">
                        <button class="language-toggle" aria-label="Select language" title="Language">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none"
                                xmlns="http://www.w3.org/2000/svg">
                                <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2" />
                                <path
                                    d="M2 12h20M12 2a15.3 15.3 0 014 10 15.3 15.3 0 01-4 10 15.3 15.3 0 01-4-10 15.3 15.3 0 014-10z"
                                    stroke="currentColor" stroke-width="2" />
                            </svg>
                            <span class="current-lang">ar</span>
                        </button>
                        <div class="language-dropdown">
                            
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../en/proposals/153-chacha20-layer-encryption/"
                                class="lang-option">الإنجليزية</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../es/proposals/153-chacha20-layer-encryption/"
                                class="lang-option">الإسبانية</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../ko/proposals/153-chacha20-layer-encryption/"
                                class="lang-option">الكورية</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../zh/proposals/153-chacha20-layer-encryption/"
                                class="lang-option">الصينية</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../ru/proposals/153-chacha20-layer-encryption/"
                                class="lang-option">الروسية</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../cs/proposals/153-chacha20-layer-encryption/"
                                class="lang-option">التشيكية</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../de/proposals/153-chacha20-layer-encryption/"
                                class="lang-option">الألمانية</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../fr/proposals/153-chacha20-layer-encryption/"
                                class="lang-option">الفرنسية</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../tr/proposals/153-chacha20-layer-encryption/"
                                class="lang-option">التركية</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../vi/proposals/153-chacha20-layer-encryption/"
                                class="lang-option">الفيتنامية</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../hi/proposals/153-chacha20-layer-encryption/"
                                class="lang-option">الهندية</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../ar/proposals/153-chacha20-layer-encryption/"
                                class="lang-option active">العربية</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../pt/proposals/153-chacha20-layer-encryption/"
                                class="lang-option">البرتغالية</a>
                            
                            
                        </div>
                    </div>

                    
                    <label for="theme-toggle-checkbox" class="theme-toggle" aria-label="Toggle dark mode"
                        title="Toggle theme">
                        <svg class="sun-icon" width="20" height="20" viewBox="0 0 20 20" fill="none"
                            xmlns="http://www.w3.org/2000/svg">
                            <circle cx="10" cy="10" r="4" stroke="currentColor" stroke-width="2" />
                            <path
                                d="M10 2V4M10 16V18M18 10H16M4 10H2M15.657 4.343L14.243 5.757M5.757 14.243L4.343 15.657M15.657 15.657L14.243 14.243M5.757 5.757L4.343 4.343"
                                stroke="currentColor" stroke-width="2" stroke-linecap="round" />
                        </svg>
                        <svg class="moon-icon" width="20" height="20" viewBox="0 0 20 20" fill="none"
                            xmlns="http://www.w3.org/2000/svg">
                            <path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"
                                stroke="currentColor" stroke-width="2" stroke-linejoin="round" />
                        </svg>
                    </label>

                    
                    <a href="../../../ar/financial-support/" class="btn btn-primary" id="donate-btn">Donate</a>

                    
                    <a href="../../../ar/downloads/" class="btn btn-primary">احصل على I2P</a>
                </div>
            </div>
        </nav>
    </div>
</header>

    <main id="main-content">
        



<div class="proposals-page">
    <div class="container">
        
        <nav class="breadcrumbs">
            <a href="../../../ar/">Home</a>
            <span class="separator">/</span>
            <a href="../../../ar/proposals/">Proposals</a>
            <span class="separator">/</span>
            <span class="current">تشفير طبقة النفق في ChaCha</span>
        </nav>

        
<div class="translation-disclaimer" role="note">
    <span class="disclaimer-message">تم إنشاء هذه الترجمة باستخدام التعلم الآلي وقد لا تكون دقيقة بنسبة 100%.</span>
    
    
    <a href="../../../en/proposals/153-chacha20-layer-encryption/" class="disclaimer-link">عرض النسخة الإنجليزية</a>
    
</div>



        
        <header class="proposal-header">
            <div class="proposal-title-section">
                <h1 class="proposal-title">تشفير طبقة النفق في ChaCha</h1>
                <div class="proposal-number">Proposal 153</div>
            </div>

            
            <div class="proposal-meta-box">
                <div class="proposal-status status-مفتوح">
                    مفتوح
                </div>

                
                <div class="proposal-info-grid">
                    
                    <div class="info-item">
                        <span class="info-label">Author</span>
                        <span class="info-value">chisana</span>
                    </div>
                    

                    
                    <div class="info-item">
                        <span class="info-label">Created</span>
                        <span class="info-value">2019-08-04</span>
                    </div>
                    

                    
                    <div class="info-item">
                        <span class="info-label">Last Updated</span>
                        <span class="info-value">2019-08-05</span>
                    </div>
                    

                    

                    
                </div>

                
                
            </div>
        </header>

        
        <div class="proposal-layout proposal-layout--with-toc">
            
            
            <aside class="proposal-toc-sidebar">
                <nav class="toc-nav">
                    <div class="toc-header">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                            <path d="M4 6h16M4 12h16M4 18h16" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                        </svg>
                        On This Page
                    </div>
                    <div class="toc-content">
                        <nav id="TableOfContents">
  <ul>
    <li><a href="#نظرة-عامة">نظرة عامة</a>
      <ul>
        <li><a href="#الأهداف">الأهداف</a></li>
        <li><a href="#معالجة-الرسائل-المثبتة-في-النفق">معالجة الرسائل المثبتة في النفق</a></li>
        <li><a href="#تشفير-aead-للرسائل-من-قفزة-إلى-قفزة">تشفير AEAD للرسائل من قفزة إلى قفزة</a></li>
        <li><a href="#معالجة-انتخابات-الرسائل-للبوابات-وخالقي-النفق">معالجة انتخابات الرسائل للبوابات وخالقي النفق</a></li>
        <li><a href="#المعالجة-المسبقة-والتشفير-للبوابة">المعالجة المسبقة والتشفير للبوابة</a></li>
        <li><a href="#معالجة-المشاركين">معالجة المشاركين</a></li>
        <li><a href="#معالجة-النقطة-النهائية-الداخلة">معالجة النقطة النهائية الداخلة</a></li>
        <li><a href="#التحليل-الأمني-لتشفير-طبقة-النفق-chacha20chacha20-poly1305">التحليل الأمني لتشفير طبقة النفق ChaCha20+ChaCha20-Poly1305</a></li>
      </ul>
    </li>
    <li><a href="#المراجع">المراجع</a></li>
  </ul>
</nav>
                    </div>
                </nav>
            </aside>
            

            
            <div class="proposal-main">
                <article class="proposal-content">
                    <h2 id="نظرة-عامة">نظرة عامة</h2>
<p>يستند هذا الاقتراح ويتطلب التغييرات من الاقتراح 152: أنفاق ECIES.</p>
<p>فقط الأنفاق المبنية من خلال القفزات التي تدعم صيغة BuildRequestRecord لأنفاق ECIES-X25519 يمكنها تنفيذ هذه المواصفات.</p>
<p>تتطلب هذه المواصفات تنسيق خيارات بناء النفق للإشارة إلى نوع تشفير طبقة النفق ونقل مفاتيح طبقة AEAD.</p>
<h3 id="الأهداف">الأهداف</h3>
<p>الأهداف من هذا الاقتراح هي:</p>
<ul>
<li>استبدال AES256/ECB+CBC بـChaCha20 لتشفير طبقة النفق المثبتة وIV</li>
<li>استخدام ChaCha20-Poly1305 لحماية AEAD بين القفزات</li>
<li>عدم الكشف عن تشفير طبقة النفق القائم للمشاركين غير المشتركين في النفق</li>
<li>عدم إجراء أي تغييرات على طول الرسائل العلوية للنفق</li>
</ul>
<h3 id="معالجة-الرسائل-المثبتة-في-النفق">معالجة الرسائل المثبتة في النفق</h3>
<p>هذا القسم يصف التغييرات على:</p>
<ul>
<li>المعالجة المسبقة + التشفير لبوايات الخارجة والداخلة</li>
<li>التشفير + معالجة المشاركين</li>
<li>التشفير + معالجة النقاط النهائية الخارج والداخل</li>
</ul>
<p>للحصول على نظرة عامة على معالجة رسائل النفق الحالية، راجع المواصفات في <a href="../../../ar/docs/specs/implementation/">Tunnel Implementation</a>
.</p>
<p>فقط التغييرات للراوترات التي تدعم تشفير طبقة ChaCha20 تتم مناقشتها.</p>
<p>لا يعتبر أي تغييرات للأنفاق المختلطة بتشفير AES للطبقة، حتى يمكن تصميم بروتوكول آمن لتحويل IV بعرض 128-بت من AES إلى nonce بعرض 64-بت من ChaCha20. يضمن فلتر بلوم التفرد للـIV بالكامل، ولكن يمكن أن يكون النصف الأول من IVs الفردية متطابقًا.</p>
<p>يعني هذا أن يكون تشفير الطبقة موحدًا لجميع القفزات في النفق، وويتم تثبيته باستخدام عمليات بناء النفق أثناء عملية إنشاء النفق.</p>
<p>جميع البوابات والمشاركين في النفق سيحتاجون للحفاظ على فلتر بلوم للتحقق من صحة النونسيات المستقلة الاثنين.</p>
<p><code>nonceKey</code> المذكور في جميع أنحاء هذا الاقتراح يحل محل <code>IVKey</code> المستخدم في تشفير الطبقة AES. يتم توليده باستخدام نفس KDF من الاقتراح 152.</p>
<h3 id="تشفير-aead-للرسائل-من-قفزة-إلى-قفزة">تشفير AEAD للرسائل من قفزة إلى قفزة</h3>
<p>سيتعين توليد مفتاح <code>AEADKey</code> فريد إضافي لكل زوج من القفزات المتتالية. سيتم استخدام هذا المفتاح من قبل القفزات المتتالية لتشفير وتفك تشفير الرسالة النفقية المشفرة الداخليًا في ChaCha20.</p>
<p>ستحتاج رسائل النفق إلى تقليل طول الإطار المشفر الداخلي بمقدار 16 بايت لإفساح المجال لـPoly1305 MAC.</p>
<p>لا يمكن استخدام AEAD على الرسائل مباشرة، حيث يلزم فك التشفير المتكرر بواسطة الأنفاق الخارجة. يمكن تحقيق فك التشفير المتكرر، بالطريقة التي يستخدم بها الآن، باستخدام ChaCha20 بدون AEAD.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>+----+----+----+----+----+----+----+----+
</span></span><span style="display:flex;"><span>  |    Tunnel ID      |   tunnelNonce     |
</span></span><span style="display:flex;"><span>  +----+----+----+----+----+----+----+----+
</span></span><span style="display:flex;"><span>  | tunnelNonce cont. |    obfsNonce      |
</span></span><span style="display:flex;"><span>  +----+----+----+----+----+----+----+----+
</span></span><span style="display:flex;"><span>  |  obfsNonce cont.  |                   |
</span></span><span style="display:flex;"><span>  +----+----+----+----+                   +
</span></span><span style="display:flex;"><span>  |                                       |
</span></span><span style="display:flex;"><span>  +           Encrypted Data              +
</span></span><span style="display:flex;"><span>  ~                                       ~
</span></span><span style="display:flex;"><span>  |                                       |
</span></span><span style="display:flex;"><span>  +                   +----+----+----+----+
</span></span><span style="display:flex;"><span>  |                   |    Poly1305 MAC   |
</span></span><span style="display:flex;"><span>  +----+----+----+----+                   +
</span></span><span style="display:flex;"><span>  |                                       |
</span></span><span style="display:flex;"><span>  +                   +----+----+----+----+
</span></span><span style="display:flex;"><span>  |                   |
</span></span><span style="display:flex;"><span>  +----+----+----+----+
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  Tunnel ID :: `TunnelId`
</span></span><span style="display:flex;"><span>         4 bytes
</span></span><span style="display:flex;"><span>         the ID of the next hop
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  tunnelNonce ::
</span></span><span style="display:flex;"><span>         8 bytes
</span></span><span style="display:flex;"><span>         the tunnel layer nonce
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  obfsNonce ::
</span></span><span style="display:flex;"><span>         8 bytes
</span></span><span style="display:flex;"><span>         the tunnel layer nonce encryption nonce
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  Encrypted Data ::
</span></span><span style="display:flex;"><span>         992 bytes
</span></span><span style="display:flex;"><span>         the encrypted tunnel message
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  Poly1305 MAC ::
</span></span><span style="display:flex;"><span>         16 bytes
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  total size: 1028 Bytes
</span></span></code></pre></div><p>ستحصل القفزات الداخلية (بوجود قفزات تسبقها وتليها) على مفتاحي <code>AEADKeys</code>، أحدهما لفك تشفير طبقة AEAD للقفزة السابقة، والآخر لتشفير طبقة AEAD للقفزة التالية.</p>
<p>سيكون لدى جميع المشاركين الداخليين 64 بايت إضافي من مادة المفاتيح المدرجة في سجلات بناء طلباتهم.</p>
<p>ستحتاج الـGateway الخارجة والـ Endpoint الداخلي فقط إلى 32 بايت إضافي من بيانات المفتاح، لأنها لا تقوم بتشفير الرسائل عبر طبقة النفق بين بعضها البعض.</p>
<p>ينشئ الـGateway الخارجي مفتاح <code>outAEAD</code> الخاص به، ومن نفسه المفتاح <code>inAEAD</code> لأول قفزة خارجة.</p>
<p>ينشئ الـEndpoint الداخلي مفتاح <code>inAEAD</code> الخاص به، والذي يكون نفسه مثل المفتاح <code>outAEAD</code> للقفزة الأخيرة الداخلة.</p>
<p>القفزات الداخلية ستستلم مفتاح <code>inAEADKey</code> ومفتاح <code>outAEADKey</code> وسيستخدمان لفك AEAD الرسائل الواردة وتشفير الرسائل الصادرة على التوالي.</p>
<p>كمثال، في نفق به قفزات داخلية OBGW, A, B, OBEP:</p>
<ul>
<li>مفتاح <code>inAEADKey</code> لـ A هو نفسه مثل مفتاح <code>outAEADKey</code> لـ OBGW</li>
<li>مفتاح <code>inAEADKey</code> لـ B هو نفسه مثل مفتاح <code>outAEADKey</code> لـ A</li>
<li>مفتاح <code>outAEADKey</code> لـ B هو نفسه مثل مفتاح <code>inAEADKey</code> لـ OBEP</li>
</ul>
<p>المفاتيح فريدة لأزواج القفزات، لذلك مفتاح <code>inAEADKey</code> لـ OBEP سيكون مختلف عن مفتاح <code>inAEADKey</code> لـ A، ومفتاح <code>outAEADKey</code> لـ A مختلف عن مفتاح <code>outAEADKey</code> لـ B، وهكذا.</p>
<h3 id="معالجة-انتخابات-الرسائل-للبوابات-وخالقي-النفق">معالجة انتخابات الرسائل للبوابات وخالقي النفق</h3>
<p>ستقوم البوابات بتجزئة وتجميع الرسائل بنفس الطريقة، مع تخصيص مساحة بعد إطار التعليمات-التجزئة للـPoly1305 MAC.</p>
<p>يمكن تقسيم رسائل I2NP الداخلية التي تحتوي على أطر AEAD (بما في ذلك MAC) عبر القطع، لكن أي قطع مفقودة ستؤدي إلى فشل فك تشفير AEAD (فشل التحقق من MAC) في النقطة النهاية.</p>
<h3 id="المعالجة-المسبقة-والتشفير-للبوابة">المعالجة المسبقة والتشفير للبوابة</h3>
<p>عند دعم الأنفاق لتشفير طبقة ChaCha20، ستنشئ البوابات نونسيات 64-بت لكل مجموعة رسائل.</p>
<p>الأنفاق الداخلة:</p>
<ul>
<li>
<p>تشفير الـIV ورسالة(رسائل) النفق باستخدام ChaCha20</p>
</li>
<li>
<p>استخدام نونسي <code>tunnelNonce</code> و<code>obfsNonce</code> بحجم 8-بايت نظرًا لعمر الأنفاق</p>
</li>
<li>
<p>استخدام نونسي <code>obfsNonce</code> لتشفير <code>tunnelNonce</code></p>
</li>
<li>
<p>تدمير النفق قبل مجموعات رسائل تبلغ 2^(64 - 1) - 1: 2^63 - 1 = 9,223,372,036,854,775,807</p>
<ul>
<li>الحد من استخدام النونسي موجود لمنع تصادم النونسيات 64-بت</li>
<li>من المستحيل تقريبًا الوصول إلى الحد العلوي من النونسيات، حيث يعادل هذا أكثر من ~15,372,286,728,091,294 رسائل/ثانية لأنفاق 10 دقائق</li>
</ul>
</li>
<li>
<p>ضبط فلتر بلوم بناءً على عدد معقول من العناصر المتوقعة (128 رسالة/ثانية، 1024 رسالة/ثانية؟ سيتم تحديده لاحقًا)</p>
</li>
</ul>
<p>تقوم بوابة النفق الداخلي (IBGW) بمعالجة الرسائل المستلمة من نقطة النهاية الخارجة لنفق آخر (OBEP).</p>
<p>في هذه المرحلة، تكون طبقة الرسالة الخارجية مشفرة باستخدام التشفير النقطة للنقطة للنقل. تكون رؤوس رسالة I2NP مرئية، في طبقة النفق، لـ OBEP و IBGW. الرسائل الداخلية لـ I2NP مغلفة في فصائل الثوم، ومشفرة باستخدام التشفير الطرف للطرف.</p>
<p>يقوم IBGW بمعالجة الرسائل مسبقًا في رسائل النفق المناسبة ويشفرة كما يلي:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>// يولد IBGW نونسيات عشوائية، لضمان عدم الاصطدام في فلتر البلوم لنونسيه
</span></span><span style="display:flex;"><span>  tunnelNonce = Random(len = 64-bits)
</span></span><span style="display:flex;"><span>  obfsNonce = Random(len = 64-bits)
</span></span><span style="display:flex;"><span>  // يشفر IBGW &#34;بـChaCha20 كل من الرسائل المُعالجة مسبقًا بالنونسي الخاص به والمفتاح الخاص بطبقته
</span></span><span style="display:flex;"><span>  encMsg = ChaCha20(msg = tunnel msg, nonce = tunnelNonce, key = layerKey)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  // تشفر الرسائل بالإطار المشفر باستخدام ChaCha20-Poly1305 باستخدام النونسي tunnelNonce ومفتاح outAEADKey
</span></span><span style="display:flex;"><span>  (encMsg, MAC) = ChaCha20-Poly1305-Encrypt(msg = encMsg, nonce = tunnelNonce, key = outAEADKey)
</span></span></code></pre></div><p>سيتم تغيير صيغة رسالة النفق قليلًا، باستخدام نونسيتين بحجم 8 بايت بدلاً من IV بحجم 16 بايت. يتم إلحاق <code>obfsNonce</code> المستخدمة لتشفير النونسي مع <code>tunnelNonce</code> بحجم 8 بايت، وتشفيرها من قبل كل قفزة باستخدام <code>tunnelNonce</code> المشفر ومفتاح <code>nonceKey</code> الخاص بالقفزة.</p>
<p>بعد أن يتم فك تشفير الرسالة مسبقًا لكل قفزة، يقوم الـGateway الخارجي بتشفير ChaCha20-Poly1305 AEAD للمحتوى السري من كل رسالة نفق باستخدام <code>tunnelNonce</code> و مفتاح <code>outAEADKey</code> الخاص به.</p>
<p>الأنفاق الخارجة:</p>
<ul>
<li>فك تشفير الرسائل بالنفق بشكل متكرر</li>
<li>تشفير ChaCha20-Poly1305 الرسالة التي تم فك تشفيرها مسبقًا المرتبطة بأطر الرسائل بدون مراجعه</li>
<li>استخدام نفس قواعد النونسي لطبقة الأنفاق كأنفاق داخلة</li>
<li>توليد نونسيات عشوائية لكل مجموعة من الرسائل المستخدمة في النفق</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>// للحصول على كل مجموعة من الرسائل، إنشاء نونسيات فريدة وعشوائية
</span></span><span style="display:flex;"><span>  tunnelNonce = Random(len = 64-bits)
</span></span><span style="display:flex;"><span>  obfsNonce = Random(len = 64-bits)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  // لكل قفزة، استخدم ChaCha20 على النونسي السابق الخاص بالنفق مع مفتاح IV الخاص بالقفزة الحالية
</span></span><span style="display:flex;"><span>  tunnelNonce = ChaCha20(msg = prev. tunnelNonce, nonce = obfsNonce, key = hop&#39;s nonceKey)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  // لكل قفزة، فك تشفير ChaCha20 للرسالة الخاصة بالنفق باستخدام النونسي الخاص بالقفزة الحالي ومفتاح الطبقة
</span></span><span style="display:flex;"><span>  decMsg = ChaCha20(msg = tunnel msg(s), nonce = tunnelNonce, key = hop&#39;s layerKey)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  // لكل قفزة، فك تشفير ChaCha20 للـobfsNonce باستخدام النونسي المشفر الخاص بالنفق الحالي والمفتاح nonceKey الخاص بالقفزة
</span></span><span style="display:flex;"><span>  obfsNonce = ChaCha20(msg = obfsNonce, nonce = tunnelNonce, key = hop&#39;s nonceKey)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  // بعد معالجة القفزة، تشفير ChaCha20-Poly1305 لكل إطار بيانات مشفراً ``&#34;مفكوك&#34; `` مع النونسي الخاص بنفق القفزة الأول والمفتاح inAEADKey الخاص بالقفزة الأولى
</span></span><span style="display:flex;"><span>  (encMsg, MAC) = ChaCha20-Poly1305-Encrypt(msg = decMsg, nonce = first hop&#39;s encrypted tunnelNonce, key = first hop&#39;s inAEADKey / GW outAEADKey)
</span></span></code></pre></div><h3 id="معالجة-المشاركين">معالجة المشاركين</h3>
<p>سيتابع المشاركون الرسائل المرئية بنفس الطريقة، باستخدام فلاتر بلوم المتقادمة.</p>
<p>تحتاج النونسيات الخاصة بالنفق إلى تشفيرها مرة واحدة لكل قفزة، لمنع هجمات التأكيد من قبل القفزات المتعاونة غير المتتابعة.</p>
<p>ستقوم القفزات بتشفير النونسي المستلم لمنع هجمات التأكيد بين القفزات السابقة والتالية، أي القفزات المتعاونة غير المتتابعة التي تمكن معرفة أنها تنتمي لنفس النفق.</p>
<p>للتحقق من صحة <code>tunnelNonce</code> و<code>obfsNonce</code> المستلمة، يقوم المشاركون بالتحقق من كل نونسي بشكل فردي ضد فلتر بلوم للتأكد من عدم التكرار.</p>
<p>بعد التحقق، يقوم المشارك:</p>
<ul>
<li>يفك تشفير كل الرسائل الخاصة بالنفق باستخدام ChaCha20-Poly1305 لفك تشفير الإطار المحدث باستخدام النونسي المتلقى ومفتاح inAEADKey الخاص به</li>
<li>تشفير <code>tunnelNonce</code> باستخدام <code>nonceKey</code> الخاص به و<code>obfsNonce</code> المستلمة</li>
<li>تشفير كل إطارات البيانات المشفرة للرسائل الخاصة بالنفق باستخدام <code>tunnelNonce</code> المشفرة ومفتاح <code>layerKey</code> الخاص به</li>
<li>تشفير ChaCha20-Poly1305 لكل إطار بيانات مشفر بواسطة الرسالة الخاصة بالنفق باستخدام <code>tunnelNonce</code> المشفرة ومفتاح <code>outAEADKey</code> الخاص به</li>
<li>تشفير <code>obfsNonce</code> باستخدام <code>nonceKey</code> الخاص به و<code>tunnelNonce</code> المشفر</li>
<li>إرسال المجموعة {<code>nextTunnelId</code>، مشفرة (<code>tunnelNonce</code> || <code>obfsNonce</code>)، AEAD ciphertext || MAC} إلى القفزة التالية.</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>// للتحقق، ينبغي على قفزات النفق التحقق من فلتر بلوم لمدى تفرد كل نونسي مستلم
</span></span><span style="display:flex;"><span>  // بعد التحقق، قُم بفك إطار AEAD عن طريق فك ChaCha20-Poly1305 لكل إطار مشفر للرسالة الخاصة بالنفق مع النونسي المستلم ومفتاح inAEADKey
</span></span><span style="display:flex;"><span>  encTunMsg = ChaCha20-Poly1305-Decrypt(msg = received encMsg \|\| MAC, nonce = received tunnelNonce, key = inAEADKey)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  // تشفير ChaCha20 للنونسي الخاص بالنفق باستخدام النونسي و``nonceKey`` الخاص بالقفزة
</span></span><span style="display:flex;"><span>  tunnelNonce = ChaCha20(msg = received tunnelNonce, nonce = received obfsNonce, key = nonceKey)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  // تشفير ChaCha20 لكل إطار بيانات مشفر للرسائل الخاصة بالنفق باستخدام النونسي المشفرة بالـ``layerKey`` الخاص بالقفزة
</span></span><span style="display:flex;"><span>  encMsg = ChaCha20(msg = encTunMsg, nonce = tunnelNonce, key = layerKey)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  // لحماية AEAD، أيضًا نفذ فشي ChaCha20-Poly1305 لكل إطار رسائل خاص بالنفق باستخدام النونسي المشفرة ومفتاح outAEADKey الخاص بالقفزة
</span></span><span style="display:flex;"><span>  (encMsg, MAC) = ChaCha20-Poly1305-Encrypt(msg = encMsg, nonce = tunnelNonce, key = outAEADKey)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  // تشفير ChaCha20 للـobfsNonce المستلمة باستخدام النونسي المشفر ومفتاح nonceKey الخاص بالقفزة
</span></span><span style="display:flex;"><span>  obfsNonce = ChaCha20(msg = obfsNonce, nonce = tunnelNonce, key = nonceKey)
</span></span></code></pre></div><h3 id="معالجة-النقطة-النهائية-الداخلة">معالجة النقطة النهائية الداخلة</h3>
<p>لأنفاق ChaCha20، سيتم استخدام المخطط التالي لفك تشفير كل رسالة خاصة بالنفق:</p>
<ul>
<li>تحقق من صحة <code>tunnelNonce</code> و<code>obfsNonce</code> المستلمة بشكل مستقل ضد فلتر بلوم</li>
<li>فك تشفير باستخدام ChaCha20-Poly1305 للإطار المشفر باستخدام النونسي المستلم و<code>inAEADKey</code></li>
<li>فك تشفير لإطار البيانات المشفرة باستخدام النونسي المستلم &amp; مفتاح <code>layerKey</code> الخاص بالقفزة</li>
<li>فك تشفير <code>obfsNonce</code> باستخدام مفتاح <code>nonceKey</code> الخاص بالقفزة والنونسي المستلم للحصول على الـ<code>obfsNonce</code> السابق</li>
<li>فك تشفير النونسي المستلم باستخدام مفتاح <code>nonceKey</code> الخاص بالقفزة و<code>obfsNonce</code> المفكّة للحصول على النونسي السابق</li>
<li>فك تشفير البيانات المشفرة باستخدام النونسي المفكّة &amp; مفتاح الطبقة السابق</li>
<li>تكرار الخطوات لفك تشفير النونسي والطبقة لكل قفزة في النفق، حتى تصل إلى الـIBGW</li>
<li>لا تحتاج فك تشفير إطار AEAD إلا في الجولة الأولى</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>// للجولة الأولى، فك تشفير كل إطار بيانات مشفر + MAC باستخدام ChaCha20-Poly1305
</span></span><span style="display:flex;"><span>  // باستخدام النونسي المستلم و``inAEADKey``
</span></span><span style="display:flex;"><span>  msg = encTunMsg \|\| MAC
</span></span><span style="display:flex;"><span>  tunnelNonce = received tunnelNonce
</span></span><span style="display:flex;"><span>  encTunMsg = ChaCha20-Poly1305-Decrypt(msg, nonce = tunnelNonce, key = inAEADKey)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  // تكرار لكل قفزة في النفق حتى تصل إلى الـIBGW
</span></span><span style="display:flex;"><span>  // لكل جولة، فك تشفير ChaCha20 لكل طبقة قفزة على كل إطار بيانات مشفر بالرسائل
</span></span><span style="display:flex;"><span>  // استبدل النونسي المستلم بالنونسي المفك لكل جولة لكل قفزة
</span></span><span style="display:flex;"><span>  decMsg = ChaCha20(msg = encTunMsg, nonce = tunnelNonce, key = layerKey)
</span></span><span style="display:flex;"><span>  obfsNonce = ChaCha20(msg = obfsNonce, nonce = tunnelNonce, key = nonceKey)
</span></span><span style="display:flex;"><span>  tunnelNonce = ChaCha20(msg = tunnelNonce, nonce = obfsNonce, key = nonceKey)
</span></span></code></pre></div><h3 id="التحليل-الأمني-لتشفير-طبقة-النفق-chacha20chacha20-poly1305">التحليل الأمني لتشفير طبقة النفق ChaCha20+ChaCha20-Poly1305</h3>
<p>التحول من AES256/ECB+AES256/CBC إلى ChaCha20+ChaCha20-Poly1305 له عدد من المزايا واعتبارات أمنية جديدة.</p>
<p>أكبر الأمور الأمنية التي يجب مراعاتها هي أنه يجب أن تكون نونسيات ChaCha20 و ChaCha20-Poly1305 فريدة لكل رسالة، طوال عمر المفتاح المستخدم.</p>
<p>إذا فشلنا في استخدام نونسيت فريدة مع نفس المفتاح على رسائل مختلفة، فإن هذا سيفشل ChaCha20 و ChaCha20-Poly1305.</p>
<p>استخدام <code>obfsNonce</code> الملحق يسمح لـ IBEP بفك تشفير <code>tunnelNonce</code> لكل طبقة تشفير القفزة، واستعادة النونسي السابق.</p>
<p>الـ<code>obfsNonce</code> بجانب <code>tunnelNonce</code> لا يكشف عن أي معلومات جديدة لقفزات النفق، حيث يتم تشفير <code>obfsNonce</code> باستخدام <code>tunnelNonce</code> المشفرة. وهذا يسمح أيضًا لـ IBEP باستعادة الـ<code>obfsNonce</code> السابق بطريقة مشابهة لاستعادة <code>tunnelNonce</code>.</p>
<p>أكبر ميزة أمنية هي أنه لا توجد هجمات تأكيد أو هجمات قاعية ضد ChaCha20، واستخدام ChaCha20-Poly1305 بين القفزات يضيف حماية AEAD ضد التلاعب في النص المشفر من مهاجمين MITM الخارجيين.</p>
<p>توجد هجمات قاعية عملية ضد AES256/ECB + AES256/CBC، عند إعادة استخدام المفتاح (كما في تشفير طبقة النفق).</p>
<p>هجمات القاعية ضد AES256/ECB لن تعمل، بسبب استخدام التشفير المزدوج، ويتم التشفير على وحدة واحدة (IV النفق).</p>
<p>هجمات القاعية على AES256/CBC لن تعمل، لأنه لا يتم استخدام أي تعبئة. إذا تغير طول الرسالة الخاصة بالنفق يومًا إلى طول غير قابل للقسمة على 16، فلن يظل AES256/CBC عرضة للهجوم بسبب رفض IVs المكررة.</p>
<p>كلا الهجومين أيضًا يتم إيقافهما عن طريق حظر المكالمات المتعددة للقاعدة باستخدام نفس الـIV، حيث يتم رفض الـIVs المكررة.</p>
<h2 id="المراجع">المراجع</h2>
<ul>
<li><a href="../../../ar/docs/specs/implementation/">Tunnel-Implementation</a>
</li>
</ul>

                </article>

                
                <nav class="page-nav">
                    <a href="../../../ar/proposals/" class="page-nav-link">
                        ← Back to Proposals
                    </a>
                    
                    
                    
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                            
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                    <a href="../../../proposals/153-chacha20-layer-encryption.txt" class="page-nav-link" download>
                        Download Source (.txt)
                    </a>
                    
                </nav>
            </div>
        </div>
    </div>
</div>

<style>
.proposals-page {
    min-height: 100vh;
    padding: var(--spacing-xl) 0;
}

.breadcrumbs {
    display: flex;
    align-items: center;
    gap: var(--spacing-xs);
    margin-bottom: var(--spacing-lg);
    font-size: 0.875rem;
    color: var(--color-text-muted);
}

.breadcrumbs a {
    color: var(--color-text-muted);
    text-decoration: none;
    transition: color var(--transition-fast);
}

.breadcrumbs a:hover {
    color: var(--color-primary);
}

.separator {
    color: var(--color-border);
}

.current {
    color: var(--color-text);
}

 
.translation-disclaimer {
    background: #fef3c7;
    border: 1px solid #f59e0b;
    border-radius: var(--radius-md);
    padding: var(--spacing-md);
    margin-bottom: var(--spacing-lg);
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: var(--spacing-md);
    flex-wrap: wrap;
}

.dark .translation-disclaimer {
    background: #78350f;
    border-color: #d97706;
}

.disclaimer-message {
    color: #92400e;
    font-size: 0.875rem;
}

.dark .disclaimer-message {
    color: #fde047;
}

.disclaimer-link {
    color: #92400e;
    font-weight: 600;
    text-decoration: underline;
    white-space: nowrap;
}

.dark .disclaimer-link {
    color: #fde047;
}

 
.proposal-header {
    margin-bottom: var(--spacing-2xl);
}

.proposal-title-section {
    margin-bottom: var(--spacing-lg);
}

.proposal-title {
    font-size: 2.5rem;
    margin: 0 0 var(--spacing-sm) 0;
    color: var(--color-text);
}

.proposal-number {
    font-size: 0.875rem;
    color: var(--color-text-muted);
    font-weight: 600;
}

 
.proposal-meta-box {
    background: var(--color-bg-secondary);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-lg);
    padding: var(--spacing-lg);
}

.proposal-status {
    display: inline-block;
    padding: var(--spacing-xs) var(--spacing-md);
    border-radius: var(--radius-md);
    font-weight: 600;
    font-size: 0.875rem;
    margin-bottom: var(--spacing-md);
    text-transform: uppercase;
    letter-spacing: 0.05em;
}

 
.status-open {
    background: #dbeafe;
    color: #0369a1;
}

.dark .status-open {
    background: #0c4a6e;
    color: #7dd3fc;
}

.status-accepted {
    background: #dbeafe;
    color: #0369a1;
}

.dark .status-accepted {
    background: #0c4a6e;
    color: #7dd3fc;
}

.status-finished {
    background: #dcfce7;
    color: #15803d;
}

.dark .status-finished {
    background: #164e63;
    color: #86efac;
}

.status-closed {
    background: #dcfce7;
    color: #15803d;
}

.dark .status-closed {
    background: #164e63;
    color: #86efac;
}

.status-rejected {
    background: #fee2e2;
    color: #991b1b;
}

.dark .status-rejected {
    background: #7f1d1d;
    color: #fca5a5;
}

.status-draft,
.status-needs-revision,
.status-dead,
.status-needs-research {
    background: #fef3c7;
    color: #92400e;
}

.dark .status-draft,
.dark .status-needs-revision,
.dark .status-dead,
.dark .status-needs-research {
    background: #78350f;
    color: #fde047;
}

.status-meta,
.status-informational,
.status-reserve {
    background: #e9d5ff;
    color: #6b21a8;
}

.dark .status-meta,
.dark .status-informational,
.dark .status-reserve {
    background: #581c87;
    color: #e879f9;
}

 
.proposal-info-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: var(--spacing-md);
    margin-bottom: var(--spacing-lg);
}

.info-item {
    display: flex;
    flex-direction: column;
    gap: var(--spacing-xs);
}

.info-label {
    font-size: 0.75rem;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    color: var(--color-text-muted);
}

.info-value {
    font-size: 0.9375rem;
    color: var(--color-text);
    font-weight: 500;
}

 
.proposal-relationships {
    border-top: 1px solid var(--color-border);
    padding-top: var(--spacing-md);
}

.relationship {
    display: flex;
    gap: var(--spacing-md);
    margin-bottom: var(--spacing-sm);
}

.relationship:last-child {
    margin-bottom: 0;
}

.relationship-label {
    font-weight: 600;
    color: var(--color-text-muted);
    min-width: 120px;
}

.relationship-value {
    color: var(--color-text);
}

 
.proposal-layout {
    display: block;
}

.proposal-layout--with-toc {
    display: grid;
    grid-template-columns: 260px 1fr;
    gap: var(--spacing-2xl);
    align-items: start;
}

 
.proposal-toc-sidebar {
    position: sticky;
    top: 100px;
    max-height: calc(100vh - 120px);
    overflow-y: auto;
}

.toc-nav {
    background: var(--color-bg-secondary);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-lg);
    padding: var(--spacing-md);
}

.toc-header {
    display: flex;
    align-items: center;
    gap: var(--spacing-sm);
    font-weight: 700;
    font-size: 0.875rem;
    color: var(--color-text);
    padding-bottom: var(--spacing-md);
    margin-bottom: var(--spacing-md);
    border-bottom: 1px solid var(--color-border);
}

.toc-content {
    max-height: calc(100vh - 250px);
    overflow-y: auto;
}

.toc-content::-webkit-scrollbar {
    width: 4px;
}

.toc-content::-webkit-scrollbar-track {
    background: transparent;
}

.toc-content::-webkit-scrollbar-thumb {
    background: var(--color-border);
    border-radius: 2px;
}

.toc-content::-webkit-scrollbar-thumb:hover {
    background: var(--color-text-muted);
}

.toc-nav ul {
    list-style: none;
    padding-left: 0;
    margin: 0;
}

.toc-nav li {
    margin-bottom: 0.25rem;
}

.toc-nav ul ul {
    padding-left: var(--spacing-md);
    margin-top: 0.25rem;
}

.toc-nav a {
    color: var(--color-text-secondary);
    text-decoration: none;
    font-size: 0.8125rem;
    display: block;
    padding: 0.25rem 0.5rem;
    border-radius: var(--radius-sm);
    transition: all var(--transition-fast);
    line-height: 1.4;
}

.toc-nav a:hover {
    color: var(--color-primary);
    background: var(--color-bg-tertiary);
}

 
.proposal-main {
    min-width: 0;
}

 
.proposal-content {
    line-height: 1.8;
    color: var(--color-text);
    max-width: 900px;
}

.proposal-content h2 {
    margin-top: var(--spacing-2xl);
    margin-bottom: var(--spacing-md);
    font-size: 1.75rem;
    scroll-margin-top: 100px;
}

.proposal-content h3 {
    margin-top: var(--spacing-xl);
    margin-bottom: var(--spacing-sm);
    font-size: 1.375rem;
    scroll-margin-top: 100px;
}

.proposal-content h4 {
    margin-top: var(--spacing-lg);
    margin-bottom: var(--spacing-xs);
    font-size: 1.125rem;
    scroll-margin-top: 100px;
}

.proposal-content p {
    margin-bottom: var(--spacing-md);
}

.proposal-content ul,
.proposal-content ol {
    margin-bottom: var(--spacing-md);
    padding-left: var(--spacing-xl);
}

.proposal-content li {
    margin-bottom: var(--spacing-xs);
}

.proposal-content code {
    background: var(--color-bg-secondary);
    padding: 0.125rem 0.375rem;
    border-radius: var(--radius-sm);
    font-size: 0.875em;
    font-family: 'Courier New', monospace;
}

.proposal-content pre {
    background: var(--color-bg-secondary);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-md);
    padding: var(--spacing-md);
    overflow-x: auto;
    margin-bottom: var(--spacing-md);
    font-size: 0.875rem;
}

.proposal-content pre code {
    background: none;
    padding: 0;
}

.proposal-content blockquote {
    border-left: 4px solid var(--color-primary);
    padding-left: var(--spacing-md);
    margin-left: 0;
    margin-bottom: var(--spacing-md);
    font-style: italic;
    color: var(--color-text-secondary);
}

.proposal-content a {
    color: var(--color-primary);
    text-decoration: none;
    border-bottom: 1px solid transparent;
    transition: border-color var(--transition-fast);
}

.proposal-content a:hover {
    border-bottom-color: var(--color-primary);
}

.proposal-content table {
    width: 100%;
    border-collapse: collapse;
    margin-bottom: var(--spacing-md);
}

.proposal-content table th {
    background: var(--color-bg-secondary);
    padding: var(--spacing-sm);
    text-align: left;
    font-weight: 600;
    border-bottom: 2px solid var(--color-border);
}

.proposal-content table td {
    padding: var(--spacing-sm);
    border-bottom: 1px solid var(--color-border);
}

.proposal-content img {
    max-width: 100%;
    height: auto;
    border-radius: var(--radius-md);
    border: 1px solid var(--color-border);
    margin: var(--spacing-lg) 0;
    display: block;
}

 
.page-nav {
    margin-top: var(--spacing-2xl);
    padding-top: var(--spacing-xl);
    border-top: 1px solid var(--color-border);
    display: flex;
    gap: var(--spacing-md);
    flex-wrap: wrap;
}

.page-nav-link {
    display: inline-block;
    padding: var(--spacing-md) var(--spacing-lg);
    background: var(--color-bg-secondary);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-md);
    color: var(--color-text);
    text-decoration: none;
    transition: all var(--transition-fast);
}

.page-nav-link:hover {
    border-color: var(--color-primary);
    color: var(--color-primary);
}

 
@media (max-width: 1024px) {
    .proposal-layout--with-toc {
        grid-template-columns: 1fr;
    }

    .proposal-toc-sidebar {
        position: static;
        max-height: none;
        margin-bottom: var(--spacing-xl);
    }

    .toc-content {
        max-height: 300px;
    }
}

@media (max-width: 768px) {
    .proposal-title {
        font-size: 1.75rem;
    }

    .proposal-info-grid {
        grid-template-columns: 1fr;
    }
}
</style>



<script>
document.addEventListener('DOMContentLoaded', function() {
    const tocLinks = document.querySelectorAll('.toc-nav a');
    const headings = [];

    tocLinks.forEach(link => {
        const href = link.getAttribute('href');
        if (href && href.startsWith('#')) {
            const heading = document.getElementById(href.slice(1));
            if (heading) {
                headings.push({ element: heading, link: link });
            }
        }
    });

    function updateActiveLink() {
        const scrollPos = window.scrollY + 120;
        let activeIndex = 0;

        for (let i = 0; i < headings.length; i++) {
            if (headings[i].element.offsetTop <= scrollPos) {
                activeIndex = i;
            }
        }

        tocLinks.forEach(link => link.classList.remove('active'));
        if (headings[activeIndex]) {
            headings[activeIndex].link.classList.add('active');
        }
    }

    window.addEventListener('scroll', updateActiveLink);
    updateActiveLink();
});
</script>
<style>
.toc-nav a.active {
    color: var(--color-primary);
    background: var(--color-bg-tertiary);
    font-weight: 600;
}
</style>



    </main>

    <footer class="site-footer">
    <div class="container">
        <div class="footer-grid">
            <div class="footer-col footer-brand">
                <img src="../../../images/i2plogo_lightmode.svg" alt="I2P Logo" class="footer-logo logo-light" loading="lazy" decoding="async">
                <img src="../../../images/i2plogo_darkmode.svg" alt="I2P Logo" class="footer-logo logo-dark" loading="lazy" decoding="async">
                <p class="footer-tagline">Privacy. Security. Freedom.</p>
                <p class="footer-description">The Invisible Internet Project - A privacy-focused, anonymous network layer</p>

                <div class="footer-social-newsletter">
                    <div class="social-links">
                        <a href="https://mastodon.social/@i2p" target="_blank" rel="noopener" aria-label="Mastodon">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M21.327 8.566c0-4.339-2.843-5.61-2.843-5.61-1.433-.658-3.894-.935-6.451-.956h-.063c-2.557.021-5.016.298-6.45.956 0 0-2.843 1.272-2.843 5.61 0 .993-.019 2.181.012 3.441.103 4.243.778 8.425 4.701 9.463 1.809.479 3.362.579 4.612.51 2.268-.126 3.541-.809 3.541-.809l-.075-1.646s-1.621.511-3.441.449c-1.804-.062-3.707-.194-3.999-2.409a4.523 4.523 0 0 1-.04-.621s1.77.433 4.014.536c1.372.063 2.658-.08 3.965-.236 2.506-.299 4.688-1.843 4.962-3.254.434-2.223.398-5.424.398-5.424zm-3.353 5.59h-2.081V9.057c0-1.075-.452-1.62-1.357-1.62-1 0-1.501.647-1.501 1.927v2.791h-2.069V9.364c0-1.28-.501-1.927-1.502-1.927-.905 0-1.357.546-1.357 1.62v5.099H6.026V8.903c0-1.074.273-1.927.823-2.558.566-.631 1.307-.955 2.228-.955 1.065 0 1.872.409 2.405 1.228l.518.869.519-.869c.533-.819 1.34-1.228 2.405-1.228.92 0 1.662.324 2.228.955.549.631.822 1.484.822 2.558v5.253z"/>
                            </svg>
                        </a>
                        <a href="https://twitter.com/GetI2P" target="_blank" rel="noopener" aria-label="Twitter">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/>
                            </svg>
                        </a>
                        <a href="https://old.reddit.com/r/i2p" target="_blank" rel="noopener" aria-label="Reddit">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M12 0A12 12 0 0 0 0 12a12 12 0 0 0 12 12 12 12 0 0 0 12-12A12 12 0 0 0 12 0zm5.01 4.744c.688 0 1.25.561 1.25 1.249a1.25 1.25 0 0 1-2.498.056l-2.597-.547-.8 3.747c1.824.07 3.48.632 4.674 1.488.308-.309.73-.491 1.207-.491.968 0 1.754.786 1.754 1.754 0 .716-.435 1.333-1.01 1.614a3.111 3.111 0 0 1 .042.52c0 2.694-3.13 4.87-7.004 4.87-3.874 0-7.004-2.176-7.004-4.87 0-.183.015-.366.043-.534A1.748 1.748 0 0 1 4.028 12c0-.968.786-1.754 1.754-1.754.463 0 .898.196 1.207.49 1.207-.883 2.878-1.43 4.744-1.487l.885-4.182a.342.342 0 0 1 .14-.197.35.35 0 0 1 .238-.042l2.906.617a1.214 1.214 0 0 1 1.108-.701zM9.25 12C8.561 12 8 12.562 8 13.25c0 .687.561 1.248 1.25 1.248.687 0 1.248-.561 1.248-1.249 0-.688-.561-1.249-1.249-1.249zm5.5 0c-.687 0-1.248.561-1.248 1.25 0 .687.561 1.248 1.249 1.248.688 0 1.249-.561 1.249-1.249 0-.687-.562-1.249-1.25-1.249zm-5.466 3.99a.327.327 0 0 0-.231.094.33.33 0 0 0 0 .463c.842.842 2.484.913 2.961.913.477 0 2.105-.056 2.961-.913a.361.361 0 0 0 .029-.463.33.33 0 0 0-.464 0c-.547.533-1.684.73-2.512.73-.828 0-1.979-.196-2.512-.73a.326.326 0 0 0-.232-.095z"/>
                            </svg>
                        </a>
                        <a href="https://signal.group/#CjQKIOSUTtxlhbumAKcRsthPFkxkTUrkWcX39bbN6njLEgAIEhCTNsR0KDuiehAXZnkt42v5" target="_blank" rel="noopener" aria-label="Signal" class="signal-link">
                            <img src="../../../images/Signal-Logo-Black.svg" alt="Signal" class="signal-logo signal-logo-light" loading="lazy" decoding="async">
                            <img src="../../../images/Signal-Logo-White.svg" alt="Signal" class="signal-logo signal-logo-dark" loading="lazy" decoding="async">
                        </a>
                    </div>

                    
                    <div class="footer-newsletter-inline">
                        <p class="newsletter-description">ابقَ على اطلاع بأخبار I2P:</p>
                        <form action="https://feedback.i2p.net/api/mailing-list/subscribe" method="POST" class="newsletter-form">
                            <input type="email" name="email" placeholder="أدخل بريدك الإلكتروني" required>
                            <button type="submit">اشترك</button>
                        </form>
                    </div>
                </div>
            </div>

            <div class="footer-col">
                <h3>روابط سريعة</h3>
                <ul>
                    <li><a href="../../../ar/financial-support/">تبرع</a></li>
                    <li><a href="../../../ar/docs/overview/intro/">مقدمة I2P</a></li>
                </ul>
            </div>

            <div class="footer-col">
                <h3>المجتمع</h3>
                <ul>
                    <li><a href="../../../ar/get-involved/">شارك معنا</a></li>
                    <li><a href="../../../ar/blog/">مدونة</a></li>
                    <li><a href="http://i2pforum.net/" target="_blank" rel="noopener">المنتديات الرسمية</a></li>
                    <li><a href="../../../ar/contact/">اتصل بنا</a></li>
                </ul>
            </div>

            <div class="footer-col">
                <h3>الموارد</h3>
                <ul>
                    <li><a href="https://i2p-metrics.np-tokumei.net/" target="_blank" rel="noopener">إحصائيات I2P</a></li>
                    <li><a href="../../../ar/papers/">بحث</a></li>
                    <li><a href="https://i2pgit.org/" target="_blank" rel="noopener">GitLab</a></li>
                    <li><a href="https://www.stormycloud.org/" target="_blank" rel="noopener">ستورمي كلاود</a></li>
                </ul>
            </div>
        </div>

        <div class="footer-bottom">
            <p class="copyright">&copy; 2025 مشروع الإنترنت الخفي. مرخص تحت Creative Commons.</p>
            <div class="footer-links">
                <a href="../../../ar/privacy/">الخصوصية</a>
                <a href="../../../ar/terms/">الشروط</a>
                <a href="../../../ar/about/media/">الصحافة</a>
            </div>
        </div>
    </div>
</footer>


    
    
<div class="modal-overlay" id="poll">
    <div class="modal-content poll-modal-content">
        <a href="#" class="modal-close" aria-label="إغلاق">
            <span aria-hidden="true">&times;</span>
        </a>

        <div class="modal-header">
            <h2>استطلاع المجتمع</h2>
            <p class="modal-subtitle">نود أن نسمع منك</p>
        </div>

        <div class="modal-body">
            
            <iframe 
                id="poll-iframe"
                data-poll-id="2"
                data-api-url="https://feedback.i2p.net"
                frameborder="0"
                scrolling="no"
                style="width: 100%; border: none; min-height: 400px;">
            </iframe>
        </div>

        <div class="modal-footer">
            <p class="modal-disclaimer">
                يساعد تصويتك في تشكيل مستقبل I2P.
            </p>
        </div>
    </div>
</div>


<script>
(function() {
    const iframe = document.getElementById('poll-iframe');
    if (!iframe) return;
    
    const hostname = window.location.hostname;
    let apiUrl = 'https://feedback.i2p.net';
    const pollId = iframe.getAttribute('data-poll-id') || '1';

    
    if (hostname.endsWith('.b32.i2p') || hostname.endsWith('.i2p')) {
        apiUrl = 'http://5kwyynf3eetgqa2nors6ctwo7doi7yu73k7uvypy5eqmm326zkiq.b32.i2p';
    }
    
    else if (hostname.endsWith('.onion')) {
        apiUrl = 'http://gfonxmohvarpmocsvllscsuszdu5rikipm6innvcwq4vpng7zzqmmfyd.onion';
    }

    
    const pollUrl = apiUrl + '/widgets/poll.html?poll_id=' + encodeURIComponent(pollId) + '&api_url=' + encodeURIComponent(apiUrl);
    iframe.src = pollUrl;
})();
</script>



    
    



    
    <script>
        (function () {
            'use strict';
            var hostname = window.location.hostname;
            var baseUrl;

            
            if (hostname.endsWith('.b32.i2p') || hostname.endsWith('.i2p')) {
                baseUrl = 'http://5kwyynf3eetgqa2nors6ctwo7doi7yu73k7uvypy5eqmm326zkiq.b32.i2p';
            } else if (hostname.endsWith('.onion')) {
                baseUrl = 'http://gfonxmohvarpmocsvllscsuszdu5rikipm6innvcwq4vpng7zzqmmfyd.onion';
            } else {
                baseUrl = 'https://feedback.i2p.net';
            }

            window.feedbackBaseUrl = baseUrl;

            
            document.querySelectorAll('[data-api-url]').forEach(function (widget) {
                widget.setAttribute('data-api-url', baseUrl);
            });

            
            document.write('<link rel="stylesheet" href="' + baseUrl + '/widgets/styles.css">');
            
        })();
    </script>

    

    
    
    

    

</body>

</html>
<!DOCTYPE html>
<html lang="ru" data-theme="light">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <title>ECIES роутеры | I2P - Проект невидимого интернета</title>

    <meta name="description" content="The Invisible Internet Project - A privacy-focused, anonymous network layer">
    <meta name="keywords" content="i2p, privacy, anonymity, dark net, encryption, security">

    
    <meta property="og:title" content="ECIES роутеры | I2P - Проект невидимого интернета">
    <meta property="og:description" content="The Invisible Internet Project - A privacy-focused, anonymous network layer">
    <meta property="og:type" content="website">
    <meta property="og:url" content="/ru/proposals/156-ecies-routers/">

    
    <link rel="icon" type="image/svg+xml" href="../../../images/favicon.svg">
    <link rel="icon" type="image/png" href="../../../images/i2plogo.png" sizes="32x32">

    
    
    
    
    <link rel="stylesheet" href="../../../css/main.min.be6880f32f5ff44e57579da7b11513b973319944ebe38748e3ac7f3268662d18.css" integrity="sha256-vmiA8y9f9E5XV52nsRUTuXMxmUTr44dI46x/MmhmLRg=">
    


    
</head>

<body>
    
    <input type="checkbox" id="theme-toggle-checkbox" class="theme-checkbox" aria-hidden="true">

    
<div class="site-banner" id="site-banner" data-banner-id="banner-3" role="alert" aria-live="polite">
    <div class="container">
        <div class="banner-content">
            <span class="banner-message">Бета-сайт I2P теперь доступен Сообщайте о проблемах с E-Mail на stormycloud@mail.i2p</span>
            
        </div>
        
        <form method="GET" action="../../../api/banner/dismiss" style="display: inline;">
            <input type="hidden" name="id" value="banner-3">
            <button type="submit" class="banner-close" aria-label="Закрыть баннер" title="Закрыть баннер">
                <span aria-hidden="true">&times;</span>
            </button>
        </form>
        
    </div>
</div>


    <header class="site-header">
    <div class="container">
        <nav class="main-nav">
            <div class="nav-brand">
                <a href="../../../ru/" class="logo-link">
                    <img src="../../../images/i2plogo_lightmode.svg" alt="I2P Logo" class="logo logo-light">
                    <img src="../../../images/i2plogo_darkmode.svg" alt="I2P Logo" class="logo logo-dark">
                </a>
            </div>

            
            <input type="checkbox" id="mobile-menu-checkbox" class="mobile-menu-checkbox"
                aria-label="Toggle navigation menu">
            <label for="mobile-menu-checkbox" class="mobile-menu-toggle" aria-label="Toggle navigation menu">
                <span class="hamburger"></span>
            </label>

            <div class="nav-menu">
                <ul class="nav-links">
                    <li class="nav-dropdown">
                        <a href="../../../ru/about/" class="">О проекте</a>
                        <ul class="dropdown-menu">
                            <li><a href="../../../ru/about/">Обзор</a></li>
                            <li><a href="../../../ru/papers/">Научные статьи</a></li>
                            <li><a href="../../../ru/about/media/">Пресса</a></li>
                            <li><a href="../../../ru/contact/">Связаться с нами</a></li>
                        </ul>
                    </li>
                    <li><a href="../../../ru/docs/" class="">Документы</a></li>
                    <li><a href="../../../ru/downloads/" class="">Загрузки</a></li>
                    <li><a href="../../../ru/blog/" class="">Блог</a></li>
                    <li class="nav-dropdown">
                        <a href="../../../ru/get-involved/" class="">Присоединиться</a>
                        <ul class="dropdown-menu">
                            <li><a href="../../../ru/get-involved/">Обзор</a></li>
                            <li><a href="../../../ru/feedback/">Предложения по функциям</a></li>
                        </ul>
                    </li>
                </ul>

                <div class="nav-actions">
                    
                    <div class="language-selector">
                        <button class="language-toggle" aria-label="Select language" title="Language">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none"
                                xmlns="http://www.w3.org/2000/svg">
                                <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2" />
                                <path
                                    d="M2 12h20M12 2a15.3 15.3 0 014 10 15.3 15.3 0 01-4 10 15.3 15.3 0 01-4-10 15.3 15.3 0 014-10z"
                                    stroke="currentColor" stroke-width="2" />
                            </svg>
                            <span class="current-lang">ru</span>
                        </button>
                        <div class="language-dropdown">
                            
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../en/proposals/156-ecies-routers/"
                                class="lang-option">Английский</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../es/proposals/156-ecies-routers/"
                                class="lang-option">Испанский</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../ko/proposals/156-ecies-routers/"
                                class="lang-option">Корейский</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../zh/proposals/156-ecies-routers/"
                                class="lang-option">Китайский</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../ru/proposals/156-ecies-routers/"
                                class="lang-option active">Русский</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../cs/proposals/156-ecies-routers/"
                                class="lang-option">Чешский</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../de/proposals/156-ecies-routers/"
                                class="lang-option">Немецкий</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../fr/proposals/156-ecies-routers/"
                                class="lang-option">Французский</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../tr/proposals/156-ecies-routers/"
                                class="lang-option">Турецкий</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../vi/proposals/156-ecies-routers/"
                                class="lang-option">Вьетнамский</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../hi/proposals/156-ecies-routers/"
                                class="lang-option">Хинди</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../ar/proposals/156-ecies-routers/"
                                class="lang-option">Арабский</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../pt/proposals/156-ecies-routers/"
                                class="lang-option">Португальский</a>
                            
                            
                        </div>
                    </div>

                    
                    <label for="theme-toggle-checkbox" class="theme-toggle" aria-label="Toggle dark mode"
                        title="Toggle theme">
                        <svg class="sun-icon" width="20" height="20" viewBox="0 0 20 20" fill="none"
                            xmlns="http://www.w3.org/2000/svg">
                            <circle cx="10" cy="10" r="4" stroke="currentColor" stroke-width="2" />
                            <path
                                d="M10 2V4M10 16V18M18 10H16M4 10H2M15.657 4.343L14.243 5.757M5.757 14.243L4.343 15.657M15.657 15.657L14.243 14.243M5.757 5.757L4.343 4.343"
                                stroke="currentColor" stroke-width="2" stroke-linecap="round" />
                        </svg>
                        <svg class="moon-icon" width="20" height="20" viewBox="0 0 20 20" fill="none"
                            xmlns="http://www.w3.org/2000/svg">
                            <path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"
                                stroke="currentColor" stroke-width="2" stroke-linejoin="round" />
                        </svg>
                    </label>

                    
                    <a href="../../../ru/financial-support/" class="btn btn-primary" id="donate-btn">Donate</a>

                    
                    <a href="../../../ru/downloads/" class="btn btn-primary">Загрузить I2P</a>
                </div>
            </div>
        </nav>
    </div>
</header>

    <main id="main-content">
        



<div class="proposals-page">
    <div class="container">
        
        <nav class="breadcrumbs">
            <a href="../../../ru/">Home</a>
            <span class="separator">/</span>
            <a href="../../../ru/proposals/">Proposals</a>
            <span class="separator">/</span>
            <span class="current">ECIES роутеры</span>
        </nav>

        
<div class="translation-disclaimer" role="note">
    <span class="disclaimer-message">Этот перевод был создан с помощью машинного обучения и может быть не на 100% точным.</span>
    
    
    <a href="../../../en/proposals/156-ecies-routers/" class="disclaimer-link">Просмотреть английскую версию</a>
    
</div>



        
        <header class="proposal-header">
            <div class="proposal-title-section">
                <h1 class="proposal-title">ECIES роутеры</h1>
                <div class="proposal-number">Proposal 156</div>
            </div>

            
            <div class="proposal-meta-box">
                <div class="proposal-status status-closed">
                    Closed
                </div>

                
                <div class="proposal-info-grid">
                    
                    <div class="info-item">
                        <span class="info-label">Author</span>
                        <span class="info-value">zzz, orignal</span>
                    </div>
                    

                    
                    <div class="info-item">
                        <span class="info-label">Created</span>
                        <span class="info-value">2020-09-01</span>
                    </div>
                    

                    
                    <div class="info-item">
                        <span class="info-label">Last Updated</span>
                        <span class="info-value">2025-03-05</span>
                    </div>
                    

                    
                    <div class="info-item">
                        <span class="info-label">Target Version</span>
                        <span class="info-value">0.9.51</span>
                    </div>
                    

                    
                </div>

                
                
            </div>
        </header>

        
        <div class="proposal-layout proposal-layout--with-toc">
            
            
            <aside class="proposal-toc-sidebar">
                <nav class="toc-nav">
                    <div class="toc-header">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                            <path d="M4 6h16M4 12h16M4 18h16" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                        </svg>
                        On This Page
                    </div>
                    <div class="toc-content">
                        <nav id="TableOfContents">
  <ul>
    <li><a href="#примечание">Примечание</a></li>
    <li><a href="#обзор">Обзор</a>
      <ul>
        <li><a href="#резюме">Резюме</a></li>
        <li><a href="#цели">Цели</a></li>
        <li><a href="#не-цели">Не-цели</a></li>
      </ul>
    </li>
    <li><a href="#дизайн">Дизайн</a>
      <ul>
        <li><a href="#местоположение-ключа-и-тип-криптографии">Местоположение ключа и тип криптографии</a></li>
        <li><a href="#сообщение-о-создании-туннеля">Сообщение о создании туннеля</a></li>
        <li><a href="#сквозное-шифрование">Сквозное шифрование</a></li>
      </ul>
    </li>
    <li><a href="#спецификация">Спецификация</a>
      <ul>
        <li><a href="#шифрование-запросов">Шифрование запросов</a></li>
        <li><a href="#шифрование-ответов">Шифрование ответов</a></li>
      </ul>
    </li>
    <li><a href="#обоснование">Обоснование</a></li>
    <li><a href="#заметки-по-внедрению">Заметки по внедрению</a></li>
    <li><a href="#проблемы">Проблемы</a></li>
    <li><a href="#миграция">Миграция</a>
      <ul>
        <li><a href="#базовая-связь-точка-точка">Базовая связь &ldquo;точка-точка&rdquo;</a></li>
        <li><a href="#совместимость-netdb">Совместимость NetDB</a></li>
        <li><a href="#создание-туннелей">Создание туннелей</a></li>
        <li><a href="#ratchet-сообщения-к-floodfill-ecies">Ratchet сообщения к floodfill ECIES</a></li>
        <li><a href="#переключение-ключей-и-новые-установки">Переключение ключей и новые установки</a></li>
        <li><a href="#новое-сообщение-о-создании-туннеля-этап-2">Новое сообщение о создании туннеля (Этап 2)</a></li>
        <li><a href="#завершение-переключения-ключей">Завершение переключения ключей</a></li>
      </ul>
    </li>
  </ul>
</nav>
                    </div>
                </nav>
            </aside>
            

            
            <div class="proposal-main">
                <article class="proposal-content">
                    <h2 id="примечание">Примечание</h2>
<p>Развертывание и тестирование сети в процессе.
Может быть изменено.
Статус:</p>
<ul>
<li>ECIES роутеры реализованы в 0.9.48, см. <a href="../../../ru/docs/specs/common-structures/">Common</a>
.</li>
<li>Создание туннелей реализовано в 0.9.48, см. <a href="../../../ru/docs/specs/implementation/#tunnel-creation-ecies">Tunnel-Creation-ECIES</a>
.</li>
<li>Зашифрованные сообщения для ECIES роутеров реализованы в 0.9.49, см. <a href="../../../ru/docs/specs/ecies/">ECIES-ROUTERS</a>
.</li>
<li>Сообщения о создании новых туннелей реализованы в 0.9.51.</li>
</ul>
<h2 id="обзор">Обзор</h2>
<h3 id="резюме">Резюме</h3>
<p>Идентификаторы роутеров в настоящее время содержат ключ шифрования ElGamal.
Это стандарт с начала I2P.
ElGamal медленен и требует замены во всех местах использования.</p>
<p>Предложения для LS2 <a href="../../../ru/proposals/123-new-netdb-entries/">Prop123</a>
 и ECIES-X25519-AEAD-Ratchet <a href="../../../ru/proposals/144-ecies-x25519-aead-ratchet/">Prop144</a>

(теперь определены в <a href="../../../ru/docs/specs/ecies/">ECIES</a>
) описали замену ElGamal на ECIES
для Destinations.</p>
<p>Это предложение определяет замену ElGamal на ECIES-X25519 для роутеров.
Предложение дает обзор необходимых изменений.
Большинство деталей содержится в других предложениях и спецификациях.
См. раздел ссылок для получения информации.</p>
<h3 id="цели">Цели</h3>
<p>См. <a href="../../../ru/proposals/152-ecies-tunnels/">Prop152</a>
 для дополнительных целей.</p>
<ul>
<li>Заменить ElGamal на ECIES-X25519 в Идентификаторах роутеров</li>
<li>Повторное использование существующих криптографических примитивов</li>
<li>Улучшить защищенность сообщений о создании туннелей, сохраняя совместимость</li>
<li>Поддержка туннелей с разными типами шифрования ElGamal/ECIES</li>
<li>Максимизация совместимости с текущей сетью</li>
<li>Не требуется одновременное обновление всей сети</li>
<li>Постепенное развертывание для минимизации риска</li>
<li>Новое, уменьшенное сообщение о создании туннелей</li>
</ul>
<h3 id="не-цели">Не-цели</h3>
<p>См. <a href="../../../ru/proposals/152-ecies-tunnels/">Prop152</a>
 для дополнительных не-целей.</p>
<ul>
<li>Нет требований для роутеров с двойными ключами</li>
<li>Изменения в уровне шифрования, для этого см. <a href="../../../ru/proposals/153-chacha20-layer-encryption/">Prop153</a>
</li>
</ul>
<h2 id="дизайн">Дизайн</h2>
<h3 id="местоположение-ключа-и-тип-криптографии">Местоположение ключа и тип криптографии</h3>
<p>Для Destinations, ключ находится в наборе адресов, а не в Destination, и
мы поддерживаем несколько типов шифрования в одном и том же наборе адресов.</p>
<p>Ничего из этого не требуется для роутеров. Ключ шифрования роутера
находится в его Идентификаторе роутера. См. спецификацию общих структур <a href="../../../ru/docs/specs/common-structures/">Common</a>
.</p>
<p>Для роутеров мы заменим 256-байтный ключ ElGamal в Идентификаторе роутера
на 32-байтный X25519 ключ и 224 байта заполнения.
Это будет указано типом криптографии в сертификате ключа.
Тип криптографии (такой же, как использованный в LS2) – 4.
Это указывает на 32-байтный открытый ключ X25519 с порядком байтов &ldquo;младший сначала&rdquo;.
Это стандартное построение, как определено в спецификации общих структур <a href="../../../ru/docs/specs/common-structures/">Common</a>
.</p>
<p>Это идентично методу, предложенному для ECIES-P256
для типов криптографии 1-3 в предложении 145 <a href="../../../ru/proposals/145-ecies/">Prop145</a>
.
Хотя это предложение никогда не было принято, разработчики Java-реализации подготовились к
типам криптографии в сертификатах ключей Идентификаторов роутеров, добавив проверки во
многих местах в кодовой базе. Большая часть этой работы была выполнена в середине 2019 года.</p>
<h3 id="сообщение-о-создании-туннеля">Сообщение о создании туннеля</h3>
<p>Для использования ECIES вместо ElGamal требуется несколько изменений спецификации создания туннелей <a href="../../../ru/docs/specs/implementation/#tunnel-creation-ecies">Tunnel-Creation</a>
.
Кроме того, мы внесем улучшения в сообщения о создании туннелей
для повышения безопасности.</p>
<p>На первом этапе мы изменим формат и шифрование
записей о создании и ответах на создание для переходов ECIES.
Эти изменения будут совместимы с существующими роутерами ElGamal.
Эти изменения определены в предложении 152 <a href="../../../ru/proposals/152-ecies-tunnels/">Prop152</a>
.</p>
<p>На втором этапе мы добавим новую версию
сообщений о запросе на создание, о создании ответа,
записи о запросе на создание и записи об ответе на создание.
Размер будет уменьшен для повышения эффективности.
Эти изменения должны поддерживаться всеми узлами в туннеле, и все узлы должны быть ECIES.
Эти изменения определены в предложении 157 <a href="../../../ru/proposals/157-new-tbm/">Prop157</a>
.</p>
<h3 id="сквозное-шифрование">Сквозное шифрование</h3>
<h4 id="история">История</h4>
<p>В оригинальном дизайне Java I2P использовался единый Менеджер ключей сессий ElGamal (SKM),
который использовался роутером и всеми его локальными Destination.
Так как общий SKM мог раскрыть информацию и позволить корреляцию злоумышленниками,
дизайн был изменен для поддержки отдельных SKM ElGamal для роутера и каждого Destination.
Дизайн ElGamal поддерживал только анонимных отправителей;
отправитель посылал только эфемерные ключи, а не статический ключ.
Сообщение не было связано с идентичностью отправителя.</p>
<p>Затем мы разработали ECIES Ratchet SKM в
ECIES-X25519-AEAD-Ratchet <a href="../../../ru/proposals/144-ecies-x25519-aead-ratchet/">Prop144</a>
,  теперь определено в <a href="../../../ru/docs/specs/ecies/">ECIES</a>
.
Этот дизайн был определен с использованием паттерна Noise &ldquo;IK&rdquo;, который включал статический ключ отправителя в первом сообщении. Этот протокол используется для ECIES (тип 4) Destinations.
Паттерн IK не позволяет использовать анонимных отправителей.</p>
<p>Поэтому мы включили в предложение возможность отправки анонимных сообщений
к Ratchet SKM, используя статический ключ, заполненный нулями. Это имитировало паттерн Noise &ldquo;N&rdquo;,
но совместимо, поэтому ECIES SKM мог принимать и анонимные, и неанонимные сообщения.
Предполагалось использовать нулевой ключ для ECIES роутеров.</p>
<h4 id="использование-и-модели-угроз">Использование и модели угроз</h4>
<p>Сценарий использования и модель угроз для сообщений, отправленных роутерам, существенно отличается от
таковых для сквозных сообщений между Destination.</p>
<p>Сценарий использования и модель угроз для Destination:</p>
<ul>
<li>Неанонимный от/до Destinations (отправитель указывает статический ключ)</li>
<li>Эффективно поддерживает постоянный трафик между Destination (полное рукопожатие, потоковая передача и теги)</li>
<li>Всегда отправляется через исходящие и входящие туннели</li>
<li>Скрывает все идентифицирующие характеристики от OBEP и IBGW, требуя кодирования эфемерных ключей с помощью Elligator2.</li>
<li>Оба участника должны использовать один и тот же тип шифрования</li>
</ul>
<p>Сценарий использования и модель угроз для Router:</p>
<ul>
<li>Анонимные сообщения от роутеров или Destination (отправитель не включает статический ключ)</li>
<li>Для зашифрованных запросов и хранилищ базы данных, в основном для floodfill</li>
<li>Случайные сообщения</li>
<li>Несколько сообщений не должны быть коррелированы</li>
<li>Всегда отправляется через исходящий туннель напрямую к роутеру. Входящие туннели не используются</li>
<li>OBEP знает, что он перенаправляет сообщение роутеру и знает его тип шифрования</li>
<li>Два участника могут иметь разные типы шифрования</li>
<li>Ответы на запросы базы данных – это одноразовые сообщения, использующие ключ и тег запроса базы данных</li>
<li>Подтверждения о хранилище базы данных – одноразовые сообщения, использующие бесплатно включенное сообщение о доставке</li>
</ul>
<p>Некоторые не-цели для роутеров:</p>
<ul>
<li>Нет необходимости в неанонимных сообщениях</li>
<li>Нет необходимости отправлять сообщения через входящие исследовательские туннели (роутер не публикует исследовательские наборы адресов)</li>
<li>Нет необходимости в постоянном обмене сообщениями с использованием тегов</li>
<li>Нет необходимости в &ldquo;двойных ключах&rdquo; для Менеджеров ключей сессий, как описано в <a href="../../../ru/docs/specs/ecies/">ECIES</a>
 для Destinations. У роутеров только один открытый ключ.</li>
</ul>
<h4 id="выводы-дизайна">Выводы дизайна</h4>
<p>ECIES Router SKM не требует полного Ratchet SKM как указывается в <a href="../../../ru/docs/specs/ecies/">ECIES</a>
 для Destinations.
Нет необходимости в неанонимных сообщениях, использующих паттерн IK.
Модель угроз не требует закодированных эфемерных ключей Elligator2.</p>
<p>Таким образом, SKM роутера будет использовать паттерн Noise &ldquo;N&rdquo;, такой же, как указано
в <a href="../../../ru/proposals/152-ecies-tunnels/">Prop152</a>
 для создания туннелей.
Он будет использовать тот же формат нагрузки, как указано в <a href="../../../ru/docs/specs/ecies/">ECIES</a>
 для Destinations.
Режим с нулевым статическим ключом (без связывания или сессии) IK, описанный в <a href="../../../ru/docs/specs/ecies/">ECIES</a>
, не будет использоваться.</p>
<p>Ответы на запросы шифруются ратчетным тегом, если запрашивается в поисковом запросе.
Это задокументировано в <a href="../../../ru/proposals/154-ecies-lookups/">Prop154</a>
, теперь указано в <a href="../../../ru/docs/specs/i2np/">I2NP</a>
.</p>
<p>Дизайн позволяет роутеру иметь один Менеджер ключей сессий ECIES.
Нет необходимости иметь &ldquo;двойные ключи&rdquo; для Менеджеров ключей сессий, как
описано в <a href="../../../ru/docs/specs/ecies/">ECIES</a>
 для Destinations.
У роутеров только один открытый ключ.</p>
<p>Роутер ECIES не имеет статического ключа ElGamal.
Роутеру всё ещё требуется реализация ElGamal для создания туннелей
через роутеры ElGamal и отправки зашифрованных сообщений роутерам ElGamal.</p>
<p>Роутер ECIES МОЖЕТ потребовать частичного Менеджера ключей сессий ElGamal для
приема сообщений с тегами ElGamal, полученных в ответ на запросы NetDB
от floodfill роутеров до версии 0.9.46, так как эти роутеры не
имеют реализации ответов с тегами ECIES, как указано в <a href="../../../ru/proposals/152-ecies-tunnels/">Prop152</a>
.
Если это не так, роутер ECIES может не запрашивать зашифрованный ответ у
floodfill роутера версии до 0.9.46.</p>
<p>Это опционально. Решение может варьироваться в различных реализациях I2P
и может зависеть от доли сети, обновленной до
версии 0.9.46 или выше.
На данный момент приблизительно 85% сети работает на версии 0.9.46 или выше.</p>
<h2 id="спецификация">Спецификация</h2>
<p>X25519: См. <a href="../../../ru/docs/specs/ecies/">ECIES</a>
.</p>
<p>Идентификатор роутера и сертификат ключа: См. <a href="../../../ru/docs/specs/common-structures/">Common</a>
.</p>
<p>Создание туннелей: См. <a href="../../../ru/proposals/152-ecies-tunnels/">Prop152</a>
.</p>
<p>Новое сообщение о создании туннеля: См. <a href="../../../ru/proposals/157-new-tbm/">Prop157</a>
.</p>
<h3 id="шифрование-запросов">Шифрование запросов</h3>
<p>Шифрование запросов соответствует тому, что указано в <a href="../../../ru/docs/specs/implementation/#tunnel-creation-ecies">Tunnel-Creation-ECIES</a>
 и <a href="../../../ru/proposals/152-ecies-tunnels/">Prop152</a>
,
с использованием паттерна Noise &ldquo;N&rdquo;.</p>
<p>Ответы на запросы шифруются ратчетным тегом, если это запрашивается в поисковом запросе.
Сообщения запросов на поиск в базе данных содержат 32-байтный ключ для ответа и 8-байтный тег для ответа,
как указано в <a href="../../../ru/docs/specs/i2np/">I2NP</a>
 и <a href="../../../ru/proposals/154-ecies-lookups/">Prop154</a>
. Ключ и тег используются для шифрования ответа.</p>
<p>Наборы тегов не создаются.
Схема с нулевым статическим ключом, указанная в
ECIES-X25519-AEAD-Ratchet <a href="../../../ru/proposals/144-ecies-x25519-aead-ratchet/">Prop144</a>
 и <a href="../../../ru/docs/specs/ecies/">ECIES</a>
, не используется.
Эфемерные ключи не будут закодированы с использованием Elligator2.</p>
<p>Как правило, это будут сообщения новой сессии, отправляемые с нулевым статическим ключом
(без связывания или сессии), поскольку отправитель сообщения анонимен.</p>
<h4 id="kdf-для-начальных-ck-и-h">KDF для начальных ck и h</h4>
<p>Это стандарт <a href="https://noiseprotocol.org/noise.html">NOISE</a>
 для паттерна &ldquo;N&rdquo; с стандартным именем протокола.
Это соответствует тому, что указано в <a href="../../../ru/docs/specs/implementation/#tunnel-creation-ecies">Tunnel-Creation-ECIES</a>
 и <a href="../../../ru/proposals/152-ecies-tunnels/">Prop152</a>
 для сообщений о создании туннелей.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Это паттерн сообщения &#34;e&#34;:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>// Определите protocol_name.
</span></span><span style="display:flex;"><span>Установите protocol_name = &#34;Noise_N_25519_ChaChaPoly_SHA256&#34;
</span></span><span style="display:flex;"><span>(31 байт, кодировка US-ASCII, без NULL-завершения).
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>// Определите хэш h = 32 байта
</span></span><span style="display:flex;"><span>// Дополните до 32 байтов. НЕ хэшируйте, так как это не больше 32 байтов.
</span></span><span style="display:flex;"><span>h = protocol_name || 0
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Определите ck = 32-байтный цепной ключ. Скопируйте данные h в ck.
</span></span><span style="display:flex;"><span>Установите chainKey = h
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>// MixHash(null пролог)
</span></span><span style="display:flex;"><span>h = SHA256(h);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>// до этого момента, все могут быть предварительно вычислены всеми роутерами.
</span></span></code></pre></div><h4 id="kdf-для-сообщения">KDF для сообщения</h4>
<p>Создатели сообщений создают эфемерную ключевую пару X25519 для каждого сообщения.
Эфемерные ключи должны быть уникальны для каждого сообщения.
Это соответствует тому, что указано в <a href="../../../ru/docs/specs/implementation/#tunnel-creation-ecies">Tunnel-Creation-ECIES</a>
 и <a href="../../../ru/proposals/152-ecies-tunnels/">Prop152</a>
 для сообщений о создании туннелей.</p>
<pre tabindex="0"><code class="language-dataspec" data-lang="dataspec">

// Статическая ключевая пара X25519 целевого роутера (hesk, hepk) из Идентификатора роутера
hesk = GENERATE_PRIVATE()
hepk = DERIVE_PUBLIC(hesk)

// MixHash(hepk)
// || ниже означает добавить
h = SHA256(h || hepk);

// до этого момента, все могут быть предварительно вычислены каждым роутером
// для всех входящих сообщений

// Отправитель создает эфемерную ключевую пару X25519
sesk = GENERATE_PRIVATE()
sepk = DERIVE_PUBLIC(sesk)

// MixHash(sepk)
h = SHA256(h || sepk);

Конец паттерна сообщения &#34;e&#34;.

Это паттерн сообщения &#34;es&#34;:

// Noise es
// Отправитель выполняет X25519 DH с статическим открытым ключом получателя.
// Целевой роутер
// извлекает эфемерный ключ отправителя, предшествующий зашифрованной записи.
sharedSecret = DH(sesk, hepk) = DH(hesk, sepk)

// MixKey(DH())
//[chainKey, k] = MixKey(sharedSecret)
// Параметры ChaChaPoly для шифрования/дешифрования
keydata = HKDF(chainKey, sharedSecret, &#34;&#34;, 64)
// Цепной ключ не используется
//chainKey = keydata[0:31]

// Параметры AEAD
k = keydata[32:63]
n = 0
plaintext = 464-байтная запись запроса на создание
ad = h
ciphertext = ENCRYPT(k, n, plaintext, ad)

Конец паттерна сообщения &#34;es&#34;.

// MixHash(ciphertext) не требуется
//h = SHA256(h || ciphertext)
</code></pre><h4 id="полезная-нагрузка">Полезная нагрузка</h4>
<p>Полезная нагрузка имеет тот же формат блока, что и определяется в <a href="../../../ru/docs/specs/ecies/">ECIES</a>
 и <a href="../../../ru/proposals/144-ecies-x25519-aead-ratchet/">Prop144</a>
.
Все сообщения должны содержать блок DateTime для предотвращения повторов.</p>
<h3 id="шифрование-ответов">Шифрование ответов</h3>
<p>Ответы на сообщения Database Lookup могут быть сообщениями Database Store или Database Search Reply.
Они шифруются как сообщения существующей сессии с
32-байтным ключом ответа и 8-байтным тегом ответа,
как указано в <a href="../../../ru/docs/specs/i2np/">I2NP</a>
 и <a href="../../../ru/proposals/154-ecies-lookups/">Prop154</a>
.</p>
<p>Явных ответов на сообщения Database Store нет. Отправитель может включить
собственный ответ как собственное Message Garlic, содержащее Delivery Status сообщение.</p>
<h2 id="обоснование">Обоснование</h2>
<p>Этот дизайн максимизирует повторное использование существующих криптографических примитивов, протоколов и кода.</p>
<p>Этот дизайн минимизирует риск.</p>
<h2 id="заметки-по-внедрению">Заметки по внедрению</h2>
<p>Старые роутеры не проверяют тип шифрования роутера и будут отправлять зашифрованные ElGamal
записи о создании или netdb сообщения.
Некоторые недавние роутеры имеют баги и будут отправлять различные типы неправильно сформированных записей о создании.
Некоторые недавние роутеры могут отправлять неанонимные (полные сессии ratchet) netdb сообщения.
Разработчики должны обнаруживать и отклонять эти записи и сообщения
как можно раньше, чтобы уменьшить использование CPU.</p>
<h2 id="проблемы">Проблемы</h2>
<p>Предложение 145 <a href="../../../ru/proposals/145-ecies/">Prop145</a>
 может не быть переписано для полной совместимости с
предложением 152 <a href="../../../ru/proposals/152-ecies-tunnels/">Prop152</a>
.</p>
<h2 id="миграция">Миграция</h2>
<p>Внедрение, тестирование и развертывание займет несколько выпусков
и приблизительно один год. Этапы следующие. Назначение
каждого этапа для конкретного выпуска TBD и зависит от
темпов разработки.</p>
<p>Детали реализации и миграции могут варьироваться для
каждой реализации I2P.</p>
<h3 id="базовая-связь-точка-точка">Базовая связь &ldquo;точка-точка&rdquo;</h3>
<p>ECIES роутеры могут соединяться с и принимать подключения от ElGamal роутеров.
Это должно быть возможно сейчас, так как несколько проверок было добавлено в кодовую базу Java
к середине 2019 года в ответ на незавершенное предложение 145 <a href="../../../ru/proposals/145-ecies/">Prop145</a>
.
Убедитесь, что в кодовых базах
ничего не препятствует соединениям точка-точка с не-ElGamal роутерами.</p>
<p>Проверки корректности кода:</p>
<ul>
<li>Убедитесь, что ElGamal роутеры не запрашивают ответы зашифрованные AEAD для сообщений DatabaseLookup
(когда ответ возвращается через исследовательский туннель роутеру)</li>
<li>Убедитесь, что ECIES роутеры не запрашивают ответы зашифрованные AES для сообщений DatabaseLookup
(когда ответ возвращается через исследовательский туннель роутеру)</li>
</ul>
<p>До поздних этапов, когда спецификации и реализации завершены:</p>
<ul>
<li>Убедитесь, что создание туннелей не выполняется роутерами ElGamal через роутеры ECIES.</li>
<li>Убедитесь, что зашифрованные сообщения ElGamal не отправляются роутерами ElGamal к floodfill роутерам ECIES.
(DatabaseLookups и DatabaseStores)</li>
<li>Убедитесь, что зашифрованные сообщения ECIES не отправляются роутерами ECIES к floodfill роутерам ElGamal.
(DatabaseLookups и DatabaseStores)</li>
<li>Убедитесь, что ECIES роутеры не автоматически становятся floodfill.</li>
</ul>
<p>Изменения не должны требоваться.
Целевой выпуск, если изменения необходимы: 0.9.48</p>
<h3 id="совместимость-netdb">Совместимость NetDB</h3>
<p>Убедитесь, что роутеры ECIES могут сохранять и извлекать информацию о роутерах (RouterInfos) из floodfill роутеров ElGamal.
Это должно быть возможно сейчас, так как несколько проверок было добавлено в кодовую базу Java
к середине 2019 года в ответ на незавершенное предложение 145 <a href="../../../ru/proposals/145-ecies/">Prop145</a>
.
Убедитесь, что в кодовых базах
ничего не препятствует хранению не-ElGamal RouterInfos в базе данных сети.</p>
<p>Изменения не должны требоваться.
Целевой выпуск, если изменения необходимы: 0.9.48</p>
<h3 id="создание-туннелей">Создание туннелей</h3>
<p>Реализуйте создание туннелей, как определено в предложении 152 <a href="../../../ru/proposals/152-ecies-tunnels/">Prop152</a>
.
Начинайте с того, чтобы роутер ECIES строил туннели с использованием всех узлов ElGamal;
используйте свою собственную запись о запросе для входящего туннеля для тестирования и отладки.</p>
<p>Затем протестируйте и поддержите роутеры ECIES, создающие туннели с использованием смешанных
узлов ElGamal и ECIES.</p>
<p>Затем включите создание туннелей через роутеры ECIES.
Проверка на минимальную версию не должна быть необходима, если после выпуска не будет сделано
несовместимых изменений в предложении 152.</p>
<p>Целевой выпуск: 0.9.48, конец 2020</p>
<h3 id="ratchet-сообщения-к-floodfill-ecies">Ratchet сообщения к floodfill ECIES</h3>
<p>Реализуйте и протестируйте прием сообщений ECIES (с нулевым статическим ключом) от floodfill ECIES,
как определено в предложении 144 <a href="../../../ru/proposals/144-ecies-x25519-aead-ratchet/">Prop144</a>
.
Реализуйте и протестируйте прием AEAD ответов на сообщения DatabaseLookup роутера ECIES.</p>
<p>Включите автозадание floodfill для роутеров ECIES.
Затем включите отправку сообщений ECIES к роутерам ECIES.
Проверка на минимальную версию не должна быть необходима, если после выпуска не будет сделано
несовместимых изменений в предложении 152.</p>
<p>Целевой выпуск: 0.9.49, начало 2021.
Роутеры ECIES могут автоматически становиться floodfill.</p>
<h3 id="переключение-ключей-и-новые-установки">Переключение ключей и новые установки</h3>
<p>Новые установки будут использовать ECIES по умолчанию, начиная с выпуска 0.9.49.</p>
<p>Постепенно переключайте ключи для всех роутеров, чтобы минимизировать риск и нарушение работы сети.
Используйте существующий код, который выполнял переключение ключей для перехода на другой тип подписи несколько лет назад.
Этот код дает каждому роутеру небольшой случайный шанс на переключение ключей при каждом перезапуске.
После нескольких перезапусков роутер, вероятно, переключится на ECIES.</p>
<p>Критерием для начала переключения ключей является то, что достаточная часть сети,
возможно, 50%, может строить туннели через роутеры ECIES (0.9.48 или выше).</p>
<p>Прежде чем агрессивно переключать ключи для всей сети, подавляющее большинство
(возможно, 90% или более) должны иметь возможность построить туннели через роутеры ECIES (0.9.48 или выше)
И отправлять сообщения к floodfill ECIES (0.9.49 или выше).
Эта цель, возможно, будет достигнута к выпуску 0.9.52.</p>
<p>Переключение ключей займет несколько выпусков.</p>
<p>Целевой выпуск:
0.9.49 для новых роутеров по умолчанию на ECIES;
0.9.49 для медленного начала переключения ключей;
0.9.50 - 0.9.52 для постоянного увеличения скорости переключения ключей;
конец 2021 для большинства сети быть переключенной.</p>
<h3 id="новое-сообщение-о-создании-туннеля-этап-2">Новое сообщение о создании туннеля (Этап 2)</h3>
<p>Реализуйте и протестируйте новое сообщение о создании туннеля, как определено в предложении 157 <a href="../../../ru/proposals/157-new-tbm/">Prop157</a>
.
Резервируйте поддержку в выпуске 0.9.51.
Проведите дополнительное тестирование, затем включите в выпуске 0.9.52.</p>
<p>Тестирование будет сложным.
Прежде чем его можно будет широко протестировать, большая часть сети должна его поддерживать.
Прежде чем оно станет широко полезным, большинство сети должно его поддерживать.
Если потребуется внесение изменений в спецификацию или реализацию после тестирования,
это задержит развертывание для дополнительного релиза.</p>
<p>Целевой выпуск: 0.9.52, конец 2021.</p>
<h3 id="завершение-переключения-ключей">Завершение переключения ключей</h3>
<p>В этот момент, роутеры старше определенной версии TBD
не смогут построить туннели через большинство узлов.</p>
<p>Целевой выпуск: 0.9.53, начало 2022.</p>

                </article>

                
                <nav class="page-nav">
                    <a href="../../../ru/proposals/" class="page-nav-link">
                        ← Back to Proposals
                    </a>
                    
                    
                    
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                            
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                    <a href="../../../proposals/156-ecies-routers.txt" class="page-nav-link" download>
                        Download Source (.txt)
                    </a>
                    
                </nav>
            </div>
        </div>
    </div>
</div>

<style>
.proposals-page {
    min-height: 100vh;
    padding: var(--spacing-xl) 0;
}

.breadcrumbs {
    display: flex;
    align-items: center;
    gap: var(--spacing-xs);
    margin-bottom: var(--spacing-lg);
    font-size: 0.875rem;
    color: var(--color-text-muted);
}

.breadcrumbs a {
    color: var(--color-text-muted);
    text-decoration: none;
    transition: color var(--transition-fast);
}

.breadcrumbs a:hover {
    color: var(--color-primary);
}

.separator {
    color: var(--color-border);
}

.current {
    color: var(--color-text);
}

 
.translation-disclaimer {
    background: #fef3c7;
    border: 1px solid #f59e0b;
    border-radius: var(--radius-md);
    padding: var(--spacing-md);
    margin-bottom: var(--spacing-lg);
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: var(--spacing-md);
    flex-wrap: wrap;
}

.dark .translation-disclaimer {
    background: #78350f;
    border-color: #d97706;
}

.disclaimer-message {
    color: #92400e;
    font-size: 0.875rem;
}

.dark .disclaimer-message {
    color: #fde047;
}

.disclaimer-link {
    color: #92400e;
    font-weight: 600;
    text-decoration: underline;
    white-space: nowrap;
}

.dark .disclaimer-link {
    color: #fde047;
}

 
.proposal-header {
    margin-bottom: var(--spacing-2xl);
}

.proposal-title-section {
    margin-bottom: var(--spacing-lg);
}

.proposal-title {
    font-size: 2.5rem;
    margin: 0 0 var(--spacing-sm) 0;
    color: var(--color-text);
}

.proposal-number {
    font-size: 0.875rem;
    color: var(--color-text-muted);
    font-weight: 600;
}

 
.proposal-meta-box {
    background: var(--color-bg-secondary);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-lg);
    padding: var(--spacing-lg);
}

.proposal-status {
    display: inline-block;
    padding: var(--spacing-xs) var(--spacing-md);
    border-radius: var(--radius-md);
    font-weight: 600;
    font-size: 0.875rem;
    margin-bottom: var(--spacing-md);
    text-transform: uppercase;
    letter-spacing: 0.05em;
}

 
.status-open {
    background: #dbeafe;
    color: #0369a1;
}

.dark .status-open {
    background: #0c4a6e;
    color: #7dd3fc;
}

.status-accepted {
    background: #dbeafe;
    color: #0369a1;
}

.dark .status-accepted {
    background: #0c4a6e;
    color: #7dd3fc;
}

.status-finished {
    background: #dcfce7;
    color: #15803d;
}

.dark .status-finished {
    background: #164e63;
    color: #86efac;
}

.status-closed {
    background: #dcfce7;
    color: #15803d;
}

.dark .status-closed {
    background: #164e63;
    color: #86efac;
}

.status-rejected {
    background: #fee2e2;
    color: #991b1b;
}

.dark .status-rejected {
    background: #7f1d1d;
    color: #fca5a5;
}

.status-draft,
.status-needs-revision,
.status-dead,
.status-needs-research {
    background: #fef3c7;
    color: #92400e;
}

.dark .status-draft,
.dark .status-needs-revision,
.dark .status-dead,
.dark .status-needs-research {
    background: #78350f;
    color: #fde047;
}

.status-meta,
.status-informational,
.status-reserve {
    background: #e9d5ff;
    color: #6b21a8;
}

.dark .status-meta,
.dark .status-informational,
.dark .status-reserve {
    background: #581c87;
    color: #e879f9;
}

 
.proposal-info-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: var(--spacing-md);
    margin-bottom: var(--spacing-lg);
}

.info-item {
    display: flex;
    flex-direction: column;
    gap: var(--spacing-xs);
}

.info-label {
    font-size: 0.75rem;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    color: var(--color-text-muted);
}

.info-value {
    font-size: 0.9375rem;
    color: var(--color-text);
    font-weight: 500;
}

 
.proposal-relationships {
    border-top: 1px solid var(--color-border);
    padding-top: var(--spacing-md);
}

.relationship {
    display: flex;
    gap: var(--spacing-md);
    margin-bottom: var(--spacing-sm);
}

.relationship:last-child {
    margin-bottom: 0;
}

.relationship-label {
    font-weight: 600;
    color: var(--color-text-muted);
    min-width: 120px;
}

.relationship-value {
    color: var(--color-text);
}

 
.proposal-layout {
    display: block;
}

.proposal-layout--with-toc {
    display: grid;
    grid-template-columns: 260px 1fr;
    gap: var(--spacing-2xl);
    align-items: start;
}

 
.proposal-toc-sidebar {
    position: sticky;
    top: 100px;
    max-height: calc(100vh - 120px);
    overflow-y: auto;
}

.toc-nav {
    background: var(--color-bg-secondary);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-lg);
    padding: var(--spacing-md);
}

.toc-header {
    display: flex;
    align-items: center;
    gap: var(--spacing-sm);
    font-weight: 700;
    font-size: 0.875rem;
    color: var(--color-text);
    padding-bottom: var(--spacing-md);
    margin-bottom: var(--spacing-md);
    border-bottom: 1px solid var(--color-border);
}

.toc-content {
    max-height: calc(100vh - 250px);
    overflow-y: auto;
}

.toc-content::-webkit-scrollbar {
    width: 4px;
}

.toc-content::-webkit-scrollbar-track {
    background: transparent;
}

.toc-content::-webkit-scrollbar-thumb {
    background: var(--color-border);
    border-radius: 2px;
}

.toc-content::-webkit-scrollbar-thumb:hover {
    background: var(--color-text-muted);
}

.toc-nav ul {
    list-style: none;
    padding-left: 0;
    margin: 0;
}

.toc-nav li {
    margin-bottom: 0.25rem;
}

.toc-nav ul ul {
    padding-left: var(--spacing-md);
    margin-top: 0.25rem;
}

.toc-nav a {
    color: var(--color-text-secondary);
    text-decoration: none;
    font-size: 0.8125rem;
    display: block;
    padding: 0.25rem 0.5rem;
    border-radius: var(--radius-sm);
    transition: all var(--transition-fast);
    line-height: 1.4;
}

.toc-nav a:hover {
    color: var(--color-primary);
    background: var(--color-bg-tertiary);
}

 
.proposal-main {
    min-width: 0;
}

 
.proposal-content {
    line-height: 1.8;
    color: var(--color-text);
    max-width: 900px;
}

.proposal-content h2 {
    margin-top: var(--spacing-2xl);
    margin-bottom: var(--spacing-md);
    font-size: 1.75rem;
    scroll-margin-top: 100px;
}

.proposal-content h3 {
    margin-top: var(--spacing-xl);
    margin-bottom: var(--spacing-sm);
    font-size: 1.375rem;
    scroll-margin-top: 100px;
}

.proposal-content h4 {
    margin-top: var(--spacing-lg);
    margin-bottom: var(--spacing-xs);
    font-size: 1.125rem;
    scroll-margin-top: 100px;
}

.proposal-content p {
    margin-bottom: var(--spacing-md);
}

.proposal-content ul,
.proposal-content ol {
    margin-bottom: var(--spacing-md);
    padding-left: var(--spacing-xl);
}

.proposal-content li {
    margin-bottom: var(--spacing-xs);
}

.proposal-content code {
    background: var(--color-bg-secondary);
    padding: 0.125rem 0.375rem;
    border-radius: var(--radius-sm);
    font-size: 0.875em;
    font-family: 'Courier New', monospace;
}

.proposal-content pre {
    background: var(--color-bg-secondary);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-md);
    padding: var(--spacing-md);
    overflow-x: auto;
    margin-bottom: var(--spacing-md);
    font-size: 0.875rem;
}

.proposal-content pre code {
    background: none;
    padding: 0;
}

.proposal-content blockquote {
    border-left: 4px solid var(--color-primary);
    padding-left: var(--spacing-md);
    margin-left: 0;
    margin-bottom: var(--spacing-md);
    font-style: italic;
    color: var(--color-text-secondary);
}

.proposal-content a {
    color: var(--color-primary);
    text-decoration: none;
    border-bottom: 1px solid transparent;
    transition: border-color var(--transition-fast);
}

.proposal-content a:hover {
    border-bottom-color: var(--color-primary);
}

.proposal-content table {
    width: 100%;
    border-collapse: collapse;
    margin-bottom: var(--spacing-md);
}

.proposal-content table th {
    background: var(--color-bg-secondary);
    padding: var(--spacing-sm);
    text-align: left;
    font-weight: 600;
    border-bottom: 2px solid var(--color-border);
}

.proposal-content table td {
    padding: var(--spacing-sm);
    border-bottom: 1px solid var(--color-border);
}

.proposal-content img {
    max-width: 100%;
    height: auto;
    border-radius: var(--radius-md);
    border: 1px solid var(--color-border);
    margin: var(--spacing-lg) 0;
    display: block;
}

 
.page-nav {
    margin-top: var(--spacing-2xl);
    padding-top: var(--spacing-xl);
    border-top: 1px solid var(--color-border);
    display: flex;
    gap: var(--spacing-md);
    flex-wrap: wrap;
}

.page-nav-link {
    display: inline-block;
    padding: var(--spacing-md) var(--spacing-lg);
    background: var(--color-bg-secondary);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-md);
    color: var(--color-text);
    text-decoration: none;
    transition: all var(--transition-fast);
}

.page-nav-link:hover {
    border-color: var(--color-primary);
    color: var(--color-primary);
}

 
@media (max-width: 1024px) {
    .proposal-layout--with-toc {
        grid-template-columns: 1fr;
    }

    .proposal-toc-sidebar {
        position: static;
        max-height: none;
        margin-bottom: var(--spacing-xl);
    }

    .toc-content {
        max-height: 300px;
    }
}

@media (max-width: 768px) {
    .proposal-title {
        font-size: 1.75rem;
    }

    .proposal-info-grid {
        grid-template-columns: 1fr;
    }
}
</style>



<script>
document.addEventListener('DOMContentLoaded', function() {
    const tocLinks = document.querySelectorAll('.toc-nav a');
    const headings = [];

    tocLinks.forEach(link => {
        const href = link.getAttribute('href');
        if (href && href.startsWith('#')) {
            const heading = document.getElementById(href.slice(1));
            if (heading) {
                headings.push({ element: heading, link: link });
            }
        }
    });

    function updateActiveLink() {
        const scrollPos = window.scrollY + 120;
        let activeIndex = 0;

        for (let i = 0; i < headings.length; i++) {
            if (headings[i].element.offsetTop <= scrollPos) {
                activeIndex = i;
            }
        }

        tocLinks.forEach(link => link.classList.remove('active'));
        if (headings[activeIndex]) {
            headings[activeIndex].link.classList.add('active');
        }
    }

    window.addEventListener('scroll', updateActiveLink);
    updateActiveLink();
});
</script>
<style>
.toc-nav a.active {
    color: var(--color-primary);
    background: var(--color-bg-tertiary);
    font-weight: 600;
}
</style>



    </main>

    <footer class="site-footer">
    <div class="container">
        <div class="footer-grid">
            <div class="footer-col footer-brand">
                <img src="../../../images/i2plogo_lightmode.svg" alt="I2P Logo" class="footer-logo logo-light" loading="lazy" decoding="async">
                <img src="../../../images/i2plogo_darkmode.svg" alt="I2P Logo" class="footer-logo logo-dark" loading="lazy" decoding="async">
                <p class="footer-tagline">Privacy. Security. Freedom.</p>
                <p class="footer-description">The Invisible Internet Project - A privacy-focused, anonymous network layer</p>

                <div class="footer-social-newsletter">
                    <div class="social-links">
                        <a href="https://mastodon.social/@i2p" target="_blank" rel="noopener" aria-label="Mastodon">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M21.327 8.566c0-4.339-2.843-5.61-2.843-5.61-1.433-.658-3.894-.935-6.451-.956h-.063c-2.557.021-5.016.298-6.45.956 0 0-2.843 1.272-2.843 5.61 0 .993-.019 2.181.012 3.441.103 4.243.778 8.425 4.701 9.463 1.809.479 3.362.579 4.612.51 2.268-.126 3.541-.809 3.541-.809l-.075-1.646s-1.621.511-3.441.449c-1.804-.062-3.707-.194-3.999-2.409a4.523 4.523 0 0 1-.04-.621s1.77.433 4.014.536c1.372.063 2.658-.08 3.965-.236 2.506-.299 4.688-1.843 4.962-3.254.434-2.223.398-5.424.398-5.424zm-3.353 5.59h-2.081V9.057c0-1.075-.452-1.62-1.357-1.62-1 0-1.501.647-1.501 1.927v2.791h-2.069V9.364c0-1.28-.501-1.927-1.502-1.927-.905 0-1.357.546-1.357 1.62v5.099H6.026V8.903c0-1.074.273-1.927.823-2.558.566-.631 1.307-.955 2.228-.955 1.065 0 1.872.409 2.405 1.228l.518.869.519-.869c.533-.819 1.34-1.228 2.405-1.228.92 0 1.662.324 2.228.955.549.631.822 1.484.822 2.558v5.253z"/>
                            </svg>
                        </a>
                        <a href="https://twitter.com/GetI2P" target="_blank" rel="noopener" aria-label="Twitter">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/>
                            </svg>
                        </a>
                        <a href="https://old.reddit.com/r/i2p" target="_blank" rel="noopener" aria-label="Reddit">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M12 0A12 12 0 0 0 0 12a12 12 0 0 0 12 12 12 12 0 0 0 12-12A12 12 0 0 0 12 0zm5.01 4.744c.688 0 1.25.561 1.25 1.249a1.25 1.25 0 0 1-2.498.056l-2.597-.547-.8 3.747c1.824.07 3.48.632 4.674 1.488.308-.309.73-.491 1.207-.491.968 0 1.754.786 1.754 1.754 0 .716-.435 1.333-1.01 1.614a3.111 3.111 0 0 1 .042.52c0 2.694-3.13 4.87-7.004 4.87-3.874 0-7.004-2.176-7.004-4.87 0-.183.015-.366.043-.534A1.748 1.748 0 0 1 4.028 12c0-.968.786-1.754 1.754-1.754.463 0 .898.196 1.207.49 1.207-.883 2.878-1.43 4.744-1.487l.885-4.182a.342.342 0 0 1 .14-.197.35.35 0 0 1 .238-.042l2.906.617a1.214 1.214 0 0 1 1.108-.701zM9.25 12C8.561 12 8 12.562 8 13.25c0 .687.561 1.248 1.25 1.248.687 0 1.248-.561 1.248-1.249 0-.688-.561-1.249-1.249-1.249zm5.5 0c-.687 0-1.248.561-1.248 1.25 0 .687.561 1.248 1.249 1.248.688 0 1.249-.561 1.249-1.249 0-.687-.562-1.249-1.25-1.249zm-5.466 3.99a.327.327 0 0 0-.231.094.33.33 0 0 0 0 .463c.842.842 2.484.913 2.961.913.477 0 2.105-.056 2.961-.913a.361.361 0 0 0 .029-.463.33.33 0 0 0-.464 0c-.547.533-1.684.73-2.512.73-.828 0-1.979-.196-2.512-.73a.326.326 0 0 0-.232-.095z"/>
                            </svg>
                        </a>
                        <a href="https://signal.group/#CjQKIOSUTtxlhbumAKcRsthPFkxkTUrkWcX39bbN6njLEgAIEhCTNsR0KDuiehAXZnkt42v5" target="_blank" rel="noopener" aria-label="Signal" class="signal-link">
                            <img src="../../../images/Signal-Logo-Black.svg" alt="Signal" class="signal-logo signal-logo-light" loading="lazy" decoding="async">
                            <img src="../../../images/Signal-Logo-White.svg" alt="Signal" class="signal-logo signal-logo-dark" loading="lazy" decoding="async">
                        </a>
                    </div>

                    
                    <div class="footer-newsletter-inline">
                        <p class="newsletter-description">Следите за новостями I2P:</p>
                        <form action="https://feedback.i2p.net/api/mailing-list/subscribe" method="POST" class="newsletter-form">
                            <input type="email" name="email" placeholder="Введите ваш email" required>
                            <button type="submit">Подписаться</button>
                        </form>
                    </div>
                </div>
            </div>

            <div class="footer-col">
                <h3>Быстрые ссылки</h3>
                <ul>
                    <li><a href="../../../ru/financial-support/">Пожертвовать</a></li>
                    <li><a href="../../../ru/docs/overview/intro/">Введение в I2P</a></li>
                </ul>
            </div>

            <div class="footer-col">
                <h3>Сообщество</h3>
                <ul>
                    <li><a href="../../../ru/get-involved/">Присоединяйтесь</a></li>
                    <li><a href="../../../ru/blog/">Блог</a></li>
                    <li><a href="http://i2pforum.net/" target="_blank" rel="noopener">Официальные форумы</a></li>
                    <li><a href="../../../ru/contact/">Контакты</a></li>
                </ul>
            </div>

            <div class="footer-col">
                <h3>Ресурсы</h3>
                <ul>
                    <li><a href="https://i2p-metrics.np-tokumei.net/" target="_blank" rel="noopener">I2P Метрики</a></li>
                    <li><a href="../../../ru/papers/">Исследование</a></li>
                    <li><a href="https://i2pgit.org/" target="_blank" rel="noopener">GitLab</a></li>
                    <li><a href="https://www.stormycloud.org/" target="_blank" rel="noopener">StormyCloud</a></li>
                </ul>
            </div>
        </div>

        <div class="footer-bottom">
            <p class="copyright">&copy; 2025 Проект Невидимый Интернет. Лицензировано под Creative Commons.</p>
            <div class="footer-links">
                <a href="../../../ru/privacy/">Конфиденциальность</a>
                <a href="../../../ru/terms/">Условия</a>
                <a href="../../../ru/about/media/">Пресса</a>
            </div>
        </div>
    </div>
</footer>


    
    
<div class="modal-overlay" id="poll">
    <div class="modal-content poll-modal-content">
        <a href="#" class="modal-close" aria-label="Закрыть">
            <span aria-hidden="true">&times;</span>
        </a>

        <div class="modal-header">
            <h2>Опрос сообщества</h2>
            <p class="modal-subtitle">Мы хотели бы услышать ваше мнение</p>
        </div>

        <div class="modal-body">
            
            <iframe 
                id="poll-iframe"
                data-poll-id="2"
                data-api-url="https://feedback.i2p.net"
                frameborder="0"
                scrolling="no"
                style="width: 100%; border: none; min-height: 400px;">
            </iframe>
        </div>

        <div class="modal-footer">
            <p class="modal-disclaimer">
                Ваш голос помогает формировать будущее I2P.
            </p>
        </div>
    </div>
</div>


<script>
(function() {
    const iframe = document.getElementById('poll-iframe');
    if (!iframe) return;
    
    const hostname = window.location.hostname;
    let apiUrl = 'https://feedback.i2p.net';
    const pollId = iframe.getAttribute('data-poll-id') || '1';

    
    if (hostname.endsWith('.b32.i2p') || hostname.endsWith('.i2p')) {
        apiUrl = 'http://5kwyynf3eetgqa2nors6ctwo7doi7yu73k7uvypy5eqmm326zkiq.b32.i2p';
    }
    
    else if (hostname.endsWith('.onion')) {
        apiUrl = 'http://gfonxmohvarpmocsvllscsuszdu5rikipm6innvcwq4vpng7zzqmmfyd.onion';
    }

    
    const pollUrl = apiUrl + '/widgets/poll.html?poll_id=' + encodeURIComponent(pollId) + '&api_url=' + encodeURIComponent(apiUrl);
    iframe.src = pollUrl;
})();
</script>



    
    



    
    <script>
        (function () {
            'use strict';
            var hostname = window.location.hostname;
            var baseUrl;

            
            if (hostname.endsWith('.b32.i2p') || hostname.endsWith('.i2p')) {
                baseUrl = 'http://5kwyynf3eetgqa2nors6ctwo7doi7yu73k7uvypy5eqmm326zkiq.b32.i2p';
            } else if (hostname.endsWith('.onion')) {
                baseUrl = 'http://gfonxmohvarpmocsvllscsuszdu5rikipm6innvcwq4vpng7zzqmmfyd.onion';
            } else {
                baseUrl = 'https://feedback.i2p.net';
            }

            window.feedbackBaseUrl = baseUrl;

            
            document.querySelectorAll('[data-api-url]').forEach(function (widget) {
                widget.setAttribute('data-api-url', baseUrl);
            });

            
            document.write('<link rel="stylesheet" href="' + baseUrl + '/widgets/styles.css">');
            
        })();
    </script>

    

    
    
    

    

</body>

</html>
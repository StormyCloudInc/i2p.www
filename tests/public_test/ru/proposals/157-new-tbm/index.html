<!DOCTYPE html>
<html lang="ru" data-theme="light">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <title>Меньшие Сообщения Построения Туннеля | I2P - Проект невидимого интернета</title>

    <meta name="description" content="The Invisible Internet Project - A privacy-focused, anonymous network layer">
    <meta name="keywords" content="i2p, privacy, anonymity, dark net, encryption, security">

    
    <meta property="og:title" content="Меньшие Сообщения Построения Туннеля | I2P - Проект невидимого интернета">
    <meta property="og:description" content="The Invisible Internet Project - A privacy-focused, anonymous network layer">
    <meta property="og:type" content="website">
    <meta property="og:url" content="/ru/proposals/157-new-tbm/">

    
    <link rel="icon" type="image/svg+xml" href="../../../images/favicon.svg">
    <link rel="icon" type="image/png" href="../../../images/i2plogo.png" sizes="32x32">

    
    
    
    
    <link rel="stylesheet" href="../../../css/main.min.be6880f32f5ff44e57579da7b11513b973319944ebe38748e3ac7f3268662d18.css" integrity="sha256-vmiA8y9f9E5XV52nsRUTuXMxmUTr44dI46x/MmhmLRg=">
    


    
</head>

<body>
    
    <input type="checkbox" id="theme-toggle-checkbox" class="theme-checkbox" aria-hidden="true">

    
<div class="site-banner" id="site-banner" data-banner-id="banner-3" role="alert" aria-live="polite">
    <div class="container">
        <div class="banner-content">
            <span class="banner-message">Бета-сайт I2P теперь доступен Сообщайте о проблемах с E-Mail на stormycloud@mail.i2p</span>
            
        </div>
        
        <form method="GET" action="../../../api/banner/dismiss" style="display: inline;">
            <input type="hidden" name="id" value="banner-3">
            <button type="submit" class="banner-close" aria-label="Закрыть баннер" title="Закрыть баннер">
                <span aria-hidden="true">&times;</span>
            </button>
        </form>
        
    </div>
</div>


    <header class="site-header">
    <div class="container">
        <nav class="main-nav">
            <div class="nav-brand">
                <a href="../../../ru/" class="logo-link">
                    <img src="../../../images/i2plogo_lightmode.svg" alt="I2P Logo" class="logo logo-light">
                    <img src="../../../images/i2plogo_darkmode.svg" alt="I2P Logo" class="logo logo-dark">
                </a>
            </div>

            
            <input type="checkbox" id="mobile-menu-checkbox" class="mobile-menu-checkbox"
                aria-label="Toggle navigation menu">
            <label for="mobile-menu-checkbox" class="mobile-menu-toggle" aria-label="Toggle navigation menu">
                <span class="hamburger"></span>
            </label>

            <div class="nav-menu">
                <ul class="nav-links">
                    <li class="nav-dropdown">
                        <a href="../../../ru/about/" class="">О проекте</a>
                        <ul class="dropdown-menu">
                            <li><a href="../../../ru/about/">Обзор</a></li>
                            <li><a href="../../../ru/papers/">Научные статьи</a></li>
                            <li><a href="../../../ru/about/media/">Пресса</a></li>
                            <li><a href="../../../ru/contact/">Связаться с нами</a></li>
                        </ul>
                    </li>
                    <li><a href="../../../ru/docs/" class="">Документы</a></li>
                    <li><a href="../../../ru/downloads/" class="">Загрузки</a></li>
                    <li><a href="../../../ru/blog/" class="">Блог</a></li>
                    <li class="nav-dropdown">
                        <a href="../../../ru/get-involved/" class="">Присоединиться</a>
                        <ul class="dropdown-menu">
                            <li><a href="../../../ru/get-involved/">Обзор</a></li>
                            <li><a href="../../../ru/feedback/">Предложения по функциям</a></li>
                        </ul>
                    </li>
                </ul>

                <div class="nav-actions">
                    
                    <div class="language-selector">
                        <button class="language-toggle" aria-label="Select language" title="Language">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none"
                                xmlns="http://www.w3.org/2000/svg">
                                <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2" />
                                <path
                                    d="M2 12h20M12 2a15.3 15.3 0 014 10 15.3 15.3 0 01-4 10 15.3 15.3 0 01-4-10 15.3 15.3 0 014-10z"
                                    stroke="currentColor" stroke-width="2" />
                            </svg>
                            <span class="current-lang">ru</span>
                        </button>
                        <div class="language-dropdown">
                            
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../en/proposals/157-new-tbm/"
                                class="lang-option">Английский</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../es/proposals/157-new-tbm/"
                                class="lang-option">Испанский</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../ko/proposals/157-new-tbm/"
                                class="lang-option">Корейский</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../zh/proposals/157-new-tbm/"
                                class="lang-option">Китайский</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../ru/proposals/157-new-tbm/"
                                class="lang-option active">Русский</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../cs/proposals/157-new-tbm/"
                                class="lang-option">Чешский</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../de/proposals/157-new-tbm/"
                                class="lang-option">Немецкий</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../fr/proposals/157-new-tbm/"
                                class="lang-option">Французский</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../tr/proposals/157-new-tbm/"
                                class="lang-option">Турецкий</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../vi/proposals/157-new-tbm/"
                                class="lang-option">Вьетнамский</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../hi/proposals/157-new-tbm/"
                                class="lang-option">Хинди</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../ar/proposals/157-new-tbm/"
                                class="lang-option">Арабский</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../pt/proposals/157-new-tbm/"
                                class="lang-option">Португальский</a>
                            
                            
                        </div>
                    </div>

                    
                    <label for="theme-toggle-checkbox" class="theme-toggle" aria-label="Toggle dark mode"
                        title="Toggle theme">
                        <svg class="sun-icon" width="20" height="20" viewBox="0 0 20 20" fill="none"
                            xmlns="http://www.w3.org/2000/svg">
                            <circle cx="10" cy="10" r="4" stroke="currentColor" stroke-width="2" />
                            <path
                                d="M10 2V4M10 16V18M18 10H16M4 10H2M15.657 4.343L14.243 5.757M5.757 14.243L4.343 15.657M15.657 15.657L14.243 14.243M5.757 5.757L4.343 4.343"
                                stroke="currentColor" stroke-width="2" stroke-linecap="round" />
                        </svg>
                        <svg class="moon-icon" width="20" height="20" viewBox="0 0 20 20" fill="none"
                            xmlns="http://www.w3.org/2000/svg">
                            <path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"
                                stroke="currentColor" stroke-width="2" stroke-linejoin="round" />
                        </svg>
                    </label>

                    
                    <a href="../../../ru/financial-support/" class="btn btn-primary" id="donate-btn">Donate</a>

                    
                    <a href="../../../ru/downloads/" class="btn btn-primary">Загрузить I2P</a>
                </div>
            </div>
        </nav>
    </div>
</header>

    <main id="main-content">
        



<div class="proposals-page">
    <div class="container">
        
        <nav class="breadcrumbs">
            <a href="../../../ru/">Home</a>
            <span class="separator">/</span>
            <a href="../../../ru/proposals/">Proposals</a>
            <span class="separator">/</span>
            <span class="current">Меньшие Сообщения Построения Туннеля</span>
        </nav>

        
<div class="translation-disclaimer" role="note">
    <span class="disclaimer-message">Этот перевод был создан с помощью машинного обучения и может быть не на 100% точным.</span>
    
    
    <a href="../../../en/proposals/157-new-tbm/" class="disclaimer-link">Просмотреть английскую версию</a>
    
</div>



        
        <header class="proposal-header">
            <div class="proposal-title-section">
                <h1 class="proposal-title">Меньшие Сообщения Построения Туннеля</h1>
                <div class="proposal-number">Proposal 157</div>
            </div>

            
            <div class="proposal-meta-box">
                <div class="proposal-status status-закрыто">
                    Закрыто
                </div>

                
                <div class="proposal-info-grid">
                    
                    <div class="info-item">
                        <span class="info-label">Author</span>
                        <span class="info-value">zzz, оригинал</span>
                    </div>
                    

                    
                    <div class="info-item">
                        <span class="info-label">Created</span>
                        <span class="info-value">2020-10-09</span>
                    </div>
                    

                    
                    <div class="info-item">
                        <span class="info-label">Last Updated</span>
                        <span class="info-value">2021-07-31</span>
                    </div>
                    

                    
                    <div class="info-item">
                        <span class="info-label">Target Version</span>
                        <span class="info-value">0.9.51</span>
                    </div>
                    

                    
                </div>

                
                
            </div>
        </header>

        
        <div class="proposal-layout proposal-layout--with-toc">
            
            
            <aside class="proposal-toc-sidebar">
                <nav class="toc-nav">
                    <div class="toc-header">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                            <path d="M4 6h16M4 12h16M4 18h16" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                        </svg>
                        On This Page
                    </div>
                    <div class="toc-content">
                        <nav id="TableOfContents">
  <ul>
    <li><a href="#примечание">Примечание</a></li>
    <li><a href="#обзор">Обзор</a>
      <ul>
        <li><a href="#резюме">Резюме</a></li>
        <li><a href="#цели">Цели</a></li>
        <li><a href="#не-цели">Не-Цели</a></li>
      </ul>
    </li>
    <li><a href="#дизайн">Дизайн</a>
      <ul>
        <li><a href="#записи">Записи</a></li>
        <li><a href="#сообщения-построения-туннеля">Сообщения Построения Туннеля</a></li>
        <li><a href="#поток-сообщений">Поток Сообщений</a></li>
        <li><a href="#шифрование-записей">Шифрование Записей</a></li>
        <li><a href="#шифрование-слоя">Шифрование Слоя</a></li>
        <li><a href="#новое-сообщение-данных-туннеля">Новое Сообщение Данных Туннеля</a></li>
      </ul>
    </li>
    <li><a href="#спецификация">Спецификация</a>
      <ul>
        <li><a href="#короткая-запись-запроса">Короткая Запись Запроса</a></li>
        <li><a href="#короткая-запись-ответа">Короткая Запись Ответа</a></li>
        <li><a href="#kdf">KDF</a></li>
        <li><a href="#shorttunnelbuild">ShortTunnelBuild</a></li>
        <li><a href="#outboundtunnelbuildreply">OutboundTunnelBuildReply</a></li>
        <li><a href="#kdf-1">KDF</a></li>
      </ul>
    </li>
    <li><a href="#обоснование">Обоснование</a></li>
    <li><a href="#примечания-к-реализации">Примечания к Реализации</a></li>
    <li><a href="#вопросы">Вопросы</a></li>
    <li><a href="#миграция">Миграция</a></li>
    <li><a href="#приложение">Приложение</a></li>
    <li><a href="#ссылки">Ссылки</a></li>
  </ul>
</nav>
                    </div>
                </nav>
            </aside>
            

            
            <div class="proposal-main">
                <article class="proposal-content">
                    <h2 id="примечание">Примечание</h2>
<p>Реализовано в версии API 0.9.51.
Выполняется внедрение и тестирование в сети.
Подлежит незначительным изменениям.
См. <a href="../../../ru/docs/specs/i2np/">I2NP</a>
 и <a href="../../../ru/docs/specs/implementation/#tunnel-creation-ecies">Tunnel-Creation-ECIES</a>
 для окончательной спецификации.</p>
<h2 id="обзор">Обзор</h2>
<h3 id="резюме">Резюме</h3>
<p>Текущий размер зашифрованных записей запроса и ответа на создание туннеля составляет 528 байт.
Для типичных сообщений Variable Tunnel Build и Variable Tunnel Build Reply
общий размер составляет 2113 байт. Это сообщение разбивается на три 1KB туннельных
сообщения для обратного пути.</p>
<p>Изменения в формате записи размером 528 байт для маршрутизаторов ECIES-X25519 специфицированы в <a href="../../../ru/proposals/152-ecies-tunnels/">Prop152</a>
 и <a href="../../../ru/docs/specs/implementation/#tunnel-creation-ecies">Tunnel-Creation-ECIES</a>
.
Для комбинации маршрутизаторов ElGamal и ECIES-X25519 в туннеле размер записи должен оставаться
528 байт. Однако если все маршрутизаторы в туннеле являются ECIES-X25519, возможна новая, меньшая
запись построения, так как шифрование ECIES-X25519 имеет значительно меньший оверхед,
чем ElGamal.</p>
<p>Меньшие сообщения позволили бы сэкономить пропускную способность. Также, если сообщения можно было бы вписать в одно
туннельное сообщение, обратный путь стал бы в три раза более эффективным.</p>
<p>Это предложение определяет новые записи запросов и ответов и новые сообщения Build Request и Build Reply.</p>
<p>Создатель туннеля и все узлы в созданном туннеле должны быть ECIES-X25519, и по крайней мере версии 0.9.51.
Это предложение не станет полезным, пока большинство маршрутизаторов в сети не будут ECIES-X25519.
Это ожидается к концу 2021 года.</p>
<h3 id="цели">Цели</h3>
<p>См. <a href="../../../ru/proposals/152-ecies-tunnels/">Prop152</a>
 и <a href="../../../ru/proposals/156-ecies-routers/">Prop156</a>
 для дополнительных целей.</p>
<ul>
<li>Меньшие записи и сообщения</li>
<li>Поддержание достаточного места для будущих опций, как в <a href="../../../ru/proposals/152-ecies-tunnels/">Prop152</a>
 и <a href="../../../ru/docs/specs/implementation/#tunnel-creation-ecies">Tunnel-Creation-ECIES</a>
</li>
<li>Вписывание в одно туннельное сообщение для обратного пути</li>
<li>Поддержка только узлов ECIES</li>
<li>Поддержание улучшений, реализованных в <a href="../../../ru/proposals/152-ecies-tunnels/">Prop152</a>
 и <a href="../../../ru/docs/specs/implementation/#tunnel-creation-ecies">Tunnel-Creation-ECIES</a>
</li>
<li>Максимальная совместимость с текущей сетью</li>
<li>Скрытие входящих сообщений построения от OBEP</li>
<li>Скрытие исходящих сообщений ответа построения от IBGW</li>
<li>Не требовать полного обновления всей сети (&ldquo;flag day&rdquo;)</li>
<li>Плавное развертывание для минимизации рисков</li>
<li>Повторное использование существующих криптографических примитивов</li>
</ul>
<h3 id="не-цели">Не-Цели</h3>
<p>См. <a href="../../../ru/proposals/156-ecies-routers/">Prop156</a>
 для дополнительных не-целей.</p>
<ul>
<li>Отсутствие требования для смешанных туннелей ElGamal/ECIES</li>
<li>Изменения шифрования слоя, для этого см. <a href="../../../ru/proposals/153-chacha20-layer-encryption/">Prop153</a>
</li>
<li>Отсутствие ускорений криптоопераций. Предполагается, что ChaCha20 и AES схожи,
даже при использовании AESNI, по крайней мере для рассматриваемых мелких объемов данных.</li>
</ul>
<h2 id="дизайн">Дизайн</h2>
<h3 id="записи">Записи</h3>
<p>См. приложение для расчетов.</p>
<p>Зашифрованные записи запроса и ответа будут занимать 218 байт, по сравнению с 528 байтами сейчас.</p>
<p>Записи нешифрованного запроса будут занимать 154 байта,
по сравнению с записями ElGamal, которые занимают 222 байта,
и записями ECIES, определенными в <a href="../../../ru/proposals/152-ecies-tunnels/">Prop152</a>
 и <a href="../../../ru/docs/specs/implementation/#tunnel-creation-ecies">Tunnel-Creation-ECIES</a>
, которые занимают 464 байта.</p>
<p>Записи нешифрованного ответа будут занимать 202 байта,
по сравнению с записями ElGamal, которые занимают 496 байт,
и записями ECIES, определенными в <a href="../../../ru/proposals/152-ecies-tunnels/">Prop152</a>
 и <a href="../../../ru/docs/specs/implementation/#tunnel-creation-ecies">Tunnel-Creation-ECIES</a>
, которые занимают 512 байт.</p>
<p>Шифрование ответа будет ChaCha20 (НЕ ChaCha20/Poly1305),
поэтому нешифрованные записи не нуждаются в кратности 16 байтам.</p>
<p>Записи запроса будут сделаны меньше с использованием HKDF для создания
ключей и ключей ответа слоя, так что их не нужно будет явно включать в запрос.</p>
<h3 id="сообщения-построения-туннеля">Сообщения Построения Туннеля</h3>
<p>Оба сообщения будут &ldquo;переменными&rdquo; с однобайтовым полем количества записей,
как в существующих переменных сообщениях.</p>
<h4 id="shorttunnelbuild-тип-25">ShortTunnelBuild: Тип 25</h4>
<p>Типичная длина (с 4 записями): 873 байта</p>
<p>При использовании для построения входящих туннелей
рекомендуется (но не требуется), чтобы это сообщение было зашифровано garlic шифрованием отправителем,
нацеливаясь на входной шлюз (инструкции доставки ROUTER),
чтобы скрыть входящие сообщения построения от OBEP.
IBGW расшифровывает сообщение,
помещает ответ в правильный слот,
и отправляет ShortTunnelBuildMessage следующему шагу.</p>
<p>Длина записи выбрана так, чтобы зашифрованный garlic STBM мог
вписаться в одно туннельное сообщение. См. приложение ниже.</p>
<h4 id="outboundtunnelbuildreply-тип-26">OutboundTunnelBuildReply: Тип 26</h4>
<p>Мы определяем новое сообщение OutboundTunnelBuildReply.
Оно используется только для построения исходящих туннелей.
Цель состоит в том, чтобы скрыть исходящие сообщения ответа на построение от IBGW.
Оно должно быть зашифровано garlic шифрованием OBEP, нацеленным на отправителя
(инструкции доставки TUNNEL).
OBEP расшифровывает сообщение построения туннеля,
конструирует сообщение OutboundTunnelBuildReply,
и помещает ответ в поле открытого текста.
Остальные записи размещаются в других слотах.
Затем оно зашифровывает сообщение для отправителя с использованием производных симметричных ключей.</p>
<h4 id="примечания">Примечания</h4>
<p>Шифруя garlic шифрованием OTBRM и STBM, мы также избегаем любых потенциальных
проблем с совместимостью у IBGW и OBEP спаренных туннелей.</p>
<h3 id="поток-сообщений">Поток Сообщений</h3>
<pre tabindex="0"><code>STBM: Короткое сообщение построения туннеля (тип 25)
  OTBRM: Сообщение ответа на построение исходящего туннеля (тип 26)

  Исходящее Построение A-B-C
  Ответ через существующий входящий D-E-F


                  Новый Туннель
           STBM      STBM      STBM
  Создатель ------&gt; A ------&gt; B ------&gt; C ---\
                                     OBEP   \
                                            | Зашифровано garlic шифрованием
                                            | OTBRM
                                            | (доставка TUNNEL)
                                            | от OBEP до
                                            | создателя
                Существующий Туннель             /
  Создатель &lt;-------F---------E-------- D &lt;--/
                                     IBGW


  Входящее Построение D-E-F
  Отправлено через существующий исходящий A-B-C


                Существующий Туннель
  Создатель ------&gt; A ------&gt; B ------&gt; C ---\
                                    OBEP    \
                                            | Зашифровано garlic шифрованием (опционально)
                                            | STBM
                                            | (доставка ROUTER)
                                            | от создателя
                  Новый Туннель                | к IBGW
            STBM      STBM      STBM        /
  Создатель &lt;------ F &lt;------ E &lt;------ D &lt;--/
                                     IBGW
</code></pre><h3 id="шифрование-записей">Шифрование Записей</h3>
<p>Шифрование записей запроса и ответа: как определено в <a href="../../../ru/proposals/152-ecies-tunnels/">Prop152</a>
 и <a href="../../../ru/docs/specs/implementation/#tunnel-creation-ecies">Tunnel-Creation-ECIES</a>
.</p>
<p>Шифрование записей ответа для других слотов: ChaCha20.</p>
<h3 id="шифрование-слоя">Шифрование Слоя</h3>
<p>В настоящее время нет планов по изменению шифрования слоя для туннелей, построенных с использованием
этой спецификации; оно останется AES, как и используется для всех туннелей.</p>
<p>Изменение шифрования слоя на ChaCha20 является темой для дополнительных исследований.</p>
<h3 id="новое-сообщение-данных-туннеля">Новое Сообщение Данных Туннеля</h3>
<p>В настоящее время нет планов по изменению 1KB Tunnel Data Message, используемого для туннелей, построенных с
этой спецификацией.</p>
<p>Может быть полезно ввести новое сообщение I2NP, которое будет больше или переменной длины, одновременно с этим предложением,
для использования через эти туннели.
Это бы сократило оверхед для больших сообщений.
Это является темой для дополнительных исследований.</p>
<h2 id="спецификация">Спецификация</h2>
<h3 id="короткая-запись-запроса">Короткая Запись Запроса</h3>
<h4 id="короткая-нешифрованная-запись-запроса">Короткая Нешифрованная Запись Запроса</h4>
<p>Это предлагаемая спецификация записи BuildRequestRecord для маршрутизаторов ECIES-X25519.
Обзор изменений из <a href="../../../ru/docs/specs/implementation/#tunnel-creation-ecies">Tunnel-Creation-ECIES</a>
:</p>
<ul>
<li>Изменение нешифрованной длины с 464 до 154 байт</li>
<li>Изменение зашифрованной длины с 528 до 218 байт</li>
<li>Удаление ключей и IV слоя и ответа, они будут сгенерированы из split() и KDF</li>
</ul>
<p>Запись запроса не содержит ключей ответа ChaCha.
Эти ключи генерируются из KDF. См. ниже.</p>
<p>Все поля в формате big-endian.</p>
<p>Нешифрованный размер: 154 байта.</p>
<pre tabindex="0"><code>байты     0-3: идентификатор туннеля для получения сообщений, ненулевой
  байты     4-7: следующий идентификатор туннеля, ненулевой
  байты    8-39: хеш идентификатора следующего маршрутизатора
  байт       40: флаги
  байты   41-42: дополнительные флаги, не используются, установлены в 0 для совместимости
  байт       43: тип шифрования слоя
  байты   44-47: время запроса (в минутах с момента эпохи, округлено вниз)
  байты   48-51: срок действия запроса (в секундах с момента создания)
  байты   52-55: следующий идентификатор сообщения
  байты    56-x: параметры построения туннеля (Mapping)
  байты     x-x: другие данные как подразумевается флагами или параметрами
  байты   x-153: случайная вставка (см. ниже)
</code></pre><p>Поле флагов такое же как определено в <a href="../../../ru/docs/specs/implementation/#tunnel-creation-ecies">Tunnel-Creation</a>
 и содержит следующее:</p>
<p>Порядок битов: 76543210 (бит 7 - старший)
бит 7: если установлен, разрешить сообщения от любого
бит 6: если установлен, разрешить сообщения к любому, и отправить ответ на
указанную следующую точку в сообщении Tunnel Build Reply
биты 5-0: Не определено, должны быть установлены в 0 для совместимости с будущими опциями</p>
<p>Бит 7 указывает, что шаg будет входным шлюзом (IBGW). Бит 6
указывает, что шаг будет выходной конечной точкой (OBEP). Если ни один бит не установлен,
то шаг будет промежуточным участником. Оба не могут быть установлены одновременно.</p>
<p>Тип шифрования слоя: 0 для AES (как в текущих туннелях);
1 для будущего (ChaCha?)</p>
<p>Срок действия запроса предназначен для будущей переменной продолжительности туннеля.
На данный момент единственное поддерживаемое значение - 600 (10 минут).</p>
<p>Временный открытый ключ создателя является ключом ECIES, big-endian.
Он используется для генерации KDF ключей и IV слоя и ответа IBGW.
Этот ключ включается в открытой записи только в сообщении построения входящего туннеля.
Он необходим, поскольку на этом этапе для записи построения нет DH.</p>
<p>Параметры построения туннеля - это структура Mapping, как определено в <a href="../../../ru/docs/specs/common-structures/">Common</a>
.
Это для будущего использования. На данный момент не определено никаких параметров.
Если структура Mapping пуста, это два байта 0x00 0x00.
Максимальный размер Mapping (включая поле длины) - 98 байт,
а максимальное значение поля длины Mapping - 96.</p>
<h4 id="короткая-зашифрованная-запись-запроса">Короткая Зашифрованная Запись Запроса</h4>
<p>Все поля в формате big-endian, за исключением временного открытого ключа, который в формате little-endian.</p>
<p>Зашифрованный размер: 218 байт</p>
<pre tabindex="0"><code>байты    0-15: усеченный хеш идентификатора перехода
  байты   16-47: временный публичный X25519 ключ отправителя
  байты  48-201: ChaCha20 зашифрованный ShortBuildRequestRecord
  байты 202-217: Poly1305 MAC
</code></pre><h3 id="короткая-запись-ответа">Короткая Запись Ответа</h3>
<h4 id="короткая-нешифрованная-запись-ответа">Короткая Нешифрованная Запись Ответа</h4>
<p>Это предлагаемая спецификация записи ShortBuildReplyRecord для маршрутизаторов ECIES-X25519.
Обзор изменений из <a href="../../../ru/docs/specs/implementation/#tunnel-creation-ecies">Tunnel-Creation-ECIES</a>
:</p>
<ul>
<li>Изменение нешифрованной длины с 512 до 202 байт</li>
<li>Изменение зашифрованной длины с 528 до 218 байт</li>
</ul>
<p>Ответы ECIES зашифрованы с использованием ChaCha20/Poly1305.</p>
<p>Все поля в формате big-endian.</p>
<p>Нешифрованный размер: 202 байта.</p>
<pre tabindex="0"><code>байты    0-x: Параметры Ответа на Построение Туннеля (Mapping)
  байты    x-x: другие данные как подразумевается параметрами
  байты  x-200: Случайная вставка (см. ниже)
  байт     201: Байт ответа
</code></pre><p>Параметры ответа на построение туннеля - это структура Mapping, как определено в <a href="../../../ru/docs/specs/common-structures/">Common</a>
.
Это для будущего использования. На данный момент не определено никаких параметров.
Если структура Mapping пуста, это два байта 0x00 0x00.
Максимальный размер Mapping (включая поле длины) - 201 байт,
а максимальное значение поля длины Mapping - 199.</p>
<p>Байт ответа является одним из следующих значений
как определено в <a href="../../../ru/docs/specs/implementation/#tunnel-creation-ecies">Tunnel-Creation</a>
 для предотвращения фингерпринтинга:</p>
<ul>
<li>0x00 (принять)</li>
<li>30 (TUNNEL_REJECT_BANDWIDTH)</li>
</ul>
<h4 id="короткая-зашифрованная-запись-ответа">Короткая Зашифрованная Запись Ответа</h4>
<p>Зашифрованный размер: 218 байт</p>
<pre tabindex="0"><code>байты   0-201: ChaCha20 зашифрованная ShortBuildReplyRecord
  байты 202-217: Poly1305 MAC
</code></pre><h3 id="kdf">KDF</h3>
<p>См. раздел KDF ниже.</p>
<h3 id="shorttunnelbuild">ShortTunnelBuild</h3>
<p>I2NP Тип 25</p>
<p>Это сообщение отправляется средним переходам, OBEP и IBEP (создатель).
Оно не может быть отправлено на IBGW (используйте garlic обернутое InboundTunnelBuild вместо этого).
Когда оно получено OBEP, оно преобразуется в OutboundTunnelBuildReply,
обернуто в garlic, и отправляется отправителю.</p>
<pre tabindex="0"><code>+----+----+----+----+----+----+----+----+
  | num| ShortBuildRequestRecords...
  +----+----+----+----+----+----+----+----+

  num ::
         1 байт `Integer`
         Допустимые значения: 1-8

  размер записи: 218 байт
  общий размер: 1+$num*218
</code></pre><h4 id="примечания-1">Примечания</h4>
<ul>
<li>Типичное количество записей - 4, для общего размера в 873 байта.</li>
</ul>
<h3 id="outboundtunnelbuildreply">OutboundTunnelBuildReply</h3>
<p>I2NP Тип 26</p>
<p>Это сообщение отправляется только OBEP к IBEP (создателю) через существующий входящий туннель.
Оно не может быть отправлено на любой другой узел.
Оно всегда обернуто в garlic шифрование.</p>
<pre tabindex="0"><code>+----+----+----+----+----+----+----+----+
  | num|                                  |
  +----+                                  +
  |      ShortBuildReplyRecords...        |
  +----+----+----+----+----+----+----+----+

  num ::
         Общее количество записей,
         1 байт `Integer`
         Допустимые значения: 1-8

  ShortBuildReplyRecords ::
         Зашифрованные записи
         длина: num * 218

  размер зашифрованной записи: 218 байт
  общий размер: 1+$num*218
</code></pre><h4 id="примечания-2">Примечания</h4>
<ul>
<li>Типичное количество записей - 4, для общего размера в 873 байта.</li>
<li>Это сообщение должно быть зашифровано garlic.</li>
</ul>
<h3 id="kdf-1">KDF</h3>
<p>Мы используем ck из состояния Noise после шифрования/расшифровки записи построения туннеля
для вывода следующих ключей: ключ ответа, ключ шифрования слоя AES, ключ IV AES и ключ/тег garlic ответа для OBEP.</p>
<p>Ключ ответа:
В отличие от длинных записей, мы не можем использовать левую часть ck для ключа ответа, так как он не последний и будет использован позже.
Ключ ответа используется для шифрования ответа этой записи с использованием AEAD/Chaha20/Poly1305 и Chacha20 для ответа другим записям.
Обе используют один и тот же ключ, nonce - это позиция записи в сообщении, начиная с 0.</p>
<pre tabindex="0"><code>keydata = HKDF(ck, ZEROLEN, &#34;SMTunnelReplyKey&#34;, 64)
  replyKey = keydata[32:63]
  ck = keydata[0:31]

  Ключ слоя:
  Ключ слоя всегда AES на данный момент, но то же KDF можно использовать для Chacha20

  keydata = HKDF(ck, ZEROLEN, &#34;SMTunnelLayerKey&#34;, 64)
  layerKey = keydata[32:63]

  Ключ IV для не-OBEP записи:
  ivKey = keydata[0:31]
  потому что он последний

  Ключ IV для записи OBEP:
  ck = keydata[0:31]
  keydata = HKDF(ck, ZEROLEN, &#34;TunnelLayerIVKey&#34;, 64)
  ivKey = keydata[32:63]
  ck = keydata[0:31]

  OBEP garlic ключ ответа/тег:
  keydata = HKDF(ck, ZEROLEN, &#34;RGarlicKeyAndTag&#34;, 64)
  replyKey = keydata[32:63]
  replyTag = keydata[0:7]
</code></pre><h2 id="обоснование">Обоснование</h2>
<p>Данный дизайн максимально использует повторное использование существующих криптографических примитивов, протоколов и кода.</p>
<p>Этот дизайн минимизирует риски.</p>
<p>ChaCha20 слегка быстрее AES для мелких записей, согласно тестам на Java.
ChaCha20 избегает требования к кратности размеров данных 16 байтам.</p>
<h2 id="примечания-к-реализации">Примечания к Реализации</h2>
<ul>
<li>Как и в существующем переменном сообщении построения туннеля,
сообщения с количеством записей менее 4 нежелательны.
Типичное значение по умолчанию - 3 узла.
Входящие туннели должны быть построены с дополнительной записью для
отправителя, чтобы последний этап не знал, что он последний.
Чтобы средние этапы не знали, обсуждается ли туннель входящим или исходящим,
исходящие туннели также должны быть построены с 4 записями.</li>
</ul>
<h2 id="вопросы">Вопросы</h2>
<h2 id="миграция">Миграция</h2>
<p>Реализация, тестирование и развертывание займут несколько выпусков
и приблизительно один год. Этапы следующие. Назначение
каждого этапа на конкретный выпуск TBD и зависит от
темпа разработки.</p>
<p>Детали реализации и миграции могут варьироваться для
каждой реализации I2P.</p>
<p>Создатель туннеля должен убедиться, что все переходы в созданном туннеле ECIES-X25519, И как минимум версии TBD.
Создатель туннеля НЕ обязательно должен быть ECIES-X25519; он может быть ElGamal.
Однако, если создатель ElGamal, это раскрывает ближайшему переходу, что он является создателем.
Таким образом, на практике, эти туннели должны создаваться только маршрутизаторами ECIES.</p>
<p>Не должно быть необходимости, чтобы спаренный туннель OBEP или IBGW был ECIES или
какой-либо конкретной версии.
Новые сообщения зашифрованы garlic и не видимы на OBEP или IBGW
спаренного туннеля.</p>
<p>Этап 1: Реализация, не включена по умолчанию</p>
<p>Этап 2 (следующий выпуск): Включение по умолчанию</p>
<p>Нет проблем с обратной совместимостью. Новые сообщения могут быть отправлены только маршрутизаторам, которые их поддерживают.</p>
<h2 id="приложение">Приложение</h2>
<p>Без оверхеда garlic для незашифрованного входящего STBM,
если мы не используем ITBM:</p>
<pre tabindex="0"><code>Текущий размер для 4 слотов: 4 * 528 + оверхед = 3 туннельных сообщения

  Сообщение построения для 4 слотов, чтобы вписаться в одно туннельное сообщение, только ECIES:

  1024
  - 21 заголовок фрагмента
  ----
  1003
  - 35 инструкции доставки необработанного ROUTER
  ----
  968
  - 16 заголовок I2NP
  ----
  952
  - 1 количество слотов
  ----
  951
  / 4 слота
  ----
  237 Новый размер зашифрованной записи построения (в сравнении с 528 в настоящее время)
  - 16 укороченный хеш
  - 32 временный ключ
  - 16 MAC
  ----
  173 максимальный размер открытого текста записи построения (в сравнении с 222 в настоящее время)
</code></pre><p>С учетом оверхеда garlic для &lsquo;N&rsquo; паттерна noise для шифрования входящего STBM,
если мы не используем ITBM:</p>
<pre tabindex="0"><code>Текущий размер для 4 слотов: 4 * 528 + оверхед = 3 туннельных сообщения

  Зашифрованное garlic сообщение построения для 4 слотов, чтобы вписаться в одно туннельное сообщение, только ECIES:

  1024
  - 21 заголовок фрагмента
  ----
  1003
  - 35 инструкции доставки необработанного ROUTER
  ----
  968
  - 16 заголовок I2NP
  -  4 длина
  ----
  948
  - 32 байта временного ключа
  ----
  916
  - 7 байт блок DateTime
  ----
  909
  - 3 байта оверхеда Garlic блока
  ----
  906
  - 9 байт заголовка I2NP
  ----
  897
  - 1 байт инструкции локальной доставки Garlic
  ----
  896
  - 16 байт Poly1305 MAC
  ----
  880
  - 1 количество слотов
  ----
  879
  / 4 слота
  ----
  219 Новый размер зашифрованной записи построения (в сравнении с 528 в настоящее время)
  - 16 укороченный хеш
  - 32 временный ключ
  - 16 MAC
  ----
  155 максимальный размер открытого текста записи построения (в сравнении с 222 в настоящее время)
</code></pre><p>Примечания:</p>
<p>Текущий размер открытого текста записи перед неиспользуемой вставкой: 193</p>
<p>Удаление полного хеша маршрутизатора и генерация HKDF ключей/IV освободит много места для будущих опций.
Если все использует HKDF, требуется около 58 байт пространства открытого текста (без учета опций).</p>
<p>Garlic-обернутый OTBRM будет немного меньше, чем garlic-обернутый STBM,
потому что инструкции доставки LOCAL, а не ROUTER,
включён блок DATETIME, и
используется 8-байтовый тег вместо 32-байтового временного ключа для полных сообщений &lsquo;N&rsquo;.</p>
<h2 id="ссылки">Ссылки</h2>

                </article>

                
                <nav class="page-nav">
                    <a href="../../../ru/proposals/" class="page-nav-link">
                        ← Back to Proposals
                    </a>
                    
                    
                    
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                            
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                    <a href="../../../proposals/157-new-tbm.txt" class="page-nav-link" download>
                        Download Source (.txt)
                    </a>
                    
                </nav>
            </div>
        </div>
    </div>
</div>

<style>
.proposals-page {
    min-height: 100vh;
    padding: var(--spacing-xl) 0;
}

.breadcrumbs {
    display: flex;
    align-items: center;
    gap: var(--spacing-xs);
    margin-bottom: var(--spacing-lg);
    font-size: 0.875rem;
    color: var(--color-text-muted);
}

.breadcrumbs a {
    color: var(--color-text-muted);
    text-decoration: none;
    transition: color var(--transition-fast);
}

.breadcrumbs a:hover {
    color: var(--color-primary);
}

.separator {
    color: var(--color-border);
}

.current {
    color: var(--color-text);
}

 
.translation-disclaimer {
    background: #fef3c7;
    border: 1px solid #f59e0b;
    border-radius: var(--radius-md);
    padding: var(--spacing-md);
    margin-bottom: var(--spacing-lg);
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: var(--spacing-md);
    flex-wrap: wrap;
}

.dark .translation-disclaimer {
    background: #78350f;
    border-color: #d97706;
}

.disclaimer-message {
    color: #92400e;
    font-size: 0.875rem;
}

.dark .disclaimer-message {
    color: #fde047;
}

.disclaimer-link {
    color: #92400e;
    font-weight: 600;
    text-decoration: underline;
    white-space: nowrap;
}

.dark .disclaimer-link {
    color: #fde047;
}

 
.proposal-header {
    margin-bottom: var(--spacing-2xl);
}

.proposal-title-section {
    margin-bottom: var(--spacing-lg);
}

.proposal-title {
    font-size: 2.5rem;
    margin: 0 0 var(--spacing-sm) 0;
    color: var(--color-text);
}

.proposal-number {
    font-size: 0.875rem;
    color: var(--color-text-muted);
    font-weight: 600;
}

 
.proposal-meta-box {
    background: var(--color-bg-secondary);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-lg);
    padding: var(--spacing-lg);
}

.proposal-status {
    display: inline-block;
    padding: var(--spacing-xs) var(--spacing-md);
    border-radius: var(--radius-md);
    font-weight: 600;
    font-size: 0.875rem;
    margin-bottom: var(--spacing-md);
    text-transform: uppercase;
    letter-spacing: 0.05em;
}

 
.status-open {
    background: #dbeafe;
    color: #0369a1;
}

.dark .status-open {
    background: #0c4a6e;
    color: #7dd3fc;
}

.status-accepted {
    background: #dbeafe;
    color: #0369a1;
}

.dark .status-accepted {
    background: #0c4a6e;
    color: #7dd3fc;
}

.status-finished {
    background: #dcfce7;
    color: #15803d;
}

.dark .status-finished {
    background: #164e63;
    color: #86efac;
}

.status-closed {
    background: #dcfce7;
    color: #15803d;
}

.dark .status-closed {
    background: #164e63;
    color: #86efac;
}

.status-rejected {
    background: #fee2e2;
    color: #991b1b;
}

.dark .status-rejected {
    background: #7f1d1d;
    color: #fca5a5;
}

.status-draft,
.status-needs-revision,
.status-dead,
.status-needs-research {
    background: #fef3c7;
    color: #92400e;
}

.dark .status-draft,
.dark .status-needs-revision,
.dark .status-dead,
.dark .status-needs-research {
    background: #78350f;
    color: #fde047;
}

.status-meta,
.status-informational,
.status-reserve {
    background: #e9d5ff;
    color: #6b21a8;
}

.dark .status-meta,
.dark .status-informational,
.dark .status-reserve {
    background: #581c87;
    color: #e879f9;
}

 
.proposal-info-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: var(--spacing-md);
    margin-bottom: var(--spacing-lg);
}

.info-item {
    display: flex;
    flex-direction: column;
    gap: var(--spacing-xs);
}

.info-label {
    font-size: 0.75rem;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    color: var(--color-text-muted);
}

.info-value {
    font-size: 0.9375rem;
    color: var(--color-text);
    font-weight: 500;
}

 
.proposal-relationships {
    border-top: 1px solid var(--color-border);
    padding-top: var(--spacing-md);
}

.relationship {
    display: flex;
    gap: var(--spacing-md);
    margin-bottom: var(--spacing-sm);
}

.relationship:last-child {
    margin-bottom: 0;
}

.relationship-label {
    font-weight: 600;
    color: var(--color-text-muted);
    min-width: 120px;
}

.relationship-value {
    color: var(--color-text);
}

 
.proposal-layout {
    display: block;
}

.proposal-layout--with-toc {
    display: grid;
    grid-template-columns: 260px 1fr;
    gap: var(--spacing-2xl);
    align-items: start;
}

 
.proposal-toc-sidebar {
    position: sticky;
    top: 100px;
    max-height: calc(100vh - 120px);
    overflow-y: auto;
}

.toc-nav {
    background: var(--color-bg-secondary);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-lg);
    padding: var(--spacing-md);
}

.toc-header {
    display: flex;
    align-items: center;
    gap: var(--spacing-sm);
    font-weight: 700;
    font-size: 0.875rem;
    color: var(--color-text);
    padding-bottom: var(--spacing-md);
    margin-bottom: var(--spacing-md);
    border-bottom: 1px solid var(--color-border);
}

.toc-content {
    max-height: calc(100vh - 250px);
    overflow-y: auto;
}

.toc-content::-webkit-scrollbar {
    width: 4px;
}

.toc-content::-webkit-scrollbar-track {
    background: transparent;
}

.toc-content::-webkit-scrollbar-thumb {
    background: var(--color-border);
    border-radius: 2px;
}

.toc-content::-webkit-scrollbar-thumb:hover {
    background: var(--color-text-muted);
}

.toc-nav ul {
    list-style: none;
    padding-left: 0;
    margin: 0;
}

.toc-nav li {
    margin-bottom: 0.25rem;
}

.toc-nav ul ul {
    padding-left: var(--spacing-md);
    margin-top: 0.25rem;
}

.toc-nav a {
    color: var(--color-text-secondary);
    text-decoration: none;
    font-size: 0.8125rem;
    display: block;
    padding: 0.25rem 0.5rem;
    border-radius: var(--radius-sm);
    transition: all var(--transition-fast);
    line-height: 1.4;
}

.toc-nav a:hover {
    color: var(--color-primary);
    background: var(--color-bg-tertiary);
}

 
.proposal-main {
    min-width: 0;
}

 
.proposal-content {
    line-height: 1.8;
    color: var(--color-text);
    max-width: 900px;
}

.proposal-content h2 {
    margin-top: var(--spacing-2xl);
    margin-bottom: var(--spacing-md);
    font-size: 1.75rem;
    scroll-margin-top: 100px;
}

.proposal-content h3 {
    margin-top: var(--spacing-xl);
    margin-bottom: var(--spacing-sm);
    font-size: 1.375rem;
    scroll-margin-top: 100px;
}

.proposal-content h4 {
    margin-top: var(--spacing-lg);
    margin-bottom: var(--spacing-xs);
    font-size: 1.125rem;
    scroll-margin-top: 100px;
}

.proposal-content p {
    margin-bottom: var(--spacing-md);
}

.proposal-content ul,
.proposal-content ol {
    margin-bottom: var(--spacing-md);
    padding-left: var(--spacing-xl);
}

.proposal-content li {
    margin-bottom: var(--spacing-xs);
}

.proposal-content code {
    background: var(--color-bg-secondary);
    padding: 0.125rem 0.375rem;
    border-radius: var(--radius-sm);
    font-size: 0.875em;
    font-family: 'Courier New', monospace;
}

.proposal-content pre {
    background: var(--color-bg-secondary);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-md);
    padding: var(--spacing-md);
    overflow-x: auto;
    margin-bottom: var(--spacing-md);
    font-size: 0.875rem;
}

.proposal-content pre code {
    background: none;
    padding: 0;
}

.proposal-content blockquote {
    border-left: 4px solid var(--color-primary);
    padding-left: var(--spacing-md);
    margin-left: 0;
    margin-bottom: var(--spacing-md);
    font-style: italic;
    color: var(--color-text-secondary);
}

.proposal-content a {
    color: var(--color-primary);
    text-decoration: none;
    border-bottom: 1px solid transparent;
    transition: border-color var(--transition-fast);
}

.proposal-content a:hover {
    border-bottom-color: var(--color-primary);
}

.proposal-content table {
    width: 100%;
    border-collapse: collapse;
    margin-bottom: var(--spacing-md);
}

.proposal-content table th {
    background: var(--color-bg-secondary);
    padding: var(--spacing-sm);
    text-align: left;
    font-weight: 600;
    border-bottom: 2px solid var(--color-border);
}

.proposal-content table td {
    padding: var(--spacing-sm);
    border-bottom: 1px solid var(--color-border);
}

.proposal-content img {
    max-width: 100%;
    height: auto;
    border-radius: var(--radius-md);
    border: 1px solid var(--color-border);
    margin: var(--spacing-lg) 0;
    display: block;
}

 
.page-nav {
    margin-top: var(--spacing-2xl);
    padding-top: var(--spacing-xl);
    border-top: 1px solid var(--color-border);
    display: flex;
    gap: var(--spacing-md);
    flex-wrap: wrap;
}

.page-nav-link {
    display: inline-block;
    padding: var(--spacing-md) var(--spacing-lg);
    background: var(--color-bg-secondary);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-md);
    color: var(--color-text);
    text-decoration: none;
    transition: all var(--transition-fast);
}

.page-nav-link:hover {
    border-color: var(--color-primary);
    color: var(--color-primary);
}

 
@media (max-width: 1024px) {
    .proposal-layout--with-toc {
        grid-template-columns: 1fr;
    }

    .proposal-toc-sidebar {
        position: static;
        max-height: none;
        margin-bottom: var(--spacing-xl);
    }

    .toc-content {
        max-height: 300px;
    }
}

@media (max-width: 768px) {
    .proposal-title {
        font-size: 1.75rem;
    }

    .proposal-info-grid {
        grid-template-columns: 1fr;
    }
}
</style>



<script>
document.addEventListener('DOMContentLoaded', function() {
    const tocLinks = document.querySelectorAll('.toc-nav a');
    const headings = [];

    tocLinks.forEach(link => {
        const href = link.getAttribute('href');
        if (href && href.startsWith('#')) {
            const heading = document.getElementById(href.slice(1));
            if (heading) {
                headings.push({ element: heading, link: link });
            }
        }
    });

    function updateActiveLink() {
        const scrollPos = window.scrollY + 120;
        let activeIndex = 0;

        for (let i = 0; i < headings.length; i++) {
            if (headings[i].element.offsetTop <= scrollPos) {
                activeIndex = i;
            }
        }

        tocLinks.forEach(link => link.classList.remove('active'));
        if (headings[activeIndex]) {
            headings[activeIndex].link.classList.add('active');
        }
    }

    window.addEventListener('scroll', updateActiveLink);
    updateActiveLink();
});
</script>
<style>
.toc-nav a.active {
    color: var(--color-primary);
    background: var(--color-bg-tertiary);
    font-weight: 600;
}
</style>



    </main>

    <footer class="site-footer">
    <div class="container">
        <div class="footer-grid">
            <div class="footer-col footer-brand">
                <img src="../../../images/i2plogo_lightmode.svg" alt="I2P Logo" class="footer-logo logo-light" loading="lazy" decoding="async">
                <img src="../../../images/i2plogo_darkmode.svg" alt="I2P Logo" class="footer-logo logo-dark" loading="lazy" decoding="async">
                <p class="footer-tagline">Privacy. Security. Freedom.</p>
                <p class="footer-description">The Invisible Internet Project - A privacy-focused, anonymous network layer</p>

                <div class="footer-social-newsletter">
                    <div class="social-links">
                        <a href="https://mastodon.social/@i2p" target="_blank" rel="noopener" aria-label="Mastodon">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M21.327 8.566c0-4.339-2.843-5.61-2.843-5.61-1.433-.658-3.894-.935-6.451-.956h-.063c-2.557.021-5.016.298-6.45.956 0 0-2.843 1.272-2.843 5.61 0 .993-.019 2.181.012 3.441.103 4.243.778 8.425 4.701 9.463 1.809.479 3.362.579 4.612.51 2.268-.126 3.541-.809 3.541-.809l-.075-1.646s-1.621.511-3.441.449c-1.804-.062-3.707-.194-3.999-2.409a4.523 4.523 0 0 1-.04-.621s1.77.433 4.014.536c1.372.063 2.658-.08 3.965-.236 2.506-.299 4.688-1.843 4.962-3.254.434-2.223.398-5.424.398-5.424zm-3.353 5.59h-2.081V9.057c0-1.075-.452-1.62-1.357-1.62-1 0-1.501.647-1.501 1.927v2.791h-2.069V9.364c0-1.28-.501-1.927-1.502-1.927-.905 0-1.357.546-1.357 1.62v5.099H6.026V8.903c0-1.074.273-1.927.823-2.558.566-.631 1.307-.955 2.228-.955 1.065 0 1.872.409 2.405 1.228l.518.869.519-.869c.533-.819 1.34-1.228 2.405-1.228.92 0 1.662.324 2.228.955.549.631.822 1.484.822 2.558v5.253z"/>
                            </svg>
                        </a>
                        <a href="https://twitter.com/GetI2P" target="_blank" rel="noopener" aria-label="Twitter">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/>
                            </svg>
                        </a>
                        <a href="https://old.reddit.com/r/i2p" target="_blank" rel="noopener" aria-label="Reddit">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M12 0A12 12 0 0 0 0 12a12 12 0 0 0 12 12 12 12 0 0 0 12-12A12 12 0 0 0 12 0zm5.01 4.744c.688 0 1.25.561 1.25 1.249a1.25 1.25 0 0 1-2.498.056l-2.597-.547-.8 3.747c1.824.07 3.48.632 4.674 1.488.308-.309.73-.491 1.207-.491.968 0 1.754.786 1.754 1.754 0 .716-.435 1.333-1.01 1.614a3.111 3.111 0 0 1 .042.52c0 2.694-3.13 4.87-7.004 4.87-3.874 0-7.004-2.176-7.004-4.87 0-.183.015-.366.043-.534A1.748 1.748 0 0 1 4.028 12c0-.968.786-1.754 1.754-1.754.463 0 .898.196 1.207.49 1.207-.883 2.878-1.43 4.744-1.487l.885-4.182a.342.342 0 0 1 .14-.197.35.35 0 0 1 .238-.042l2.906.617a1.214 1.214 0 0 1 1.108-.701zM9.25 12C8.561 12 8 12.562 8 13.25c0 .687.561 1.248 1.25 1.248.687 0 1.248-.561 1.248-1.249 0-.688-.561-1.249-1.249-1.249zm5.5 0c-.687 0-1.248.561-1.248 1.25 0 .687.561 1.248 1.249 1.248.688 0 1.249-.561 1.249-1.249 0-.687-.562-1.249-1.25-1.249zm-5.466 3.99a.327.327 0 0 0-.231.094.33.33 0 0 0 0 .463c.842.842 2.484.913 2.961.913.477 0 2.105-.056 2.961-.913a.361.361 0 0 0 .029-.463.33.33 0 0 0-.464 0c-.547.533-1.684.73-2.512.73-.828 0-1.979-.196-2.512-.73a.326.326 0 0 0-.232-.095z"/>
                            </svg>
                        </a>
                        <a href="https://signal.group/#CjQKIOSUTtxlhbumAKcRsthPFkxkTUrkWcX39bbN6njLEgAIEhCTNsR0KDuiehAXZnkt42v5" target="_blank" rel="noopener" aria-label="Signal" class="signal-link">
                            <img src="../../../images/Signal-Logo-Black.svg" alt="Signal" class="signal-logo signal-logo-light" loading="lazy" decoding="async">
                            <img src="../../../images/Signal-Logo-White.svg" alt="Signal" class="signal-logo signal-logo-dark" loading="lazy" decoding="async">
                        </a>
                    </div>

                    
                    <div class="footer-newsletter-inline">
                        <p class="newsletter-description">Следите за новостями I2P:</p>
                        <form action="https://feedback.i2p.net/api/mailing-list/subscribe" method="POST" class="newsletter-form">
                            <input type="email" name="email" placeholder="Введите ваш email" required>
                            <button type="submit">Подписаться</button>
                        </form>
                    </div>
                </div>
            </div>

            <div class="footer-col">
                <h3>Быстрые ссылки</h3>
                <ul>
                    <li><a href="../../../ru/financial-support/">Пожертвовать</a></li>
                    <li><a href="../../../ru/docs/overview/intro/">Введение в I2P</a></li>
                </ul>
            </div>

            <div class="footer-col">
                <h3>Сообщество</h3>
                <ul>
                    <li><a href="../../../ru/get-involved/">Присоединяйтесь</a></li>
                    <li><a href="../../../ru/blog/">Блог</a></li>
                    <li><a href="http://i2pforum.net/" target="_blank" rel="noopener">Официальные форумы</a></li>
                    <li><a href="../../../ru/contact/">Контакты</a></li>
                </ul>
            </div>

            <div class="footer-col">
                <h3>Ресурсы</h3>
                <ul>
                    <li><a href="https://i2p-metrics.np-tokumei.net/" target="_blank" rel="noopener">I2P Метрики</a></li>
                    <li><a href="../../../ru/papers/">Исследование</a></li>
                    <li><a href="https://i2pgit.org/" target="_blank" rel="noopener">GitLab</a></li>
                    <li><a href="https://www.stormycloud.org/" target="_blank" rel="noopener">StormyCloud</a></li>
                </ul>
            </div>
        </div>

        <div class="footer-bottom">
            <p class="copyright">&copy; 2025 Проект Невидимый Интернет. Лицензировано под Creative Commons.</p>
            <div class="footer-links">
                <a href="../../../ru/privacy/">Конфиденциальность</a>
                <a href="../../../ru/terms/">Условия</a>
                <a href="../../../ru/about/media/">Пресса</a>
            </div>
        </div>
    </div>
</footer>


    
    
<div class="modal-overlay" id="poll">
    <div class="modal-content poll-modal-content">
        <a href="#" class="modal-close" aria-label="Закрыть">
            <span aria-hidden="true">&times;</span>
        </a>

        <div class="modal-header">
            <h2>Опрос сообщества</h2>
            <p class="modal-subtitle">Мы хотели бы услышать ваше мнение</p>
        </div>

        <div class="modal-body">
            
            <iframe 
                id="poll-iframe"
                data-poll-id="2"
                data-api-url="https://feedback.i2p.net"
                frameborder="0"
                scrolling="no"
                style="width: 100%; border: none; min-height: 400px;">
            </iframe>
        </div>

        <div class="modal-footer">
            <p class="modal-disclaimer">
                Ваш голос помогает формировать будущее I2P.
            </p>
        </div>
    </div>
</div>


<script>
(function() {
    const iframe = document.getElementById('poll-iframe');
    if (!iframe) return;
    
    const hostname = window.location.hostname;
    let apiUrl = 'https://feedback.i2p.net';
    const pollId = iframe.getAttribute('data-poll-id') || '1';

    
    if (hostname.endsWith('.b32.i2p') || hostname.endsWith('.i2p')) {
        apiUrl = 'http://5kwyynf3eetgqa2nors6ctwo7doi7yu73k7uvypy5eqmm326zkiq.b32.i2p';
    }
    
    else if (hostname.endsWith('.onion')) {
        apiUrl = 'http://gfonxmohvarpmocsvllscsuszdu5rikipm6innvcwq4vpng7zzqmmfyd.onion';
    }

    
    const pollUrl = apiUrl + '/widgets/poll.html?poll_id=' + encodeURIComponent(pollId) + '&api_url=' + encodeURIComponent(apiUrl);
    iframe.src = pollUrl;
})();
</script>



    
    



    
    <script>
        (function () {
            'use strict';
            var hostname = window.location.hostname;
            var baseUrl;

            
            if (hostname.endsWith('.b32.i2p') || hostname.endsWith('.i2p')) {
                baseUrl = 'http://5kwyynf3eetgqa2nors6ctwo7doi7yu73k7uvypy5eqmm326zkiq.b32.i2p';
            } else if (hostname.endsWith('.onion')) {
                baseUrl = 'http://gfonxmohvarpmocsvllscsuszdu5rikipm6innvcwq4vpng7zzqmmfyd.onion';
            } else {
                baseUrl = 'https://feedback.i2p.net';
            }

            window.feedbackBaseUrl = baseUrl;

            
            document.querySelectorAll('[data-api-url]').forEach(function (widget) {
                widget.setAttribute('data-api-url', baseUrl);
            });

            
            document.write('<link rel="stylesheet" href="' + baseUrl + '/widgets/styles.css">');
            
        })();
    </script>

    

    
    
    

    

</body>

</html>
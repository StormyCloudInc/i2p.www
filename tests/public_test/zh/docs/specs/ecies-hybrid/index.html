<!DOCTYPE html>
<html lang="zh" data-theme="light">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <title>ECIES-X25519-AEAD-Ratchet 混合加密 | I2P - 隐形互联网项目</title>

    <meta name="description" content="采用 ML-KEM（基于格的密钥封装机制）的 ECIES 加密协议的后量子混合变体">
    <meta name="keywords" content="i2p, privacy, anonymity, dark net, encryption, security">

    
    <meta property="og:title" content="ECIES-X25519-AEAD-Ratchet 混合加密 | I2P - 隐形互联网项目">
    <meta property="og:description" content="采用 ML-KEM（基于格的密钥封装机制）的 ECIES 加密协议的后量子混合变体">
    <meta property="og:type" content="website">
    <meta property="og:url" content="/zh/docs/specs/ecies-hybrid/">

    
    <link rel="icon" type="image/svg+xml" href="../../../../images/favicon.svg">
    <link rel="icon" type="image/png" href="../../../../images/i2plogo.png" sizes="32x32">

    
    
    
    
    <link rel="stylesheet" href="../../../../css/main.min.be6880f32f5ff44e57579da7b11513b973319944ebe38748e3ac7f3268662d18.css" integrity="sha256-vmiA8y9f9E5XV52nsRUTuXMxmUTr44dI46x/MmhmLRg=">
    


    
</head>

<body>
    
    <input type="checkbox" id="theme-toggle-checkbox" class="theme-checkbox" aria-hidden="true">

    
<div class="site-banner" id="site-banner" data-banner-id="banner-3" role="alert" aria-live="polite">
    <div class="container">
        <div class="banner-content">
            <span class="banner-message">I2P 测试版网站现已上线 电子邮件问题请发送至 stormycloud@mail.i2p</span>
            
        </div>
        
        <form method="GET" action="../../../../api/banner/dismiss" style="display: inline;">
            <input type="hidden" name="id" value="banner-3">
            <button type="submit" class="banner-close" aria-label="关闭横幅" title="关闭横幅">
                <span aria-hidden="true">&times;</span>
            </button>
        </form>
        
    </div>
</div>


    <header class="site-header">
    <div class="container">
        <nav class="main-nav">
            <div class="nav-brand">
                <a href="../../../../zh/" class="logo-link">
                    <img src="../../../../images/i2plogo_lightmode.svg" alt="I2P Logo" class="logo logo-light">
                    <img src="../../../../images/i2plogo_darkmode.svg" alt="I2P Logo" class="logo logo-dark">
                </a>
            </div>

            
            <input type="checkbox" id="mobile-menu-checkbox" class="mobile-menu-checkbox"
                aria-label="Toggle navigation menu">
            <label for="mobile-menu-checkbox" class="mobile-menu-toggle" aria-label="Toggle navigation menu">
                <span class="hamburger"></span>
            </label>

            <div class="nav-menu">
                <ul class="nav-links">
                    <li class="nav-dropdown">
                        <a href="../../../../zh/about/" class="">关于</a>
                        <ul class="dropdown-menu">
                            <li><a href="../../../../zh/about/">概览</a></li>
                            <li><a href="../../../../zh/papers/">研究论文</a></li>
                            <li><a href="../../../../zh/about/media/">媒体</a></li>
                            <li><a href="../../../../zh/contact/">联系我们</a></li>
                        </ul>
                    </li>
                    <li><a href="../../../../zh/docs/" class="active">文档</a></li>
                    <li><a href="../../../../zh/downloads/" class="">下载</a></li>
                    <li><a href="../../../../zh/blog/" class="">博客</a></li>
                    <li class="nav-dropdown">
                        <a href="../../../../zh/get-involved/" class="">参与其中</a>
                        <ul class="dropdown-menu">
                            <li><a href="../../../../zh/get-involved/">概览</a></li>
                            <li><a href="../../../../zh/feedback/">功能建议</a></li>
                        </ul>
                    </li>
                </ul>

                <div class="nav-actions">
                    
                    <div class="language-selector">
                        <button class="language-toggle" aria-label="Select language" title="Language">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none"
                                xmlns="http://www.w3.org/2000/svg">
                                <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2" />
                                <path
                                    d="M2 12h20M12 2a15.3 15.3 0 014 10 15.3 15.3 0 01-4 10 15.3 15.3 0 01-4-10 15.3 15.3 0 014-10z"
                                    stroke="currentColor" stroke-width="2" />
                            </svg>
                            <span class="current-lang">zh</span>
                        </button>
                        <div class="language-dropdown">
                            
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../../en/docs/specs/ecies-x25519-aead-ratchet-hybrid-encryption/"
                                class="lang-option">英语</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../../es/docs/specs/ecies-hybrid/"
                                class="lang-option">西班牙语</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../../ko/docs/specs/ecies-hybrid/"
                                class="lang-option">韩语</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../../zh/docs/specs/ecies-hybrid/"
                                class="lang-option active">中文</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../../ru/docs/specs/ecies-hybrid/"
                                class="lang-option">俄语</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../../cs/docs/specs/ecies-hybrid/"
                                class="lang-option">捷克语</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../../de/docs/specs/ecies-hybrid/"
                                class="lang-option">德语</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../../fr/docs/specs/ecies-hybrid/"
                                class="lang-option">法语</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../../tr/docs/specs/ecies-hybrid/"
                                class="lang-option">土耳其语</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../../vi/docs/specs/ecies-hybrid/"
                                class="lang-option">越南语</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../../hi/docs/specs/ecies-hybrid/"
                                class="lang-option">印地语</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../../ar/docs/specs/ecies-hybrid/"
                                class="lang-option">阿拉伯语</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../../pt/docs/specs/ecies-hybrid/"
                                class="lang-option">葡萄牙语</a>
                            
                            
                        </div>
                    </div>

                    
                    <label for="theme-toggle-checkbox" class="theme-toggle" aria-label="Toggle dark mode"
                        title="Toggle theme">
                        <svg class="sun-icon" width="20" height="20" viewBox="0 0 20 20" fill="none"
                            xmlns="http://www.w3.org/2000/svg">
                            <circle cx="10" cy="10" r="4" stroke="currentColor" stroke-width="2" />
                            <path
                                d="M10 2V4M10 16V18M18 10H16M4 10H2M15.657 4.343L14.243 5.757M5.757 14.243L4.343 15.657M15.657 15.657L14.243 14.243M5.757 5.757L4.343 4.343"
                                stroke="currentColor" stroke-width="2" stroke-linecap="round" />
                        </svg>
                        <svg class="moon-icon" width="20" height="20" viewBox="0 0 20 20" fill="none"
                            xmlns="http://www.w3.org/2000/svg">
                            <path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"
                                stroke="currentColor" stroke-width="2" stroke-linejoin="round" />
                        </svg>
                    </label>

                    
                    <a href="../../../../zh/financial-support/" class="btn btn-primary" id="donate-btn">Donate</a>

                    
                    <a href="../../../../zh/downloads/" class="btn btn-primary">获取I2P</a>
                </div>
            </div>
        </nav>
    </div>
</header>

    <main id="main-content">
        




<div class="docs-page">
    <div class="container">
        
        <div class="docs-layout docs-layout--with-toc">
            
            
            <aside class="docs-toc-sidebar">
                <nav class="toc-nav">
                    <div class="toc-header">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                            <path d="M4 6h16M4 12h16M4 18h16" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                        </svg>
                        On This Page
                    </div>
                    <div class="toc-content">
                        <nav id="TableOfContents">
  <ul>
    <li><a href="#实现状态">实现状态</a></li>
    <li><a href="#概述">概述</a></li>
    <li><a href="#设计">设计</a>
      <ul>
        <li><a href="#密钥交换">密钥交换</a></li>
        <li><a href="#需要新的加密技术">需要新的加密技术</a></li>
      </ul>
    </li>
    <li><a href="#规范">规范</a>
      <ul>
        <li><a href="#通用结构">通用结构</a></li>
        <li><a href="#握手模式">握手模式</a></li>
        <li><a href="#定义的-ml-kem基于模块格的密钥封装机制操作">定义的 ML-KEM（基于模块格的密钥封装机制）操作</a></li>
        <li><a href="#noise-握手的密钥派生函数">Noise 握手的密钥派生函数</a></li>
        <li><a href="#消息格式">消息格式</a></li>
      </ul>
    </li>
    <li><a href="#开销分析">开销分析</a>
      <ul>
        <li><a href="#密钥交换-1">密钥交换</a></li>
        <li><a href="#带宽注意事项">带宽注意事项</a></li>
      </ul>
    </li>
    <li><a href="#安全分析">安全分析</a>
      <ul>
        <li><a href="#握手">握手</a></li>
        <li><a href="#安全级别">安全级别</a></li>
        <li><a href="#前向保密">前向保密</a></li>
      </ul>
    </li>
    <li><a href="#类型首选项">类型首选项</a></li>
    <li><a href="#实现说明">实现说明</a>
      <ul>
        <li><a href="#库支持">库支持</a></li>
        <li><a href="#迁移策略">迁移策略</a></li>
        <li><a href="#共享-tunnels">共享 Tunnels</a></li>
        <li><a href="#新会话大小注意事项">新会话大小注意事项</a></li>
        <li><a href="#测试与验证">测试与验证</a></li>
      </ul>
    </li>
    <li><a href="#版本兼容性">版本兼容性</a></li>
  </ul>
</nav>
                    </div>
                </nav>
            </aside>
            

            
            <div class="docs-main">
                
                <nav class="breadcrumbs">
                    <a href="../../../../zh/">Home</a>
                    <span class="separator">/</span>
                    <a href="../../../../zh/docs/">Docs</a>
                    
                        
                            <span class="separator">/</span>
                            <a href="../../../../zh/docs/specs/">Specifications</a>
                        
                    
                    <span class="separator">/</span>
                    <span class="current">ECIES-X25519-AEAD-Ratchet 混合加密</span>
                </nav>

                
<div class="translation-disclaimer" role="note">
    <span class="disclaimer-message">此翻译是使用机器学习生成的，可能不是100%准确。</span>
    
    
    <a href="../../../../en/docs/specs/ecies-x25519-aead-ratchet-hybrid-encryption/" class="disclaimer-link">查看英文版本</a>
    
</div>



                
                <header class="article-header">
                    <h1 class="article-title">ECIES-X25519-AEAD-Ratchet 混合加密</h1>
                    
                        <p class="article-description">采用 ML-KEM（基于格的密钥封装机制）的 ECIES 加密协议的后量子混合变体</p>
                    
                    <div class="article-meta">
                        
                            <span class="meta-item">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                                    <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2"/>
                                    <path d="M12 6v6l4 2" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                                </svg>
                                Updated: 2025-10
                            </span>
                        
                        
                            <span class="meta-item">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                                    <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" stroke="currentColor" stroke-width="2"/>
                                </svg>
                                Accurate for: 2.10.0
                            </span>
                        
                    </div>
                </header>

                
                <article class="article-content">
                    <h2 id="实现状态">实现状态</h2>
<p><strong>当前部署:</strong> - <strong>i2pd (C++ 实现)</strong>: 已在版本 2.58.0 (2025 年 9 月) 中完整实现，并支持 ML-KEM-512、ML-KEM-768 和 ML-KEM-1024。当可用 OpenSSL 3.5.0 或更高版本时，默认启用后量子端到端加密。 - <strong>Java I2P</strong>: 截至版本 0.9.67 / 2.10.0 (2025 年 9 月) 尚未实现。规范已获批准，计划在未来版本中实现。</p>
<p>本规范描述了已获批准的功能，这些功能目前已在 i2pd 部署，并计划在 Java I2P 实现中采用。</p>
<h2 id="概述">概述</h2>
<p>这是 ECIES-X25519-AEAD-Ratchet 协议 <a href="../../../../zh/docs/specs/ecies/">ECIES</a>
 的后量子混合变体。它是有待批准的提案 169 <a href="../../../../zh/proposals/169-pq-crypto/">Prop169</a>
 的第一阶段。有关总体目标、威胁模型、分析、替代方案及更多信息，请参阅该提案。</p>
<p>提案 169 状态：<strong>开放</strong> (混合 ECIES（椭圆曲线集成加密方案）实现的第一阶段已获批准).</p>
<p>本规范仅包含相对于标准 <a href="../../../../zh/docs/specs/ecies/">ECIES</a>
（椭圆曲线集成加密方案）的差异，必须与该规范一并阅读。</p>
<h2 id="设计">设计</h2>
<p>我们使用 NIST FIPS 203 标准 <a href="https://csrc.nist.gov/pubs/fips/203/final">FIPS203</a>
，该标准以 CRYSTALS-Kyber 为基础，但与其不兼容（版本 3.1、3 以及更早版本）。</p>
<p>混合握手将经典的 X25519 Diffie-Hellman 与后量子 ML-KEM 密钥封装机制（NIST 后量子密钥封装标准，原名 Kyber）相结合。这种方法基于 PQNoise（关于混合前向保密的研究）中记录的混合前向保密概念，以及在 TLS 1.3、IKEv2 和 WireGuard 中的类似实现。</p>
<h3 id="密钥交换">密钥交换</h3>
<p>我们为 Ratchet（棘轮机制）定义了一种混合密钥交换。后量子 KEM（密钥封装机制）仅提供临时密钥，并不直接支持诸如 Noise IK 之类的静态密钥握手。</p>
<p>我们按照 <a href="https://csrc.nist.gov/pubs/fips/203/final">FIPS203</a>
 的规定定义三种 ML-KEM（基于模块格的密钥封装机制）变体，共计新增 3 种加密类型。混合类型仅在与 X25519（椭圆曲线 Diffie–Hellman 密钥交换算法的一种实现）组合时定义。</p>
<p>新的加密类型为：</p>
<table style="width:100%; border-collapse:collapse; margin-bottom:1.5rem;">
  <thead>
    <tr>
      <th style="border:1px solid var(--color-border); padding:0.6rem; text-align:left; background:var(--color-bg-secondary);">Type</th>
      <th style="border:1px solid var(--color-border); padding:0.6rem; text-align:left; background:var(--color-bg-secondary);">Code</th>
      <th style="border:1px solid var(--color-border); padding:0.6rem; text-align:left; background:var(--color-bg-secondary);">Security Level</th>
      <th style="border:1px solid var(--color-border); padding:0.6rem; text-align:left; background:var(--color-bg-secondary);">ML-KEM Variant</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="border:1px solid var(--color-border); padding:0.6rem;">MLKEM512_X25519</td>
      <td style="border:1px solid var(--color-border); padding:0.6rem;">5</td>
      <td style="border:1px solid var(--color-border); padding:0.6rem;">NIST Category 1 (AES-128 equivalent)</td>
      <td style="border:1px solid var(--color-border); padding:0.6rem;">ML-KEM-512</td>
    </tr>
    <tr>
      <td style="border:1px solid var(--color-border); padding:0.6rem;">MLKEM768_X25519</td>
      <td style="border:1px solid var(--color-border); padding:0.6rem;">6</td>
      <td style="border:1px solid var(--color-border); padding:0.6rem;">NIST Category 3 (AES-192 equivalent)</td>
      <td style="border:1px solid var(--color-border); padding:0.6rem;">ML-KEM-768 (Recommended)</td>
    </tr>
    <tr>
      <td style="border:1px solid var(--color-border); padding:0.6rem;">MLKEM1024_X25519</td>
      <td style="border:1px solid var(--color-border); padding:0.6rem;">7</td>
      <td style="border:1px solid var(--color-border); padding:0.6rem;">NIST Category 5 (AES-256 equivalent)</td>
      <td style="border:1px solid var(--color-border); padding:0.6rem;">ML-KEM-1024</td>
    </tr>
  </tbody>
</table>
**注意：** MLKEM768_X25519（Type 6）是推荐的默认变体，在合理开销下提供强大的后量子安全性。
<p>与仅使用 X25519 的加密相比，额外开销相当可观。针对 IK 模式，消息 1 和 2 的典型大小目前约为 96-103 字节（不含额外负载）。根据消息类型不同，这一数值在 MLKEM512 情况下将增加约 9-12 倍，在 MLKEM768 情况下增加约 13-16 倍，在 MLKEM1024 情况下增加约 17-23 倍。</p>
<h3 id="需要新的加密技术">需要新的加密技术</h3>
<ul>
<li><strong>ML-KEM</strong>（原名 CRYSTALS-Kyber）<a href="https://csrc.nist.gov/pubs/fips/203/final">FIPS203</a>
 - 基于模格的密钥封装机制标准</li>
<li><strong>SHA3-256</strong>（原名 Keccak-512）<a href="https://csrc.nist.gov/pubs/fips/202/final">FIPS202</a>
 - SHA-3 标准的一部分</li>
<li><strong>SHAKE128 和 SHAKE256</strong>（SHA3 的 XOF（可扩展输出函数）扩展）<a href="https://csrc.nist.gov/pubs/fips/202/final">FIPS202</a>
 - 可扩展输出函数</li>
</ul>
<p>SHA3-256、SHAKE128 和 SHAKE256 的测试向量可在 <a href="https://csrc.nist.gov/Projects/cryptographic-algorithm-validation-program">NIST 加密算法验证计划</a>
 中获取。</p>
<p><strong>库支持:</strong> - Java: Bouncycastle 库 1.79 及以上版本支持所有 ML-KEM（模块格密钥封装机制）变体以及 SHA3/SHAKE 函数 - C++: OpenSSL 3.5 及以上版本包含对 ML-KEM 的完整支持（于 2025 年 4 月发布） - Go: 有多种库可用于 ML-KEM 和 SHA3 的实现</p>
<h2 id="规范">规范</h2>
<h3 id="通用结构">通用结构</h3>
<p>有关密钥长度和标识符，请参阅<a href="../../../../zh/docs/specs/common-structures/">通用结构规范</a>
。</p>
<h3 id="握手模式">握手模式</h3>
<p>握手使用 <a href="https://noiseprotocol.org/noise.html">Noise Protocol Framework</a>
（Noise 协议框架）的握手模式，并结合针对 I2P 的特定改动，以实现混合式后量子安全性。</p>
<p>使用以下字母映射：</p>
<ul>
<li><strong>e</strong> = 一次性临时密钥（X25519）</li>
<li><strong>s</strong> = 静态密钥</li>
<li><strong>p</strong> = 消息负载</li>
<li><strong>e1</strong> = 一次性临时 PQ（后量子）密钥，从 Alice 发送给 Bob（I2P 特定的令牌）</li>
<li><strong>ekem1</strong> = KEM（密钥封装机制）密文，从 Bob 发送给 Alice（I2P 特定的令牌）</li>
</ul>
<p><strong>重要说明：</strong> 模式名称 &ldquo;IKhfs&rdquo; 和 &ldquo;IKhfselg2&rdquo; 以及标记 &ldquo;e1&rdquo; 和 &ldquo;ekem1&rdquo; 是 I2P 特定的适配，未记录于官方 Noise 协议框架规范中。这些表示为将 ML-KEM（模块格密钥封装机制）集成到 Noise IK 模式而做的自定义定义。尽管混合的 X25519 + ML-KEM 方案在后量子密码学研究和其他协议中广为认可，但此处使用的特定命名法是 I2P 特有的。</p>
<p>将以下修改应用于 IK，以实现混合前向保密：</p>
<pre tabindex="0"><code>Standard IK:              I2P IKhfs (Hybrid):
&lt;- s                      &lt;- s
...                       ...
-&gt; e, es, s, ss, p        -&gt; e, es, e1, s, ss, p
&lt;- e, ee, se, p           &lt;- e, ee, ekem1, se, p
&lt;- p                      &lt;- p
p -&gt;                      p -&gt;

Note: e1 and ekem1 are encrypted within ChaCha20-Poly1305 AEAD blocks.
Note: e1 (ML-KEM public key) and ekem1 (ML-KEM ciphertext) have different sizes.
</code></pre><p><strong>e1</strong> 模式定义如下：</p>
<pre tabindex="0"><code>For Alice (sender):
(encap_key, decap_key) = PQ_KEYGEN()

// EncryptAndHash(encap_key)
ciphertext = ENCRYPT(k, n, encap_key, ad)
n++
MixHash(ciphertext)

For Bob (receiver):
// DecryptAndHash(ciphertext)
encap_key = DECRYPT(k, n, ciphertext, ad)
n++
MixHash(ciphertext)
</code></pre><p><strong>ekem1</strong> 模式定义如下：</p>
<pre tabindex="0"><code>For Bob (receiver of encap_key):
(kem_ciphertext, kem_shared_key) = ENCAPS(encap_key)

// EncryptAndHash(kem_ciphertext)
ciphertext = ENCRYPT(k, n, kem_ciphertext, ad)
MixHash(ciphertext)

// MixKey
MixKey(kem_shared_key)

For Alice (sender of encap_key):
// DecryptAndHash(ciphertext)
kem_ciphertext = DECRYPT(k, n, ciphertext, ad)
MixHash(ciphertext)

// MixKey
kem_shared_key = DECAPS(kem_ciphertext, decap_key)
MixKey(kem_shared_key)
</code></pre><h3 id="定义的-ml-kem基于模块格的密钥封装机制操作">定义的 ML-KEM（基于模块格的密钥封装机制）操作</h3>
<p>我们定义以下函数，它们对应于 <a href="https://csrc.nist.gov/pubs/fips/203/final">FIPS203</a>
 所规定的密码学构建模块。</p>
<p><strong>(encap_key, decap_key) = PQ_KEYGEN()</strong> : Alice 生成封装密钥和解封装密钥。封装密钥在 NS 消息中发送。密钥大小：   - ML-KEM-512: encap_key = 800 字节, decap_key = 1632 字节   - ML-KEM-768: encap_key = 1184 字节, decap_key = 2400 字节   - ML-KEM-1024: encap_key = 1568 字节, decap_key = 3168 字节</p>
<p><strong>(ciphertext, kem_shared_key) = ENCAPS(encap_key)</strong> : Bob 使用在 NS 消息中收到的封装密钥计算密文和共享密钥。密文在 NSR 消息中发送。密文大小:   - ML-KEM-512: 768 字节   - ML-KEM-768: 1088 字节   - ML-KEM-1024: 1568 字节</p>
<p>kem_shared_key 在所有三种变体中始终为 <strong>32 字节</strong>。</p>
<p><strong>kem_shared_key = DECAPS(ciphertext, decap_key)</strong> : Alice 使用在 NSR 消息中收到的密文计算共享密钥。kem_shared_key 始终为 <strong>32 字节</strong>。</p>
<p><strong>重要：</strong> encap_key 和 ciphertext 都在 Noise（加密握手协议框架）的握手消息 1 和 2 中的 ChaCha20-Poly1305 块内被加密。它们会作为握手过程的一部分被解密。</p>
<p>使用 MixKey() 将 kem_shared_key 混入链密钥。详见下文。</p>
<h3 id="noise-握手的密钥派生函数">Noise 握手的密钥派生函数</h3>
<h4 id="概述-1">概述</h4>
<p>混合握手将经典的 X25519 ECDH（椭圆曲线 Diffie-Hellman）与后量子 ML-KEM（密钥封装机制）相结合。第一条消息（从 Alice 发往 Bob）在消息载荷之前包含 e1（ML-KEM 封装密钥）。将其视为额外的密钥材料；对其调用 EncryptAndHash()（作为 Alice）或 DecryptAndHash()（作为 Bob）。然后按常规处理消息载荷。</p>
<p>第二条消息（从 Bob 发往 Alice）在消息负载之前包含 ekem1（ML-KEM 密文）。将其视为额外的密钥材料；对其调用 EncryptAndHash()（作为 Bob）或 DecryptAndHash()（作为 Alice）。随后计算 kem_shared_key，并调用 MixKey(kem_shared_key)。然后照常处理消息负载。</p>
<h4 id="noise-标识符">Noise 标识符</h4>
<p>这些是 Noise（加密握手协议框架）初始化字符串（I2P 专用）：</p>
<ul>
<li><code>Noise_IKhfselg2_25519+MLKEM512_ChaChaPoly_SHA256</code></li>
<li><code>Noise_IKhfselg2_25519+MLKEM768_ChaChaPoly_SHA256</code></li>
<li><code>Noise_IKhfselg2_25519+MLKEM1024_ChaChaPoly_SHA256</code></li>
</ul>
<h4 id="用于-ns-消息的-alice-端-kdf密钥派生函数">用于 NS 消息的 Alice 端 KDF（密钥派生函数）</h4>
<p>在 &rsquo;es&rsquo; 消息模式之后、&rsquo;s&rsquo; 消息模式之前，添加：</p>
<pre tabindex="0"><code>This is the &#34;e1&#34; message pattern:
(encap_key, decap_key) = PQ_KEYGEN()

// EncryptAndHash(encap_key)
// AEAD parameters
k = keydata[32:63]
n = 0
ad = h
ciphertext = ENCRYPT(k, n, encap_key, ad)
n++

// MixHash(ciphertext)
h = SHA256(h || ciphertext)

End of &#34;e1&#34; message pattern.

NOTE: For the next section (payload for XK or static key for IK),
the keydata and chain key remain the same,
and n now equals 1 (instead of 0 for non-hybrid).
</code></pre><h4 id="bob-端-ns-消息的密钥派生函数">Bob 端 NS 消息的密钥派生函数</h4>
<p>在 &rsquo;es&rsquo; 消息模式之后，并在 &rsquo;s&rsquo; 消息模式之前，添加：</p>
<pre tabindex="0"><code>This is the &#34;e1&#34; message pattern:

// DecryptAndHash(encap_key_section)
// AEAD parameters
k = keydata[32:63]
n = 0
ad = h
encap_key = DECRYPT(k, n, encap_key_section, ad)
n++

// MixHash(encap_key_section)
h = SHA256(h || encap_key_section)

End of &#34;e1&#34; message pattern.

NOTE: For the next section (payload for XK or static key for IK),
the keydata and chain key remain the same,
and n now equals 1 (instead of 0 for non-hybrid).
</code></pre><h4 id="用于-nsr-消息的-bob-侧-kdf密钥派生函数">用于 NSR 消息的 Bob 侧 KDF（密钥派生函数）</h4>
<p>在 &rsquo;ee&rsquo; 消息模式之后、&lsquo;se&rsquo; 消息模式之前，添加：</p>
<pre tabindex="0"><code>This is the &#34;ekem1&#34; message pattern:

(kem_ciphertext, kem_shared_key) = ENCAPS(encap_key)

// EncryptAndHash(kem_ciphertext)
// AEAD parameters
k = keydata[32:63]
n = 0
ad = h
ciphertext = ENCRYPT(k, n, kem_ciphertext, ad)

// MixHash(ciphertext)
h = SHA256(h || ciphertext)

// MixKey(kem_shared_key)
keydata = HKDF(chainKey, kem_shared_key, &#34;&#34;, 64)
chainKey = keydata[0:31]

End of &#34;ekem1&#34; message pattern.
</code></pre><h4 id="用于-nsr-消息的-alice-kdf密钥派生函数">用于 NSR 消息的 Alice KDF（密钥派生函数）</h4>
<p>在 &rsquo;ee&rsquo; 消息模式之后且在 &lsquo;ss&rsquo; 消息模式之前，添加：</p>
<pre tabindex="0"><code>This is the &#34;ekem1&#34; message pattern:

// DecryptAndHash(kem_ciphertext_section)
// AEAD parameters
k = keydata[32:63]
n = 0
ad = h
kem_ciphertext = DECRYPT(k, n, kem_ciphertext_section, ad)

// MixHash(kem_ciphertext_section)
h = SHA256(h || kem_ciphertext_section)

// MixKey(kem_shared_key)
kem_shared_key = DECAPS(kem_ciphertext, decap_key)
keydata = HKDF(chainKey, kem_shared_key, &#34;&#34;, 64)
chainKey = keydata[0:31]

End of &#34;ekem1&#34; message pattern.
</code></pre><h4 id="用于-split-的密钥派生函数">用于 split() 的密钥派生函数</h4>
<p>split() 函数保持与标准 ECIES（椭圆曲线集成加密方案）规范一致，未作改动。握手完成后：</p>
<pre tabindex="0"><code>keydata = HKDF(chainKey, ZEROLEN, &#34;&#34;, 64)
k_ab = keydata[0:31]
k_ba = keydata[32:63]
</code></pre><p>这些是用于持续通信的双向会话密钥。</p>
<h3 id="消息格式">消息格式</h3>
<h4 id="ns-new-session新会话-格式">NS (New Session，新会话) 格式</h4>
<p><strong>Changes:</strong> 当前的棘轮在第一个 ChaCha20-Poly1305 部分中包含静态密钥，在第二个部分中包含有效载荷。随着 ML-KEM 的引入，现在有三个部分。第一部分包含加密的 ML-KEM 公钥（encap_key）。第二部分包含静态密钥。第三部分包含有效载荷。</p>
<p><strong>消息大小：</strong></p>
<table style="width:100%; border-collapse:collapse; margin-bottom:1.5rem;">
  <thead>
    <tr>
      <th style="border:1px solid var(--color-border); padding:0.6rem; text-align:left; background:var(--color-bg-secondary);">Type</th>
      <th style="border:1px solid var(--color-border); padding:0.6rem; text-align:left; background:var(--color-bg-secondary);">Type Code</th>
      <th style="border:1px solid var(--color-border); padding:0.6rem; text-align:left; background:var(--color-bg-secondary);">X25519 len</th>
      <th style="border:1px solid var(--color-border); padding:0.6rem; text-align:left; background:var(--color-bg-secondary);">NS len</th>
      <th style="border:1px solid var(--color-border); padding:0.6rem; text-align:left; background:var(--color-bg-secondary);">NS Enc len</th>
      <th style="border:1px solid var(--color-border); padding:0.6rem; text-align:left; background:var(--color-bg-secondary);">NS Dec len</th>
      <th style="border:1px solid var(--color-border); padding:0.6rem; text-align:left; background:var(--color-bg-secondary);">PQ key len</th>
      <th style="border:1px solid var(--color-border); padding:0.6rem; text-align:left; background:var(--color-bg-secondary);">pl len</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="border:1px solid var(--color-border); padding:0.6rem;">X25519</td>
      <td style="border:1px solid var(--color-border); padding:0.6rem;">4</td>
      <td style="border:1px solid var(--color-border); padding:0.6rem;">32</td>
      <td style="border:1px solid var(--color-border); padding:0.6rem;">96+pl</td>
      <td style="border:1px solid var(--color-border); padding:0.6rem;">64+pl</td>
      <td style="border:1px solid var(--color-border); padding:0.6rem;">pl</td>
      <td style="border:1px solid var(--color-border); padding:0.6rem;">--</td>
      <td style="border:1px solid var(--color-border); padding:0.6rem;">pl</td>
    </tr>
    <tr>
      <td style="border:1px solid var(--color-border); padding:0.6rem;">MLKEM512_X25519</td>
      <td style="border:1px solid var(--color-border); padding:0.6rem;">5</td>
      <td style="border:1px solid var(--color-border); padding:0.6rem;">32</td>
      <td style="border:1px solid var(--color-border); padding:0.6rem;">912+pl</td>
      <td style="border:1px solid var(--color-border); padding:0.6rem;">880+pl</td>
      <td style="border:1px solid var(--color-border); padding:0.6rem;">800+pl</td>
      <td style="border:1px solid var(--color-border); padding:0.6rem;">800</td>
      <td style="border:1px solid var(--color-border); padding:0.6rem;">pl</td>
    </tr>
    <tr>
      <td style="border:1px solid var(--color-border); padding:0.6rem;">MLKEM768_X25519</td>
      <td style="border:1px solid var(--color-border); padding:0.6rem;">6</td>
      <td style="border:1px solid var(--color-border); padding:0.6rem;">32</td>
      <td style="border:1px solid var(--color-border); padding:0.6rem;">1296+pl</td>
      <td style="border:1px solid var(--color-border); padding:0.6rem;">1264+pl</td>
      <td style="border:1px solid var(--color-border); padding:0.6rem;">1184+pl</td>
      <td style="border:1px solid var(--color-border); padding:0.6rem;">1184</td>
      <td style="border:1px solid var(--color-border); padding:0.6rem;">pl</td>
    </tr>
    <tr>
      <td style="border:1px solid var(--color-border); padding:0.6rem;">MLKEM1024_X25519</td>
      <td style="border:1px solid var(--color-border); padding:0.6rem;">7</td>
      <td style="border:1px solid var(--color-border); padding:0.6rem;">32</td>
      <td style="border:1px solid var(--color-border); padding:0.6rem;">1680+pl</td>
      <td style="border:1px solid var(--color-border); padding:0.6rem;">1648+pl</td>
      <td style="border:1px solid var(--color-border); padding:0.6rem;">1568+pl</td>
      <td style="border:1px solid var(--color-border); padding:0.6rem;">1568</td>
      <td style="border:1px solid var(--color-border); padding:0.6rem;">pl</td>
    </tr>
  </tbody>
</table>
**注意：** 负载必须包含一个 DateTime 块（日期时间块）（最少 7 字节：1 字节类型、2 字节大小、4 字节时间戳）。因此，可以相应地计算出 NS 的最小大小。由此，X25519 的可用最小 NS 大小为 103 字节，而混合变体范围为 919 到 1687 字节。
<p>对于三个 ML-KEM 变体，大小分别增加 816、1200 和 1584 字节，这些增加量由 ML-KEM 公钥以及用于认证加密的 16 字节 Poly1305 消息认证码（MAC）共同构成。</p>
<h4 id="nsrnew-session-reply新会话应答格式">NSR（New Session Reply，新会话应答）格式</h4>
<p><strong>变更：</strong> 当前的 ratchet（密钥棘轮）在第一个 ChaCha20-Poly1305 部分的负载为空，负载位于第二个部分。引入 ML-KEM 后，现在有三个部分。第一部分包含加密的 ML-KEM 密文。第二部分的负载为空。第三部分包含负载。</p>
<p><strong>消息大小：</strong></p>
<table style="width:100%; border-collapse:collapse; margin-bottom:1.5rem;">
  <thead>
    <tr>
      <th style="border:1px solid var(--color-border); padding:0.6rem; text-align:left; background:var(--color-bg-secondary);">Type</th>
      <th style="border:1px solid var(--color-border); padding:0.6rem; text-align:left; background:var(--color-bg-secondary);">Type Code</th>
      <th style="border:1px solid var(--color-border); padding:0.6rem; text-align:left; background:var(--color-bg-secondary);">X25519 len</th>
      <th style="border:1px solid var(--color-border); padding:0.6rem; text-align:left; background:var(--color-bg-secondary);">NSR len</th>
      <th style="border:1px solid var(--color-border); padding:0.6rem; text-align:left; background:var(--color-bg-secondary);">NSR Enc len</th>
      <th style="border:1px solid var(--color-border); padding:0.6rem; text-align:left; background:var(--color-bg-secondary);">NSR Dec len</th>
      <th style="border:1px solid var(--color-border); padding:0.6rem; text-align:left; background:var(--color-bg-secondary);">PQ ct len</th>
      <th style="border:1px solid var(--color-border); padding:0.6rem; text-align:left; background:var(--color-bg-secondary);">pl len</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="border:1px solid var(--color-border); padding:0.6rem;">X25519</td>
      <td style="border:1px solid var(--color-border); padding:0.6rem;">4</td>
      <td style="border:1px solid var(--color-border); padding:0.6rem;">32</td>
      <td style="border:1px solid var(--color-border); padding:0.6rem;">72+pl</td>
      <td style="border:1px solid var(--color-border); padding:0.6rem;">40+pl</td>
      <td style="border:1px solid var(--color-border); padding:0.6rem;">pl</td>
      <td style="border:1px solid var(--color-border); padding:0.6rem;">--</td>
      <td style="border:1px solid var(--color-border); padding:0.6rem;">pl</td>
    </tr>
    <tr>
      <td style="border:1px solid var(--color-border); padding:0.6rem;">MLKEM512_X25519</td>
      <td style="border:1px solid var(--color-border); padding:0.6rem;">5</td>
      <td style="border:1px solid var(--color-border); padding:0.6rem;">32</td>
      <td style="border:1px solid var(--color-border); padding:0.6rem;">856+pl</td>
      <td style="border:1px solid var(--color-border); padding:0.6rem;">824+pl</td>
      <td style="border:1px solid var(--color-border); padding:0.6rem;">784+pl</td>
      <td style="border:1px solid var(--color-border); padding:0.6rem;">768</td>
      <td style="border:1px solid var(--color-border); padding:0.6rem;">pl</td>
    </tr>
    <tr>
      <td style="border:1px solid var(--color-border); padding:0.6rem;">MLKEM768_X25519</td>
      <td style="border:1px solid var(--color-border); padding:0.6rem;">6</td>
      <td style="border:1px solid var(--color-border); padding:0.6rem;">32</td>
      <td style="border:1px solid var(--color-border); padding:0.6rem;">1176+pl</td>
      <td style="border:1px solid var(--color-border); padding:0.6rem;">1144+pl</td>
      <td style="border:1px solid var(--color-border); padding:0.6rem;">1104+pl</td>
      <td style="border:1px solid var(--color-border); padding:0.6rem;">1088</td>
      <td style="border:1px solid var(--color-border); padding:0.6rem;">pl</td>
    </tr>
    <tr>
      <td style="border:1px solid var(--color-border); padding:0.6rem;">MLKEM1024_X25519</td>
      <td style="border:1px solid var(--color-border); padding:0.6rem;">7</td>
      <td style="border:1px solid var(--color-border); padding:0.6rem;">32</td>
      <td style="border:1px solid var(--color-border); padding:0.6rem;">1656+pl</td>
      <td style="border:1px solid var(--color-border); padding:0.6rem;">1624+pl</td>
      <td style="border:1px solid var(--color-border); padding:0.6rem;">1584+pl</td>
      <td style="border:1px solid var(--color-border); padding:0.6rem;">1568</td>
      <td style="border:1px solid var(--color-border); padding:0.6rem;">pl</td>
    </tr>
  </tbody>
</table>
对于三种 ML-KEM（基于模格的密钥封装机制）变体，大小分别增加 784、1104 和 1584 字节；这些增量由 ML-KEM 密文以及用于认证加密的 16 字节 Poly1305 消息认证码（MAC）共同构成。
<h2 id="开销分析">开销分析</h2>
<h3 id="密钥交换-1">密钥交换</h3>
<p>与仅使用 X25519 相比，混合加密的开销相当可观：</p>
<ul>
<li><strong>MLKEM512_X25519</strong>: 握手消息大小约增加 9-12 倍 (NS: 9.5 倍, NSR: 11.9 倍)</li>
<li><strong>MLKEM768_X25519</strong>: 握手消息大小约增加 13-16 倍 (NS: 13.5 倍, NSR: 16.3 倍)</li>
<li><strong>MLKEM1024_X25519</strong>: 握手消息大小约增加 17-23 倍 (NS: 17.5 倍, NSR: 23 倍)</li>
</ul>
<p>为获得后量子安全带来的额外收益，这种开销是可以接受的。由于基础消息大小不同，各消息类型的倍率也会有所不同（NS 最小为 96 字节，NSR 最小为 72 字节）。</p>
<h3 id="带宽注意事项">带宽注意事项</h3>
<p>对于典型的会话建立且负载最小的场景： - 仅 X25519：总计 ~200 字节（NS + NSR） - MLKEM512_X25519：总计 ~1,800 字节（增长 9 倍） - MLKEM768_X25519：总计 ~2,500 字节（增长 12.5 倍） - MLKEM1024_X25519：总计 ~3,400 字节（增长 17 倍）</p>
<p>在会话建立之后，后续的消息加密使用与仅使用 X25519 的会话相同的数据传输格式，因此不会给后续消息带来额外开销。</p>
<h2 id="安全分析">安全分析</h2>
<h3 id="握手">握手</h3>
<p>混合握手同时提供经典（X25519）与后量子（ML-KEM）的安全性。攻击者必须破解<strong>两者</strong>：经典的ECDH（椭圆曲线Diffie-Hellman）和后量子的KEM（密钥封装机制），才能危及会话密钥。</p>
<p>这提供： - <strong>当前安全性</strong>：X25519 ECDH 可抵御传统攻击者（128 位安全级别） - <strong>未来安全性</strong>：ML-KEM（模块格密钥封装机制）可抵御量子攻击者（因参数集而异） - <strong>混合安全性</strong>：要危及会话，必须同时攻破二者（安全级别 = 两者中的最大值）</p>
<h3 id="安全级别">安全级别</h3>
<table style="width:100%; border-collapse:collapse; margin-bottom:1.5rem;">
  <thead>
    <tr>
      <th style="border:1px solid var(--color-border); padding:0.6rem; text-align:left; background:var(--color-bg-secondary);">Variant</th>
      <th style="border:1px solid var(--color-border); padding:0.6rem; text-align:left; background:var(--color-bg-secondary);">NIST Category</th>
      <th style="border:1px solid var(--color-border); padding:0.6rem; text-align:left; background:var(--color-bg-secondary);">Classical Security</th>
      <th style="border:1px solid var(--color-border); padding:0.6rem; text-align:left; background:var(--color-bg-secondary);">PQ Security</th>
      <th style="border:1px solid var(--color-border); padding:0.6rem; text-align:left; background:var(--color-bg-secondary);">Hybrid Security</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="border:1px solid var(--color-border); padding:0.6rem;">MLKEM512_X25519</td>
      <td style="border:1px solid var(--color-border); padding:0.6rem;">Category 1</td>
      <td style="border:1px solid var(--color-border); padding:0.6rem;">128-bit (X25519)</td>
      <td style="border:1px solid var(--color-border); padding:0.6rem;">AES-128 equivalent</td>
      <td style="border:1px solid var(--color-border); padding:0.6rem;">128-bit</td>
    </tr>
    <tr>
      <td style="border:1px solid var(--color-border); padding:0.6rem;">MLKEM768_X25519</td>
      <td style="border:1px solid var(--color-border); padding:0.6rem;">Category 3</td>
      <td style="border:1px solid var(--color-border); padding:0.6rem;">128-bit (X25519)</td>
      <td style="border:1px solid var(--color-border); padding:0.6rem;">AES-192 equivalent</td>
      <td style="border:1px solid var(--color-border); padding:0.6rem;">128-bit</td>
    </tr>
    <tr>
      <td style="border:1px solid var(--color-border); padding:0.6rem;">MLKEM1024_X25519</td>
      <td style="border:1px solid var(--color-border); padding:0.6rem;">Category 5</td>
      <td style="border:1px solid var(--color-border); padding:0.6rem;">128-bit (X25519)</td>
      <td style="border:1px solid var(--color-border); padding:0.6rem;">AES-256 equivalent</td>
      <td style="border:1px solid var(--color-border); padding:0.6rem;">128-bit</td>
    </tr>
  </tbody>
</table>
**注意：** 混合安全级别受两种组成部分中较弱者所限制。在所有情况下，X25519（基于 Curve25519 的椭圆曲线 Diffie-Hellman 密钥交换算法）提供 128 位经典安全性。若出现具备密码学相关能力的量子计算机，安全级别将取决于所选择的 ML-KEM（基于模格的密钥封装机制，NIST 标准 Kyber）参数集。
<h3 id="前向保密">前向保密</h3>
<p>这种混合方案保持了前向保密性。会话密钥由临时的 X25519 和临时的 ML-KEM（模块格密钥封装机制，后量子密钥封装算法）密钥交换共同导出。只要在握手后销毁 X25519 或 ML-KEM 的临时私钥，即使长期静态密钥被泄露，过去的会话也无法被解密。</p>
<p>在第二个消息（NSR）发送后，IK 模式即可提供完全的前向保密（Noise Confidentiality level 5，Noise 协议的机密性等级 5）。</p>
<h2 id="类型首选项">类型首选项</h2>
<p>实现应支持多种混合类型，并协商选择双方共同支持的最强变体。偏好顺序应为：</p>
<ol>
<li><strong>MLKEM768_X25519</strong> (后量子密钥封装机制（KEM）与 X25519 的混合密钥交换套件) (Type 6) - 推荐的默认选项，安全性与性能的最佳平衡</li>
<li><strong>MLKEM1024_X25519</strong> (Type 7) - 适用于敏感应用的最高安全性</li>
<li><strong>MLKEM512_X25519</strong> (Type 5) - 面向资源受限场景的基础级后量子安全</li>
<li><strong>X25519</strong> (Type 4) - 仅经典算法，用于兼容性的回退选项</li>
</ol>
<p><strong>理由:</strong> 推荐将 MLKEM768_X25519 作为默认选项，因为它提供 NIST 第3类安全性（等效于 AES-192），在对抗量子计算机方面被认为足够，同时还能保持合理的消息大小。MLKEM1024_X25519 提供更高的安全性，但开销会显著增加。</p>
<h2 id="实现说明">实现说明</h2>
<h3 id="库支持">库支持</h3>
<ul>
<li><strong>Java</strong>：Bouncycastle 库 1.79 版（2024 年 8 月）及更高版本支持所有所需的 ML-KEM（模块格密钥封装机制）变体和 SHA3/SHAKE 函数。为符合 FIPS 203，请使用 <code>org.bouncycastle.pqc.crypto.mlkem.MLKEMEngine</code>。</li>
<li><strong>C++</strong>：OpenSSL 3.5（2025 年 4 月）及之后的版本通过 EVP_KEM 接口包含对 ML-KEM 的支持。该版本为长期支持（LTS）版本，维护至 2030 年 4 月。</li>
<li><strong>Go</strong>：有多种第三方库可用于 ML-KEM 和 SHA3，其中包括 Cloudflare 的 CIRCL 库。</li>
</ul>
<h3 id="迁移策略">迁移策略</h3>
<p>实现应：1. 在过渡期内同时支持 X25519-only 和混合 ML-KEM（模块格密钥封装机制）变体 2. 当双方对等节点都支持时优先选择混合变体 3. 为向后兼容保留回退到 X25519-only 4. 在选择默认变体时考虑网络带宽约束</p>
<h3 id="共享-tunnels">共享 Tunnels</h3>
<p>消息大小的增加可能会影响共享 tunnel 的使用。实现应考虑： - 在可能的情况下将握手批量处理，以摊平开销 - 对混合会话使用更短的到期时间，以减少已存储的状态 - 监控带宽使用情况并相应调整参数 - 对会话建立流量实施拥塞控制</p>
<h3 id="新会话大小注意事项">新会话大小注意事项</h3>
<p>由于握手消息更大，各实现可能需要： - 增加用于会话协商的缓冲区大小（建议至少 4KB） - 为较慢的连接调整超时值（考虑到消息大小约为原来的 ~3–17 倍） - 考虑对 NS/NSR 消息中的有效载荷数据进行压缩 - 如果传输层需要，实现分片处理</p>
<h3 id="测试与验证">测试与验证</h3>
<p>实现应验证: - 正确的 ML-KEM（密钥封装机制）密钥生成、封装与解封装 - 将 kem_shared_key 正确集成到 Noise KDF（密钥派生函数）中 - 消息大小的计算与规范相一致 - 与其他 I2P router 实现的互操作性 - 当 ML-KEM 不可用时的回退行为</p>
<p>用于 ML-KEM（模块格密钥封装机制）操作的测试向量可在 NIST <a href="https://csrc.nist.gov/Projects/cryptographic-algorithm-validation-program">加密算法验证计划</a>
 中获得。</p>
<h2 id="版本兼容性">版本兼容性</h2>
<p><strong>I2P 版本编号：</strong> I2P 采用两套并行的版本号： - <strong>Router 发行版本</strong>: 2.x.x 格式（例如，2.10.0 于 2025 年 9 月发布） - <strong>API/协议版本</strong>: 0.9.x 格式（例如，0.9.67 对应于 router 2.10.0）</p>
<p>本规范参考协议版本 0.9.67，对应于 router 发布版本 2.10.0 及更高版本。</p>
<p><strong>兼容性矩阵：</strong></p>
<table style="width:100%; border-collapse:collapse; margin-bottom:1.5rem;">
  <thead>
    <tr>
      <th style="border:1px solid var(--color-border); padding:0.6rem; text-align:left; background:var(--color-bg-secondary);">Implementation</th>
      <th style="border:1px solid var(--color-border); padding:0.6rem; text-align:left; background:var(--color-bg-secondary);">Version</th>
      <th style="border:1px solid var(--color-border); padding:0.6rem; text-align:left; background:var(--color-bg-secondary);">ML-KEM Support</th>
      <th style="border:1px solid var(--color-border); padding:0.6rem; text-align:left; background:var(--color-bg-secondary);">Status</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="border:1px solid var(--color-border); padding:0.6rem;">i2pd</td>
      <td style="border:1px solid var(--color-border); padding:0.6rem;">2.58.0+</td>
      <td style="border:1px solid var(--color-border); padding:0.6rem;">Full (512/768/1024)</td>
      <td style="border:1px solid var(--color-border); padding:0.6rem;">Deployed September 2025</td>
    </tr>
    <tr>
      <td style="border:1px solid var(--color-border); padding:0.6rem;">Java I2P</td>
      <td style="border:1px solid var(--color-border); padding:0.6rem;">0.9.67 / 2.10.0</td>
      <td style="border:1px solid var(--color-border); padding:0.6rem;">Not yet</td>
      <td style="border:1px solid var(--color-border); padding:0.6rem;">Planned for future release</td>
    </tr>
  </tbody>
</table>
## 参考资料
<ul>
<li><strong>[ECIES]</strong>: <a href="../../../../zh/docs/specs/ecies/">ECIES-X25519-AEAD-Ratchet 规范</a>
</li>
<li><strong>[Prop169]</strong>: <a href="../../../../zh/proposals/169-pq-crypto/">提案 169：后量子密码学</a>
</li>
<li><strong>[FIPS203]</strong>: <a href="https://csrc.nist.gov/pubs/fips/203/final">NIST FIPS 203 - ML-KEM 标准</a>
</li>
<li><strong>[FIPS202]</strong>: <a href="https://csrc.nist.gov/pubs/fips/202/final">NIST FIPS 202 - SHA-3 标准</a>
</li>
<li><strong>[Noise]</strong>: <a href="https://noiseprotocol.org/noise.html">Noise 协议框架</a>
</li>
<li><strong>[COMMON]</strong>: <a href="../../../../zh/docs/specs/common-structures/">通用结构规范</a>
</li>
<li><strong>[RFC7539]</strong>: <a href="https://www.rfc-editor.org/rfc/rfc7539">RFC 7539 - ChaCha20 与 Poly1305</a>
</li>
<li><strong>[RFC5869]</strong>: <a href="https://www.rfc-editor.org/rfc/rfc5869">RFC 5869 - HKDF</a>
</li>
<li><strong>[OpenSSL]</strong>: <a href="https://docs.openssl.org/3.5/man7/EVP_KEM-ML-KEM/">OpenSSL 3.5 ML-KEM 文档</a>
</li>
<li><strong>[Bouncycastle]</strong>: <a href="https://www.bouncycastle.org/">Bouncycastle Java 加密库</a>
</li>
</ul>
<hr>

                </article>

                
                <nav class="page-nav">
                    
                        <a href="../../../../zh/docs/specs/ecies/" class="page-nav-link prev">
                            <span class="nav-label">← Previous</span>
                            <span class="nav-title">ECIES-X25519-AEAD-Ratchet 加密规范（棘轮机制）</span>
                        </a>
                    
                    
                        <a href="../../../../zh/docs/specs/blockfile/" class="page-nav-link next">
                            <span class="nav-label">Next →</span>
                            <span class="nav-title">Blockfile（块文件）规范</span>
                        </a>
                    
                </nav>

                
                <div class="docs-feedback">
                    <p>Was this page helpful?</p>
                    <div class="feedback-buttons" id="feedback-buttons">
                        <button class="feedback-btn" id="feedback-yes">👍 Yes</button>
                        <button class="feedback-btn" id="feedback-no">👎 No</button>
                    </div>

                    
                    <div class="feedback-form-container" id="feedback-form-container" style="display: none;">
                        <p class="feedback-form-title">We're sorry to hear that. How can we improve this page?</p>
                        <form id="feedback-form">
                            <div class="form-group">
                                <label for="feedback-email">Email (optional - if you'd like a response)</label>
                                <input type="email" id="feedback-email" name="email" placeholder="your@email.com">
                            </div>
                            <div class="form-group">
                                <label for="feedback-message">Feedback *</label>
                                <textarea id="feedback-message" name="message" rows="4" required placeholder="Tell us what we can improve..."></textarea>
                            </div>
                            <button type="submit" class="btn-submit-feedback" id="feedback-submit-btn">
                                <span class="btn-text">Submit Feedback</span>
                                <span class="btn-loading" style="display: none;">Sending...</span>
                            </button>
                        </form>
                    </div>

                    
                    <div class="feedback-message" id="feedback-success" style="display: none;">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                            <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" stroke-width="2"/>
                        </svg>
                        <span id="feedback-success-text">Thanks for your feedback!</span>
                    </div>
                    <div class="feedback-message feedback-error" id="feedback-error" style="display: none;">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                            <circle cx="12" cy="12" r="10" stroke-width="2"/>
                            <path d="M12 8v4M12 16h.01" stroke-width="2" stroke-linecap="round"/>
                        </svg>
                        <span id="feedback-error-text">Something went wrong. Please try again.</span>
                    </div>

                    <p class="feedback-note">
                        Found an issue? <a href="https://gitlab.com/stormycloud-group/i-2-p-www-v-2/-/blob/main/hugo-site/content/zh/docs/specs/ecies-hybrid.md?ref_type=heads" target="_blank">Edit this page on GitLab</a>
                    </p>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
.docs-page {
    min-height: 100vh;
    padding: var(--spacing-xl) 0;
}

.breadcrumbs {
    display: flex;
    align-items: center;
    gap: var(--spacing-xs);
    margin-bottom: var(--spacing-lg);
    font-size: 0.875rem;
    color: var(--color-text-muted);
}

.breadcrumbs a {
    color: var(--color-text-muted);
    text-decoration: none;
    transition: color var(--transition-fast);
}

.breadcrumbs a:hover {
    color: var(--color-primary);
}

.separator {
    color: var(--color-border);
}

.current {
    color: var(--color-text);
}

 
.translation-disclaimer {
    background: #fef3c7;
    border: 1px solid #f59e0b;
    border-radius: var(--radius-md);
    padding: var(--spacing-md);
    margin-bottom: var(--spacing-lg);
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: var(--spacing-md);
    flex-wrap: wrap;
}

.dark .translation-disclaimer {
    background: #78350f;
    border-color: #d97706;
}

.disclaimer-message {
    color: #92400e;
    font-size: 0.875rem;
}

.dark .disclaimer-message {
    color: #fde047;
}

.disclaimer-link {
    color: #92400e;
    font-weight: 600;
    text-decoration: underline;
    white-space: nowrap;
}

.dark .disclaimer-link {
    color: #fde047;
}

 
.article-header {
    margin-bottom: var(--spacing-2xl);
}

.article-title {
    font-size: 2.5rem;
    margin: 0 0 var(--spacing-md) 0;
    color: var(--color-text);
}

.article-description {
    font-size: 1.125rem;
    color: var(--color-text-secondary);
    margin-bottom: var(--spacing-md);
}

.article-meta {
    display: flex;
    gap: var(--spacing-lg);
    flex-wrap: wrap;
}

.meta-item {
    display: flex;
    align-items: center;
    gap: var(--spacing-xs);
    font-size: 0.875rem;
    color: var(--color-text-muted);
}

.meta-item svg {
    color: var(--color-primary);
}

 
.docs-layout {
    display: block;
}

.docs-layout--with-toc {
    display: grid;
    grid-template-columns: 260px 1fr;
    gap: var(--spacing-2xl);
    align-items: start;
}

 
.docs-toc-sidebar {
    position: sticky;
    top: 100px;
    max-height: calc(100vh - 120px);
    overflow-y: auto;
}

.toc-nav {
    background: var(--color-bg-secondary);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-lg);
    padding: var(--spacing-md);
}

.toc-header {
    display: flex;
    align-items: center;
    gap: var(--spacing-sm);
    font-weight: 700;
    font-size: 0.875rem;
    color: var(--color-text);
    padding-bottom: var(--spacing-md);
    margin-bottom: var(--spacing-md);
    border-bottom: 1px solid var(--color-border);
}

.toc-content {
    max-height: calc(100vh - 250px);
    overflow-y: auto;
}

.toc-content::-webkit-scrollbar {
    width: 4px;
}

.toc-content::-webkit-scrollbar-track {
    background: transparent;
}

.toc-content::-webkit-scrollbar-thumb {
    background: var(--color-border);
    border-radius: 2px;
}

.toc-content::-webkit-scrollbar-thumb:hover {
    background: var(--color-text-muted);
}

.toc-nav ul {
    list-style: none;
    padding-left: 0;
    margin: 0;
}

.toc-nav li {
    margin-bottom: 0.25rem;
}

.toc-nav ul ul {
    padding-left: var(--spacing-md);
    margin-top: 0.25rem;
}

.toc-nav a {
    color: var(--color-text-secondary);
    text-decoration: none;
    font-size: 0.8125rem;
    display: block;
    padding: 0.25rem 0.5rem;
    border-radius: var(--radius-sm);
    transition: all var(--transition-fast);
    line-height: 1.4;
}

.toc-nav a:hover {
    color: var(--color-primary);
    background: var(--color-bg-tertiary);
}

 
.docs-main {
    min-width: 0;
    max-width: 900px;
}

 
.article-content {
    line-height: 1.8;
    color: var(--color-text);
}

.article-content h2 {
    margin-top: var(--spacing-2xl);
    margin-bottom: var(--spacing-md);
    font-size: 1.75rem;
    scroll-margin-top: 100px;
}

.article-content h3 {
    margin-top: var(--spacing-xl);
    margin-bottom: var(--spacing-sm);
    font-size: 1.375rem;
    scroll-margin-top: 100px;
}

.article-content h4 {
    margin-top: var(--spacing-lg);
    margin-bottom: var(--spacing-xs);
    font-size: 1.125rem;
    scroll-margin-top: 100px;
}

.article-content p {
    margin-bottom: var(--spacing-md);
}

.article-content ul,
.article-content ol {
    margin-bottom: var(--spacing-md);
    padding-left: var(--spacing-xl);
}

.article-content li {
    margin-bottom: var(--spacing-xs);
}

.article-content code {
    background: var(--color-bg-secondary);
    padding: 0.125rem 0.375rem;
    border-radius: var(--radius-sm);
    font-size: 0.875em;
    font-family: 'Courier New', monospace;
}

.article-content pre {
    background: var(--color-bg-secondary);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-md);
    padding: var(--spacing-md);
    overflow-x: auto;
    margin-bottom: var(--spacing-md);
}

.article-content pre code {
    background: none;
    padding: 0;
}

.article-content img {
    max-width: 100%;
    height: auto;
    border-radius: var(--radius-md);
    border: 1px solid var(--color-border);
    margin: var(--spacing-lg) 0;
    display: block;
}

.article-content a {
    color: var(--color-primary);
    text-decoration: none;
    border-bottom: 1px solid transparent;
    transition: border-color var(--transition-fast);
}

.article-content a:hover {
    border-bottom-color: var(--color-primary);
}

 
.page-nav {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: var(--spacing-md);
    margin-top: var(--spacing-2xl);
    padding-top: var(--spacing-xl);
    border-top: 1px solid var(--color-border);
}

.page-nav-link {
    display: flex;
    flex-direction: column;
    padding: var(--spacing-md);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-md);
    text-decoration: none;
    transition: all var(--transition-fast);
}

.page-nav-link:hover {
    border-color: var(--color-primary);
    box-shadow: var(--shadow-md);
}

.page-nav-link.next {
    text-align: right;
}

.nav-label {
    font-size: 0.875rem;
    color: var(--color-text-muted);
    margin-bottom: var(--spacing-xs);
}

.nav-title {
    font-weight: 600;
    color: var(--color-text);
}

 
.docs-feedback {
    margin-top: var(--spacing-2xl);
    padding: var(--spacing-lg);
    background: var(--color-bg-secondary);
    border-radius: var(--radius-md);
    text-align: center;
}

.feedback-buttons {
    display: flex;
    gap: var(--spacing-md);
    justify-content: center;
    margin: var(--spacing-md) 0;
}

.feedback-btn {
    padding: var(--spacing-sm) var(--spacing-lg);
    background: var(--color-bg);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-md);
    cursor: pointer;
    transition: all var(--transition-fast);
}

.feedback-btn:hover {
    border-color: var(--color-primary);
    background: var(--color-primary);
    color: white;
}

.feedback-note {
    font-size: 0.875rem;
    color: var(--color-text-muted);
    margin-top: var(--spacing-md);
}

.feedback-note a {
    color: var(--color-primary);
    text-decoration: none;
}

.feedback-note a:hover {
    text-decoration: underline;
}

 
.feedback-form-container {
    margin-top: var(--spacing-lg);
    padding: var(--spacing-lg);
    background: var(--color-bg);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-md);
    text-align: left;
}

.feedback-form-title {
    font-weight: 600;
    margin-bottom: var(--spacing-md);
    color: var(--color-text);
}

.form-group {
    margin-bottom: var(--spacing-md);
}

.form-group label {
    display: block;
    font-size: 0.875rem;
    font-weight: 600;
    margin-bottom: var(--spacing-xs);
    color: var(--color-text);
}

.form-group input[type="email"],
.form-group textarea {
    width: 100%;
    padding: var(--spacing-sm);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-md);
    background: var(--color-bg);
    color: var(--color-text);
    font-family: inherit;
    font-size: 0.9375rem;
    transition: border-color var(--transition-fast);
}

.form-group input[type="email"]:focus,
.form-group textarea:focus {
    outline: none;
    border-color: var(--color-primary);
}

.form-group textarea {
    resize: vertical;
    min-height: 100px;
}

.btn-submit-feedback {
    padding: var(--spacing-sm) var(--spacing-lg);
    background: var(--color-primary);
    color: white;
    border: none;
    border-radius: var(--radius-md);
    font-weight: 600;
    cursor: pointer;
    transition: all var(--transition-fast);
}

.btn-submit-feedback:hover:not(:disabled) {
    background: var(--color-primary-dark);
    transform: translateY(-1px);
}

.btn-submit-feedback:disabled {
    opacity: 0.6;
    cursor: not-allowed;
}

 
.feedback-message {
    display: flex;
    align-items: center;
    gap: var(--spacing-sm);
    padding: var(--spacing-md);
    background: #d1fae5;
    color: #065f46;
    border-radius: var(--radius-md);
    margin-top: var(--spacing-md);
}

.feedback-message.feedback-error {
    background: #fee2e2;
    color: #991b1b;
}

.feedback-message svg {
    flex-shrink: 0;
}

 
@media (max-width: 1024px) {
    .docs-layout--with-toc {
        grid-template-columns: 1fr;
    }

    .docs-toc-sidebar {
        position: static;
        max-height: none;
        margin-bottom: var(--spacing-xl);
    }

    .toc-content {
        max-height: 300px;
    }
}

@media (max-width: 768px) {
    .article-title {
        font-size: 1.75rem;
    }
}
</style>



<script>
document.addEventListener('DOMContentLoaded', function() {
    const tocLinks = document.querySelectorAll('.toc-nav a');
    const headings = [];

    tocLinks.forEach(link => {
        const href = link.getAttribute('href');
        if (href && href.startsWith('#')) {
            const heading = document.getElementById(href.slice(1));
            if (heading) {
                headings.push({ element: heading, link: link });
            }
        }
    });

    function updateActiveLink() {
        const scrollPos = window.scrollY + 120;
        let activeIndex = 0;

        for (let i = 0; i < headings.length; i++) {
            if (headings[i].element.offsetTop <= scrollPos) {
                activeIndex = i;
            }
        }

        tocLinks.forEach(link => link.classList.remove('active'));
        if (headings[activeIndex]) {
            headings[activeIndex].link.classList.add('active');
        }
    }

    window.addEventListener('scroll', updateActiveLink);
    updateActiveLink();
});
</script>
<style>
.toc-nav a.active {
    color: var(--color-primary);
    background: var(--color-bg-tertiary);
    font-weight: 600;
}
</style>



<script>
(function() {
    'use strict';
    
    
    let baseUrl = window.feedbackBaseUrl;
    if (!baseUrl) {
        const hostname = window.location.hostname;
        
        if (hostname.endsWith('.b32.i2p') || hostname.endsWith('.i2p')) {
            baseUrl = 'http://5kwyynf3eetgqa2nors6ctwo7doi7yu73k7uvypy5eqmm326zkiq.b32.i2p';
        } else if (hostname.endsWith('.onion')) {
            baseUrl = 'http://gfonxmohvarpmocsvllscsuszdu5rikipm6innvcwq4vpng7zzqmmfyd.onion';
        } else {
            baseUrl = 'https://feedback.i2p.net';
        }
    }
    
    const script = document.createElement('script');
    script.src = baseUrl + '/widgets/docs-feedback.js';
    script.async = true;
    script.onerror = function() {
        console.error('[Docs Feedback] Failed to load docs-feedback.js from:', baseUrl);
    };
    document.body.appendChild(script);
})();
</script>


    </main>

    <footer class="site-footer">
    <div class="container">
        <div class="footer-grid">
            <div class="footer-col footer-brand">
                <img src="../../../../images/i2plogo_lightmode.svg" alt="I2P Logo" class="footer-logo logo-light" loading="lazy" decoding="async">
                <img src="../../../../images/i2plogo_darkmode.svg" alt="I2P Logo" class="footer-logo logo-dark" loading="lazy" decoding="async">
                <p class="footer-tagline">Privacy. Security. Freedom.</p>
                <p class="footer-description">The Invisible Internet Project - A privacy-focused, anonymous network layer</p>

                <div class="footer-social-newsletter">
                    <div class="social-links">
                        <a href="https://mastodon.social/@i2p" target="_blank" rel="noopener" aria-label="Mastodon">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M21.327 8.566c0-4.339-2.843-5.61-2.843-5.61-1.433-.658-3.894-.935-6.451-.956h-.063c-2.557.021-5.016.298-6.45.956 0 0-2.843 1.272-2.843 5.61 0 .993-.019 2.181.012 3.441.103 4.243.778 8.425 4.701 9.463 1.809.479 3.362.579 4.612.51 2.268-.126 3.541-.809 3.541-.809l-.075-1.646s-1.621.511-3.441.449c-1.804-.062-3.707-.194-3.999-2.409a4.523 4.523 0 0 1-.04-.621s1.77.433 4.014.536c1.372.063 2.658-.08 3.965-.236 2.506-.299 4.688-1.843 4.962-3.254.434-2.223.398-5.424.398-5.424zm-3.353 5.59h-2.081V9.057c0-1.075-.452-1.62-1.357-1.62-1 0-1.501.647-1.501 1.927v2.791h-2.069V9.364c0-1.28-.501-1.927-1.502-1.927-.905 0-1.357.546-1.357 1.62v5.099H6.026V8.903c0-1.074.273-1.927.823-2.558.566-.631 1.307-.955 2.228-.955 1.065 0 1.872.409 2.405 1.228l.518.869.519-.869c.533-.819 1.34-1.228 2.405-1.228.92 0 1.662.324 2.228.955.549.631.822 1.484.822 2.558v5.253z"/>
                            </svg>
                        </a>
                        <a href="https://twitter.com/GetI2P" target="_blank" rel="noopener" aria-label="Twitter">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/>
                            </svg>
                        </a>
                        <a href="https://old.reddit.com/r/i2p" target="_blank" rel="noopener" aria-label="Reddit">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M12 0A12 12 0 0 0 0 12a12 12 0 0 0 12 12 12 12 0 0 0 12-12A12 12 0 0 0 12 0zm5.01 4.744c.688 0 1.25.561 1.25 1.249a1.25 1.25 0 0 1-2.498.056l-2.597-.547-.8 3.747c1.824.07 3.48.632 4.674 1.488.308-.309.73-.491 1.207-.491.968 0 1.754.786 1.754 1.754 0 .716-.435 1.333-1.01 1.614a3.111 3.111 0 0 1 .042.52c0 2.694-3.13 4.87-7.004 4.87-3.874 0-7.004-2.176-7.004-4.87 0-.183.015-.366.043-.534A1.748 1.748 0 0 1 4.028 12c0-.968.786-1.754 1.754-1.754.463 0 .898.196 1.207.49 1.207-.883 2.878-1.43 4.744-1.487l.885-4.182a.342.342 0 0 1 .14-.197.35.35 0 0 1 .238-.042l2.906.617a1.214 1.214 0 0 1 1.108-.701zM9.25 12C8.561 12 8 12.562 8 13.25c0 .687.561 1.248 1.25 1.248.687 0 1.248-.561 1.248-1.249 0-.688-.561-1.249-1.249-1.249zm5.5 0c-.687 0-1.248.561-1.248 1.25 0 .687.561 1.248 1.249 1.248.688 0 1.249-.561 1.249-1.249 0-.687-.562-1.249-1.25-1.249zm-5.466 3.99a.327.327 0 0 0-.231.094.33.33 0 0 0 0 .463c.842.842 2.484.913 2.961.913.477 0 2.105-.056 2.961-.913a.361.361 0 0 0 .029-.463.33.33 0 0 0-.464 0c-.547.533-1.684.73-2.512.73-.828 0-1.979-.196-2.512-.73a.326.326 0 0 0-.232-.095z"/>
                            </svg>
                        </a>
                        <a href="https://signal.group/#CjQKIOSUTtxlhbumAKcRsthPFkxkTUrkWcX39bbN6njLEgAIEhCTNsR0KDuiehAXZnkt42v5" target="_blank" rel="noopener" aria-label="Signal" class="signal-link">
                            <img src="../../../../images/Signal-Logo-Black.svg" alt="Signal" class="signal-logo signal-logo-light" loading="lazy" decoding="async">
                            <img src="../../../../images/Signal-Logo-White.svg" alt="Signal" class="signal-logo signal-logo-dark" loading="lazy" decoding="async">
                        </a>
                    </div>

                    
                    <div class="footer-newsletter-inline">
                        <p class="newsletter-description">保持关注 I2P 新闻：</p>
                        <form action="https://feedback.i2p.net/api/mailing-list/subscribe" method="POST" class="newsletter-form">
                            <input type="email" name="email" placeholder="输入您的邮箱" required>
                            <button type="submit">订阅</button>
                        </form>
                    </div>
                </div>
            </div>

            <div class="footer-col">
                <h3>快速链接</h3>
                <ul>
                    <li><a href="../../../../zh/financial-support/">捐赠</a></li>
                    <li><a href="../../../../zh/docs/overview/intro/">I2P介绍</a></li>
                </ul>
            </div>

            <div class="footer-col">
                <h3>社区</h3>
                <ul>
                    <li><a href="../../../../zh/get-involved/">参与其中</a></li>
                    <li><a href="../../../../zh/blog/">博客</a></li>
                    <li><a href="http://i2pforum.net/" target="_blank" rel="noopener">官方论坛</a></li>
                    <li><a href="../../../../zh/contact/">联系我们</a></li>
                </ul>
            </div>

            <div class="footer-col">
                <h3>资源</h3>
                <ul>
                    <li><a href="https://i2p-metrics.np-tokumei.net/" target="_blank" rel="noopener">I2P 指标</a></li>
                    <li><a href="../../../../zh/papers/">研究</a></li>
                    <li><a href="https://i2pgit.org/" target="_blank" rel="noopener">GitLab</a></li>
                    <li><a href="https://www.stormycloud.org/" target="_blank" rel="noopener">StormyCloud</a></li>
                </ul>
            </div>
        </div>

        <div class="footer-bottom">
            <p class="copyright">&copy; 2025 隐形互联网计划。在 Creative Commons 许可下。</p>
            <div class="footer-links">
                <a href="../../../../zh/privacy/">隐私</a>
                <a href="../../../../zh/terms/">条款</a>
                <a href="../../../../zh/about/media/">媒体</a>
            </div>
        </div>
    </div>
</footer>


    
    
<div class="modal-overlay" id="poll">
    <div class="modal-content poll-modal-content">
        <a href="#" class="modal-close" aria-label="关闭">
            <span aria-hidden="true">&times;</span>
        </a>

        <div class="modal-header">
            <h2>社区投票</h2>
            <p class="modal-subtitle">我们很想听听您的意见</p>
        </div>

        <div class="modal-body">
            
            <iframe 
                id="poll-iframe"
                data-poll-id="2"
                data-api-url="https://feedback.i2p.net"
                frameborder="0"
                scrolling="no"
                style="width: 100%; border: none; min-height: 400px;">
            </iframe>
        </div>

        <div class="modal-footer">
            <p class="modal-disclaimer">
                您的投票将帮助塑造 I2P 的未来。
            </p>
        </div>
    </div>
</div>


<script>
(function() {
    const iframe = document.getElementById('poll-iframe');
    if (!iframe) return;
    
    const hostname = window.location.hostname;
    let apiUrl = 'https://feedback.i2p.net';
    const pollId = iframe.getAttribute('data-poll-id') || '1';

    
    if (hostname.endsWith('.b32.i2p') || hostname.endsWith('.i2p')) {
        apiUrl = 'http://5kwyynf3eetgqa2nors6ctwo7doi7yu73k7uvypy5eqmm326zkiq.b32.i2p';
    }
    
    else if (hostname.endsWith('.onion')) {
        apiUrl = 'http://gfonxmohvarpmocsvllscsuszdu5rikipm6innvcwq4vpng7zzqmmfyd.onion';
    }

    
    const pollUrl = apiUrl + '/widgets/poll.html?poll_id=' + encodeURIComponent(pollId) + '&api_url=' + encodeURIComponent(apiUrl);
    iframe.src = pollUrl;
})();
</script>



    
    



    
    <script>
        (function () {
            'use strict';
            var hostname = window.location.hostname;
            var baseUrl;

            
            if (hostname.endsWith('.b32.i2p') || hostname.endsWith('.i2p')) {
                baseUrl = 'http://5kwyynf3eetgqa2nors6ctwo7doi7yu73k7uvypy5eqmm326zkiq.b32.i2p';
            } else if (hostname.endsWith('.onion')) {
                baseUrl = 'http://gfonxmohvarpmocsvllscsuszdu5rikipm6innvcwq4vpng7zzqmmfyd.onion';
            } else {
                baseUrl = 'https://feedback.i2p.net';
            }

            window.feedbackBaseUrl = baseUrl;

            
            document.querySelectorAll('[data-api-url]').forEach(function (widget) {
                widget.setAttribute('data-api-url', baseUrl);
            });

            
            document.write('<link rel="stylesheet" href="' + baseUrl + '/widgets/styles.css">');
            
        })();
    </script>

    

    
    
    

    

</body>

</html>
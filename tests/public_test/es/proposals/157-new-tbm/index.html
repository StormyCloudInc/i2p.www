<!DOCTYPE html>
<html lang="es" data-theme="light">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <title>Mensajes de Construcción de Túneles Más Pequeños | I2P - El Proyecto Internet Invisible</title>

    <meta name="description" content="The Invisible Internet Project - A privacy-focused, anonymous network layer">
    <meta name="keywords" content="i2p, privacy, anonymity, dark net, encryption, security">

    
    <meta property="og:title" content="Mensajes de Construcción de Túneles Más Pequeños | I2P - El Proyecto Internet Invisible">
    <meta property="og:description" content="The Invisible Internet Project - A privacy-focused, anonymous network layer">
    <meta property="og:type" content="website">
    <meta property="og:url" content="/es/proposals/157-new-tbm/">

    
    <link rel="icon" type="image/svg+xml" href="../../../images/favicon.svg">
    <link rel="icon" type="image/png" href="../../../images/i2plogo.png" sizes="32x32">

    
    
    
    
    <link rel="stylesheet" href="../../../css/main.min.be6880f32f5ff44e57579da7b11513b973319944ebe38748e3ac7f3268662d18.css" integrity="sha256-vmiA8y9f9E5XV52nsRUTuXMxmUTr44dI46x/MmhmLRg=">
    


    
</head>

<body>
    
    <input type="checkbox" id="theme-toggle-checkbox" class="theme-checkbox" aria-hidden="true">

    
<div class="site-banner" id="site-banner" data-banner-id="banner-3" role="alert" aria-live="polite">
    <div class="container">
        <div class="banner-content">
            <span class="banner-message">Sitio Beta I2P Ahora Activo - Reportar problemas por correo a stormycloud@mail.i2p</span>
            
        </div>
        
        <form method="GET" action="../../../api/banner/dismiss" style="display: inline;">
            <input type="hidden" name="id" value="banner-3">
            <button type="submit" class="banner-close" aria-label="Cerrar banner" title="Cerrar banner">
                <span aria-hidden="true">&times;</span>
            </button>
        </form>
        
    </div>
</div>


    <header class="site-header">
    <div class="container">
        <nav class="main-nav">
            <div class="nav-brand">
                <a href="../../../es/" class="logo-link">
                    <img src="../../../images/i2plogo_lightmode.svg" alt="I2P Logo" class="logo logo-light">
                    <img src="../../../images/i2plogo_darkmode.svg" alt="I2P Logo" class="logo logo-dark">
                </a>
            </div>

            
            <input type="checkbox" id="mobile-menu-checkbox" class="mobile-menu-checkbox"
                aria-label="Toggle navigation menu">
            <label for="mobile-menu-checkbox" class="mobile-menu-toggle" aria-label="Toggle navigation menu">
                <span class="hamburger"></span>
            </label>

            <div class="nav-menu">
                <ul class="nav-links">
                    <li class="nav-dropdown">
                        <a href="../../../es/about/" class="">Acerca de</a>
                        <ul class="dropdown-menu">
                            <li><a href="../../../es/about/">Resumen</a></li>
                            <li><a href="../../../es/papers/">Artículos de Investigación</a></li>
                            <li><a href="../../../es/about/media/">Prensa</a></li>
                            <li><a href="../../../es/contact/">Contáctanos</a></li>
                        </ul>
                    </li>
                    <li><a href="../../../es/docs/" class="">Documentos</a></li>
                    <li><a href="../../../es/downloads/" class="">Descargas</a></li>
                    <li><a href="../../../es/blog/" class="">Blog</a></li>
                    <li class="nav-dropdown">
                        <a href="../../../es/get-involved/" class="">Participa</a>
                        <ul class="dropdown-menu">
                            <li><a href="../../../es/get-involved/">Resumen</a></li>
                            <li><a href="../../../es/feedback/">Sugerencias de Funciones</a></li>
                        </ul>
                    </li>
                </ul>

                <div class="nav-actions">
                    
                    <div class="language-selector">
                        <button class="language-toggle" aria-label="Select language" title="Language">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none"
                                xmlns="http://www.w3.org/2000/svg">
                                <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2" />
                                <path
                                    d="M2 12h20M12 2a15.3 15.3 0 014 10 15.3 15.3 0 01-4 10 15.3 15.3 0 01-4-10 15.3 15.3 0 014-10z"
                                    stroke="currentColor" stroke-width="2" />
                            </svg>
                            <span class="current-lang">es</span>
                        </button>
                        <div class="language-dropdown">
                            
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../en/proposals/157-new-tbm/"
                                class="lang-option">Inglés</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../es/proposals/157-new-tbm/"
                                class="lang-option active">Español</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../ko/proposals/157-new-tbm/"
                                class="lang-option">Coreano</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../zh/proposals/157-new-tbm/"
                                class="lang-option">Chino</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../ru/proposals/157-new-tbm/"
                                class="lang-option">Ruso</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../cs/proposals/157-new-tbm/"
                                class="lang-option">Checo</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../de/proposals/157-new-tbm/"
                                class="lang-option">Alemán</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../fr/proposals/157-new-tbm/"
                                class="lang-option">Francés</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../tr/proposals/157-new-tbm/"
                                class="lang-option">Turco</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../vi/proposals/157-new-tbm/"
                                class="lang-option">Vietnamita</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../hi/proposals/157-new-tbm/"
                                class="lang-option">Hindi</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../ar/proposals/157-new-tbm/"
                                class="lang-option">Árabe</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../pt/proposals/157-new-tbm/"
                                class="lang-option">Portugués</a>
                            
                            
                        </div>
                    </div>

                    
                    <label for="theme-toggle-checkbox" class="theme-toggle" aria-label="Toggle dark mode"
                        title="Toggle theme">
                        <svg class="sun-icon" width="20" height="20" viewBox="0 0 20 20" fill="none"
                            xmlns="http://www.w3.org/2000/svg">
                            <circle cx="10" cy="10" r="4" stroke="currentColor" stroke-width="2" />
                            <path
                                d="M10 2V4M10 16V18M18 10H16M4 10H2M15.657 4.343L14.243 5.757M5.757 14.243L4.343 15.657M15.657 15.657L14.243 14.243M5.757 5.757L4.343 4.343"
                                stroke="currentColor" stroke-width="2" stroke-linecap="round" />
                        </svg>
                        <svg class="moon-icon" width="20" height="20" viewBox="0 0 20 20" fill="none"
                            xmlns="http://www.w3.org/2000/svg">
                            <path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"
                                stroke="currentColor" stroke-width="2" stroke-linejoin="round" />
                        </svg>
                    </label>

                    
                    <a href="../../../es/financial-support/" class="btn btn-primary" id="donate-btn">Donate</a>

                    
                    <a href="../../../es/downloads/" class="btn btn-primary">Obtener I2P</a>
                </div>
            </div>
        </nav>
    </div>
</header>

    <main id="main-content">
        



<div class="proposals-page">
    <div class="container">
        
        <nav class="breadcrumbs">
            <a href="../../../es/">Home</a>
            <span class="separator">/</span>
            <a href="../../../es/proposals/">Proposals</a>
            <span class="separator">/</span>
            <span class="current">Mensajes de Construcción de Túneles Más Pequeños</span>
        </nav>

        
<div class="translation-disclaimer" role="note">
    <span class="disclaimer-message">Esta traducción fue generada mediante aprendizaje automático y puede no ser 100% precisa.</span>
    
    
    <a href="../../../en/proposals/157-new-tbm/" class="disclaimer-link">Ver versión en inglés</a>
    
</div>



        
        <header class="proposal-header">
            <div class="proposal-title-section">
                <h1 class="proposal-title">Mensajes de Construcción de Túneles Más Pequeños</h1>
                <div class="proposal-number">Proposal 157</div>
            </div>

            
            <div class="proposal-meta-box">
                <div class="proposal-status status-closed">
                    Closed
                </div>

                
                <div class="proposal-info-grid">
                    
                    <div class="info-item">
                        <span class="info-label">Author</span>
                        <span class="info-value">zzz, original</span>
                    </div>
                    

                    
                    <div class="info-item">
                        <span class="info-label">Created</span>
                        <span class="info-value">2020-10-09</span>
                    </div>
                    

                    
                    <div class="info-item">
                        <span class="info-label">Last Updated</span>
                        <span class="info-value">2021-07-31</span>
                    </div>
                    

                    
                    <div class="info-item">
                        <span class="info-label">Target Version</span>
                        <span class="info-value">0.9.51</span>
                    </div>
                    

                    
                </div>

                
                
            </div>
        </header>

        
        <div class="proposal-layout proposal-layout--with-toc">
            
            
            <aside class="proposal-toc-sidebar">
                <nav class="toc-nav">
                    <div class="toc-header">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                            <path d="M4 6h16M4 12h16M4 18h16" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                        </svg>
                        On This Page
                    </div>
                    <div class="toc-content">
                        <nav id="TableOfContents">
  <ul>
    <li><a href="#nota">Nota</a></li>
    <li><a href="#visión-general">Visión General</a>
      <ul>
        <li><a href="#resumen">Resumen</a></li>
        <li><a href="#objetivos">Objetivos</a></li>
        <li><a href="#no-objetivos">No Objetivos</a></li>
      </ul>
    </li>
    <li><a href="#diseño">Diseño</a>
      <ul>
        <li><a href="#registros">Registros</a></li>
        <li><a href="#mensajes-de-construcción-de-túneles">Mensajes de Construcción de Túneles</a></li>
        <li><a href="#flujo-de-mensajes">Flujo de Mensajes</a></li>
        <li><a href="#cifrado-de-registro">Cifrado de Registro</a></li>
        <li><a href="#cifrado-de-capa">Cifrado de Capa</a></li>
        <li><a href="#nuevo-mensaje-de-datos-de-túnel">Nuevo Mensaje de Datos de Túnel</a></li>
      </ul>
    </li>
    <li><a href="#especificación">Especificación</a>
      <ul>
        <li><a href="#registro-de-solicitud-corto">Registro de Solicitud Corto</a></li>
        <li><a href="#registro-de-respuesta-corto">Registro de Respuesta Corto</a></li>
        <li><a href="#kdf">KDF</a></li>
        <li><a href="#shorttunnelbuild">ShortTunnelBuild</a></li>
        <li><a href="#outboundtunnelbuildreply">OutboundTunnelBuildReply</a></li>
        <li><a href="#kdf-1">KDF</a></li>
      </ul>
    </li>
    <li><a href="#justificación">Justificación</a></li>
    <li><a href="#notas-de-implementación">Notas de Implementación</a></li>
    <li><a href="#problemas">Problemas</a></li>
    <li><a href="#migración">Migración</a></li>
    <li><a href="#apéndice">Apéndice</a></li>
  </ul>
</nav>
                    </div>
                </nav>
            </aside>
            

            
            <div class="proposal-main">
                <article class="proposal-content">
                    <h2 id="nota">Nota</h2>
<p>Implementado desde la versión API 0.9.51.
Despliegue y prueba de red en progreso.
Sujeto a revisiones menores.
Ver <a href="../../../es/docs/specs/i2np/">I2NP</a>
 y <a href="../../../es/docs/specs/implementation/#tunnel-creation-ecies">Tunnel-Creation-ECIES</a>
 para la especificación final.</p>
<h2 id="visión-general">Visión General</h2>
<h3 id="resumen">Resumen</h3>
<p>El tamaño actual de los registros de Solicitud y Respuesta de Construcción de Túneles cifrados es 528.
Para los mensajes típicos de Construcción de Túneles Variables y Respuesta de Construcción de Túneles Variables,
el tamaño total es de 2113 bytes. Este mensaje se fragmenta en tres mensajes de túnel de 1KB para el camino inverso.</p>
<p>Los cambios al formato de registro de 528 bytes para los enrutadores ECIES-X25519 se especifican en <a href="../../../es/proposals/152-ecies-tunnels/">Prop152</a>
 y <a href="../../../es/docs/specs/implementation/#tunnel-creation-ecies">Tunnel-Creation-ECIES</a>
.
Para una mezcla de enrutadores ElGamal y ECIES-X25519 en un túnel, el tamaño del registro debe permanecer
en 528 bytes. Sin embargo, si todos los enrutadores en un túnel son ECIES-X25519, es posible un nuevo registro de construcción más pequeño, ya que el cifrado ECIES-X25519 tiene mucho menos sobrecarga que ElGamal.</p>
<p>Mensajes más pequeños ahorrarían ancho de banda. Además, si los mensajes pudieran caber en un
único mensaje de túnel, el camino inverso sería tres veces más eficiente.</p>
<p>Esta propuesta define nuevos registros de solicitud y respuesta y nuevos mensajes de Solicitud de Construcción y Respuesta de Construcción.</p>
<p>El creador del túnel y todos los saltos en el túnel creado deben ser ECIES-X25519 y al menos versión 0.9.51.
Esta propuesta no será útil hasta que la mayoría de los enrutadores en la red sean ECIES-X25519.
Se espera que esto suceda para finales de 2021.</p>
<h3 id="objetivos">Objetivos</h3>
<p>Ver <a href="../../../es/proposals/152-ecies-tunnels/">Prop152</a>
 y <a href="../../../es/proposals/156-ecies-routers/">Prop156</a>
 para objetivos adicionales.</p>
<ul>
<li>Registros y mensajes más pequeños</li>
<li>Mantener suficiente espacio para futuras opciones, como en <a href="../../../es/proposals/152-ecies-tunnels/">Prop152</a>
 y <a href="../../../es/docs/specs/implementation/#tunnel-creation-ecies">Tunnel-Creation-ECIES</a>
</li>
<li>Ajustarse en un solo mensaje de túnel para el camino inverso</li>
<li>Soportar solo saltos ECIES</li>
<li>Mantener mejoras implementadas en <a href="../../../es/proposals/152-ecies-tunnels/">Prop152</a>
 y <a href="../../../es/docs/specs/implementation/#tunnel-creation-ecies">Tunnel-Creation-ECIES</a>
</li>
<li>Maximizar la compatibilidad con la red actual</li>
<li>Ocultar mensajes de construcción entrantes del OBEP</li>
<li>Ocultar mensajes de respuesta de construcción salientes del IBGW</li>
<li>No requerir actualización de &ldquo;día de cambios&rdquo; para toda la red</li>
<li>Despliegue gradual para minimizar riesgos</li>
<li>Reutilizar primitivas criptográficas existentes</li>
</ul>
<h3 id="no-objetivos">No Objetivos</h3>
<p>Ver <a href="../../../es/proposals/156-ecies-routers/">Prop156</a>
 para no objetivos adicionales.</p>
<ul>
<li>Sin requisito para túneles mixtos ElGamal/ECIES</li>
<li>Cambios en el cifrado de capa, para eso ver <a href="../../../es/proposals/153-chacha20-layer-encryption/">Prop153</a>
</li>
<li>Sin aceleraciones de operaciones criptográficas. Se asume que ChaCha20 y AES son similares,
incluso con AESNI, al menos para los pequeños tamaños de datos en cuestión.</li>
</ul>
<h2 id="diseño">Diseño</h2>
<h3 id="registros">Registros</h3>
<p>Ver apéndice para cálculos.</p>
<p>Los registros de solicitud y respuesta cifrados serán de 218 bytes, comparados con 528 bytes ahora.</p>
<p>Los registros de solicitud en texto claro serán de 154 bytes,
comparados con 222 bytes para registros ElGamal,
y 464 bytes para registros ECIES como se define en <a href="../../../es/proposals/152-ecies-tunnels/">Prop152</a>
 y <a href="../../../es/docs/specs/implementation/#tunnel-creation-ecies">Tunnel-Creation-ECIES</a>
.</p>
<p>Los registros de respuesta en texto claro serán de 202 bytes,
comparados con 496 bytes para registros ElGamal,
y 512 bytes para registros ECIES como se define en <a href="../../../es/proposals/152-ecies-tunnels/">Prop152</a>
 y <a href="../../../es/docs/specs/implementation/#tunnel-creation-ecies">Tunnel-Creation-ECIES</a>
.</p>
<p>El cifrado de respuesta será ChaCha20 (NO ChaCha20/Poly1305),
por lo que los registros de texto claro no necesitan ser múltiplos de 16 bytes.</p>
<p>Los registros de solicitud se harán más pequeños al usar HKDF para crear las
claves de capa y de respuesta, por lo que no necesitan ser incluidas explícitamente en la solicitud.</p>
<h3 id="mensajes-de-construcción-de-túneles">Mensajes de Construcción de Túneles</h3>
<p>Ambos serán &ldquo;variables&rdquo; con un campo de número de registros de un byte,
como con los mensajes Variables existentes.</p>
<h4 id="shorttunnelbuild-tipo-25">ShortTunnelBuild: Tipo 25</h4>
<p>Longitud típica (con 4 registros): 873 bytes</p>
<p>Cuando se usa para construcciones de túneles entrantes,
se recomienda (pero no es obligatorio) que este mensaje sea cifrado con ajo por el originador,
dirigiéndose a la puerta de enlace entrante (instrucciones de entrega ROUTER),
para ocultar mensajes de construcción entrantes del OBEP.
El IBGW descifra el mensaje,
coloca la respuesta en la ranura correcta,
y envía el ShortTunnelBuildMessage al siguiente salto.</p>
<p>La longitud del registro se selecciona para que un STBM cifrado con ajo quepa
en un único mensaje de túnel. Vea el apéndice a continuación.</p>
<h4 id="outboundtunnelbuildreply-tipo-26">OutboundTunnelBuildReply: Tipo 26</h4>
<p>Definimos un nuevo mensaje de OutboundTunnelBuildReply.
Este se usa solo para construcciones de túneles salientes.
El propósito es ocultar mensajes de respuesta de construcción salientes del IBGW.
Debe ser cifrado con ajo por el OBEP, dirigiéndose al originador
(instrucciones de entrega TUNNEL).
El OBEP descifra el mensaje de construcción del túnel,
construye un mensaje OutboundTunnelBuildReply,
y coloca la respuesta en el campo de texto claro.
Los otros registros se colocan en las otras ranuras.
Luego cifra con ajo el mensaje al originador con las claves simétricas derivadas.</p>
<h4 id="notas">Notas</h4>
<p>Al cifrar con ajo el OTBRM y el STBM, también evitamos cualquier posible
problema de compatibilidad en el IBGW y OBEP de los túneles emparejados.</p>
<h3 id="flujo-de-mensajes">Flujo de Mensajes</h3>
<pre tabindex="0"><code>STBM: Mensaje de construcción de túnel corto (tipo 25)
  OTBRM: Mensaje de respuesta de construcción de túnel saliente (tipo 26)

  Construcción de salida A-B-C
  Responder a través del túnel entrante existente D-E-F


                  Nuevo Túnel
           STBM      STBM      STBM
  Creador ------&gt; A ------&gt; B ------&gt; C ---\
                                     OBEP   \
                                            | Envoltura de ajo
                                            | OTBRM
                                            | (Entrega de TUNNEL)
                                            | del OBEP al
                                            | creador
                Túnel existente             /
  Creador &lt;-------F---------E-------- D &lt;--/
                                     IBGW


  Construcción de entrada D-E-F
  Enviado a través del túnel de salida existente A-B-C


                Túnel existente
  Creador ------&gt; A ------&gt; B ------&gt; C ---\
                                    OBEP    \
                                            | Envoltura de ajo (opcional)
                                            | STBM
                                            | (Entrega de ROUTER)
                                            | del creador
                  Nuevo Túnel                | al IBGW
            STBM      STBM      STBM        /
  Creador &lt;------ F &lt;------ E &lt;------ D &lt;--/
                                     IBGW
</code></pre><h3 id="cifrado-de-registro">Cifrado de Registro</h3>
<p>Cifrado de registro de solicitud y respuesta: como se define en <a href="../../../es/proposals/152-ecies-tunnels/">Prop152</a>
 y <a href="../../../es/docs/specs/implementation/#tunnel-creation-ecies">Tunnel-Creation-ECIES</a>
.</p>
<p>Cifrado de registro de respuesta para otras ranuras: ChaCha20.</p>
<h3 id="cifrado-de-capa">Cifrado de Capa</h3>
<p>Actualmente no hay planes para cambiar el cifrado de capa para los túneles construidos con
esta especificación; seguiría siendo AES, como se usa actualmente en todos los túneles.</p>
<p>Cambiar el cifrado de capa a ChaCha20 es un tema para más investigación.</p>
<h3 id="nuevo-mensaje-de-datos-de-túnel">Nuevo Mensaje de Datos de Túnel</h3>
<p>Actualmente no hay planes para cambiar el Mensaje de Datos de Túnel de 1KB usado para los túneles construidos con
esta especificación.</p>
<p>Puede ser útil introducir un nuevo mensaje I2NP que sea más grande o de tamaño variable, concurrente con esta propuesta,
para su uso en estos túneles.
Esto reduciría la sobrecarga para mensajes grandes.
Esto es un tema para más investigación.</p>
<h2 id="especificación">Especificación</h2>
<h3 id="registro-de-solicitud-corto">Registro de Solicitud Corto</h3>
<h4 id="registro-de-solicitud-corto-sin-cifrar">Registro de Solicitud Corto Sin Cifrar</h4>
<p>Esta es la especificación propuesta del registro de solicitud de construcción de túneles para los enrutadores ECIES-X25519.
Resumen de cambios de <a href="../../../es/docs/specs/implementation/#tunnel-creation-ecies">Tunnel-Creation-ECIES</a>
:</p>
<ul>
<li>Cambiar longitud sin cifrar de 464 a 154 bytes</li>
<li>Cambiar longitud cifrada de 528 a 218 bytes</li>
<li>Eliminar claves de capa y de respuesta e IVs, se generarán a partir de split() y un KDF</li>
</ul>
<p>El registro de solicitud no contiene ninguna clave de respuesta ChaCha.
Esas claves son derivadas de un KDF. Ver abajo.</p>
<p>Todos los campos son big-endian.</p>
<p>Tamaño sin cifrar: 154 bytes.</p>
<pre tabindex="0"><code>bytes     0-3: ID del túnel para recibir mensajes, no cero
  bytes     4-7: ID del siguiente túnel, no cero
  bytes    8-39: hash de identidad del siguiente enrutador
  byte       40: banderas
  bytes   41-42: más banderas, sin uso, establecer en 0 para compatibilidad
  byte       43: tipo de cifrado de capa
  bytes   44-47: hora de solicitud (en minutos desde la época, redondeado hacia abajo)
  bytes   48-51: expiración de la solicitud (en segundos desde la creación)
  bytes   52-55: siguiente ID de mensaje
  bytes    56-x: opciones de construcción de túnel (Mapping)
  bytes     x-x: otros datos según lo implicado por banderas u opciones
  bytes   x-153: relleno aleatorio (ver abajo)
</code></pre><p>El campo de banderas es el mismo que se define en <a href="../../../es/docs/specs/implementation/#tunnel-creation-ecies">Tunnel-Creation</a>
 y contiene lo siguiente::</p>
<p>Orden de bits: 76543210 (el bit 7 es el MSB)
bit 7: si está establecido, permitir mensajes de cualquiera
bit 6: si está establecido, permitir mensajes a cualquiera, y enviar la respuesta al
siguiente salto especificado en un mensaje de Respuesta de Construcción de Túnel
bits 5-0: No Definidos, deben establecerse en 0 para compatibilidad con futuras opciones</p>
<p>El bit 7 indica que el salto será una puerta de enlace entrante (IBGW). El bit 6
indica que el salto será un punto final saliente (OBEP). Si ninguno de los bits está
está establecido, el salto será un participante intermedio. Ambos no pueden estar establecidos a la vez.</p>
<p>Tipo de cifrado de capa: 0 para AES (como en los túneles actuales);
1 para futuro (¿ChaCha?)</p>
<p>La expiración de la solicitud es para la duración variable futura del túnel.
Por ahora, el único valor soportado es 600 (10 minutos).</p>
<p>La clave pública efímera del creador es una clave ECIES, big-endian.
Se usa para el KDF para las claves y IVs de capa y respuesta del IBGW.
Esto solo se incluye en el registro de texto claro en un mensaje de Construcción de Túnel Entrante.
Es necesario porque no hay DH en esta capa para el registro de construcción.</p>
<p>Las opciones de construcción de túnel son una estructura Mapping como se define en <a href="../../../es/docs/specs/common-structures/">Common</a>
.
Esto es para uso futuro. Actualmente no se definen opciones.
Si la estructura Mapping está vacía, estos son dos bytes 0x00 0x00.
El tamaño máximo del Mapping (incluyendo el campo de longitud) es 98 bytes,
y el valor máximo del campo de longitud de Mapping es 96.</p>
<h4 id="registro-de-solicitud-corto-cifrado">Registro de Solicitud Corto Cifrado</h4>
<p>Todos los campos son big-endian excepto la clave pública efímera que es little-endian.</p>
<p>Tamaño cifrado: 218 bytes</p>
<pre tabindex="0"><code>bytes    0-15: hash truncado de identidad del salto
  bytes   16-47: Clave pública efímera X25519 del remitente
  bytes  48-201: ShortBuildRequestRecord cifrado con ChaCha20
  bytes 202-217: Poly1305 MAC
</code></pre><h3 id="registro-de-respuesta-corto">Registro de Respuesta Corto</h3>
<h4 id="registro-de-respuesta-corto-sin-cifrar">Registro de Respuesta Corto Sin Cifrar</h4>
<p>Esta es la especificación propuesta del registro de ShortBuildReply para los enrutadores ECIES-X25519.
Resumen de cambios de <a href="../../../es/docs/specs/implementation/#tunnel-creation-ecies">Tunnel-Creation-ECIES</a>
:</p>
<ul>
<li>Cambiar longitud sin cifrar de 512 a 202 bytes</li>
<li>Cambiar longitud cifrada de 528 a 218 bytes</li>
</ul>
<p>Las respuestas ECIES se cifran con ChaCha20/Poly1305.</p>
<p>Todos los campos son big-endian.</p>
<p>Tamaño sin cifrar: 202 bytes.</p>
<pre tabindex="0"><code>bytes    0-x: Opciones de Respuesta de Construcción de Túnel (Mapping)
  bytes    x-x: otros datos según lo implicado por las opciones
  bytes  x-200: Relleno aleatorio (ver abajo)
  byte     201: Byte de respuesta
</code></pre><p>Las opciones de respuesta de construcción de túnel son una estructura Mapping como se define en <a href="../../../es/docs/specs/common-structures/">Common</a>
.
Esto es para uso futuro. Actualmente no se definen opciones.
Si la estructura Mapping está vacía, estos son dos bytes 0x00 0x00.
El tamaño máximo del Mapping (incluyendo el campo de longitud) es 201 bytes,
y el valor máximo del campo de longitud de Mapping es 199.</p>
<p>El byte de respuesta es uno de los siguientes valores
como se define en <a href="../../../es/docs/specs/implementation/#tunnel-creation-ecies">Tunnel-Creation</a>
 para evitar la identificación:</p>
<ul>
<li>0x00 (aceptar)</li>
<li>30 (TUNNEL_REJECT_BANDWIDTH)</li>
</ul>
<h4 id="registro-de-respuesta-corto-cifrado">Registro de Respuesta Corto Cifrado</h4>
<p>Tamaño cifrado: 218 bytes</p>
<pre tabindex="0"><code>bytes   0-201: ShortBuildReplyRecord cifrado con ChaCha20
  bytes 202-217: Poly1305 MAC
</code></pre><h3 id="kdf">KDF</h3>
<p>Ver sección KDF abajo.</p>
<h3 id="shorttunnelbuild">ShortTunnelBuild</h3>
<p>I2NP Tipo 25</p>
<p>Este mensaje se envía a saltos intermedios, OBEP y IBEP (creador).
No puede enviarse al IBGW (usar Construcción de Túnel Entrante envuelto con ajo en su lugar).
Cuando lo recibe el OBEP, se transforma en un OutboundTunnelBuildReply,
envuelto con ajo, y se envía al originador.</p>
<pre tabindex="0"><code>+----+----+----+----+----+----+----+----+
  | num| ShortBuildRequestRecords...
  +----+----+----+----+----+----+----+----+

  num ::
         1 byte `Integer`
         Valores válidos: 1-8

  tamaño del registro: 218 bytes
  tamaño total: 1+$num*218
</code></pre><h4 id="notas-1">Notas</h4>
<ul>
<li>El número típico de registros es 4, para un tamaño total de 873.</li>
</ul>
<h3 id="outboundtunnelbuildreply">OutboundTunnelBuildReply</h3>
<p>I2NP Tipo 26</p>
<p>Este mensaje solo se envía por el OBEP al IBEP (creador) a través de un túnel entrante existente.
No puede enviarse a ningún otro salto.
Siempre está cifrado con ajo.</p>
<pre tabindex="0"><code>+----+----+----+----+----+----+----+----+
  | num|                                  |
  +----+                                  +
  |      ShortBuildReplyRecords...        |
  +----+----+----+----+----+----+----+----+

  num ::
         Número total de registros,
         1 byte `Integer`
         Valores válidos: 1-8

  ShortBuildReplyRecords ::
         Registros cifrados
         longitud: num * 218

  tamaño del registro cifrado: 218 bytes
  tamaño total: 1+$num*218
</code></pre><h4 id="notas-2">Notas</h4>
<ul>
<li>El número típico de registros es 4, para un tamaño total de 873.</li>
<li>Este mensaje debe ser cifrado con ajo.</li>
</ul>
<h3 id="kdf-1">KDF</h3>
<p>Usamos ck del estado de Noise después del cifrado/descifrado de registros de construcción de túnel
para derivar las siguientes claves: clave de respuesta, clave de capa AES, clave de IV AES y clave/etiqueta de respuesta de ajo para OBEP.</p>
<p>Clave de respuesta:
A diferencia de los registros largos, no podemos usar la parte izquierda de ck para la clave de respuesta, porque no es la última y se usará después.
La clave de respuesta se usa para cifrar la respuesta de ese registro usando AEAD/ChaCha20/Poly1305 y ChaCha20 para responder a otros registros.
Ambos usan la misma clave, el nonce es la posición del registro en el mensaje comenzando desde 0.</p>
<pre tabindex="0"><code>keydata = HKDF(ck, ZEROLEN, &#34;SMTunnelReplyKey&#34;, 64)
  replyKey = keydata[32:63]
  ck = keydata[0:31]

  Clave de capa:
  La clave de capa siempre es AES por ahora, pero el mismo KDF puede ser usado para ChaCha20

  keydata = HKDF(ck, ZEROLEN, &#34;SMTunnelLayerKey&#34;, 64)
  layerKey = keydata[32:63]

  Clave de IV para registros que no sean OBEP:
  ivKey = keydata[0:31]
  porque es la última

  Clave de IV para registro OBEP:
  ck = keydata[0:31]
  keydata = HKDF(ck, ZEROLEN, &#34;TunnelLayerIVKey&#34;, 64)
  ivKey = keydata[32:63]
  ck = keydata[0:31]

  Clave/etiqueta de respuesta de ajo OBEP:
  keydata = HKDF(ck, ZEROLEN, &#34;RGarlicKeyAndTag&#34;, 64)
  replyKey = keydata[32:63]
  replyTag = keydata[0:7]
</code></pre><h2 id="justificación">Justificación</h2>
<p>Este diseño maximiza la reutilización de primitivas criptográficas, protocolos y código existentes.</p>
<p>Este diseño minimiza el riesgo.</p>
<p>ChaCha20 es ligeramente más rápido que AES para registros pequeños, en pruebas de Java.
ChaCha20 evita un requisito para tamaños de datos múltiplos de 16.</p>
<h2 id="notas-de-implementación">Notas de Implementación</h2>
<ul>
<li>Al igual que con el mensaje de construcción de túnel variable existente,
no se recomiendan mensajes de menos de 4 registros.
El valor típico por defecto es 3 saltos.
Los túneles entrantes deben construirse con un registro extra para
que el último salto no sepa que es el último.
Para que los saltos intermedios no sepan si un túnel es entrante o saliente,
también deberían construirse túneles salientes con 4 registros.</li>
</ul>
<h2 id="problemas">Problemas</h2>
<h2 id="migración">Migración</h2>
<p>La implementación, pruebas, y despliegue tomará varias versiones
y aproximadamente un año. Las fases son las siguientes. La asignación de
cada fase a una versión particular se determinará y dependerá del
ritmo de desarrollo.</p>
<p>Los detalles de la implementación y migración pueden variar para
cada implementación de I2P.</p>
<p>El creador del túnel debe asegurar que todos los saltos en el túnel creado sean ECIES-X25519, Y sean al menos la versión TBD.
El creador del túnel NO tiene que ser ECIES-X25519; puede ser ElGamal.
Sin embargo, si el creador es ElGamal, revela al salto más cercano que es el creador.
Por lo tanto, en la práctica, estos túneles solo deberían ser creados por enrutadores ECIES.</p>
<p>No debería ser necesario que el OBEP o IBGW del túnel emparejado sea ECIES o
de ninguna versión en particular.
Los nuevos mensajes están envueltos con ajo y no son visibles en el OBEP o IBGW
del túnel emparejado.</p>
<p>Fase 1: Implementación, no habilitada por defecto</p>
<p>Fase 2 (próxima versión): Habilitar por defecto</p>
<p>No hay problemas de compatibilidad hacia atrás. Los nuevos mensajes solo pueden ser enviados a enrutadores que los soportan.</p>
<h2 id="apéndice">Apéndice</h2>
<p>Sin sobrecarga de ajo para STBM entrante no cifrado,
si no usamos ITBM:</p>
<pre tabindex="0"><code>Tamaño actual de 4 ranuras: 4 * 528 + sobrecarga = 3 mensajes de túnel

  Mensaje de construcción de 4 ranuras para ajustar en un mensaje de túnel, solo ECIES:

  1024
  - 21 encabezado de fragmento
  ----
  1003
  - 35 instrucciones de entrega no fragmentadas ROUTER
  ----
  968
  - 16 encabezado I2NP
  ----
  952
  - 1 número de ranuras
  ----
  951
  / 4 ranuras
  ----
  237 Nuevo tamaño de registro de construcción cifrado (vs. 528 ahora)
  - 16 hash truncado
  - 32 clave efímera
  - 16 MAC
  ----
  173 tamaño máximo de registro de construcción en texto claro (vs. 222 ahora)
</code></pre><p>Con sobrecarga de ajo para el patrón de ruido &lsquo;N&rsquo; para cifrar STBM entrante,
si no usamos ITBM:</p>
<pre tabindex="0"><code>Tamaño actual de 4 ranuras: 4 * 528 + sobrecarga = 3 mensajes de túnel

  Mensaje de construcción de 4 ranuras cifrado con ajo para ajustar en un mensaje de túnel, solo ECIES:

  1024
  - 21 encabezado de fragmento
  ----
  1003
  - 35 instrucciones de entrega no fragmentadas ROUTER
  ----
  968
  - 16 encabezado I2NP
  -  4 longitud
  ----
  948
  - 32 bytes de clave efímera
  ----
  916
  - 7 bytes de bloque de DateTime
  ----
  909
  - 3 bytes de sobrecarga de bloque Garlic
  ----
  906
  - 9 bytes de encabezado I2NP
  ----
  897
  - 1 byte de instrucciones de entrega LOCAL de Garlic
  ----
  896
  - 16 bytes de Poly1305 MAC
  ----
  880
  - 1 número de ranuras
  ----
  879
  / 4 ranuras
  ----
  219 Nuevo tamaño de registro de construcción cifrado (vs. 528 ahora)
  - 16 hash truncado
  - 32 clave efímera
  - 16 MAC
  ----
  155 tamaño máximo de registro de construcción en texto claro (vs. 222 ahora)
</code></pre><p>Notas:</p>
<p>Tamaño actual de registro de construcción en texto claro antes de relleno no utilizado: 193</p>
<p>La eliminación del hash completo del enrutador y la generación HKDF de claves/IVs liberarían suficiente espacio para futuras opciones.
Si todo es HKDF, el espacio requerido en texto claro es de unos 58 bytes (sin ninguna opción).</p>
<p>El OTBRM envuelto con ajo será ligeramente más pequeño que el STBM envuelto con ajo,
porque las instrucciones de entrega son LOCAL no ROUTER,
no se incluye ningún bloque de DATETIME, y
usa una etiqueta de 8 bytes en lugar de la clave efímera de 32 bytes para un mensaje completo &lsquo;N&rsquo;.</p>

                </article>

                
                <nav class="page-nav">
                    <a href="../../../es/proposals/" class="page-nav-link">
                        ← Back to Proposals
                    </a>
                    
                    
                    
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                            
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                    <a href="../../../proposals/157-new-tbm.txt" class="page-nav-link" download>
                        Download Source (.txt)
                    </a>
                    
                </nav>
            </div>
        </div>
    </div>
</div>

<style>
.proposals-page {
    min-height: 100vh;
    padding: var(--spacing-xl) 0;
}

.breadcrumbs {
    display: flex;
    align-items: center;
    gap: var(--spacing-xs);
    margin-bottom: var(--spacing-lg);
    font-size: 0.875rem;
    color: var(--color-text-muted);
}

.breadcrumbs a {
    color: var(--color-text-muted);
    text-decoration: none;
    transition: color var(--transition-fast);
}

.breadcrumbs a:hover {
    color: var(--color-primary);
}

.separator {
    color: var(--color-border);
}

.current {
    color: var(--color-text);
}

 
.translation-disclaimer {
    background: #fef3c7;
    border: 1px solid #f59e0b;
    border-radius: var(--radius-md);
    padding: var(--spacing-md);
    margin-bottom: var(--spacing-lg);
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: var(--spacing-md);
    flex-wrap: wrap;
}

.dark .translation-disclaimer {
    background: #78350f;
    border-color: #d97706;
}

.disclaimer-message {
    color: #92400e;
    font-size: 0.875rem;
}

.dark .disclaimer-message {
    color: #fde047;
}

.disclaimer-link {
    color: #92400e;
    font-weight: 600;
    text-decoration: underline;
    white-space: nowrap;
}

.dark .disclaimer-link {
    color: #fde047;
}

 
.proposal-header {
    margin-bottom: var(--spacing-2xl);
}

.proposal-title-section {
    margin-bottom: var(--spacing-lg);
}

.proposal-title {
    font-size: 2.5rem;
    margin: 0 0 var(--spacing-sm) 0;
    color: var(--color-text);
}

.proposal-number {
    font-size: 0.875rem;
    color: var(--color-text-muted);
    font-weight: 600;
}

 
.proposal-meta-box {
    background: var(--color-bg-secondary);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-lg);
    padding: var(--spacing-lg);
}

.proposal-status {
    display: inline-block;
    padding: var(--spacing-xs) var(--spacing-md);
    border-radius: var(--radius-md);
    font-weight: 600;
    font-size: 0.875rem;
    margin-bottom: var(--spacing-md);
    text-transform: uppercase;
    letter-spacing: 0.05em;
}

 
.status-open {
    background: #dbeafe;
    color: #0369a1;
}

.dark .status-open {
    background: #0c4a6e;
    color: #7dd3fc;
}

.status-accepted {
    background: #dbeafe;
    color: #0369a1;
}

.dark .status-accepted {
    background: #0c4a6e;
    color: #7dd3fc;
}

.status-finished {
    background: #dcfce7;
    color: #15803d;
}

.dark .status-finished {
    background: #164e63;
    color: #86efac;
}

.status-closed {
    background: #dcfce7;
    color: #15803d;
}

.dark .status-closed {
    background: #164e63;
    color: #86efac;
}

.status-rejected {
    background: #fee2e2;
    color: #991b1b;
}

.dark .status-rejected {
    background: #7f1d1d;
    color: #fca5a5;
}

.status-draft,
.status-needs-revision,
.status-dead,
.status-needs-research {
    background: #fef3c7;
    color: #92400e;
}

.dark .status-draft,
.dark .status-needs-revision,
.dark .status-dead,
.dark .status-needs-research {
    background: #78350f;
    color: #fde047;
}

.status-meta,
.status-informational,
.status-reserve {
    background: #e9d5ff;
    color: #6b21a8;
}

.dark .status-meta,
.dark .status-informational,
.dark .status-reserve {
    background: #581c87;
    color: #e879f9;
}

 
.proposal-info-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: var(--spacing-md);
    margin-bottom: var(--spacing-lg);
}

.info-item {
    display: flex;
    flex-direction: column;
    gap: var(--spacing-xs);
}

.info-label {
    font-size: 0.75rem;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    color: var(--color-text-muted);
}

.info-value {
    font-size: 0.9375rem;
    color: var(--color-text);
    font-weight: 500;
}

 
.proposal-relationships {
    border-top: 1px solid var(--color-border);
    padding-top: var(--spacing-md);
}

.relationship {
    display: flex;
    gap: var(--spacing-md);
    margin-bottom: var(--spacing-sm);
}

.relationship:last-child {
    margin-bottom: 0;
}

.relationship-label {
    font-weight: 600;
    color: var(--color-text-muted);
    min-width: 120px;
}

.relationship-value {
    color: var(--color-text);
}

 
.proposal-layout {
    display: block;
}

.proposal-layout--with-toc {
    display: grid;
    grid-template-columns: 260px 1fr;
    gap: var(--spacing-2xl);
    align-items: start;
}

 
.proposal-toc-sidebar {
    position: sticky;
    top: 100px;
    max-height: calc(100vh - 120px);
    overflow-y: auto;
}

.toc-nav {
    background: var(--color-bg-secondary);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-lg);
    padding: var(--spacing-md);
}

.toc-header {
    display: flex;
    align-items: center;
    gap: var(--spacing-sm);
    font-weight: 700;
    font-size: 0.875rem;
    color: var(--color-text);
    padding-bottom: var(--spacing-md);
    margin-bottom: var(--spacing-md);
    border-bottom: 1px solid var(--color-border);
}

.toc-content {
    max-height: calc(100vh - 250px);
    overflow-y: auto;
}

.toc-content::-webkit-scrollbar {
    width: 4px;
}

.toc-content::-webkit-scrollbar-track {
    background: transparent;
}

.toc-content::-webkit-scrollbar-thumb {
    background: var(--color-border);
    border-radius: 2px;
}

.toc-content::-webkit-scrollbar-thumb:hover {
    background: var(--color-text-muted);
}

.toc-nav ul {
    list-style: none;
    padding-left: 0;
    margin: 0;
}

.toc-nav li {
    margin-bottom: 0.25rem;
}

.toc-nav ul ul {
    padding-left: var(--spacing-md);
    margin-top: 0.25rem;
}

.toc-nav a {
    color: var(--color-text-secondary);
    text-decoration: none;
    font-size: 0.8125rem;
    display: block;
    padding: 0.25rem 0.5rem;
    border-radius: var(--radius-sm);
    transition: all var(--transition-fast);
    line-height: 1.4;
}

.toc-nav a:hover {
    color: var(--color-primary);
    background: var(--color-bg-tertiary);
}

 
.proposal-main {
    min-width: 0;
}

 
.proposal-content {
    line-height: 1.8;
    color: var(--color-text);
    max-width: 900px;
}

.proposal-content h2 {
    margin-top: var(--spacing-2xl);
    margin-bottom: var(--spacing-md);
    font-size: 1.75rem;
    scroll-margin-top: 100px;
}

.proposal-content h3 {
    margin-top: var(--spacing-xl);
    margin-bottom: var(--spacing-sm);
    font-size: 1.375rem;
    scroll-margin-top: 100px;
}

.proposal-content h4 {
    margin-top: var(--spacing-lg);
    margin-bottom: var(--spacing-xs);
    font-size: 1.125rem;
    scroll-margin-top: 100px;
}

.proposal-content p {
    margin-bottom: var(--spacing-md);
}

.proposal-content ul,
.proposal-content ol {
    margin-bottom: var(--spacing-md);
    padding-left: var(--spacing-xl);
}

.proposal-content li {
    margin-bottom: var(--spacing-xs);
}

.proposal-content code {
    background: var(--color-bg-secondary);
    padding: 0.125rem 0.375rem;
    border-radius: var(--radius-sm);
    font-size: 0.875em;
    font-family: 'Courier New', monospace;
}

.proposal-content pre {
    background: var(--color-bg-secondary);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-md);
    padding: var(--spacing-md);
    overflow-x: auto;
    margin-bottom: var(--spacing-md);
    font-size: 0.875rem;
}

.proposal-content pre code {
    background: none;
    padding: 0;
}

.proposal-content blockquote {
    border-left: 4px solid var(--color-primary);
    padding-left: var(--spacing-md);
    margin-left: 0;
    margin-bottom: var(--spacing-md);
    font-style: italic;
    color: var(--color-text-secondary);
}

.proposal-content a {
    color: var(--color-primary);
    text-decoration: none;
    border-bottom: 1px solid transparent;
    transition: border-color var(--transition-fast);
}

.proposal-content a:hover {
    border-bottom-color: var(--color-primary);
}

.proposal-content table {
    width: 100%;
    border-collapse: collapse;
    margin-bottom: var(--spacing-md);
}

.proposal-content table th {
    background: var(--color-bg-secondary);
    padding: var(--spacing-sm);
    text-align: left;
    font-weight: 600;
    border-bottom: 2px solid var(--color-border);
}

.proposal-content table td {
    padding: var(--spacing-sm);
    border-bottom: 1px solid var(--color-border);
}

.proposal-content img {
    max-width: 100%;
    height: auto;
    border-radius: var(--radius-md);
    border: 1px solid var(--color-border);
    margin: var(--spacing-lg) 0;
    display: block;
}

 
.page-nav {
    margin-top: var(--spacing-2xl);
    padding-top: var(--spacing-xl);
    border-top: 1px solid var(--color-border);
    display: flex;
    gap: var(--spacing-md);
    flex-wrap: wrap;
}

.page-nav-link {
    display: inline-block;
    padding: var(--spacing-md) var(--spacing-lg);
    background: var(--color-bg-secondary);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-md);
    color: var(--color-text);
    text-decoration: none;
    transition: all var(--transition-fast);
}

.page-nav-link:hover {
    border-color: var(--color-primary);
    color: var(--color-primary);
}

 
@media (max-width: 1024px) {
    .proposal-layout--with-toc {
        grid-template-columns: 1fr;
    }

    .proposal-toc-sidebar {
        position: static;
        max-height: none;
        margin-bottom: var(--spacing-xl);
    }

    .toc-content {
        max-height: 300px;
    }
}

@media (max-width: 768px) {
    .proposal-title {
        font-size: 1.75rem;
    }

    .proposal-info-grid {
        grid-template-columns: 1fr;
    }
}
</style>



<script>
document.addEventListener('DOMContentLoaded', function() {
    const tocLinks = document.querySelectorAll('.toc-nav a');
    const headings = [];

    tocLinks.forEach(link => {
        const href = link.getAttribute('href');
        if (href && href.startsWith('#')) {
            const heading = document.getElementById(href.slice(1));
            if (heading) {
                headings.push({ element: heading, link: link });
            }
        }
    });

    function updateActiveLink() {
        const scrollPos = window.scrollY + 120;
        let activeIndex = 0;

        for (let i = 0; i < headings.length; i++) {
            if (headings[i].element.offsetTop <= scrollPos) {
                activeIndex = i;
            }
        }

        tocLinks.forEach(link => link.classList.remove('active'));
        if (headings[activeIndex]) {
            headings[activeIndex].link.classList.add('active');
        }
    }

    window.addEventListener('scroll', updateActiveLink);
    updateActiveLink();
});
</script>
<style>
.toc-nav a.active {
    color: var(--color-primary);
    background: var(--color-bg-tertiary);
    font-weight: 600;
}
</style>



    </main>

    <footer class="site-footer">
    <div class="container">
        <div class="footer-grid">
            <div class="footer-col footer-brand">
                <img src="../../../images/i2plogo_lightmode.svg" alt="I2P Logo" class="footer-logo logo-light" loading="lazy" decoding="async">
                <img src="../../../images/i2plogo_darkmode.svg" alt="I2P Logo" class="footer-logo logo-dark" loading="lazy" decoding="async">
                <p class="footer-tagline">Privacy. Security. Freedom.</p>
                <p class="footer-description">The Invisible Internet Project - A privacy-focused, anonymous network layer</p>

                <div class="footer-social-newsletter">
                    <div class="social-links">
                        <a href="https://mastodon.social/@i2p" target="_blank" rel="noopener" aria-label="Mastodon">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M21.327 8.566c0-4.339-2.843-5.61-2.843-5.61-1.433-.658-3.894-.935-6.451-.956h-.063c-2.557.021-5.016.298-6.45.956 0 0-2.843 1.272-2.843 5.61 0 .993-.019 2.181.012 3.441.103 4.243.778 8.425 4.701 9.463 1.809.479 3.362.579 4.612.51 2.268-.126 3.541-.809 3.541-.809l-.075-1.646s-1.621.511-3.441.449c-1.804-.062-3.707-.194-3.999-2.409a4.523 4.523 0 0 1-.04-.621s1.77.433 4.014.536c1.372.063 2.658-.08 3.965-.236 2.506-.299 4.688-1.843 4.962-3.254.434-2.223.398-5.424.398-5.424zm-3.353 5.59h-2.081V9.057c0-1.075-.452-1.62-1.357-1.62-1 0-1.501.647-1.501 1.927v2.791h-2.069V9.364c0-1.28-.501-1.927-1.502-1.927-.905 0-1.357.546-1.357 1.62v5.099H6.026V8.903c0-1.074.273-1.927.823-2.558.566-.631 1.307-.955 2.228-.955 1.065 0 1.872.409 2.405 1.228l.518.869.519-.869c.533-.819 1.34-1.228 2.405-1.228.92 0 1.662.324 2.228.955.549.631.822 1.484.822 2.558v5.253z"/>
                            </svg>
                        </a>
                        <a href="https://twitter.com/GetI2P" target="_blank" rel="noopener" aria-label="Twitter">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/>
                            </svg>
                        </a>
                        <a href="https://old.reddit.com/r/i2p" target="_blank" rel="noopener" aria-label="Reddit">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M12 0A12 12 0 0 0 0 12a12 12 0 0 0 12 12 12 12 0 0 0 12-12A12 12 0 0 0 12 0zm5.01 4.744c.688 0 1.25.561 1.25 1.249a1.25 1.25 0 0 1-2.498.056l-2.597-.547-.8 3.747c1.824.07 3.48.632 4.674 1.488.308-.309.73-.491 1.207-.491.968 0 1.754.786 1.754 1.754 0 .716-.435 1.333-1.01 1.614a3.111 3.111 0 0 1 .042.52c0 2.694-3.13 4.87-7.004 4.87-3.874 0-7.004-2.176-7.004-4.87 0-.183.015-.366.043-.534A1.748 1.748 0 0 1 4.028 12c0-.968.786-1.754 1.754-1.754.463 0 .898.196 1.207.49 1.207-.883 2.878-1.43 4.744-1.487l.885-4.182a.342.342 0 0 1 .14-.197.35.35 0 0 1 .238-.042l2.906.617a1.214 1.214 0 0 1 1.108-.701zM9.25 12C8.561 12 8 12.562 8 13.25c0 .687.561 1.248 1.25 1.248.687 0 1.248-.561 1.248-1.249 0-.688-.561-1.249-1.249-1.249zm5.5 0c-.687 0-1.248.561-1.248 1.25 0 .687.561 1.248 1.249 1.248.688 0 1.249-.561 1.249-1.249 0-.687-.562-1.249-1.25-1.249zm-5.466 3.99a.327.327 0 0 0-.231.094.33.33 0 0 0 0 .463c.842.842 2.484.913 2.961.913.477 0 2.105-.056 2.961-.913a.361.361 0 0 0 .029-.463.33.33 0 0 0-.464 0c-.547.533-1.684.73-2.512.73-.828 0-1.979-.196-2.512-.73a.326.326 0 0 0-.232-.095z"/>
                            </svg>
                        </a>
                        <a href="https://signal.group/#CjQKIOSUTtxlhbumAKcRsthPFkxkTUrkWcX39bbN6njLEgAIEhCTNsR0KDuiehAXZnkt42v5" target="_blank" rel="noopener" aria-label="Signal" class="signal-link">
                            <img src="../../../images/Signal-Logo-Black.svg" alt="Signal" class="signal-logo signal-logo-light" loading="lazy" decoding="async">
                            <img src="../../../images/Signal-Logo-White.svg" alt="Signal" class="signal-logo signal-logo-dark" loading="lazy" decoding="async">
                        </a>
                    </div>

                    
                    <div class="footer-newsletter-inline">
                        <p class="newsletter-description">Mantente informado con las noticias de I2P:</p>
                        <form action="https://feedback.i2p.net/api/mailing-list/subscribe" method="POST" class="newsletter-form">
                            <input type="email" name="email" placeholder="Introduce tu correo electrónico" required>
                            <button type="submit">Suscribirse</button>
                        </form>
                    </div>
                </div>
            </div>

            <div class="footer-col">
                <h3>Enlaces Rápidos</h3>
                <ul>
                    <li><a href="../../../es/financial-support/">Donar</a></li>
                    <li><a href="../../../es/docs/overview/intro/">Introducción a I2P</a></li>
                </ul>
            </div>

            <div class="footer-col">
                <h3>Comunidad</h3>
                <ul>
                    <li><a href="../../../es/get-involved/">Participa</a></li>
                    <li><a href="../../../es/blog/">Blog</a></li>
                    <li><a href="http://i2pforum.net/" target="_blank" rel="noopener">Foros Oficiales</a></li>
                    <li><a href="../../../es/contact/">Contacto</a></li>
                </ul>
            </div>

            <div class="footer-col">
                <h3>Recursos</h3>
                <ul>
                    <li><a href="https://i2p-metrics.np-tokumei.net/" target="_blank" rel="noopener">Métricas de I2P</a></li>
                    <li><a href="../../../es/papers/">Investigación</a></li>
                    <li><a href="https://i2pgit.org/" target="_blank" rel="noopener">GitLab</a></li>
                    <li><a href="https://www.stormycloud.org/" target="_blank" rel="noopener">StormyCloud</a></li>
                </ul>
            </div>
        </div>

        <div class="footer-bottom">
            <p class="copyright">&copy; 2025 El Proyecto de Internet Invisible. Licenciado bajo Creative Commons.</p>
            <div class="footer-links">
                <a href="../../../es/privacy/">Privacidad</a>
                <a href="../../../es/terms/">Términos</a>
                <a href="../../../es/about/media/">Prensa</a>
            </div>
        </div>
    </div>
</footer>


    
    
<div class="modal-overlay" id="poll">
    <div class="modal-content poll-modal-content">
        <a href="#" class="modal-close" aria-label="Cerrar">
            <span aria-hidden="true">&times;</span>
        </a>

        <div class="modal-header">
            <h2>Encuesta de la comunidad</h2>
            <p class="modal-subtitle">Nos encantaría saber de ti</p>
        </div>

        <div class="modal-body">
            
            <iframe 
                id="poll-iframe"
                data-poll-id="2"
                data-api-url="https://feedback.i2p.net"
                frameborder="0"
                scrolling="no"
                style="width: 100%; border: none; min-height: 400px;">
            </iframe>
        </div>

        <div class="modal-footer">
            <p class="modal-disclaimer">
                Tu voto ayuda a dar forma al futuro de I2P.
            </p>
        </div>
    </div>
</div>


<script>
(function() {
    const iframe = document.getElementById('poll-iframe');
    if (!iframe) return;
    
    const hostname = window.location.hostname;
    let apiUrl = 'https://feedback.i2p.net';
    const pollId = iframe.getAttribute('data-poll-id') || '1';

    
    if (hostname.endsWith('.b32.i2p') || hostname.endsWith('.i2p')) {
        apiUrl = 'http://5kwyynf3eetgqa2nors6ctwo7doi7yu73k7uvypy5eqmm326zkiq.b32.i2p';
    }
    
    else if (hostname.endsWith('.onion')) {
        apiUrl = 'http://gfonxmohvarpmocsvllscsuszdu5rikipm6innvcwq4vpng7zzqmmfyd.onion';
    }

    
    const pollUrl = apiUrl + '/widgets/poll.html?poll_id=' + encodeURIComponent(pollId) + '&api_url=' + encodeURIComponent(apiUrl);
    iframe.src = pollUrl;
})();
</script>



    
    



    
    <script>
        (function () {
            'use strict';
            var hostname = window.location.hostname;
            var baseUrl;

            
            if (hostname.endsWith('.b32.i2p') || hostname.endsWith('.i2p')) {
                baseUrl = 'http://5kwyynf3eetgqa2nors6ctwo7doi7yu73k7uvypy5eqmm326zkiq.b32.i2p';
            } else if (hostname.endsWith('.onion')) {
                baseUrl = 'http://gfonxmohvarpmocsvllscsuszdu5rikipm6innvcwq4vpng7zzqmmfyd.onion';
            } else {
                baseUrl = 'https://feedback.i2p.net';
            }

            window.feedbackBaseUrl = baseUrl;

            
            document.querySelectorAll('[data-api-url]').forEach(function (widget) {
                widget.setAttribute('data-api-url', baseUrl);
            });

            
            document.write('<link rel="stylesheet" href="' + baseUrl + '/widgets/styles.css">');
            
        })();
    </script>

    

    
    
    

    

</body>

</html>
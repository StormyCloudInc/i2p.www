<!DOCTYPE html>
<html lang="es" data-theme="light">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <title>Túneles ECIES | I2P - El Proyecto Internet Invisible</title>

    <meta name="description" content="The Invisible Internet Project - A privacy-focused, anonymous network layer">
    <meta name="keywords" content="i2p, privacy, anonymity, dark net, encryption, security">

    
    <meta property="og:title" content="Túneles ECIES | I2P - El Proyecto Internet Invisible">
    <meta property="og:description" content="The Invisible Internet Project - A privacy-focused, anonymous network layer">
    <meta property="og:type" content="website">
    <meta property="og:url" content="/es/proposals/152-ecies-tunnels/">

    
    <link rel="icon" type="image/svg+xml" href="../../../images/favicon.svg">
    <link rel="icon" type="image/png" href="../../../images/i2plogo.png" sizes="32x32">

    
    
    
    
    <link rel="stylesheet" href="../../../css/main.min.be6880f32f5ff44e57579da7b11513b973319944ebe38748e3ac7f3268662d18.css" integrity="sha256-vmiA8y9f9E5XV52nsRUTuXMxmUTr44dI46x/MmhmLRg=">
    


    
</head>

<body>
    
    <input type="checkbox" id="theme-toggle-checkbox" class="theme-checkbox" aria-hidden="true">

    
<div class="site-banner" id="site-banner" data-banner-id="banner-3" role="alert" aria-live="polite">
    <div class="container">
        <div class="banner-content">
            <span class="banner-message">Sitio Beta I2P Ahora Activo - Reportar problemas por correo a stormycloud@mail.i2p</span>
            
        </div>
        
        <form method="GET" action="../../../api/banner/dismiss" style="display: inline;">
            <input type="hidden" name="id" value="banner-3">
            <button type="submit" class="banner-close" aria-label="Cerrar banner" title="Cerrar banner">
                <span aria-hidden="true">&times;</span>
            </button>
        </form>
        
    </div>
</div>


    <header class="site-header">
    <div class="container">
        <nav class="main-nav">
            <div class="nav-brand">
                <a href="../../../es/" class="logo-link">
                    <img src="../../../images/i2plogo_lightmode.svg" alt="I2P Logo" class="logo logo-light">
                    <img src="../../../images/i2plogo_darkmode.svg" alt="I2P Logo" class="logo logo-dark">
                </a>
            </div>

            
            <input type="checkbox" id="mobile-menu-checkbox" class="mobile-menu-checkbox"
                aria-label="Toggle navigation menu">
            <label for="mobile-menu-checkbox" class="mobile-menu-toggle" aria-label="Toggle navigation menu">
                <span class="hamburger"></span>
            </label>

            <div class="nav-menu">
                <ul class="nav-links">
                    <li class="nav-dropdown">
                        <a href="../../../es/about/" class="">Acerca de</a>
                        <ul class="dropdown-menu">
                            <li><a href="../../../es/about/">Resumen</a></li>
                            <li><a href="../../../es/papers/">Artículos de Investigación</a></li>
                            <li><a href="../../../es/about/media/">Prensa</a></li>
                            <li><a href="../../../es/contact/">Contáctanos</a></li>
                        </ul>
                    </li>
                    <li><a href="../../../es/docs/" class="">Documentos</a></li>
                    <li><a href="../../../es/downloads/" class="">Descargas</a></li>
                    <li><a href="../../../es/blog/" class="">Blog</a></li>
                    <li class="nav-dropdown">
                        <a href="../../../es/get-involved/" class="">Participa</a>
                        <ul class="dropdown-menu">
                            <li><a href="../../../es/get-involved/">Resumen</a></li>
                            <li><a href="../../../es/feedback/">Sugerencias de Funciones</a></li>
                        </ul>
                    </li>
                </ul>

                <div class="nav-actions">
                    
                    <div class="language-selector">
                        <button class="language-toggle" aria-label="Select language" title="Language">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none"
                                xmlns="http://www.w3.org/2000/svg">
                                <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2" />
                                <path
                                    d="M2 12h20M12 2a15.3 15.3 0 014 10 15.3 15.3 0 01-4 10 15.3 15.3 0 01-4-10 15.3 15.3 0 014-10z"
                                    stroke="currentColor" stroke-width="2" />
                            </svg>
                            <span class="current-lang">es</span>
                        </button>
                        <div class="language-dropdown">
                            
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../en/proposals/152-ecies-tunnels/"
                                class="lang-option">Inglés</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../es/proposals/152-ecies-tunnels/"
                                class="lang-option active">Español</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../ko/proposals/152-ecies-tunnels/"
                                class="lang-option">Coreano</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../zh/proposals/152-ecies-tunnels/"
                                class="lang-option">Chino</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../ru/proposals/152-ecies-tunnels/"
                                class="lang-option">Ruso</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../cs/proposals/152-ecies-tunnels/"
                                class="lang-option">Checo</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../de/proposals/152-ecies-tunnels/"
                                class="lang-option">Alemán</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../fr/proposals/152-ecies-tunnels/"
                                class="lang-option">Francés</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../tr/proposals/152-ecies-tunnels/"
                                class="lang-option">Turco</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../vi/proposals/152-ecies-tunnels/"
                                class="lang-option">Vietnamita</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../hi/proposals/152-ecies-tunnels/"
                                class="lang-option">Hindi</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../ar/proposals/152-ecies-tunnels/"
                                class="lang-option">Árabe</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../pt/proposals/152-ecies-tunnels/"
                                class="lang-option">Portugués</a>
                            
                            
                        </div>
                    </div>

                    
                    <label for="theme-toggle-checkbox" class="theme-toggle" aria-label="Toggle dark mode"
                        title="Toggle theme">
                        <svg class="sun-icon" width="20" height="20" viewBox="0 0 20 20" fill="none"
                            xmlns="http://www.w3.org/2000/svg">
                            <circle cx="10" cy="10" r="4" stroke="currentColor" stroke-width="2" />
                            <path
                                d="M10 2V4M10 16V18M18 10H16M4 10H2M15.657 4.343L14.243 5.757M5.757 14.243L4.343 15.657M15.657 15.657L14.243 14.243M5.757 5.757L4.343 4.343"
                                stroke="currentColor" stroke-width="2" stroke-linecap="round" />
                        </svg>
                        <svg class="moon-icon" width="20" height="20" viewBox="0 0 20 20" fill="none"
                            xmlns="http://www.w3.org/2000/svg">
                            <path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"
                                stroke="currentColor" stroke-width="2" stroke-linejoin="round" />
                        </svg>
                    </label>

                    
                    <a href="../../../es/financial-support/" class="btn btn-primary" id="donate-btn">Donate</a>

                    
                    <a href="../../../es/downloads/" class="btn btn-primary">Obtener I2P</a>
                </div>
            </div>
        </nav>
    </div>
</header>

    <main id="main-content">
        



<div class="proposals-page">
    <div class="container">
        
        <nav class="breadcrumbs">
            <a href="../../../es/">Home</a>
            <span class="separator">/</span>
            <a href="../../../es/proposals/">Proposals</a>
            <span class="separator">/</span>
            <span class="current">Túneles ECIES</span>
        </nav>

        
<div class="translation-disclaimer" role="note">
    <span class="disclaimer-message">Esta traducción fue generada mediante aprendizaje automático y puede no ser 100% precisa.</span>
    
    
    <a href="../../../en/proposals/152-ecies-tunnels/" class="disclaimer-link">Ver versión en inglés</a>
    
</div>



        
        <header class="proposal-header">
            <div class="proposal-title-section">
                <h1 class="proposal-title">Túneles ECIES</h1>
                <div class="proposal-number">Proposal 152</div>
            </div>

            
            <div class="proposal-meta-box">
                <div class="proposal-status status-cerrado">
                    Cerrado
                </div>

                
                <div class="proposal-info-grid">
                    
                    <div class="info-item">
                        <span class="info-label">Author</span>
                        <span class="info-value">chisana, zzz, orignal</span>
                    </div>
                    

                    
                    <div class="info-item">
                        <span class="info-label">Created</span>
                        <span class="info-value">2019-07-04</span>
                    </div>
                    

                    
                    <div class="info-item">
                        <span class="info-label">Last Updated</span>
                        <span class="info-value">2025-03-05</span>
                    </div>
                    

                    
                    <div class="info-item">
                        <span class="info-label">Target Version</span>
                        <span class="info-value">0.9.48</span>
                    </div>
                    

                    
                    <div class="info-item">
                        <span class="info-label">Implemented In</span>
                        <span class="info-value">0.9.48</span>
                    </div>
                    
                </div>

                
                
            </div>
        </header>

        
        <div class="proposal-layout proposal-layout--with-toc">
            
            
            <aside class="proposal-toc-sidebar">
                <nav class="toc-nav">
                    <div class="toc-header">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                            <path d="M4 6h16M4 12h16M4 18h16" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                        </svg>
                        On This Page
                    </div>
                    <div class="toc-content">
                        <nav id="TableOfContents">
  <ul>
    <li><a href="#nota">Nota</a></li>
    <li><a href="#descripción-general">Descripción general</a>
      <ul>
        <li><a href="#cryptographic-primitives">Cryptographic Primitives</a></li>
        <li><a href="#goals">Goals</a></li>
        <li><a href="#primitivas-criptográficas">Primitivas Criptográficas</a></li>
      </ul>
    </li>
    <li><a href="#threat-model">Threat Model</a>
      <ul>
        <li><a href="#objetivos">Objetivos</a></li>
        <li><a href="#no-objetivos">No-Objetivos</a></li>
      </ul>
    </li>
    <li><a href="#design">Design</a>
      <ul>
        <li><a href="#noise-protocol-framework">Noise Protocol Framework</a></li>
        <li><a href="#objetivos-de-diseño">Objetivos de Diseño</a></li>
        <li><a href="#ataques-de-etiquetado">Ataques de Etiquetado</a></li>
        <li><a href="#reply-encryption">Reply encryption</a></li>
        <li><a href="#marco-de-protocolo-noise">Marco de Protocolo Noise</a></li>
      </ul>
    </li>
    <li><a href="#specification">Specification</a>
      <ul>
        <li><a href="#build-request-records">Build Request Records</a></li>
        <li><a href="#patrones-de-handshake">Patrones de Handshake</a></li>
        <li><a href="#cifrado-de-solicitudes">Cifrado de solicitudes</a></li>
        <li><a href="#cifrado-de-respuesta">Cifrado de respuesta</a></li>
        <li><a href="#justificación">Justificación</a></li>
        <li><a href="#reply-record-encryption-ecies">Reply Record Encryption (ECIES)</a></li>
        <li><a href="#registros-de-solicitud-de-construcción">Registros de Solicitud de Construcción</a></li>
        <li><a href="#security-analysis">Security Analysis</a></li>
      </ul>
    </li>
    <li><a href="#modelo-de-amenazas">Modelo de Amenazas</a></li>
    <li><a href="#implementation-notes">Implementation Notes</a></li>
    <li><a href="#issues">Issues</a></li>
    <li><a href="#diseño">Diseño</a></li>
  </ul>
</nav>
                    </div>
                </nav>
            </aside>
            

            
            <div class="proposal-main">
                <article class="proposal-content">
                    <h2 id="nota">Nota</h2>
<p>Despliegue de red y pruebas en progreso. Sujeto a revisiones menores. Ver <a href="../../../es/docs/specs/implementation/">SPEC</a>
 para la especificación oficial.</p>
<h2 id="descripción-general">Descripción general</h2>
<p>Este documento propone cambios al cifrado de mensajes Tunnel Build utilizando primitivas criptográficas introducidas por <a href="../../../es/docs/specs/ecies/">ECIES-X25519</a>
. Es una parte de la propuesta general <a href="../../../es/proposals/156-ecies-routers">Proposal 156</a>
 para convertir los routers de claves ElGamal a ECIES-X25519.</p>
<p>Para los propósitos de transicionar la red de ElGamal + AES256 a ECIES + ChaCha20, son necesarios túneles con routers ElGamal y ECIES mixtos. Se proporcionan especificaciones para manejar saltos de túnel mixtos. No se realizarán cambios al formato, procesamiento o cifrado de los saltos ElGamal.</p>
<p>Los creadores de túneles ElGamal necesitarán crear pares de claves X25519 efímeros por salto, y seguir esta especificación para crear túneles que contengan saltos ECIES.</p>
<p>Esta propuesta especifica los cambios necesarios para la construcción de túneles ECIES-X25519. Para una descripción general de todos los cambios requeridos para routers ECIES, consulte la propuesta 156 <a href="../../../es/proposals/156-ecies-routers">Proposal 156</a>
.</p>
<p>Esta propuesta mantiene el mismo tamaño para los registros de construcción de tunnel, según se requiere para compatibilidad. Registros de construcción y mensajes más pequeños se implementarán más adelante - ver <a href="../../../es/proposals/157-new-tbm">Propuesta 157</a>
.</p>
<h3 id="cryptographic-primitives">Cryptographic Primitives</h3>
<p>No se introducen nuevas primitivas criptográficas. Las primitivas requeridas para implementar esta propuesta son:</p>
<ul>
<li>AES-256-CBC como en <a href="../../../es/docs/specs/cryptography/">Cryptography</a>
</li>
<li>Funciones STREAM ChaCha20/Poly1305:
ENCRYPT(k, n, plaintext, ad) y DECRYPT(k, n, ciphertext, ad) - como en <a href="../../../es/docs/specs/ntcp2/">NTCP2</a>
 <a href="../../../es/docs/specs/ecies/">ECIES-X25519</a>
 y <a href="https://tools.ietf.org/html/rfc7539">RFC-7539</a>
</li>
<li>Funciones X25519 DH - como en <a href="../../../es/docs/specs/ntcp2/">NTCP2</a>
 y <a href="../../../es/docs/specs/ecies/">ECIES-X25519</a>
</li>
<li>HKDF(salt, ikm, info, n) - como en <a href="../../../es/docs/specs/ntcp2/">NTCP2</a>
 y <a href="../../../es/docs/specs/ecies/">ECIES-X25519</a>
</li>
</ul>
<p>Otras funciones Noise definidas en otra parte:</p>
<ul>
<li>MixHash(d) - como en <a href="../../../es/docs/specs/ntcp2/">NTCP2</a>
 y <a href="../../../es/docs/specs/ecies/">ECIES-X25519</a>
</li>
<li>MixKey(d) - como en <a href="../../../es/docs/specs/ntcp2/">NTCP2</a>
 y <a href="../../../es/docs/specs/ecies/">ECIES-X25519</a>
</li>
</ul>
<h3 id="goals">Goals</h3>
<ul>
<li>Aumentar la velocidad de las operaciones criptográficas</li>
<li>Reemplazar ElGamal + AES256/CBC con primitivas ECIES para los BuildRequestRecords y BuildReplyRecords del túnel.</li>
<li>Sin cambios en el tamaño de los BuildRequestRecords y BuildReplyRecords cifrados (528 bytes) para compatibilidad</li>
<li>Sin nuevos mensajes I2NP</li>
<li>Mantener el tamaño del registro de construcción cifrado para compatibilidad</li>
<li>Agregar forward secrecy para los Tunnel Build Messages.</li>
<li>Agregar cifrado autenticado</li>
<li>Detectar saltos que reordenen BuildRequestRecords</li>
<li>Aumentar la resolución de la marca de tiempo para que el tamaño del filtro Bloom pueda reducirse</li>
<li>Agregar campo para expiración de túnel para que sean posibles tiempos de vida variables de túnel (solo túneles completamente ECIES)</li>
<li>Agregar campo de opciones extensible para características futuras</li>
<li>Reutilizar primitivas criptográficas existentes</li>
<li>Mejorar la seguridad de los mensajes de construcción de túnel donde sea posible manteniendo compatibilidad</li>
<li>Soportar túneles con peers mixtos ElGamal/ECIES</li>
<li>Mejorar las defensas contra ataques de &ldquo;tagging&rdquo; en mensajes de construcción</li>
<li>Los saltos no necesitan conocer el tipo de cifrado del siguiente salto antes de procesar el mensaje de construcción,
ya que pueden no tener el RI del siguiente salto en ese momento</li>
<li>Maximizar compatibilidad con la red actual</li>
<li>Sin cambios en el cifrado AES de solicitud/respuesta de construcción de túnel para routers ElGamal</li>
<li>Sin cambios en el cifrado de &ldquo;capa&rdquo; AES del túnel, para eso ver <a href="../../../es/proposals/153-chacha20-layer-encryption">Propuesta 153</a>
</li>
<li>Continuar soportando tanto TBM/TBRM de 8 registros como VTBM/VTBRM de tamaño variable</li>
<li>No requerir actualización de &ldquo;día bandera&rdquo; para toda la red</li>
</ul>
<h3 id="primitivas-criptográficas">Primitivas Criptográficas</h3>
<ul>
<li>Rediseño completo de los mensajes de construcción de tunnel que requiere un &ldquo;flag day&rdquo;.</li>
<li>Reducción de los mensajes de construcción de tunnel (requiere todos los saltos ECIES y una nueva propuesta)</li>
<li>Uso de opciones de construcción de tunnel según se define en <a href="../../../es/proposals/143-build-message-options">Proposal 143</a>
, solo requerido para mensajes pequeños</li>
<li>Tunnels bidireccionales - para eso ver <a href="../../../es/proposals/119-bidirectional-tunnels">Proposal 119</a>
</li>
<li>Mensajes de construcción de tunnel más pequeños - para eso ver <a href="../../../es/proposals/157-new-tbm">Proposal 157</a>
</li>
</ul>
<h2 id="threat-model">Threat Model</h2>
<h3 id="objetivos">Objetivos</h3>
<ul>
<li>
<p>Ningún salto puede determinar el originador del túnel.</p>
</li>
<li>
<p>Los saltos intermedios no deben poder determinar la dirección del tunnel
o su posición en el tunnel.</p>
</li>
<li>
<p>Ningún salto puede leer contenidos de otros registros de solicitud o respuesta, excepto
por el hash de router truncado y la clave efímera para el siguiente salto</p>
</li>
<li>
<p>Ningún miembro del túnel de respuesta para construcción saliente puede leer ningún registro de respuesta.</p>
</li>
<li>
<p>Ningún miembro del túnel de salida para construcción de entrada puede leer ningún registro de solicitud,
excepto que OBEP puede ver el hash de router truncado y la clave efímera para IBGW</p>
</li>
</ul>
<h3 id="no-objetivos">No-Objetivos</h3>
<p>Un objetivo principal del diseño de construcción de túneles es hacer más difícil que los routers coludidos X e Y sepan que están en un mismo túnel. Si el router X está en el salto m y el router Y está en el salto m+1, obviamente lo sabrán. Pero si el router X está en el salto m y el router Y está en el salto m+n para n&gt;1, esto debería ser mucho más difícil.</p>
<p>Los ataques de etiquetado son donde el router X de salto intermedio altera el mensaje de construcción del túnel de tal manera que el router Y puede detectar la alteración cuando el mensaje de construcción llega allí. El objetivo es que cualquier mensaje alterado sea descartado por un router entre X e Y antes de que llegue al router Y. Para las modificaciones que no son descartadas antes del router Y, el creador del túnel debería detectar la corrupción en la respuesta y descartar el túnel.</p>
<p>Posibles ataques:</p>
<ul>
<li>Alterar un registro de construcción</li>
<li>Reemplazar un registro de construcción</li>
<li>Agregar o eliminar un registro de construcción</li>
<li>Reordenar los registros de construcción</li>
</ul>
<p>TODO: ¿El diseño actual previene todos estos ataques?</p>
<h2 id="design">Design</h2>
<h3 id="noise-protocol-framework">Noise Protocol Framework</h3>
<p>Esta propuesta proporciona los requisitos basados en el Noise Protocol Framework <a href="https://noiseprotocol.org/noise.html">NOISE</a>
 (Revisión 34, 2018-07-11). En la terminología de Noise, Alice es el iniciador y Bob es el respondedor.</p>
<p>Esta propuesta está basada en el protocolo Noise Noise_N_25519_ChaChaPoly_SHA256. Este protocolo Noise utiliza las siguientes primitivas:</p>
<ul>
<li>
<p>Patrón de Handshake Unidireccional: N
Alice no transmite su clave estática a Bob (N)</p>
</li>
<li>
<p>DH Function: X25519
X25519 DH con una longitud de clave de 32 bytes según se especifica en <a href="https://tools.ietf.org/html/rfc7748">RFC-7748</a>
.</p>
</li>
<li>
<p>Función de Cifrado: ChaChaPoly
AEAD_CHACHA20_POLY1305 como se especifica en <a href="https://tools.ietf.org/html/rfc7539">RFC-7539</a>
 sección 2.8.
Nonce de 12 bytes, con los primeros 4 bytes establecidos en cero.
Idéntico al de <a href="../../../es/docs/specs/ntcp2/">NTCP2</a>
.</p>
</li>
<li>
<p>Función Hash: SHA256
Hash estándar de 32 bytes, ya utilizado extensamente en I2P.</p>
</li>
</ul>
<h4 id="additions-to-the-framework">Additions to the Framework</h4>
<p>Ninguno.</p>
<h3 id="objetivos-de-diseño">Objetivos de Diseño</h3>
<p>Los handshakes utilizan patrones de handshake <a href="https://noiseprotocol.org/noise.html">Noise</a>
.</p>
<p>Se utiliza la siguiente asignación de letras:</p>
<ul>
<li>e = clave efímera de un solo uso</li>
<li>s = clave estática</li>
<li>p = carga útil del mensaje</li>
</ul>
<p>La solicitud de construcción es idéntica al patrón Noise N. Esto también es idéntico al primer mensaje (Solicitud de Sesión) en el patrón XK utilizado en <a href="../../../es/docs/specs/ntcp2/">NTCP2</a>
.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>&lt;- s
</span></span><span style="display:flex;"><span>  ...
</span></span><span style="display:flex;"><span>  e es p -&gt;
</span></span></code></pre></div><h3 id="ataques-de-etiquetado">Ataques de Etiquetado</h3>
<p>Los registros de solicitud de construcción son creados por el creador del tunnel y cifrados asimétricamente para el salto individual. Este cifrado asimétrico de los registros de solicitud actualmente es ElGamal como se define en <a href="../../../es/docs/specs/cryptography/">Criptografía</a>
 y contiene una suma de verificación SHA-256. Este diseño no es forward-secret.</p>
<p>El nuevo diseño utilizará el patrón Noise unidireccional &ldquo;N&rdquo; con ECIES-X25519 ephemeral-static DH, con un HKDF, y ChaCha20/Poly1305 AEAD para forward secrecy, integridad y autenticación. Alice es el solicitante de construcción del tunnel. Cada salto en el tunnel es un Bob.</p>
<p>(Propiedades de Seguridad de Payload)</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>N:                      Authentication   Confidentiality
</span></span><span style="display:flex;"><span>    -&gt; e, es                  0                2
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    Authentication: None (0).
</span></span><span style="display:flex;"><span>    This payload may have been sent by any party, including an active attacker.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    Confidentiality: 2.
</span></span><span style="display:flex;"><span>    Encryption to a known recipient, forward secrecy for sender compromise
</span></span><span style="display:flex;"><span>    only, vulnerable to replay.  This payload is encrypted based only on DHs
</span></span><span style="display:flex;"><span>    involving the recipient&#39;s static key pair.  If the recipient&#39;s static
</span></span><span style="display:flex;"><span>    private key is compromised, even at a later date, this payload can be
</span></span><span style="display:flex;"><span>    decrypted.  This message can also be replayed, since there&#39;s no ephemeral
</span></span><span style="display:flex;"><span>    contribution from the recipient.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    &#34;e&#34;: Alice generates a new ephemeral key pair and stores it in the e
</span></span><span style="display:flex;"><span>         variable, writes the ephemeral public key as cleartext into the
</span></span><span style="display:flex;"><span>         message buffer, and hashes the public key along with the old h to
</span></span><span style="display:flex;"><span>         derive a new h.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    &#34;es&#34;: A DH is performed between the Alice&#39;s ephemeral key pair and the
</span></span><span style="display:flex;"><span>          Bob&#39;s static key pair.  The result is hashed along with the old ck to
</span></span><span style="display:flex;"><span>          derive a new ck and k, and n is set to zero.
</span></span></code></pre></div><h3 id="reply-encryption">Reply encryption</h3>
<p>Los registros de respuesta de construcción son creados por el creador de los saltos y cifrados simétricamente al creador. Este cifrado simétrico de los registros de respuesta es actualmente AES con una suma de verificación SHA-256 antepuesta. y contiene una suma de verificación SHA-256. Este diseño no es forward-secret.</p>
<p>El nuevo diseño utilizará ChaCha20/Poly1305 AEAD para integridad y autenticación.</p>
<h3 id="marco-de-protocolo-noise">Marco de Protocolo Noise</h3>
<p>La clave pública efímera en la solicitud no necesita ser ofuscada con AES o Elligator2. El salto anterior es el único que puede verla, y ese salto sabe que el siguiente salto es ECIES.</p>
<p>Los registros de respuesta no necesitan cifrado asimétrico completo con otro DH.</p>
<h2 id="specification">Specification</h2>
<h3 id="build-request-records">Build Request Records</h3>
<p>Los BuildRequestRecords cifrados son de 528 bytes tanto para ElGamal como para ECIES, por compatibilidad.</p>
<h4 id="request-record-unencrypted-elgamal">Request Record Unencrypted (ElGamal)</h4>
<p>Para referencia, esta es la especificación actual del tunnel BuildRequestRecord para routers ElGamal, tomada de <a href="../../../es/docs/specs/i2np/">I2NP</a>
. Los datos sin cifrar se anteponen con un byte distinto de cero y el hash SHA-256 de los datos antes del cifrado, como se define en <a href="../../../es/docs/specs/cryptography/">Cryptography</a>
.</p>
<p>Todos los campos están en big-endian.</p>
<p>Tamaño sin cifrar: 222 bytes</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>bytes     0-3: tunnel ID to receive messages as, nonzero
</span></span><span style="display:flex;"><span>  bytes    4-35: local router identity hash
</span></span><span style="display:flex;"><span>  bytes   36-39: next tunnel ID, nonzero
</span></span><span style="display:flex;"><span>  bytes   40-71: next router identity hash
</span></span><span style="display:flex;"><span>  bytes  72-103: AES-256 tunnel layer key
</span></span><span style="display:flex;"><span>  bytes 104-135: AES-256 tunnel IV key
</span></span><span style="display:flex;"><span>  bytes 136-167: AES-256 reply key
</span></span><span style="display:flex;"><span>  bytes 168-183: AES-256 reply IV
</span></span><span style="display:flex;"><span>  byte      184: flags
</span></span><span style="display:flex;"><span>  bytes 185-188: request time (in hours since the epoch, rounded down)
</span></span><span style="display:flex;"><span>  bytes 189-192: next message ID
</span></span><span style="display:flex;"><span>  bytes 193-221: uninterpreted / random padding
</span></span></code></pre></div><h4 id="request-record-encrypted-elgamal">Request Record Encrypted (ElGamal)</h4>
<p>Para referencia, esta es la especificación actual del BuildRequestRecord del túnel para routers ElGamal, tomada de <a href="../../../es/docs/specs/i2np/">I2NP</a>
.</p>
<p>Tamaño cifrado: 528 bytes</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>bytes    0-15: Hop&#39;s truncated identity hash
</span></span><span style="display:flex;"><span>  bytes  16-528: ElGamal encrypted BuildRequestRecord
</span></span></code></pre></div><h4 id="request-record-unencrypted-ecies">Request Record Unencrypted (ECIES)</h4>
<p>Esta es la especificación propuesta del BuildRequestRecord de túnel para routers ECIES-X25519. Resumen de cambios:</p>
<ul>
<li>Eliminar hash de router de 32 bytes no utilizado</li>
<li>Cambiar tiempo de solicitud de horas a minutos</li>
<li>Agregar campo de expiración para tiempo de túnel variable futuro</li>
<li>Agregar más espacio para banderas</li>
<li>Agregar mapeo para opciones de construcción adicionales</li>
<li>La clave de respuesta AES-256 y el IV no se utilizan para el registro de respuesta del propio salto</li>
<li>El registro no cifrado es más largo porque hay menos sobrecarga de cifrado</li>
</ul>
<p>El registro de solicitud no contiene ninguna clave de respuesta ChaCha. Esas claves se derivan de una KDF. Ver más abajo.</p>
<p>Todos los campos están en big-endian.</p>
<p>Tamaño sin cifrar: 464 bytes</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>bytes     0-3: tunnel ID to receive messages as, nonzero
</span></span><span style="display:flex;"><span>  bytes     4-7: next tunnel ID, nonzero
</span></span><span style="display:flex;"><span>  bytes    8-39: next router identity hash
</span></span><span style="display:flex;"><span>  bytes   40-71: AES-256 tunnel layer key
</span></span><span style="display:flex;"><span>  bytes  72-103: AES-256 tunnel IV key
</span></span><span style="display:flex;"><span>  bytes 104-135: AES-256 reply key
</span></span><span style="display:flex;"><span>  bytes 136-151: AES-256 reply IV
</span></span><span style="display:flex;"><span>  byte      152: flags
</span></span><span style="display:flex;"><span>  bytes 153-155: more flags, unused, set to 0 for compatibility
</span></span><span style="display:flex;"><span>  bytes 156-159: request time (in minutes since the epoch, rounded down)
</span></span><span style="display:flex;"><span>  bytes 160-163: request expiration (in seconds since creation)
</span></span><span style="display:flex;"><span>  bytes 164-167: next message ID
</span></span><span style="display:flex;"><span>  bytes   168-x: tunnel build options (Mapping)
</span></span><span style="display:flex;"><span>  bytes     x-x: other data as implied by flags or options
</span></span><span style="display:flex;"><span>  bytes   x-463: random padding
</span></span></code></pre></div><p>El campo flags es el mismo que se define en <a href="../../../es/docs/specs/implementation/">Tunnel Creation</a>
 y contiene lo siguiente::</p>
<p>Orden de bits: 76543210 (el bit 7 es MSB)  bit 7: si está establecido, permitir mensajes de cualquiera  bit 6: si está establecido, permitir mensajes a cualquiera, y enviar la respuesta al</p>
<pre><code>    specified next hop in a Tunnel Build Reply Message
</code></pre>
<p>bits 5-0: Sin definir, debe establecerse en 0 para compatibilidad con opciones futuras</p>
<p>El bit 7 indica que el salto será un gateway de entrada (IBGW). El bit 6 indica que el salto será un endpoint de salida (OBEP). Si ningún bit está establecido, el salto será un participante intermedio. Ambos no pueden estar establecidos al mismo tiempo.</p>
<p>La expiración de la solicitud es para duración variable futura de tunnel. Por ahora, el único valor soportado es 600 (10 minutos).</p>
<p>Las opciones de construcción del tunnel es una estructura Mapping tal como se define en <a href="../../../es/docs/specs/common-structures/">Estructuras Comunes</a>
. Esto es para uso futuro. Actualmente no se han definido opciones. Si la estructura Mapping está vacía, esto son dos bytes 0x00 0x00. El tamaño máximo del Mapping (incluyendo el campo de longitud) es de 296 bytes, y el valor máximo del campo de longitud del Mapping es 294.</p>
<h4 id="request-record-encrypted-ecies">Request Record Encrypted (ECIES)</h4>
<p>Todos los campos son big-endian excepto la clave pública efímera que es little-endian.</p>
<p>Tamaño cifrado: 528 bytes</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>bytes    0-15: Hop&#39;s truncated identity hash
</span></span><span style="display:flex;"><span>  bytes   16-47: Sender&#39;s ephemeral X25519 public key
</span></span><span style="display:flex;"><span>  bytes  48-511: ChaCha20 encrypted BuildRequestRecord
</span></span><span style="display:flex;"><span>  bytes 512-527: Poly1305 MAC
</span></span></code></pre></div><h3 id="patrones-de-handshake">Patrones de Handshake</h3>
<p>Los BuildReplyRecords encriptados son de 528 bytes tanto para ElGamal como para ECIES, por compatibilidad.</p>
<h4 id="reply-record-unencrypted-elgamal">Reply Record Unencrypted (ElGamal)</h4>
<p>Las respuestas ElGamal están cifradas con AES.</p>
<p>Todos los campos están en big-endian.</p>
<p>Tamaño sin cifrar: 528 bytes</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>bytes   0-31: SHA-256 Hash of bytes 32-527
</span></span><span style="display:flex;"><span>  bytes 32-526: random data
</span></span><span style="display:flex;"><span>  byte     527: reply
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  total length: 528
</span></span></code></pre></div><h4 id="reply-record-unencrypted-ecies">Reply Record Unencrypted (ECIES)</h4>
<p>Esta es la especificación propuesta del BuildReplyRecord de túnel para routers ECIES-X25519. Resumen de cambios:</p>
<ul>
<li>Agregar mapeo para opciones de respuesta de construcción</li>
<li>El registro sin cifrar es más largo porque hay menos sobrecarga de cifrado</li>
</ul>
<p>Las respuestas ECIES están cifradas con ChaCha20/Poly1305.</p>
<p>Todos los campos están en big-endian.</p>
<p>Tamaño sin cifrar: 512 bytes</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>bytes    0-x: Tunnel Build Reply Options (Mapping)
</span></span><span style="display:flex;"><span>  bytes    x-x: other data as implied by options
</span></span><span style="display:flex;"><span>  bytes  x-510: Random padding
</span></span><span style="display:flex;"><span>  byte     511: Reply byte
</span></span></code></pre></div><p>Las opciones de respuesta de construcción de túnel es una estructura Mapping como se define en <a href="../../../es/docs/specs/common-structures/">Estructuras Comunes</a>
. Esto es para uso futuro. Actualmente no se definen opciones. Si la estructura Mapping está vacía, esto son dos bytes 0x00 0x00. El tamaño máximo del Mapping (incluyendo el campo de longitud) es 511 bytes, y el valor máximo del campo de longitud del Mapping es 509.</p>
<p>El byte de respuesta es uno de los siguientes valores según se define en <a href="../../../es/docs/specs/implementation/">Tunnel Creation</a>
 para evitar el fingerprinting:</p>
<ul>
<li>0x00 (aceptar)</li>
<li>30 (TUNNEL_REJECT_BANDWIDTH)</li>
</ul>
<h4 id="reply-record-encrypted-ecies">Reply Record Encrypted (ECIES)</h4>
<p>Tamaño cifrado: 528 bytes</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>bytes   0-511: ChaCha20 encrypted BuildReplyRecord
</span></span><span style="display:flex;"><span>  bytes 512-527: Poly1305 MAC
</span></span></code></pre></div><p>Después de la transición completa a registros ECIES, las reglas de relleno por rangos son las mismas que para los registros de solicitud.</p>
<h3 id="cifrado-de-solicitudes">Cifrado de solicitudes</h3>
<p>Los túneles mixtos están permitidos, y son necesarios, para la transición de ElGamal a ECIES. Durante el período de transición, un número creciente de routers tendrán claves bajo claves ECIES.</p>
<p>El preprocesamiento de criptografía simétrica se ejecutará de la misma manera:</p>
<ul>
<li>
<p>&ldquo;encryption&rdquo;:</p>
</li>
<li>
<p>cipher ejecutado en modo de descifrado</p>
</li>
<li>
<p>registros de solicitud descifrados preventivamente en preprocesamiento (ocultando registros de solicitud cifrados)</p>
</li>
<li>
<p>&ldquo;descifrado&rdquo;:</p>
</li>
<li>
<p>cipher ejecutado en modo de cifrado</p>
</li>
<li>
<p>registros de solicitud cifrados (revelando el siguiente registro de solicitud en texto plano) por saltos de participante</p>
</li>
<li>
<p>ChaCha20 no tiene &ldquo;modos&rdquo;, por lo que simplemente se ejecuta tres veces:</p>
</li>
<li>
<p>una vez en el preprocesamiento</p>
</li>
<li>
<p>una vez por el salto</p>
</li>
<li>
<p>una vez en el procesamiento de respuesta final</p>
</li>
</ul>
<p>Cuando se usan túneles mixtos, los creadores de túneles necesitarán basar el cifrado simétrico del BuildRequestRecord en el tipo de cifrado del salto actual y el anterior.</p>
<p>Cada salto utilizará su propio tipo de cifrado para cifrar BuildReplyRecords, y los otros registros en el VariableTunnelBuildMessage (VTBM).</p>
<p>En la ruta de respuesta, el endpoint (remitente) necesitará deshacer el <a href="https://en.wikipedia.org/wiki/Multiple_encryption">Multiple Encryption</a>
, usando la clave de respuesta de cada salto.</p>
<p>Como ejemplo aclaratorio, veamos un túnel de salida con ECIES rodeado por ElGamal:</p>
<ul>
<li>Remitente (OBGW) -&gt; ElGamal (H1) -&gt; ECIES (H2) -&gt; ElGamal (H3)</li>
</ul>
<p>Todos los BuildRequestRecords están en su estado cifrado (usando ElGamal o ECIES).</p>
<p>El cifrado AES256/CBC, cuando se utiliza, sigue siendo usado para cada registro, sin encadenamiento entre múltiples registros.</p>
<p>Del mismo modo, ChaCha20 se utilizará para cifrar cada registro, no transmitiendo a través de todo el VTBM.</p>
<p>Los registros de solicitud son preprocesados por el Sender (OBGW):</p>
<ul>
<li>
<p>El registro de H3 está &ldquo;cifrado&rdquo; usando:</p>
</li>
<li>
<p>Clave de respuesta de H2 (ChaCha20)</p>
</li>
<li>
<p>Clave de respuesta de H1 (AES256/CBC)</p>
</li>
<li>
<p>El registro de H2 está &ldquo;encriptado&rdquo; usando:</p>
</li>
<li>
<p>Clave de respuesta de H1 (AES256/CBC)</p>
</li>
<li>
<p>El registro de H1 sale sin cifrado simétrico</p>
</li>
</ul>
<p>Solo H2 verifica la bandera de cifrado de respuesta, y ve que está seguida por AES256/CBC.</p>
<p>Después de ser procesados por cada salto, los registros se encuentran en un estado &ldquo;descifrado&rdquo;:</p>
<ul>
<li>
<p>El registro de H3 es &ldquo;descifrado&rdquo; usando:</p>
</li>
<li>
<p>Clave de respuesta de H3 (AES256/CBC)</p>
</li>
<li>
<p>El registro de H2 es &ldquo;descifrado&rdquo; usando:</p>
</li>
<li>
<p>Clave de respuesta de H3 (AES256/CBC)</p>
</li>
<li>
<p>Clave de respuesta de H2 (ChaCha20-Poly1305)</p>
</li>
<li>
<p>El registro de H1 se &ldquo;descifra&rdquo; usando:</p>
</li>
<li>
<p>Clave de respuesta de H3 (AES256/CBC)</p>
</li>
<li>
<p>Clave de respuesta de H2 (ChaCha20)</p>
</li>
<li>
<p>Clave de respuesta de H1 (AES256/CBC)</p>
</li>
</ul>
<p>El creador del tunnel, también conocido como Inbound Endpoint (IBEP), postprocesa la respuesta:</p>
<ul>
<li>
<p>El registro de H3 está &ldquo;encriptado&rdquo; usando:</p>
</li>
<li>
<p>Clave de respuesta de H3 (AES256/CBC)</p>
</li>
<li>
<p>El registro de H2 está &ldquo;encriptado&rdquo; usando:</p>
</li>
<li>
<p>Clave de respuesta de H3 (AES256/CBC)</p>
</li>
<li>
<p>Clave de respuesta de H2 (ChaCha20-Poly1305)</p>
</li>
<li>
<p>El registro de H1 está &ldquo;encriptado&rdquo; usando:</p>
</li>
<li>
<p>Clave de respuesta de H3 (AES256/CBC)</p>
</li>
<li>
<p>Clave de respuesta de H2 (ChaCha20)</p>
</li>
<li>
<p>Clave de respuesta de H1 (AES256/CBC)</p>
</li>
</ul>
<h3 id="cifrado-de-respuesta">Cifrado de respuesta</h3>
<p>Estas claves se incluyen explícitamente en los ElGamal BuildRequestRecords. Para los ECIES BuildRequestRecords, se incluyen las claves de túnel y las claves de respuesta AES, pero las claves de respuesta ChaCha se derivan del intercambio DH. Consulta la <a href="../../../es/proposals/156-ecies-routers">Propuesta 156</a>
 para detalles sobre las claves ECIES estáticas del router.</p>
<p>A continuación se describe cómo derivar las claves transmitidas previamente en los registros de solicitud.</p>
<h4 id="kdf-for-initial-ck-and-h">KDF for Initial ck and h</h4>
<p>Esto es <a href="https://noiseprotocol.org/noise.html">NOISE</a>
 estándar para el patrón &ldquo;N&rdquo; con un nombre de protocolo estándar.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>This is the &#34;e&#34; message pattern:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  // Define protocol_name.
</span></span><span style="display:flex;"><span>  Set protocol_name = &#34;Noise_N_25519_ChaChaPoly_SHA256&#34;
</span></span><span style="display:flex;"><span>  (31 bytes, US-ASCII encoded, no NULL termination).
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  // Define Hash h = 32 bytes
</span></span><span style="display:flex;"><span>  // Pad to 32 bytes. Do NOT hash it, because it is not more than 32 bytes.
</span></span><span style="display:flex;"><span>  h = protocol_name || 0
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  Define ck = 32 byte chaining key. Copy the h data to ck.
</span></span><span style="display:flex;"><span>  Set chainKey = h
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  // MixHash(null prologue)
</span></span><span style="display:flex;"><span>  h = SHA256(h);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  // up until here, can all be precalculated by all routers.
</span></span></code></pre></div><h4 id="kdf-for-request-record">KDF for Request Record</h4>
<p>Los creadores de tunnel ElGamal generan un par de claves X25519 efímero para cada salto ECIES en el tunnel, y usan el esquema anterior para cifrar su BuildRequestRecord. Los creadores de tunnel ElGamal usarán el esquema anterior a esta especificación para cifrar hacia saltos ElGamal.</p>
<p>Los creadores de túneles ECIES necesitarán encriptar a la clave pública de cada salto ElGamal usando el esquema definido en <a href="../../../es/docs/specs/implementation/">Tunnel Creation</a>
. Los creadores de túneles ECIES usarán el esquema anterior para encriptar a los saltos ECIES.</p>
<p>Esto significa que los saltos de túnel solo verán registros cifrados de su mismo tipo de cifrado.</p>
<p>Para creadores de túneles ElGamal y ECIES, generarán pares de claves efímeras X25519 únicos por salto para cifrar hacia saltos ECIES.</p>
<p><strong>IMPORTANTE</strong>: Las claves efímeras deben ser únicas por salto ECIES y por registro de construcción. No usar claves únicas abre un vector de ataque para que los saltos que colaboran puedan confirmar que están en el mismo túnel.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>// Each hop&#39;s X25519 static keypair (hesk, hepk) from the Router Identity
</span></span><span style="display:flex;"><span>  hesk = GENERATE_PRIVATE()
</span></span><span style="display:flex;"><span>  hepk = DERIVE_PUBLIC(hesk)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  // MixHash(hepk)
</span></span><span style="display:flex;"><span>  // || below means append
</span></span><span style="display:flex;"><span>  h = SHA256(h || hepk);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  // up until here, can all be precalculated by each router
</span></span><span style="display:flex;"><span>  // for all incoming build requests
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  // Sender generates an X25519 ephemeral keypair per ECIES hop in the VTBM (sesk, sepk)
</span></span><span style="display:flex;"><span>  sesk = GENERATE_PRIVATE()
</span></span><span style="display:flex;"><span>  sepk = DERIVE_PUBLIC(sesk)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  // MixHash(sepk)
</span></span><span style="display:flex;"><span>  h = SHA256(h || sepk);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  End of &#34;e&#34; message pattern.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  This is the &#34;es&#34; message pattern:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  // Noise es
</span></span><span style="display:flex;"><span>  // Sender performs an X25519 DH with Hop&#39;s static public key.
</span></span><span style="display:flex;"><span>  // Each Hop, finds the record w/ their truncated identity hash,
</span></span><span style="display:flex;"><span>  // and extracts the Sender&#39;s ephemeral key preceding the encrypted record.
</span></span><span style="display:flex;"><span>  sharedSecret = DH(sesk, hepk) = DH(hesk, sepk)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  // MixKey(DH())
</span></span><span style="display:flex;"><span>  //[chainKey, k] = MixKey(sharedSecret)
</span></span><span style="display:flex;"><span>  // ChaChaPoly parameters to encrypt/decrypt
</span></span><span style="display:flex;"><span>  keydata = HKDF(chainKey, sharedSecret, &#34;&#34;, 64)
</span></span><span style="display:flex;"><span>  // Save for Reply Record KDF
</span></span><span style="display:flex;"><span>  chainKey = keydata[0:31]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  // AEAD parameters
</span></span><span style="display:flex;"><span>  k = keydata[32:63]
</span></span><span style="display:flex;"><span>  n = 0
</span></span><span style="display:flex;"><span>  plaintext = 464 byte build request record
</span></span><span style="display:flex;"><span>  ad = h
</span></span><span style="display:flex;"><span>  ciphertext = ENCRYPT(k, n, plaintext, ad)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  End of &#34;es&#34; message pattern.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  // MixHash(ciphertext)
</span></span><span style="display:flex;"><span>  // Save for Reply Record KDF
</span></span><span style="display:flex;"><span>  h = SHA256(h || ciphertext)
</span></span></code></pre></div><p><code>replyKey</code>, <code>layerKey</code> y <code>layerIV</code> aún deben incluirse dentro de los registros ElGamal, y pueden generarse aleatoriamente.</p>
<h3 id="justificación">Justificación</h3>
<p>Como se define en <a href="../../../es/docs/specs/implementation/">Tunnel Creation</a>
. No hay cambios en el cifrado para los saltos ElGamal.</p>
<h3 id="reply-record-encryption-ecies">Reply Record Encryption (ECIES)</h3>
<p>El registro de respuesta está cifrado con ChaCha20/Poly1305.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>// AEAD parameters
</span></span><span style="display:flex;"><span>  k = chainkey from build request
</span></span><span style="display:flex;"><span>  n = 0
</span></span><span style="display:flex;"><span>  plaintext = 512 byte build reply record
</span></span><span style="display:flex;"><span>  ad = h from build request
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  ciphertext = ENCRYPT(k, n, plaintext, ad)
</span></span></code></pre></div><h3 id="registros-de-solicitud-de-construcción">Registros de Solicitud de Construcción</h3>
<p>Como se define en <a href="../../../es/docs/specs/implementation/">Tunnel Creation</a>
. No hay cambios en el cifrado para los saltos ElGamal.</p>
<h3 id="security-analysis">Security Analysis</h3>
<p>ElGamal no proporciona secreto hacia adelante para los Mensajes de Construcción de Túnel.</p>
<p>AES256/CBC está en una situación ligeramente mejor, siendo vulnerable únicamente a un debilitamiento teórico de un ataque de <code>biclique</code> con texto plano conocido.</p>
<p>El único ataque práctico conocido contra AES256/CBC es un ataque de oráculo de relleno, cuando el IV es conocido por el atacante.</p>
<p>Un atacante necesitaría romper la encriptación ElGamal del siguiente salto para obtener la información de clave AES256/CBC (clave de respuesta e IV).</p>
<p>ElGamal es significativamente más intensivo en CPU que ECIES, lo que conduce a un potencial agotamiento de recursos.</p>
<p>ECIES, utilizado con nuevas claves efímeras por-BuildRequestRecord o VariableTunnelBuildMessage, proporciona confidencialidad hacia adelante.</p>
<p>ChaCha20Poly1305 proporciona cifrado AEAD, permitiendo que el destinatario verifique la integridad del mensaje antes de intentar el descifrado.</p>
<h2 id="modelo-de-amenazas">Modelo de Amenazas</h2>
<p>Este diseño maximiza la reutilización de primitivas criptográficas, protocolos y código existentes. Este diseño minimiza el riesgo.</p>
<h2 id="implementation-notes">Implementation Notes</h2>
<ul>
<li>Los routers más antiguos no verifican el tipo de cifrado del salto y enviarán
registros cifrados con ElGamal. Algunos routers recientes tienen errores y enviarán
varios tipos de registros mal formados. Los implementadores deberían detectar y
rechazar estos registros antes de la operación DH si es posible, para reducir
el uso de CPU.</li>
</ul>
<h2 id="issues">Issues</h2>
<h2 id="diseño">Diseño</h2>
<p>Ver <a href="../../../es/proposals/156-ecies-routers">Propuesta 156</a>
.</p>

                </article>

                
                <nav class="page-nav">
                    <a href="../../../es/proposals/" class="page-nav-link">
                        ← Back to Proposals
                    </a>
                    
                    
                    
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                            
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                    <a href="../../../proposals/152-ecies-tunnels.txt" class="page-nav-link" download>
                        Download Source (.txt)
                    </a>
                    
                </nav>
            </div>
        </div>
    </div>
</div>

<style>
.proposals-page {
    min-height: 100vh;
    padding: var(--spacing-xl) 0;
}

.breadcrumbs {
    display: flex;
    align-items: center;
    gap: var(--spacing-xs);
    margin-bottom: var(--spacing-lg);
    font-size: 0.875rem;
    color: var(--color-text-muted);
}

.breadcrumbs a {
    color: var(--color-text-muted);
    text-decoration: none;
    transition: color var(--transition-fast);
}

.breadcrumbs a:hover {
    color: var(--color-primary);
}

.separator {
    color: var(--color-border);
}

.current {
    color: var(--color-text);
}

 
.translation-disclaimer {
    background: #fef3c7;
    border: 1px solid #f59e0b;
    border-radius: var(--radius-md);
    padding: var(--spacing-md);
    margin-bottom: var(--spacing-lg);
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: var(--spacing-md);
    flex-wrap: wrap;
}

.dark .translation-disclaimer {
    background: #78350f;
    border-color: #d97706;
}

.disclaimer-message {
    color: #92400e;
    font-size: 0.875rem;
}

.dark .disclaimer-message {
    color: #fde047;
}

.disclaimer-link {
    color: #92400e;
    font-weight: 600;
    text-decoration: underline;
    white-space: nowrap;
}

.dark .disclaimer-link {
    color: #fde047;
}

 
.proposal-header {
    margin-bottom: var(--spacing-2xl);
}

.proposal-title-section {
    margin-bottom: var(--spacing-lg);
}

.proposal-title {
    font-size: 2.5rem;
    margin: 0 0 var(--spacing-sm) 0;
    color: var(--color-text);
}

.proposal-number {
    font-size: 0.875rem;
    color: var(--color-text-muted);
    font-weight: 600;
}

 
.proposal-meta-box {
    background: var(--color-bg-secondary);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-lg);
    padding: var(--spacing-lg);
}

.proposal-status {
    display: inline-block;
    padding: var(--spacing-xs) var(--spacing-md);
    border-radius: var(--radius-md);
    font-weight: 600;
    font-size: 0.875rem;
    margin-bottom: var(--spacing-md);
    text-transform: uppercase;
    letter-spacing: 0.05em;
}

 
.status-open {
    background: #dbeafe;
    color: #0369a1;
}

.dark .status-open {
    background: #0c4a6e;
    color: #7dd3fc;
}

.status-accepted {
    background: #dbeafe;
    color: #0369a1;
}

.dark .status-accepted {
    background: #0c4a6e;
    color: #7dd3fc;
}

.status-finished {
    background: #dcfce7;
    color: #15803d;
}

.dark .status-finished {
    background: #164e63;
    color: #86efac;
}

.status-closed {
    background: #dcfce7;
    color: #15803d;
}

.dark .status-closed {
    background: #164e63;
    color: #86efac;
}

.status-rejected {
    background: #fee2e2;
    color: #991b1b;
}

.dark .status-rejected {
    background: #7f1d1d;
    color: #fca5a5;
}

.status-draft,
.status-needs-revision,
.status-dead,
.status-needs-research {
    background: #fef3c7;
    color: #92400e;
}

.dark .status-draft,
.dark .status-needs-revision,
.dark .status-dead,
.dark .status-needs-research {
    background: #78350f;
    color: #fde047;
}

.status-meta,
.status-informational,
.status-reserve {
    background: #e9d5ff;
    color: #6b21a8;
}

.dark .status-meta,
.dark .status-informational,
.dark .status-reserve {
    background: #581c87;
    color: #e879f9;
}

 
.proposal-info-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: var(--spacing-md);
    margin-bottom: var(--spacing-lg);
}

.info-item {
    display: flex;
    flex-direction: column;
    gap: var(--spacing-xs);
}

.info-label {
    font-size: 0.75rem;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    color: var(--color-text-muted);
}

.info-value {
    font-size: 0.9375rem;
    color: var(--color-text);
    font-weight: 500;
}

 
.proposal-relationships {
    border-top: 1px solid var(--color-border);
    padding-top: var(--spacing-md);
}

.relationship {
    display: flex;
    gap: var(--spacing-md);
    margin-bottom: var(--spacing-sm);
}

.relationship:last-child {
    margin-bottom: 0;
}

.relationship-label {
    font-weight: 600;
    color: var(--color-text-muted);
    min-width: 120px;
}

.relationship-value {
    color: var(--color-text);
}

 
.proposal-layout {
    display: block;
}

.proposal-layout--with-toc {
    display: grid;
    grid-template-columns: 260px 1fr;
    gap: var(--spacing-2xl);
    align-items: start;
}

 
.proposal-toc-sidebar {
    position: sticky;
    top: 100px;
    max-height: calc(100vh - 120px);
    overflow-y: auto;
}

.toc-nav {
    background: var(--color-bg-secondary);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-lg);
    padding: var(--spacing-md);
}

.toc-header {
    display: flex;
    align-items: center;
    gap: var(--spacing-sm);
    font-weight: 700;
    font-size: 0.875rem;
    color: var(--color-text);
    padding-bottom: var(--spacing-md);
    margin-bottom: var(--spacing-md);
    border-bottom: 1px solid var(--color-border);
}

.toc-content {
    max-height: calc(100vh - 250px);
    overflow-y: auto;
}

.toc-content::-webkit-scrollbar {
    width: 4px;
}

.toc-content::-webkit-scrollbar-track {
    background: transparent;
}

.toc-content::-webkit-scrollbar-thumb {
    background: var(--color-border);
    border-radius: 2px;
}

.toc-content::-webkit-scrollbar-thumb:hover {
    background: var(--color-text-muted);
}

.toc-nav ul {
    list-style: none;
    padding-left: 0;
    margin: 0;
}

.toc-nav li {
    margin-bottom: 0.25rem;
}

.toc-nav ul ul {
    padding-left: var(--spacing-md);
    margin-top: 0.25rem;
}

.toc-nav a {
    color: var(--color-text-secondary);
    text-decoration: none;
    font-size: 0.8125rem;
    display: block;
    padding: 0.25rem 0.5rem;
    border-radius: var(--radius-sm);
    transition: all var(--transition-fast);
    line-height: 1.4;
}

.toc-nav a:hover {
    color: var(--color-primary);
    background: var(--color-bg-tertiary);
}

 
.proposal-main {
    min-width: 0;
}

 
.proposal-content {
    line-height: 1.8;
    color: var(--color-text);
    max-width: 900px;
}

.proposal-content h2 {
    margin-top: var(--spacing-2xl);
    margin-bottom: var(--spacing-md);
    font-size: 1.75rem;
    scroll-margin-top: 100px;
}

.proposal-content h3 {
    margin-top: var(--spacing-xl);
    margin-bottom: var(--spacing-sm);
    font-size: 1.375rem;
    scroll-margin-top: 100px;
}

.proposal-content h4 {
    margin-top: var(--spacing-lg);
    margin-bottom: var(--spacing-xs);
    font-size: 1.125rem;
    scroll-margin-top: 100px;
}

.proposal-content p {
    margin-bottom: var(--spacing-md);
}

.proposal-content ul,
.proposal-content ol {
    margin-bottom: var(--spacing-md);
    padding-left: var(--spacing-xl);
}

.proposal-content li {
    margin-bottom: var(--spacing-xs);
}

.proposal-content code {
    background: var(--color-bg-secondary);
    padding: 0.125rem 0.375rem;
    border-radius: var(--radius-sm);
    font-size: 0.875em;
    font-family: 'Courier New', monospace;
}

.proposal-content pre {
    background: var(--color-bg-secondary);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-md);
    padding: var(--spacing-md);
    overflow-x: auto;
    margin-bottom: var(--spacing-md);
    font-size: 0.875rem;
}

.proposal-content pre code {
    background: none;
    padding: 0;
}

.proposal-content blockquote {
    border-left: 4px solid var(--color-primary);
    padding-left: var(--spacing-md);
    margin-left: 0;
    margin-bottom: var(--spacing-md);
    font-style: italic;
    color: var(--color-text-secondary);
}

.proposal-content a {
    color: var(--color-primary);
    text-decoration: none;
    border-bottom: 1px solid transparent;
    transition: border-color var(--transition-fast);
}

.proposal-content a:hover {
    border-bottom-color: var(--color-primary);
}

.proposal-content table {
    width: 100%;
    border-collapse: collapse;
    margin-bottom: var(--spacing-md);
}

.proposal-content table th {
    background: var(--color-bg-secondary);
    padding: var(--spacing-sm);
    text-align: left;
    font-weight: 600;
    border-bottom: 2px solid var(--color-border);
}

.proposal-content table td {
    padding: var(--spacing-sm);
    border-bottom: 1px solid var(--color-border);
}

.proposal-content img {
    max-width: 100%;
    height: auto;
    border-radius: var(--radius-md);
    border: 1px solid var(--color-border);
    margin: var(--spacing-lg) 0;
    display: block;
}

 
.page-nav {
    margin-top: var(--spacing-2xl);
    padding-top: var(--spacing-xl);
    border-top: 1px solid var(--color-border);
    display: flex;
    gap: var(--spacing-md);
    flex-wrap: wrap;
}

.page-nav-link {
    display: inline-block;
    padding: var(--spacing-md) var(--spacing-lg);
    background: var(--color-bg-secondary);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-md);
    color: var(--color-text);
    text-decoration: none;
    transition: all var(--transition-fast);
}

.page-nav-link:hover {
    border-color: var(--color-primary);
    color: var(--color-primary);
}

 
@media (max-width: 1024px) {
    .proposal-layout--with-toc {
        grid-template-columns: 1fr;
    }

    .proposal-toc-sidebar {
        position: static;
        max-height: none;
        margin-bottom: var(--spacing-xl);
    }

    .toc-content {
        max-height: 300px;
    }
}

@media (max-width: 768px) {
    .proposal-title {
        font-size: 1.75rem;
    }

    .proposal-info-grid {
        grid-template-columns: 1fr;
    }
}
</style>



<script>
document.addEventListener('DOMContentLoaded', function() {
    const tocLinks = document.querySelectorAll('.toc-nav a');
    const headings = [];

    tocLinks.forEach(link => {
        const href = link.getAttribute('href');
        if (href && href.startsWith('#')) {
            const heading = document.getElementById(href.slice(1));
            if (heading) {
                headings.push({ element: heading, link: link });
            }
        }
    });

    function updateActiveLink() {
        const scrollPos = window.scrollY + 120;
        let activeIndex = 0;

        for (let i = 0; i < headings.length; i++) {
            if (headings[i].element.offsetTop <= scrollPos) {
                activeIndex = i;
            }
        }

        tocLinks.forEach(link => link.classList.remove('active'));
        if (headings[activeIndex]) {
            headings[activeIndex].link.classList.add('active');
        }
    }

    window.addEventListener('scroll', updateActiveLink);
    updateActiveLink();
});
</script>
<style>
.toc-nav a.active {
    color: var(--color-primary);
    background: var(--color-bg-tertiary);
    font-weight: 600;
}
</style>



    </main>

    <footer class="site-footer">
    <div class="container">
        <div class="footer-grid">
            <div class="footer-col footer-brand">
                <img src="../../../images/i2plogo_lightmode.svg" alt="I2P Logo" class="footer-logo logo-light" loading="lazy" decoding="async">
                <img src="../../../images/i2plogo_darkmode.svg" alt="I2P Logo" class="footer-logo logo-dark" loading="lazy" decoding="async">
                <p class="footer-tagline">Privacy. Security. Freedom.</p>
                <p class="footer-description">The Invisible Internet Project - A privacy-focused, anonymous network layer</p>

                <div class="footer-social-newsletter">
                    <div class="social-links">
                        <a href="https://mastodon.social/@i2p" target="_blank" rel="noopener" aria-label="Mastodon">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M21.327 8.566c0-4.339-2.843-5.61-2.843-5.61-1.433-.658-3.894-.935-6.451-.956h-.063c-2.557.021-5.016.298-6.45.956 0 0-2.843 1.272-2.843 5.61 0 .993-.019 2.181.012 3.441.103 4.243.778 8.425 4.701 9.463 1.809.479 3.362.579 4.612.51 2.268-.126 3.541-.809 3.541-.809l-.075-1.646s-1.621.511-3.441.449c-1.804-.062-3.707-.194-3.999-2.409a4.523 4.523 0 0 1-.04-.621s1.77.433 4.014.536c1.372.063 2.658-.08 3.965-.236 2.506-.299 4.688-1.843 4.962-3.254.434-2.223.398-5.424.398-5.424zm-3.353 5.59h-2.081V9.057c0-1.075-.452-1.62-1.357-1.62-1 0-1.501.647-1.501 1.927v2.791h-2.069V9.364c0-1.28-.501-1.927-1.502-1.927-.905 0-1.357.546-1.357 1.62v5.099H6.026V8.903c0-1.074.273-1.927.823-2.558.566-.631 1.307-.955 2.228-.955 1.065 0 1.872.409 2.405 1.228l.518.869.519-.869c.533-.819 1.34-1.228 2.405-1.228.92 0 1.662.324 2.228.955.549.631.822 1.484.822 2.558v5.253z"/>
                            </svg>
                        </a>
                        <a href="https://twitter.com/GetI2P" target="_blank" rel="noopener" aria-label="Twitter">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/>
                            </svg>
                        </a>
                        <a href="https://old.reddit.com/r/i2p" target="_blank" rel="noopener" aria-label="Reddit">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M12 0A12 12 0 0 0 0 12a12 12 0 0 0 12 12 12 12 0 0 0 12-12A12 12 0 0 0 12 0zm5.01 4.744c.688 0 1.25.561 1.25 1.249a1.25 1.25 0 0 1-2.498.056l-2.597-.547-.8 3.747c1.824.07 3.48.632 4.674 1.488.308-.309.73-.491 1.207-.491.968 0 1.754.786 1.754 1.754 0 .716-.435 1.333-1.01 1.614a3.111 3.111 0 0 1 .042.52c0 2.694-3.13 4.87-7.004 4.87-3.874 0-7.004-2.176-7.004-4.87 0-.183.015-.366.043-.534A1.748 1.748 0 0 1 4.028 12c0-.968.786-1.754 1.754-1.754.463 0 .898.196 1.207.49 1.207-.883 2.878-1.43 4.744-1.487l.885-4.182a.342.342 0 0 1 .14-.197.35.35 0 0 1 .238-.042l2.906.617a1.214 1.214 0 0 1 1.108-.701zM9.25 12C8.561 12 8 12.562 8 13.25c0 .687.561 1.248 1.25 1.248.687 0 1.248-.561 1.248-1.249 0-.688-.561-1.249-1.249-1.249zm5.5 0c-.687 0-1.248.561-1.248 1.25 0 .687.561 1.248 1.249 1.248.688 0 1.249-.561 1.249-1.249 0-.687-.562-1.249-1.25-1.249zm-5.466 3.99a.327.327 0 0 0-.231.094.33.33 0 0 0 0 .463c.842.842 2.484.913 2.961.913.477 0 2.105-.056 2.961-.913a.361.361 0 0 0 .029-.463.33.33 0 0 0-.464 0c-.547.533-1.684.73-2.512.73-.828 0-1.979-.196-2.512-.73a.326.326 0 0 0-.232-.095z"/>
                            </svg>
                        </a>
                        <a href="https://signal.group/#CjQKIOSUTtxlhbumAKcRsthPFkxkTUrkWcX39bbN6njLEgAIEhCTNsR0KDuiehAXZnkt42v5" target="_blank" rel="noopener" aria-label="Signal" class="signal-link">
                            <img src="../../../images/Signal-Logo-Black.svg" alt="Signal" class="signal-logo signal-logo-light" loading="lazy" decoding="async">
                            <img src="../../../images/Signal-Logo-White.svg" alt="Signal" class="signal-logo signal-logo-dark" loading="lazy" decoding="async">
                        </a>
                    </div>

                    
                    <div class="footer-newsletter-inline">
                        <p class="newsletter-description">Mantente informado con las noticias de I2P:</p>
                        <form action="https://feedback.i2p.net/api/mailing-list/subscribe" method="POST" class="newsletter-form">
                            <input type="email" name="email" placeholder="Introduce tu correo electrónico" required>
                            <button type="submit">Suscribirse</button>
                        </form>
                    </div>
                </div>
            </div>

            <div class="footer-col">
                <h3>Enlaces Rápidos</h3>
                <ul>
                    <li><a href="../../../es/financial-support/">Donar</a></li>
                    <li><a href="../../../es/docs/overview/intro/">Introducción a I2P</a></li>
                </ul>
            </div>

            <div class="footer-col">
                <h3>Comunidad</h3>
                <ul>
                    <li><a href="../../../es/get-involved/">Participa</a></li>
                    <li><a href="../../../es/blog/">Blog</a></li>
                    <li><a href="http://i2pforum.net/" target="_blank" rel="noopener">Foros Oficiales</a></li>
                    <li><a href="../../../es/contact/">Contacto</a></li>
                </ul>
            </div>

            <div class="footer-col">
                <h3>Recursos</h3>
                <ul>
                    <li><a href="https://i2p-metrics.np-tokumei.net/" target="_blank" rel="noopener">Métricas de I2P</a></li>
                    <li><a href="../../../es/papers/">Investigación</a></li>
                    <li><a href="https://i2pgit.org/" target="_blank" rel="noopener">GitLab</a></li>
                    <li><a href="https://www.stormycloud.org/" target="_blank" rel="noopener">StormyCloud</a></li>
                </ul>
            </div>
        </div>

        <div class="footer-bottom">
            <p class="copyright">&copy; 2025 El Proyecto de Internet Invisible. Licenciado bajo Creative Commons.</p>
            <div class="footer-links">
                <a href="../../../es/privacy/">Privacidad</a>
                <a href="../../../es/terms/">Términos</a>
                <a href="../../../es/about/media/">Prensa</a>
            </div>
        </div>
    </div>
</footer>


    
    
<div class="modal-overlay" id="poll">
    <div class="modal-content poll-modal-content">
        <a href="#" class="modal-close" aria-label="Cerrar">
            <span aria-hidden="true">&times;</span>
        </a>

        <div class="modal-header">
            <h2>Encuesta de la comunidad</h2>
            <p class="modal-subtitle">Nos encantaría saber de ti</p>
        </div>

        <div class="modal-body">
            
            <iframe 
                id="poll-iframe"
                data-poll-id="2"
                data-api-url="https://feedback.i2p.net"
                frameborder="0"
                scrolling="no"
                style="width: 100%; border: none; min-height: 400px;">
            </iframe>
        </div>

        <div class="modal-footer">
            <p class="modal-disclaimer">
                Tu voto ayuda a dar forma al futuro de I2P.
            </p>
        </div>
    </div>
</div>


<script>
(function() {
    const iframe = document.getElementById('poll-iframe');
    if (!iframe) return;
    
    const hostname = window.location.hostname;
    let apiUrl = 'https://feedback.i2p.net';
    const pollId = iframe.getAttribute('data-poll-id') || '1';

    
    if (hostname.endsWith('.b32.i2p') || hostname.endsWith('.i2p')) {
        apiUrl = 'http://5kwyynf3eetgqa2nors6ctwo7doi7yu73k7uvypy5eqmm326zkiq.b32.i2p';
    }
    
    else if (hostname.endsWith('.onion')) {
        apiUrl = 'http://gfonxmohvarpmocsvllscsuszdu5rikipm6innvcwq4vpng7zzqmmfyd.onion';
    }

    
    const pollUrl = apiUrl + '/widgets/poll.html?poll_id=' + encodeURIComponent(pollId) + '&api_url=' + encodeURIComponent(apiUrl);
    iframe.src = pollUrl;
})();
</script>



    
    



    
    <script>
        (function () {
            'use strict';
            var hostname = window.location.hostname;
            var baseUrl;

            
            if (hostname.endsWith('.b32.i2p') || hostname.endsWith('.i2p')) {
                baseUrl = 'http://5kwyynf3eetgqa2nors6ctwo7doi7yu73k7uvypy5eqmm326zkiq.b32.i2p';
            } else if (hostname.endsWith('.onion')) {
                baseUrl = 'http://gfonxmohvarpmocsvllscsuszdu5rikipm6innvcwq4vpng7zzqmmfyd.onion';
            } else {
                baseUrl = 'https://feedback.i2p.net';
            }

            window.feedbackBaseUrl = baseUrl;

            
            document.querySelectorAll('[data-api-url]').forEach(function (widget) {
                widget.setAttribute('data-api-url', baseUrl);
            });

            
            document.write('<link rel="stylesheet" href="' + baseUrl + '/widgets/styles.css">');
            
        })();
    </script>

    

    
    
    

    

</body>

</html>
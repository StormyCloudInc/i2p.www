<!DOCTYPE html>
<html lang="es" data-theme="light">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <title>Nuevas Entradas en netDB | I2P - El Proyecto Internet Invisible</title>

    <meta name="description" content="The Invisible Internet Project - A privacy-focused, anonymous network layer">
    <meta name="keywords" content="i2p, privacy, anonymity, dark net, encryption, security">

    
    <meta property="og:title" content="Nuevas Entradas en netDB | I2P - El Proyecto Internet Invisible">
    <meta property="og:description" content="The Invisible Internet Project - A privacy-focused, anonymous network layer">
    <meta property="og:type" content="website">
    <meta property="og:url" content="/es/proposals/123-new-netdb-entries/">

    
    <link rel="icon" type="image/svg+xml" href="../../../images/favicon.svg">
    <link rel="icon" type="image/png" href="../../../images/i2plogo.png" sizes="32x32">

    
    
    
    
    <link rel="stylesheet" href="../../../css/main.min.be6880f32f5ff44e57579da7b11513b973319944ebe38748e3ac7f3268662d18.css" integrity="sha256-vmiA8y9f9E5XV52nsRUTuXMxmUTr44dI46x/MmhmLRg=">
    


    
</head>

<body>
    
    <input type="checkbox" id="theme-toggle-checkbox" class="theme-checkbox" aria-hidden="true">

    
<div class="site-banner" id="site-banner" data-banner-id="banner-3" role="alert" aria-live="polite">
    <div class="container">
        <div class="banner-content">
            <span class="banner-message">Sitio Beta I2P Ahora Activo - Reportar problemas por correo a stormycloud@mail.i2p</span>
            
        </div>
        
        <form method="GET" action="../../../api/banner/dismiss" style="display: inline;">
            <input type="hidden" name="id" value="banner-3">
            <button type="submit" class="banner-close" aria-label="Cerrar banner" title="Cerrar banner">
                <span aria-hidden="true">&times;</span>
            </button>
        </form>
        
    </div>
</div>


    <header class="site-header">
    <div class="container">
        <nav class="main-nav">
            <div class="nav-brand">
                <a href="../../../es/" class="logo-link">
                    <img src="../../../images/i2plogo_lightmode.svg" alt="I2P Logo" class="logo logo-light">
                    <img src="../../../images/i2plogo_darkmode.svg" alt="I2P Logo" class="logo logo-dark">
                </a>
            </div>

            
            <input type="checkbox" id="mobile-menu-checkbox" class="mobile-menu-checkbox"
                aria-label="Toggle navigation menu">
            <label for="mobile-menu-checkbox" class="mobile-menu-toggle" aria-label="Toggle navigation menu">
                <span class="hamburger"></span>
            </label>

            <div class="nav-menu">
                <ul class="nav-links">
                    <li class="nav-dropdown">
                        <a href="../../../es/about/" class="">Acerca de</a>
                        <ul class="dropdown-menu">
                            <li><a href="../../../es/about/">Resumen</a></li>
                            <li><a href="../../../es/papers/">Artículos de Investigación</a></li>
                            <li><a href="../../../es/about/media/">Prensa</a></li>
                            <li><a href="../../../es/contact/">Contáctanos</a></li>
                        </ul>
                    </li>
                    <li><a href="../../../es/docs/" class="">Documentos</a></li>
                    <li><a href="../../../es/downloads/" class="">Descargas</a></li>
                    <li><a href="../../../es/blog/" class="">Blog</a></li>
                    <li class="nav-dropdown">
                        <a href="../../../es/get-involved/" class="">Participa</a>
                        <ul class="dropdown-menu">
                            <li><a href="../../../es/get-involved/">Resumen</a></li>
                            <li><a href="../../../es/feedback/">Sugerencias de Funciones</a></li>
                        </ul>
                    </li>
                </ul>

                <div class="nav-actions">
                    
                    <div class="language-selector">
                        <button class="language-toggle" aria-label="Select language" title="Language">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none"
                                xmlns="http://www.w3.org/2000/svg">
                                <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2" />
                                <path
                                    d="M2 12h20M12 2a15.3 15.3 0 014 10 15.3 15.3 0 01-4 10 15.3 15.3 0 01-4-10 15.3 15.3 0 014-10z"
                                    stroke="currentColor" stroke-width="2" />
                            </svg>
                            <span class="current-lang">es</span>
                        </button>
                        <div class="language-dropdown">
                            
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../en/proposals/123-new-netdb-entries/"
                                class="lang-option">Inglés</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../es/proposals/123-new-netdb-entries/"
                                class="lang-option active">Español</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../ko/proposals/123-new-netdb-entries/"
                                class="lang-option">Coreano</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../zh/proposals/123-new-netdb-entries/"
                                class="lang-option">Chino</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../ru/proposals/123-new-netdb-entries/"
                                class="lang-option">Ruso</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../cs/proposals/123-new-netdb-entries/"
                                class="lang-option">Checo</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../de/proposals/123-new-netdb-entries/"
                                class="lang-option">Alemán</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../fr/proposals/123-new-netdb-entries/"
                                class="lang-option">Francés</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../tr/proposals/123-new-netdb-entries/"
                                class="lang-option">Turco</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../vi/proposals/123-new-netdb-entries/"
                                class="lang-option">Vietnamita</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../hi/proposals/123-new-netdb-entries/"
                                class="lang-option">Hindi</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../ar/proposals/123-new-netdb-entries/"
                                class="lang-option">Árabe</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../pt/proposals/123-new-netdb-entries/"
                                class="lang-option">Portugués</a>
                            
                            
                        </div>
                    </div>

                    
                    <label for="theme-toggle-checkbox" class="theme-toggle" aria-label="Toggle dark mode"
                        title="Toggle theme">
                        <svg class="sun-icon" width="20" height="20" viewBox="0 0 20 20" fill="none"
                            xmlns="http://www.w3.org/2000/svg">
                            <circle cx="10" cy="10" r="4" stroke="currentColor" stroke-width="2" />
                            <path
                                d="M10 2V4M10 16V18M18 10H16M4 10H2M15.657 4.343L14.243 5.757M5.757 14.243L4.343 15.657M15.657 15.657L14.243 14.243M5.757 5.757L4.343 4.343"
                                stroke="currentColor" stroke-width="2" stroke-linecap="round" />
                        </svg>
                        <svg class="moon-icon" width="20" height="20" viewBox="0 0 20 20" fill="none"
                            xmlns="http://www.w3.org/2000/svg">
                            <path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"
                                stroke="currentColor" stroke-width="2" stroke-linejoin="round" />
                        </svg>
                    </label>

                    
                    <a href="../../../es/financial-support/" class="btn btn-primary" id="donate-btn">Donate</a>

                    
                    <a href="../../../es/downloads/" class="btn btn-primary">Obtener I2P</a>
                </div>
            </div>
        </nav>
    </div>
</header>

    <main id="main-content">
        



<div class="proposals-page">
    <div class="container">
        
        <nav class="breadcrumbs">
            <a href="../../../es/">Home</a>
            <span class="separator">/</span>
            <a href="../../../es/proposals/">Proposals</a>
            <span class="separator">/</span>
            <span class="current">Nuevas Entradas en netDB</span>
        </nav>

        
<div class="translation-disclaimer" role="note">
    <span class="disclaimer-message">Esta traducción fue generada mediante aprendizaje automático y puede no ser 100% precisa.</span>
    
    
    <a href="../../../en/proposals/123-new-netdb-entries/" class="disclaimer-link">Ver versión en inglés</a>
    
</div>



        
        <header class="proposal-header">
            <div class="proposal-title-section">
                <h1 class="proposal-title">Nuevas Entradas en netDB</h1>
                <div class="proposal-number">Proposal 123</div>
            </div>

            
            <div class="proposal-meta-box">
                <div class="proposal-status status-abrir">
                    Abrir
                </div>

                
                <div class="proposal-info-grid">
                    
                    <div class="info-item">
                        <span class="info-label">Author</span>
                        <span class="info-value">zzz, str4d, orignal</span>
                    </div>
                    

                    
                    <div class="info-item">
                        <span class="info-label">Created</span>
                        <span class="info-value">2016-01-16</span>
                    </div>
                    

                    
                    <div class="info-item">
                        <span class="info-label">Last Updated</span>
                        <span class="info-value">2020-07-18</span>
                    </div>
                    

                    

                    
                </div>

                
                
                <div class="proposal-relationships">
                    
                    <div class="relationship">
                        <span class="relationship-label">Supercedes:</span>
                        <span class="relationship-value">110, 120, 121, 122</span>
                    </div>
                    
                    
                </div>
                
            </div>
        </header>

        
        <div class="proposal-layout proposal-layout--with-toc">
            
            
            <aside class="proposal-toc-sidebar">
                <nav class="toc-nav">
                    <div class="toc-header">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                            <path d="M4 6h16M4 12h16M4 18h16" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                        </svg>
                        On This Page
                    </div>
                    <div class="toc-content">
                        <nav id="TableOfContents">
  <ul>
    <li><a href="#estado">Estado</a></li>
    <li><a href="#resumen">Resumen</a></li>
    <li><a href="#propuesta">Propuesta</a>
      <ul>
        <li><a href="#goals">Goals</a></li>
        <li><a href="#non-goals--out-of-scope">Non-Goals / Out-of-scope</a></li>
        <li><a href="#justification">Justification</a></li>
        <li><a href="#objetivos">Objetivos</a></li>
        <li><a href="#no-objetivos--fuera-del-alcance">No objetivos / Fuera del alcance</a></li>
        <li><a href="#justificación">Justificación</a></li>
        <li><a href="#tipos-de-datos-de-netdb">Tipos de Datos de NetDB</a></li>
        <li><a href="#notas">Notas</a></li>
      </ul>
    </li>
    <li><a href="#standard-ls2-header">Standard LS2 Header</a>
      <ul>
        <li><a href="#proceso-de-lookupstore">Proceso de Lookup/Store</a></li>
        <li><a href="#formato">Formato</a></li>
        <li><a href="#consideraciones-de-privacidadseguridad">Consideraciones de Privacidad/Seguridad</a></li>
        <li><a href="#notes">Notes</a></li>
      </ul>
    </li>
    <li><a href="#new-databaseentry-types">New DatabaseEntry types</a>
      <ul>
        <li><a href="#formato-1">Formato</a></li>
        <li><a href="#justificación-1">Justificación</a></li>
        <li><a href="#problemas">Problemas</a></li>
        <li><a href="#notas-1">Notas</a></li>
        <li><a href="#new-encryption-issues">New Encryption Issues</a></li>
        <li><a href="#leaseset-2">LeaseSet 2</a></li>
        <li><a href="#formato-2">Formato</a></li>
        <li><a href="#justificación-2">Justificación</a></li>
        <li><a href="#discusión">Discusión</a></li>
        <li><a href="#nuevos-problemas-de-cifrado">Nuevos Problemas de Cifrado</a></li>
        <li><a href="#notas-2">Notas</a></li>
        <li><a href="#ls2-cifrado">LS2 Cifrado</a></li>
        <li><a href="#definiciones">Definiciones</a></li>
        <li><a href="#formato-3">Formato</a></li>
        <li><a href="#notes-1">Notes</a></li>
        <li><a href="#meta-ls2">Meta LS2</a></li>
        <li><a href="#format">Format</a></li>
        <li><a href="#derivación-de-clave-de-ocultación">Derivación de Clave de Ocultación</a></li>
        <li><a href="#service-record">Service Record</a></li>
        <li><a href="#format-1">Format</a></li>
        <li><a href="#notes-2">Notes</a></li>
        <li><a href="#service-list">Service List</a></li>
        <li><a href="#format-2">Format</a></li>
        <li><a href="#notes-3">Notes</a></li>
      </ul>
    </li>
    <li><a href="#common-structures-spec-changes-required">Common Structures Spec Changes Required</a>
      <ul>
        <li><a href="#cifrado-y-procesamiento">Cifrado y procesamiento</a></li>
        <li><a href="#new-intermediate-structures">New Intermediate Structures</a></li>
        <li><a href="#new-netdb-types">New NetDB Types</a></li>
        <li><a href="#new-signature-type">New Signature Type</a></li>
      </ul>
    </li>
    <li><a href="#encryption-spec-changes-required">Encryption Spec Changes Required</a></li>
    <li><a href="#i2np-changes-required">I2NP Changes Required</a>
      <ul>
        <li><a href="#database-lookup-message">Database Lookup Message</a></li>
        <li><a href="#changes">Changes</a></li>
        <li><a href="#autorización-por-cliente">Autorización por cliente</a></li>
        <li><a href="#changes-1">Changes</a></li>
      </ul>
    </li>
    <li><a href="#i2cp-changes-required">I2CP Changes Required</a>
      <ul>
        <li><a href="#i2cp-options">I2CP Options</a></li>
        <li><a href="#session-config">Session Config</a></li>
        <li><a href="#encrypted-ls-con-direcciones-base-32">Encrypted LS con Direcciones Base 32</a></li>
        <li><a href="#ls-cifrado-con-claves-offline">LS Cifrado con Claves Offline</a></li>
        <li><a href="#notas-3">Notas</a></li>
        <li><a href="#meta-ls2-1">Meta LS2</a></li>
        <li><a href="#i-notice-that-the-text-you-provided-only-contains-the-word-format-and-the-instruction----there-doesnt-appear-to-be-any-actual-content-to-translate">I notice that the text you provided only contains the word &ldquo;Format&rdquo; and the instruction &quot;&quot; - there doesn&rsquo;t appear to be any actual content to translate.</a></li>
        <li><a href="#notas-4">Notas</a></li>
        <li><a href="#registro-de-servicio">Registro de Servicio</a></li>
        <li><a href="#formato-4">Formato</a></li>
        <li><a href="#notas-5">Notas</a></li>
        <li><a href="#lista-de-servicios">Lista de Servicios</a></li>
        <li><a href="#formato-5">Formato</a></li>
        <li><a href="#notas-6">Notas</a></li>
        <li><a href="#format-3">Format</a></li>
        <li><a href="#certificados-de-clave">Certificados de Clave</a></li>
        <li><a href="#nuevas-estructuras-intermedias">Nuevas Estructuras Intermedias</a></li>
        <li><a href="#nuevos-tipos-de-netdb">Nuevos Tipos de NetDB</a></li>
        <li><a href="#nuevo-tipo-de-firma">Nuevo Tipo de Firma</a></li>
        <li><a href="#justification-1">Justification</a></li>
        <li><a href="#usage">Usage</a></li>
        <li><a href="#mensaje-de-consulta-de-base-de-datos">Mensaje de Consulta de Base de Datos</a></li>
        <li><a href="#cambios">Cambios</a></li>
        <li><a href="#mensaje-de-almacenamiento-de-base-de-datos">Mensaje de Almacenamiento de Base de Datos</a></li>
        <li><a href="#cambios-1">Cambios</a></li>
      </ul>
    </li>
    <li><a href="#private-key-file-changes-required">Private Key File Changes Required</a>
      <ul>
        <li><a href="#changes-2">Changes</a></li>
        <li><a href="#opciones-i2cp">Opciones I2CP</a></li>
      </ul>
    </li>
    <li><a href="#streaming-changes-required">Streaming Changes Required</a>
      <ul>
        <li><a href="#configuración-de-sesión">Configuración de Sesión</a></li>
        <li><a href="#mensaje-de-solicitud-de-leaseset">Mensaje de Solicitud de LeaseSet</a></li>
      </ul>
    </li>
    <li><a href="#cabecera-estándar-ls2">Cabecera estándar LS2</a>
      <ul>
        <li><a href="#mensaje-de-solicitud-de-leaseset-variable">Mensaje de Solicitud de Leaseset Variable</a></li>
        <li><a href="#crear-mensaje-leaseset2">Crear Mensaje Leaseset2</a></li>
      </ul>
    </li>
    <li><a href="#sam-v3-changes-required">SAM V3 Changes Required</a>
      <ul>
        <li><a href="#justificación-3">Justificación</a></li>
        <li><a href="#tipo-de-mensaje">Tipo de Mensaje</a></li>
      </ul>
    </li>
    <li><a href="#bob-changes-required">BOB Changes Required</a></li>
    <li><a href="#publishing-migration-compatibility">Publishing, Migration, Compatibility</a></li>
    <li><a href="#rollout">Rollout</a></li>
    <li><a href="#nuevos-tipos-de-databaseentry">Nuevos tipos de DatabaseEntry</a></li>
  </ul>
</nav>
                    </div>
                </nav>
            </aside>
            

            
            <div class="proposal-main">
                <article class="proposal-content">
                    <h2 id="estado">Estado</h2>
<p>Partes de esta propuesta están completas e implementadas en 0.9.38 y 0.9.39. Las especificaciones de Common Structures, I2CP, I2NP y otras ahora están actualizadas para reflejar los cambios que se soportan actualmente.</p>
<p>Las partes completadas aún están sujetas a revisiones menores. Otras partes de esta propuesta aún están en desarrollo y sujetas a revisiones sustanciales.</p>
<p>Service Lookup (tipos 9 y 11) son de baja prioridad y no programados, y pueden separarse en una propuesta independiente.</p>
<h2 id="resumen">Resumen</h2>
<p>Esta es una actualización y agregación de las siguientes 4 propuestas:</p>
<ul>
<li>110 LS2</li>
<li>120 Meta LS2 para multihoming masivo</li>
<li>121 LS2 cifrado</li>
<li>122 Búsqueda de servicio no autenticada (anycasting)</li>
</ul>
<p>Estas propuestas son en su mayoría independientes, pero por cordura definimos y utilizamos un formato común para varias de ellas.</p>
<p>Las siguientes propuestas están algo relacionadas:</p>
<ul>
<li>140 Invisible Multihoming (incompatible con esta propuesta)</li>
<li>142 New Crypto Template (para nueva criptografía simétrica)</li>
<li>144 ECIES-X25519-AEAD-Ratchet</li>
<li>145 ECIES-P256</li>
<li>146 Red25519</li>
<li>148 EdDSA-BLAKE2b-Ed25519</li>
<li>149 B32 for Encrypted LS2</li>
<li>150 Garlic Farm Protocol</li>
<li>151 ECDSA Blinding</li>
</ul>
<h2 id="propuesta">Propuesta</h2>
<p>Esta propuesta define 5 nuevos tipos de DatabaseEntry y el proceso para almacenarlos y recuperarlos de la base de datos de red, así como el método para firmarlos y verificar esas firmas.</p>
<h3 id="goals">Goals</h3>
<ul>
<li>Compatible hacia atrás</li>
<li>LS2 utilizable con multihoming de estilo antiguo</li>
<li>No se requieren nuevos primitivos criptográficos o de cifrado para el soporte</li>
<li>Mantener el desacoplamiento de cifrado y firma; soportar todas las versiones actuales y futuras</li>
<li>Habilitar claves de firma offline opcionales</li>
<li>Reducir la precisión de las marcas de tiempo para reducir el fingerprinting</li>
<li>Habilitar nuevo cifrado para destinos</li>
<li>Habilitar multihoming masivo</li>
<li>Corregir múltiples problemas con los LS cifrados existentes</li>
<li>Blinding opcional para reducir la visibilidad por parte de los floodfills</li>
<li>El cifrado soporta tanto claves únicas como múltiples claves revocables</li>
<li>Búsqueda de servicios para facilitar la búsqueda de outproxies, bootstrap de DHT de aplicaciones,
y otros usos</li>
<li>No romper nada que dependa de hashes de destino binarios de 32 bytes, ej. bittorrent</li>
<li>Agregar flexibilidad a los leasesets mediante propiedades, como tenemos en los routerinfos.</li>
<li>Poner la marca de tiempo publicada y la expiración variable en el encabezado, para que funcione incluso
si el contenido está cifrado (no derivar la marca de tiempo del lease más temprano)</li>
<li>Todos los nuevos tipos viven en el mismo espacio DHT y las mismas ubicaciones que los leasesets existentes,
para que los usuarios puedan migrar del LS antiguo a LS2,
o cambiar entre LS2, Meta, y Encrypted,
sin cambiar el Destination o hash.</li>
<li>Un Destination existente puede ser convertido para usar claves offline,
o de vuelta a claves online, sin cambiar el Destination o hash.</li>
</ul>
<h3 id="non-goals--out-of-scope">Non-Goals / Out-of-scope</h3>
<ul>
<li>Nuevo algoritmo de rotación DHT o generación aleatoria compartida</li>
<li>El tipo específico de cifrado nuevo y el esquema de cifrado de extremo a extremo
para usar ese nuevo tipo estaría en una propuesta separada.
No se especifica ni se discute criptografía nueva aquí.</li>
<li>Nuevo cifrado para RIs o construcción de túneles.
Eso estaría en una propuesta separada.</li>
<li>Métodos de cifrado, transmisión y recepción de mensajes I2NP DLM / DSM / DSRM.
No se cambia.</li>
<li>Cómo generar y soportar Meta, incluyendo comunicación entre routers de backend, gestión, conmutación por error y coordinación.
El soporte puede agregarse a I2CP, o i2pcontrol, o un nuevo protocolo.
Esto puede o no estar estandarizado.</li>
<li>Cómo implementar y gestionar realmente túneles de expiración más larga, o cancelar túneles existentes.
Eso es extremadamente difícil, y sin ello, no puedes tener un apagado elegante razonable.</li>
<li>Cambios en el modelo de amenazas</li>
<li>Formato de almacenamiento sin conexión, o métodos para almacenar/recuperar/compartir los datos.</li>
<li>Los detalles de implementación no se discuten aquí y se dejan a cada proyecto.</li>
</ul>
<h3 id="justification">Justification</h3>
<p>LS2 añade campos para cambiar el tipo de cifrado y para futuros cambios de protocolo.</p>
<p>El LS2 cifrado corrige varios problemas de seguridad con el LS cifrado existente mediante el uso de cifrado asimétrico de todo el conjunto de leases.</p>
<p>Meta LS2 proporciona multihoming flexible, eficiente, efectivo y a gran escala.</p>
<p>Service Record y Service List proporcionan servicios anycast como búsqueda de nombres y arranque de DHT.</p>
<h3 id="objetivos">Objetivos</h3>
<p>Los números de tipo se utilizan en los Mensajes de Búsqueda/Almacenamiento de Base de Datos I2NP.</p>
<p>La columna end-to-end se refiere a si las consultas/respuestas se envían a un Destination en un Garlic Message.</p>
<p>Tipos existentes:</p>
<table>
  <thead>
      <tr>
          <th>NetDB Data</th>
          <th>Lookup Type</th>
          <th>Store Type</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>any</td>
          <td>0</td>
          <td>any</td>
      </tr>
      <tr>
          <td>LS</td>
          <td>1</td>
          <td>1</td>
      </tr>
      <tr>
          <td>RI</td>
          <td>2</td>
          <td>0</td>
      </tr>
      <tr>
          <td>exploratory</td>
          <td>3</td>
          <td>DSRM</td>
      </tr>
      <tr>
          <td>Nuevos tipos:</td>
          <td></td>
          <td></td>
      </tr>
  </tbody>
</table>
<table>
  <thead>
      <tr>
          <th>NetDB Data</th>
          <th>Lookup Type</th>
          <th>Store Type</th>
          <th>Std. LS2 Header?</th>
          <th>Sent end-to-end?</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>LS2</td>
          <td>1</td>
          <td>3</td>
          <td>yes</td>
          <td>yes</td>
      </tr>
      <tr>
          <td>Encrypted LS2</td>
          <td>1</td>
          <td>5</td>
          <td>no</td>
          <td>no</td>
      </tr>
      <tr>
          <td>Meta LS2</td>
          <td>1</td>
          <td>7</td>
          <td>yes</td>
          <td>no</td>
      </tr>
      <tr>
          <td>Service Record</td>
          <td>n/a</td>
          <td>9</td>
          <td>yes</td>
          <td>no</td>
      </tr>
      <tr>
          <td>Service List</td>
          <td>4</td>
          <td>11</td>
          <td>no</td>
          <td>no</td>
      </tr>
  </tbody>
</table>
<h3 id="no-objetivos--fuera-del-alcance">No objetivos / Fuera del alcance</h3>
<ul>
<li>
<p>Los tipos de búsqueda son actualmente los bits 3-2 en el Database Lookup Message.
Cualquier tipo adicional requeriría el uso del bit 4.</p>
</li>
<li>
<p>Todos los tipos de almacén son impares ya que los bits superiores en el campo
de tipo del Mensaje de Almacén de Base de Datos son ignorados por routers antiguos.
Preferimos que el análisis falle como un LS que como un RI comprimido.</p>
</li>
<li>
<p>¿Debería el tipo ser explícito o implícito o ninguno de los dos en los datos cubiertos por la firma?</p>
</li>
</ul>
<h3 id="justificación">Justificación</h3>
<p>Los tipos 3, 5 y 7 pueden ser devueltos como respuesta a una consulta de leaseSet estándar (tipo 1). El tipo 9 nunca es devuelto como respuesta a una consulta. El tipo 11 es devuelto como respuesta a un nuevo tipo de consulta de servicio (tipo 11).</p>
<p>Solo el tipo 3 puede enviarse en un mensaje Garlic de cliente a cliente.</p>
<h3 id="tipos-de-datos-de-netdb">Tipos de Datos de NetDB</h3>
<p>Los tipos 3, 7 y 9 tienen todos un formato común::</p>
<p>Encabezado LS2 Estándar   - como se define a continuación</p>
<p>Parte Específica del Tipo   - como se define a continuación en cada parte</p>
<p>Firma LS2 Estándar:   - Longitud según el tipo de firma de la clave de firmado</p>
<p>El Tipo 5 (Cifrado) no comienza con un Destination y tiene un formato diferente. Ver más abajo.</p>
<p>El Tipo 11 (Lista de Servicios) es una agregación de varios Registros de Servicio y tiene un formato diferente. Ver más abajo.</p>
<h3 id="notas">Notas</h3>
<p>TBD</p>
<h2 id="standard-ls2-header">Standard LS2 Header</h2>
<p>Los tipos 3, 7 y 9 utilizan el encabezado LS2 estándar, especificado a continuación:</p>
<h3 id="proceso-de-lookupstore">Proceso de Lookup/Store</h3>
<pre tabindex="0"><code>Standard LS2 Header:
  - Type (1 byte)
    Not actually in header, but part of data covered by signature.
    Take from field in Database Store Message.
  - Destination (387+ bytes)
  - Published timestamp (4 bytes, big endian, seconds since epoch, rolls over in 2106)
  - Expires (2 bytes, big endian) (offset from published timestamp in seconds, 18.2 hours max)
  - Flags (2 bytes)
    Bit order: 15 14 ... 3 2 1 0
    Bit 0: If 0, no offline keys; if 1, offline keys
    Bit 1: If 0, a standard published leaseset.
           If 1, an unpublished leaseset. Should not be flooded, published, or
           sent in response to a query. If this leaseset expires, do not query the
           netdb for a new one, unless bit 2 is set.
    Bit 2: If 0, a standard published leaseset.
           If 1, this unencrypted leaseset will be blinded and encrypted when published.
           If this leaseset expires, query the blinded location in the netdb for a new one.
           If this bit is set to 1, set bit 1 to 1 also.
           As of release 0.9.42.
    Bits 3-15: set to 0 for compatibility with future uses
  - If flag indicates offline keys, the offline signature section:
    Expires timestamp (4 bytes, big endian, seconds since epoch, rolls over in 2106)
    Transient sig type (2 bytes, big endian)
    Transient signing public key (length as implied by sig type)
    Signature of expires timestamp, transient sig type, and public key,
    by the destination public key,
    length as implied by destination public key sig type.
    This section can, and should, be generated offline.
</code></pre><h3 id="formato">Formato</h3>
<ul>
<li>
<p>Unpublished/published: Para uso al enviar un database store de extremo a extremo,
el router emisor puede desear indicar que este leaseset no debe ser
enviado a otros. Actualmente usamos heurísticas para mantener este estado.</p>
</li>
<li>
<p>Published: Reemplaza la lógica compleja requerida para determinar la &lsquo;versión&rsquo; del
leaseset. Actualmente, la versión es la expiración del lease que expira más tarde,
y un router que publica debe incrementar esa expiración por al menos 1ms cuando
publica un leaseset que solo elimina un lease más antiguo.</p>
</li>
<li>
<p>Expires: Permite que la expiración de una entrada netDb sea anterior a la de su leaseSet que expira más tarde. Puede no ser útil para LS2, donde se espera que los leaseSets mantengan una expiración máxima de 11 minutos, pero para otros tipos nuevos, es necesario (ver Meta LS y Service Record más abajo).</p>
</li>
<li>
<p>Las claves offline son opcionales, para reducir la complejidad inicial/requerida de implementación.</p>
</li>
</ul>
<h3 id="consideraciones-de-privacidadseguridad">Consideraciones de Privacidad/Seguridad</h3>
<ul>
<li>
<p>Podría reducir aún más la precisión del timestamp (¿10 minutos?) pero tendría que agregar
número de versión. Esto podría romper el multihoming, ¿a menos que tengamos cifrado que preserve el orden?
Probablemente no se puede hacer sin timestamps en absoluto.</p>
</li>
<li>
<p>Alternativa: marca de tiempo de 3 bytes (época / 10 minutos), versión de 1 byte, expira en 2 bytes</p>
</li>
<li>
<p>¿Es el tipo explícito o implícito en los datos / firma? ¿Constantes de &ldquo;Domain&rdquo; para la firma?</p>
</li>
</ul>
<h3 id="notes">Notes</h3>
<ul>
<li>
<p>Los routers no deberían publicar un LS más de una vez por segundo.
Si lo hacen, deben incrementar artificialmente el timestamp publicado en 1
sobre el LS previamente publicado.</p>
</li>
<li>
<p>Las implementaciones de router podrían almacenar en caché las claves transitorias y la firma para evitar la verificación cada vez. En particular, los floodfills y los routers en ambos extremos de conexiones de larga duración podrían beneficiarse de esto.</p>
</li>
<li>
<p>Las claves sin conexión y la firma solo son apropiadas para destinos de larga duración,
es decir, servidores, no clientes.</p>
</li>
</ul>
<h2 id="new-databaseentry-types">New DatabaseEntry types</h2>
<h3 id="formato-1">Formato</h3>
<p>Cambios desde el LeaseSet existente:</p>
<ul>
<li>Agregar marca de tiempo de publicación, marca de tiempo de expiración, flags y propiedades</li>
<li>Agregar tipo de cifrado</li>
<li>Eliminar clave de revocación</li>
</ul>
<p>Buscar con</p>
<pre><code>Standard LS flag (1)
</code></pre>
<p>Almacenar con</p>
<pre><code>Standard LS2 type (3)
</code></pre>
<p>Almacenar en</p>
<pre><code>Hash of destination
This hash is then used to generate the daily &quot;routing key&quot;, as in LS1
</code></pre>
<p>Expiración típica</p>
<pre><code>10 minutes, as in a regular LS.
</code></pre>
<p>Publicado por</p>
<pre><code>Destination
</code></pre>
<h3 id="justificación-1">Justificación</h3>
<pre tabindex="0"><code>Standard LS2 Header as specified above

  Standard LS2 Type-Specific Part
  - Properties (Mapping as specified in common structures spec, 2 zero bytes if none)
  - Number of key sections to follow (1 byte, max TBD)
  - Key sections:
    - Encryption type (2 bytes, big endian)
    - Encryption key length (2 bytes, big endian)
      This is explicit, so floodfills can parse LS2 with unknown encryption types.
    - Encryption key (number of bytes specified)
  - Number of lease2s (1 byte)
  - Lease2s (40 bytes each)
    These are leases, but with a 4-byte instead of an 8-byte expiration,
    seconds since the epoch (rolls over in 2106)

  Standard LS2 Signature:
  - Signature
    If flag indicates offline keys, this is signed by the transient pubkey,
    otherwise, by the destination pubkey
    Length as implied by sig type of signing key
    The signature is of everything above.
</code></pre><h3 id="problemas">Problemas</h3>
<ul>
<li>
<p>Properties: Expansión futura y flexibilidad.
Se coloca primero en caso de que sea necesario para el análisis de los datos restantes.</p>
</li>
<li>
<p>Múltiples pares de tipo de cifrado/clave pública son
para facilitar la transición a nuevos tipos de cifrado. La otra forma de hacerlo
es publicar múltiples leasesets, posiblemente usando los mismos tunnels,
como hacemos ahora para destinos DSA y EdDSA.
La identificación del tipo de cifrado entrante en un tunnel
puede hacerse con el mecanismo de session tag existente,
y/o descifrado por prueba y error usando cada clave. Las longitudes de los
mensajes entrantes también pueden proporcionar una pista.</p>
</li>
</ul>
<h3 id="notas-1">Notas</h3>
<p>Esta propuesta continúa utilizando la clave pública en el leaseset para la clave de cifrado de extremo a extremo, y deja el campo de clave pública en el Destination sin usar, como está ahora. El tipo de cifrado no se especifica en el certificado de clave del Destination, permanecerá en 0.</p>
<p>Una alternativa rechazada es especificar el tipo de cifrado en el certificado de clave de Destination, usar la clave pública en el Destination, y no usar la clave pública en el leaseset. No planeamos hacer esto.</p>
<p>Beneficios de LS2:</p>
<ul>
<li>La ubicación de la clave pública real no cambia.</li>
<li>El tipo de cifrado, o clave pública, puede cambiar sin modificar el Destination.</li>
<li>Elimina el campo de revocación no utilizado</li>
<li>Compatibilidad básica con otros tipos DatabaseEntry en esta propuesta</li>
<li>Permite múltiples tipos de cifrado</li>
</ul>
<p>Desventajas de LS2:</p>
<ul>
<li>La ubicación de la clave pública y el tipo de cifrado difieren del RouterInfo</li>
<li>Mantiene una clave pública no utilizada en el leaseset</li>
<li>Requiere implementación a través de la red; como alternativa, se pueden usar tipos de
cifrado experimentales, si los floodfills lo permiten
(pero ver las propuestas relacionadas 136 y 137 sobre el soporte para tipos de firma experimentales).
La propuesta alternativa podría ser más fácil de implementar y probar para tipos de cifrado experimentales.</li>
</ul>
<h3 id="new-encryption-issues">New Encryption Issues</h3>
<p>Parte de esto está fuera del alcance de esta propuesta, pero ponemos notas aquí por ahora ya que aún no tenemos una propuesta de encriptación separada. Ver también las propuestas ECIES 144 y 145.</p>
<ul>
<li>
<p>El tipo de cifrado representa la combinación
de curva, longitud de clave, y esquema extremo a extremo,
incluyendo KDF y MAC, si los hay.</p>
</li>
<li>
<p>Hemos incluido un campo de longitud de clave, para que el LS2 sea
analizable y verificable por el floodfill incluso para tipos de cifrado desconocidos.</p>
</li>
<li>
<p>El primer nuevo tipo de cifrado que se proponga probablemente
será ECIES/X25519. Cómo se usa de extremo a extremo
(ya sea una versión ligeramente modificada de ElGamal/AES+SessionTag
o algo completamente nuevo, por ejemplo ChaCha/Poly) se especificará
en una o más propuestas separadas.
Consulta también las propuestas ECIES 144 y 145.</p>
</li>
</ul>
<h3 id="leaseset-2">LeaseSet 2</h3>
<ul>
<li>
<p>La expiración de 8 bytes en los leases cambió a 4 bytes.</p>
</li>
<li>
<p>Si alguna vez implementamos revocación, podemos hacerlo con un campo expires de cero,
o cero leases, o ambos. No hay necesidad de una clave de revocación separada.</p>
</li>
<li>
<p>Las claves de cifrado están en orden de preferencia del servidor, la más preferida primero.
El comportamiento predeterminado del cliente es seleccionar la primera clave con
un tipo de cifrado compatible. Los clientes pueden usar otros algoritmos de selección
basados en el soporte de cifrado, rendimiento relativo y otros factores.</p>
</li>
</ul>
<h3 id="formato-2">Formato</h3>
<p>Objetivos:</p>
<ul>
<li>Agregar ocultación</li>
<li>Permitir múltiples tipos de firma</li>
<li>No requiere nuevas primitivas criptográficas</li>
<li>Opcionalmente cifrar para cada destinatario, revocable</li>
<li>Compatible con cifrado de Standard LS2 y Meta LS2 únicamente</li>
</ul>
<p>El LS2 cifrado nunca se envía en un mensaje garlic extremo a extremo. Utiliza el LS2 estándar como se indica arriba.</p>
<p>Cambios respecto al LeaseSet cifrado existente:</p>
<ul>
<li>Cifrar todo por seguridad</li>
<li>Cifrar de forma segura, no solo con AES.</li>
<li>Cifrar para cada destinatario</li>
</ul>
<p>Buscar con</p>
<pre><code>Standard LS flag (1)
</code></pre>
<p>Almacenar con</p>
<pre><code>Encrypted LS2 type (5)
</code></pre>
<p>Almacenar en</p>
<pre><code>Hash of blinded sig type and blinded public key
Two byte sig type (big endian, e.g. 0x000b) || blinded public key
This hash is then used to generate the daily &quot;routing key&quot;, as in LS1
</code></pre>
<p>Expiración típica</p>
<pre><code>10 minutes, as in a regular LS, or hours, as in a meta LS.
</code></pre>
<p>Publicado por</p>
<pre><code>Destination
</code></pre>
<h3 id="justificación-2">Justificación</h3>
<p>Definimos las siguientes funciones correspondientes a los bloques de construcción criptográficos utilizados para LS2 cifrado:</p>
<p>CSRNG(n)</p>
<pre><code>n-byte output from a cryptographically-secure random number generator.

In addition to the requirement of CSRNG being cryptographically-secure (and thus
suitable for generating key material), it MUST be safe
for some n-byte output to be used for key material when the byte sequences immediately
preceding and following it are exposed on the network (such as in a salt, or encrypted
padding). Implementations that rely on a potentially-untrustworthy source should hash
any output that is to be exposed on the network. See [PRNG references](http://projectbullrun.org/dual-ec/ext-rand.html) and [Tor dev discussion](https://lists.torproject.org/pipermail/tor-dev/2015-November/009954.html).
</code></pre>
<p>H(p, d)</p>
<pre><code>SHA-256 hash function that takes a personalization string p and data d, and
produces an output of length 32 bytes.

Use SHA-256 as follows::

    H(p, d) := SHA-256(p || d)
</code></pre>
<p>STREAM</p>
<pre><code>The ChaCha20 stream cipher as specified in [RFC 7539 Section 2.4](https://tools.ietf.org/html/rfc7539#section-2.4), with the initial counter
set to 1. S_KEY_LEN = 32 and S_IV_LEN = 12.

ENCRYPT(k, iv, plaintext)
    Encrypts plaintext using the cipher key k, and nonce iv which MUST be unique for
    the key k. Returns a ciphertext that is the same size as the plaintext.

    The entire ciphertext must be indistinguishable from random if the key is secret.

DECRYPT(k, iv, ciphertext)
    Decrypts ciphertext using the cipher key k, and nonce iv. Returns the plaintext.
</code></pre>
<p>SIG</p>
<pre><code>The RedDSA signature scheme (corresponding to SigType 11) with key blinding.
It has the following functions:

DERIVE_PUBLIC(privkey)
    Returns the public key corresponding to the given private key.

SIGN(privkey, m)
    Returns a signature by the private key privkey over the given message m.

VERIFY(pubkey, m, sig)
    Verifies the signature sig against the public key pubkey and message m. Returns
    true if the signature is valid, false otherwise.

It must also support the following key blinding operations:

GENERATE_ALPHA(data, secret)
    Generate alpha for those who know the data and an optional secret.
    The result must be identically distributed as the private keys.

BLIND_PRIVKEY(privkey, alpha)
    Blinds a private key, using a secret alpha.

BLIND_PUBKEY(pubkey, alpha)
    Blinds a public key, using a secret alpha.
    For a given keypair (privkey, pubkey) the following relationship holds::

        BLIND_PUBKEY(pubkey, alpha) ==
        DERIVE_PUBLIC(BLIND_PRIVKEY(privkey, alpha))
</code></pre>
<p>DH</p>
<pre><code>X25519 public key agreement system. Private keys of 32 bytes, public keys of 32
bytes, produces outputs of 32 bytes. It has the following
functions:

GENERATE_PRIVATE()
    Generates a new private key.

DERIVE_PUBLIC(privkey)
    Returns the public key corresponding to the given private key.

DH(privkey, pubkey)
    Generates a shared secret from the given private and public keys.
</code></pre>
<p>HKDF(salt, ikm, info, n)</p>
<pre><code>A cryptographic key derivation function which takes some input key material ikm (which
should have good entropy but is not required to be a uniformly random string), a salt
of length 32 bytes, and a context-specific 'info' value, and produces an output
of n bytes suitable for use as key material.

Use HKDF as specified in [RFC 5869](https://tools.ietf.org/html/rfc5869), using the HMAC hash function SHA-256
as specified in [RFC 2104](https://tools.ietf.org/html/rfc2104). This means that SALT_LEN is 32 bytes max.
</code></pre>
<h3 id="discusión">Discusión</h3>
<p>El formato LS2 encriptado consiste en tres capas anidadas:</p>
<ul>
<li>Una capa exterior que contiene la información en texto plano necesaria para el almacenamiento y recuperación.</li>
<li>Una capa intermedia que maneja la autenticación del cliente.</li>
<li>Una capa interna que contiene los datos LS2 reales.</li>
</ul>
<p>El formato general se ve así::</p>
<pre><code>Layer 0 data + Enc(layer 1 data + Enc(layer 2 data)) + Signature
</code></pre>
<p>Tenga en cuenta que el LS2 encriptado está cegado. El Destination no está en el encabezado. La ubicación de almacenamiento DHT es SHA-256(tipo de sig || clave pública cegada), y se rota diariamente.</p>
<p>NO usa el encabezado LS2 estándar especificado arriba.</p>
<h4 id="layer-0-outer">Layer 0 (outer)</h4>
<p>Tipo</p>
<pre><code>1 byte

Not actually in header, but part of data covered by signature.
Take from field in Database Store Message.
</code></pre>
<p>Tipo de Firma de Clave Pública Ciega</p>
<pre><code>2 bytes, big endian
This will always be type 11, identifying a Red25519 blinded key.
</code></pre>
<p>Clave Pública Ciega</p>
<pre><code>Length as implied by sig type
</code></pre>
<p>Marca de tiempo de publicación</p>
<pre><code>4 bytes, big endian

Seconds since epoch, rolls over in 2106
</code></pre>
<p>Expira</p>
<pre><code>2 bytes, big endian

Offset from published timestamp in seconds, 18.2 hours max
</code></pre>
<p>Banderas</p>
<pre><code>2 bytes

Bit order: 15 14 ... 3 2 1 0

Bit 0: If 0, no offline keys; if 1, offline keys

Other bits: set to 0 for compatibility with future uses
</code></pre>
<p>Datos de clave transitoria</p>
<pre><code>Present if flag indicates offline keys

Expires timestamp
    4 bytes, big endian

    Seconds since epoch, rolls over in 2106

Transient sig type
    2 bytes, big endian

Transient signing public key
    Length as implied by sig type

Signature
    Length as implied by blinded public key sig type

    Over expires timestamp, transient sig type, and transient public key.

    Verified with the blinded public key.
</code></pre>
<p>lenOuterCiphertext</p>
<pre><code>2 bytes, big endian
</code></pre>
<p>outerCiphertext</p>
<pre><code>lenOuterCiphertext bytes

Encrypted layer 1 data. See below for key derivation and encryption algorithms.
</code></pre>
<p>Firma</p>
<pre><code>Length as implied by sig type of the signing key used

The signature is of everything above.

If the flag indicates offline keys, the signature is verified with the transient
public key. Otherwise, the signature is verified with the blinded public key.
</code></pre>
<h4 id="layer-1-middle">Layer 1 (middle)</h4>
<p>Banderas</p>
<pre><code>1 byte

Bit order: 76543210

Bit 0: 0 for everybody, 1 for per-client, auth section to follow

Bits 3-1: Authentication scheme, only if bit 0 is set to 1 for per-client, otherwise 000
          000: DH client authentication (or no per-client authentication)
          001: PSK client authentication

Bits 7-4: Unused, set to 0 for future compatibility
</code></pre>
<p>Datos de autenticación del cliente DH</p>
<pre><code>Present if flag bit 0 is set to 1 and flag bits 3-1 are set to 000.

ephemeralPublicKey
    32 bytes

clients
    2 bytes, big endian

    Number of authClient entries to follow, 40 bytes each

authClient
    Authorization data for a single client.
    See below for the per-client authorization algorithm.

    clientID_i
        8 bytes

    clientCookie_i
        32 bytes
</code></pre>
<p>Datos de autenticación de cliente PSK</p>
<pre><code>Present if flag bit 0 is set to 1 and flag bits 3-1 are set to 001.

authSalt
    32 bytes

clients
    2 bytes, big endian

    Number of authClient entries to follow, 40 bytes each

authClient
    Authorization data for a single client.
    See below for the per-client authorization algorithm.

    clientID_i
        8 bytes

    clientCookie_i
        32 bytes
</code></pre>
<p>innerCiphertext</p>
<pre><code>Length implied by lenOuterCiphertext (whatever data remains)

Encrypted layer 2 data. See below for key derivation and encryption algorithms.
</code></pre>
<h4 id="layer-2-inner">Layer 2 (inner)</h4>
<p>Tipo</p>
<pre><code>1 byte

Either 3 (LS2) or 7 (Meta LS2)
</code></pre>
<p>Datos</p>
<pre><code>LeaseSet2 data for the given type.

Includes the header and signature.
</code></pre>
<h3 id="nuevos-problemas-de-cifrado">Nuevos Problemas de Cifrado</h3>
<p>Utilizamos el siguiente esquema para el cegado de claves, basado en Ed25519 y <a href="https://github.com/zcash/zips/tree/master/protocol/protocol.pdf">ZCash RedDSA</a>
. Las firmas Re25519 son sobre la curva Ed25519, utilizando SHA-512 para el hash.</p>
<p>No utilizamos <a href="https://spec.torproject.org/rend-spec-v3">el apéndice A.2 de rend-spec-v3.txt de Tor</a>
, que tiene objetivos de diseño similares, porque sus claves públicas cegadas pueden estar fuera del subgrupo de orden primo, con implicaciones de seguridad desconocidas.</p>
<h4 id="goals-1">Goals</h4>
<ul>
<li>La clave pública de firma en el destino sin cegar debe ser
Ed25519 (tipo de firma 7) o Red25519 (tipo de firma 11);
no se admiten otros tipos de firma</li>
<li>Si la clave pública de firma está offline, la clave pública de firma transitoria también debe ser Ed25519</li>
<li>El cegado es computacionalmente simple</li>
<li>Usa primitivas criptográficas existentes</li>
<li>Las claves públicas cegadas no pueden ser descegadas</li>
<li>Las claves públicas cegadas deben estar en la curva Ed25519 y el subgrupo de orden primo</li>
<li>Debe conocer la clave pública de firma del destino
(no se requiere el destino completo) para derivar la clave pública cegada</li>
<li>Opcionalmente proporcionar un secreto adicional requerido para derivar la clave pública cegada</li>
</ul>
<h4 id="security">Security</h4>
<p>La seguridad de un esquema de blinding requiere que la distribución de alpha sea la misma que las claves privadas sin blinding. Sin embargo, cuando aplicamos blinding a una clave privada Ed25519 (tipo de firma 7) para obtener una clave privada Red25519 (tipo de firma 11), la distribución es diferente. Para cumplir con los requisitos de <a href="https://github.com/zcash/zips/tree/master/protocol/protocol.pdf">zcash sección 4.1.6.1</a>
, Red25519 (tipo de firma 11) debería usarse también para las claves sin blinding, de modo que &ldquo;la combinación de una clave pública re-aleatorizada y firma(s) bajo esa clave no revelen la clave de la cual fue re-aleatorizada.&rdquo; Permitimos el tipo 7 para destinos existentes, pero recomendamos el tipo 11 para nuevos destinos que serán cifrados.</p>
<h4 id="definitions">Definitions</h4>
<p>B</p>
<pre><code>The Ed25519 base point (generator) 2^255 - 19 as in [Ed25519](http://cr.yp.to/papers.html#ed25519)
</code></pre>
<p>L</p>
<pre><code>The Ed25519 order 2^252 + 27742317777372353535851937790883648493
as in [Ed25519](http://cr.yp.to/papers.html#ed25519)
</code></pre>
<p>DERIVE_PUBLIC(a)</p>
<pre><code>Convert a private key to public, as in Ed25519 (mulitply by G)
</code></pre>
<p>alpha</p>
<pre><code>A 32-byte random number known to those who know the destination.
</code></pre>
<p>GENERATE_ALPHA(destination, date, secret)</p>
<pre><code>Generate alpha for the current date, for those who know the destination and the secret.
The result must be identically distributed as Ed25519 private keys.
</code></pre>
<p>a</p>
<pre><code>The unblinded 32-byte EdDSA or RedDSA signing private key used to sign the destination
</code></pre>
<p>A</p>
<pre><code>The unblinded 32-byte EdDSA or RedDSA signing public key in the destination,
= DERIVE_PUBLIC(a), as in Ed25519
</code></pre>
<p>a&rsquo;</p>
<pre><code>The blinded 32-byte EdDSA signing private key used to sign the encrypted leaseset
This is a valid EdDSA private key.
</code></pre>
<p>A'</p>
<pre><code>The blinded 32-byte EdDSA signing public key in the Destination,
may be generated with DERIVE_PUBLIC(a'), or from A and alpha.
This is a valid EdDSA public key, on the curve and on the prime-order subgroup.
</code></pre>
<p>LEOS2IP(x)</p>
<pre><code>Flip the order of the input bytes to little-endian
</code></pre>
<p>H*(x)</p>
<pre><code>32 bytes = (LEOS2IP(SHA512(x))) mod B, same as in Ed25519 hash-and-reduce
</code></pre>
<h4 id="blinding-calculations">Blinding Calculations</h4>
<p>Una nueva clave alfa secreta y claves cegadas deben generarse cada día (UTC). La alfa secreta y las claves cegadas se calculan de la siguiente manera.</p>
<p>GENERATE_ALPHA(destination, date, secret), para todas las partes:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>// GENERATE_ALPHA(destination, date, secret)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  // secret is optional, else zero-length
</span></span><span style="display:flex;"><span>  A = destination&#39;s signing public key
</span></span><span style="display:flex;"><span>  stA = signature type of A, 2 bytes big endian (0x0007 or 0x000b)
</span></span><span style="display:flex;"><span>  stA&#39; = signature type of blinded public key A&#39;, 2 bytes big endian (0x000b)
</span></span><span style="display:flex;"><span>  keydata = A || stA || stA&#39;
</span></span><span style="display:flex;"><span>  datestring = 8 bytes ASCII YYYYMMDD from the current date UTC
</span></span><span style="display:flex;"><span>  secret = UTF-8 encoded string
</span></span><span style="display:flex;"><span>  seed = HKDF(H(&#34;I2PGenerateAlpha&#34;, keydata), datestring || secret, &#34;i2pblinding1&#34;, 64)
</span></span><span style="display:flex;"><span>  // treat seed as a 64 byte little-endian value
</span></span><span style="display:flex;"><span>  alpha = seed mod L
</span></span></code></pre></div><p>BLIND_PRIVKEY(), para el propietario que publica el leaseset:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>// BLIND_PRIVKEY()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  alpha = GENERATE_ALPHA(destination, date, secret)
</span></span><span style="display:flex;"><span>  // If for a Ed25519 private key (type 7)
</span></span><span style="display:flex;"><span>  seed = destination&#39;s signing private key
</span></span><span style="display:flex;"><span>  a = left half of SHA512(seed) and clamped as usual for Ed25519
</span></span><span style="display:flex;"><span>  // else, for a Red25519 private key (type 11)
</span></span><span style="display:flex;"><span>  a = destination&#39;s signing private key
</span></span><span style="display:flex;"><span>  // Addition using scalar arithmentic
</span></span><span style="display:flex;"><span>  blinded signing private key = a&#39; = BLIND_PRIVKEY(a, alpha) = (a + alpha) mod L
</span></span><span style="display:flex;"><span>  blinded signing public key = A&#39; = DERIVE_PUBLIC(a&#39;)
</span></span></code></pre></div><p>BLIND_PUBKEY(), para los clientes que recuperan el leaseSet:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>// BLIND_PUBKEY()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  alpha = GENERATE_ALPHA(destination, date, secret)
</span></span><span style="display:flex;"><span>  A = destination&#39;s signing public key
</span></span><span style="display:flex;"><span>  // Addition using group elements (points on the curve)
</span></span><span style="display:flex;"><span>  blinded public key = A&#39; = BLIND_PUBKEY(A, alpha) = A + DERIVE_PUBLIC(alpha)
</span></span></code></pre></div><p>Ambos métodos para calcular A&rsquo; producen el mismo resultado, como se requiere.</p>
<h4 id="signing">Signing</h4>
<p>El leaseSet no cegado es firmado por la clave privada de firma Ed25519 o Red25519 no cegada y verificado con la clave pública de firma Ed25519 o Red25519 no cegada (tipos de firma 7 u 11) como es habitual.</p>
<p>Si la clave pública de firma está desconectada, el leaseset no cegado es firmado por la clave privada de firma transitoria Ed25519 o Red25519 no cegada y verificado con la clave pública de firma transitoria Ed25519 o Red25519 no cegada (tipos de firma 7 u 11) como es habitual. Consulte más abajo las notas adicionales sobre claves desconectadas para leasesets cifrados.</p>
<p>Para la firma del leaseset cifrado, utilizamos Red25519, basado en <a href="https://github.com/zcash/zips/tree/master/protocol/protocol.pdf">RedDSA</a>
 para firmar y verificar con claves cegadas. Las firmas Red25519 se realizan sobre la curva Ed25519, utilizando SHA-512 para el hash.</p>
<p>Red25519 es idéntico al Ed25519 estándar excepto por lo especificado a continuación.</p>
<h4 id="signverify-calculations">Sign/Verify Calculations</h4>
<p>La porción externa del leaseset cifrado utiliza claves y firmas Red25519.</p>
<p>Red25519 es casi idéntico a Ed25519. Hay dos diferencias:</p>
<p>Las claves privadas Red25519 se generan a partir de números aleatorios y luego deben reducirse mod L, donde L se define arriba. Las claves privadas Ed25519 se generan a partir de números aleatorios y luego se &ldquo;sujetan&rdquo; usando enmascaramiento bit a bit en los bytes 0 y 31. Esto no se hace para Red25519. Las funciones GENERATE_ALPHA() y BLIND_PRIVKEY() definidas arriba generan claves privadas Red25519 adecuadas usando mod L.</p>
<p>En Red25519, el cálculo de r para la firma utiliza datos aleatorios adicionales, y usa el valor de la clave pública en lugar del hash de la clave privada. Debido a los datos aleatorios, cada firma Red25519 es diferente, incluso al firmar los mismos datos con la misma clave.</p>
<p>Firma:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>T = 80 random bytes
</span></span><span style="display:flex;"><span>  r = H*(T || publickey || message)
</span></span><span style="display:flex;"><span>  // rest is the same as in Ed25519
</span></span></code></pre></div><p>Verificación:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>// same as in Ed25519
</span></span></code></pre></div><h3 id="notas-2">Notas</h3>
<h4 id="derivation-of-subcredentials">Derivation of subcredentials</h4>
<p>Como parte del proceso de ofuscación, necesitamos asegurar que un LS2 cifrado solo pueda ser descifrado por alguien que conozca la clave pública de firma del Destination correspondiente. No se requiere el Destination completo. Para lograr esto, derivamos una credencial de la clave pública de firma:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>A = destination&#39;s signing public key
</span></span><span style="display:flex;"><span>  stA = signature type of A, 2 bytes big endian (0x0007 or 0x000b)
</span></span><span style="display:flex;"><span>  stA&#39; = signature type of A&#39;, 2 bytes big endian (0x000b)
</span></span><span style="display:flex;"><span>  keydata = A || stA || stA&#39;
</span></span><span style="display:flex;"><span>  credential = H(&#34;credential&#34;, keydata)
</span></span></code></pre></div><p>La cadena de personalización asegura que la credencial no colisione con ningún hash utilizado como clave de búsqueda DHT, como el hash de Destination plano.</p>
<p>Para una clave ciega dada, podemos entonces derivar una subcredencial:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>subcredential = H(&#34;subcredential&#34;, credential || blindedPublicKey)
</span></span></code></pre></div><p>La subcredencial se incluye en los procesos de derivación de claves a continuación, lo que vincula esas claves al conocimiento de la clave pública de firma del Destination.</p>
<h4 id="layer-1-encryption">Layer 1 encryption</h4>
<p>Primero, se prepara la entrada para el proceso de derivación de claves:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>outerInput = subcredential || publishedTimestamp
</span></span></code></pre></div><p>A continuación, se genera una sal aleatoria:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>outerSalt = CSRNG(32)
</span></span></code></pre></div><p>Luego se deriva la clave utilizada para cifrar la capa 1:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>keys = HKDF(outerSalt, outerInput, &#34;ELS2_L1K&#34;, 44)
</span></span><span style="display:flex;"><span>  outerKey = keys[0:31]
</span></span><span style="display:flex;"><span>  outerIV = keys[32:43]
</span></span></code></pre></div><p>Finalmente, el texto plano de la capa 1 es cifrado y serializado:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>outerCiphertext = outerSalt || ENCRYPT(outerKey, outerIV, outerPlaintext)
</span></span></code></pre></div><h4 id="layer-1-decryption">Layer 1 decryption</h4>
<p>La salt se analiza desde el texto cifrado de la capa 1:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>outerSalt = outerCiphertext[0:31]
</span></span></code></pre></div><p>Luego se deriva la clave utilizada para cifrar la capa 1:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>outerInput = subcredential || publishedTimestamp
</span></span><span style="display:flex;"><span>  keys = HKDF(outerSalt, outerInput, &#34;ELS2_L1K&#34;, 44)
</span></span><span style="display:flex;"><span>  outerKey = keys[0:31]
</span></span><span style="display:flex;"><span>  outerIV = keys[32:43]
</span></span></code></pre></div><p>Finalmente, el texto cifrado de la capa 1 es descifrado:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>outerPlaintext = DECRYPT(outerKey, outerIV, outerCiphertext[32:end])
</span></span></code></pre></div><h4 id="layer-2-encryption">Layer 2 encryption</h4>
<p>Cuando la autorización de cliente está habilitada, <code>authCookie</code> se calcula como se describe a continuación. Cuando la autorización de cliente está deshabilitada, <code>authCookie</code> es el arreglo de bytes de longitud cero.</p>
<p>El cifrado procede de manera similar a la capa 1:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>innerInput = authCookie || subcredential || publishedTimestamp
</span></span><span style="display:flex;"><span>  innerSalt = CSRNG(32)
</span></span><span style="display:flex;"><span>  keys = HKDF(innerSalt, innerInput, &#34;ELS2_L2K&#34;, 44)
</span></span><span style="display:flex;"><span>  innerKey = keys[0:31]
</span></span><span style="display:flex;"><span>  innerIV = keys[32:43]
</span></span><span style="display:flex;"><span>  innerCiphertext = innerSalt || ENCRYPT(innerKey, innerIV, innerPlaintext)
</span></span></code></pre></div><h4 id="layer-2-decryption">Layer 2 decryption</h4>
<p>Cuando la autorización de cliente está habilitada, <code>authCookie</code> se calcula como se describe a continuación. Cuando la autorización de cliente está deshabilitada, <code>authCookie</code> es el array de bytes de longitud cero.</p>
<p>La descifrado procede de manera similar a la capa 1:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>innerInput = authCookie || subcredential || publishedTimestamp
</span></span><span style="display:flex;"><span>  innerSalt = innerCiphertext[0:31]
</span></span><span style="display:flex;"><span>  keys = HKDF(innerSalt, innerInput, &#34;ELS2_L2K&#34;, 44)
</span></span><span style="display:flex;"><span>  innerKey = keys[0:31]
</span></span><span style="display:flex;"><span>  innerIV = keys[32:43]
</span></span><span style="display:flex;"><span>  innerPlaintext = DECRYPT(innerKey, innerIV, innerCiphertext[32:end])
</span></span></code></pre></div><h3 id="ls2-cifrado">LS2 Cifrado</h3>
<p>Cuando la autorización de cliente está habilitada para un Destination, el servidor mantiene una lista de clientes a los que está autorizando para descifrar los datos cifrados del LS2. Los datos almacenados por cliente dependen del mecanismo de autorización, e incluyen algún tipo de material de clave que cada cliente genera y envía al servidor a través de un mecanismo seguro fuera de banda.</p>
<p>Existen dos alternativas para implementar la autorización por cliente:</p>
<h4 id="dh-client-authorization">DH client authorization</h4>
<p>Cada cliente genera un par de claves DH <code>[csk_i, cpk_i]</code>, y envía la clave pública <code>cpk_i</code> al servidor.</p>
<p>Procesamiento del servidor
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</p>
<p>El servidor genera una nueva <code>authCookie</code> y un par de claves DH efímero:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>authCookie = CSRNG(32)
</span></span><span style="display:flex;"><span>  esk = GENERATE_PRIVATE()
</span></span><span style="display:flex;"><span>  epk = DERIVE_PUBLIC(esk)
</span></span></code></pre></div><p>Luego, para cada cliente autorizado, el servidor encripta <code>authCookie</code> a su clave pública:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>sharedSecret = DH(esk, cpk_i)
</span></span><span style="display:flex;"><span>  authInput = sharedSecret || cpk_i || subcredential || publishedTimestamp
</span></span><span style="display:flex;"><span>  okm = HKDF(epk, authInput, &#34;ELS2_XCA&#34;, 52)
</span></span><span style="display:flex;"><span>  clientKey_i = okm[0:31]
</span></span><span style="display:flex;"><span>  clientIV_i = okm[32:43]
</span></span><span style="display:flex;"><span>  clientID_i = okm[44:51]
</span></span><span style="display:flex;"><span>  clientCookie_i = ENCRYPT(clientKey_i, clientIV_i, authCookie)
</span></span></code></pre></div><p>El servidor coloca cada tupla <code>[clientID_i, clientCookie_i]</code> en la capa 1 del LS2 cifrado, junto con <code>epk</code>.</p>
<p>Procesamiento del cliente
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</p>
<p>El cliente utiliza su clave privada para derivar su identificador de cliente esperado <code>clientID_i</code>, clave de cifrado <code>clientKey_i</code>, y IV de cifrado <code>clientIV_i</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>sharedSecret = DH(csk_i, epk)
</span></span><span style="display:flex;"><span>  authInput = sharedSecret || cpk_i || subcredential || publishedTimestamp
</span></span><span style="display:flex;"><span>  okm = HKDF(epk, authInput, &#34;ELS2_XCA&#34;, 52)
</span></span><span style="display:flex;"><span>  clientKey_i = okm[0:31]
</span></span><span style="display:flex;"><span>  clientIV_i = okm[32:43]
</span></span><span style="display:flex;"><span>  clientID_i = okm[44:51]
</span></span></code></pre></div><p>Luego el cliente busca en los datos de autorización de la capa 1 una entrada que contenga <code>clientID_i</code>. Si existe una entrada coincidente, el cliente la descifra para obtener <code>authCookie</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>authCookie = DECRYPT(clientKey_i, clientIV_i, clientCookie_i)
</span></span></code></pre></div><h4 id="pre-shared-key-client-authorization">Pre-shared key client authorization</h4>
<p>Cada cliente genera una clave secreta de 32 bytes <code>psk_i</code>, y la envía al servidor. Alternativamente, el servidor puede generar la clave secreta y enviarla a uno o más clientes.</p>
<p>Procesamiento del servidor
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</p>
<p>El servidor genera un nuevo <code>authCookie</code> y salt:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>authCookie = CSRNG(32)
</span></span><span style="display:flex;"><span>  authSalt = CSRNG(32)
</span></span></code></pre></div><p>Luego, para cada cliente autorizado, el servidor encripta <code>authCookie</code> con su clave pre-compartida:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>authInput = psk_i || subcredential || publishedTimestamp
</span></span><span style="display:flex;"><span>  okm = HKDF(authSalt, authInput, &#34;ELS2PSKA&#34;, 52)
</span></span><span style="display:flex;"><span>  clientKey_i = okm[0:31]
</span></span><span style="display:flex;"><span>  clientIV_i = okm[32:43]
</span></span><span style="display:flex;"><span>  clientID_i = okm[44:51]
</span></span><span style="display:flex;"><span>  clientCookie_i = ENCRYPT(clientKey_i, clientIV_i, authCookie)
</span></span></code></pre></div><p>El servidor coloca cada tupla <code>[clientID_i, clientCookie_i]</code> en la capa 1 del LS2 cifrado, junto con <code>authSalt</code>.</p>
<p>Procesamiento del cliente
^^^^^^^^^^^^^^^^^^^^^</p>
<p>El cliente utiliza su clave precompartida para derivar su identificador de cliente esperado <code>clientID_i</code>, clave de cifrado <code>clientKey_i</code>, y IV de cifrado <code>clientIV_i</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>authInput = psk_i || subcredential || publishedTimestamp
</span></span><span style="display:flex;"><span>  okm = HKDF(authSalt, authInput, &#34;ELS2PSKA&#34;, 52)
</span></span><span style="display:flex;"><span>  clientKey_i = okm[0:31]
</span></span><span style="display:flex;"><span>  clientIV_i = okm[32:43]
</span></span><span style="display:flex;"><span>  clientID_i = okm[44:51]
</span></span></code></pre></div><p>Luego el cliente busca en los datos de autorización de capa 1 una entrada que contenga <code>clientID_i</code>. Si existe una entrada coincidente, el cliente la descifra para obtener <code>authCookie</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>authCookie = DECRYPT(clientKey_i, clientIV_i, clientCookie_i)
</span></span></code></pre></div><h4 id="security-considerations">Security considerations</h4>
<p>Ambos mecanismos de autorización de cliente anteriores proporcionan privacidad para la membresía de cliente. Una entidad que solo conoce el Destination puede ver cuántos clientes están suscritos en cualquier momento, pero no puede rastrear qué clientes están siendo agregados o revocados.</p>
<p>Los servidores DEBERÍAN aleatorizar el orden de los clientes cada vez que generen un LS2 cifrado, para evitar que los clientes conozcan su posición en la lista e infieran cuándo otros clientes han sido añadidos o revocados.</p>
<p>Un servidor PUEDE elegir ocultar el número de clientes que están suscritos insertando entradas aleatorias en la lista de datos de autorización.</p>
<p>Ventajas de la autorización de cliente DH
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</p>
<ul>
<li>La seguridad del esquema no depende únicamente del intercambio fuera de banda del
material de clave del cliente. La clave privada del cliente nunca necesita salir de su
dispositivo, por lo que un adversario que sea capaz de interceptar el intercambio fuera de
banda, pero no pueda romper el algoritmo DH, no puede descifrar el LS2 cifrado, ni
determinar por cuánto tiempo se le otorga acceso al cliente.</li>
</ul>
<p>Desventajas de la autorización de cliente DH
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</p>
<ul>
<li>Requiere N + 1 operaciones DH en el lado del servidor para N clientes.</li>
<li>Requiere una operación DH en el lado del cliente.</li>
<li>Requiere que el cliente genere la clave secreta.</li>
</ul>
<p>Ventajas de la autorización de cliente PSK
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</p>
<ul>
<li>No requiere operaciones DH.</li>
<li>Permite al servidor generar la clave secreta.</li>
<li>Permite al servidor compartir la misma clave con múltiples clientes, si se desea.</li>
</ul>
<p>Desventajas de la autorización de cliente PSK
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</p>
<ul>
<li>La seguridad del esquema depende críticamente del intercambio fuera de banda del material de clave del cliente. Un adversario que intercepte el intercambio para un cliente particular puede descifrar cualquier LS2 cifrado posterior para el cual ese cliente esté autorizado, así como determinar cuándo se revoca el acceso del cliente.</li>
</ul>
<h3 id="definiciones">Definiciones</h3>
<p>Consulta la propuesta 149.</p>
<p>No puedes usar un LS2 encriptado para bittorrent, debido a las respuestas de anuncio compactas que son de 32 bytes. Los 32 bytes contienen solo el hash. No hay espacio para una indicación de que el leaseset está encriptado, o los tipos de firma.</p>
<h3 id="formato-3">Formato</h3>
<p>Para leaseSets cifrados con claves offline, las claves privadas cegadas también deben generarse offline, una para cada día.</p>
<p>Como el bloque de firma offline opcional está en la parte de texto claro del leaseset cifrado, cualquiera que rastree los floodfills podría usar esto para rastrear el leaseset (pero no descifrarlo) durante varios días. Para prevenir esto, el propietario de las claves también debería generar nuevas claves transitorias para cada día. Tanto las claves transitorias como las cegadas pueden generarse con anticipación y entregarse al router en un lote.</p>
<p>No se define ningún formato de archivo en esta propuesta para empaquetar múltiples claves transitorias y ciegas y proporcionarlas al cliente o router. No se define ninguna mejora del protocolo I2CP en esta propuesta para soportar leaseSets cifrados con claves sin conexión.</p>
<h3 id="notes-1">Notes</h3>
<ul>
<li>
<p>Un servicio que utilice leaseSets cifrados publicaría la versión cifrada a los
floodfills. Sin embargo, por eficiencia, enviaría leaseSets sin cifrar a los
clientes en el mensaje garlic envuelto, una vez autenticado (mediante whitelist, por
ejemplo).</p>
</li>
<li>
<p>Los floodfills pueden limitar el tamaño máximo a un valor razonable para prevenir abuso.</p>
</li>
<li>
<p>Después del descifrado, se deben realizar varias verificaciones, incluyendo que
la marca de tiempo interna y la expiración coincidan con las del nivel superior.</p>
</li>
<li>
<p>ChaCha20 fue seleccionado en lugar de AES. Aunque las velocidades son similares si el soporte de hardware AES está disponible, ChaCha20 es 2.5-3x más rápido cuando el soporte de hardware AES no está disponible, como en dispositivos ARM de gama baja.</p>
</li>
<li>
<p>No nos importa lo suficiente la velocidad como para usar BLAKE2b con clave. Tiene un
tamaño de salida lo suficientemente grande para acomodar la n más grande que requerimos (o podemos llamarlo una vez por
clave deseada con un argumento contador). BLAKE2b es mucho más rápido que SHA-256, y
BLAKE2b con clave reduciría el número total de llamadas a funciones hash.
Sin embargo, ver propuesta 148, donde se propone que cambiemos a BLAKE2b por otras razones.
Ver <a href="https://www.lvh.io/posts/secure-key-derivation-performance.html">Secure key derivation performance</a>
.</p>
</li>
</ul>
<h3 id="meta-ls2">Meta LS2</h3>
<p>Esto se utiliza para reemplazar multihoming. Como cualquier leaseSet, está firmado por el creador. Esta es una lista autenticada de hashes de destino.</p>
<p>El Meta LS2 es la cima de, y posiblemente los nodos intermedios de, una estructura de árbol. Contiene un número de entradas, cada una apuntando a un LS, LS2, o otro Meta LS2 para soportar multihoming masivo. Un Meta LS2 puede contener una mezcla de entradas LS, LS2, y Meta LS2. Las hojas del árbol son siempre un LS o LS2. El árbol es un DAG; los bucles están prohibidos; los clientes que realizan búsquedas deben detectar y rechazar seguir bucles.</p>
<p>Un Meta LS2 puede tener una expiración mucho más larga que un LS o LS2 estándar. El nivel superior puede tener una expiración varias horas después de la fecha de publicación. El tiempo máximo de expiración será aplicado por floodfills y clientes, y está por determinar.</p>
<p>El caso de uso para Meta LS2 es multihoming masivo, pero sin más protección para la correlación de routers con leasesets (en el momento de reinicio del router) de la que se proporciona actualmente con LS o LS2. Esto es equivalente al caso de uso de &ldquo;facebook&rdquo;, que probablemente no necesita protección contra correlación. Este caso de uso probablemente necesita claves sin conexión, que se proporcionan en el encabezado estándar en cada nodo del árbol.</p>
<p>El protocolo de back-end para la coordinación entre los routers hoja, los firmantes Meta LS intermedios y maestros no se especifica aquí. Los requisitos son extremadamente simples: solo verificar que el peer esté activo y publicar un nuevo LS cada pocas horas. La única complejidad es elegir nuevos publicadores para los Meta LSes de nivel superior o intermedio en caso de falla.</p>
<p>Los leasesets de mezcla y combinación donde las leases de múltiples routers se combinan, firman y publican en un solo leaseset está documentado en la propuesta 140, &ldquo;multihoming invisible&rdquo;. Esta propuesta es insostenible tal como está escrita, porque las conexiones de streaming no serían &ldquo;pegajosas&rdquo; a un solo router, ver <a href="http://zzz.i">http://zzz.i</a>
2p/topics/2335 .</p>
<p>El protocolo de back-end, y la interacción con los componentes internos del router y cliente, sería bastante compleja para el multihoming invisible.</p>
<p>Para evitar sobrecargar el floodfill para el Meta LS de nivel superior, la expiración debe ser de al menos varias horas. Los clientes deben almacenar en caché el Meta LS de nivel superior y mantenerlo después de reinicios si no ha expirado.</p>
<p>Necesitamos definir algún algoritmo para que los clientes atraviesen el árbol, incluyendo respaldos, de manera que el uso se disperse. Alguna función de distancia hash, costo y aleatoriedad. Si un nodo tiene tanto LS o LS2 como Meta LS, necesitamos saber cuándo está permitido usar esos leasesets, y cuándo continuar atravesando el árbol.</p>
<p>Buscar con</p>
<pre><code>Standard LS flag (1)
</code></pre>
<p>Almacenar con</p>
<pre><code>Meta LS2 type (7)
</code></pre>
<p>Almacenar en</p>
<pre><code>Hash of destination
This hash is then used to generate the daily &quot;routing key&quot;, as in LS1
</code></pre>
<p>Expiración típica</p>
<pre><code>Hours. Max 18.2 hours (65535 seconds)
</code></pre>
<p>Publicado por</p>
<pre><code>&quot;master&quot; Destination or coordinator, or intermediate coordinators
</code></pre>
<h3 id="format">Format</h3>
<pre tabindex="0"><code>Standard LS2 Header as specified above

  Meta LS2 Type-Specific Part
  - Properties (Mapping as specified in common structures spec, 2 zero bytes if none)
  - Number of entries (1 byte) Maximum TBD
  - Entries. Each entry contains: (40 bytes)
    - Hash (32 bytes)
    - Flags (2 bytes)
      TBD. Set all to zero for compatibility with future uses.
    - Type (1 byte) The type of LS it is referencing;
      1 for LS, 3 for LS2, 5 for encrypted, 7 for meta, 0 for unknown.
    - Cost (priority) (1 byte)
    - Expires (4 bytes) (4 bytes, big endian, seconds since epoch, rolls over in 2106)
  - Number of revocations (1 byte) Maximum TBD
  - Revocations: Each revocation contains: (32 bytes)
    - Hash (32 bytes)

  Standard LS2 Signature:
  - Signature (40+ bytes)
    The signature is of everything above.
</code></pre><p>Flags and properties: para uso futuro</p>
<h3 id="derivación-de-clave-de-ocultación">Derivación de Clave de Ocultación</h3>
<ul>
<li>
<p>Un servicio distribuido que use esto tendría uno o más &ldquo;maestros&rdquo; con la
clave privada del destino del servicio. Estos determinarían (fuera de banda) la
lista actual de destinos activos y publicarían el Meta LS2. Para redundancia,
múltiples maestros podrían hacer multihome (es decir, publicar concurrentemente)
el Meta LS2.</p>
</li>
<li>
<p>Un servicio distribuido podría comenzar con un solo destino o usar
multihoming de estilo antiguo, luego hacer la transición a un Meta LS2. Una
búsqueda de LS estándar podría devolver cualquiera de un LS, LS2, o Meta LS2.</p>
</li>
<li>
<p>Cuando un servicio utiliza un Meta LS2, no tiene túneles (leases).</p>
</li>
</ul>
<h3 id="service-record">Service Record</h3>
<p>Este es un registro individual que indica que un destino está participando en un servicio. Se envía desde el participante al floodfill. Nunca se envía individualmente por un floodfill, sino únicamente como parte de una Lista de Servicios. El Service Record también se utiliza para revocar la participación en un servicio, estableciendo la expiración en cero.</p>
<p>Esto no es un LS2 pero usa el formato estándar de encabezado y firma LS2.</p>
<p>Buscar con</p>
<pre><code>n/a, see Service List
</code></pre>
<p>Almacenar con</p>
<pre><code>Service Record type (9)
</code></pre>
<p>Almacenar en</p>
<pre><code>Hash of service name
This hash is then used to generate the daily &quot;routing key&quot;, as in LS1
</code></pre>
<p>Vencimiento típico</p>
<pre><code>Hours. Max 18.2 hours (65535 seconds)
</code></pre>
<p>Publicado por</p>
<pre><code>Destination
</code></pre>
<h3 id="format-1">Format</h3>
<pre tabindex="0"><code>Standard LS2 Header as specified above

  Service Record Type-Specific Part
  - Port (2 bytes, big endian) (0 if unspecified)
  - Hash of service name (32 bytes)

  Standard LS2 Signature:
  - Signature (40+ bytes)
    The signature is of everything above.
</code></pre><h3 id="notes-2">Notes</h3>
<ul>
<li>
<p>Si expires es todo ceros, el floodfill debería revocar el registro y ya no
incluirlo en la lista de servicios.</p>
</li>
<li>
<p>Almacenamiento: El floodfill puede limitar estrictamente el almacenamiento de estos registros y
limitar el número de registros almacenados por hash y su expiración. También se puede
usar una lista blanca de hashes.</p>
</li>
<li>
<p>Cualquier otro tipo de netdb en el mismo hash tiene prioridad, por lo que un registro de servicio nunca puede
sobrescribir un LS/RI, pero un LS/RI sobrescribirá todos los registros de servicio en ese hash.</p>
</li>
</ul>
<h3 id="service-list">Service List</h3>
<p>Esto no se parece en nada a un LS2 y usa un formato diferente.</p>
<p>La lista de servicios es creada y firmada por el floodfill. No está autenticada en el sentido de que cualquiera puede unirse a un servicio publicando un Registro de Servicio a un floodfill.</p>
<p>Una Lista de Servicios contiene Registros de Servicio Cortos, no Registros de Servicio completos. Estos contienen firmas pero solo hashes, no destinos completos, por lo que no pueden ser verificados sin el destino completo.</p>
<p>La seguridad, si la hay, y la conveniencia de las listas de servicios está por determinar. Los floodfills podrían limitar la publicación, y las búsquedas, a una lista blanca de servicios, pero esa lista blanca puede variar según la implementación o la preferencia del operador. Es posible que no sea posible lograr consenso sobre una lista blanca común base entre implementaciones.</p>
<p>Si el nombre del servicio está incluido en el registro de servicio anterior, entonces los operadores de floodfill pueden objetar; si solo se incluye el hash, no hay verificación, y un registro de servicio podría &ldquo;colarse&rdquo; antes que cualquier otro tipo de netdb y almacenarse en el floodfill.</p>
<p>Buscar con</p>
<pre><code>Service List lookup type (11)
</code></pre>
<p>Almacenar con</p>
<pre><code>Service List type (11)
</code></pre>
<p>Almacenar en</p>
<pre><code>Hash of service name
This hash is then used to generate the daily &quot;routing key&quot;, as in LS1
</code></pre>
<p>Expiración típica</p>
<pre><code>Hours, not specified in the list itself, up to local policy
</code></pre>
<p>Publicado por</p>
<pre><code>Nobody, never sent to floodfill, never flooded.
</code></pre>
<h3 id="format-2">Format</h3>
<p>NO utiliza el encabezado estándar LS2 especificado anteriormente.</p>
<pre tabindex="0"><code>- Type (1 byte)
    Not actually in header, but part of data covered by signature.
    Take from field in Database Store Message.
  - Hash of the service name (implicit, in the Database Store message)
  - Hash of the Creator (floodfill) (32 bytes)
  - Published timestamp (8 bytes, big endian)

  - Number of Short Service Records (1 byte)
  - List of Short Service Records:
    Each Short Service Record contains (90+ bytes)
    - Dest hash (32 bytes)
    - Published timestamp (8 bytes, big endian)
    - Expires (4 bytes, big endian) (offset from published in ms)
    - Flags (2 bytes)
    - Port (2 bytes, big endian)
    - Sig length (2 bytes, big endian)
    - Signature of dest (40+ bytes)

  - Number of Revocation Records (1 byte)
  - List of Revocation Records:
    Each Revocation Record contains (86+ bytes)
    - Dest hash (32 bytes)
    - Published timestamp (8 bytes, big endian)
    - Flags (2 bytes)
    - Port (2 bytes, big endian)
    - Sig length (2 bytes, big endian)
    - Signature of dest (40+ bytes)

  - Signature of floodfill (40+ bytes)
    The signature is of everything above.
</code></pre><p>Para verificar la firma de la Lista de Servicios:</p>
<ul>
<li>anteponer el hash del nombre del servicio</li>
<li>eliminar el hash del creador</li>
<li>Verificar la firma del contenido modificado</li>
</ul>
<p>Para verificar la firma de cada Short Service Record:</p>
<ul>
<li>Obtener destino</li>
<li>Verificar firma de (marca de tiempo publicada + expira + flags + puerto + Hash del
nombre del servicio)</li>
</ul>
<p>Para verificar la firma de cada Registro de Revocación:</p>
<ul>
<li>Obtener destino</li>
<li>Verificar firma de (marca de tiempo publicada + 4 bytes cero + flags + puerto + Hash
del nombre del servicio)</li>
</ul>
<h3 id="notes-3">Notes</h3>
<ul>
<li>
<p>Utilizamos la longitud de firma en lugar del tipo de firma para poder soportar tipos de firma desconocidos.</p>
</li>
<li>
<p>No hay expiración de una lista de servicios, los destinatarios pueden tomar su propia
decisión basada en políticas o la expiración de los registros individuales.</p>
</li>
<li>
<p>Las Service Lists no se inundan, solo los Service Records individuales. Cada
floodfill crea, firma y almacena en caché una Service List. El floodfill usa su
propia política para el tiempo de caché y el número máximo de registros de
servicio y revocación.</p>
</li>
</ul>
<h2 id="common-structures-spec-changes-required">Common Structures Spec Changes Required</h2>
<h3 id="cifrado-y-procesamiento">Cifrado y procesamiento</h3>
<p>Fuera del alcance de esta propuesta. Agregar a las propuestas ECIES 144 y 145.</p>
<h3 id="new-intermediate-structures">New Intermediate Structures</h3>
<p>Agregar nuevas estructuras para Lease2, MetaLease, LeaseSet2Header y OfflineSignature. Efectivo a partir de la versión 0.9.38.</p>
<h3 id="new-netdb-types">New NetDB Types</h3>
<p>Agregar estructuras para cada nuevo tipo de leaseset, incorporadas desde arriba. Para LeaseSet2, EncryptedLeaseSet, y MetaLeaseSet, efectivo a partir de la versión 0.9.38. Para Service Record y Service List, preliminar y sin programar.</p>
<h3 id="new-signature-type">New Signature Type</h3>
<p>Agregar RedDSA_SHA512_Ed25519 Tipo 11. La clave pública es de 32 bytes; la clave privada es de 32 bytes; el hash es de 64 bytes; la firma es de 64 bytes.</p>
<h2 id="encryption-spec-changes-required">Encryption Spec Changes Required</h2>
<p>Fuera del alcance de esta propuesta. Ver propuestas 144 y 145.</p>
<h2 id="i2np-changes-required">I2NP Changes Required</h2>
<p>Agregar nota: LS2 solo puede ser publicado a floodfills con una versión mínima.</p>
<h3 id="database-lookup-message">Database Lookup Message</h3>
<p>Agregar el tipo de búsqueda de lista de servicios.</p>
<h3 id="changes">Changes</h3>
<pre tabindex="0"><code>Flags byte: Lookup type field, currently bits 3-2, expands to bits 4-2.
  Lookup type 0x04 is defined as the service list lookup.

  Add note: Service list loookup may only be sent to floodfills with a minimum version.
  Minimum version is 0.9.38.
</code></pre><h3 id="autorización-por-cliente">Autorización por cliente</h3>
<p>Agregar todos los nuevos tipos de almacén.</p>
<h3 id="changes-1">Changes</h3>
<pre tabindex="0"><code>Type byte: Type field, currently bit 0, expands to bits 3-0.
  Type 3 is defined as a LS2 store.
  Type 5 is defined as a encrypted LS2 store.
  Type 7 is defined as a meta LS2 store.
  Type 9 is defined as a service record store.
  Type 11 is defined as a service list store.
  Other types are undefined and invalid.

  Add note: All new types may only be published to floodfills with a minimum version.
  Minimum version is 0.9.38.
</code></pre><h2 id="i2cp-changes-required">I2CP Changes Required</h2>
<h3 id="i2cp-options">I2CP Options</h3>
<p>Nuevas opciones interpretadas del lado del router, enviadas en el Mapeo SessionConfig:</p>
<pre tabindex="0"><code>
  i2cp.leaseSetType=nnn       The type of leaseset to be sent in the Create Leaseset Message
                              Value is the same as the netdb store type in the table above.
                              Interpreted client-side, but also passed to the router in the
                              SessionConfig, to declare intent and check support.

  i2cp.leaseSetEncType=nnn[,nnn]  The encryption types to be used.
                                  Interpreted client-side, but also passed to the router in
                                  the SessionConfig, to declare intent and check support.
                                  See proposals 144 and 145.

  i2cp.leaseSetOfflineExpiration=nnn  The expiration of the offline signature, ASCII,
                                      seconds since the epoch.

  i2cp.leaseSetTransientPublicKey=[type:]b64  The base 64 of the transient private key,
                                              prefixed by an optional sig type number
                                              or name, default DSA_SHA1.
                                              Length as inferred from the sig type

  i2cp.leaseSetOfflineSignature=b64   The base 64 of the offline signature.
                                      Length as inferred from the destination
                                      signing public key type

  i2cp.leaseSetSecret=b64     The base 64 of a secret used to blind the
                              address of the leaseset, default &#34;&#34;

  i2cp.leaseSetAuthType=nnn   The type of authentication for encrypted LS2.
                              0 for no per-client authentication (the default)
                              1 for DH per-client authentication
                              2 for PSK per-client authentication

  i2cp.leaseSetPrivKey=b64    A base 64 private key for the router to use to
                              decrypt the encrypted LS2,
                              only if per-client authentication is enabled
</code></pre><p>Nuevas opciones interpretadas del lado del cliente:</p>
<pre tabindex="0"><code>
  i2cp.leaseSetType=nnn     The type of leaseset to be sent in the Create Leaseset Message
                            Value is the same as the netdb store type in the table above.
                            Interpreted client-side, but also passed to the router in the
                            SessionConfig, to declare intent and check support.

  i2cp.leaseSetEncType=nnn[,nnn]  The encryption types to be used.
                                  Interpreted client-side, but also passed to the router in
                                  the SessionConfig, to declare intent and check support.
                                  See proposals 144 and 145.

  i2cp.leaseSetSecret=b64     The base 64 of a secret used to blind the
                              address of the leaseset, default &#34;&#34;

  i2cp.leaseSetAuthType=nnn       The type of authentication for encrypted LS2.
                                  0 for no per-client authentication (the default)
                                  1 for DH per-client authentication
                                  2 for PSK per-client authentication

  i2cp.leaseSetBlindedType=nnn   The sig type of the blinded key for encrypted LS2.
                                 Default depends on the destination sig type.

  i2cp.leaseSetClient.dh.nnn=b64name:b64pubkey   The base 64 of the client name (ignored, UI use only),
                                                 followed by a &#39;:&#39;, followed by the base 64 of the public
                                                 key to use for DH per-client auth. nnn starts with 0

  i2cp.leaseSetClient.psk.nnn=b64name:b64privkey   The base 64 of the client name (ignored, UI use only),
                                                   followed by a &#39;:&#39;, followed by the base 64 of the private
                                                   key to use for PSK per-client auth. nnn starts with 0
</code></pre><h3 id="session-config">Session Config</h3>
<p>Tenga en cuenta que para las firmas offline, las opciones i2cp.leaseSetOfflineExpiration, i2cp.leaseSetTransientPublicKey, e i2cp.leaseSetOfflineSignature son requeridas, y la firma es realizada por la clave privada de firma transitoria.</p>
<h3 id="encrypted-ls-con-direcciones-base-32">Encrypted LS con Direcciones Base 32</h3>
<p>Router a cliente. Sin cambios. Los leases se envían con timestamps de 8 bytes, incluso si el leaseset devuelto será un LS2 con timestamps de 4 bytes. Tenga en cuenta que la respuesta puede ser un mensaje Create Leaseset o Create Leaseset2.</p>
<h3 id="ls-cifrado-con-claves-offline">LS Cifrado con Claves Offline</h3>
<p>Router al cliente. Sin cambios. Los leases se envían con marcas de tiempo de 8 bytes, incluso si el leaseset devuelto será un LS2 con marcas de tiempo de 4 bytes. Nota que la respuesta puede ser un mensaje Create Leaseset o Create Leaseset2.</p>
<h3 id="notas-3">Notas</h3>
<p>Cliente al router. Nuevo mensaje, para usar en lugar del Mensaje de Crear LeaseSet.</p>
<h3 id="meta-ls2-1">Meta LS2</h3>
<ul>
<li>
<p>Para que el router analice el tipo de almacén, el tipo debe estar en el mensaje,
a menos que se pase al router de antemano en la configuración de sesión.
Para el código de análisis común, es más fácil tenerlo en el mensaje mismo.</p>
</li>
<li>
<p>Para que el router conozca el tipo y longitud de la clave privada,
debe estar después del leaseSet, a menos que el parser conozca el tipo de antemano
en la configuración de sesión.
Para código de análisis común, es más fácil conocerlo del propio mensaje.</p>
</li>
<li>
<p>La clave privada de firma, previamente definida para revocación y sin usar,
no está presente en LS2.</p>
</li>
</ul>
<h3 id="i-notice-that-the-text-you-provided-only-contains-the-word-format-and-the-instruction----there-doesnt-appear-to-be-any-actual-content-to-translate">I notice that the text you provided only contains the word &ldquo;Format&rdquo; and the instruction &quot;&quot; - there doesn&rsquo;t appear to be any actual content to translate.</h3>
<p>For the word &ldquo;Format&rdquo; by itself, the Spanish translation would be:</p>
<p>Formato</p>
<p>El tipo de mensaje para el Mensaje Create Leaseset2 es 41.</p>
<h3 id="notas-4">Notas</h3>
<pre tabindex="0"><code>Session ID
  Type byte: Type of lease set to follow
             Type 1 is a LS
             Type 3 is a LS2
             Type 5 is a encrypted LS2
             Type 7 is a meta LS2
  LeaseSet: type specified above
  Number of private keys to follow (1 byte)
  Encryption Private Keys: For each public key in the lease set,
                           in the same order
                           (Not present for Meta LS2)
                           - Encryption type (2 bytes, big endian)
                           - Encryption key length (2 bytes, big endian)
                           - Encryption key (number of bytes specified)
</code></pre><h3 id="registro-de-servicio">Registro de Servicio</h3>
<ul>
<li>La versión mínima del router es 0.9.39.</li>
<li>La versión preliminar con tipo de mensaje 40 estaba en 0.9.38 pero el formato fue cambiado.
El tipo 40 está abandonado y no es compatible.</li>
</ul>
<h3 id="formato-4">Formato</h3>
<ul>
<li>Se necesitan más cambios para soportar LS cifrados y meta.</li>
</ul>
<h3 id="notas-5">Notas</h3>
<p>Cliente a router. Mensaje nuevo.</p>
<h3 id="lista-de-servicios">Lista de Servicios</h3>
<ul>
<li>
<p>El router necesita saber si un destino está oculto (blinded).
Si está oculto y utiliza autenticación secreta o por cliente,
también necesita tener esa información.</p>
</li>
<li>
<p>Un Host Lookup de una dirección b32 de nuevo formato (&ldquo;b33&rdquo;)
le dice al router que la dirección está ofuscada, pero no hay mecanismo para
pasar la clave secreta o privada al router en el mensaje Host Lookup.
Aunque podríamos extender el mensaje Host Lookup para añadir esa información,
es más limpio definir un nuevo mensaje.</p>
</li>
<li>
<p>Necesitamos una forma programática para que el cliente le comunique al router.
De lo contrario, el usuario tendría que configurar manualmente cada destino.</p>
</li>
</ul>
<h3 id="formato-5">Formato</h3>
<p>Antes de que un cliente envíe un mensaje a un destino oculto, debe buscar el &ldquo;b33&rdquo; en un mensaje Host Lookup, o enviar un mensaje Blinding Info. Si el destino oculto requiere un secreto o autenticación por cliente, el cliente debe enviar un mensaje Blinding Info.</p>
<p>El router no envía una respuesta a este mensaje.</p>
<h3 id="notas-6">Notas</h3>
<p>El tipo de mensaje para el Blinding Info Message es 42.</p>
<h3 id="format-3">Format</h3>
<pre tabindex="0"><code>Session ID
  Flags:       1 byte
               Bit order: 76543210
               Bit 0: 0 for everybody, 1 for per-client
               Bits 3-1: Authentication scheme, if bit 0 is set to 1 for per-client, otherwise 000
                         000: DH client authentication (or no per-client authentication)
                         001: PSK client authentication
               Bit 4: 1 if secret required, 0 if no secret required
               Bits 7-5: Unused, set to 0 for future compatibility
  Type byte:   Endpoint type to follow
               Type 0 is a Hash
               Type 1 is a host name String
               Type 2 is a Destination
               Type 3 is a Sig Type and Signing Public Key
  Blind Type:  2 byte blinded sig type (big endian)
  Expiration:  4 bytes, big endian, seconds since epoch
  Endpoint:    Data as specified above
               For type 0: 32 byte binary hash
               For type 1: host name String
               For type 2: binary Destination
               For type 3: 2 byte sig type (big endian)
                           Signing Public Key (length as implied by sig type)
  Private Key: Only if flag bit 0 is set to 1
               A 32-byte ECIES_X25519 private key
  Secret:      Only if flag bit 4 is set to 1
               A secret String
</code></pre><h3 id="certificados-de-clave">Certificados de Clave</h3>
<ul>
<li>La versión mínima del router es 0.9.43</li>
</ul>
<h3 id="nuevas-estructuras-intermedias">Nuevas Estructuras Intermedias</h3>
<h3 id="nuevos-tipos-de-netdb">Nuevos Tipos de NetDB</h3>
<p>Para soportar búsquedas de nombres de host &ldquo;b33&rdquo; y devolver una indicación si el router no tiene la información requerida, definimos códigos de resultado adicionales para el Mensaje de Respuesta de Host, como sigue:</p>
<pre tabindex="0"><code>2: Lookup password required
   3: Private key required
   4: Lookup password and private key required
   5: Leaseset decryption failure
</code></pre><p>Los valores 1-255 ya están definidos como errores, por lo que no hay problema de compatibilidad hacia atrás.</p>
<h3 id="nuevo-tipo-de-firma">Nuevo Tipo de Firma</h3>
<p>Router al cliente. Nuevo mensaje.</p>
<h3 id="justification-1">Justification</h3>
<p>Un cliente no sabe a priori que un Hash dado se resolverá en un Meta LS.</p>
<p>Si una búsqueda de leaseset para un Destination devuelve un Meta LS, el router hará la resolución recursiva. Para datagramas, el lado del cliente no necesita saberlo; sin embargo, para streaming, donde el protocolo verifica el destino en el SYN ACK, debe saber cuál es el destino &ldquo;real&rdquo;. Por lo tanto, necesitamos un nuevo mensaje.</p>
<h3 id="usage">Usage</h3>
<p>El router mantiene una caché para el destino real que se utiliza desde un LS meta. Cuando el cliente envía un mensaje a un destino que se resuelve a un LS meta, el router verifica la caché para el destino real usado por última vez. Si la caché está vacía, el router selecciona un destino del LS meta y busca el leaseSet. Si la búsqueda del leaseSet es exitosa, el router añade ese destino a la caché y envía al cliente un Meta Redirect Message. Esto solo se hace una vez, a menos que el destino expire y deba ser cambiado. El cliente también debe almacenar en caché la información si es necesario. El Meta Redirect Message NO se envía en respuesta a cada SendMessage.</p>
<p>El router solo envía este mensaje a clientes con versión 0.9.47 o superior.</p>
<p>El cliente no envía una respuesta a este mensaje.</p>
<h3 id="mensaje-de-consulta-de-base-de-datos">Mensaje de Consulta de Base de Datos</h3>
<p>El tipo de mensaje para el Meta Redirect Message es 43.</p>
<h3 id="cambios">Cambios</h3>
<pre tabindex="0"><code>Session ID (2 bytes) The value from the Send Message.
  Message ID generated by the router (4 bytes)
  4 byte nonce previously generated by the client
               (the value from the Send Message, may be zero)
  Flags:       2 bytes, bit order 15...0
               Unused, set to 0 for future compatibility
               Bit 0: 0 - the destination is no longer meta
                      1 - the destination is now meta
               Bits 15-1: Unused, set to 0 for future compatibility
  Original Destination (387+ bytes)
  (following fields only present if flags bit 0 is 1)
  MFlags:      2 bytes
               Unused, set to 0 for future compatibility
               From the Meta Lease for the actual Destination
  Expiration:  4 bytes, big endian, seconds since epoch
               From the Meta Lease for the actual Destination
  Cost (priority) 1 byte
               From the Meta Lease for the actual Destination
  Actual (real) Destination (387+ bytes)
</code></pre><h3 id="mensaje-de-almacenamiento-de-base-de-datos">Mensaje de Almacenamiento de Base de Datos</h3>
<p>Cómo generar y soportar Meta, incluyendo la comunicación y coordinación entre routers, está fuera del alcance de esta propuesta. Ver propuesta relacionada 150.</p>
<h3 id="cambios-1">Cambios</h3>
<p>Las firmas offline no pueden ser verificadas en streaming o datagramas respondibles. Ver secciones a continuación.</p>
<h2 id="private-key-file-changes-required">Private Key File Changes Required</h2>
<p>El formato del archivo de clave privada (eepPriv.dat) no es una parte oficial de nuestras especificaciones, pero está documentado en los <a href="http://idk.i2p/javadoc-i2p/net/i2p/data/PrivateKeyFile.html">javadocs de Java I2P</a>
 y otras implementaciones sí lo admiten. Esto permite la portabilidad de claves privadas a diferentes implementaciones.</p>
<p>Los cambios son necesarios para almacenar la clave pública transitoria y la información de firma fuera de línea.</p>
<h3 id="changes-2">Changes</h3>
<pre tabindex="0"><code>If the signing private key is all zeros, the offline information section follows:

  - Expires timestamp
    (4 bytes, big endian, seconds since epoch, rolls over in 2106)
  - Sig type of transient Signing Public Key (2 bytes, big endian)
  - Transient Signing Public key
    (length as specified by transient sig type)
  - Signature of above three fields by offline key
    (length as specified by destination sig type)
  - Transient Signing Private key
    (length as specified by transient sig type)
</code></pre><h3 id="opciones-i2cp">Opciones I2CP</h3>
<p>Agregar soporte para las siguientes opciones:</p>
<pre tabindex="0"><code>-d days              (specify expiration in days of offline sig, default 365)
      -o offlinedestfile   (generate the online key file,
                            using the offline key file specified)
      -r sigtype           (specify sig type of transient key, default Ed25519)
</code></pre><h2 id="streaming-changes-required">Streaming Changes Required</h2>
<p>Las firmas offline actualmente no pueden verificarse en streaming. El cambio a continuación agrega el bloque de firmado offline a las opciones. Esto evita tener que recuperar esta información vía I2CP.</p>
<h3 id="configuración-de-sesión">Configuración de Sesión</h3>
<pre tabindex="0"><code>Add new option:
  Bit:          11
  Flag:         OFFLINE_SIGNATURE
  Option order: 4
  Option data:  Variable bytes
  Function:     Contains the offline signature section from LS2.
                FROM_INCLUDED must also be set.
                Expires timestamp
                (4 bytes, big endian, seconds since epoch, rolls over in 2106)
                Transient sig type (2 bytes, big endian)
                Transient signing public key (length as implied by sig type)
                Signature of expires timestamp, transient sig type,
                and public key, by the destination public key,
                length as implied by destination public key sig type.

  Change option:
  Bit:          3
  Flag:         SIGNATURE_INCLUDED
  Option order: Change from 4 to 5

  Add information about transient keys to the
  Variable Length Signature Notes section:
  The offline signature option does not needed to be added for a CLOSE packet if
  a SYN packet containing the option was previously acked.
  More info TODO
</code></pre><h3 id="mensaje-de-solicitud-de-leaseset">Mensaje de Solicitud de LeaseSet</h3>
<ul>
<li>La alternativa es simplemente agregar una bandera y recuperar la clave pública transitoria a través de I2CP
(Ver las secciones de Mensaje de Búsqueda de Host / Respuesta de Host arriba)</li>
</ul>
<h2 id="cabecera-estándar-ls2">Cabecera estándar LS2</h2>
<p>Las firmas offline no pueden ser verificadas en el procesamiento de datagramas respondibles. Necesita una bandera para indicar firmado offline pero no hay lugar para poner una bandera. Requerirá un número de protocolo y formato completamente nuevos.</p>
<h3 id="mensaje-de-solicitud-de-leaseset-variable">Mensaje de Solicitud de Leaseset Variable</h3>
<pre tabindex="0"><code>Define new protocol 19 - Repliable datagram with options?
  - Destination (387+ bytes)
  - Flags (2 bytes)
    Bit order: 15 14 ... 3 2 1 0
    Bit 0: If 0, no offline keys; if 1, offline keys
    Bits 1-15: set to 0 for compatibility with future uses
  - If flag indicates offline keys, the offline signature section:
    Expires timestamp
    (4 bytes, big endian, seconds since epoch, rolls over in 2106)
    Transient sig type (2 bytes, big endian)
    Transient signing public key (length as implied by sig type)
    Signature of expires timestamp, transient sig type,
    and public key, by the destination public key,
    length as implied by destination public key sig type.
    This section can, and should, be generated offline.
  - Data
</code></pre><h3 id="crear-mensaje-leaseset2">Crear Mensaje Leaseset2</h3>
<ul>
<li>La alternativa es simplemente agregar una bandera y recuperar la clave pública transitoria a través de I2CP
(Ver las secciones de Mensaje de Búsqueda de Host / Respuesta de Host arriba)</li>
<li>¿Hay alguna otra opción que deberíamos agregar ahora que tenemos bytes de bandera?</li>
</ul>
<h2 id="sam-v3-changes-required">SAM V3 Changes Required</h2>
<p>SAM debe ser mejorado para soportar firmas offline en la DESTINATION base 64.</p>
<h3 id="justificación-3">Justificación</h3>
<pre tabindex="0"><code>Note that in the SESSION CREATE DESTINATION=$privkey,
  the $privkey raw data (before base64 conversion)
  may be optionally followed by the Offline Signature as specified in the
  Common Structures Specification.

  If the signing private key is all zeros, the offline information section follows:

  - Expires timestamp
    (4 bytes, big endian, seconds since epoch, rolls over in 2106)
  - Sig type of transient Signing Public Key (2 bytes, big endian)
  - Transient Signing Public key
    (length as specified by transient sig type)
  - Signature of above three fields by offline key
    (length as specified by destination sig type)
  - Transient Signing Private key (length as specified by transient sig type)
</code></pre><p>Tenga en cuenta que las firmas offline solo son compatibles con STREAM y RAW, no con DATAGRAM (hasta que definamos un nuevo protocolo DATAGRAM).</p>
<p>Tenga en cuenta que el SESSION STATUS devolverá una Clave Privada de Firma de todos ceros y los datos de Firma Fuera de Línea exactamente como se proporcionaron en el SESSION CREATE.</p>
<p>Tenga en cuenta que DEST GENERATE y SESSION CREATE DESTINATION=TRANSIENT no pueden usarse para crear un destino firmado sin conexión.</p>
<h3 id="tipo-de-mensaje">Tipo de Mensaje</h3>
<p>¿Actualizar la versión a 3.4, o dejarla en 3.1/3.2/3.3 para que se pueda agregar sin requerir todo el contenido de 3.2/3.3?</p>
<p>Otros cambios por determinar. Ver la sección Mensaje de Respuesta del Host I2CP arriba.</p>
<h2 id="bob-changes-required">BOB Changes Required</h2>
<p>BOB tendría que ser mejorado para soportar firmas offline y/o Meta LS. Esto es de baja prioridad y probablemente nunca será especificado o implementado. SAM V3 es la interfaz preferida.</p>
<h2 id="publishing-migration-compatibility">Publishing, Migration, Compatibility</h2>
<p>LS2 (excepto LS2 encriptado) se publica en la misma ubicación DHT que LS1. No hay manera de publicar tanto un LS1 como un LS2, a menos que LS2 estuviera en una ubicación diferente.</p>
<p>El LS2 encriptado se publica en el hash del tipo de clave ciega y los datos de la clave. Este hash se utiliza entonces para generar la &ldquo;clave de enrutamiento&rdquo; diaria, como en LS1.</p>
<p>LS2 solo se usaría cuando se requieran nuevas características (nueva criptografía, LS cifrado, meta, etc.). LS2 solo puede publicarse en floodfills de una versión especificada o superior.</p>
<p>Los servidores que publican LS2 sabrían que cualquier cliente que se conecte soporta LS2. Podrían enviar LS2 en el garlic.</p>
<p>Los clientes enviarían LS2 en garlics únicamente si usan criptografía nueva. ¿Los clientes compartidos usarían LS1 indefinidamente? TODO: ¿Cómo tener clientes compartidos que soporten tanto criptografía antigua como nueva?</p>
<h2 id="rollout">Rollout</h2>
<p>0.9.38 contiene soporte de floodfill para LS2 estándar, incluyendo claves offline.</p>
<p>0.9.39 contiene soporte I2CP para LS2 y Encrypted LS2, firma/verificación de tipo de firma 11, soporte floodfill para Encrypted LS2 (tipos de firma 7 y 11, sin claves offline), y cifrado/descifrado de LS2 (sin autorización por cliente).</p>
<p>0.9.40 está programada para contener soporte para cifrar/descifrar LS2 con autorización por cliente, soporte de floodfill e I2CP para Meta LS2, soporte para LS2 cifrado con claves offline, y soporte b32 para LS2 cifrado.</p>
<h2 id="nuevos-tipos-de-databaseentry">Nuevos tipos de DatabaseEntry</h2>
<p>El diseño encriptado de LS2 está fuertemente influenciado por los <a href="https://spec.torproject.org/rend-spec-v3">descriptores de servicios ocultos v3 de Tor</a>
, que tenían objetivos de diseño similares.</p>

                </article>

                
                <nav class="page-nav">
                    <a href="../../../es/proposals/" class="page-nav-link">
                        ← Back to Proposals
                    </a>
                    
                    
                    
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                            
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                    <a href="../../../proposals/123-new-netdb-entries.txt" class="page-nav-link" download>
                        Download Source (.txt)
                    </a>
                    
                </nav>
            </div>
        </div>
    </div>
</div>

<style>
.proposals-page {
    min-height: 100vh;
    padding: var(--spacing-xl) 0;
}

.breadcrumbs {
    display: flex;
    align-items: center;
    gap: var(--spacing-xs);
    margin-bottom: var(--spacing-lg);
    font-size: 0.875rem;
    color: var(--color-text-muted);
}

.breadcrumbs a {
    color: var(--color-text-muted);
    text-decoration: none;
    transition: color var(--transition-fast);
}

.breadcrumbs a:hover {
    color: var(--color-primary);
}

.separator {
    color: var(--color-border);
}

.current {
    color: var(--color-text);
}

 
.translation-disclaimer {
    background: #fef3c7;
    border: 1px solid #f59e0b;
    border-radius: var(--radius-md);
    padding: var(--spacing-md);
    margin-bottom: var(--spacing-lg);
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: var(--spacing-md);
    flex-wrap: wrap;
}

.dark .translation-disclaimer {
    background: #78350f;
    border-color: #d97706;
}

.disclaimer-message {
    color: #92400e;
    font-size: 0.875rem;
}

.dark .disclaimer-message {
    color: #fde047;
}

.disclaimer-link {
    color: #92400e;
    font-weight: 600;
    text-decoration: underline;
    white-space: nowrap;
}

.dark .disclaimer-link {
    color: #fde047;
}

 
.proposal-header {
    margin-bottom: var(--spacing-2xl);
}

.proposal-title-section {
    margin-bottom: var(--spacing-lg);
}

.proposal-title {
    font-size: 2.5rem;
    margin: 0 0 var(--spacing-sm) 0;
    color: var(--color-text);
}

.proposal-number {
    font-size: 0.875rem;
    color: var(--color-text-muted);
    font-weight: 600;
}

 
.proposal-meta-box {
    background: var(--color-bg-secondary);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-lg);
    padding: var(--spacing-lg);
}

.proposal-status {
    display: inline-block;
    padding: var(--spacing-xs) var(--spacing-md);
    border-radius: var(--radius-md);
    font-weight: 600;
    font-size: 0.875rem;
    margin-bottom: var(--spacing-md);
    text-transform: uppercase;
    letter-spacing: 0.05em;
}

 
.status-open {
    background: #dbeafe;
    color: #0369a1;
}

.dark .status-open {
    background: #0c4a6e;
    color: #7dd3fc;
}

.status-accepted {
    background: #dbeafe;
    color: #0369a1;
}

.dark .status-accepted {
    background: #0c4a6e;
    color: #7dd3fc;
}

.status-finished {
    background: #dcfce7;
    color: #15803d;
}

.dark .status-finished {
    background: #164e63;
    color: #86efac;
}

.status-closed {
    background: #dcfce7;
    color: #15803d;
}

.dark .status-closed {
    background: #164e63;
    color: #86efac;
}

.status-rejected {
    background: #fee2e2;
    color: #991b1b;
}

.dark .status-rejected {
    background: #7f1d1d;
    color: #fca5a5;
}

.status-draft,
.status-needs-revision,
.status-dead,
.status-needs-research {
    background: #fef3c7;
    color: #92400e;
}

.dark .status-draft,
.dark .status-needs-revision,
.dark .status-dead,
.dark .status-needs-research {
    background: #78350f;
    color: #fde047;
}

.status-meta,
.status-informational,
.status-reserve {
    background: #e9d5ff;
    color: #6b21a8;
}

.dark .status-meta,
.dark .status-informational,
.dark .status-reserve {
    background: #581c87;
    color: #e879f9;
}

 
.proposal-info-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: var(--spacing-md);
    margin-bottom: var(--spacing-lg);
}

.info-item {
    display: flex;
    flex-direction: column;
    gap: var(--spacing-xs);
}

.info-label {
    font-size: 0.75rem;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    color: var(--color-text-muted);
}

.info-value {
    font-size: 0.9375rem;
    color: var(--color-text);
    font-weight: 500;
}

 
.proposal-relationships {
    border-top: 1px solid var(--color-border);
    padding-top: var(--spacing-md);
}

.relationship {
    display: flex;
    gap: var(--spacing-md);
    margin-bottom: var(--spacing-sm);
}

.relationship:last-child {
    margin-bottom: 0;
}

.relationship-label {
    font-weight: 600;
    color: var(--color-text-muted);
    min-width: 120px;
}

.relationship-value {
    color: var(--color-text);
}

 
.proposal-layout {
    display: block;
}

.proposal-layout--with-toc {
    display: grid;
    grid-template-columns: 260px 1fr;
    gap: var(--spacing-2xl);
    align-items: start;
}

 
.proposal-toc-sidebar {
    position: sticky;
    top: 100px;
    max-height: calc(100vh - 120px);
    overflow-y: auto;
}

.toc-nav {
    background: var(--color-bg-secondary);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-lg);
    padding: var(--spacing-md);
}

.toc-header {
    display: flex;
    align-items: center;
    gap: var(--spacing-sm);
    font-weight: 700;
    font-size: 0.875rem;
    color: var(--color-text);
    padding-bottom: var(--spacing-md);
    margin-bottom: var(--spacing-md);
    border-bottom: 1px solid var(--color-border);
}

.toc-content {
    max-height: calc(100vh - 250px);
    overflow-y: auto;
}

.toc-content::-webkit-scrollbar {
    width: 4px;
}

.toc-content::-webkit-scrollbar-track {
    background: transparent;
}

.toc-content::-webkit-scrollbar-thumb {
    background: var(--color-border);
    border-radius: 2px;
}

.toc-content::-webkit-scrollbar-thumb:hover {
    background: var(--color-text-muted);
}

.toc-nav ul {
    list-style: none;
    padding-left: 0;
    margin: 0;
}

.toc-nav li {
    margin-bottom: 0.25rem;
}

.toc-nav ul ul {
    padding-left: var(--spacing-md);
    margin-top: 0.25rem;
}

.toc-nav a {
    color: var(--color-text-secondary);
    text-decoration: none;
    font-size: 0.8125rem;
    display: block;
    padding: 0.25rem 0.5rem;
    border-radius: var(--radius-sm);
    transition: all var(--transition-fast);
    line-height: 1.4;
}

.toc-nav a:hover {
    color: var(--color-primary);
    background: var(--color-bg-tertiary);
}

 
.proposal-main {
    min-width: 0;
}

 
.proposal-content {
    line-height: 1.8;
    color: var(--color-text);
    max-width: 900px;
}

.proposal-content h2 {
    margin-top: var(--spacing-2xl);
    margin-bottom: var(--spacing-md);
    font-size: 1.75rem;
    scroll-margin-top: 100px;
}

.proposal-content h3 {
    margin-top: var(--spacing-xl);
    margin-bottom: var(--spacing-sm);
    font-size: 1.375rem;
    scroll-margin-top: 100px;
}

.proposal-content h4 {
    margin-top: var(--spacing-lg);
    margin-bottom: var(--spacing-xs);
    font-size: 1.125rem;
    scroll-margin-top: 100px;
}

.proposal-content p {
    margin-bottom: var(--spacing-md);
}

.proposal-content ul,
.proposal-content ol {
    margin-bottom: var(--spacing-md);
    padding-left: var(--spacing-xl);
}

.proposal-content li {
    margin-bottom: var(--spacing-xs);
}

.proposal-content code {
    background: var(--color-bg-secondary);
    padding: 0.125rem 0.375rem;
    border-radius: var(--radius-sm);
    font-size: 0.875em;
    font-family: 'Courier New', monospace;
}

.proposal-content pre {
    background: var(--color-bg-secondary);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-md);
    padding: var(--spacing-md);
    overflow-x: auto;
    margin-bottom: var(--spacing-md);
    font-size: 0.875rem;
}

.proposal-content pre code {
    background: none;
    padding: 0;
}

.proposal-content blockquote {
    border-left: 4px solid var(--color-primary);
    padding-left: var(--spacing-md);
    margin-left: 0;
    margin-bottom: var(--spacing-md);
    font-style: italic;
    color: var(--color-text-secondary);
}

.proposal-content a {
    color: var(--color-primary);
    text-decoration: none;
    border-bottom: 1px solid transparent;
    transition: border-color var(--transition-fast);
}

.proposal-content a:hover {
    border-bottom-color: var(--color-primary);
}

.proposal-content table {
    width: 100%;
    border-collapse: collapse;
    margin-bottom: var(--spacing-md);
}

.proposal-content table th {
    background: var(--color-bg-secondary);
    padding: var(--spacing-sm);
    text-align: left;
    font-weight: 600;
    border-bottom: 2px solid var(--color-border);
}

.proposal-content table td {
    padding: var(--spacing-sm);
    border-bottom: 1px solid var(--color-border);
}

.proposal-content img {
    max-width: 100%;
    height: auto;
    border-radius: var(--radius-md);
    border: 1px solid var(--color-border);
    margin: var(--spacing-lg) 0;
    display: block;
}

 
.page-nav {
    margin-top: var(--spacing-2xl);
    padding-top: var(--spacing-xl);
    border-top: 1px solid var(--color-border);
    display: flex;
    gap: var(--spacing-md);
    flex-wrap: wrap;
}

.page-nav-link {
    display: inline-block;
    padding: var(--spacing-md) var(--spacing-lg);
    background: var(--color-bg-secondary);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-md);
    color: var(--color-text);
    text-decoration: none;
    transition: all var(--transition-fast);
}

.page-nav-link:hover {
    border-color: var(--color-primary);
    color: var(--color-primary);
}

 
@media (max-width: 1024px) {
    .proposal-layout--with-toc {
        grid-template-columns: 1fr;
    }

    .proposal-toc-sidebar {
        position: static;
        max-height: none;
        margin-bottom: var(--spacing-xl);
    }

    .toc-content {
        max-height: 300px;
    }
}

@media (max-width: 768px) {
    .proposal-title {
        font-size: 1.75rem;
    }

    .proposal-info-grid {
        grid-template-columns: 1fr;
    }
}
</style>



<script>
document.addEventListener('DOMContentLoaded', function() {
    const tocLinks = document.querySelectorAll('.toc-nav a');
    const headings = [];

    tocLinks.forEach(link => {
        const href = link.getAttribute('href');
        if (href && href.startsWith('#')) {
            const heading = document.getElementById(href.slice(1));
            if (heading) {
                headings.push({ element: heading, link: link });
            }
        }
    });

    function updateActiveLink() {
        const scrollPos = window.scrollY + 120;
        let activeIndex = 0;

        for (let i = 0; i < headings.length; i++) {
            if (headings[i].element.offsetTop <= scrollPos) {
                activeIndex = i;
            }
        }

        tocLinks.forEach(link => link.classList.remove('active'));
        if (headings[activeIndex]) {
            headings[activeIndex].link.classList.add('active');
        }
    }

    window.addEventListener('scroll', updateActiveLink);
    updateActiveLink();
});
</script>
<style>
.toc-nav a.active {
    color: var(--color-primary);
    background: var(--color-bg-tertiary);
    font-weight: 600;
}
</style>



    </main>

    <footer class="site-footer">
    <div class="container">
        <div class="footer-grid">
            <div class="footer-col footer-brand">
                <img src="../../../images/i2plogo_lightmode.svg" alt="I2P Logo" class="footer-logo logo-light" loading="lazy" decoding="async">
                <img src="../../../images/i2plogo_darkmode.svg" alt="I2P Logo" class="footer-logo logo-dark" loading="lazy" decoding="async">
                <p class="footer-tagline">Privacy. Security. Freedom.</p>
                <p class="footer-description">The Invisible Internet Project - A privacy-focused, anonymous network layer</p>

                <div class="footer-social-newsletter">
                    <div class="social-links">
                        <a href="https://mastodon.social/@i2p" target="_blank" rel="noopener" aria-label="Mastodon">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M21.327 8.566c0-4.339-2.843-5.61-2.843-5.61-1.433-.658-3.894-.935-6.451-.956h-.063c-2.557.021-5.016.298-6.45.956 0 0-2.843 1.272-2.843 5.61 0 .993-.019 2.181.012 3.441.103 4.243.778 8.425 4.701 9.463 1.809.479 3.362.579 4.612.51 2.268-.126 3.541-.809 3.541-.809l-.075-1.646s-1.621.511-3.441.449c-1.804-.062-3.707-.194-3.999-2.409a4.523 4.523 0 0 1-.04-.621s1.77.433 4.014.536c1.372.063 2.658-.08 3.965-.236 2.506-.299 4.688-1.843 4.962-3.254.434-2.223.398-5.424.398-5.424zm-3.353 5.59h-2.081V9.057c0-1.075-.452-1.62-1.357-1.62-1 0-1.501.647-1.501 1.927v2.791h-2.069V9.364c0-1.28-.501-1.927-1.502-1.927-.905 0-1.357.546-1.357 1.62v5.099H6.026V8.903c0-1.074.273-1.927.823-2.558.566-.631 1.307-.955 2.228-.955 1.065 0 1.872.409 2.405 1.228l.518.869.519-.869c.533-.819 1.34-1.228 2.405-1.228.92 0 1.662.324 2.228.955.549.631.822 1.484.822 2.558v5.253z"/>
                            </svg>
                        </a>
                        <a href="https://twitter.com/GetI2P" target="_blank" rel="noopener" aria-label="Twitter">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/>
                            </svg>
                        </a>
                        <a href="https://old.reddit.com/r/i2p" target="_blank" rel="noopener" aria-label="Reddit">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M12 0A12 12 0 0 0 0 12a12 12 0 0 0 12 12 12 12 0 0 0 12-12A12 12 0 0 0 12 0zm5.01 4.744c.688 0 1.25.561 1.25 1.249a1.25 1.25 0 0 1-2.498.056l-2.597-.547-.8 3.747c1.824.07 3.48.632 4.674 1.488.308-.309.73-.491 1.207-.491.968 0 1.754.786 1.754 1.754 0 .716-.435 1.333-1.01 1.614a3.111 3.111 0 0 1 .042.52c0 2.694-3.13 4.87-7.004 4.87-3.874 0-7.004-2.176-7.004-4.87 0-.183.015-.366.043-.534A1.748 1.748 0 0 1 4.028 12c0-.968.786-1.754 1.754-1.754.463 0 .898.196 1.207.49 1.207-.883 2.878-1.43 4.744-1.487l.885-4.182a.342.342 0 0 1 .14-.197.35.35 0 0 1 .238-.042l2.906.617a1.214 1.214 0 0 1 1.108-.701zM9.25 12C8.561 12 8 12.562 8 13.25c0 .687.561 1.248 1.25 1.248.687 0 1.248-.561 1.248-1.249 0-.688-.561-1.249-1.249-1.249zm5.5 0c-.687 0-1.248.561-1.248 1.25 0 .687.561 1.248 1.249 1.248.688 0 1.249-.561 1.249-1.249 0-.687-.562-1.249-1.25-1.249zm-5.466 3.99a.327.327 0 0 0-.231.094.33.33 0 0 0 0 .463c.842.842 2.484.913 2.961.913.477 0 2.105-.056 2.961-.913a.361.361 0 0 0 .029-.463.33.33 0 0 0-.464 0c-.547.533-1.684.73-2.512.73-.828 0-1.979-.196-2.512-.73a.326.326 0 0 0-.232-.095z"/>
                            </svg>
                        </a>
                        <a href="https://signal.group/#CjQKIOSUTtxlhbumAKcRsthPFkxkTUrkWcX39bbN6njLEgAIEhCTNsR0KDuiehAXZnkt42v5" target="_blank" rel="noopener" aria-label="Signal" class="signal-link">
                            <img src="../../../images/Signal-Logo-Black.svg" alt="Signal" class="signal-logo signal-logo-light" loading="lazy" decoding="async">
                            <img src="../../../images/Signal-Logo-White.svg" alt="Signal" class="signal-logo signal-logo-dark" loading="lazy" decoding="async">
                        </a>
                    </div>

                    
                    <div class="footer-newsletter-inline">
                        <p class="newsletter-description">Mantente informado con las noticias de I2P:</p>
                        <form action="https://feedback.i2p.net/api/mailing-list/subscribe" method="POST" class="newsletter-form">
                            <input type="email" name="email" placeholder="Introduce tu correo electrónico" required>
                            <button type="submit">Suscribirse</button>
                        </form>
                    </div>
                </div>
            </div>

            <div class="footer-col">
                <h3>Enlaces Rápidos</h3>
                <ul>
                    <li><a href="../../../es/financial-support/">Donar</a></li>
                    <li><a href="../../../es/docs/overview/intro/">Introducción a I2P</a></li>
                </ul>
            </div>

            <div class="footer-col">
                <h3>Comunidad</h3>
                <ul>
                    <li><a href="../../../es/get-involved/">Participa</a></li>
                    <li><a href="../../../es/blog/">Blog</a></li>
                    <li><a href="http://i2pforum.net/" target="_blank" rel="noopener">Foros Oficiales</a></li>
                    <li><a href="../../../es/contact/">Contacto</a></li>
                </ul>
            </div>

            <div class="footer-col">
                <h3>Recursos</h3>
                <ul>
                    <li><a href="https://i2p-metrics.np-tokumei.net/" target="_blank" rel="noopener">Métricas de I2P</a></li>
                    <li><a href="../../../es/papers/">Investigación</a></li>
                    <li><a href="https://i2pgit.org/" target="_blank" rel="noopener">GitLab</a></li>
                    <li><a href="https://www.stormycloud.org/" target="_blank" rel="noopener">StormyCloud</a></li>
                </ul>
            </div>
        </div>

        <div class="footer-bottom">
            <p class="copyright">&copy; 2025 El Proyecto de Internet Invisible. Licenciado bajo Creative Commons.</p>
            <div class="footer-links">
                <a href="../../../es/privacy/">Privacidad</a>
                <a href="../../../es/terms/">Términos</a>
                <a href="../../../es/about/media/">Prensa</a>
            </div>
        </div>
    </div>
</footer>


    
    
<div class="modal-overlay" id="poll">
    <div class="modal-content poll-modal-content">
        <a href="#" class="modal-close" aria-label="Cerrar">
            <span aria-hidden="true">&times;</span>
        </a>

        <div class="modal-header">
            <h2>Encuesta de la comunidad</h2>
            <p class="modal-subtitle">Nos encantaría saber de ti</p>
        </div>

        <div class="modal-body">
            
            <iframe 
                id="poll-iframe"
                data-poll-id="2"
                data-api-url="https://feedback.i2p.net"
                frameborder="0"
                scrolling="no"
                style="width: 100%; border: none; min-height: 400px;">
            </iframe>
        </div>

        <div class="modal-footer">
            <p class="modal-disclaimer">
                Tu voto ayuda a dar forma al futuro de I2P.
            </p>
        </div>
    </div>
</div>


<script>
(function() {
    const iframe = document.getElementById('poll-iframe');
    if (!iframe) return;
    
    const hostname = window.location.hostname;
    let apiUrl = 'https://feedback.i2p.net';
    const pollId = iframe.getAttribute('data-poll-id') || '1';

    
    if (hostname.endsWith('.b32.i2p') || hostname.endsWith('.i2p')) {
        apiUrl = 'http://5kwyynf3eetgqa2nors6ctwo7doi7yu73k7uvypy5eqmm326zkiq.b32.i2p';
    }
    
    else if (hostname.endsWith('.onion')) {
        apiUrl = 'http://gfonxmohvarpmocsvllscsuszdu5rikipm6innvcwq4vpng7zzqmmfyd.onion';
    }

    
    const pollUrl = apiUrl + '/widgets/poll.html?poll_id=' + encodeURIComponent(pollId) + '&api_url=' + encodeURIComponent(apiUrl);
    iframe.src = pollUrl;
})();
</script>



    
    



    
    <script>
        (function () {
            'use strict';
            var hostname = window.location.hostname;
            var baseUrl;

            
            if (hostname.endsWith('.b32.i2p') || hostname.endsWith('.i2p')) {
                baseUrl = 'http://5kwyynf3eetgqa2nors6ctwo7doi7yu73k7uvypy5eqmm326zkiq.b32.i2p';
            } else if (hostname.endsWith('.onion')) {
                baseUrl = 'http://gfonxmohvarpmocsvllscsuszdu5rikipm6innvcwq4vpng7zzqmmfyd.onion';
            } else {
                baseUrl = 'https://feedback.i2p.net';
            }

            window.feedbackBaseUrl = baseUrl;

            
            document.querySelectorAll('[data-api-url]').forEach(function (widget) {
                widget.setAttribute('data-api-url', baseUrl);
            });

            
            document.write('<link rel="stylesheet" href="' + baseUrl + '/widgets/styles.css">');
            
        })();
    </script>

    

    
    
    

    

</body>

</html>
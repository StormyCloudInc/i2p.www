<!DOCTYPE html>
<html lang="vi" data-theme="light">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <title>Mã hóa Tầng Đường Hầm ChaCha | I2P - Dự án Internet vô hình</title>

    <meta name="description" content="The Invisible Internet Project - A privacy-focused, anonymous network layer">
    <meta name="keywords" content="i2p, privacy, anonymity, dark net, encryption, security">

    
    <meta property="og:title" content="Mã hóa Tầng Đường Hầm ChaCha | I2P - Dự án Internet vô hình">
    <meta property="og:description" content="The Invisible Internet Project - A privacy-focused, anonymous network layer">
    <meta property="og:type" content="website">
    <meta property="og:url" content="/vi/proposals/153-chacha20-layer-encryption/">

    
    <link rel="icon" type="image/svg+xml" href="../../../images/favicon.svg">
    <link rel="icon" type="image/png" href="../../../images/i2plogo.png" sizes="32x32">

    
    
    
    
    <link rel="stylesheet" href="../../../css/main.min.be6880f32f5ff44e57579da7b11513b973319944ebe38748e3ac7f3268662d18.css" integrity="sha256-vmiA8y9f9E5XV52nsRUTuXMxmUTr44dI46x/MmhmLRg=">
    


    
</head>

<body>
    
    <input type="checkbox" id="theme-toggle-checkbox" class="theme-checkbox" aria-hidden="true">

    
<div class="site-banner" id="site-banner" data-banner-id="banner-3" role="alert" aria-live="polite">
    <div class="container">
        <div class="banner-content">
            <span class="banner-message">Trang I2P Beta Đã Hoạt Động Gửi báo cáo lỗi tới stormycloud@mail.i2p</span>
            
        </div>
        
        <form method="GET" action="../../../api/banner/dismiss" style="display: inline;">
            <input type="hidden" name="id" value="banner-3">
            <button type="submit" class="banner-close" aria-label="Đóng banner" title="Đóng banner">
                <span aria-hidden="true">&times;</span>
            </button>
        </form>
        
    </div>
</div>


    <header class="site-header">
    <div class="container">
        <nav class="main-nav">
            <div class="nav-brand">
                <a href="../../../vi/" class="logo-link">
                    <img src="../../../images/i2plogo_lightmode.svg" alt="I2P Logo" class="logo logo-light">
                    <img src="../../../images/i2plogo_darkmode.svg" alt="I2P Logo" class="logo logo-dark">
                </a>
            </div>

            
            <input type="checkbox" id="mobile-menu-checkbox" class="mobile-menu-checkbox"
                aria-label="Toggle navigation menu">
            <label for="mobile-menu-checkbox" class="mobile-menu-toggle" aria-label="Toggle navigation menu">
                <span class="hamburger"></span>
            </label>

            <div class="nav-menu">
                <ul class="nav-links">
                    <li class="nav-dropdown">
                        <a href="../../../vi/about/" class="">Giới thiệu</a>
                        <ul class="dropdown-menu">
                            <li><a href="../../../vi/about/">Tổng quan</a></li>
                            <li><a href="../../../vi/papers/">Bài Nghiên Cứu</a></li>
                            <li><a href="../../../vi/about/media/">Báo chí</a></li>
                            <li><a href="../../../vi/contact/">Liên hệ</a></li>
                        </ul>
                    </li>
                    <li><a href="../../../vi/docs/" class="">Tài liệu</a></li>
                    <li><a href="../../../vi/downloads/" class="">Tải xuống</a></li>
                    <li><a href="../../../vi/blog/" class="">Blog</a></li>
                    <li class="nav-dropdown">
                        <a href="../../../vi/get-involved/" class="">Tham gia</a>
                        <ul class="dropdown-menu">
                            <li><a href="../../../vi/get-involved/">Tổng quan</a></li>
                            <li><a href="../../../vi/feedback/">Đề xuất Tính năng</a></li>
                        </ul>
                    </li>
                </ul>

                <div class="nav-actions">
                    
                    <div class="language-selector">
                        <button class="language-toggle" aria-label="Select language" title="Language">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none"
                                xmlns="http://www.w3.org/2000/svg">
                                <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2" />
                                <path
                                    d="M2 12h20M12 2a15.3 15.3 0 014 10 15.3 15.3 0 01-4 10 15.3 15.3 0 01-4-10 15.3 15.3 0 014-10z"
                                    stroke="currentColor" stroke-width="2" />
                            </svg>
                            <span class="current-lang">vi</span>
                        </button>
                        <div class="language-dropdown">
                            
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../en/proposals/153-chacha20-layer-encryption/"
                                class="lang-option">Tiếng Anh</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../es/proposals/153-chacha20-layer-encryption/"
                                class="lang-option">Tiếng Tây Ban Nha</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../ko/proposals/153-chacha20-layer-encryption/"
                                class="lang-option">Tiếng Hàn</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../zh/proposals/153-chacha20-layer-encryption/"
                                class="lang-option">Tiếng Trung</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../ru/proposals/153-chacha20-layer-encryption/"
                                class="lang-option">Tiếng Nga</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../cs/proposals/153-chacha20-layer-encryption/"
                                class="lang-option">Tiếng Séc</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../de/proposals/153-chacha20-layer-encryption/"
                                class="lang-option">Tiếng Đức</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../fr/proposals/153-chacha20-layer-encryption/"
                                class="lang-option">Tiếng Pháp</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../tr/proposals/153-chacha20-layer-encryption/"
                                class="lang-option">Tiếng Thổ Nhĩ Kỳ</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../vi/proposals/153-chacha20-layer-encryption/"
                                class="lang-option active">Tiếng Việt</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../hi/proposals/153-chacha20-layer-encryption/"
                                class="lang-option">Tiếng Hindi</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../ar/proposals/153-chacha20-layer-encryption/"
                                class="lang-option">Tiếng Ả Rập</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../pt/proposals/153-chacha20-layer-encryption/"
                                class="lang-option">Tiếng Bồ Đào Nha</a>
                            
                            
                        </div>
                    </div>

                    
                    <label for="theme-toggle-checkbox" class="theme-toggle" aria-label="Toggle dark mode"
                        title="Toggle theme">
                        <svg class="sun-icon" width="20" height="20" viewBox="0 0 20 20" fill="none"
                            xmlns="http://www.w3.org/2000/svg">
                            <circle cx="10" cy="10" r="4" stroke="currentColor" stroke-width="2" />
                            <path
                                d="M10 2V4M10 16V18M18 10H16M4 10H2M15.657 4.343L14.243 5.757M5.757 14.243L4.343 15.657M15.657 15.657L14.243 14.243M5.757 5.757L4.343 4.343"
                                stroke="currentColor" stroke-width="2" stroke-linecap="round" />
                        </svg>
                        <svg class="moon-icon" width="20" height="20" viewBox="0 0 20 20" fill="none"
                            xmlns="http://www.w3.org/2000/svg">
                            <path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"
                                stroke="currentColor" stroke-width="2" stroke-linejoin="round" />
                        </svg>
                    </label>

                    
                    <a href="../../../vi/financial-support/" class="btn btn-primary" id="donate-btn">Donate</a>

                    
                    <a href="../../../vi/downloads/" class="btn btn-primary">Tải I2P</a>
                </div>
            </div>
        </nav>
    </div>
</header>

    <main id="main-content">
        



<div class="proposals-page">
    <div class="container">
        
        <nav class="breadcrumbs">
            <a href="../../../vi/">Home</a>
            <span class="separator">/</span>
            <a href="../../../vi/proposals/">Proposals</a>
            <span class="separator">/</span>
            <span class="current">Mã hóa Tầng Đường Hầm ChaCha</span>
        </nav>

        
<div class="translation-disclaimer" role="note">
    <span class="disclaimer-message">Bản dịch này được tạo bằng máy học và có thể không chính xác 100%.</span>
    
    
    <a href="../../../en/proposals/153-chacha20-layer-encryption/" class="disclaimer-link">Xem phiên bản tiếng Anh</a>
    
</div>



        
        <header class="proposal-header">
            <div class="proposal-title-section">
                <h1 class="proposal-title">Mã hóa Tầng Đường Hầm ChaCha</h1>
                <div class="proposal-number">Proposal 153</div>
            </div>

            
            <div class="proposal-meta-box">
                <div class="proposal-status status-open">
                    Open
                </div>

                
                <div class="proposal-info-grid">
                    
                    <div class="info-item">
                        <span class="info-label">Author</span>
                        <span class="info-value">chisana</span>
                    </div>
                    

                    
                    <div class="info-item">
                        <span class="info-label">Created</span>
                        <span class="info-value">2019-08-04</span>
                    </div>
                    

                    
                    <div class="info-item">
                        <span class="info-label">Last Updated</span>
                        <span class="info-value">2019-08-05</span>
                    </div>
                    

                    

                    
                </div>

                
                
            </div>
        </header>

        
        <div class="proposal-layout proposal-layout--with-toc">
            
            
            <aside class="proposal-toc-sidebar">
                <nav class="toc-nav">
                    <div class="toc-header">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                            <path d="M4 6h16M4 12h16M4 18h16" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                        </svg>
                        On This Page
                    </div>
                    <div class="toc-content">
                        <nav id="TableOfContents">
  <ul>
    <li><a href="#tổng-quan">Tổng Quan</a>
      <ul>
        <li><a href="#mục-tiêu">Mục Tiêu</a></li>
        <li><a href="#xử-lý-thông-điệp-đường-hầm-đã-thiết-lập">Xử Lý Thông Điệp Đường Hầm Đã Thiết Lập</a></li>
        <li><a href="#mã-hóa-aead-của-thông-điệp-giữa-các-hop">Mã Hóa AEAD của Thông Điệp Giữa Các Hop</a></li>
        <li><a href="#xử-lý-thông-điệp-của-cổng-và-người-tạo-đường-hầm">Xử Lý Thông Điệp của Cổng và Người Tạo Đường Hầm</a></li>
        <li><a href="#tiền-xử-lý--mã-hóa-cổng">Tiền Xử Lý &amp; Mã Hóa Cổng</a></li>
        <li><a href="#xử-lý-người-tham-gia">Xử Lý Người Tham Gia</a></li>
        <li><a href="#xử-lý-endpoint-vào">Xử Lý Endpoint Vào</a></li>
        <li><a href="#phân-tích-an-ninh-cho-mã-hóa-tầng-đường-hầm-chacha20chacha20-poly1305">Phân Tích An Ninh cho Mã Hóa Tầng Đường Hầm ChaCha20+ChaCha20-Poly1305</a></li>
      </ul>
    </li>
    <li><a href="#tài-liệu-tham-khảo">Tài Liệu Tham Khảo</a></li>
  </ul>
</nav>
                    </div>
                </nav>
            </aside>
            

            
            <div class="proposal-main">
                <article class="proposal-content">
                    <h2 id="tổng-quan">Tổng Quan</h2>
<p>Đề xuất này được xây dựng dựa trên và yêu cầu các thay đổi từ đề xuất 152: Đường Hầm ECIES.</p>
<p>Chỉ những đường hầm được xây dựng qua các điểm tiếp nhận hỗ trợ định dạng BuildRequestRecord cho đường hầm ECIES-X25519
mới có thể thực hiện đề xuất này.</p>
<p>Đề xuất này yêu cầu định dạng Tùy Chọn Dựng Đường Hầm để chỉ định
loại mã hóa tầng đường hầm, và truyền tải các khóa lớp AEAD.</p>
<h3 id="mục-tiêu">Mục Tiêu</h3>
<p>Các mục tiêu của đề xuất này là:</p>
<ul>
<li>Thay thế AES256/ECB+CBC bằng ChaCha20 cho mã hóa tầng và IV đường hầm đã thiết lập</li>
<li>Sử dụng ChaCha20-Poly1305 để bảo vệ AEAD giữa các hop</li>
<li>Không thể bị phát hiện từ mã hóa tầng đường hầm hiện có bởi những người không tham gia đường hầm</li>
<li>Không thay đổi độ dài thông điệp đường hầm tổng thể</li>
</ul>
<h3 id="xử-lý-thông-điệp-đường-hầm-đã-thiết-lập">Xử Lý Thông Điệp Đường Hầm Đã Thiết Lập</h3>
<p>Phần này mô tả những thay đổi đối với:</p>
<ul>
<li>Tiền xử lý + mã hóa Cổng ra và Cổng vào</li>
<li>Mã hóa + xử lý sau của người tham gia</li>
<li>Mã hóa + xử lý sau Endpoint ra và vào</li>
</ul>
<p>Để có cái nhìn tổng quan về xử lý thông điệp đường hầm hiện tại, hãy xem phần <a href="../../../vi/docs/specs/implementation/">Tunnel Implementation</a>
.</p>
<p>Chỉ những thay đổi cho các bộ định tuyến hỗ trợ mã hóa tầng ChaCha20 được thảo luận.</p>
<p>Không có thay đổi nào được xem xét đối với đường hầm kết hợp với mã hóa tầng AES, cho đến khi có thể đưa ra một giao thức an toàn
để chuyển đổi một IV AES 128 bit thành nonce ChaCha20 64 bit. Bộ lọc Bloom đảm bảo tính duy nhất
cho IV đầy đủ, nhưng nửa đầu của các IV duy nhất có thể giống nhau.</p>
<p>Điều này có nghĩa là mã hóa lớp phải đồng nhất cho tất cả các hop trong đường hầm, và được thiết lập
sử dụng các tùy chọn dựng đường hầm trong quá trình tạo đường hầm.</p>
<p>Tất cả các cổng và người tham gia đường hầm sẽ cần duy trì một bộ lọc Bloom để xác thực hai nonce độc lập.</p>
<p><code>nonceKey</code> được đề cập xuyên suốt đề xuất này thay thế cho <code>IVKey</code> được sử dụng trong mã hóa tầng AES.
Nó được tạo ra bằng cách sử dụng cùng KDF từ đề xuất 152.</p>
<h3 id="mã-hóa-aead-của-thông-điệp-giữa-các-hop">Mã Hóa AEAD của Thông Điệp Giữa Các Hop</h3>
<p>Trong mỗi cặp các hop liên tiếp, sẽ cần tạo thêm một <code>AEADKey</code> duy nhất.
Khóa này sẽ được sử dụng bởi các hop liên tiếp để mã hóa và giải mã ChaCha20-Poly1305
thông điệp đường hầm được mã hóa bên trong ChaCha20.</p>
<p>Thông điệp đường hầm sẽ cần giảm chiều dài khung mã hóa bên trong xuống 16 byte để
để dành chỗ cho MAC Poly1305.</p>
<p>AEAD không thể được sử dụng trực tiếp trên các thông điệp, vì cần giải mã lặp lại bởi các đường hầm đầu ra.
Giải mã lặp lại chỉ có thể đạt được, theo cách nó được sử dụng hiện nay, sử dụng ChaCha20 mà không có AEAD.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>+----+----+----+----+----+----+----+----+
</span></span><span style="display:flex;"><span>  |    Tunnel ID      |   tunnelNonce     |
</span></span><span style="display:flex;"><span>  +----+----+----+----+----+----+----+----+
</span></span><span style="display:flex;"><span>  | tunnelNonce cont. |    obfsNonce      |
</span></span><span style="display:flex;"><span>  +----+----+----+----+----+----+----+----+
</span></span><span style="display:flex;"><span>  |  obfsNonce cont.  |                   |
</span></span><span style="display:flex;"><span>  +----+----+----+----+                   +
</span></span><span style="display:flex;"><span>  |                                       |
</span></span><span style="display:flex;"><span>  +           Encrypted Data              +
</span></span><span style="display:flex;"><span>  ~                                       ~
</span></span><span style="display:flex;"><span>  |                                       |
</span></span><span style="display:flex;"><span>  +                   +----+----+----+----+
</span></span><span style="display:flex;"><span>  |                   |    Poly1305 MAC   |
</span></span><span style="display:flex;"><span>  +----+----+----+----+                   +  
</span></span><span style="display:flex;"><span>  |                                       |
</span></span><span style="display:flex;"><span>  +                   +----+----+----+----+
</span></span><span style="display:flex;"><span>  |                   |
</span></span><span style="display:flex;"><span>  +----+----+----+----+
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  Tunnel ID :: `TunnelId`
</span></span><span style="display:flex;"><span>         4 bytes
</span></span><span style="display:flex;"><span>         ID của hop tiếp theo
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  tunnelNonce ::
</span></span><span style="display:flex;"><span>         8 bytes
</span></span><span style="display:flex;"><span>         nonce của tầng đường hầm
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  obfsNonce ::
</span></span><span style="display:flex;"><span>         8 bytes
</span></span><span style="display:flex;"><span>         nonce mã hóa tầng nonce đường hầm
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  Encrypted Data ::
</span></span><span style="display:flex;"><span>         992 bytes
</span></span><span style="display:flex;"><span>         thông điệp đường hầm đã được mã hóa
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  Poly1305 MAC ::
</span></span><span style="display:flex;"><span>         16 bytes
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  tổng kích thước: 1028 Bytes
</span></span></code></pre></div><p>Các hop bên trong (với hop liền trước và liền sau), sẽ có hai <code>AEADKeys</code>, một để giải mã
tầng AEAD của hop trước, và mã hóa tầng AEAD cho hop tiếp theo.</p>
<p>Tất cả người tham gia hop bên trong sẽ có thêm 64 byte tài liệu khóa được bao gồm trong BuildRequestRecords của họ.</p>
<p>Điểm cuối ra và cổng vào chỉ yêu cầu thêm 32 byte dữ liệu khóa,
vì họ không mã hóa tầng đường hầm truyền tải thông điệp giữa nhau.</p>
<p>Cổng ra tạo khóa của nó là <code>outAEAD</code>, giống như khóa <code>inAEAD</code> của hop đầu ra đầu tiên.</p>
<p>Điểm cuối vào tạo khóa <code>inAEAD</code> của nó, giống như khóa <code>outAEAD</code> của hop vào cuối cùng.</p>
<p>Các hop bên trong sẽ nhận được và <code>inAEADKey</code> và <code>outAEADKey</code> sẽ được sử dụng để AEAD giải mã
thông điệp nhận được và mã hóa thông điệp gửi đi một cách tương ứng.</p>
<p>Lấy một ví dụ, trong một đường hầm với các hop bên trong là OBGW, A, B, OBEP:</p>
<ul>
<li><code>inAEADKey</code> của A giống như <code>outAEADKey</code> của OBGW</li>
<li><code>inAEADKey</code> của B giống như <code>outAEADKey</code> của A</li>
<li><code>outAEADKey</code> của B giống như <code>inAEADKey</code> của OBEP</li>
</ul>
<p>Các khóa chỉ là duy nhất cho các cặp hop, vì thế <code>inAEADKey</code> của OBEP sẽ khác so với <code>inAEADKey</code> của A,
<code>outAEADKey</code> của A khác với <code>outAEADKey</code> của B, v.v.</p>
<h3 id="xử-lý-thông-điệp-của-cổng-và-người-tạo-đường-hầm">Xử Lý Thông Điệp của Cổng và Người Tạo Đường Hầm</h3>
<p>Các cổng sẽ phân mảnh và gói thông điệp theo cách tương tự, giữ lại không gian sau khung hướng dẫn-phân mảnh
cho MAC Poly1305.</p>
<p>Các thông điệp I2NP bên trong chứa các khung AEAD (bao gồm cả MAC) có thể được tách ra theo các mảnh phân đoạn,
nhưng bất kỳ mảnh phân đoạn bị mất nào sẽ dẫn đến thất bại giải mã AEAD (xác nhận MAC bị thất bại) tại
điểm cuối.</p>
<h3 id="tiền-xử-lý--mã-hóa-cổng">Tiền Xử Lý &amp; Mã Hóa Cổng</h3>
<p>Khi đường hầm hỗ trợ mã hóa tầng ChaCha20, cổng sẽ tạo ra hai nonce 64-bit cho mỗi bộ thông điệp.</p>
<p>Đường hầm vào:</p>
<ul>
<li>
<p>Mã hóa IV và thông điệp đường hầm bằng ChaCha20</p>
</li>
<li>
<p>Sử dụng <code>tunnelNonce</code> và <code>obfsNonce</code> 8-byte vì tuổi thọ của các đường hầm</p>
</li>
<li>
<p>Sử dụng <code>obfsNonce</code> 8-byte để mã hóa <code>tunnelNonce</code></p>
</li>
<li>
<p>Phá hủy đường hầm trước khi có 2^(64 - 1) - 1 bộ thông điệp: 2^63 - 1 = 9,223,372,036,854,775,807</p>
<ul>
<li>Giới hạn nonce được đặt ra để tránh chạm trán của 64-bit nonces</li>
<li>Giới hạn nonce gần như không thể nào bị đạt tới, vì điều này sẽ là trên ~15,372,286,728,091,294 thông điệp/giây cho các đường hầm 10 phút</li>
</ul>
</li>
<li>
<p>Điều chỉnh số lượng bộ lọc Bloom dựa trên số lượng phần tử mong đợi hợp lý (128 thông điệp/giây, 1024 thông điệp/giây? TBD)</p>
</li>
</ul>
<p>Cổng Vào của đường hầm (IBGW), xử lý các thông điệp nhận được từ điểm cuối ra (OBEP) của một đường hầm khác.</p>
<p>Tại điểm này, tầng thông điệp bên ngoài được mã hóa bằng mã hóa truyền tải điểm-điểm.
Các tiêu đề thông điệp I2NP có thể nhìn thấy, ở tầng đường hầm, đối với OBEP và IBGW.
Các thông điệp I2NP bên trong được bao bọc trong Garlic cloves, mã hóa bằng mã hóa phiên end-to-end.</p>
<p>IBGW tiền xử lý các thông điệp thành các thông điệp đường hầm được định dạng thích hợp, và mã hóa như sau:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>// IBGW tạo nonce ngẫu nhiên, đảm bảo không vướng vào bộ lọc Bloom của nó cho mỗi nonce
</span></span><span style="display:flex;"><span>  tunnelNonce = Random(len = 64-bits)
</span></span><span style="display:flex;"><span>  obfsNonce = Random(len = 64-bits)
</span></span><span style="display:flex;"><span>  // IBGW ChaCha20 &#34;mã hóa&#34; từng thông điệp đường hầm đã được tiền xử lý với tunnelNonce và layerKey của nó
</span></span><span style="display:flex;"><span>  encMsg = ChaCha20(msg = thông điệp đường hầm, nonce = tunnelNonce, key = layerKey)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  // ChaCha20-Poly1305 mã hóa từng khung dữ liệu mã hóa của thông điệp với tunnelNonce và outAEADKey
</span></span><span style="display:flex;"><span>  (encMsg, MAC) = ChaCha20-Poly1305-Encrypt(msg = encMsg, nonce = tunnelNonce, key = outAEADKey)
</span></span></code></pre></div><p>Định dạng thông điệp đường hầm sẽ thay đổi nhẹ, sử dụng hai nonce 8-byte thay vì IV 16-byte.
<code>obfsNonce</code> được sử dụng để mã hóa nonce sẽ được đính kèm với <code>tunnelNonce</code> 8-byte,
và được mã hóa bởi mỗi hop sử dụng <code>tunnelNonce</code> đã được mã hóa và <code>nonceKey</code> của hop.</p>
<p>Sau khi tập hợp thông điệp đã được giải mã trước cho mỗi hop, Cổng Ra
ChaCha20-Poly1305 AEAD mã hóa phần văn bản mã hóa của mỗi thông điệp đường hầm bằng
<code>tunnelNonce</code> và <code>outAEADKey</code> của nó.</p>
<p>Đường hầm ra:</p>
<ul>
<li>Giải mã lặp lại thông điệp đường hầm</li>
<li>ChaCha20-Poly1305 mã hóa các khung dữ liệu thông điệp đường hầm đã được giải mã trước</li>
<li>Sử dụng các quy tắc giống nhau cho các nonce class như đường hầm vào</li>
<li>Tạo nonce ngẫu nhiên một lần cho mỗi tập hợp thông điệp đường hầm gửi đi</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>// Đối với mỗi tập hợp thông điệp, tạo nonce ngẫu nhiên, duy nhất
</span></span><span style="display:flex;"><span>  tunnelNonce = Random(len = 64-bits)
</span></span><span style="display:flex;"><span>  obfsNonce = Random(len = 64-bits)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  // Đối với mỗi hop, ChaCha20 nonce đường hầm trước đó với khóa IV của hop hiện tại
</span></span><span style="display:flex;"><span>  tunnelNonce = ChaCha20(msg = prev. tunnelNonce, nonce = obfsNonce, key = hop&#39;s nonceKey)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  // Đối với mỗi hop, ChaCha20 &#34;giải mã&#34; thông điệp đường hầm với nonce đường hầm hiện tại và layerKey của hop
</span></span><span style="display:flex;"><span>  decMsg = ChaCha20(msg = thông điệp đường hầm, nonce = tunnelNonce, key = hop&#39;s layerKey)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  // Đối với mỗi hop, ChaCha20 &#34;giải mã&#34; obfsNonce với tunnelNonce đã được mã hóa hiện tại và nonceKey của hop
</span></span><span style="display:flex;"><span>  obfsNonce = ChaCha20(msg = obfsNonce, nonce = tunnelNonce, key = hop&#39;s nonceKey)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  // Sau khi xử lý hop, ChaCha20-Poly1305 mã hóa khung dữ liệu &#34;đã giải mã&#34; của từng thông điệp đường hầm với tunnelNonce đã được mã hóa của hop đầu tiên và inAEADKey của nó / GW outAEADKey
</span></span><span style="display:flex;"><span>  (encMsg, MAC) = ChaCha20-Poly1305-Encrypt(msg = decMsg, nonce = first hop&#39;s encrypted tunnelNonce, key = first hop&#39;s inAEADKey / GW outAEADKey)
</span></span></code></pre></div><h3 id="xử-lý-người-tham-gia">Xử Lý Người Tham Gia</h3>
<p>Người tham gia sẽ theo dõi các thông điệp đã nhìn thấy theo cùng cách, sử dụng các bộ lọc Bloom giảm dần.</p>
<p>Các nonce đường hầm sẽ cần phải được mã hóa một lần cho mỗi hop, để ngăn chặn các cuộc tấn công xác nhận
bởi các hop không kế tiếp.</p>
<p>Các hop sẽ mã hóa nonce nhận được để ngăn chặn các cuộc tấn công xác nhận giữa các hop trước và sau,
tức là các hop không kế tiếp, kiểu tiếp tay.</p>
<p>Để xác thực <code>tunnelNonce</code> và <code>obfsNonce</code> nhận được, người tham gia kiểm tra từng nonce một cách riêng biệt
đối với bộ lọc Bloom của họ để tìm các bản sao.</p>
<p>Sau khi xác thực, người tham gia:</p>
<ul>
<li>ChaCha20-Poly1305 giải mã mỗi khung dữ liệu AEAD của thông điệp đường hầm với <code>tunnelNonce</code> nhận được và <code>inAEADKey</code> của nó</li>
<li>ChaCha20 mã hóa <code>tunnelNonce</code> với <code>nonceKey</code> nhận được và <code>obfsNonce</code></li>
<li>ChaCha20 mã hóa khung dữ liệu mã hóa của mỗi thông điệp đường hầm với <code>tunnelNonce</code> và <code>layerKey</code> được mã hóa của nó</li>
<li>ChaCha20-Poly1305 mã hóa khung dữ liệu đã mã hóa của mỗi thông điệp đường hầm với <code>tunnelNonce</code> và <code>outAEADKey</code> đã được mã hóa của nó</li>
<li>ChaCha20 mã hóa <code>obfsNonce</code> với <code>nonceKey</code> của nó và <code>tunnelNonce</code> đã được mã hóa</li>
<li>Gửi cặp {<code>nextTunnelId</code>, mã hóa (<code>tunnelNonce</code> || <code>obfsNonce</code>), AEAD ciphertext || MAC} tới hop tiếp theo.</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>// Để xác minh, các hop phải kiểm tra bộ lọc Bloom để xác nhận sự duy nhất của mỗi nonce nhận được
</span></span><span style="display:flex;"><span>  // Sau khi xác minh, mở khung AEAD bằng cách ChaCha20-Poly1305 giải mã từng khung dữ liệu đã mã hóa
</span></span><span style="display:flex;"><span>  // với tunnelNonce nhận được và inAEADKey 
</span></span><span style="display:flex;"><span>  encTunMsg = ChaCha20-Poly1305-Decrypt(msg = nhận encMsg \|\| MAC, nonce = nhận tunnelNonce, key = inAEADKey)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  // ChaCha20 mã hóa tunnelNonce với obfsNonce và nonceKey của hop
</span></span><span style="display:flex;"><span>  tunnelNonce = ChaCha20(msg = nhận tunnelNonce, nonce = nhận obfsNonce, key = nonceKey)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  // ChaCha20 mã hóa khung dữ liệu mã hóa của mỗi thông điệp đường hầm với tunnelNonce đã được mã hóa và layerKey của hop
</span></span><span style="display:flex;"><span>  encMsg = ChaCha20(msg = encTunMsg, nonce = tunnelNonce, key = layerKey)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  // Để bảo vệ AEAD, cũng ChaCha20-Poly1305 mã hóa khung dữ liệu mã hóa của mỗi thông điệp
</span></span><span style="display:flex;"><span>  // với tunnelNonce đã được mã hóa và outAEADKey của hop
</span></span><span style="display:flex;"><span>  (encMsg, MAC) = ChaCha20-Poly1305-Encrypt(msg = encMsg, nonce = tunnelNonce, key = outAEADKey)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  // ChaCha20 mã hóa obfsNonce nhận được với tunnelNonce đã được mã hóa và nonceKey của hop
</span></span><span style="display:flex;"><span>  obfsNonce = ChaCha20(msg = obfsNonce, nonce = tunnelNonce, key = nonceKey)
</span></span></code></pre></div><h3 id="xử-lý-endpoint-vào">Xử Lý Endpoint Vào</h3>
<p>Đối với các đường hầm ChaCha20, sơ đồ sau sẽ được sử dụng để giải mã từng thông điệp đường hầm:</p>
<ul>
<li>Xác thực <code>tunnelNonce</code> và <code>obfsNonce</code> nhận được một cách độc lập với bộ lọc Bloom của nó</li>
<li>ChaCha20-Poly1305 giải mã khung dữ liệu mã hóa bằng <code>tunnelNonce</code> nhận được và <code>inAEADKey</code></li>
<li>ChaCha20 giải mã khung dữ liệu mã hóa bằng <code>tunnelNonce</code> nhận được &amp; <code>layerKey</code> của hop</li>
<li>ChaCha20 giải mã <code>obfsNonce</code> sử dụng <code>nonceKey</code> của hop và <code>tunnelNonce</code> nhận được để có được <code>obfsNonce</code> liền trước</li>
<li>ChaCha20 giải mã <code>tunnelNonce</code> nhận được sử dụng <code>nonceKey</code> của hop và <code>obfsNonce</code> đã được giải mã để có được <code>tunnelNonce</code> liền trước</li>
<li>ChaCha20 giải mã dữ liệu đã mã hóa sử dụng <code>tunnelNonce</code> đã được giải mã &amp; <code>layerKey</code> của hop liền trước</li>
<li>Lặp lại các bước cho việc giải mã nonce và giải mã tầng cho từng hop trong đường hầm, trở lại IBGW</li>
<li>Giải mã khung AEAD chỉ cần trong vòng đầu tiên</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>// Đối với vòng đầu tiên, ChaCha20-Poly1305 giải mã khung dữ liệu mã hóa của từng thông điệp + MAC
</span></span><span style="display:flex;"><span>  // sử dụng tunnelNonce nhận được và inAEADKey
</span></span><span style="display:flex;"><span>  msg = encTunMsg \|\| MAC
</span></span><span style="display:flex;"><span>  tunnelNonce = nhận tunnelNonce
</span></span><span style="display:flex;"><span>  encTunMsg = ChaCha20-Poly1305-Decrypt(msg, nonce = tunnelNonce, key = inAEADKey)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  // Lặp lại cho từng hop trong đường hầm trở lại IBGW
</span></span><span style="display:flex;"><span>  // Đối với mỗi vòng, ChaCha20 giải mã từng mã hóa tầng của hop trên khung dữ liệu mã hóa của từng thông điệp
</span></span><span style="display:flex;"><span>  // Thay thế tunnelNonce nhận được bằng tunnelNonce đã được giải mã của vòng trước cho mỗi hop
</span></span><span style="display:flex;"><span>  decMsg = ChaCha20(msg = encTunMsg, nonce = tunnelNonce, key = layerKey)
</span></span><span style="display:flex;"><span>  obfsNonce = ChaCha20(msg = obfsNonce, nonce = tunnelNonce, key = nonceKey)
</span></span><span style="display:flex;"><span>  tunnelNonce = ChaCha20(msg = tunnelNonce, nonce = obfsNonce, key = nonceKey)
</span></span></code></pre></div><h3 id="phân-tích-an-ninh-cho-mã-hóa-tầng-đường-hầm-chacha20chacha20-poly1305">Phân Tích An Ninh cho Mã Hóa Tầng Đường Hầm ChaCha20+ChaCha20-Poly1305</h3>
<p>Chuyển từ AES256/ECB+AES256/CBC sang ChaCha20+ChaCha20-Poly1305 có một số ưu điểm, và những cân nhắc về an ninh mới.</p>
<p>Cân nhắc về an ninh quan trọng nhất cần phải xem xét, đó là nonce ChaCha20 và ChaCha20-Poly1305 phải là duy nhất cho mỗi thông điệp,
trong suốt vòng đời của khóa đang được sử dụng.</p>
<p>Không sử dụng nonce duy nhất với cùng khóa trên các thông điệp khác nhau sẽ phá vỡ ChaCha20 và ChaCha20-Poly1305.</p>
<p>Sử dụng một <code>obfsNonce</code> đính kèm cho phép IBEP giải mã <code>tunnelNonce</code> cho mã hóa tầng của từng hop,
phục hồi nonce trước đó.</p>
<p><code>obfsNonce</code> cùng với <code>tunnelNonce</code> không cung cấp thông tin mới nào cho các hop của đường hầm,
vì <code>obfsNonce</code> được mã hóa bằng cách sử dụng <code>tunnelNonce</code> đã được mã hóa. Điều này cũng cho phép IBEP phục hồi
<code>obfsNonce</code> trước đó theo cách tương tự với phục hồi <code>tunnelNonce</code>.</p>
<p>Ưu điểm an ninh lớn nhất là không có các cuộc tấn công xác nhận hoặc oracle chống lại ChaCha20,
và việc sử dụng ChaCha20-Poly1305 giữa các hop thêm bảo vệ AEAD chống lại việc giả mạo ciphertext bởi
các kẻ tấn công MitM ngoài luồng.</p>
<p>Có những cuộc tấn công oracle thực tế chống lại AES256/ECB + AES256/CBC, khi khóa được tái sử dụng (như trong mã hóa tầng đường hầm).</p>
<p>Các cuộc tấn công oracle chống lại AES256/ECB sẽ không hoạt động, bởi vì việc mã hóa kép được sử dụng, và mã hóa
là trên một khối duy nhất (IV đường hầm).</p>
<p>Các cuộc tấn công oracle padding chống lại AES256/CBC sẽ không hoạt động, vì không có padding được sử dụng. Nếu độ dài thông điệp đường hầm
bao giờ thay đổi thành không-mod-16 độ dài, AES256/CBC vẫn sẽ không bị tổn thương do các IV trùng lập bị từ chối.</p>
<p>Cả hai cuộc tấn công cũng đều bị chặn bởi việc không cho phép nhiều cuộc gọi oracle sử dụng cùng IV, bởi các IV trùng lập bị từ chối.</p>
<h2 id="tài-liệu-tham-khảo">Tài Liệu Tham Khảo</h2>
<ul>
<li><a href="../../../vi/docs/specs/implementation/">Tunnel-Implementation</a>
</li>
</ul>

                </article>

                
                <nav class="page-nav">
                    <a href="../../../vi/proposals/" class="page-nav-link">
                        ← Back to Proposals
                    </a>
                    
                    
                    
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                            
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                    <a href="../../../proposals/153-chacha20-layer-encryption.txt" class="page-nav-link" download>
                        Download Source (.txt)
                    </a>
                    
                </nav>
            </div>
        </div>
    </div>
</div>

<style>
.proposals-page {
    min-height: 100vh;
    padding: var(--spacing-xl) 0;
}

.breadcrumbs {
    display: flex;
    align-items: center;
    gap: var(--spacing-xs);
    margin-bottom: var(--spacing-lg);
    font-size: 0.875rem;
    color: var(--color-text-muted);
}

.breadcrumbs a {
    color: var(--color-text-muted);
    text-decoration: none;
    transition: color var(--transition-fast);
}

.breadcrumbs a:hover {
    color: var(--color-primary);
}

.separator {
    color: var(--color-border);
}

.current {
    color: var(--color-text);
}

 
.translation-disclaimer {
    background: #fef3c7;
    border: 1px solid #f59e0b;
    border-radius: var(--radius-md);
    padding: var(--spacing-md);
    margin-bottom: var(--spacing-lg);
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: var(--spacing-md);
    flex-wrap: wrap;
}

.dark .translation-disclaimer {
    background: #78350f;
    border-color: #d97706;
}

.disclaimer-message {
    color: #92400e;
    font-size: 0.875rem;
}

.dark .disclaimer-message {
    color: #fde047;
}

.disclaimer-link {
    color: #92400e;
    font-weight: 600;
    text-decoration: underline;
    white-space: nowrap;
}

.dark .disclaimer-link {
    color: #fde047;
}

 
.proposal-header {
    margin-bottom: var(--spacing-2xl);
}

.proposal-title-section {
    margin-bottom: var(--spacing-lg);
}

.proposal-title {
    font-size: 2.5rem;
    margin: 0 0 var(--spacing-sm) 0;
    color: var(--color-text);
}

.proposal-number {
    font-size: 0.875rem;
    color: var(--color-text-muted);
    font-weight: 600;
}

 
.proposal-meta-box {
    background: var(--color-bg-secondary);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-lg);
    padding: var(--spacing-lg);
}

.proposal-status {
    display: inline-block;
    padding: var(--spacing-xs) var(--spacing-md);
    border-radius: var(--radius-md);
    font-weight: 600;
    font-size: 0.875rem;
    margin-bottom: var(--spacing-md);
    text-transform: uppercase;
    letter-spacing: 0.05em;
}

 
.status-open {
    background: #dbeafe;
    color: #0369a1;
}

.dark .status-open {
    background: #0c4a6e;
    color: #7dd3fc;
}

.status-accepted {
    background: #dbeafe;
    color: #0369a1;
}

.dark .status-accepted {
    background: #0c4a6e;
    color: #7dd3fc;
}

.status-finished {
    background: #dcfce7;
    color: #15803d;
}

.dark .status-finished {
    background: #164e63;
    color: #86efac;
}

.status-closed {
    background: #dcfce7;
    color: #15803d;
}

.dark .status-closed {
    background: #164e63;
    color: #86efac;
}

.status-rejected {
    background: #fee2e2;
    color: #991b1b;
}

.dark .status-rejected {
    background: #7f1d1d;
    color: #fca5a5;
}

.status-draft,
.status-needs-revision,
.status-dead,
.status-needs-research {
    background: #fef3c7;
    color: #92400e;
}

.dark .status-draft,
.dark .status-needs-revision,
.dark .status-dead,
.dark .status-needs-research {
    background: #78350f;
    color: #fde047;
}

.status-meta,
.status-informational,
.status-reserve {
    background: #e9d5ff;
    color: #6b21a8;
}

.dark .status-meta,
.dark .status-informational,
.dark .status-reserve {
    background: #581c87;
    color: #e879f9;
}

 
.proposal-info-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: var(--spacing-md);
    margin-bottom: var(--spacing-lg);
}

.info-item {
    display: flex;
    flex-direction: column;
    gap: var(--spacing-xs);
}

.info-label {
    font-size: 0.75rem;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    color: var(--color-text-muted);
}

.info-value {
    font-size: 0.9375rem;
    color: var(--color-text);
    font-weight: 500;
}

 
.proposal-relationships {
    border-top: 1px solid var(--color-border);
    padding-top: var(--spacing-md);
}

.relationship {
    display: flex;
    gap: var(--spacing-md);
    margin-bottom: var(--spacing-sm);
}

.relationship:last-child {
    margin-bottom: 0;
}

.relationship-label {
    font-weight: 600;
    color: var(--color-text-muted);
    min-width: 120px;
}

.relationship-value {
    color: var(--color-text);
}

 
.proposal-layout {
    display: block;
}

.proposal-layout--with-toc {
    display: grid;
    grid-template-columns: 260px 1fr;
    gap: var(--spacing-2xl);
    align-items: start;
}

 
.proposal-toc-sidebar {
    position: sticky;
    top: 100px;
    max-height: calc(100vh - 120px);
    overflow-y: auto;
}

.toc-nav {
    background: var(--color-bg-secondary);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-lg);
    padding: var(--spacing-md);
}

.toc-header {
    display: flex;
    align-items: center;
    gap: var(--spacing-sm);
    font-weight: 700;
    font-size: 0.875rem;
    color: var(--color-text);
    padding-bottom: var(--spacing-md);
    margin-bottom: var(--spacing-md);
    border-bottom: 1px solid var(--color-border);
}

.toc-content {
    max-height: calc(100vh - 250px);
    overflow-y: auto;
}

.toc-content::-webkit-scrollbar {
    width: 4px;
}

.toc-content::-webkit-scrollbar-track {
    background: transparent;
}

.toc-content::-webkit-scrollbar-thumb {
    background: var(--color-border);
    border-radius: 2px;
}

.toc-content::-webkit-scrollbar-thumb:hover {
    background: var(--color-text-muted);
}

.toc-nav ul {
    list-style: none;
    padding-left: 0;
    margin: 0;
}

.toc-nav li {
    margin-bottom: 0.25rem;
}

.toc-nav ul ul {
    padding-left: var(--spacing-md);
    margin-top: 0.25rem;
}

.toc-nav a {
    color: var(--color-text-secondary);
    text-decoration: none;
    font-size: 0.8125rem;
    display: block;
    padding: 0.25rem 0.5rem;
    border-radius: var(--radius-sm);
    transition: all var(--transition-fast);
    line-height: 1.4;
}

.toc-nav a:hover {
    color: var(--color-primary);
    background: var(--color-bg-tertiary);
}

 
.proposal-main {
    min-width: 0;
}

 
.proposal-content {
    line-height: 1.8;
    color: var(--color-text);
    max-width: 900px;
}

.proposal-content h2 {
    margin-top: var(--spacing-2xl);
    margin-bottom: var(--spacing-md);
    font-size: 1.75rem;
    scroll-margin-top: 100px;
}

.proposal-content h3 {
    margin-top: var(--spacing-xl);
    margin-bottom: var(--spacing-sm);
    font-size: 1.375rem;
    scroll-margin-top: 100px;
}

.proposal-content h4 {
    margin-top: var(--spacing-lg);
    margin-bottom: var(--spacing-xs);
    font-size: 1.125rem;
    scroll-margin-top: 100px;
}

.proposal-content p {
    margin-bottom: var(--spacing-md);
}

.proposal-content ul,
.proposal-content ol {
    margin-bottom: var(--spacing-md);
    padding-left: var(--spacing-xl);
}

.proposal-content li {
    margin-bottom: var(--spacing-xs);
}

.proposal-content code {
    background: var(--color-bg-secondary);
    padding: 0.125rem 0.375rem;
    border-radius: var(--radius-sm);
    font-size: 0.875em;
    font-family: 'Courier New', monospace;
}

.proposal-content pre {
    background: var(--color-bg-secondary);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-md);
    padding: var(--spacing-md);
    overflow-x: auto;
    margin-bottom: var(--spacing-md);
    font-size: 0.875rem;
}

.proposal-content pre code {
    background: none;
    padding: 0;
}

.proposal-content blockquote {
    border-left: 4px solid var(--color-primary);
    padding-left: var(--spacing-md);
    margin-left: 0;
    margin-bottom: var(--spacing-md);
    font-style: italic;
    color: var(--color-text-secondary);
}

.proposal-content a {
    color: var(--color-primary);
    text-decoration: none;
    border-bottom: 1px solid transparent;
    transition: border-color var(--transition-fast);
}

.proposal-content a:hover {
    border-bottom-color: var(--color-primary);
}

.proposal-content table {
    width: 100%;
    border-collapse: collapse;
    margin-bottom: var(--spacing-md);
}

.proposal-content table th {
    background: var(--color-bg-secondary);
    padding: var(--spacing-sm);
    text-align: left;
    font-weight: 600;
    border-bottom: 2px solid var(--color-border);
}

.proposal-content table td {
    padding: var(--spacing-sm);
    border-bottom: 1px solid var(--color-border);
}

.proposal-content img {
    max-width: 100%;
    height: auto;
    border-radius: var(--radius-md);
    border: 1px solid var(--color-border);
    margin: var(--spacing-lg) 0;
    display: block;
}

 
.page-nav {
    margin-top: var(--spacing-2xl);
    padding-top: var(--spacing-xl);
    border-top: 1px solid var(--color-border);
    display: flex;
    gap: var(--spacing-md);
    flex-wrap: wrap;
}

.page-nav-link {
    display: inline-block;
    padding: var(--spacing-md) var(--spacing-lg);
    background: var(--color-bg-secondary);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-md);
    color: var(--color-text);
    text-decoration: none;
    transition: all var(--transition-fast);
}

.page-nav-link:hover {
    border-color: var(--color-primary);
    color: var(--color-primary);
}

 
@media (max-width: 1024px) {
    .proposal-layout--with-toc {
        grid-template-columns: 1fr;
    }

    .proposal-toc-sidebar {
        position: static;
        max-height: none;
        margin-bottom: var(--spacing-xl);
    }

    .toc-content {
        max-height: 300px;
    }
}

@media (max-width: 768px) {
    .proposal-title {
        font-size: 1.75rem;
    }

    .proposal-info-grid {
        grid-template-columns: 1fr;
    }
}
</style>



<script>
document.addEventListener('DOMContentLoaded', function() {
    const tocLinks = document.querySelectorAll('.toc-nav a');
    const headings = [];

    tocLinks.forEach(link => {
        const href = link.getAttribute('href');
        if (href && href.startsWith('#')) {
            const heading = document.getElementById(href.slice(1));
            if (heading) {
                headings.push({ element: heading, link: link });
            }
        }
    });

    function updateActiveLink() {
        const scrollPos = window.scrollY + 120;
        let activeIndex = 0;

        for (let i = 0; i < headings.length; i++) {
            if (headings[i].element.offsetTop <= scrollPos) {
                activeIndex = i;
            }
        }

        tocLinks.forEach(link => link.classList.remove('active'));
        if (headings[activeIndex]) {
            headings[activeIndex].link.classList.add('active');
        }
    }

    window.addEventListener('scroll', updateActiveLink);
    updateActiveLink();
});
</script>
<style>
.toc-nav a.active {
    color: var(--color-primary);
    background: var(--color-bg-tertiary);
    font-weight: 600;
}
</style>



    </main>

    <footer class="site-footer">
    <div class="container">
        <div class="footer-grid">
            <div class="footer-col footer-brand">
                <img src="../../../images/i2plogo_lightmode.svg" alt="I2P Logo" class="footer-logo logo-light" loading="lazy" decoding="async">
                <img src="../../../images/i2plogo_darkmode.svg" alt="I2P Logo" class="footer-logo logo-dark" loading="lazy" decoding="async">
                <p class="footer-tagline">Privacy. Security. Freedom.</p>
                <p class="footer-description">The Invisible Internet Project - A privacy-focused, anonymous network layer</p>

                <div class="footer-social-newsletter">
                    <div class="social-links">
                        <a href="https://mastodon.social/@i2p" target="_blank" rel="noopener" aria-label="Mastodon">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M21.327 8.566c0-4.339-2.843-5.61-2.843-5.61-1.433-.658-3.894-.935-6.451-.956h-.063c-2.557.021-5.016.298-6.45.956 0 0-2.843 1.272-2.843 5.61 0 .993-.019 2.181.012 3.441.103 4.243.778 8.425 4.701 9.463 1.809.479 3.362.579 4.612.51 2.268-.126 3.541-.809 3.541-.809l-.075-1.646s-1.621.511-3.441.449c-1.804-.062-3.707-.194-3.999-2.409a4.523 4.523 0 0 1-.04-.621s1.77.433 4.014.536c1.372.063 2.658-.08 3.965-.236 2.506-.299 4.688-1.843 4.962-3.254.434-2.223.398-5.424.398-5.424zm-3.353 5.59h-2.081V9.057c0-1.075-.452-1.62-1.357-1.62-1 0-1.501.647-1.501 1.927v2.791h-2.069V9.364c0-1.28-.501-1.927-1.502-1.927-.905 0-1.357.546-1.357 1.62v5.099H6.026V8.903c0-1.074.273-1.927.823-2.558.566-.631 1.307-.955 2.228-.955 1.065 0 1.872.409 2.405 1.228l.518.869.519-.869c.533-.819 1.34-1.228 2.405-1.228.92 0 1.662.324 2.228.955.549.631.822 1.484.822 2.558v5.253z"/>
                            </svg>
                        </a>
                        <a href="https://twitter.com/GetI2P" target="_blank" rel="noopener" aria-label="Twitter">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/>
                            </svg>
                        </a>
                        <a href="https://old.reddit.com/r/i2p" target="_blank" rel="noopener" aria-label="Reddit">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M12 0A12 12 0 0 0 0 12a12 12 0 0 0 12 12 12 12 0 0 0 12-12A12 12 0 0 0 12 0zm5.01 4.744c.688 0 1.25.561 1.25 1.249a1.25 1.25 0 0 1-2.498.056l-2.597-.547-.8 3.747c1.824.07 3.48.632 4.674 1.488.308-.309.73-.491 1.207-.491.968 0 1.754.786 1.754 1.754 0 .716-.435 1.333-1.01 1.614a3.111 3.111 0 0 1 .042.52c0 2.694-3.13 4.87-7.004 4.87-3.874 0-7.004-2.176-7.004-4.87 0-.183.015-.366.043-.534A1.748 1.748 0 0 1 4.028 12c0-.968.786-1.754 1.754-1.754.463 0 .898.196 1.207.49 1.207-.883 2.878-1.43 4.744-1.487l.885-4.182a.342.342 0 0 1 .14-.197.35.35 0 0 1 .238-.042l2.906.617a1.214 1.214 0 0 1 1.108-.701zM9.25 12C8.561 12 8 12.562 8 13.25c0 .687.561 1.248 1.25 1.248.687 0 1.248-.561 1.248-1.249 0-.688-.561-1.249-1.249-1.249zm5.5 0c-.687 0-1.248.561-1.248 1.25 0 .687.561 1.248 1.249 1.248.688 0 1.249-.561 1.249-1.249 0-.687-.562-1.249-1.25-1.249zm-5.466 3.99a.327.327 0 0 0-.231.094.33.33 0 0 0 0 .463c.842.842 2.484.913 2.961.913.477 0 2.105-.056 2.961-.913a.361.361 0 0 0 .029-.463.33.33 0 0 0-.464 0c-.547.533-1.684.73-2.512.73-.828 0-1.979-.196-2.512-.73a.326.326 0 0 0-.232-.095z"/>
                            </svg>
                        </a>
                        <a href="https://signal.group/#CjQKIOSUTtxlhbumAKcRsthPFkxkTUrkWcX39bbN6njLEgAIEhCTNsR0KDuiehAXZnkt42v5" target="_blank" rel="noopener" aria-label="Signal" class="signal-link">
                            <img src="../../../images/Signal-Logo-Black.svg" alt="Signal" class="signal-logo signal-logo-light" loading="lazy" decoding="async">
                            <img src="../../../images/Signal-Logo-White.svg" alt="Signal" class="signal-logo signal-logo-dark" loading="lazy" decoding="async">
                        </a>
                    </div>

                    
                    <div class="footer-newsletter-inline">
                        <p class="newsletter-description">Cập nhật tin tức I2P:</p>
                        <form action="https://feedback.i2p.net/api/mailing-list/subscribe" method="POST" class="newsletter-form">
                            <input type="email" name="email" placeholder="Nhập email của bạn" required>
                            <button type="submit">Đăng ký</button>
                        </form>
                    </div>
                </div>
            </div>

            <div class="footer-col">
                <h3>Liên kết nhanh</h3>
                <ul>
                    <li><a href="../../../vi/financial-support/">Quyên góp</a></li>
                    <li><a href="../../../vi/docs/overview/intro/">Giới thiệu I2P</a></li>
                </ul>
            </div>

            <div class="footer-col">
                <h3>Cộng đồng</h3>
                <ul>
                    <li><a href="../../../vi/get-involved/">Tham Gia</a></li>
                    <li><a href="../../../vi/blog/">Blog</a></li>
                    <li><a href="http://i2pforum.net/" target="_blank" rel="noopener">Diễn đàn chính thức</a></li>
                    <li><a href="../../../vi/contact/">Liên hệ</a></li>
                </ul>
            </div>

            <div class="footer-col">
                <h3>Tài nguyên</h3>
                <ul>
                    <li><a href="https://i2p-metrics.np-tokumei.net/" target="_blank" rel="noopener">Thống kê I2P</a></li>
                    <li><a href="../../../vi/papers/">Nghiên cứu</a></li>
                    <li><a href="https://i2pgit.org/" target="_blank" rel="noopener">GitLab</a></li>
                    <li><a href="https://www.stormycloud.org/" target="_blank" rel="noopener">StormyCloud</a></li>
                </ul>
            </div>
        </div>

        <div class="footer-bottom">
            <p class="copyright">&copy; 2025 Dự án Internet Vô hình. Được cấp phép theo Creative Commons.</p>
            <div class="footer-links">
                <a href="../../../vi/privacy/">Quyền riêng tư</a>
                <a href="../../../vi/terms/">Điều khoản</a>
                <a href="../../../vi/about/media/">Báo chí</a>
            </div>
        </div>
    </div>
</footer>


    
    
<div class="modal-overlay" id="poll">
    <div class="modal-content poll-modal-content">
        <a href="#" class="modal-close" aria-label="Đóng">
            <span aria-hidden="true">&times;</span>
        </a>

        <div class="modal-header">
            <h2>Thăm dò ý kiến cộng đồng</h2>
            <p class="modal-subtitle">Chúng tôi rất muốn nghe ý kiến từ bạn</p>
        </div>

        <div class="modal-body">
            
            <iframe 
                id="poll-iframe"
                data-poll-id="2"
                data-api-url="https://feedback.i2p.net"
                frameborder="0"
                scrolling="no"
                style="width: 100%; border: none; min-height: 400px;">
            </iframe>
        </div>

        <div class="modal-footer">
            <p class="modal-disclaimer">
                Phiếu bầu của bạn giúp định hình tương lai của I2P.
            </p>
        </div>
    </div>
</div>


<script>
(function() {
    const iframe = document.getElementById('poll-iframe');
    if (!iframe) return;
    
    const hostname = window.location.hostname;
    let apiUrl = 'https://feedback.i2p.net';
    const pollId = iframe.getAttribute('data-poll-id') || '1';

    
    if (hostname.endsWith('.b32.i2p') || hostname.endsWith('.i2p')) {
        apiUrl = 'http://5kwyynf3eetgqa2nors6ctwo7doi7yu73k7uvypy5eqmm326zkiq.b32.i2p';
    }
    
    else if (hostname.endsWith('.onion')) {
        apiUrl = 'http://gfonxmohvarpmocsvllscsuszdu5rikipm6innvcwq4vpng7zzqmmfyd.onion';
    }

    
    const pollUrl = apiUrl + '/widgets/poll.html?poll_id=' + encodeURIComponent(pollId) + '&api_url=' + encodeURIComponent(apiUrl);
    iframe.src = pollUrl;
})();
</script>



    
    



    
    <script>
        (function () {
            'use strict';
            var hostname = window.location.hostname;
            var baseUrl;

            
            if (hostname.endsWith('.b32.i2p') || hostname.endsWith('.i2p')) {
                baseUrl = 'http://5kwyynf3eetgqa2nors6ctwo7doi7yu73k7uvypy5eqmm326zkiq.b32.i2p';
            } else if (hostname.endsWith('.onion')) {
                baseUrl = 'http://gfonxmohvarpmocsvllscsuszdu5rikipm6innvcwq4vpng7zzqmmfyd.onion';
            } else {
                baseUrl = 'https://feedback.i2p.net';
            }

            window.feedbackBaseUrl = baseUrl;

            
            document.querySelectorAll('[data-api-url]').forEach(function (widget) {
                widget.setAttribute('data-api-url', baseUrl);
            });

            
            document.write('<link rel="stylesheet" href="' + baseUrl + '/widgets/styles.css">');
            
        })();
    </script>

    

    
    
    

    

</body>

</html>
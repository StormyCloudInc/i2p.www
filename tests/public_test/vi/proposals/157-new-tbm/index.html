<!DOCTYPE html>
<html lang="vi" data-theme="light">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <title>Thông điệp Xây Dựng Đường Hầm Nhỏ Hơn | I2P - Dự án Internet vô hình</title>

    <meta name="description" content="The Invisible Internet Project - A privacy-focused, anonymous network layer">
    <meta name="keywords" content="i2p, privacy, anonymity, dark net, encryption, security">

    
    <meta property="og:title" content="Thông điệp Xây Dựng Đường Hầm Nhỏ Hơn | I2P - Dự án Internet vô hình">
    <meta property="og:description" content="The Invisible Internet Project - A privacy-focused, anonymous network layer">
    <meta property="og:type" content="website">
    <meta property="og:url" content="/vi/proposals/157-new-tbm/">

    
    <link rel="icon" type="image/svg+xml" href="../../../images/favicon.svg">
    <link rel="icon" type="image/png" href="../../../images/i2plogo.png" sizes="32x32">

    
    
    
    
    <link rel="stylesheet" href="../../../css/main.min.be6880f32f5ff44e57579da7b11513b973319944ebe38748e3ac7f3268662d18.css" integrity="sha256-vmiA8y9f9E5XV52nsRUTuXMxmUTr44dI46x/MmhmLRg=">
    


    
</head>

<body>
    
    <input type="checkbox" id="theme-toggle-checkbox" class="theme-checkbox" aria-hidden="true">

    
<div class="site-banner" id="site-banner" data-banner-id="banner-3" role="alert" aria-live="polite">
    <div class="container">
        <div class="banner-content">
            <span class="banner-message">Trang I2P Beta Đã Hoạt Động Gửi báo cáo lỗi tới stormycloud@mail.i2p</span>
            
        </div>
        
        <form method="GET" action="../../../api/banner/dismiss" style="display: inline;">
            <input type="hidden" name="id" value="banner-3">
            <button type="submit" class="banner-close" aria-label="Đóng banner" title="Đóng banner">
                <span aria-hidden="true">&times;</span>
            </button>
        </form>
        
    </div>
</div>


    <header class="site-header">
    <div class="container">
        <nav class="main-nav">
            <div class="nav-brand">
                <a href="../../../vi/" class="logo-link">
                    <img src="../../../images/i2plogo_lightmode.svg" alt="I2P Logo" class="logo logo-light">
                    <img src="../../../images/i2plogo_darkmode.svg" alt="I2P Logo" class="logo logo-dark">
                </a>
            </div>

            
            <input type="checkbox" id="mobile-menu-checkbox" class="mobile-menu-checkbox"
                aria-label="Toggle navigation menu">
            <label for="mobile-menu-checkbox" class="mobile-menu-toggle" aria-label="Toggle navigation menu">
                <span class="hamburger"></span>
            </label>

            <div class="nav-menu">
                <ul class="nav-links">
                    <li class="nav-dropdown">
                        <a href="../../../vi/about/" class="">Giới thiệu</a>
                        <ul class="dropdown-menu">
                            <li><a href="../../../vi/about/">Tổng quan</a></li>
                            <li><a href="../../../vi/papers/">Bài Nghiên Cứu</a></li>
                            <li><a href="../../../vi/about/media/">Báo chí</a></li>
                            <li><a href="../../../vi/contact/">Liên hệ</a></li>
                        </ul>
                    </li>
                    <li><a href="../../../vi/docs/" class="">Tài liệu</a></li>
                    <li><a href="../../../vi/downloads/" class="">Tải xuống</a></li>
                    <li><a href="../../../vi/blog/" class="">Blog</a></li>
                    <li class="nav-dropdown">
                        <a href="../../../vi/get-involved/" class="">Tham gia</a>
                        <ul class="dropdown-menu">
                            <li><a href="../../../vi/get-involved/">Tổng quan</a></li>
                            <li><a href="../../../vi/feedback/">Đề xuất Tính năng</a></li>
                        </ul>
                    </li>
                </ul>

                <div class="nav-actions">
                    
                    <div class="language-selector">
                        <button class="language-toggle" aria-label="Select language" title="Language">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none"
                                xmlns="http://www.w3.org/2000/svg">
                                <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2" />
                                <path
                                    d="M2 12h20M12 2a15.3 15.3 0 014 10 15.3 15.3 0 01-4 10 15.3 15.3 0 01-4-10 15.3 15.3 0 014-10z"
                                    stroke="currentColor" stroke-width="2" />
                            </svg>
                            <span class="current-lang">vi</span>
                        </button>
                        <div class="language-dropdown">
                            
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../en/proposals/157-new-tbm/"
                                class="lang-option">Tiếng Anh</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../es/proposals/157-new-tbm/"
                                class="lang-option">Tiếng Tây Ban Nha</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../ko/proposals/157-new-tbm/"
                                class="lang-option">Tiếng Hàn</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../zh/proposals/157-new-tbm/"
                                class="lang-option">Tiếng Trung</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../ru/proposals/157-new-tbm/"
                                class="lang-option">Tiếng Nga</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../cs/proposals/157-new-tbm/"
                                class="lang-option">Tiếng Séc</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../de/proposals/157-new-tbm/"
                                class="lang-option">Tiếng Đức</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../fr/proposals/157-new-tbm/"
                                class="lang-option">Tiếng Pháp</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../tr/proposals/157-new-tbm/"
                                class="lang-option">Tiếng Thổ Nhĩ Kỳ</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../vi/proposals/157-new-tbm/"
                                class="lang-option active">Tiếng Việt</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../hi/proposals/157-new-tbm/"
                                class="lang-option">Tiếng Hindi</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../ar/proposals/157-new-tbm/"
                                class="lang-option">Tiếng Ả Rập</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../pt/proposals/157-new-tbm/"
                                class="lang-option">Tiếng Bồ Đào Nha</a>
                            
                            
                        </div>
                    </div>

                    
                    <label for="theme-toggle-checkbox" class="theme-toggle" aria-label="Toggle dark mode"
                        title="Toggle theme">
                        <svg class="sun-icon" width="20" height="20" viewBox="0 0 20 20" fill="none"
                            xmlns="http://www.w3.org/2000/svg">
                            <circle cx="10" cy="10" r="4" stroke="currentColor" stroke-width="2" />
                            <path
                                d="M10 2V4M10 16V18M18 10H16M4 10H2M15.657 4.343L14.243 5.757M5.757 14.243L4.343 15.657M15.657 15.657L14.243 14.243M5.757 5.757L4.343 4.343"
                                stroke="currentColor" stroke-width="2" stroke-linecap="round" />
                        </svg>
                        <svg class="moon-icon" width="20" height="20" viewBox="0 0 20 20" fill="none"
                            xmlns="http://www.w3.org/2000/svg">
                            <path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"
                                stroke="currentColor" stroke-width="2" stroke-linejoin="round" />
                        </svg>
                    </label>

                    
                    <a href="../../../vi/financial-support/" class="btn btn-primary" id="donate-btn">Donate</a>

                    
                    <a href="../../../vi/downloads/" class="btn btn-primary">Tải I2P</a>
                </div>
            </div>
        </nav>
    </div>
</header>

    <main id="main-content">
        



<div class="proposals-page">
    <div class="container">
        
        <nav class="breadcrumbs">
            <a href="../../../vi/">Home</a>
            <span class="separator">/</span>
            <a href="../../../vi/proposals/">Proposals</a>
            <span class="separator">/</span>
            <span class="current">Thông điệp Xây Dựng Đường Hầm Nhỏ Hơn</span>
        </nav>

        
<div class="translation-disclaimer" role="note">
    <span class="disclaimer-message">Bản dịch này được tạo bằng máy học và có thể không chính xác 100%.</span>
    
    
    <a href="../../../en/proposals/157-new-tbm/" class="disclaimer-link">Xem phiên bản tiếng Anh</a>
    
</div>



        
        <header class="proposal-header">
            <div class="proposal-title-section">
                <h1 class="proposal-title">Thông điệp Xây Dựng Đường Hầm Nhỏ Hơn</h1>
                <div class="proposal-number">Proposal 157</div>
            </div>

            
            <div class="proposal-meta-box">
                <div class="proposal-status status-đã đóng">
                    Đã Đóng
                </div>

                
                <div class="proposal-info-grid">
                    
                    <div class="info-item">
                        <span class="info-label">Author</span>
                        <span class="info-value">zzz, ban đầu</span>
                    </div>
                    

                    
                    <div class="info-item">
                        <span class="info-label">Created</span>
                        <span class="info-value">2020-10-09</span>
                    </div>
                    

                    
                    <div class="info-item">
                        <span class="info-label">Last Updated</span>
                        <span class="info-value">2021-07-31</span>
                    </div>
                    

                    
                    <div class="info-item">
                        <span class="info-label">Target Version</span>
                        <span class="info-value">0.9.51</span>
                    </div>
                    

                    
                </div>

                
                
            </div>
        </header>

        
        <div class="proposal-layout proposal-layout--with-toc">
            
            
            <aside class="proposal-toc-sidebar">
                <nav class="toc-nav">
                    <div class="toc-header">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                            <path d="M4 6h16M4 12h16M4 18h16" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                        </svg>
                        On This Page
                    </div>
                    <div class="toc-content">
                        <nav id="TableOfContents">
  <ul>
    <li><a href="#ghi-chú">Ghi Chú</a></li>
    <li><a href="#tổng-quan">Tổng quan</a>
      <ul>
        <li><a href="#tóm-tắt">Tóm tắt</a></li>
        <li><a href="#mục-tiêu">Mục Tiêu</a></li>
        <li><a href="#không-mục-tiêu">Không Mục Tiêu</a></li>
      </ul>
    </li>
    <li><a href="#thiết-kế">Thiết Kế</a>
      <ul>
        <li><a href="#bản-ghi">Bản Ghi</a></li>
        <li><a href="#thông-điệp-xây-dựng-đường-hầm">Thông Điệp Xây Dựng Đường Hầm</a></li>
        <li><a href="#luồng-thông-điệp">Luồng Thông Điệp</a></li>
        <li><a href="#mã-hóa-bản-ghi">Mã Hóa Bản Ghi</a></li>
        <li><a href="#mã-hóa-tầng">Mã Hóa Tầng</a></li>
        <li><a href="#thông-điệp-dữ-liệu-đường-hầm-mới">Thông Điệp Dữ Liệu Đường Hầm Mới</a></li>
      </ul>
    </li>
    <li><a href="#một-số-quy-định">Một Số Quy Định</a>
      <ul>
        <li><a href="#bản-ghi-yêu-cầu-ngắn">Bản Ghi Yêu Cầu Ngắn</a></li>
        <li><a href="#bản-ghi-trả-lời-ngắn">Bản Ghi Trả Lời Ngắn</a></li>
        <li><a href="#kdf">KDF</a></li>
        <li><a href="#shorttunnelbuild">ShortTunnelBuild</a></li>
        <li><a href="#outboundtunnelbuildreply">OutboundTunnelBuildReply</a></li>
        <li><a href="#kdf-1">KDF</a></li>
      </ul>
    </li>
    <li><a href="#biện-minh">Biện Minh</a></li>
    <li><a href="#ghi-chú-triển-khai">Ghi Chú Triển Khai</a></li>
    <li><a href="#vấn-đề">Vấn Đề</a></li>
    <li><a href="#di-cư">Di Cư</a></li>
    <li><a href="#phụ-lục">Phụ lục</a></li>
    <li><a href="#tài-liệu-tham-khảo">Tài liệu Tham Khảo</a></li>
  </ul>
</nav>
                    </div>
                </nav>
            </aside>
            

            
            <div class="proposal-main">
                <article class="proposal-content">
                    <h2 id="ghi-chú">Ghi Chú</h2>
<p>Đã triển khai kể từ phiên bản API 0.9.51.
Triển khai và thử nghiệm mạng đang tiến hành.
Có thể sẽ có sửa đổi nhỏ.
Xem <a href="../../../vi/docs/specs/i2np/">I2NP</a>
 và <a href="../../../vi/docs/specs/implementation/#tunnel-creation-ecies">Tunnel-Creation-ECIES</a>
 để biết đặc tả cuối cùng.</p>
<h2 id="tổng-quan">Tổng quan</h2>
<h3 id="tóm-tắt">Tóm tắt</h3>
<p>Kích thước hiện tại của các bản ghi Yêu cầu Xây Dựng và Trả Lời đường hầm mã hóa là 528.
Đối với các thông điệp Xây Dựng Đường Hầm Biến và Xây Dựng Đường Hầm Trả Lời Biến thông thường,
kích thước tổng cộng là 2113 byte. Thông điệp này bị phân mảnh thành ba thông điệp đường hầm 1KB cho đường ngược.</p>
<p>Các thay đổi đối với định dạng bản ghi 528 byte cho các bộ định tuyến ECIES-X25519 được chỉ định trong <a href="../../../vi/proposals/152-ecies-tunnels/">Prop152</a>
 và <a href="../../../vi/docs/specs/implementation/#tunnel-creation-ecies">Tunnel-Creation-ECIES</a>
.
Đối với sự kết hợp giữa các bộ định tuyến ElGamal và ECIES-X25519 trong một đường hầm, kích thước bản ghi phải duy trì
528 byte. Tuy nhiên, nếu tất cả các bộ định tuyến trong một đường hầm là ECIES-X25519, một bản ghi xây dựng mới, nhỏ hơn
có thể, vì mã hóa ECIES-X25519 có độ trễ ít hơn nhiều so với ElGamal.</p>
<p>Thông điệp nhỏ hơn sẽ tiết kiệm băng thông. Ngoài ra, nếu các thông điệp có thể phù hợp trong một
thông điệp đường hầm duy nhất, đường ngược sẽ hiệu quả gấp ba lần.</p>
<p>Đề xuất này định nghĩa các bản ghi yêu cầu và trả lời mới và các thông điệp Yêu Cầu Xây Dựng và Trả Lời Xây Dựng mới.</p>
<p>Người tạo đường hầm và tất cả các bước trong đường hầm được tạo phải là ECIES-X25519 và ít nhất là phiên bản 0.9.51.
Đề xuất này sẽ không có ích cho đến khi phần lớn các bộ định tuyến trong mạng là ECIES-X25519.
Dự kiến sẽ diễn ra vào cuối năm 2021.</p>
<h3 id="mục-tiêu">Mục Tiêu</h3>
<p>Xem <a href="../../../vi/proposals/152-ecies-tunnels/">Prop152</a>
 và <a href="../../../vi/proposals/156-ecies-routers/">Prop156</a>
 để biết thêm các mục tiêu.</p>
<ul>
<li>Các bản ghi và thông điệp nhỏ hơn</li>
<li>Duy trì đủ không gian cho các tùy chọn trong tương lai, như trong <a href="../../../vi/proposals/152-ecies-tunnels/">Prop152</a>
 và <a href="../../../vi/docs/specs/implementation/#tunnel-creation-ecies">Tunnel-Creation-ECIES</a>
</li>
<li>Phù hợp trong một thông điệp đường hầm cho đường ngược</li>
<li>Chỉ hỗ trợ các bước ECIES</li>
<li>Duy trì các cải tiến được triển khai trong <a href="../../../vi/proposals/152-ecies-tunnels/">Prop152</a>
 và <a href="../../../vi/docs/specs/implementation/#tunnel-creation-ecies">Tunnel-Creation-ECIES</a>
</li>
<li>Tối đa hóa khả năng tương thích với mạng hiện tại</li>
<li>Ẩn các thông điệp xây dựng tuyến vào từ OBEP</li>
<li>Ẩn các thông điệp trả lời xây dựng tuyến ra từ IBGW</li>
<li>Không yêu cầu nâng cấp &ldquo;ngày gắn cờ&rdquo; cho toàn bộ mạng lưới</li>
<li>Triển khai từ từ để giảm thiểu rủi ro</li>
<li>Tái sử dụng các nguyên tố mã hóa hiện có</li>
</ul>
<h3 id="không-mục-tiêu">Không Mục Tiêu</h3>
<p>Xem <a href="../../../vi/proposals/156-ecies-routers/">Prop156</a>
 để biết thêm các không mục tiêu.</p>
<ul>
<li>Không yêu cầu cho các đường hầm ElGamal/ECIES pha trộn</li>
<li>Thay đổi mã hóa tầng, cho điều đó xem <a href="../../../vi/proposals/153-chacha20-layer-encryption/">Prop153</a>
</li>
<li>Không tăng tốc các hoạt động mã hóa. Giả định rằng ChaCha20 và AES tương tự nhau,
ngay cả với AESNI, ít nhất đối với các kích thước dữ liệu nhỏ cần xét.</li>
</ul>
<h2 id="thiết-kế">Thiết Kế</h2>
<h3 id="bản-ghi">Bản Ghi</h3>
<p>Xem phụ lục để biết các tính toán.</p>
<p>Các bản ghi yêu cầu và trả lời mã hóa sẽ là 218 byte, so với 528 byte hiện nay.</p>
<p>Các bản ghi yêu cầu dạng văn bản sẽ là 154 byte,
so với 222 byte cho các bản ghi ElGamal,
và 464 byte cho các bản ghi ECIES như được định nghĩa trong <a href="../../../vi/proposals/152-ecies-tunnels/">Prop152</a>
 và <a href="../../../vi/docs/specs/implementation/#tunnel-creation-ecies">Tunnel-Creation-ECIES</a>
.</p>
<p>Các bản ghi phản hồi dạng văn bản sẽ là 202 byte,
so với 496 byte cho các bản ghi ElGamal,
và 512 byte cho các bản ghi ECIES như được định nghĩa trong <a href="../../../vi/proposals/152-ecies-tunnels/">Prop152</a>
 và <a href="../../../vi/docs/specs/implementation/#tunnel-creation-ecies">Tunnel-Creation-ECIES</a>
.</p>
<p>Mã hóa trả lời sẽ là ChaCha20 (KHÔNG Phải ChaCha20/Poly1305),
vì vậy các bản ghi văn bản không cần phải là bội số của 16 byte.</p>
<p>Các bản ghi yêu cầu sẽ được làm nhỏ hơn bằng cách sử dụng HKDF để tạo
các khóa tầng và trả lời, vì vậy chúng không cần phải được đưa rõ ràng trong yêu cầu.</p>
<h3 id="thông-điệp-xây-dựng-đường-hầm">Thông Điệp Xây Dựng Đường Hầm</h3>
<p>Cả hai sẽ là &ldquo;biến&rdquo; với một trường số lượng bản ghi một byte,
như với các thông điệp Biến hiện có.</p>
<h4 id="shorttunnelbuild-loại-25">ShortTunnelBuild: Loại 25</h4>
<p>Độ dài điển hình (với 4 bản ghi): 873 byte</p>
<p>Khi được sử dụng cho các xây dựng đường hầm vào,
nên (nhưng không bắt buộc) rằng thông điệp này được mã hóa garlic bởi nguồn,
nhắm mục tiêu vào cổng vào (hướng dẫn giao hàng ROUTER),
để ẩn các thông điệp xây dựng vào khỏi OBEP.
IBGW giải mã thông điệp,
đưa phản hồi vào vị trí đúng,
và gửi ShortTunnelBuildMessage đến bước tiếp theo.</p>
<p>Kích thước bản ghi được chọn sao cho một STBM được mã hóa garlic sẽ vừa
với một thông điệp đường hầm duy nhất. Xem phụ lục dưới đây.</p>
<h4 id="outboundtunnelbuildreply-loại-26">OutboundTunnelBuildReply: Loại 26</h4>
<p>Chúng tôi định nghĩa một thông điệp OutboundTunnelBuildReply mới.
Điều này được sử dụng cho các xây dựng đường hầm ra duy nhất.
Mục đích là để ẩn các thông điệp trả lời xây dựng tuyến ra khỏi IBGW.
Nó phải được mã hóa garlic bởi OBEP, nhắm mục tiêu vào nguồn
(hướng dẫn giao hàng TUNNEL).
OBEP giải mã thông điệp xây dựng tuyến,
tạo một thông điệp OutboundTunnelBuildReply,
và đặt phản hồi vào trường dạng văn bản.
Các bản ghi khác đặt vào các khe khác.
Sau đó, mã hóa garlic thông điệp đến nguồn với các khóa đối xứng được phát sinh.</p>
<h4 id="ghi-chú-1">Ghi chú</h4>
<p>Bằng cách mã hóa garlic OTBRM và STBM, chúng tôi cũng tránh các
vấn đề có thể xảy ra với sự tương thích tại IBGW và OBEP của các đường hầm đôi.</p>
<h3 id="luồng-thông-điệp">Luồng Thông Điệp</h3>
<pre tabindex="0"><code>STBM: Thông điệp xây dựng đường hầm ngắn (loại 25)
  OTBRM: Thông điệp phản hồi xây dựng đường hầm ra ngoài (loại 26)

  Xây dựng tuyến ra A-B-C
  Phản hồi qua tuyến vào D-E-F hiện có


                  Đường Hầm Mới
           STBM      STBM      STBM
  Người Tạo ------&gt; A ------&gt; B ------&gt; C ---\
                                     OBEP   \
                                            | Mã hóa garlic
                                            | OTBRM
                                            | (giao hàng TUNNEL)
                                            | từ OBEP đến người tạo
                Đường Hầm Hiện Có             /
  Người Tạo &lt;-------F---------E-------- D &lt;--/
                                     IBGW


  Xây dựng tuyến vào D-E-F
  Gửi qua tuyến ra hiện có A-B-C


                Đường Hầm Hiện Có
  Người Tạo ------&gt; A ------&gt; B ------&gt; C ---\
                                    OBEP    \
                                            | Mã hóa garlic (tùy chọn)
                                            | STBM
                                            | (giao hàng ROUTER)
                                            | từ người tạo
                  Đường Hầm Mới                | đến IBGW
            STBM      STBM      STBM        /
  Người Tạo &lt;------ F &lt;------ E &lt;------ D &lt;--/
                                     IBGW
</code></pre><h3 id="mã-hóa-bản-ghi">Mã Hóa Bản Ghi</h3>
<p>Mã hóa bản ghi yêu cầu và trả lời: như đã định nghĩa trong <a href="../../../vi/proposals/152-ecies-tunnels/">Prop152</a>
 và <a href="../../../vi/docs/specs/implementation/#tunnel-creation-ecies">Tunnel-Creation-ECIES</a>
.</p>
<p>Mã hóa bản ghi trả lời cho các khe khác: ChaCha20.</p>
<h3 id="mã-hóa-tầng">Mã Hóa Tầng</h3>
<p>Hiện tại không có kế hoạch thay đổi mã hóa tầng cho các đường hầm được xây dựng với
đặc tả này; nó sẽ vẫn là AES, như hiện đang được sử dụng cho tất cả các đường hầm.</p>
<p>Thay đổi mã hóa tầng thành ChaCha20 là chủ đề cần nghiên cứu thêm.</p>
<h3 id="thông-điệp-dữ-liệu-đường-hầm-mới">Thông Điệp Dữ Liệu Đường Hầm Mới</h3>
<p>Hiện tại không có kế hoạch thay đổi Thông Điệp Dữ Liệu Đường Hầm 1KB được sử dụng cho các đường hầm được xây dựng với
đặc tả này.</p>
<p>Nó có thể có ích để giới thiệu một thông điệp I2NP mới mà lớn hơn hoặc có kích thước biến, đồng thời với đề xuất này,
để sử dụng trên các đường hầm này.
Điều này sẽ giảm bớt độ trễ cho các thông điệp lớn.
Đây là một chủ đề cần nghiên cứu thêm.</p>
<h2 id="một-số-quy-định">Một Số Quy Định</h2>
<h3 id="bản-ghi-yêu-cầu-ngắn">Bản Ghi Yêu Cầu Ngắn</h3>
<h4 id="bản-ghi-yêu-cầu-ngắn-không-mã-hóa">Bản Ghi Yêu Cầu Ngắn Không Mã Hóa</h4>
<p>Đây là đặc tả đề xuất cho bản ghi Xây Dựng Yêu Cầu Đường Hầm cho các bộ định tuyến ECIES-X25519.
Tóm tắt các thay đổi từ <a href="../../../vi/docs/specs/implementation/#tunnel-creation-ecies">Tunnel-Creation-ECIES</a>
:</p>
<ul>
<li>Thay đổi độ dài không mã hóa từ 464 thành 154 byte</li>
<li>Thay đổi độ dài mã hóa từ 528 thành 218 byte</li>
<li>Loại bỏ các khóa và IVs tầng và trả lời, chúng sẽ được phát sinh từ split() và một KDF</li>
</ul>
<p>Bản ghi yêu cầu không chứa bất kỳ khóa ChaCha trả lời nào.
Các khóa đó được phát sinh từ một KDF. Xem bên dưới.</p>
<p>Tất cả các trường đều theo thứ tự big-endian.</p>
<p>Kích thước không mã hóa: 154 byte.</p>
<pre tabindex="0"><code>bytes     0-3: ID đường hầm để nhận thông điệp, khác không
  bytes     4-7: ID đường hầm tiếp theo, khác không
  bytes    8-39: hash định danh Router tiếp theo
  byte       40: cờ
  bytes   41-42: thêm cờ, không sử dụng, đặt thành 0 để tương thích
  byte       43: loại mã hóa tầng
  bytes   44-47: thời gian yêu cầu (tính bằng phút kể từ kỷ nguyên, làm tròn xuống)
  bytes   48-51: thời gian hết hạn yêu cầu (tính bằng giây kể từ khi tạo)
  bytes   52-55: ID tin nhắn tiếp theo
  bytes    56-x: tùy chọn xây dựng đường hầm (Mapping)
  bytes     x-x: dữ liệu khác như được ám bởi cờ hoặc tùy chọn
  bytes   x-153: dồn ngẫu nhiên (xem bên dưới)
</code></pre><p>Trường cờ giữ nguyên như được định nghĩa trong <a href="../../../vi/docs/specs/implementation/#tunnel-creation-ecies">Tunnel-Creation</a>
 và chứa các giá trị sau::</p>
<p>Thứ tự bit: 76543210 (bit 7 là MSB)
bit 7: nếu đặt, cho phép gửi thông điệp từ bất kỳ ai
bit 6: nếu đặt, cho phép gửi thông điệp đến bất kỳ ai, và gửi phản hồi đến
bước tiếp theo được chỉ định trong Thông Điệp Trả Lời Xây Dựng Đường Hầm
bit 5-0: Chưa xác định, cần đặt thành 0 để tương thích với các tùy chọn tương lai</p>
<p>Bit 7 chỉ ra rằng bước sẽ là cổng vào (IBGW). Bit 6
chỉ ra rằng bước sẽ là điểm kết thúc đầu ra (OBEP). Nếu cả hai bit không được
đặt, bước sẽ là một người tham gia trung gian. Cả hai không thể được đặt đồng thời.</p>
<p>Loại mã hóa tầng: 0 cho AES (như trong các đường hầm hiện tại);
1 cho tương lai (ChaCha?)</p>
<p>Thời gian hết hạn yêu cầu là cho thời lượng đường hầm thay đổi trong tương lai.
Hiện tại, chỉ có giá trị hỗ trợ là 600 (10 phút).</p>
<p>Khóa công khai tạm thời của người tạo là một khóa ECIES, big-endian.
Nó được sử dụng cho KDF để tạo ra các khóa và IVs tầng và trả lời của IBGW.
Điều này chỉ được bao gồm trong bản ghi văn bản rõ ràng trong một thông điệp Xây Dựng Đường Hầm vào.
Nó cần thiết vì không có DH ở tầng này cho bản ghi xây dựng.</p>
<p>Tùy chọn xây dựng đường hầm là một cấu trúc Mapping như được định nghĩa trong <a href="../../../vi/docs/specs/common-structures/">Common</a>
.
Đây là cho việc sử dụng trong tương lai. Không có tùy chọn nào hiện được định nghĩa.
Nếu cấu trúc Mapping trống rỗng, đây là hai byte 0x00 0x00.
Kích thước tối đa của Mapping (bao gồm trường độ dài) là 98 byte,
và giá trị tối đa của trường độ dài Mapping là 96.</p>
<h4 id="bản-ghi-yêu-cầu-ngắn-mã-hóa">Bản Ghi Yêu Cầu Ngắn Mã Hóa</h4>
<p>Tất cả các trường đều là big-endian, ngoại trừ khóa công khai thểm thời là little-endian.</p>
<p>Kích thước mã hóa: 218 byte</p>
<pre tabindex="0"><code>bytes    0-15: Hash định danh rút gọn của Hop
  bytes   16-47: Khóa công khai X25519 tạm thời của Người gửi
  bytes  48-201: Bản Ghi Yêu Cầu Xây Dựng Ngắn mã hóa ChaCha20
  bytes 202-217: Poly1305 MAC
</code></pre><h3 id="bản-ghi-trả-lời-ngắn">Bản Ghi Trả Lời Ngắn</h3>
<h4 id="bản-ghi-trả-lời-ngắn-không-mã-hóa">Bản Ghi Trả Lời Ngắn Không Mã Hóa</h4>
<p>Đây là đặc tả đề xuất cho bản ghi Trả Lời Xây Dựng Ngắn cho các bộ định tuyến ECIES-X25519.
Tóm tắt các thay đổi từ <a href="../../../vi/docs/specs/implementation/#tunnel-creation-ecies">Tunnel-Creation-ECIES</a>
:</p>
<ul>
<li>Thay đổi độ dài không mã hóa từ 512 thành 202 byte</li>
<li>Thay đổi độ dài mã hóa từ 528 thành 218 byte</li>
</ul>
<p>Trả lời ECIES được mã hóa với ChaCha20/Poly1305.</p>
<p>Tất cả các trường đều là big-endian.</p>
<p>Kích thước không mã hóa: 202 byte.</p>
<pre tabindex="0"><code>bytes    0-x: Tùy Chọn Trả Lời Xây Dựng Đường Hầm (Mapping)
  bytes    x-x: dữ liệu khác như được ám bởi các tùy chọn
  bytes  x-200: Dồn ngẫu nhiên (xem bên dưới)
  byte     201: Byte Trả Lời
</code></pre><p>Tùy chọn Trả Lời Xây Dựng Đường Hầm là một cấu trúc Mapping như được định nghĩa trong <a href="../../../vi/docs/specs/common-structures/">Common</a>
.
Đây là cho việc sử dụng trong tương lai. Không có tùy chọn nào hiện đang được định nghĩa.
Nếu cấu trúc Mapping trống rỗng, đây là hai byte 0x00 0x00.
Kích thước tối đa của Mapping (bao gồm trường độ dài) là 201 byte,
và giá trị tối đa của trường độ dài Mapping là 199.</p>
<p>Byte trả lời là một trong các giá trị sau
như được định nghĩa trong <a href="../../../vi/docs/specs/implementation/#tunnel-creation-ecies">Tunnel-Creation</a>
 để tránh nhận diện:</p>
<ul>
<li>0x00 (chấp nhận)</li>
<li>30 (TUNNEL_REJECT_BANDWIDTH)</li>
</ul>
<h4 id="bản-ghi-trả-lời-ngắn-mã-hóa">Bản Ghi Trả Lời Ngắn Mã Hóa</h4>
<p>Kích thước mã hóa: 218 byte</p>
<pre tabindex="0"><code>bytes   0-201: Bản Ghi Trả Lời Xây Dựng Ngắn mã hóa ChaCha20
  bytes 202-217: Poly1305 MAC
</code></pre><h3 id="kdf">KDF</h3>
<p>Xem phần KDF bên dưới.</p>
<h3 id="shorttunnelbuild">ShortTunnelBuild</h3>
<p>Loại I2NP 25</p>
<p>Thông điệp này được gửi đến các bước trung gian, OBEP, và IBEP (người tạo).
Nó không được gửi đến IBGW (sử dụng Xây Dựng Đường Hầm vào mã hóa garlic thay thế).
Khi được nhận bởi OBEP, nó được chuyển thành một OutboundTunnelBuildReply,
mã hóa garlic, và gửi đến người tạo.</p>
<pre tabindex="0"><code>+----+----+----+----+----+----+----+----+
  | num| ShortBuildRequestRecords...
  +----+----+----+----+----+----+----+----+

  num ::
         1 byte `Integer`
         Giá trị hợp lệ: 1-8

  kích thước bản ghi: 218 byte
  tổng kích thước: 1+$num*218
</code></pre><h4 id="ghi-chú-2">Ghi chú</h4>
<ul>
<li>Số lượng bản ghi điển hình là 4, cho tổng kích thước là 873.</li>
</ul>
<h3 id="outboundtunnelbuildreply">OutboundTunnelBuildReply</h3>
<p>Loại I2NP 26</p>
<p>Thông điệp này chỉ được gửi bởi OBEP đến IBEP (người tạo) qua một đường hầm vào hiện có.
Nó không được gửi đến bất kỳ bước nào khác.
Nó luôn luôn được mã hóa garlic.</p>
<pre tabindex="0"><code>+----+----+----+----+----+----+----+----+
  | num|                                  |
  +----+                                  +
  |      ShortBuildReplyRecords...        |
  +----+----+----+----+----+----+----+----+

  num ::
         Tổng số bản ghi,
         1 byte `Integer`
         Giá trị hợp lệ: 1-8

  ShortBuildReplyRecords ::
         Bản ghi đã mã hóa
         chiều dài: num * 218

  kích thước bản ghi mã hóa: 218 byte
  tổng kích thước: 1+$num*218
</code></pre><h4 id="ghi-chú-3">Ghi chú</h4>
<ul>
<li>Số lượng bản ghi điển hình là 4, cho tổng kích thước là 873.</li>
<li>Thông điệp này nên được mã hóa garlic.</li>
</ul>
<h3 id="kdf-1">KDF</h3>
<p>Chúng tôi sử dụng ck từ trạng thái Noise sau khi mã hóa/giải mã bản ghi xây dựng đường hầm
để phát sinh các khóa sau: khóa trả lời, khóa lớp AES, khóa IV AES và khóa/tag trả lời garlic cho OBEP.</p>
<p>Khóa trả lời:
Không giống như bản ghi dài, chúng ta không thể sử dụng phần trái của ck cho khóa trả lời, vì nó không phải là cuối cùng và sẽ được sử dụng sau này.
Khóa trả lời được sử dụng để mã hóa trả lời cho bản ghi bằng AEAD/ChaCha20/Poly1305 và ChaCha20 để trả lời các bản ghi khác.
Cả hai sử dụng cùng khóa, nonce là vị trí của bản ghi trong thông điệp bắt đầu từ 0.</p>
<pre tabindex="0"><code>keydata = HKDF(ck, ZEROLEN, &#34;SMTunnelReplyKey&#34;, 64)
  replyKey = keydata[32:63]
  ck = keydata[0:31]

  Khóa lớp:
  Khóa lớp luôn là AES cho đến nay, nhưng cùng KDF có thể được sử dụng từ ChaCha20

  keydata = HKDF(ck, ZEROLEN, &#34;SMTunnelLayerKey&#34;, 64)
  layerKey = keydata[32:63]

  Khóa IV cho bản ghi không-OBEP:
  ivKey = keydata[0:31]
  vì đây là cuối cùng

  Khóa IV cho bản ghi OBEP:
  ck = keydata[0:31]
  keydata = HKDF(ck, ZEROLEN, &#34;TunnelLayerIVKey&#34;, 64)
  ivKey = keydata[32:63]
  ck = keydata[0:31]

  Khóa/tag trả lời garlic cho OBEP:
  keydata = HKDF(ck, ZEROLEN, &#34;RGarlicKeyAndTag&#34;, 64)
  replyKey = keydata[32:63]
  replyTag = keydata[0:7]
</code></pre><h2 id="biện-minh">Biện Minh</h2>
<p>Thiết kế này tối đa hóa tái sử dụng các nguyên tố mã hóa, giao thức và mã hiện có.</p>
<p>Thiết kế này giảm thiểu rủi ro.</p>
<p>ChaCha20 nhanh hơn một chút so với AES cho các bản ghi nhỏ, trong thử nghiệm Java.
ChaCha20 tránh yêu cầu đối với kích thước dữ liệu là bội số của 16.</p>
<h2 id="ghi-chú-triển-khai">Ghi Chú Triển Khai</h2>
<ul>
<li>Cũng như với các thông điệp xây dựng đường hầm biến hiện có,
không khuyến khích sử dụng các thông điệp nhỏ hơn 4 bản ghi.
Mặc định điển hình là 3 hops.
Các đường hầm vào phải được xây dựng với một bản ghi bổ sung cho
người tạo, để hop cuối không biết nó là cuối cùng.
Để các bước trung gian không biết đường hầm là vào hay ra ngoài,
các đường hầm ra cũng nên được xây dựng với 4 bản ghi.</li>
</ul>
<h2 id="vấn-đề">Vấn Đề</h2>
<h2 id="di-cư">Di Cư</h2>
<p>Việc triển khai, thử nghiệm, và triển khai sẽ mất một số phát hành
và khoảng một năm. Các giai đoạn như sau. Việc phân công
mỗi giai đoạn cho một phát hành cụ thể sẽ được quyết định và phụ thuộc vào
tốc độ phát triển.</p>
<p>Các chi tiết của việc triển khai và di chuyển có thể khác nhau cho
mỗi triển khai I2P.</p>
<p>Người tạo đường hầm phải đảm bảo rằng tất cả các bước trong đường hầm được tạo là ECIES-X25519, VÀ ít nhất là phiên bản TBD.
Người tạo đường hầm KHÔNG cần phải là ECIES-X25519; nó có thể là ElGamal.
Tuy nhiên, nếu người tạo là ElGamal, nó tiết lộ cho hop gần nhất rằng nó là người tạo.
Vì vậy, trong thực tế, các tuyến này chỉ nên được tạo bởi các bộ định tuyến ECIES.</p>
<p>Nó KHÔNG cần thiết đối với OBEP hoặc IBGW của đường hầm đôi là ECIES hoặc
của bất kỳ phiên bản cụ thể nào.
Các thông điệp mới được mã hóa garlic và không nhìn thấy tại OBEP hoặc IBGW
của đường hầm đôi.</p>
<p>Giai đoạn 1: Triển khai, không được bật mặc định</p>
<p>Giai đoạn 2 (phát hành tiếp theo): Bật mặc định</p>
<p>Không có vấn đề tương thích ngược. Các thông điệp mới chỉ có thể được gửi đến các bộ định tuyến hỗ trợ chúng.</p>
<h2 id="phụ-lục">Phụ lục</h2>
<p>Không có độ trễ garlic cho STBM vào chưa mã hóa,
nếu chúng ta không sử dụng ITBM:</p>
<pre tabindex="0"><code>Kích thước 4 khe hiện tại: 4 * 528 + độ trễ = 3 thông điệp đường hầm

  Thông điệp xây dựng 4 khe để vừa trong một thông điệp đường hầm, chỉ ECIES:

  1024
  - 21 tiêu đề phân đoạn
  ----
  1003
  - 35 hướng dẫn giao hàng không phân đoạn ROUTER
  ----
  968
  - 16 tiêu đề I2NP
  ----
  952
  - 1 số khe
  ----
  951
  / 4 khe
  ----
  237 Kích thước bản ghi xây dựng mã hóa mới (so với 528 hiện tại)
  - 16 hash rút gọn
  - 32 khóa tạm thời
  - 16 MAC
  ----
  173 kích thước bản ghi xây dựng dạng văn bản tối đa (so với 222 hiện tại)
</code></pre><p>Có độ trễ garlic cho mẫu &lsquo;N&rsquo; noise để mã hóa STBM vào,
nếu chúng ta không sử dụng ITBM:</p>
<pre tabindex="0"><code>Kích thước 4 khe hiện tại: 4 * 528 + độ trễ = 3 thông điệp đường hầm

  Thông điệp xây dựng được mã hóa garlic 4 khe để vừa trong một thông điệp đường hầm, chỉ ECIES:

  1024
  - 21 tiêu đề phân đoạn
  ----
  1003
  - 35 hướng dẫn giao hàng không phân đoạn ROUTER
  ----
  968
  - 16 tiêu đề I2NP
  -  4 chiều dài
  ----
  948
  - 32 byte khóa tạm thời
  ----
  916
  - 7 byte khối DateTime
  ----
  909
  - 3 byte độ trễ khối Garlic
  ----
  906
  - 9 byte tiêu đề I2NP
  ----
  897
  - 1 byte hướng dẫn giao hàng Garlic LOCAL
  ----
  896
  - 16 byte Poly1305 MAC
  ----
  880
  - 1 số khe
  ----
  879
  / 4 khe
  ----
  219 Kích thước bản ghi xây dựng mã hóa mới (so với 528 hiện tại)
  - 16 hash rút gọn
  - 32 khóa tạm thời
  - 16 MAC
  ----
  155 kích thước bản ghi xây dựng dạng văn bản tối đa (so với 222 hiện tại)
</code></pre><p>Ghi chú:</p>
<p>Kích thước bản ghi xây dựng dạng văn bản trước khi đệm không sử dụng: 193</p>
<p>Việc loại bỏ hash router đầy đủ và phát sinh khóa/IVs từ HKDF sẽ giải phóng nhiều không gian cho các tùy chọn trong tương lai.
Nếu tất cả đều là HKDF, không gian rõ ràng yêu cầu khoảng 58 byte (không bao gồm bất kỳ tùy chọn nào).</p>
<p>OTBRM bọc garlic sẽ nhỏ hơn một chút so với STBM bọc garlic,
vì các hướng dẫn giao hàng là LOCAL không phải ROUTER,
không có khối DATETIME bao gồm, và
nó sử dụng một tag 8-byte thay vì khóa tạm thời 32-byte cho một thông điệp &lsquo;N&rsquo; đầy đủ.</p>
<h2 id="tài-liệu-tham-khảo">Tài liệu Tham Khảo</h2>

                </article>

                
                <nav class="page-nav">
                    <a href="../../../vi/proposals/" class="page-nav-link">
                        ← Back to Proposals
                    </a>
                    
                    
                    
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                            
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                    <a href="../../../proposals/157-new-tbm.txt" class="page-nav-link" download>
                        Download Source (.txt)
                    </a>
                    
                </nav>
            </div>
        </div>
    </div>
</div>

<style>
.proposals-page {
    min-height: 100vh;
    padding: var(--spacing-xl) 0;
}

.breadcrumbs {
    display: flex;
    align-items: center;
    gap: var(--spacing-xs);
    margin-bottom: var(--spacing-lg);
    font-size: 0.875rem;
    color: var(--color-text-muted);
}

.breadcrumbs a {
    color: var(--color-text-muted);
    text-decoration: none;
    transition: color var(--transition-fast);
}

.breadcrumbs a:hover {
    color: var(--color-primary);
}

.separator {
    color: var(--color-border);
}

.current {
    color: var(--color-text);
}

 
.translation-disclaimer {
    background: #fef3c7;
    border: 1px solid #f59e0b;
    border-radius: var(--radius-md);
    padding: var(--spacing-md);
    margin-bottom: var(--spacing-lg);
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: var(--spacing-md);
    flex-wrap: wrap;
}

.dark .translation-disclaimer {
    background: #78350f;
    border-color: #d97706;
}

.disclaimer-message {
    color: #92400e;
    font-size: 0.875rem;
}

.dark .disclaimer-message {
    color: #fde047;
}

.disclaimer-link {
    color: #92400e;
    font-weight: 600;
    text-decoration: underline;
    white-space: nowrap;
}

.dark .disclaimer-link {
    color: #fde047;
}

 
.proposal-header {
    margin-bottom: var(--spacing-2xl);
}

.proposal-title-section {
    margin-bottom: var(--spacing-lg);
}

.proposal-title {
    font-size: 2.5rem;
    margin: 0 0 var(--spacing-sm) 0;
    color: var(--color-text);
}

.proposal-number {
    font-size: 0.875rem;
    color: var(--color-text-muted);
    font-weight: 600;
}

 
.proposal-meta-box {
    background: var(--color-bg-secondary);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-lg);
    padding: var(--spacing-lg);
}

.proposal-status {
    display: inline-block;
    padding: var(--spacing-xs) var(--spacing-md);
    border-radius: var(--radius-md);
    font-weight: 600;
    font-size: 0.875rem;
    margin-bottom: var(--spacing-md);
    text-transform: uppercase;
    letter-spacing: 0.05em;
}

 
.status-open {
    background: #dbeafe;
    color: #0369a1;
}

.dark .status-open {
    background: #0c4a6e;
    color: #7dd3fc;
}

.status-accepted {
    background: #dbeafe;
    color: #0369a1;
}

.dark .status-accepted {
    background: #0c4a6e;
    color: #7dd3fc;
}

.status-finished {
    background: #dcfce7;
    color: #15803d;
}

.dark .status-finished {
    background: #164e63;
    color: #86efac;
}

.status-closed {
    background: #dcfce7;
    color: #15803d;
}

.dark .status-closed {
    background: #164e63;
    color: #86efac;
}

.status-rejected {
    background: #fee2e2;
    color: #991b1b;
}

.dark .status-rejected {
    background: #7f1d1d;
    color: #fca5a5;
}

.status-draft,
.status-needs-revision,
.status-dead,
.status-needs-research {
    background: #fef3c7;
    color: #92400e;
}

.dark .status-draft,
.dark .status-needs-revision,
.dark .status-dead,
.dark .status-needs-research {
    background: #78350f;
    color: #fde047;
}

.status-meta,
.status-informational,
.status-reserve {
    background: #e9d5ff;
    color: #6b21a8;
}

.dark .status-meta,
.dark .status-informational,
.dark .status-reserve {
    background: #581c87;
    color: #e879f9;
}

 
.proposal-info-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: var(--spacing-md);
    margin-bottom: var(--spacing-lg);
}

.info-item {
    display: flex;
    flex-direction: column;
    gap: var(--spacing-xs);
}

.info-label {
    font-size: 0.75rem;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    color: var(--color-text-muted);
}

.info-value {
    font-size: 0.9375rem;
    color: var(--color-text);
    font-weight: 500;
}

 
.proposal-relationships {
    border-top: 1px solid var(--color-border);
    padding-top: var(--spacing-md);
}

.relationship {
    display: flex;
    gap: var(--spacing-md);
    margin-bottom: var(--spacing-sm);
}

.relationship:last-child {
    margin-bottom: 0;
}

.relationship-label {
    font-weight: 600;
    color: var(--color-text-muted);
    min-width: 120px;
}

.relationship-value {
    color: var(--color-text);
}

 
.proposal-layout {
    display: block;
}

.proposal-layout--with-toc {
    display: grid;
    grid-template-columns: 260px 1fr;
    gap: var(--spacing-2xl);
    align-items: start;
}

 
.proposal-toc-sidebar {
    position: sticky;
    top: 100px;
    max-height: calc(100vh - 120px);
    overflow-y: auto;
}

.toc-nav {
    background: var(--color-bg-secondary);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-lg);
    padding: var(--spacing-md);
}

.toc-header {
    display: flex;
    align-items: center;
    gap: var(--spacing-sm);
    font-weight: 700;
    font-size: 0.875rem;
    color: var(--color-text);
    padding-bottom: var(--spacing-md);
    margin-bottom: var(--spacing-md);
    border-bottom: 1px solid var(--color-border);
}

.toc-content {
    max-height: calc(100vh - 250px);
    overflow-y: auto;
}

.toc-content::-webkit-scrollbar {
    width: 4px;
}

.toc-content::-webkit-scrollbar-track {
    background: transparent;
}

.toc-content::-webkit-scrollbar-thumb {
    background: var(--color-border);
    border-radius: 2px;
}

.toc-content::-webkit-scrollbar-thumb:hover {
    background: var(--color-text-muted);
}

.toc-nav ul {
    list-style: none;
    padding-left: 0;
    margin: 0;
}

.toc-nav li {
    margin-bottom: 0.25rem;
}

.toc-nav ul ul {
    padding-left: var(--spacing-md);
    margin-top: 0.25rem;
}

.toc-nav a {
    color: var(--color-text-secondary);
    text-decoration: none;
    font-size: 0.8125rem;
    display: block;
    padding: 0.25rem 0.5rem;
    border-radius: var(--radius-sm);
    transition: all var(--transition-fast);
    line-height: 1.4;
}

.toc-nav a:hover {
    color: var(--color-primary);
    background: var(--color-bg-tertiary);
}

 
.proposal-main {
    min-width: 0;
}

 
.proposal-content {
    line-height: 1.8;
    color: var(--color-text);
    max-width: 900px;
}

.proposal-content h2 {
    margin-top: var(--spacing-2xl);
    margin-bottom: var(--spacing-md);
    font-size: 1.75rem;
    scroll-margin-top: 100px;
}

.proposal-content h3 {
    margin-top: var(--spacing-xl);
    margin-bottom: var(--spacing-sm);
    font-size: 1.375rem;
    scroll-margin-top: 100px;
}

.proposal-content h4 {
    margin-top: var(--spacing-lg);
    margin-bottom: var(--spacing-xs);
    font-size: 1.125rem;
    scroll-margin-top: 100px;
}

.proposal-content p {
    margin-bottom: var(--spacing-md);
}

.proposal-content ul,
.proposal-content ol {
    margin-bottom: var(--spacing-md);
    padding-left: var(--spacing-xl);
}

.proposal-content li {
    margin-bottom: var(--spacing-xs);
}

.proposal-content code {
    background: var(--color-bg-secondary);
    padding: 0.125rem 0.375rem;
    border-radius: var(--radius-sm);
    font-size: 0.875em;
    font-family: 'Courier New', monospace;
}

.proposal-content pre {
    background: var(--color-bg-secondary);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-md);
    padding: var(--spacing-md);
    overflow-x: auto;
    margin-bottom: var(--spacing-md);
    font-size: 0.875rem;
}

.proposal-content pre code {
    background: none;
    padding: 0;
}

.proposal-content blockquote {
    border-left: 4px solid var(--color-primary);
    padding-left: var(--spacing-md);
    margin-left: 0;
    margin-bottom: var(--spacing-md);
    font-style: italic;
    color: var(--color-text-secondary);
}

.proposal-content a {
    color: var(--color-primary);
    text-decoration: none;
    border-bottom: 1px solid transparent;
    transition: border-color var(--transition-fast);
}

.proposal-content a:hover {
    border-bottom-color: var(--color-primary);
}

.proposal-content table {
    width: 100%;
    border-collapse: collapse;
    margin-bottom: var(--spacing-md);
}

.proposal-content table th {
    background: var(--color-bg-secondary);
    padding: var(--spacing-sm);
    text-align: left;
    font-weight: 600;
    border-bottom: 2px solid var(--color-border);
}

.proposal-content table td {
    padding: var(--spacing-sm);
    border-bottom: 1px solid var(--color-border);
}

.proposal-content img {
    max-width: 100%;
    height: auto;
    border-radius: var(--radius-md);
    border: 1px solid var(--color-border);
    margin: var(--spacing-lg) 0;
    display: block;
}

 
.page-nav {
    margin-top: var(--spacing-2xl);
    padding-top: var(--spacing-xl);
    border-top: 1px solid var(--color-border);
    display: flex;
    gap: var(--spacing-md);
    flex-wrap: wrap;
}

.page-nav-link {
    display: inline-block;
    padding: var(--spacing-md) var(--spacing-lg);
    background: var(--color-bg-secondary);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-md);
    color: var(--color-text);
    text-decoration: none;
    transition: all var(--transition-fast);
}

.page-nav-link:hover {
    border-color: var(--color-primary);
    color: var(--color-primary);
}

 
@media (max-width: 1024px) {
    .proposal-layout--with-toc {
        grid-template-columns: 1fr;
    }

    .proposal-toc-sidebar {
        position: static;
        max-height: none;
        margin-bottom: var(--spacing-xl);
    }

    .toc-content {
        max-height: 300px;
    }
}

@media (max-width: 768px) {
    .proposal-title {
        font-size: 1.75rem;
    }

    .proposal-info-grid {
        grid-template-columns: 1fr;
    }
}
</style>



<script>
document.addEventListener('DOMContentLoaded', function() {
    const tocLinks = document.querySelectorAll('.toc-nav a');
    const headings = [];

    tocLinks.forEach(link => {
        const href = link.getAttribute('href');
        if (href && href.startsWith('#')) {
            const heading = document.getElementById(href.slice(1));
            if (heading) {
                headings.push({ element: heading, link: link });
            }
        }
    });

    function updateActiveLink() {
        const scrollPos = window.scrollY + 120;
        let activeIndex = 0;

        for (let i = 0; i < headings.length; i++) {
            if (headings[i].element.offsetTop <= scrollPos) {
                activeIndex = i;
            }
        }

        tocLinks.forEach(link => link.classList.remove('active'));
        if (headings[activeIndex]) {
            headings[activeIndex].link.classList.add('active');
        }
    }

    window.addEventListener('scroll', updateActiveLink);
    updateActiveLink();
});
</script>
<style>
.toc-nav a.active {
    color: var(--color-primary);
    background: var(--color-bg-tertiary);
    font-weight: 600;
}
</style>



    </main>

    <footer class="site-footer">
    <div class="container">
        <div class="footer-grid">
            <div class="footer-col footer-brand">
                <img src="../../../images/i2plogo_lightmode.svg" alt="I2P Logo" class="footer-logo logo-light" loading="lazy" decoding="async">
                <img src="../../../images/i2plogo_darkmode.svg" alt="I2P Logo" class="footer-logo logo-dark" loading="lazy" decoding="async">
                <p class="footer-tagline">Privacy. Security. Freedom.</p>
                <p class="footer-description">The Invisible Internet Project - A privacy-focused, anonymous network layer</p>

                <div class="footer-social-newsletter">
                    <div class="social-links">
                        <a href="https://mastodon.social/@i2p" target="_blank" rel="noopener" aria-label="Mastodon">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M21.327 8.566c0-4.339-2.843-5.61-2.843-5.61-1.433-.658-3.894-.935-6.451-.956h-.063c-2.557.021-5.016.298-6.45.956 0 0-2.843 1.272-2.843 5.61 0 .993-.019 2.181.012 3.441.103 4.243.778 8.425 4.701 9.463 1.809.479 3.362.579 4.612.51 2.268-.126 3.541-.809 3.541-.809l-.075-1.646s-1.621.511-3.441.449c-1.804-.062-3.707-.194-3.999-2.409a4.523 4.523 0 0 1-.04-.621s1.77.433 4.014.536c1.372.063 2.658-.08 3.965-.236 2.506-.299 4.688-1.843 4.962-3.254.434-2.223.398-5.424.398-5.424zm-3.353 5.59h-2.081V9.057c0-1.075-.452-1.62-1.357-1.62-1 0-1.501.647-1.501 1.927v2.791h-2.069V9.364c0-1.28-.501-1.927-1.502-1.927-.905 0-1.357.546-1.357 1.62v5.099H6.026V8.903c0-1.074.273-1.927.823-2.558.566-.631 1.307-.955 2.228-.955 1.065 0 1.872.409 2.405 1.228l.518.869.519-.869c.533-.819 1.34-1.228 2.405-1.228.92 0 1.662.324 2.228.955.549.631.822 1.484.822 2.558v5.253z"/>
                            </svg>
                        </a>
                        <a href="https://twitter.com/GetI2P" target="_blank" rel="noopener" aria-label="Twitter">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/>
                            </svg>
                        </a>
                        <a href="https://old.reddit.com/r/i2p" target="_blank" rel="noopener" aria-label="Reddit">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M12 0A12 12 0 0 0 0 12a12 12 0 0 0 12 12 12 12 0 0 0 12-12A12 12 0 0 0 12 0zm5.01 4.744c.688 0 1.25.561 1.25 1.249a1.25 1.25 0 0 1-2.498.056l-2.597-.547-.8 3.747c1.824.07 3.48.632 4.674 1.488.308-.309.73-.491 1.207-.491.968 0 1.754.786 1.754 1.754 0 .716-.435 1.333-1.01 1.614a3.111 3.111 0 0 1 .042.52c0 2.694-3.13 4.87-7.004 4.87-3.874 0-7.004-2.176-7.004-4.87 0-.183.015-.366.043-.534A1.748 1.748 0 0 1 4.028 12c0-.968.786-1.754 1.754-1.754.463 0 .898.196 1.207.49 1.207-.883 2.878-1.43 4.744-1.487l.885-4.182a.342.342 0 0 1 .14-.197.35.35 0 0 1 .238-.042l2.906.617a1.214 1.214 0 0 1 1.108-.701zM9.25 12C8.561 12 8 12.562 8 13.25c0 .687.561 1.248 1.25 1.248.687 0 1.248-.561 1.248-1.249 0-.688-.561-1.249-1.249-1.249zm5.5 0c-.687 0-1.248.561-1.248 1.25 0 .687.561 1.248 1.249 1.248.688 0 1.249-.561 1.249-1.249 0-.687-.562-1.249-1.25-1.249zm-5.466 3.99a.327.327 0 0 0-.231.094.33.33 0 0 0 0 .463c.842.842 2.484.913 2.961.913.477 0 2.105-.056 2.961-.913a.361.361 0 0 0 .029-.463.33.33 0 0 0-.464 0c-.547.533-1.684.73-2.512.73-.828 0-1.979-.196-2.512-.73a.326.326 0 0 0-.232-.095z"/>
                            </svg>
                        </a>
                        <a href="https://signal.group/#CjQKIOSUTtxlhbumAKcRsthPFkxkTUrkWcX39bbN6njLEgAIEhCTNsR0KDuiehAXZnkt42v5" target="_blank" rel="noopener" aria-label="Signal" class="signal-link">
                            <img src="../../../images/Signal-Logo-Black.svg" alt="Signal" class="signal-logo signal-logo-light" loading="lazy" decoding="async">
                            <img src="../../../images/Signal-Logo-White.svg" alt="Signal" class="signal-logo signal-logo-dark" loading="lazy" decoding="async">
                        </a>
                    </div>

                    
                    <div class="footer-newsletter-inline">
                        <p class="newsletter-description">Cập nhật tin tức I2P:</p>
                        <form action="https://feedback.i2p.net/api/mailing-list/subscribe" method="POST" class="newsletter-form">
                            <input type="email" name="email" placeholder="Nhập email của bạn" required>
                            <button type="submit">Đăng ký</button>
                        </form>
                    </div>
                </div>
            </div>

            <div class="footer-col">
                <h3>Liên kết nhanh</h3>
                <ul>
                    <li><a href="../../../vi/financial-support/">Quyên góp</a></li>
                    <li><a href="../../../vi/docs/overview/intro/">Giới thiệu I2P</a></li>
                </ul>
            </div>

            <div class="footer-col">
                <h3>Cộng đồng</h3>
                <ul>
                    <li><a href="../../../vi/get-involved/">Tham Gia</a></li>
                    <li><a href="../../../vi/blog/">Blog</a></li>
                    <li><a href="http://i2pforum.net/" target="_blank" rel="noopener">Diễn đàn chính thức</a></li>
                    <li><a href="../../../vi/contact/">Liên hệ</a></li>
                </ul>
            </div>

            <div class="footer-col">
                <h3>Tài nguyên</h3>
                <ul>
                    <li><a href="https://i2p-metrics.np-tokumei.net/" target="_blank" rel="noopener">Thống kê I2P</a></li>
                    <li><a href="../../../vi/papers/">Nghiên cứu</a></li>
                    <li><a href="https://i2pgit.org/" target="_blank" rel="noopener">GitLab</a></li>
                    <li><a href="https://www.stormycloud.org/" target="_blank" rel="noopener">StormyCloud</a></li>
                </ul>
            </div>
        </div>

        <div class="footer-bottom">
            <p class="copyright">&copy; 2025 Dự án Internet Vô hình. Được cấp phép theo Creative Commons.</p>
            <div class="footer-links">
                <a href="../../../vi/privacy/">Quyền riêng tư</a>
                <a href="../../../vi/terms/">Điều khoản</a>
                <a href="../../../vi/about/media/">Báo chí</a>
            </div>
        </div>
    </div>
</footer>


    
    
<div class="modal-overlay" id="poll">
    <div class="modal-content poll-modal-content">
        <a href="#" class="modal-close" aria-label="Đóng">
            <span aria-hidden="true">&times;</span>
        </a>

        <div class="modal-header">
            <h2>Thăm dò ý kiến cộng đồng</h2>
            <p class="modal-subtitle">Chúng tôi rất muốn nghe ý kiến từ bạn</p>
        </div>

        <div class="modal-body">
            
            <iframe 
                id="poll-iframe"
                data-poll-id="2"
                data-api-url="https://feedback.i2p.net"
                frameborder="0"
                scrolling="no"
                style="width: 100%; border: none; min-height: 400px;">
            </iframe>
        </div>

        <div class="modal-footer">
            <p class="modal-disclaimer">
                Phiếu bầu của bạn giúp định hình tương lai của I2P.
            </p>
        </div>
    </div>
</div>


<script>
(function() {
    const iframe = document.getElementById('poll-iframe');
    if (!iframe) return;
    
    const hostname = window.location.hostname;
    let apiUrl = 'https://feedback.i2p.net';
    const pollId = iframe.getAttribute('data-poll-id') || '1';

    
    if (hostname.endsWith('.b32.i2p') || hostname.endsWith('.i2p')) {
        apiUrl = 'http://5kwyynf3eetgqa2nors6ctwo7doi7yu73k7uvypy5eqmm326zkiq.b32.i2p';
    }
    
    else if (hostname.endsWith('.onion')) {
        apiUrl = 'http://gfonxmohvarpmocsvllscsuszdu5rikipm6innvcwq4vpng7zzqmmfyd.onion';
    }

    
    const pollUrl = apiUrl + '/widgets/poll.html?poll_id=' + encodeURIComponent(pollId) + '&api_url=' + encodeURIComponent(apiUrl);
    iframe.src = pollUrl;
})();
</script>



    
    



    
    <script>
        (function () {
            'use strict';
            var hostname = window.location.hostname;
            var baseUrl;

            
            if (hostname.endsWith('.b32.i2p') || hostname.endsWith('.i2p')) {
                baseUrl = 'http://5kwyynf3eetgqa2nors6ctwo7doi7yu73k7uvypy5eqmm326zkiq.b32.i2p';
            } else if (hostname.endsWith('.onion')) {
                baseUrl = 'http://gfonxmohvarpmocsvllscsuszdu5rikipm6innvcwq4vpng7zzqmmfyd.onion';
            } else {
                baseUrl = 'https://feedback.i2p.net';
            }

            window.feedbackBaseUrl = baseUrl;

            
            document.querySelectorAll('[data-api-url]').forEach(function (widget) {
                widget.setAttribute('data-api-url', baseUrl);
            });

            
            document.write('<link rel="stylesheet" href="' + baseUrl + '/widgets/styles.css">');
            
        })();
    </script>

    

    
    
    

    

</body>

</html>
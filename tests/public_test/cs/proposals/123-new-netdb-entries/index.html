<!DOCTYPE html>
<html lang="cs" data-theme="light">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <title>Nové záznamy netDB | I2P - Projekt neviditelného internetu</title>

    <meta name="description" content="The Invisible Internet Project - A privacy-focused, anonymous network layer">
    <meta name="keywords" content="i2p, privacy, anonymity, dark net, encryption, security">

    
    <meta property="og:title" content="Nové záznamy netDB | I2P - Projekt neviditelného internetu">
    <meta property="og:description" content="The Invisible Internet Project - A privacy-focused, anonymous network layer">
    <meta property="og:type" content="website">
    <meta property="og:url" content="/cs/proposals/123-new-netdb-entries/">

    
    <link rel="icon" type="image/svg+xml" href="../../../images/favicon.svg">
    <link rel="icon" type="image/png" href="../../../images/i2plogo.png" sizes="32x32">

    
    
    
    
    <link rel="stylesheet" href="../../../css/main.min.be6880f32f5ff44e57579da7b11513b973319944ebe38748e3ac7f3268662d18.css" integrity="sha256-vmiA8y9f9E5XV52nsRUTuXMxmUTr44dI46x/MmhmLRg=">
    


    
</head>

<body>
    
    <input type="checkbox" id="theme-toggle-checkbox" class="theme-checkbox" aria-hidden="true">

    
<div class="site-banner" id="site-banner" data-banner-id="banner-3" role="alert" aria-live="polite">
    <div class="container">
        <div class="banner-content">
            <span class="banner-message">I2P Beta stránky jsou nyní spuštěny. Problémy s e-mailem hlaste na stormycloud@mail.i2p</span>
            
        </div>
        
        <form method="GET" action="../../../api/banner/dismiss" style="display: inline;">
            <input type="hidden" name="id" value="banner-3">
            <button type="submit" class="banner-close" aria-label="Zavřít banner" title="Zavřít banner">
                <span aria-hidden="true">&times;</span>
            </button>
        </form>
        
    </div>
</div>


    <header class="site-header">
    <div class="container">
        <nav class="main-nav">
            <div class="nav-brand">
                <a href="../../../cs/" class="logo-link">
                    <img src="../../../images/i2plogo_lightmode.svg" alt="I2P Logo" class="logo logo-light">
                    <img src="../../../images/i2plogo_darkmode.svg" alt="I2P Logo" class="logo logo-dark">
                </a>
            </div>

            
            <input type="checkbox" id="mobile-menu-checkbox" class="mobile-menu-checkbox"
                aria-label="Toggle navigation menu">
            <label for="mobile-menu-checkbox" class="mobile-menu-toggle" aria-label="Toggle navigation menu">
                <span class="hamburger"></span>
            </label>

            <div class="nav-menu">
                <ul class="nav-links">
                    <li class="nav-dropdown">
                        <a href="../../../cs/about/" class="">O aplikaci</a>
                        <ul class="dropdown-menu">
                            <li><a href="../../../cs/about/">Přehled</a></li>
                            <li><a href="../../../cs/papers/">Výzkumné práce</a></li>
                            <li><a href="../../../cs/about/media/">Pro média</a></li>
                            <li><a href="../../../cs/contact/">Kontaktujte nás</a></li>
                        </ul>
                    </li>
                    <li><a href="../../../cs/docs/" class="">Dokumentace</a></li>
                    <li><a href="../../../cs/downloads/" class="">Ke stažení</a></li>
                    <li><a href="../../../cs/blog/" class="">Blog</a></li>
                    <li class="nav-dropdown">
                        <a href="../../../cs/get-involved/" class="">Zapojte se</a>
                        <ul class="dropdown-menu">
                            <li><a href="../../../cs/get-involved/">Přehled</a></li>
                            <li><a href="../../../cs/feedback/">Návrhy funkcí</a></li>
                        </ul>
                    </li>
                </ul>

                <div class="nav-actions">
                    
                    <div class="language-selector">
                        <button class="language-toggle" aria-label="Select language" title="Language">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none"
                                xmlns="http://www.w3.org/2000/svg">
                                <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2" />
                                <path
                                    d="M2 12h20M12 2a15.3 15.3 0 014 10 15.3 15.3 0 01-4 10 15.3 15.3 0 01-4-10 15.3 15.3 0 014-10z"
                                    stroke="currentColor" stroke-width="2" />
                            </svg>
                            <span class="current-lang">cs</span>
                        </button>
                        <div class="language-dropdown">
                            
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../en/proposals/123-new-netdb-entries/"
                                class="lang-option">Angličtina</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../es/proposals/123-new-netdb-entries/"
                                class="lang-option">Španělština</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../ko/proposals/123-new-netdb-entries/"
                                class="lang-option">Korejština</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../zh/proposals/123-new-netdb-entries/"
                                class="lang-option">Čínština</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../ru/proposals/123-new-netdb-entries/"
                                class="lang-option">Ruština</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../cs/proposals/123-new-netdb-entries/"
                                class="lang-option active">Čeština</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../de/proposals/123-new-netdb-entries/"
                                class="lang-option">Němčina</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../fr/proposals/123-new-netdb-entries/"
                                class="lang-option">Francouzština</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../tr/proposals/123-new-netdb-entries/"
                                class="lang-option">Turečtina</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../vi/proposals/123-new-netdb-entries/"
                                class="lang-option">Vietnamština</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../hi/proposals/123-new-netdb-entries/"
                                class="lang-option">Hindština</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../ar/proposals/123-new-netdb-entries/"
                                class="lang-option">Arabština</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../pt/proposals/123-new-netdb-entries/"
                                class="lang-option">Portugalština</a>
                            
                            
                        </div>
                    </div>

                    
                    <label for="theme-toggle-checkbox" class="theme-toggle" aria-label="Toggle dark mode"
                        title="Toggle theme">
                        <svg class="sun-icon" width="20" height="20" viewBox="0 0 20 20" fill="none"
                            xmlns="http://www.w3.org/2000/svg">
                            <circle cx="10" cy="10" r="4" stroke="currentColor" stroke-width="2" />
                            <path
                                d="M10 2V4M10 16V18M18 10H16M4 10H2M15.657 4.343L14.243 5.757M5.757 14.243L4.343 15.657M15.657 15.657L14.243 14.243M5.757 5.757L4.343 4.343"
                                stroke="currentColor" stroke-width="2" stroke-linecap="round" />
                        </svg>
                        <svg class="moon-icon" width="20" height="20" viewBox="0 0 20 20" fill="none"
                            xmlns="http://www.w3.org/2000/svg">
                            <path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"
                                stroke="currentColor" stroke-width="2" stroke-linejoin="round" />
                        </svg>
                    </label>

                    
                    <a href="../../../cs/financial-support/" class="btn btn-primary" id="donate-btn">Donate</a>

                    
                    <a href="../../../cs/downloads/" class="btn btn-primary">Získat I2P</a>
                </div>
            </div>
        </nav>
    </div>
</header>

    <main id="main-content">
        



<div class="proposals-page">
    <div class="container">
        
        <nav class="breadcrumbs">
            <a href="../../../cs/">Home</a>
            <span class="separator">/</span>
            <a href="../../../cs/proposals/">Proposals</a>
            <span class="separator">/</span>
            <span class="current">Nové záznamy netDB</span>
        </nav>

        
<div class="translation-disclaimer" role="note">
    <span class="disclaimer-message">Tento překlad byl vytvořen pomocí strojového učení a nemusí být 100% přesný.</span>
    
    
    <a href="../../../en/proposals/123-new-netdb-entries/" class="disclaimer-link">Zobrazit anglickou verzi</a>
    
</div>



        
        <header class="proposal-header">
            <div class="proposal-title-section">
                <h1 class="proposal-title">Nové záznamy netDB</h1>
                <div class="proposal-number">Proposal 123</div>
            </div>

            
            <div class="proposal-meta-box">
                <div class="proposal-status status-otevřít">
                    Otevřít
                </div>

                
                <div class="proposal-info-grid">
                    
                    <div class="info-item">
                        <span class="info-label">Author</span>
                        <span class="info-value">zzz, str4d, orignal</span>
                    </div>
                    

                    
                    <div class="info-item">
                        <span class="info-label">Created</span>
                        <span class="info-value">2016-01-16</span>
                    </div>
                    

                    
                    <div class="info-item">
                        <span class="info-label">Last Updated</span>
                        <span class="info-value">2020-07-18</span>
                    </div>
                    

                    

                    
                </div>

                
                
                <div class="proposal-relationships">
                    
                    <div class="relationship">
                        <span class="relationship-label">Supercedes:</span>
                        <span class="relationship-value">110, 120, 121, 122</span>
                    </div>
                    
                    
                </div>
                
            </div>
        </header>

        
        <div class="proposal-layout proposal-layout--with-toc">
            
            
            <aside class="proposal-toc-sidebar">
                <nav class="toc-nav">
                    <div class="toc-header">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                            <path d="M4 6h16M4 12h16M4 18h16" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                        </svg>
                        On This Page
                    </div>
                    <div class="toc-content">
                        <nav id="TableOfContents">
  <ul>
    <li><a href="#stav">Stav</a></li>
    <li><a href="#přehled">Přehled</a></li>
    <li><a href="#návrh">Návrh</a>
      <ul>
        <li><a href="#goals">Goals</a></li>
        <li><a href="#non-goals--out-of-scope">Non-Goals / Out-of-scope</a></li>
        <li><a href="#justification">Justification</a></li>
        <li><a href="#cíle">Cíle</a></li>
        <li><a href="#necíle--mimo-rozsah">Necíle / Mimo rozsah</a></li>
        <li><a href="#zdůvodnění">Zdůvodnění</a></li>
        <li><a href="#datové-typy-netdb">Datové typy NetDB</a></li>
        <li><a href="#poznámky">Poznámky</a></li>
      </ul>
    </li>
    <li><a href="#standard-ls2-header">Standard LS2 Header</a>
      <ul>
        <li><a href="#proces-vyhledáváníukládání">Proces vyhledávání/ukládání</a></li>
        <li><a href="#formát">Formát</a></li>
        <li><a href="#bezpečnostní-a-soukromí-aspekty">Bezpečnostní a soukromí aspekty</a></li>
        <li><a href="#notes">Notes</a></li>
      </ul>
    </li>
    <li><a href="#new-databaseentry-types">New DatabaseEntry types</a>
      <ul>
        <li><a href="#formát-1">Formát</a></li>
        <li><a href="#zdůvodnění-1">Zdůvodnění</a></li>
        <li><a href="#problémy">Problémy</a></li>
        <li><a href="#poznámky-1">Poznámky</a></li>
        <li><a href="#new-encryption-issues">New Encryption Issues</a></li>
        <li><a href="#leaseset-2">LeaseSet 2</a></li>
        <li><a href="#formát-2">Formát</a></li>
        <li><a href="#odůvodnění">Odůvodnění</a></li>
        <li><a href="#diskuse">Diskuse</a></li>
        <li><a href="#nové-problémy-s-šifrováním">Nové problémy s šifrováním</a></li>
        <li><a href="#poznámky-2">Poznámky</a></li>
        <li><a href="#šifrovaný-ls2">Šifrovaný LS2</a></li>
        <li><a href="#definice">Definice</a></li>
        <li><a href="#formát-3">Formát</a></li>
        <li><a href="#notes-1">Notes</a></li>
        <li><a href="#meta-ls2">Meta LS2</a></li>
        <li><a href="#format">Format</a></li>
        <li><a href="#odvození-zaslepovacího-klíče">Odvození zaslepovacího klíče</a></li>
        <li><a href="#service-record">Service Record</a></li>
        <li><a href="#format-1">Format</a></li>
        <li><a href="#notes-2">Notes</a></li>
        <li><a href="#service-list">Service List</a></li>
        <li><a href="#format-2">Format</a></li>
        <li><a href="#notes-3">Notes</a></li>
      </ul>
    </li>
    <li><a href="#common-structures-spec-changes-required">Common Structures Spec Changes Required</a>
      <ul>
        <li><a href="#šifrování-a-zpracování">Šifrování a zpracování</a></li>
        <li><a href="#new-intermediate-structures">New Intermediate Structures</a></li>
        <li><a href="#new-netdb-types">New NetDB Types</a></li>
        <li><a href="#new-signature-type">New Signature Type</a></li>
      </ul>
    </li>
    <li><a href="#encryption-spec-changes-required">Encryption Spec Changes Required</a></li>
    <li><a href="#i2np-changes-required">I2NP Changes Required</a>
      <ul>
        <li><a href="#database-lookup-message">Database Lookup Message</a></li>
        <li><a href="#changes">Changes</a></li>
        <li><a href="#autorizace-podle-klienta">Autorizace podle klienta</a></li>
        <li><a href="#changes-1">Changes</a></li>
      </ul>
    </li>
    <li><a href="#i2cp-changes-required">I2CP Changes Required</a>
      <ul>
        <li><a href="#i2cp-options">I2CP Options</a></li>
        <li><a href="#session-config">Session Config</a></li>
        <li><a href="#šifrované-ls-s-base-32-adresami">Šifrované LS s Base 32 adresami</a></li>
        <li><a href="#šifrované-ls-s-offline-klíči">Šifrované LS s offline klíči</a></li>
        <li><a href="#poznámky-3">Poznámky</a></li>
        <li><a href="#meta-ls2-1">Meta LS2</a></li>
        <li><a href="#formát-4">Formát</a></li>
        <li><a href="#poznámky-4">Poznámky</a></li>
        <li><a href="#záznam-služby">Záznam služby</a></li>
        <li><a href="#formát-5">Formát</a></li>
        <li><a href="#poznámky-5">Poznámky</a></li>
        <li><a href="#seznam-služeb">Seznam služeb</a></li>
        <li><a href="#formát-6">Formát</a></li>
        <li><a href="#poznámky-6">Poznámky</a></li>
        <li><a href="#format-3">Format</a></li>
        <li><a href="#certifikáty-klíčů">Certifikáty klíčů</a></li>
        <li><a href="#nové-mezilehlé-struktury">Nové mezilehlé struktury</a></li>
        <li><a href="#nové-typy-netdb">Nové typy NetDB</a></li>
        <li><a href="#nový-typ-podpisu">Nový typ podpisu</a></li>
        <li><a href="#justification-1">Justification</a></li>
        <li><a href="#usage">Usage</a></li>
        <li><a href="#zpráva-vyhledávání-v-databázi">Zpráva vyhledávání v databázi</a></li>
        <li><a href="#změny">Změny</a></li>
        <li><a href="#zpráva-uložení-databáze">Zpráva uložení databáze</a></li>
        <li><a href="#změny-1">Změny</a></li>
      </ul>
    </li>
    <li><a href="#private-key-file-changes-required">Private Key File Changes Required</a>
      <ul>
        <li><a href="#changes-2">Changes</a></li>
        <li><a href="#možnosti-i2cp">Možnosti I2CP</a></li>
      </ul>
    </li>
    <li><a href="#streaming-changes-required">Streaming Changes Required</a>
      <ul>
        <li><a href="#konfigurace-relace">Konfigurace relace</a></li>
        <li><a href="#zpráva-request-leaseset">Zpráva Request Leaseset</a></li>
      </ul>
    </li>
    <li><a href="#standardní-ls2-hlavička">Standardní LS2 hlavička</a>
      <ul>
        <li><a href="#zpráva-požadavku-na-proměnný-leaseset">Zpráva požadavku na proměnný leaseSet</a></li>
        <li><a href="#vytvořit-zprávu-leaseset2">Vytvořit zprávu Leaseset2</a></li>
      </ul>
    </li>
    <li><a href="#sam-v3-changes-required">SAM V3 Changes Required</a>
      <ul>
        <li><a href="#odůvodnění-1">Odůvodnění</a></li>
        <li><a href="#typ-zprávy">Typ zprávy</a></li>
      </ul>
    </li>
    <li><a href="#bob-changes-required">BOB Changes Required</a></li>
    <li><a href="#publishing-migration-compatibility">Publishing, Migration, Compatibility</a></li>
    <li><a href="#rollout">Rollout</a></li>
    <li><a href="#nové-typy-databaseentry">Nové typy DatabaseEntry</a></li>
  </ul>
</nav>
                    </div>
                </nav>
            </aside>
            

            
            <div class="proposal-main">
                <article class="proposal-content">
                    <h2 id="stav">Stav</h2>
<p>Části tohoto návrhu jsou dokončeny a implementovány ve verzích 0.9.38 a 0.9.39. Specifikace Common Structures, I2CP, I2NP a další jsou nyní aktualizovány tak, aby odrážely změny, které jsou aktuálně podporovány.</p>
<p>Dokončené části jsou stále předmětem drobných revizí. Ostatní části tohoto návrhu jsou stále ve vývoji a předmětem podstatných revizí.</p>
<p>Vyhledávání služeb (typy 9 a 11) má nízkou prioritu a není naplánované, a může být vyčleněno do samostatného návrhu.</p>
<h2 id="přehled">Přehled</h2>
<p>Toto je aktualizace a agregace následujících 4 návrhů:</p>
<ul>
<li>110 LS2</li>
<li>120 Meta LS2 pro masivní multihoming</li>
<li>121 Šifrovaný LS2</li>
<li>122 Neautentizované vyhledávání služby (anycasting)</li>
</ul>
<p>Tyto návrhy jsou převážně nezávislé, ale pro rozumnost definujeme a používáme společný formát pro několik z nich.</p>
<p>Následující návrhy spolu částečně souvisí:</p>
<ul>
<li>140 Invisible Multihoming (nekompatibilní s tímto návrhem)</li>
<li>142 New Crypto Template (pro novou symetrickou kryptografii)</li>
<li>144 ECIES-X25519-AEAD-Ratchet</li>
<li>145 ECIES-P256</li>
<li>146 Red25519</li>
<li>148 EdDSA-BLAKE2b-Ed25519</li>
<li>149 B32 for Encrypted LS2</li>
<li>150 Garlic Farm Protocol</li>
<li>151 ECDSA Blinding</li>
</ul>
<h2 id="návrh">Návrh</h2>
<p>Tento návrh definuje 5 nových typů DatabaseEntry a proces pro jejich ukládání do a získávání ze síťové databáze, stejně jako metodu pro jejich podepisování a ověřování těchto podpisů.</p>
<h3 id="goals">Goals</h3>
<ul>
<li>Zpětně kompatibilní</li>
<li>LS2 použitelné se starým stylem multihomingu</li>
<li>Pro podporu nejsou vyžadovány žádné nové krypto nebo primitivy</li>
<li>Zachovat oddělení krypto a podepisování; podporovat všechny současné a budoucí verze</li>
<li>Umožnit volitelné offline podepisovací klíče</li>
<li>Snížit přesnost časových značek pro omezení fingerprintingu</li>
<li>Umožnit nové krypto pro destinations</li>
<li>Umožnit masivní multihoming</li>
<li>Opravit více problémů s existujícími šifrovanými LS</li>
<li>Volitelné blinding pro snížení viditelnosti floodfilly</li>
<li>Šifrované podporuje jak single-key tak více odvolatelných klíčů</li>
<li>Service lookup pro snadnější vyhledávání outproxies, aplikačního DHT bootstrap
a dalších využití</li>
<li>Nerozbít nic, co se spoléhá na 32-bytové binární destination hashe, např. bittorrent</li>
<li>Přidat flexibilitu do leaseSets pomocí vlastností, jako máme v routerinfos</li>
<li>Umístit publikované časové značky a variabilní expiraci do hlavičky, takže funguje i
pokud je obsah šifrován (neodvozovat časovou značku z nejdřívějšího lease)</li>
<li>Všechny nové typy žijí ve stejném DHT prostoru a na stejných místech jako existující leaseSets,
takže uživatelé mohou migrovat ze starých LS na LS2,
nebo měnit mezi LS2, Meta a Encrypted,
bez změny Destination nebo hashe</li>
<li>Existující Destination může být převedena na používání offline klíčů,
nebo zpět na online klíče, bez změny Destination nebo hashe</li>
</ul>
<h3 id="non-goals--out-of-scope">Non-Goals / Out-of-scope</h3>
<ul>
<li>Nový algoritmus rotace DHT nebo generování sdíleného náhodného čísla</li>
<li>Specifický nový typ šifrování a schéma end-to-end šifrování
pro použití tohoto nového typu by bylo v samostatném návrhu.
Žádná nová kryptografie zde není specifikována ani diskutována.</li>
<li>Nové šifrování pro RI nebo budování tunelů.
To by bylo v samostatném návrhu.</li>
<li>Metody šifrování, přenosu a příjmu I2NP DLM / DSM / DSRM zpráv.
Nemění se.</li>
<li>Jak generovat a podporovat Meta, včetně backend komunikace mezi routery, správy, převzetí služeb při selhání a koordinace.
Podpora může být přidána do I2CP, nebo i2pcontrol, nebo nového protokolu.
Toto může nebo nemusí být standardizováno.</li>
<li>Jak skutečně implementovat a spravovat tunely s delší dobou expirace, nebo zrušit existující tunely.
To je extrémně obtížné, a bez toho nemůžete mít rozumné elegantní vypnutí.</li>
<li>Změny modelu hrozeb</li>
<li>Formát offline úložiště, nebo metody pro ukládání/načítání/sdílení dat.</li>
<li>Implementační detaily zde nejsou diskutovány a jsou ponechány na každém projektu.</li>
</ul>
<h3 id="justification">Justification</h3>
<p>LS2 přidává pole pro změnu typu šifrování a pro budoucí změny protokolu.</p>
<p>Šifrované LS2 opravuje několik bezpečnostních problémů se stávajícími šifrovanými LS pomocí asymetrického šifrování celé sady leasů.</p>
<p>Meta LS2 poskytuje flexibilní, efektivní, účinné a rozsáhlé multihoming.</p>
<p>Service Record a Service List poskytují anycast služby jako je vyhledávání názvů a DHT bootstrapping.</p>
<h3 id="cíle">Cíle</h3>
<p>Čísla typů se používají ve zprávách I2NP Database Lookup/Store.</p>
<p>Sloupec end-to-end se vztahuje k tomu, zda jsou dotazy/odpovědi odesílány do Destination v Garlic Message.</p>
<p>Existující typy:</p>
<table>
  <thead>
      <tr>
          <th>NetDB Data</th>
          <th>Lookup Type</th>
          <th>Store Type</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>any</td>
          <td>0</td>
          <td>any</td>
      </tr>
      <tr>
          <td>LS</td>
          <td>1</td>
          <td>1</td>
      </tr>
      <tr>
          <td>RI</td>
          <td>2</td>
          <td>0</td>
      </tr>
      <tr>
          <td>exploratory</td>
          <td>3</td>
          <td>DSRM</td>
      </tr>
      <tr>
          <td>Nové typy:</td>
          <td></td>
          <td></td>
      </tr>
  </tbody>
</table>
<table>
  <thead>
      <tr>
          <th>NetDB Data</th>
          <th>Lookup Type</th>
          <th>Store Type</th>
          <th>Std. LS2 Header?</th>
          <th>Sent end-to-end?</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>LS2</td>
          <td>1</td>
          <td>3</td>
          <td>yes</td>
          <td>yes</td>
      </tr>
      <tr>
          <td>Encrypted LS2</td>
          <td>1</td>
          <td>5</td>
          <td>no</td>
          <td>no</td>
      </tr>
      <tr>
          <td>Meta LS2</td>
          <td>1</td>
          <td>7</td>
          <td>yes</td>
          <td>no</td>
      </tr>
      <tr>
          <td>Service Record</td>
          <td>n/a</td>
          <td>9</td>
          <td>yes</td>
          <td>no</td>
      </tr>
      <tr>
          <td>Service List</td>
          <td>4</td>
          <td>11</td>
          <td>no</td>
          <td>no</td>
      </tr>
  </tbody>
</table>
<h3 id="necíle--mimo-rozsah">Necíle / Mimo rozsah</h3>
<ul>
<li>
<p>Typy vyhledávání jsou aktuálně bity 3-2 ve zprávě Database Lookup Message.
Jakékoli další typy by vyžadovaly použití bitu 4.</p>
</li>
<li>
<p>Všechny typy úložišť jsou liché, protože starší routery ignorují vyšší bity v poli typu Database Store Message.
Raději chceme, aby parsování selhalo jako LS než jako komprimované RI.</p>
</li>
<li>
<p>Má být typ explicitní nebo implicitní, nebo ani jeden v datech pokrytých podpisem?</p>
</li>
</ul>
<h3 id="zdůvodnění">Zdůvodnění</h3>
<p>Typy 3, 5 a 7 mohou být vráceny jako odpověď na standardní vyhledávání leaseSetu (typ 1). Typ 9 není nikdy vrácen jako odpověď na vyhledávání. Typ 11 je vrácen jako odpověď na nový typ vyhledávání služby (typ 11).</p>
<p>Pouze typ 3 může být odeslán v garlic zprávě mezi klienty.</p>
<h3 id="datové-typy-netdb">Datové typy NetDB</h3>
<p>Typy 3, 7 a 9 mají všechny společný formát::</p>
<p>Standardní LS2 hlavička   - jak je definována níže</p>
<p>Část specifická pro typ - jak je definována níže v každé části</p>
<p>Standardní LS2 podpis:   - Délka podle typu podpisu podepisovacího klíče</p>
<p>Typ 5 (Šifrovaný) nezačíná Destination a má odlišný formát. Viz níže.</p>
<p>Typ 11 (Seznam služeb) je agregací několika Service Records a má odlišný formát. Viz níže.</p>
<h3 id="poznámky">Poznámky</h3>
<p>TBD</p>
<h2 id="standard-ls2-header">Standard LS2 Header</h2>
<p>Typy 3, 7 a 9 používají standardní LS2 hlavičku, specifikovanou níže:</p>
<h3 id="proces-vyhledáváníukládání">Proces vyhledávání/ukládání</h3>
<pre tabindex="0"><code>Standard LS2 Header:
  - Type (1 byte)
    Not actually in header, but part of data covered by signature.
    Take from field in Database Store Message.
  - Destination (387+ bytes)
  - Published timestamp (4 bytes, big endian, seconds since epoch, rolls over in 2106)
  - Expires (2 bytes, big endian) (offset from published timestamp in seconds, 18.2 hours max)
  - Flags (2 bytes)
    Bit order: 15 14 ... 3 2 1 0
    Bit 0: If 0, no offline keys; if 1, offline keys
    Bit 1: If 0, a standard published leaseset.
           If 1, an unpublished leaseset. Should not be flooded, published, or
           sent in response to a query. If this leaseset expires, do not query the
           netdb for a new one, unless bit 2 is set.
    Bit 2: If 0, a standard published leaseset.
           If 1, this unencrypted leaseset will be blinded and encrypted when published.
           If this leaseset expires, query the blinded location in the netdb for a new one.
           If this bit is set to 1, set bit 1 to 1 also.
           As of release 0.9.42.
    Bits 3-15: set to 0 for compatibility with future uses
  - If flag indicates offline keys, the offline signature section:
    Expires timestamp (4 bytes, big endian, seconds since epoch, rolls over in 2106)
    Transient sig type (2 bytes, big endian)
    Transient signing public key (length as implied by sig type)
    Signature of expires timestamp, transient sig type, and public key,
    by the destination public key,
    length as implied by destination public key sig type.
    This section can, and should, be generated offline.
</code></pre><h3 id="formát">Formát</h3>
<ul>
<li>
<p>Unpublished/published: Pro použití při odesílání database store end-to-end,
odesílající router může chtít označit, že tento leaseSet by neměl být
odeslán ostatním. V současnosti používáme heuristiky pro udržování tohoto stavu.</p>
</li>
<li>
<p>Published: Nahrazuje komplexní logiku potřebnou k určení &lsquo;verze&rsquo; leaseSetu. V současnosti je verzí vypršení posledního vypršujícího lease, a publikující router musí zvýšit toto vypršení alespoň o 1ms při publikování leaseSetu, který pouze odstraňuje starší lease.</p>
</li>
<li>
<p>Expires: Umožňuje, aby vypršení platnosti záznamu netDb bylo dříve než u jeho naposledy vypršující leaseSet. Nemusí být užitečné pro LS2, kde se očekává, že leaseSet zůstanou s maximální dobou platnosti 11 minut, ale pro jiné nové typy je to nezbytné (viz Meta LS a Service Record níže).</p>
</li>
<li>
<p>Offline klíče jsou volitelné, aby se snížila počáteční/požadovaná složitost implementace.</p>
</li>
</ul>
<h3 id="bezpečnostní-a-soukromí-aspekty">Bezpečnostní a soukromí aspekty</h3>
<ul>
<li>
<p>Mohlo by snížit přesnost časové značky ještě více (10 minut?), ale bylo by třeba přidat
číslo verze. To by mohlo narušit multihoming, pokud nemáme šifrování zachovávající pořadí?
Pravděpodobně se bez časových značek úplně obejít nemůžeme.</p>
</li>
<li>
<p>Alternativa: 3bytový timestamp (epoch / 10 minut), 1bytová verze, 2bytový expires</p>
</li>
<li>
<p>Je typ explicitní nebo implicitní v datech / podpisu? &ldquo;Domain&rdquo; konstanty pro podpis?</p>
</li>
</ul>
<h3 id="notes">Notes</h3>
<ul>
<li>
<p>Routery by neměly publikovat LS více než jednou za sekundu.
Pokud tak učiní, musí uměle navýšit publikované časové razítko o 1
oproti předchozímu publikovanému LS.</p>
</li>
<li>
<p>Implementace routerů mohou ukládat přechodné klíče a podpis do cache,
aby se vyhnuly ověřování při každém použití. Zejména floodfilly a routery na
obou koncích dlouhodobých spojení by z toho mohly těžit.</p>
</li>
<li>
<p>Offline klíče a podpis jsou vhodné pouze pro dlouhodobě existující destinace,
tj. servery, ne klienty.</p>
</li>
</ul>
<h2 id="new-databaseentry-types">New DatabaseEntry types</h2>
<h3 id="formát-1">Formát</h3>
<p>Změny oproti stávajícímu LeaseSet:</p>
<ul>
<li>Přidat publikované časové razítko, časové razítko vypršení, příznaky a vlastnosti</li>
<li>Přidat typ šifrování</li>
<li>Odstranit revokační klíč</li>
</ul>
<p>Vyhledávání pomocí</p>
<pre><code>Standard LS flag (1)
</code></pre>
<p>Uložit pomocí</p>
<pre><code>Standard LS2 type (3)
</code></pre>
<p>Uložit v</p>
<pre><code>Hash of destination
This hash is then used to generate the daily &quot;routing key&quot;, as in LS1
</code></pre>
<p>Typická expirace</p>
<pre><code>10 minutes, as in a regular LS.
</code></pre>
<p>Publikoval</p>
<pre><code>Destination
</code></pre>
<h3 id="zdůvodnění-1">Zdůvodnění</h3>
<pre tabindex="0"><code>Standard LS2 Header as specified above

  Standard LS2 Type-Specific Part
  - Properties (Mapping as specified in common structures spec, 2 zero bytes if none)
  - Number of key sections to follow (1 byte, max TBD)
  - Key sections:
    - Encryption type (2 bytes, big endian)
    - Encryption key length (2 bytes, big endian)
      This is explicit, so floodfills can parse LS2 with unknown encryption types.
    - Encryption key (number of bytes specified)
  - Number of lease2s (1 byte)
  - Lease2s (40 bytes each)
    These are leases, but with a 4-byte instead of an 8-byte expiration,
    seconds since the epoch (rolls over in 2106)

  Standard LS2 Signature:
  - Signature
    If flag indicates offline keys, this is signed by the transient pubkey,
    otherwise, by the destination pubkey
    Length as implied by sig type of signing key
    The signature is of everything above.
</code></pre><h3 id="problémy">Problémy</h3>
<ul>
<li>
<p>Properties: Budoucí rozšíření a flexibilita.
Umístěno na první pozici pro případ, že by bylo nutné pro parsování zbývajících dat.</p>
</li>
<li>
<p>Více párů typů šifrování/veřejných klíčů má
usnadnit přechod na nové typy šifrování. Druhým způsobem, jak to udělat,
je publikovat více leaseSetů, případně použít stejné tunely,
jak to děláme nyní pro DSA a EdDSA destinace.
Identifikace příchozího typu šifrování v tunelu
může být provedena pomocí stávajícího mechanismu session tag,
a/nebo zkuškového dešifrování pomocí každého klíče. Délky příchozích
zpráv mohou také poskytnout nápovědu.</p>
</li>
</ul>
<h3 id="poznámky-1">Poznámky</h3>
<p>Tento návrh nadále používá veřejný klíč v leaseSet pro koncové šifrovací klíče a ponechává pole veřejného klíče v Destination nepoužité, jak je tomu nyní. Typ šifrování není specifikován v certifikátu klíče Destination, zůstane 0.</p>
<p>Odmítnutou alternativou je specifikovat typ šifrování v certifikátu klíče Destination, použít veřejný klíč v Destination a nepoužívat veřejný klíč v leaseset. Neplánujeme toto dělat.</p>
<p>Výhody LS2:</p>
<ul>
<li>Umístění skutečného veřejného klíče se nemění.</li>
<li>Typ šifrování nebo veřejný klíč se může změnit bez změny Destination.</li>
<li>Odstraňuje nepoužívané pole pro odvolání</li>
<li>Základní kompatibilita s ostatními typy DatabaseEntry v tomto návrhu</li>
<li>Umožňuje více typů šifrování</li>
</ul>
<p>Nevýhody LS2:</p>
<ul>
<li>Umístění veřejného klíče a typ šifrování se liší od RouterInfo</li>
<li>Udržuje nepoužívaný veřejný klíč v leaseset</li>
<li>Vyžaduje implementaci napříč sítí; alternativně mohou být použity experimentální
typy šifrování, pokud to floodfills dovolují
(viz související návrhy 136 a 137 o podpoře experimentálních typů podpisů).
Alternativní návrh by mohl být jednodušší na implementaci a testování pro experimentální typy šifrování.</li>
</ul>
<h3 id="new-encryption-issues">New Encryption Issues</h3>
<p>Některé z těchto bodů jsou mimo rozsah tohoto návrhu, ale prozatím zde uvádíme poznámky, protože ještě nemáme samostatný návrh pro šifrování. Viz také ECIES návrhy 144 a 145.</p>
<ul>
<li>
<p>Typ šifrování představuje kombinaci
křivky, délky klíče a end-to-end schématu,
včetně KDF a MAC, pokud existují.</p>
</li>
<li>
<p>Zahrnuli jsme pole délky klíče, takže LS2 je
parsovatelný a ověřitelný floodfill uzly i pro neznámé typy šifrování.</p>
</li>
<li>
<p>První nový typ šifrování, který bude navržen, bude
pravděpodobně ECIES/X25519. Jak bude použit end-to-end
(buď mírně upravená verze ElGamal/AES+SessionTag
nebo něco zcela nového, např. ChaCha/Poly) bude specifikováno
v jednom nebo více samostatných návrzích.
Viz také ECIES návrhy 144 a 145.</p>
</li>
</ul>
<h3 id="leaseset-2">LeaseSet 2</h3>
<ul>
<li>
<p>8-bajtová expirace v lease změněna na 4 bajty.</p>
</li>
<li>
<p>Pokud někdy implementujeme revokaci, můžeme to udělat s expires polem nastaveným na nulu,
nebo nulovými leases, nebo obojím. Není potřeba separátního revokačního klíče.</p>
</li>
<li>
<p>Šifrovací klíče jsou seřazeny podle preferencí serveru, nejpreferovanější je první.
Výchozí chování klienta je vybrat první klíč s
podporovaným typem šifrování. Klienti mohou použít jiné algoritmy výběru
založené na podpoře šifrování, relativním výkonu a dalších faktorech.</p>
</li>
</ul>
<h3 id="formát-2">Formát</h3>
<p>Cíle:</p>
<ul>
<li>Přidat blinding</li>
<li>Povolit více typů podpisů</li>
<li>Nevyžadovat žádné nové kryptografické primitivy</li>
<li>Volitelně šifrovat pro každého příjemce, odvolatelné</li>
<li>Podporovat šifrování pouze Standard LS2 a Meta LS2</li>
</ul>
<p>Šifrované LS2 se nikdy neodesílá v end-to-end garlic zprávě. Použijte standardní LS2 jako výše.</p>
<p>Změny oproti existujícímu šifrovanému LeaseSet:</p>
<ul>
<li>Zašifrovat celý obsah pro zabezpečení</li>
<li>Bezpečně zašifrovat, ne pouze pomocí AES</li>
<li>Zašifrovat pro každého příjemce</li>
</ul>
<p>Vyhledání pomocí</p>
<pre><code>Standard LS flag (1)
</code></pre>
<p>Uložit pomocí</p>
<pre><code>Encrypted LS2 type (5)
</code></pre>
<p>Uložit v</p>
<pre><code>Hash of blinded sig type and blinded public key
Two byte sig type (big endian, e.g. 0x000b) || blinded public key
This hash is then used to generate the daily &quot;routing key&quot;, as in LS1
</code></pre>
<p>Typická expirace</p>
<pre><code>10 minutes, as in a regular LS, or hours, as in a meta LS.
</code></pre>
<p>Publikoval</p>
<pre><code>Destination
</code></pre>
<h3 id="odůvodnění">Odůvodnění</h3>
<p>Definujeme následující funkce odpovídající kryptografickým stavebním blokům používaným pro šifrované LS2:</p>
<p>CSRNG(n)</p>
<pre><code>n-byte output from a cryptographically-secure random number generator.

In addition to the requirement of CSRNG being cryptographically-secure (and thus
suitable for generating key material), it MUST be safe
for some n-byte output to be used for key material when the byte sequences immediately
preceding and following it are exposed on the network (such as in a salt, or encrypted
padding). Implementations that rely on a potentially-untrustworthy source should hash
any output that is to be exposed on the network. See [PRNG references](http://projectbullrun.org/dual-ec/ext-rand.html) and [Tor dev discussion](https://lists.torproject.org/pipermail/tor-dev/2015-November/009954.html).
</code></pre>
<p>H(p, d)</p>
<pre><code>SHA-256 hash function that takes a personalization string p and data d, and
produces an output of length 32 bytes.

Use SHA-256 as follows::

    H(p, d) := SHA-256(p || d)
</code></pre>
<p>STREAM</p>
<pre><code>The ChaCha20 stream cipher as specified in [RFC 7539 Section 2.4](https://tools.ietf.org/html/rfc7539#section-2.4), with the initial counter
set to 1. S_KEY_LEN = 32 and S_IV_LEN = 12.

ENCRYPT(k, iv, plaintext)
    Encrypts plaintext using the cipher key k, and nonce iv which MUST be unique for
    the key k. Returns a ciphertext that is the same size as the plaintext.

    The entire ciphertext must be indistinguishable from random if the key is secret.

DECRYPT(k, iv, ciphertext)
    Decrypts ciphertext using the cipher key k, and nonce iv. Returns the plaintext.
</code></pre>
<p>SIG</p>
<pre><code>The RedDSA signature scheme (corresponding to SigType 11) with key blinding.
It has the following functions:

DERIVE_PUBLIC(privkey)
    Returns the public key corresponding to the given private key.

SIGN(privkey, m)
    Returns a signature by the private key privkey over the given message m.

VERIFY(pubkey, m, sig)
    Verifies the signature sig against the public key pubkey and message m. Returns
    true if the signature is valid, false otherwise.

It must also support the following key blinding operations:

GENERATE_ALPHA(data, secret)
    Generate alpha for those who know the data and an optional secret.
    The result must be identically distributed as the private keys.

BLIND_PRIVKEY(privkey, alpha)
    Blinds a private key, using a secret alpha.

BLIND_PUBKEY(pubkey, alpha)
    Blinds a public key, using a secret alpha.
    For a given keypair (privkey, pubkey) the following relationship holds::

        BLIND_PUBKEY(pubkey, alpha) ==
        DERIVE_PUBLIC(BLIND_PRIVKEY(privkey, alpha))
</code></pre>
<p>DH</p>
<pre><code>X25519 public key agreement system. Private keys of 32 bytes, public keys of 32
bytes, produces outputs of 32 bytes. It has the following
functions:

GENERATE_PRIVATE()
    Generates a new private key.

DERIVE_PUBLIC(privkey)
    Returns the public key corresponding to the given private key.

DH(privkey, pubkey)
    Generates a shared secret from the given private and public keys.
</code></pre>
<p>HKDF(salt, ikm, info, n)</p>
<pre><code>A cryptographic key derivation function which takes some input key material ikm (which
should have good entropy but is not required to be a uniformly random string), a salt
of length 32 bytes, and a context-specific 'info' value, and produces an output
of n bytes suitable for use as key material.

Use HKDF as specified in [RFC 5869](https://tools.ietf.org/html/rfc5869), using the HMAC hash function SHA-256
as specified in [RFC 2104](https://tools.ietf.org/html/rfc2104). This means that SALT_LEN is 32 bytes max.
</code></pre>
<h3 id="diskuse">Diskuse</h3>
<p>Šifrovaný formát LS2 se skládá ze tří vnořených vrstev:</p>
<ul>
<li>Vnější vrstva obsahující nezbytné informace v prostém textu pro ukládání a získávání.</li>
<li>Střední vrstva, která zajišťuje autentifikaci klienta.</li>
<li>Vnitřní vrstva obsahující skutečná data LS2.</li>
</ul>
<p>Celkový formát vypadá takto::</p>
<pre><code>Layer 0 data + Enc(layer 1 data + Enc(layer 2 data)) + Signature
</code></pre>
<p>Poznamenejte, že šifrovaný LS2 je zaslepený. Destination není v hlavičce. Umístění DHT úložiště je SHA-256(sig type || blinded public key) a je denně rotováno.</p>
<p>Nepoužívá standardní LS2 hlavičku specifikovanou výše.</p>
<h4 id="layer-0-outer">Layer 0 (outer)</h4>
<p>Typ</p>
<pre><code>1 byte

Not actually in header, but part of data covered by signature.
Take from field in Database Store Message.
</code></pre>
<p>Typ podpisu zaslepeného veřejného klíče</p>
<pre><code>2 bytes, big endian
This will always be type 11, identifying a Red25519 blinded key.
</code></pre>
<p>Zaslepený veřejný klíč</p>
<pre><code>Length as implied by sig type
</code></pre>
<p>Časové razítko publikování</p>
<pre><code>4 bytes, big endian

Seconds since epoch, rolls over in 2106
</code></pre>
<p>Platnost vyprší</p>
<pre><code>2 bytes, big endian

Offset from published timestamp in seconds, 18.2 hours max
</code></pre>
<p>Příznaky</p>
<pre><code>2 bytes

Bit order: 15 14 ... 3 2 1 0

Bit 0: If 0, no offline keys; if 1, offline keys

Other bits: set to 0 for compatibility with future uses
</code></pre>
<p>Přechodná klíčová data</p>
<pre><code>Present if flag indicates offline keys

Expires timestamp
    4 bytes, big endian

    Seconds since epoch, rolls over in 2106

Transient sig type
    2 bytes, big endian

Transient signing public key
    Length as implied by sig type

Signature
    Length as implied by blinded public key sig type

    Over expires timestamp, transient sig type, and transient public key.

    Verified with the blinded public key.
</code></pre>
<p>lenOuterCiphertext</p>
<pre><code>2 bytes, big endian
</code></pre>
<p>outerCiphertext</p>
<pre><code>lenOuterCiphertext bytes

Encrypted layer 1 data. See below for key derivation and encryption algorithms.
</code></pre>
<p>Podpis</p>
<pre><code>Length as implied by sig type of the signing key used

The signature is of everything above.

If the flag indicates offline keys, the signature is verified with the transient
public key. Otherwise, the signature is verified with the blinded public key.
</code></pre>
<h4 id="layer-1-middle">Layer 1 (middle)</h4>
<p>Příznaky</p>
<pre><code>1 byte

Bit order: 76543210

Bit 0: 0 for everybody, 1 for per-client, auth section to follow

Bits 3-1: Authentication scheme, only if bit 0 is set to 1 for per-client, otherwise 000
          000: DH client authentication (or no per-client authentication)
          001: PSK client authentication

Bits 7-4: Unused, set to 0 for future compatibility
</code></pre>
<p>DH autentizační data klienta</p>
<pre><code>Present if flag bit 0 is set to 1 and flag bits 3-1 are set to 000.

ephemeralPublicKey
    32 bytes

clients
    2 bytes, big endian

    Number of authClient entries to follow, 40 bytes each

authClient
    Authorization data for a single client.
    See below for the per-client authorization algorithm.

    clientID_i
        8 bytes

    clientCookie_i
        32 bytes
</code></pre>
<p>PSK data pro ověření klienta</p>
<pre><code>Present if flag bit 0 is set to 1 and flag bits 3-1 are set to 001.

authSalt
    32 bytes

clients
    2 bytes, big endian

    Number of authClient entries to follow, 40 bytes each

authClient
    Authorization data for a single client.
    See below for the per-client authorization algorithm.

    clientID_i
        8 bytes

    clientCookie_i
        32 bytes
</code></pre>
<p>innerCiphertext</p>
<pre><code>Length implied by lenOuterCiphertext (whatever data remains)

Encrypted layer 2 data. See below for key derivation and encryption algorithms.
</code></pre>
<h4 id="layer-2-inner">Layer 2 (inner)</h4>
<p>Typ</p>
<pre><code>1 byte

Either 3 (LS2) or 7 (Meta LS2)
</code></pre>
<p>Data</p>
<pre><code>LeaseSet2 data for the given type.

Includes the header and signature.
</code></pre>
<h3 id="nové-problémy-s-šifrováním">Nové problémy s šifrováním</h3>
<p>Používáme následující schéma pro key blinding, založené na Ed25519 a <a href="https://github.com/zcash/zips/tree/master/protocol/protocol.pdf">ZCash RedDSA</a>
. Re25519 podpisy jsou nad Ed25519 křivkou, s použitím SHA-512 pro hash.</p>
<p>Nepoužíváme <a href="https://spec.torproject.org/rend-spec-v3">Tor&rsquo;s rend-spec-v3.txt appendix A.2</a>
, který má podobné návrhové cíle, protože jeho zaslepené veřejné klíče mohou být mimo podskupinu prvočíselného řádu, s neznámými bezpečnostními důsledky.</p>
<h4 id="goals-1">Goals</h4>
<ul>
<li>Podpisový veřejný klíč v neoslepeném cíli musí být
Ed25519 (typ podpisu 7) nebo Red25519 (typ podpisu 11);
žádné jiné typy podpisů nejsou podporovány</li>
<li>Pokud je podpisový veřejný klíč offline, přechodný podpisový veřejný klíč musí být také Ed25519</li>
<li>Blinding je výpočetně jednoduché</li>
<li>Používá stávající kryptografické primitiva</li>
<li>Oslepené veřejné klíče nelze rozoslepit</li>
<li>Oslepené veřejné klíče musí být na křivce Ed25519 a v podgrupě s prvočíselným řádem</li>
<li>Pro odvození oslepeného veřejného klíče je nutné znát podpisový veřejný klíč cíle
(kompletní cíl není vyžadován)</li>
<li>Volitelně poskytuje dodatečné tajemství požadované pro odvození oslepeného veřejného klíče</li>
</ul>
<h4 id="security">Security</h4>
<p>Bezpečnost blinding schématu vyžaduje, aby distribuce alpha byla stejná jako u neoslepených soukromých klíčů. Když však oslepíme Ed25519 soukromý klíč (sig type 7) na Red25519 soukromý klíč (sig type 11), distribuce je odlišná. Pro splnění požadavků <a href="https://github.com/zcash/zips/tree/master/protocol/protocol.pdf">zcash section 4.1.6.1</a>
 by měl být Red25519 (sig type 11) použit i pro neoslepené klíče, takže &ldquo;kombinace re-randomizovaného veřejného klíče a podpisu/ů pod tímto klíčem neodhalí klíč, ze kterého byl re-randomizován.&rdquo; Umožňujeme type 7 pro existující destinace, ale doporučujeme type 11 pro nové destinace, které budou šifrovány.</p>
<h4 id="definitions">Definitions</h4>
<p>B</p>
<pre><code>The Ed25519 base point (generator) 2^255 - 19 as in [Ed25519](http://cr.yp.to/papers.html#ed25519)
</code></pre>
<p>L</p>
<pre><code>The Ed25519 order 2^252 + 27742317777372353535851937790883648493
as in [Ed25519](http://cr.yp.to/papers.html#ed25519)
</code></pre>
<p>DERIVE_PUBLIC(a)</p>
<pre><code>Convert a private key to public, as in Ed25519 (mulitply by G)
</code></pre>
<p>alfa</p>
<pre><code>A 32-byte random number known to those who know the destination.
</code></pre>
<p>GENERATE_ALPHA(destination, date, secret)</p>
<pre><code>Generate alpha for the current date, for those who know the destination and the secret.
The result must be identically distributed as Ed25519 private keys.
</code></pre>
<p>a</p>
<pre><code>The unblinded 32-byte EdDSA or RedDSA signing private key used to sign the destination
</code></pre>
<p>A</p>
<pre><code>The unblinded 32-byte EdDSA or RedDSA signing public key in the destination,
= DERIVE_PUBLIC(a), as in Ed25519
</code></pre>
<p>a&rsquo;</p>
<pre><code>The blinded 32-byte EdDSA signing private key used to sign the encrypted leaseset
This is a valid EdDSA private key.
</code></pre>
<p>A'</p>
<pre><code>The blinded 32-byte EdDSA signing public key in the Destination,
may be generated with DERIVE_PUBLIC(a'), or from A and alpha.
This is a valid EdDSA public key, on the curve and on the prime-order subgroup.
</code></pre>
<p>LEOS2IP(x)</p>
<pre><code>Flip the order of the input bytes to little-endian
</code></pre>
<p>H*(x)</p>
<pre><code>32 bytes = (LEOS2IP(SHA512(x))) mod B, same as in Ed25519 hash-and-reduce
</code></pre>
<h4 id="blinding-calculations">Blinding Calculations</h4>
<p>Nové tajné alpha a blinded klíče musí být vygenerovány každý den (UTC). Tajné alpha a blinded klíče se vypočítávají následovně.</p>
<p>GENERATE_ALPHA(destination, date, secret), pro všechny strany:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>// GENERATE_ALPHA(destination, date, secret)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  // secret is optional, else zero-length
</span></span><span style="display:flex;"><span>  A = destination&#39;s signing public key
</span></span><span style="display:flex;"><span>  stA = signature type of A, 2 bytes big endian (0x0007 or 0x000b)
</span></span><span style="display:flex;"><span>  stA&#39; = signature type of blinded public key A&#39;, 2 bytes big endian (0x000b)
</span></span><span style="display:flex;"><span>  keydata = A || stA || stA&#39;
</span></span><span style="display:flex;"><span>  datestring = 8 bytes ASCII YYYYMMDD from the current date UTC
</span></span><span style="display:flex;"><span>  secret = UTF-8 encoded string
</span></span><span style="display:flex;"><span>  seed = HKDF(H(&#34;I2PGenerateAlpha&#34;, keydata), datestring || secret, &#34;i2pblinding1&#34;, 64)
</span></span><span style="display:flex;"><span>  // treat seed as a 64 byte little-endian value
</span></span><span style="display:flex;"><span>  alpha = seed mod L
</span></span></code></pre></div><p>BLIND_PRIVKEY(), pro vlastníka publikujícího leaseSet:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>// BLIND_PRIVKEY()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  alpha = GENERATE_ALPHA(destination, date, secret)
</span></span><span style="display:flex;"><span>  // If for a Ed25519 private key (type 7)
</span></span><span style="display:flex;"><span>  seed = destination&#39;s signing private key
</span></span><span style="display:flex;"><span>  a = left half of SHA512(seed) and clamped as usual for Ed25519
</span></span><span style="display:flex;"><span>  // else, for a Red25519 private key (type 11)
</span></span><span style="display:flex;"><span>  a = destination&#39;s signing private key
</span></span><span style="display:flex;"><span>  // Addition using scalar arithmentic
</span></span><span style="display:flex;"><span>  blinded signing private key = a&#39; = BLIND_PRIVKEY(a, alpha) = (a + alpha) mod L
</span></span><span style="display:flex;"><span>  blinded signing public key = A&#39; = DERIVE_PUBLIC(a&#39;)
</span></span></code></pre></div><p>BLIND_PUBKEY(), pro klienty získávající leaseset:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>// BLIND_PUBKEY()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  alpha = GENERATE_ALPHA(destination, date, secret)
</span></span><span style="display:flex;"><span>  A = destination&#39;s signing public key
</span></span><span style="display:flex;"><span>  // Addition using group elements (points on the curve)
</span></span><span style="display:flex;"><span>  blinded public key = A&#39; = BLIND_PUBKEY(A, alpha) = A + DERIVE_PUBLIC(alpha)
</span></span></code></pre></div><p>Obě metody výpočtu A&rsquo; poskytují stejný výsledek, jak je požadováno.</p>
<h4 id="signing">Signing</h4>
<p>Neoslepený leaseset je podepsán neoslepeným Ed25519 nebo Red25519 podepisovacím privátním klíčem a ověřen neoslepeným Ed25519 nebo Red25519 podepisovacím veřejným klíčem (typy podpisů 7 nebo 11) jako obvykle.</p>
<p>Pokud je veřejný klíč pro podepisování offline, neoslepený leaseset je podepsán neoslepeným přechodným soukromým klíčem Ed25519 nebo Red25519 pro podepisování a ověřen neoslepeným přechodným veřejným klíčem Ed25519 nebo Red25519 pro podepisování (typy podpisů 7 nebo 11) obvyklým způsobem. Další poznámky k offline klíčům pro šifrované leasesety viz níže.</p>
<p>Pro podepisování šifrovaného leaseSet používáme Red25519, založené na <a href="https://github.com/zcash/zips/tree/master/protocol/protocol.pdf">RedDSA</a>
 pro podepisování a ověřování se zaslepenými klíči. Podpisy Red25519 jsou nad křivkou Ed25519, používající SHA-512 pro hash.</p>
<p>Red25519 je identický se standardním Ed25519 kromě níže uvedených specifikací.</p>
<h4 id="signverify-calculations">Sign/Verify Calculations</h4>
<p>Vnější část šifrovaného leaseSetu používá Red25519 klíče a podpisy.</p>
<p>Red25519 je téměř identické s Ed25519. Existují dva rozdíly:</p>
<p>Red25519 soukromé klíče jsou generovány z náhodných čísel a poté musí být redukovány mod L, kde L je definováno výše. Ed25519 soukromé klíče jsou generovány z náhodných čísel a poté &ldquo;svorkovány&rdquo; pomocí bitového maskování na byty 0 a 31. Toto se pro Red25519 nedělá. Funkce GENERATE_ALPHA() a BLIND_PRIVKEY() definované výše generují správné Red25519 soukromé klíče pomocí mod L.</p>
<p>V Red25519 používá výpočet r pro podepisování dodatečná náhodná data a využívá hodnotu veřejného klíče namísto hashe soukromého klíče. Díky náhodným datům je každý Red25519 podpis odlišný, i když se podepisují stejná data se stejným klíčem.</p>
<p>Podepisování:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>T = 80 random bytes
</span></span><span style="display:flex;"><span>  r = H*(T || publickey || message)
</span></span><span style="display:flex;"><span>  // rest is the same as in Ed25519
</span></span></code></pre></div><p>Ověření:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>// same as in Ed25519
</span></span></code></pre></div><h3 id="poznámky-2">Poznámky</h3>
<h4 id="derivation-of-subcredentials">Derivation of subcredentials</h4>
<p>V rámci procesu blinding musíme zajistit, že šifrovaný LS2 může být dešifrován pouze někým, kdo zná odpovídající veřejný podpisový klíč Destination. Úplná Destination není vyžadována. K dosažení tohoto cíle odvodíme credential z veřejného podpisového klíče:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>A = destination&#39;s signing public key
</span></span><span style="display:flex;"><span>  stA = signature type of A, 2 bytes big endian (0x0007 or 0x000b)
</span></span><span style="display:flex;"><span>  stA&#39; = signature type of A&#39;, 2 bytes big endian (0x000b)
</span></span><span style="display:flex;"><span>  keydata = A || stA || stA&#39;
</span></span><span style="display:flex;"><span>  credential = H(&#34;credential&#34;, keydata)
</span></span></code></pre></div><p>Personalizační řetězec zajišťuje, že credential nekoliduje s jakýmkoli hashem použitým jako klíč pro DHT vyhledávání, například s prostým hashem Destination.</p>
<p>Pro daný blinded key můžeme poté odvodit subcredential:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>subcredential = H(&#34;subcredential&#34;, credential || blindedPublicKey)
</span></span></code></pre></div><p>Subcredential je zahrnuta do procesů odvození klíčů níže, které tyto klíče váží na znalost podpisového veřejného klíče Destination.</p>
<h4 id="layer-1-encryption">Layer 1 encryption</h4>
<p>Nejprve je připraven vstup pro proces derivace klíče:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>outerInput = subcredential || publishedTimestamp
</span></span></code></pre></div><p>Dále je vygenerována náhodná sůl:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>outerSalt = CSRNG(32)
</span></span></code></pre></div><p>Poté je odvozený klíč použitý k šifrování vrstvy 1:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>keys = HKDF(outerSalt, outerInput, &#34;ELS2_L1K&#34;, 44)
</span></span><span style="display:flex;"><span>  outerKey = keys[0:31]
</span></span><span style="display:flex;"><span>  outerIV = keys[32:43]
</span></span></code></pre></div><p>Nakonec je vrstva 1 prostý text zašifrována a serializována:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>outerCiphertext = outerSalt || ENCRYPT(outerKey, outerIV, outerPlaintext)
</span></span></code></pre></div><h4 id="layer-1-decryption">Layer 1 decryption</h4>
<p>Sůl je analyzována z šifrovaného textu vrstvy 1:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>outerSalt = outerCiphertext[0:31]
</span></span></code></pre></div><p>Poté je odvozen klíč použitý k zašifrování vrstvy 1:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>outerInput = subcredential || publishedTimestamp
</span></span><span style="display:flex;"><span>  keys = HKDF(outerSalt, outerInput, &#34;ELS2_L1K&#34;, 44)
</span></span><span style="display:flex;"><span>  outerKey = keys[0:31]
</span></span><span style="display:flex;"><span>  outerIV = keys[32:43]
</span></span></code></pre></div><p>Nakonec je dešifrován ciphertext vrstvy 1:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>outerPlaintext = DECRYPT(outerKey, outerIV, outerCiphertext[32:end])
</span></span></code></pre></div><h4 id="layer-2-encryption">Layer 2 encryption</h4>
<p>Když je povolena autorizace klienta, <code>authCookie</code> se vypočítá jak je popsáno níže. Když je autorizace klienta zakázána, <code>authCookie</code> je pole bajtů s nulovou délkou.</p>
<p>Šifrování probíhá podobným způsobem jako u vrstvy 1:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>innerInput = authCookie || subcredential || publishedTimestamp
</span></span><span style="display:flex;"><span>  innerSalt = CSRNG(32)
</span></span><span style="display:flex;"><span>  keys = HKDF(innerSalt, innerInput, &#34;ELS2_L2K&#34;, 44)
</span></span><span style="display:flex;"><span>  innerKey = keys[0:31]
</span></span><span style="display:flex;"><span>  innerIV = keys[32:43]
</span></span><span style="display:flex;"><span>  innerCiphertext = innerSalt || ENCRYPT(innerKey, innerIV, innerPlaintext)
</span></span></code></pre></div><h4 id="layer-2-decryption">Layer 2 decryption</h4>
<p>Když je povolena autorizace klienta, <code>authCookie</code> se vypočítá podle popisu níže. Když je autorizace klienta zakázána, <code>authCookie</code> je pole bajtů nulové délky.</p>
<p>Dešifrování probíhá podobným způsobem jako u vrstvy 1:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>innerInput = authCookie || subcredential || publishedTimestamp
</span></span><span style="display:flex;"><span>  innerSalt = innerCiphertext[0:31]
</span></span><span style="display:flex;"><span>  keys = HKDF(innerSalt, innerInput, &#34;ELS2_L2K&#34;, 44)
</span></span><span style="display:flex;"><span>  innerKey = keys[0:31]
</span></span><span style="display:flex;"><span>  innerIV = keys[32:43]
</span></span><span style="display:flex;"><span>  innerPlaintext = DECRYPT(innerKey, innerIV, innerCiphertext[32:end])
</span></span></code></pre></div><h3 id="šifrovaný-ls2">Šifrovaný LS2</h3>
<p>Když je pro Destination povolena autorizace klientů, server udržuje seznam klientů, které autorizuje k dešifrování zašifrovaných dat LS2. Data uložená pro každého klienta závisí na autorizačním mechanismu a zahrnují určitou formu klíčového materiálu, který každý klient generuje a odesílá serveru prostřednictvím zabezpečeného out-of-band mechanismu.</p>
<p>Existují dvě alternativy pro implementaci autorizace podle klientů:</p>
<h4 id="dh-client-authorization">DH client authorization</h4>
<p>Každý klient vygeneruje DH pár klíčů <code>[csk_i, cpk_i]</code> a odešle veřejný klíč <code>cpk_i</code> na server.</p>
<p>Zpracování serveru
^^^^^^^^^^^^^^^^^</p>
<p>Server vygeneruje nový <code>authCookie</code> a dočasný DH pár klíčů:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>authCookie = CSRNG(32)
</span></span><span style="display:flex;"><span>  esk = GENERATE_PRIVATE()
</span></span><span style="display:flex;"><span>  epk = DERIVE_PUBLIC(esk)
</span></span></code></pre></div><p>Poté server pro každého autorizovaného klienta zašifruje <code>authCookie</code> jeho veřejným klíčem:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>sharedSecret = DH(esk, cpk_i)
</span></span><span style="display:flex;"><span>  authInput = sharedSecret || cpk_i || subcredential || publishedTimestamp
</span></span><span style="display:flex;"><span>  okm = HKDF(epk, authInput, &#34;ELS2_XCA&#34;, 52)
</span></span><span style="display:flex;"><span>  clientKey_i = okm[0:31]
</span></span><span style="display:flex;"><span>  clientIV_i = okm[32:43]
</span></span><span style="display:flex;"><span>  clientID_i = okm[44:51]
</span></span><span style="display:flex;"><span>  clientCookie_i = ENCRYPT(clientKey_i, clientIV_i, authCookie)
</span></span></code></pre></div><p>Server umístí každou dvojici <code>[clientID_i, clientCookie_i]</code> do vrstvy 1 šifrovaného LS2, spolu s <code>epk</code>.</p>
<p>Zpracování klienta
^^^^^^^^^^^^^^^^^</p>
<p>Klient používá svůj privátní klíč k odvození svého očekávaného identifikátoru klienta <code>clientID_i</code>, šifrovacího klíče <code>clientKey_i</code> a šifrovacího IV <code>clientIV_i</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>sharedSecret = DH(csk_i, epk)
</span></span><span style="display:flex;"><span>  authInput = sharedSecret || cpk_i || subcredential || publishedTimestamp
</span></span><span style="display:flex;"><span>  okm = HKDF(epk, authInput, &#34;ELS2_XCA&#34;, 52)
</span></span><span style="display:flex;"><span>  clientKey_i = okm[0:31]
</span></span><span style="display:flex;"><span>  clientIV_i = okm[32:43]
</span></span><span style="display:flex;"><span>  clientID_i = okm[44:51]
</span></span></code></pre></div><p>Poté klient prohledává autorizační data vrstvy 1 pro záznam, který obsahuje <code>clientID_i</code>. Pokud odpovídající záznam existuje, klient ho dešifruje, aby získal <code>authCookie</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>authCookie = DECRYPT(clientKey_i, clientIV_i, clientCookie_i)
</span></span></code></pre></div><h4 id="pre-shared-key-client-authorization">Pre-shared key client authorization</h4>
<p>Každý klient vygeneruje tajný 32-bajtový klíč <code>psk_i</code> a odešle ho serveru. Alternativně může server vygenerovat tajný klíč a odeslat ho jednomu nebo více klientům.</p>
<p>Zpracování na serveru
^^^^^^^^^^^^^^^^^^^</p>
<p>Server vygeneruje nový <code>authCookie</code> a salt:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>authCookie = CSRNG(32)
</span></span><span style="display:flex;"><span>  authSalt = CSRNG(32)
</span></span></code></pre></div><p>Poté pro každého autorizovaného klienta server zašifruje <code>authCookie</code> jeho předsdíleným klíčem:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>authInput = psk_i || subcredential || publishedTimestamp
</span></span><span style="display:flex;"><span>  okm = HKDF(authSalt, authInput, &#34;ELS2PSKA&#34;, 52)
</span></span><span style="display:flex;"><span>  clientKey_i = okm[0:31]
</span></span><span style="display:flex;"><span>  clientIV_i = okm[32:43]
</span></span><span style="display:flex;"><span>  clientID_i = okm[44:51]
</span></span><span style="display:flex;"><span>  clientCookie_i = ENCRYPT(clientKey_i, clientIV_i, authCookie)
</span></span></code></pre></div><p>Server umístí každou dvojici <code>[clientID_i, clientCookie_i]</code> do vrstvy 1 šifrovaného LS2 spolu s <code>authSalt</code>.</p>
<p>Zpracování klienta
^^^^^^^^^^^^^^^^^</p>
<p>Klient používá svůj předem sdílený klíč k odvození svého očekávaného identifikátoru klienta <code>clientID_i</code>, šifrovacího klíče <code>clientKey_i</code> a šifrovacího IV <code>clientIV_i</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>authInput = psk_i || subcredential || publishedTimestamp
</span></span><span style="display:flex;"><span>  okm = HKDF(authSalt, authInput, &#34;ELS2PSKA&#34;, 52)
</span></span><span style="display:flex;"><span>  clientKey_i = okm[0:31]
</span></span><span style="display:flex;"><span>  clientIV_i = okm[32:43]
</span></span><span style="display:flex;"><span>  clientID_i = okm[44:51]
</span></span></code></pre></div><p>Poté klient prohledává autorizační data vrstvy 1 pro záznam, který obsahuje <code>clientID_i</code>. Pokud odpovídající záznam existuje, klient ho dešifruje a získá <code>authCookie</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>authCookie = DECRYPT(clientKey_i, clientIV_i, clientCookie_i)
</span></span></code></pre></div><h4 id="security-considerations">Security considerations</h4>
<p>Oba výše uvedené mechanismy autorizace klientů poskytují soukromí pro členství klientů. Entita, která zná pouze Destination, může vidět, kolik klientů je v danou chvíli přihlášeno, ale nemůže sledovat, kteří klienti jsou přidáváni nebo odvoláváni.</p>
<p>Servery BY MĚLY randomizovat pořadí klientů pokaždé, když generují šifrovaný LS2, aby zabránily klientům zjistit jejich pozici v seznamu a odvodit, kdy byli jiní klienti přidáni nebo odvoláni.</p>
<p>Server MŮŽE zvolit skrytí počtu klientů, kteří jsou přihlášeni k odběru, vložením náhodných záznamů do seznamu autorizačních dat.</p>
<p>Výhody DH autorizace klienta
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</p>
<ul>
<li>Bezpečnost schématu není závislá pouze na out-of-band výměně klíčového materiálu klienta. Soukromý klíč klienta nikdy nepotřebuje opustit jejich zařízení, takže protivník, který je schopen zachytit out-of-band výměnu, ale nemůže prolomit DH algoritmus, nemůže dešifrovat šifrovaný LS2 ani určit, jak dlouho je klientovi udělen přístup.</li>
</ul>
<p>Nevýhody DH klientské autorizace
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</p>
<ul>
<li>Vyžaduje N + 1 DH operací na straně serveru pro N klientů.</li>
<li>Vyžaduje jednu DH operaci na straně klienta.</li>
<li>Vyžaduje, aby klient vygeneroval tajný klíč.</li>
</ul>
<p>Výhody PSK autorizace klienta
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</p>
<ul>
<li>Nevyžaduje žádné DH operace.</li>
<li>Umožňuje serveru generovat tajný klíč.</li>
<li>Umožňuje serveru sdílet stejný klíč s více klienty, pokud je to požadováno.</li>
</ul>
<p>Nevýhody PSK autorizace klienta
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</p>
<ul>
<li>Bezpečnost schématu je kriticky závislá na out-of-band výměně klíčového materiálu klienta. Protivník, který zachytí výměnu pro konkrétního klienta, může dešifrovat jakýkoli následující zašifrovaný LS2, pro který je tento klient autorizován, a také určit, kdy je přístup klienta odvolán.</li>
</ul>
<h3 id="definice">Definice</h3>
<p>Viz návrh 149.</p>
<p>Nemůžete použít šifrovaný LS2 pro bittorrent kvůli kompaktním announce odpovědím, které mají 32 bajtů. Těchto 32 bajtů obsahuje pouze hash. Není tam místo pro označení, že leaseset je šifrovaný, nebo pro typy podpisů.</p>
<h3 id="formát-3">Formát</h3>
<p>Pro šifrované leaseSety s offline klíči musí být také offline generovány zaslepené soukromé klíče, jeden pro každý den.</p>
<p>Jelikož volitelný offline podpisový blok je v nešifrované části šifrovaného leaseSetu, kdokoli procházející floodfilly by mohl tuto informaci použít ke sledování leaseSetu (ale nemohl by ho dešifrovat) po dobu několika dnů. Aby se tomu zabránilo, vlastník klíčů by měl také generovat nové přechodné klíče pro každý den. Jak přechodné, tak oslепené klíče lze generovat dopředu a doručit do routeru dávkově.</p>
<p>V tomto návrhu není definován žádný formát souboru pro zabalení více přechodných a zaslepených klíčů a jejich poskytování klientovi nebo routeru. V tomto návrhu není definováno žádné rozšíření protokolu I2CP pro podporu šifrovaných leaseSetu s offline klíči.</p>
<h3 id="notes-1">Notes</h3>
<ul>
<li>
<p>Služba používající šifrované leaseSet by publikovala šifrovanou verzi do floodfill. Pro efektivitu by však odesílala nešifrované leaseSet klientům ve zabaleném garlic message, jakmile by byly ověřeny (například přes whitelist).</p>
</li>
<li>
<p>Floodfilly mohou omezit maximální velikost na rozumnou hodnotu, aby zabránily zneužití.</p>
</li>
<li>
<p>Po dešifrování by mělo být provedeno několik kontrol, včetně ověření, že
vnitřní časové razítko a doba vypršení odpovídají těm na nejvyšší úrovni.</p>
</li>
<li>
<p>ChaCha20 byl vybrán místo AES. Zatímco rychlosti jsou podobné pokud je k dispozici hardwarová podpora AES, ChaCha20 je 2,5-3x rychlejší když hardwarová podpora AES není dostupná, například na méně výkonných ARM zařízeních.</p>
</li>
<li>
<p>Nestaráme se dostatečně o rychlost, abychom používali keyed BLAKE2b. Má dostatečně velkou výstupní velikost pro největší n, které vyžadujeme (nebo jej můžeme zavolat jednou pro každý požadovaný klíč s argumentem čítače). BLAKE2b je mnohem rychlejší než SHA-256 a keyed-BLAKE2b by snížil celkový počet volání hash funkcí.
Nicméně viz návrh 148, kde se navrhuje, abychom přešli na BLAKE2b z jiných důvodů.
Viz <a href="https://www.lvh.io/posts/secure-key-derivation-performance.html">Secure key derivation performance</a>
.</p>
</li>
</ul>
<h3 id="meta-ls2">Meta LS2</h3>
<p>Toto se používá k nahrazení multihomingu. Stejně jako jakýkoli leaseset, je podepsáno tvůrcem. Jedná se o ověřený seznam hashů destinací.</p>
<p>Meta LS2 je vrchol a případně i mezilehlé uzly stromové struktury. Obsahuje řadu záznamů, z nichž každý odkazuje na LS, LS2 nebo jiný Meta LS2 pro podporu masivního multihomingu. Meta LS2 může obsahovat mix záznamů LS, LS2 a Meta LS2. Listy stromu jsou vždy LS nebo LS2. Strom je DAG; smyčky jsou zakázány; klienti provádějící vyhledávání musí detekovat a odmítnout následování smyček.</p>
<p>Meta LS2 může mít mnohem delší dobu vypršení než standardní LS nebo LS2. Nejvyšší úroveň může mít vypršení několik hodin po datu publikace. Maximální doba vypršení bude vynucována floodfilly a klienty a je TBD.</p>
<p>Případem použití pro Meta LS2 je masivní multihoming, ale bez větší ochrany proti korelaci routerů s leaseSety (v době restartu routeru), než jaká je poskytována nyní s LS nebo LS2. To je ekvivalentní případu použití &ldquo;facebook&rdquo;, který pravděpodobně nepotřebuje ochranu proti korelaci. Tento případ použití pravděpodobně potřebuje offline klíče, které jsou poskytovány ve standardní hlavičce v každém uzlu stromu.</p>
<p>Back-end protokol pro koordinaci mezi leaf routery, zprostředkujícími a hlavními podepisovateli Meta LS zde není specifikován. Požadavky jsou velmi jednoduché - pouze ověřit, že peer je aktivní, a publikovat nový LS každých několik hodin. Jediná složitost spočívá ve výběru nových vydavatelů pro Meta LS na nejvyšší úrovni nebo zprostředkující úrovni při selhání.</p>
<p>Mix-and-match leasesets, kde jsou leasy z více routerů kombinovány, podepsány a publikovány v jednom leasesetu, jsou dokumentovány v návrhu 140, &ldquo;invisible multihoming&rdquo;. Tento návrh je v současné podobě neudržitelný, protože streaming spojení by nebyla &ldquo;lepkavá&rdquo; k jednomu routeru, viz <a href="http://zzz.i">http://zzz.i</a>
2p/topics/2335 .</p>
<p>Back-end protokol a interakce s interními součástmi routeru a klienta by byly pro neviditelný multihoming poměrně složité.</p>
<p>Aby se zabránilo přetížení floodfill pro Meta LS nejvyšší úrovně, měla by být doba vypršení alespoň několik hodin. Klienti musí ukládat Meta LS nejvyšší úrovně do cache a zachovat jej při restartech, pokud nevypršel.</p>
<p>Potřebujeme definovat nějaký algoritmus pro klienty k procházení stromu, včetně záložních řešení, aby bylo použití rozptýlené. Nějakou funkci vzdálenosti hash, nákladů a náhodnosti. Pokud má uzel jak LS nebo LS2, tak i Meta LS, musíme vědět, kdy je dovoleno tyto leaseSety použít a kdy pokračovat v procházení stromu.</p>
<p>Vyhledání pomocí</p>
<pre><code>Standard LS flag (1)
</code></pre>
<p>Uložit pomocí</p>
<pre><code>Meta LS2 type (7)
</code></pre>
<p>Uložit v</p>
<pre><code>Hash of destination
This hash is then used to generate the daily &quot;routing key&quot;, as in LS1
</code></pre>
<p>Typické vypršení</p>
<pre><code>Hours. Max 18.2 hours (65535 seconds)
</code></pre>
<p>Publikováno</p>
<pre><code>&quot;master&quot; Destination or coordinator, or intermediate coordinators
</code></pre>
<h3 id="format">Format</h3>
<pre tabindex="0"><code>Standard LS2 Header as specified above

  Meta LS2 Type-Specific Part
  - Properties (Mapping as specified in common structures spec, 2 zero bytes if none)
  - Number of entries (1 byte) Maximum TBD
  - Entries. Each entry contains: (40 bytes)
    - Hash (32 bytes)
    - Flags (2 bytes)
      TBD. Set all to zero for compatibility with future uses.
    - Type (1 byte) The type of LS it is referencing;
      1 for LS, 3 for LS2, 5 for encrypted, 7 for meta, 0 for unknown.
    - Cost (priority) (1 byte)
    - Expires (4 bytes) (4 bytes, big endian, seconds since epoch, rolls over in 2106)
  - Number of revocations (1 byte) Maximum TBD
  - Revocations: Each revocation contains: (32 bytes)
    - Hash (32 bytes)

  Standard LS2 Signature:
  - Signature (40+ bytes)
    The signature is of everything above.
</code></pre><p>Flags a vlastnosti: pro budoucí použití</p>
<h3 id="odvození-zaslepovacího-klíče">Odvození zaslepovacího klíče</h3>
<ul>
<li>
<p>Distribuovaná služba používající toto by měla jednoho nebo více &ldquo;masterů&rdquo; s privátním klíčem cílové destinace služby. Ti by (mimo pásmo) určovali aktuální seznam aktivních destinací a publikovali by Meta LS2. Pro redundanci by mohlo více masterů současně hostovat (tj. souběžně publikovat) Meta LS2.</p>
</li>
<li>
<p>Distribuovaná služba by mohla začít s jedinou destinací nebo použít multihoming starého stylu, poté přejít na Meta LS2. Standardní LS lookup by mohl vrátit kterýkoliv z LS, LS2, nebo Meta LS2.</p>
</li>
<li>
<p>Když služba používá Meta LS2, nemá žádné tunely (leases).</p>
</li>
</ul>
<h3 id="service-record">Service Record</h3>
<p>Toto je individuální záznam, který říká, že destinace se účastní služby. Je odeslán od účastníka k floodfill. Nikdy není posílán jednotlivě floodfill routerem, ale pouze jako součást Service List. Service Record se také používá ke zrušení účasti ve službě nastavením vypršení na nulu.</p>
<p>Toto není LS2, ale používá standardní formát hlavičky a podpisu LS2.</p>
<p>Vyhledat pomocí</p>
<pre><code>n/a, see Service List
</code></pre>
<p>Uložit s</p>
<pre><code>Service Record type (9)
</code></pre>
<p>Uložit v</p>
<pre><code>Hash of service name
This hash is then used to generate the daily &quot;routing key&quot;, as in LS1
</code></pre>
<p>Typické vypršení</p>
<pre><code>Hours. Max 18.2 hours (65535 seconds)
</code></pre>
<p>Publikoval</p>
<pre><code>Destination
</code></pre>
<h3 id="format-1">Format</h3>
<pre tabindex="0"><code>Standard LS2 Header as specified above

  Service Record Type-Specific Part
  - Port (2 bytes, big endian) (0 if unspecified)
  - Hash of service name (32 bytes)

  Standard LS2 Signature:
  - Signature (40+ bytes)
    The signature is of everything above.
</code></pre><h3 id="notes-2">Notes</h3>
<ul>
<li>
<p>Pokud je expires samé nuly, floodfill by měl záznam odvolat a již jej nezahrnovat do seznamu služeb.</p>
</li>
<li>
<p>Úložiště: Floodfill může přísně omezovat ukládání těchto záznamů a
limitovat počet záznamů uložených na hash a jejich expiraci. Může být také
použit whitelist hashů.</p>
</li>
<li>
<p>Jakýkoli jiný typ netdb se stejným hashem má prioritu, takže service record nikdy nemůže přepsat LS/RI, ale LS/RI přepíše všechny service records na tomto hashi.</p>
</li>
</ul>
<h3 id="service-list">Service List</h3>
<p>Toto není nic jako LS2 a používá jiný formát.</p>
<p>Seznam služeb je vytvořen a podepsán floodfill routerem. Je neautentizovaný v tom smyslu, že kdokoli se může připojit ke službě publikováním Service Record do floodfill routeru.</p>
<p>Seznam služeb obsahuje krátké záznamy služeb, nikoli úplné záznamy služeb. Tyto obsahují podpisy, ale pouze hashe, nikoli úplné destinace, takže nemohou být ověřeny bez úplné destinace.</p>
<p>Bezpečnost, pokud vůbec nějaká existuje, a žádoucnost seznamů služeb je TBD. Floodfilly by mohly omezit publikování a vyhledávání na whitelist služeb, ale tento whitelist se může lišit na základě implementace nebo preference operátora. Nemusí být možné dosáhnout konsenzu na společném, základním whitelistu napříč implementacemi.</p>
<p>Pokud je název služby zahrnut ve výše uvedeném záznamu služby, pak mohou operátoři floodfill namítat; pokud je zahrnut pouze hash, neexistuje žádné ověření a záznam služby by se mohl &ldquo;dostat dovnitř&rdquo; před jakýmkoli jiným typem netDb a být uložen ve floodfill.</p>
<p>Vyhledat pomocí</p>
<pre><code>Service List lookup type (11)
</code></pre>
<p>Ukládat s</p>
<pre><code>Service List type (11)
</code></pre>
<p>Uložit v</p>
<pre><code>Hash of service name
This hash is then used to generate the daily &quot;routing key&quot;, as in LS1
</code></pre>
<p>Typické vypršení</p>
<pre><code>Hours, not specified in the list itself, up to local policy
</code></pre>
<p>Publikoval</p>
<pre><code>Nobody, never sent to floodfill, never flooded.
</code></pre>
<h3 id="format-2">Format</h3>
<p>Nepoužívá standardní LS2 hlavičku specifikovanou výše.</p>
<pre tabindex="0"><code>- Type (1 byte)
    Not actually in header, but part of data covered by signature.
    Take from field in Database Store Message.
  - Hash of the service name (implicit, in the Database Store message)
  - Hash of the Creator (floodfill) (32 bytes)
  - Published timestamp (8 bytes, big endian)

  - Number of Short Service Records (1 byte)
  - List of Short Service Records:
    Each Short Service Record contains (90+ bytes)
    - Dest hash (32 bytes)
    - Published timestamp (8 bytes, big endian)
    - Expires (4 bytes, big endian) (offset from published in ms)
    - Flags (2 bytes)
    - Port (2 bytes, big endian)
    - Sig length (2 bytes, big endian)
    - Signature of dest (40+ bytes)

  - Number of Revocation Records (1 byte)
  - List of Revocation Records:
    Each Revocation Record contains (86+ bytes)
    - Dest hash (32 bytes)
    - Published timestamp (8 bytes, big endian)
    - Flags (2 bytes)
    - Port (2 bytes, big endian)
    - Sig length (2 bytes, big endian)
    - Signature of dest (40+ bytes)

  - Signature of floodfill (40+ bytes)
    The signature is of everything above.
</code></pre><p>Pro ověření podpisu seznamu služeb:</p>
<ul>
<li>připojit hash názvu služby na začátek</li>
<li>odstranit hash tvůrce</li>
<li>zkontrolovat podpis upravených obsahů</li>
</ul>
<p>Pro ověření podpisu každého Short Service Record:</p>
<ul>
<li>Načíst cíl</li>
<li>Zkontrolovat podpis (publikované časové razítko + vypršení + příznaky + port + Hash názvu služby)</li>
</ul>
<p>Pro ověření podpisu každého Revocation Record:</p>
<ul>
<li>Načíst cíl</li>
<li>Zkontrolovat podpis (publikované časové razítko + 4 nulové bajty + příznaky + port + Hash
názvu služby)</li>
</ul>
<h3 id="notes-3">Notes</h3>
<ul>
<li>
<p>Používáme délku podpisu místo typu podpisu, abychom mohli podporovat neznámé typy podpisů.</p>
</li>
<li>
<p>Neexistuje vypršení platnosti seznamu služeb, příjemci si mohou učinit vlastní rozhodnutí na základě zásad nebo vypršení platnosti jednotlivých záznamů.</p>
</li>
<li>
<p>Seznamy služeb nejsou zaplavovány, pouze jednotlivé záznamy služeb. Každý floodfill vytváří, podepisuje a ukládá do cache Seznam služeb. Floodfill používá svou vlastní politiku pro dobu cache a maximální počet záznamů služeb a revokací.</p>
</li>
</ul>
<h2 id="common-structures-spec-changes-required">Common Structures Spec Changes Required</h2>
<h3 id="šifrování-a-zpracování">Šifrování a zpracování</h3>
<p>Mimo rozsah tohoto návrhu. Přidat do ECIES návrhů 144 a 145.</p>
<h3 id="new-intermediate-structures">New Intermediate Structures</h3>
<p>Přidejte nové struktury pro Lease2, MetaLease, LeaseSet2Header a OfflineSignature. Platné od vydání 0.9.38.</p>
<h3 id="new-netdb-types">New NetDB Types</h3>
<p>Přidejte struktury pro každý nový typ leaseSet, začleněné z výše uvedeného. Pro LeaseSet2, EncryptedLeaseSet a MetaLeaseSet platné od vydání 0.9.38. Pro Service Record a Service List předběžné a neplánované.</p>
<h3 id="new-signature-type">New Signature Type</h3>
<p>Přidat RedDSA_SHA512_Ed25519 Type 11. Veřejný klíč má 32 bajtů; soukromý klíč má 32 bajtů; hash má 64 bajtů; podpis má 64 bajtů.</p>
<h2 id="encryption-spec-changes-required">Encryption Spec Changes Required</h2>
<p>Mimo rozsah tohoto návrhu. Viz návrhy 144 a 145.</p>
<h2 id="i2np-changes-required">I2NP Changes Required</h2>
<p>Přidat poznámku: LS2 lze publikovat pouze do floodfills s minimální verzí.</p>
<h3 id="database-lookup-message">Database Lookup Message</h3>
<p>Přidat typ vyhledávání seznamu služeb.</p>
<h3 id="changes">Changes</h3>
<pre tabindex="0"><code>Flags byte: Lookup type field, currently bits 3-2, expands to bits 4-2.
  Lookup type 0x04 is defined as the service list lookup.

  Add note: Service list loookup may only be sent to floodfills with a minimum version.
  Minimum version is 0.9.38.
</code></pre><h3 id="autorizace-podle-klienta">Autorizace podle klienta</h3>
<p>Přidejte všechny nové typy úložišť.</p>
<h3 id="changes-1">Changes</h3>
<pre tabindex="0"><code>Type byte: Type field, currently bit 0, expands to bits 3-0.
  Type 3 is defined as a LS2 store.
  Type 5 is defined as a encrypted LS2 store.
  Type 7 is defined as a meta LS2 store.
  Type 9 is defined as a service record store.
  Type 11 is defined as a service list store.
  Other types are undefined and invalid.

  Add note: All new types may only be published to floodfills with a minimum version.
  Minimum version is 0.9.38.
</code></pre><h2 id="i2cp-changes-required">I2CP Changes Required</h2>
<h3 id="i2cp-options">I2CP Options</h3>
<p>Nové možnosti interpretované na straně routeru, odeslané v mapování SessionConfig:</p>
<pre tabindex="0"><code>
  i2cp.leaseSetType=nnn       The type of leaseset to be sent in the Create Leaseset Message
                              Value is the same as the netdb store type in the table above.
                              Interpreted client-side, but also passed to the router in the
                              SessionConfig, to declare intent and check support.

  i2cp.leaseSetEncType=nnn[,nnn]  The encryption types to be used.
                                  Interpreted client-side, but also passed to the router in
                                  the SessionConfig, to declare intent and check support.
                                  See proposals 144 and 145.

  i2cp.leaseSetOfflineExpiration=nnn  The expiration of the offline signature, ASCII,
                                      seconds since the epoch.

  i2cp.leaseSetTransientPublicKey=[type:]b64  The base 64 of the transient private key,
                                              prefixed by an optional sig type number
                                              or name, default DSA_SHA1.
                                              Length as inferred from the sig type

  i2cp.leaseSetOfflineSignature=b64   The base 64 of the offline signature.
                                      Length as inferred from the destination
                                      signing public key type

  i2cp.leaseSetSecret=b64     The base 64 of a secret used to blind the
                              address of the leaseset, default &#34;&#34;

  i2cp.leaseSetAuthType=nnn   The type of authentication for encrypted LS2.
                              0 for no per-client authentication (the default)
                              1 for DH per-client authentication
                              2 for PSK per-client authentication

  i2cp.leaseSetPrivKey=b64    A base 64 private key for the router to use to
                              decrypt the encrypted LS2,
                              only if per-client authentication is enabled
</code></pre><p>Nové možnosti interpretované na straně klienta:</p>
<pre tabindex="0"><code>
  i2cp.leaseSetType=nnn     The type of leaseset to be sent in the Create Leaseset Message
                            Value is the same as the netdb store type in the table above.
                            Interpreted client-side, but also passed to the router in the
                            SessionConfig, to declare intent and check support.

  i2cp.leaseSetEncType=nnn[,nnn]  The encryption types to be used.
                                  Interpreted client-side, but also passed to the router in
                                  the SessionConfig, to declare intent and check support.
                                  See proposals 144 and 145.

  i2cp.leaseSetSecret=b64     The base 64 of a secret used to blind the
                              address of the leaseset, default &#34;&#34;

  i2cp.leaseSetAuthType=nnn       The type of authentication for encrypted LS2.
                                  0 for no per-client authentication (the default)
                                  1 for DH per-client authentication
                                  2 for PSK per-client authentication

  i2cp.leaseSetBlindedType=nnn   The sig type of the blinded key for encrypted LS2.
                                 Default depends on the destination sig type.

  i2cp.leaseSetClient.dh.nnn=b64name:b64pubkey   The base 64 of the client name (ignored, UI use only),
                                                 followed by a &#39;:&#39;, followed by the base 64 of the public
                                                 key to use for DH per-client auth. nnn starts with 0

  i2cp.leaseSetClient.psk.nnn=b64name:b64privkey   The base 64 of the client name (ignored, UI use only),
                                                   followed by a &#39;:&#39;, followed by the base 64 of the private
                                                   key to use for PSK per-client auth. nnn starts with 0
</code></pre><h3 id="session-config">Session Config</h3>
<p>Poznamenejte, že pro offline podpisy jsou vyžadovány volby i2cp.leaseSetOfflineExpiration, i2cp.leaseSetTransientPublicKey a i2cp.leaseSetOfflineSignature a podpis je proveden pomocí dočasného soukromého klíče pro podepisování.</p>
<h3 id="šifrované-ls-s-base-32-adresami">Šifrované LS s Base 32 adresami</h3>
<p>Router ke klientovi. Žádné změny. Leasy jsou odesílány s 8-bytovými časovými razítky, i když vrácený leaseSet bude LS2 se 4-bytovými časovými razítky. Poznamenejte, že odpověď může být zpráva Create Leaseset nebo Create Leaseset2 Message.</p>
<h3 id="šifrované-ls-s-offline-klíči">Šifrované LS s offline klíči</h3>
<p>Router ke klientovi. Žádné změny. Leases jsou odesílány s 8-bytovými časovými razítky, i když vrácený leaseSet bude LS2 se 4-bytovými časovými razítky. Vezměte na vědomí, že odpověď může být zpráva Create Leaseset nebo Create Leaseset2 Message.</p>
<h3 id="poznámky-3">Poznámky</h3>
<p>Klient na router. Nová zpráva, která se používá místo zprávy Create Leaseset Message.</p>
<h3 id="meta-ls2-1">Meta LS2</h3>
<ul>
<li>
<p>Aby router mohl analyzovat typ úložiště, typ musí být ve zprávě,
pokud není předán routeru předem v konfiguraci relace.
Pro společný kód pro analýzu je jednodušší mít jej přímo ve zprávě.</p>
</li>
<li>
<p>Pro to, aby router znal typ a délku privátního klíče,
musí být za lease setem, pokud parser nezná typ předem
v konfiguraci relace.
Pro společný parsing kód je jednodušší to poznat ze samotné zprávy.</p>
</li>
<li>
<p>Soukromý klíč pro podepisování, dříve definovaný pro zrušení a nepoužívaný,
není přítomen v LS2.</p>
</li>
</ul>
<h3 id="formát-4">Formát</h3>
<p>Typ zprávy pro Create Leaseset2 Message je 41.</p>
<h3 id="poznámky-4">Poznámky</h3>
<pre tabindex="0"><code>Session ID
  Type byte: Type of lease set to follow
             Type 1 is a LS
             Type 3 is a LS2
             Type 5 is a encrypted LS2
             Type 7 is a meta LS2
  LeaseSet: type specified above
  Number of private keys to follow (1 byte)
  Encryption Private Keys: For each public key in the lease set,
                           in the same order
                           (Not present for Meta LS2)
                           - Encryption type (2 bytes, big endian)
                           - Encryption key length (2 bytes, big endian)
                           - Encryption key (number of bytes specified)
</code></pre><h3 id="záznam-služby">Záznam služby</h3>
<ul>
<li>Minimální verze routeru je 0.9.39.</li>
<li>Předběžná verze s typem zprávy 40 byla v 0.9.38, ale formát byl změněn.
Typ 40 je opuštěn a není podporován.</li>
</ul>
<h3 id="formát-5">Formát</h3>
<ul>
<li>Jsou potřebné další změny pro podporu šifrovaných a meta leaseSet.</li>
</ul>
<h3 id="poznámky-5">Poznámky</h3>
<p>Klient ke směrovači. Nová zpráva.</p>
<h3 id="seznam-služeb">Seznam služeb</h3>
<ul>
<li>
<p>Router potřebuje vědět, zda je cíl blinded.
Pokud je blinded a používá tajnou nebo per-client autentifikaci,
potřebuje mít také tyto informace.</p>
</li>
<li>
<p>Vyhledání hostitele (Host Lookup) nového formátu b32 adresy (&ldquo;b33&rdquo;)
říká routeru, že adresa je zaslepená, ale neexistuje mechanismus pro
předání tajného nebo soukromého klíče routeru ve zprávě Host Lookup.
Ačkoli bychom mohli rozšířit zprávu Host Lookup o tyto informace,
je čistší definovat novou zprávu.</p>
</li>
<li>
<p>Potřebujeme programový způsob, jak může klient informovat router.
Jinak by uživatel musel ručně konfigurovat každou destinaci.</p>
</li>
</ul>
<h3 id="formát-6">Formát</h3>
<p>Před tím, než klient odešle zprávu na oslepené cílové místo, musí buď vyhledat &ldquo;b33&rdquo; ve zprávě Host Lookup, nebo odeslat zprávu Blinding Info. Pokud oslepené cílové místo vyžaduje tajemství nebo autentifikaci podle klienta, musí klient odeslat zprávu Blinding Info.</p>
<p>Router neodešle odpověď na tuto zprávu.</p>
<h3 id="poznámky-6">Poznámky</h3>
<p>Typ zprávy pro Blinding Info Message je 42.</p>
<h3 id="format-3">Format</h3>
<pre tabindex="0"><code>Session ID
  Flags:       1 byte
               Bit order: 76543210
               Bit 0: 0 for everybody, 1 for per-client
               Bits 3-1: Authentication scheme, if bit 0 is set to 1 for per-client, otherwise 000
                         000: DH client authentication (or no per-client authentication)
                         001: PSK client authentication
               Bit 4: 1 if secret required, 0 if no secret required
               Bits 7-5: Unused, set to 0 for future compatibility
  Type byte:   Endpoint type to follow
               Type 0 is a Hash
               Type 1 is a host name String
               Type 2 is a Destination
               Type 3 is a Sig Type and Signing Public Key
  Blind Type:  2 byte blinded sig type (big endian)
  Expiration:  4 bytes, big endian, seconds since epoch
  Endpoint:    Data as specified above
               For type 0: 32 byte binary hash
               For type 1: host name String
               For type 2: binary Destination
               For type 3: 2 byte sig type (big endian)
                           Signing Public Key (length as implied by sig type)
  Private Key: Only if flag bit 0 is set to 1
               A 32-byte ECIES_X25519 private key
  Secret:      Only if flag bit 4 is set to 1
               A secret String
</code></pre><h3 id="certifikáty-klíčů">Certifikáty klíčů</h3>
<ul>
<li>Minimální verze routeru je 0.9.43</li>
</ul>
<h3 id="nové-mezilehlé-struktury">Nové mezilehlé struktury</h3>
<h3 id="nové-typy-netdb">Nové typy NetDB</h3>
<p>Pro podporu vyhledávání „b33&quot; názvů hostitelů a vrácení indikace, pokud router nemá požadované informace, definujeme dodatečné kódy výsledků pro Host Reply Message, následovně:</p>
<pre tabindex="0"><code>2: Lookup password required
   3: Private key required
   4: Lookup password and private key required
   5: Leaseset decryption failure
</code></pre><p>Hodnoty 1-255 jsou již definovány jako chyby, takže nedochází k problému se zpětnou kompatibilitou.</p>
<h3 id="nový-typ-podpisu">Nový typ podpisu</h3>
<p>Router ke klientovi. Nová zpráva.</p>
<h3 id="justification-1">Justification</h3>
<p>Klient předem neví, že daný Hash se vyřeší na Meta LS.</p>
<p>Pokud vyhledání leaseset pro Destination vrátí Meta LS, router provede rekurzivní rozlišení. Pro datagramy nemusí klientská strana vědět; pro streaming však, kde protokol kontroluje cíl v SYN ACK, musí vědět, jaký je „skutečný&quot; cíl. Proto potřebujeme novou zprávu.</p>
<h3 id="usage">Usage</h3>
<p>Router udržuje cache pro skutečnou destinaci, která je použita z meta LS. Když klient pošle zprávu na destinaci, která se překládá na meta LS, router zkontroluje cache pro skutečnou destinaci naposledy použitou. Pokud je cache prázdná, router vybere destinaci z meta LS a vyhledá leaseSet. Pokud je vyhledání leaseSet úspěšné, router přidá tuto destinaci do cache a pošle klientovi Meta Redirect Message. Toto se provádí pouze jednou, pokud destinace nevyprší a nemusí být změněna. Klient musí také v případě potřeby informace cachovat. Meta Redirect Message NENÍ posílána jako odpověď na každou SendMessage.</p>
<p>Router odesílá tuto zprávu pouze klientům s verzí 0.9.47 nebo vyšší.</p>
<p>Klient neposílá odpověď na tuto zprávu.</p>
<h3 id="zpráva-vyhledávání-v-databázi">Zpráva vyhledávání v databázi</h3>
<p>Typ zprávy pro Meta Redirect Message je 43.</p>
<h3 id="změny">Změny</h3>
<pre tabindex="0"><code>Session ID (2 bytes) The value from the Send Message.
  Message ID generated by the router (4 bytes)
  4 byte nonce previously generated by the client
               (the value from the Send Message, may be zero)
  Flags:       2 bytes, bit order 15...0
               Unused, set to 0 for future compatibility
               Bit 0: 0 - the destination is no longer meta
                      1 - the destination is now meta
               Bits 15-1: Unused, set to 0 for future compatibility
  Original Destination (387+ bytes)
  (following fields only present if flags bit 0 is 1)
  MFlags:      2 bytes
               Unused, set to 0 for future compatibility
               From the Meta Lease for the actual Destination
  Expiration:  4 bytes, big endian, seconds since epoch
               From the Meta Lease for the actual Destination
  Cost (priority) 1 byte
               From the Meta Lease for the actual Destination
  Actual (real) Destination (387+ bytes)
</code></pre><h3 id="zpráva-uložení-databáze">Zpráva uložení databáze</h3>
<p>Jak generovat a podporovat Meta, včetně komunikace a koordinace mezi routery, je mimo rozsah tohoto návrhu. Viz související návrh 150.</p>
<h3 id="změny-1">Změny</h3>
<p>Offline podpisy nelze ověřit ve streaming nebo odpověditelných datagramech. Viz sekce níže.</p>
<h2 id="private-key-file-changes-required">Private Key File Changes Required</h2>
<p>Formát souboru s privátním klíčem (eepPriv.dat) není oficiální součástí našich specifikací, ale je zdokumentován v <a href="http://idk.i2p/javadoc-i2p/net/i2p/data/PrivateKeyFile.html">Java I2P javadocs</a>
 a jiné implementace jej podporují. To umožňuje přenositelnost privátních klíčů mezi různými implementacemi.</p>
<p>Změny jsou nezbytné pro uložení dočasného veřejného klíče a informací o offline podepisování.</p>
<h3 id="changes-2">Changes</h3>
<pre tabindex="0"><code>If the signing private key is all zeros, the offline information section follows:

  - Expires timestamp
    (4 bytes, big endian, seconds since epoch, rolls over in 2106)
  - Sig type of transient Signing Public Key (2 bytes, big endian)
  - Transient Signing Public key
    (length as specified by transient sig type)
  - Signature of above three fields by offline key
    (length as specified by destination sig type)
  - Transient Signing Private key
    (length as specified by transient sig type)
</code></pre><h3 id="možnosti-i2cp">Možnosti I2CP</h3>
<p>Přidejte podporu pro následující možnosti:</p>
<pre tabindex="0"><code>-d days              (specify expiration in days of offline sig, default 365)
      -o offlinedestfile   (generate the online key file,
                            using the offline key file specified)
      -r sigtype           (specify sig type of transient key, default Ed25519)
</code></pre><h2 id="streaming-changes-required">Streaming Changes Required</h2>
<p>Offline podpisy momentálně nelze ověřit ve streaming. Níže uvedená změna přidává blok offline podepisování do možností. Tím se zabrání nutnosti získávat tyto informace přes I2CP.</p>
<h3 id="konfigurace-relace">Konfigurace relace</h3>
<pre tabindex="0"><code>Add new option:
  Bit:          11
  Flag:         OFFLINE_SIGNATURE
  Option order: 4
  Option data:  Variable bytes
  Function:     Contains the offline signature section from LS2.
                FROM_INCLUDED must also be set.
                Expires timestamp
                (4 bytes, big endian, seconds since epoch, rolls over in 2106)
                Transient sig type (2 bytes, big endian)
                Transient signing public key (length as implied by sig type)
                Signature of expires timestamp, transient sig type,
                and public key, by the destination public key,
                length as implied by destination public key sig type.

  Change option:
  Bit:          3
  Flag:         SIGNATURE_INCLUDED
  Option order: Change from 4 to 5

  Add information about transient keys to the
  Variable Length Signature Notes section:
  The offline signature option does not needed to be added for a CLOSE packet if
  a SYN packet containing the option was previously acked.
  More info TODO
</code></pre><h3 id="zpráva-request-leaseset">Zpráva Request Leaseset</h3>
<ul>
<li>Alternativou je pouze přidat příznak a získat přechodný veřejný klíč přes I2CP
(Viz sekce Host Lookup / Host Reply Message výše)</li>
</ul>
<h2 id="standardní-ls2-hlavička">Standardní LS2 hlavička</h2>
<p>Offline podpisy nelze ověřit při zpracování odpověditelných datagramů. Je potřeba příznak pro označení offline podepsaného, ale není místo, kam příznak umístit. Bude vyžadovat úplně nové číslo protokolu a formát.</p>
<h3 id="zpráva-požadavku-na-proměnný-leaseset">Zpráva požadavku na proměnný leaseSet</h3>
<pre tabindex="0"><code>Define new protocol 19 - Repliable datagram with options?
  - Destination (387+ bytes)
  - Flags (2 bytes)
    Bit order: 15 14 ... 3 2 1 0
    Bit 0: If 0, no offline keys; if 1, offline keys
    Bits 1-15: set to 0 for compatibility with future uses
  - If flag indicates offline keys, the offline signature section:
    Expires timestamp
    (4 bytes, big endian, seconds since epoch, rolls over in 2106)
    Transient sig type (2 bytes, big endian)
    Transient signing public key (length as implied by sig type)
    Signature of expires timestamp, transient sig type,
    and public key, by the destination public key,
    length as implied by destination public key sig type.
    This section can, and should, be generated offline.
  - Data
</code></pre><h3 id="vytvořit-zprávu-leaseset2">Vytvořit zprávu Leaseset2</h3>
<ul>
<li>Alternativou je pouze přidat příznak a získat přechodný veřejný klíč přes I2CP
(Viz sekce Host Lookup / Host Reply Message výše)</li>
<li>Měli bychom nyní přidat nějaké další možnosti, když máme flag byty?</li>
</ul>
<h2 id="sam-v3-changes-required">SAM V3 Changes Required</h2>
<p>SAM musí být rozšířen o podporu offline podpisů v DESTINATION base 64.</p>
<h3 id="odůvodnění-1">Odůvodnění</h3>
<pre tabindex="0"><code>Note that in the SESSION CREATE DESTINATION=$privkey,
  the $privkey raw data (before base64 conversion)
  may be optionally followed by the Offline Signature as specified in the
  Common Structures Specification.

  If the signing private key is all zeros, the offline information section follows:

  - Expires timestamp
    (4 bytes, big endian, seconds since epoch, rolls over in 2106)
  - Sig type of transient Signing Public Key (2 bytes, big endian)
  - Transient Signing Public key
    (length as specified by transient sig type)
  - Signature of above three fields by offline key
    (length as specified by destination sig type)
  - Transient Signing Private key (length as specified by transient sig type)
</code></pre><p>Poznámka: offline podpisy jsou podporovány pouze pro STREAM a RAW, nikoli pro DATAGRAM (dokud nedefinujeme nový DATAGRAM protokol).</p>
<p>Všimněte si, že SESSION STATUS vrátí Signing Private Key obsahující samé nuly a data Offline Signature přesně tak, jak byla zadána v SESSION CREATE.</p>
<p>Poznámka: DEST GENERATE a SESSION CREATE DESTINATION=TRANSIENT nelze použít k vytvoření offline podepsané destinace.</p>
<h3 id="typ-zprávy">Typ zprávy</h3>
<p>Zvýšit verzi na 3.4, nebo ji nechat na 3.1/3.2/3.3, aby mohla být přidána bez nutnosti všech těch věcí z 3.2/3.3?</p>
<p>Další změny budou upřesněny. Viz sekce I2CP Host Reply Message výše.</p>
<h2 id="bob-changes-required">BOB Changes Required</h2>
<p>BOB by musel být rozšířen o podporu offline podpisů a/nebo Meta LS. Toto má nízkou prioritu a pravděpodobně nikdy nebude specifikováno nebo implementováno. SAM V3 je preferované rozhraní.</p>
<h2 id="publishing-migration-compatibility">Publishing, Migration, Compatibility</h2>
<p>LS2 (kromě šifrovaných LS2) je publikován na stejném DHT místě jako LS1. Neexistuje způsob, jak publikovat současně LS1 i LS2, pokud by LS2 nebylo na jiném místě.</p>
<p>Šifrovaný LS2 je publikován na hash blinded key typu a klíčových dat. Tento hash je pak použit k vygenerování denního &ldquo;routing key&rdquo;, stejně jako u LS1.</p>
<p>LS2 by se používalo pouze když jsou požadovány nové funkce (nové krypto, šifrované LS, meta, atd.). LS2 lze publikovat pouze na floodfill uzly určené verze nebo vyšší.</p>
<p>Servery publikující LS2 by věděly, že všichni připojující se klienti podporují LS2. Mohly by poslat LS2 v garlic encryption.</p>
<p>Klienti by posílali LS2 v garlics pouze při použití nové kryptografie. Sdílení klienti by používali LS1 neomezeně? TODO: Jak mít sdílené klienty, které podporují starou i novou kryptografii?</p>
<h2 id="rollout">Rollout</h2>
<p>0.9.38 obsahuje floodfill podporu pro standardní LS2, včetně offline klíčů.</p>
<p>0.9.39 obsahuje I2CP podporu pro LS2 a Encrypted LS2, podepisování/ověřování sig typu 11, floodfill podporu pro Encrypted LS2 (sig typy 7 a 11, bez offline klíčů) a šifrování/dešifrování LS2 (bez autorizace podle klienta).</p>
<p>0.9.40 má podle plánu obsahovat podporu pro šifrování/dešifrování LS2 s autorizací podle klienta, floodfill a I2CP podporu pro Meta LS2, podporu pro šifrované LS2 s offline klíči a b32 podporu pro šifrované LS2.</p>
<h2 id="nové-typy-databaseentry">Nové typy DatabaseEntry</h2>
<p>Návrh šifrovaného LS2 je silně ovlivněn <a href="https://spec.torproject.org/rend-spec-v3">deskriptory skrytých služeb v3 sítě Tor</a>
, které měly podobné návrhové cíle.</p>

                </article>

                
                <nav class="page-nav">
                    <a href="../../../cs/proposals/" class="page-nav-link">
                        ← Back to Proposals
                    </a>
                    
                    
                    
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                            
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                    <a href="../../../proposals/123-new-netdb-entries.txt" class="page-nav-link" download>
                        Download Source (.txt)
                    </a>
                    
                </nav>
            </div>
        </div>
    </div>
</div>

<style>
.proposals-page {
    min-height: 100vh;
    padding: var(--spacing-xl) 0;
}

.breadcrumbs {
    display: flex;
    align-items: center;
    gap: var(--spacing-xs);
    margin-bottom: var(--spacing-lg);
    font-size: 0.875rem;
    color: var(--color-text-muted);
}

.breadcrumbs a {
    color: var(--color-text-muted);
    text-decoration: none;
    transition: color var(--transition-fast);
}

.breadcrumbs a:hover {
    color: var(--color-primary);
}

.separator {
    color: var(--color-border);
}

.current {
    color: var(--color-text);
}

 
.translation-disclaimer {
    background: #fef3c7;
    border: 1px solid #f59e0b;
    border-radius: var(--radius-md);
    padding: var(--spacing-md);
    margin-bottom: var(--spacing-lg);
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: var(--spacing-md);
    flex-wrap: wrap;
}

.dark .translation-disclaimer {
    background: #78350f;
    border-color: #d97706;
}

.disclaimer-message {
    color: #92400e;
    font-size: 0.875rem;
}

.dark .disclaimer-message {
    color: #fde047;
}

.disclaimer-link {
    color: #92400e;
    font-weight: 600;
    text-decoration: underline;
    white-space: nowrap;
}

.dark .disclaimer-link {
    color: #fde047;
}

 
.proposal-header {
    margin-bottom: var(--spacing-2xl);
}

.proposal-title-section {
    margin-bottom: var(--spacing-lg);
}

.proposal-title {
    font-size: 2.5rem;
    margin: 0 0 var(--spacing-sm) 0;
    color: var(--color-text);
}

.proposal-number {
    font-size: 0.875rem;
    color: var(--color-text-muted);
    font-weight: 600;
}

 
.proposal-meta-box {
    background: var(--color-bg-secondary);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-lg);
    padding: var(--spacing-lg);
}

.proposal-status {
    display: inline-block;
    padding: var(--spacing-xs) var(--spacing-md);
    border-radius: var(--radius-md);
    font-weight: 600;
    font-size: 0.875rem;
    margin-bottom: var(--spacing-md);
    text-transform: uppercase;
    letter-spacing: 0.05em;
}

 
.status-open {
    background: #dbeafe;
    color: #0369a1;
}

.dark .status-open {
    background: #0c4a6e;
    color: #7dd3fc;
}

.status-accepted {
    background: #dbeafe;
    color: #0369a1;
}

.dark .status-accepted {
    background: #0c4a6e;
    color: #7dd3fc;
}

.status-finished {
    background: #dcfce7;
    color: #15803d;
}

.dark .status-finished {
    background: #164e63;
    color: #86efac;
}

.status-closed {
    background: #dcfce7;
    color: #15803d;
}

.dark .status-closed {
    background: #164e63;
    color: #86efac;
}

.status-rejected {
    background: #fee2e2;
    color: #991b1b;
}

.dark .status-rejected {
    background: #7f1d1d;
    color: #fca5a5;
}

.status-draft,
.status-needs-revision,
.status-dead,
.status-needs-research {
    background: #fef3c7;
    color: #92400e;
}

.dark .status-draft,
.dark .status-needs-revision,
.dark .status-dead,
.dark .status-needs-research {
    background: #78350f;
    color: #fde047;
}

.status-meta,
.status-informational,
.status-reserve {
    background: #e9d5ff;
    color: #6b21a8;
}

.dark .status-meta,
.dark .status-informational,
.dark .status-reserve {
    background: #581c87;
    color: #e879f9;
}

 
.proposal-info-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: var(--spacing-md);
    margin-bottom: var(--spacing-lg);
}

.info-item {
    display: flex;
    flex-direction: column;
    gap: var(--spacing-xs);
}

.info-label {
    font-size: 0.75rem;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    color: var(--color-text-muted);
}

.info-value {
    font-size: 0.9375rem;
    color: var(--color-text);
    font-weight: 500;
}

 
.proposal-relationships {
    border-top: 1px solid var(--color-border);
    padding-top: var(--spacing-md);
}

.relationship {
    display: flex;
    gap: var(--spacing-md);
    margin-bottom: var(--spacing-sm);
}

.relationship:last-child {
    margin-bottom: 0;
}

.relationship-label {
    font-weight: 600;
    color: var(--color-text-muted);
    min-width: 120px;
}

.relationship-value {
    color: var(--color-text);
}

 
.proposal-layout {
    display: block;
}

.proposal-layout--with-toc {
    display: grid;
    grid-template-columns: 260px 1fr;
    gap: var(--spacing-2xl);
    align-items: start;
}

 
.proposal-toc-sidebar {
    position: sticky;
    top: 100px;
    max-height: calc(100vh - 120px);
    overflow-y: auto;
}

.toc-nav {
    background: var(--color-bg-secondary);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-lg);
    padding: var(--spacing-md);
}

.toc-header {
    display: flex;
    align-items: center;
    gap: var(--spacing-sm);
    font-weight: 700;
    font-size: 0.875rem;
    color: var(--color-text);
    padding-bottom: var(--spacing-md);
    margin-bottom: var(--spacing-md);
    border-bottom: 1px solid var(--color-border);
}

.toc-content {
    max-height: calc(100vh - 250px);
    overflow-y: auto;
}

.toc-content::-webkit-scrollbar {
    width: 4px;
}

.toc-content::-webkit-scrollbar-track {
    background: transparent;
}

.toc-content::-webkit-scrollbar-thumb {
    background: var(--color-border);
    border-radius: 2px;
}

.toc-content::-webkit-scrollbar-thumb:hover {
    background: var(--color-text-muted);
}

.toc-nav ul {
    list-style: none;
    padding-left: 0;
    margin: 0;
}

.toc-nav li {
    margin-bottom: 0.25rem;
}

.toc-nav ul ul {
    padding-left: var(--spacing-md);
    margin-top: 0.25rem;
}

.toc-nav a {
    color: var(--color-text-secondary);
    text-decoration: none;
    font-size: 0.8125rem;
    display: block;
    padding: 0.25rem 0.5rem;
    border-radius: var(--radius-sm);
    transition: all var(--transition-fast);
    line-height: 1.4;
}

.toc-nav a:hover {
    color: var(--color-primary);
    background: var(--color-bg-tertiary);
}

 
.proposal-main {
    min-width: 0;
}

 
.proposal-content {
    line-height: 1.8;
    color: var(--color-text);
    max-width: 900px;
}

.proposal-content h2 {
    margin-top: var(--spacing-2xl);
    margin-bottom: var(--spacing-md);
    font-size: 1.75rem;
    scroll-margin-top: 100px;
}

.proposal-content h3 {
    margin-top: var(--spacing-xl);
    margin-bottom: var(--spacing-sm);
    font-size: 1.375rem;
    scroll-margin-top: 100px;
}

.proposal-content h4 {
    margin-top: var(--spacing-lg);
    margin-bottom: var(--spacing-xs);
    font-size: 1.125rem;
    scroll-margin-top: 100px;
}

.proposal-content p {
    margin-bottom: var(--spacing-md);
}

.proposal-content ul,
.proposal-content ol {
    margin-bottom: var(--spacing-md);
    padding-left: var(--spacing-xl);
}

.proposal-content li {
    margin-bottom: var(--spacing-xs);
}

.proposal-content code {
    background: var(--color-bg-secondary);
    padding: 0.125rem 0.375rem;
    border-radius: var(--radius-sm);
    font-size: 0.875em;
    font-family: 'Courier New', monospace;
}

.proposal-content pre {
    background: var(--color-bg-secondary);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-md);
    padding: var(--spacing-md);
    overflow-x: auto;
    margin-bottom: var(--spacing-md);
    font-size: 0.875rem;
}

.proposal-content pre code {
    background: none;
    padding: 0;
}

.proposal-content blockquote {
    border-left: 4px solid var(--color-primary);
    padding-left: var(--spacing-md);
    margin-left: 0;
    margin-bottom: var(--spacing-md);
    font-style: italic;
    color: var(--color-text-secondary);
}

.proposal-content a {
    color: var(--color-primary);
    text-decoration: none;
    border-bottom: 1px solid transparent;
    transition: border-color var(--transition-fast);
}

.proposal-content a:hover {
    border-bottom-color: var(--color-primary);
}

.proposal-content table {
    width: 100%;
    border-collapse: collapse;
    margin-bottom: var(--spacing-md);
}

.proposal-content table th {
    background: var(--color-bg-secondary);
    padding: var(--spacing-sm);
    text-align: left;
    font-weight: 600;
    border-bottom: 2px solid var(--color-border);
}

.proposal-content table td {
    padding: var(--spacing-sm);
    border-bottom: 1px solid var(--color-border);
}

.proposal-content img {
    max-width: 100%;
    height: auto;
    border-radius: var(--radius-md);
    border: 1px solid var(--color-border);
    margin: var(--spacing-lg) 0;
    display: block;
}

 
.page-nav {
    margin-top: var(--spacing-2xl);
    padding-top: var(--spacing-xl);
    border-top: 1px solid var(--color-border);
    display: flex;
    gap: var(--spacing-md);
    flex-wrap: wrap;
}

.page-nav-link {
    display: inline-block;
    padding: var(--spacing-md) var(--spacing-lg);
    background: var(--color-bg-secondary);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-md);
    color: var(--color-text);
    text-decoration: none;
    transition: all var(--transition-fast);
}

.page-nav-link:hover {
    border-color: var(--color-primary);
    color: var(--color-primary);
}

 
@media (max-width: 1024px) {
    .proposal-layout--with-toc {
        grid-template-columns: 1fr;
    }

    .proposal-toc-sidebar {
        position: static;
        max-height: none;
        margin-bottom: var(--spacing-xl);
    }

    .toc-content {
        max-height: 300px;
    }
}

@media (max-width: 768px) {
    .proposal-title {
        font-size: 1.75rem;
    }

    .proposal-info-grid {
        grid-template-columns: 1fr;
    }
}
</style>



<script>
document.addEventListener('DOMContentLoaded', function() {
    const tocLinks = document.querySelectorAll('.toc-nav a');
    const headings = [];

    tocLinks.forEach(link => {
        const href = link.getAttribute('href');
        if (href && href.startsWith('#')) {
            const heading = document.getElementById(href.slice(1));
            if (heading) {
                headings.push({ element: heading, link: link });
            }
        }
    });

    function updateActiveLink() {
        const scrollPos = window.scrollY + 120;
        let activeIndex = 0;

        for (let i = 0; i < headings.length; i++) {
            if (headings[i].element.offsetTop <= scrollPos) {
                activeIndex = i;
            }
        }

        tocLinks.forEach(link => link.classList.remove('active'));
        if (headings[activeIndex]) {
            headings[activeIndex].link.classList.add('active');
        }
    }

    window.addEventListener('scroll', updateActiveLink);
    updateActiveLink();
});
</script>
<style>
.toc-nav a.active {
    color: var(--color-primary);
    background: var(--color-bg-tertiary);
    font-weight: 600;
}
</style>



    </main>

    <footer class="site-footer">
    <div class="container">
        <div class="footer-grid">
            <div class="footer-col footer-brand">
                <img src="../../../images/i2plogo_lightmode.svg" alt="I2P Logo" class="footer-logo logo-light" loading="lazy" decoding="async">
                <img src="../../../images/i2plogo_darkmode.svg" alt="I2P Logo" class="footer-logo logo-dark" loading="lazy" decoding="async">
                <p class="footer-tagline">Privacy. Security. Freedom.</p>
                <p class="footer-description">The Invisible Internet Project - A privacy-focused, anonymous network layer</p>

                <div class="footer-social-newsletter">
                    <div class="social-links">
                        <a href="https://mastodon.social/@i2p" target="_blank" rel="noopener" aria-label="Mastodon">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M21.327 8.566c0-4.339-2.843-5.61-2.843-5.61-1.433-.658-3.894-.935-6.451-.956h-.063c-2.557.021-5.016.298-6.45.956 0 0-2.843 1.272-2.843 5.61 0 .993-.019 2.181.012 3.441.103 4.243.778 8.425 4.701 9.463 1.809.479 3.362.579 4.612.51 2.268-.126 3.541-.809 3.541-.809l-.075-1.646s-1.621.511-3.441.449c-1.804-.062-3.707-.194-3.999-2.409a4.523 4.523 0 0 1-.04-.621s1.77.433 4.014.536c1.372.063 2.658-.08 3.965-.236 2.506-.299 4.688-1.843 4.962-3.254.434-2.223.398-5.424.398-5.424zm-3.353 5.59h-2.081V9.057c0-1.075-.452-1.62-1.357-1.62-1 0-1.501.647-1.501 1.927v2.791h-2.069V9.364c0-1.28-.501-1.927-1.502-1.927-.905 0-1.357.546-1.357 1.62v5.099H6.026V8.903c0-1.074.273-1.927.823-2.558.566-.631 1.307-.955 2.228-.955 1.065 0 1.872.409 2.405 1.228l.518.869.519-.869c.533-.819 1.34-1.228 2.405-1.228.92 0 1.662.324 2.228.955.549.631.822 1.484.822 2.558v5.253z"/>
                            </svg>
                        </a>
                        <a href="https://twitter.com/GetI2P" target="_blank" rel="noopener" aria-label="Twitter">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/>
                            </svg>
                        </a>
                        <a href="https://old.reddit.com/r/i2p" target="_blank" rel="noopener" aria-label="Reddit">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M12 0A12 12 0 0 0 0 12a12 12 0 0 0 12 12 12 12 0 0 0 12-12A12 12 0 0 0 12 0zm5.01 4.744c.688 0 1.25.561 1.25 1.249a1.25 1.25 0 0 1-2.498.056l-2.597-.547-.8 3.747c1.824.07 3.48.632 4.674 1.488.308-.309.73-.491 1.207-.491.968 0 1.754.786 1.754 1.754 0 .716-.435 1.333-1.01 1.614a3.111 3.111 0 0 1 .042.52c0 2.694-3.13 4.87-7.004 4.87-3.874 0-7.004-2.176-7.004-4.87 0-.183.015-.366.043-.534A1.748 1.748 0 0 1 4.028 12c0-.968.786-1.754 1.754-1.754.463 0 .898.196 1.207.49 1.207-.883 2.878-1.43 4.744-1.487l.885-4.182a.342.342 0 0 1 .14-.197.35.35 0 0 1 .238-.042l2.906.617a1.214 1.214 0 0 1 1.108-.701zM9.25 12C8.561 12 8 12.562 8 13.25c0 .687.561 1.248 1.25 1.248.687 0 1.248-.561 1.248-1.249 0-.688-.561-1.249-1.249-1.249zm5.5 0c-.687 0-1.248.561-1.248 1.25 0 .687.561 1.248 1.249 1.248.688 0 1.249-.561 1.249-1.249 0-.687-.562-1.249-1.25-1.249zm-5.466 3.99a.327.327 0 0 0-.231.094.33.33 0 0 0 0 .463c.842.842 2.484.913 2.961.913.477 0 2.105-.056 2.961-.913a.361.361 0 0 0 .029-.463.33.33 0 0 0-.464 0c-.547.533-1.684.73-2.512.73-.828 0-1.979-.196-2.512-.73a.326.326 0 0 0-.232-.095z"/>
                            </svg>
                        </a>
                        <a href="https://signal.group/#CjQKIOSUTtxlhbumAKcRsthPFkxkTUrkWcX39bbN6njLEgAIEhCTNsR0KDuiehAXZnkt42v5" target="_blank" rel="noopener" aria-label="Signal" class="signal-link">
                            <img src="../../../images/Signal-Logo-Black.svg" alt="Signal" class="signal-logo signal-logo-light" loading="lazy" decoding="async">
                            <img src="../../../images/Signal-Logo-White.svg" alt="Signal" class="signal-logo signal-logo-dark" loading="lazy" decoding="async">
                        </a>
                    </div>

                    
                    <div class="footer-newsletter-inline">
                        <p class="newsletter-description">Zůstaňte informováni o novinkách I2P:</p>
                        <form action="https://feedback.i2p.net/api/mailing-list/subscribe" method="POST" class="newsletter-form">
                            <input type="email" name="email" placeholder="Zadejte svůj email" required>
                            <button type="submit">Odebírat</button>
                        </form>
                    </div>
                </div>
            </div>

            <div class="footer-col">
                <h3>Rychlé odkazy</h3>
                <ul>
                    <li><a href="../../../cs/financial-support/">Darovat</a></li>
                    <li><a href="../../../cs/docs/overview/intro/">Úvod do I2P</a></li>
                </ul>
            </div>

            <div class="footer-col">
                <h3>Komunita</h3>
                <ul>
                    <li><a href="../../../cs/get-involved/">Zapojte se</a></li>
                    <li><a href="../../../cs/blog/">Blog</a></li>
                    <li><a href="http://i2pforum.net/" target="_blank" rel="noopener">Oficiální fóra</a></li>
                    <li><a href="../../../cs/contact/">Kontaktujte nás</a></li>
                </ul>
            </div>

            <div class="footer-col">
                <h3>Zdroje</h3>
                <ul>
                    <li><a href="https://i2p-metrics.np-tokumei.net/" target="_blank" rel="noopener">I2P Metriky</a></li>
                    <li><a href="../../../cs/papers/">Výzkum</a></li>
                    <li><a href="https://i2pgit.org/" target="_blank" rel="noopener">GitLab</a></li>
                    <li><a href="https://www.stormycloud.org/" target="_blank" rel="noopener">StormyCloud</a></li>
                </ul>
            </div>
        </div>

        <div class="footer-bottom">
            <p class="copyright">&copy; 2025 Projekt Neviditelný Internet. Licencováno pod Creative Commons.</p>
            <div class="footer-links">
                <a href="../../../cs/privacy/">Ochrana soukromí</a>
                <a href="../../../cs/terms/">Podmínky</a>
                <a href="../../../cs/about/media/">Tisk</a>
            </div>
        </div>
    </div>
</footer>


    
    
<div class="modal-overlay" id="poll">
    <div class="modal-content poll-modal-content">
        <a href="#" class="modal-close" aria-label="Zavřít">
            <span aria-hidden="true">&times;</span>
        </a>

        <div class="modal-header">
            <h2>Komunitní anketa</h2>
            <p class="modal-subtitle">Rádi bychom o vás slyšeli</p>
        </div>

        <div class="modal-body">
            
            <iframe 
                id="poll-iframe"
                data-poll-id="2"
                data-api-url="https://feedback.i2p.net"
                frameborder="0"
                scrolling="no"
                style="width: 100%; border: none; min-height: 400px;">
            </iframe>
        </div>

        <div class="modal-footer">
            <p class="modal-disclaimer">
                Váš hlas pomáhá utvářet budoucnost I2P.
            </p>
        </div>
    </div>
</div>


<script>
(function() {
    const iframe = document.getElementById('poll-iframe');
    if (!iframe) return;
    
    const hostname = window.location.hostname;
    let apiUrl = 'https://feedback.i2p.net';
    const pollId = iframe.getAttribute('data-poll-id') || '1';

    
    if (hostname.endsWith('.b32.i2p') || hostname.endsWith('.i2p')) {
        apiUrl = 'http://5kwyynf3eetgqa2nors6ctwo7doi7yu73k7uvypy5eqmm326zkiq.b32.i2p';
    }
    
    else if (hostname.endsWith('.onion')) {
        apiUrl = 'http://gfonxmohvarpmocsvllscsuszdu5rikipm6innvcwq4vpng7zzqmmfyd.onion';
    }

    
    const pollUrl = apiUrl + '/widgets/poll.html?poll_id=' + encodeURIComponent(pollId) + '&api_url=' + encodeURIComponent(apiUrl);
    iframe.src = pollUrl;
})();
</script>



    
    



    
    <script>
        (function () {
            'use strict';
            var hostname = window.location.hostname;
            var baseUrl;

            
            if (hostname.endsWith('.b32.i2p') || hostname.endsWith('.i2p')) {
                baseUrl = 'http://5kwyynf3eetgqa2nors6ctwo7doi7yu73k7uvypy5eqmm326zkiq.b32.i2p';
            } else if (hostname.endsWith('.onion')) {
                baseUrl = 'http://gfonxmohvarpmocsvllscsuszdu5rikipm6innvcwq4vpng7zzqmmfyd.onion';
            } else {
                baseUrl = 'https://feedback.i2p.net';
            }

            window.feedbackBaseUrl = baseUrl;

            
            document.querySelectorAll('[data-api-url]').forEach(function (widget) {
                widget.setAttribute('data-api-url', baseUrl);
            });

            
            document.write('<link rel="stylesheet" href="' + baseUrl + '/widgets/styles.css">');
            
        })();
    </script>

    

    
    
    

    

</body>

</html>
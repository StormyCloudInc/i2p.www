<!DOCTYPE html>
<html lang="cs" data-theme="light">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <title>Menší zprávy o stavbě tunelu | I2P - Projekt neviditelného internetu</title>

    <meta name="description" content="The Invisible Internet Project - A privacy-focused, anonymous network layer">
    <meta name="keywords" content="i2p, privacy, anonymity, dark net, encryption, security">

    
    <meta property="og:title" content="Menší zprávy o stavbě tunelu | I2P - Projekt neviditelného internetu">
    <meta property="og:description" content="The Invisible Internet Project - A privacy-focused, anonymous network layer">
    <meta property="og:type" content="website">
    <meta property="og:url" content="/cs/proposals/157-new-tbm/">

    
    <link rel="icon" type="image/svg+xml" href="../../../images/favicon.svg">
    <link rel="icon" type="image/png" href="../../../images/i2plogo.png" sizes="32x32">

    
    
    
    
    <link rel="stylesheet" href="../../../css/main.min.be6880f32f5ff44e57579da7b11513b973319944ebe38748e3ac7f3268662d18.css" integrity="sha256-vmiA8y9f9E5XV52nsRUTuXMxmUTr44dI46x/MmhmLRg=">
    


    
</head>

<body>
    
    <input type="checkbox" id="theme-toggle-checkbox" class="theme-checkbox" aria-hidden="true">

    
<div class="site-banner" id="site-banner" data-banner-id="banner-3" role="alert" aria-live="polite">
    <div class="container">
        <div class="banner-content">
            <span class="banner-message">I2P Beta stránky jsou nyní spuštěny. Problémy s e-mailem hlaste na stormycloud@mail.i2p</span>
            
        </div>
        
        <form method="GET" action="../../../api/banner/dismiss" style="display: inline;">
            <input type="hidden" name="id" value="banner-3">
            <button type="submit" class="banner-close" aria-label="Zavřít banner" title="Zavřít banner">
                <span aria-hidden="true">&times;</span>
            </button>
        </form>
        
    </div>
</div>


    <header class="site-header">
    <div class="container">
        <nav class="main-nav">
            <div class="nav-brand">
                <a href="../../../cs/" class="logo-link">
                    <img src="../../../images/i2plogo_lightmode.svg" alt="I2P Logo" class="logo logo-light">
                    <img src="../../../images/i2plogo_darkmode.svg" alt="I2P Logo" class="logo logo-dark">
                </a>
            </div>

            
            <input type="checkbox" id="mobile-menu-checkbox" class="mobile-menu-checkbox"
                aria-label="Toggle navigation menu">
            <label for="mobile-menu-checkbox" class="mobile-menu-toggle" aria-label="Toggle navigation menu">
                <span class="hamburger"></span>
            </label>

            <div class="nav-menu">
                <ul class="nav-links">
                    <li class="nav-dropdown">
                        <a href="../../../cs/about/" class="">O aplikaci</a>
                        <ul class="dropdown-menu">
                            <li><a href="../../../cs/about/">Přehled</a></li>
                            <li><a href="../../../cs/papers/">Výzkumné práce</a></li>
                            <li><a href="../../../cs/about/media/">Pro média</a></li>
                            <li><a href="../../../cs/contact/">Kontaktujte nás</a></li>
                        </ul>
                    </li>
                    <li><a href="../../../cs/docs/" class="">Dokumentace</a></li>
                    <li><a href="../../../cs/downloads/" class="">Ke stažení</a></li>
                    <li><a href="../../../cs/blog/" class="">Blog</a></li>
                    <li class="nav-dropdown">
                        <a href="../../../cs/get-involved/" class="">Zapojte se</a>
                        <ul class="dropdown-menu">
                            <li><a href="../../../cs/get-involved/">Přehled</a></li>
                            <li><a href="../../../cs/feedback/">Návrhy funkcí</a></li>
                        </ul>
                    </li>
                </ul>

                <div class="nav-actions">
                    
                    <div class="language-selector">
                        <button class="language-toggle" aria-label="Select language" title="Language">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none"
                                xmlns="http://www.w3.org/2000/svg">
                                <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2" />
                                <path
                                    d="M2 12h20M12 2a15.3 15.3 0 014 10 15.3 15.3 0 01-4 10 15.3 15.3 0 01-4-10 15.3 15.3 0 014-10z"
                                    stroke="currentColor" stroke-width="2" />
                            </svg>
                            <span class="current-lang">cs</span>
                        </button>
                        <div class="language-dropdown">
                            
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../en/proposals/157-new-tbm/"
                                class="lang-option">Angličtina</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../es/proposals/157-new-tbm/"
                                class="lang-option">Španělština</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../ko/proposals/157-new-tbm/"
                                class="lang-option">Korejština</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../zh/proposals/157-new-tbm/"
                                class="lang-option">Čínština</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../ru/proposals/157-new-tbm/"
                                class="lang-option">Ruština</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../cs/proposals/157-new-tbm/"
                                class="lang-option active">Čeština</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../de/proposals/157-new-tbm/"
                                class="lang-option">Němčina</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../fr/proposals/157-new-tbm/"
                                class="lang-option">Francouzština</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../tr/proposals/157-new-tbm/"
                                class="lang-option">Turečtina</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../vi/proposals/157-new-tbm/"
                                class="lang-option">Vietnamština</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../hi/proposals/157-new-tbm/"
                                class="lang-option">Hindština</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../ar/proposals/157-new-tbm/"
                                class="lang-option">Arabština</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../pt/proposals/157-new-tbm/"
                                class="lang-option">Portugalština</a>
                            
                            
                        </div>
                    </div>

                    
                    <label for="theme-toggle-checkbox" class="theme-toggle" aria-label="Toggle dark mode"
                        title="Toggle theme">
                        <svg class="sun-icon" width="20" height="20" viewBox="0 0 20 20" fill="none"
                            xmlns="http://www.w3.org/2000/svg">
                            <circle cx="10" cy="10" r="4" stroke="currentColor" stroke-width="2" />
                            <path
                                d="M10 2V4M10 16V18M18 10H16M4 10H2M15.657 4.343L14.243 5.757M5.757 14.243L4.343 15.657M15.657 15.657L14.243 14.243M5.757 5.757L4.343 4.343"
                                stroke="currentColor" stroke-width="2" stroke-linecap="round" />
                        </svg>
                        <svg class="moon-icon" width="20" height="20" viewBox="0 0 20 20" fill="none"
                            xmlns="http://www.w3.org/2000/svg">
                            <path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"
                                stroke="currentColor" stroke-width="2" stroke-linejoin="round" />
                        </svg>
                    </label>

                    
                    <a href="../../../cs/financial-support/" class="btn btn-primary" id="donate-btn">Donate</a>

                    
                    <a href="../../../cs/downloads/" class="btn btn-primary">Získat I2P</a>
                </div>
            </div>
        </nav>
    </div>
</header>

    <main id="main-content">
        



<div class="proposals-page">
    <div class="container">
        
        <nav class="breadcrumbs">
            <a href="../../../cs/">Home</a>
            <span class="separator">/</span>
            <a href="../../../cs/proposals/">Proposals</a>
            <span class="separator">/</span>
            <span class="current">Menší zprávy o stavbě tunelu</span>
        </nav>

        
<div class="translation-disclaimer" role="note">
    <span class="disclaimer-message">Tento překlad byl vytvořen pomocí strojového učení a nemusí být 100% přesný.</span>
    
    
    <a href="../../../en/proposals/157-new-tbm/" class="disclaimer-link">Zobrazit anglickou verzi</a>
    
</div>



        
        <header class="proposal-header">
            <div class="proposal-title-section">
                <h1 class="proposal-title">Menší zprávy o stavbě tunelu</h1>
                <div class="proposal-number">Proposal 157</div>
            </div>

            
            <div class="proposal-meta-box">
                <div class="proposal-status status-closed">
                    Closed
                </div>

                
                <div class="proposal-info-grid">
                    
                    <div class="info-item">
                        <span class="info-label">Author</span>
                        <span class="info-value">zzz, original</span>
                    </div>
                    

                    
                    <div class="info-item">
                        <span class="info-label">Created</span>
                        <span class="info-value">2020-10-09</span>
                    </div>
                    

                    
                    <div class="info-item">
                        <span class="info-label">Last Updated</span>
                        <span class="info-value">2021-07-31</span>
                    </div>
                    

                    
                    <div class="info-item">
                        <span class="info-label">Target Version</span>
                        <span class="info-value">0.9.51</span>
                    </div>
                    

                    
                </div>

                
                
            </div>
        </header>

        
        <div class="proposal-layout proposal-layout--with-toc">
            
            
            <aside class="proposal-toc-sidebar">
                <nav class="toc-nav">
                    <div class="toc-header">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                            <path d="M4 6h16M4 12h16M4 18h16" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                        </svg>
                        On This Page
                    </div>
                    <div class="toc-content">
                        <nav id="TableOfContents">
  <ul>
    <li><a href="#poznámka">Poznámka</a></li>
    <li><a href="#přehled">Přehled</a>
      <ul>
        <li><a href="#shrnutí">Shrnutí</a></li>
        <li><a href="#cíle">Cíle</a></li>
        <li><a href="#nekritické-cíle">Nekritické cíle</a></li>
      </ul>
    </li>
    <li><a href="#návrh">Návrh</a>
      <ul>
        <li><a href="#záznamy">Záznamy</a></li>
        <li><a href="#zprávy-o-stavbě-tunelu">Zprávy o stavbě tunelu</a></li>
        <li><a href="#tok-zprávy">Tok zprávy</a></li>
        <li><a href="#šifrování-záznamů">Šifrování záznamů</a></li>
        <li><a href="#šifrování-vrstev">Šifrování vrstev</a></li>
        <li><a href="#nová-tunelová-datová-zpráva">Nová Tunelová Datová Zpráva</a></li>
      </ul>
    </li>
    <li><a href="#specifikace">Specifikace</a>
      <ul>
        <li><a href="#krátký-záznam-požadavku">Krátký záznam požadavku</a></li>
        <li><a href="#krátký-záznam-odpovědi">Krátký záznam odpovědi</a></li>
        <li><a href="#kdf">KDF</a></li>
        <li><a href="#shorttunnelbuild">ShortTunnelBuild</a></li>
        <li><a href="#outboundtunnelbuildreply">OutboundTunnelBuildReply</a></li>
        <li><a href="#kdf-1">KDF</a></li>
      </ul>
    </li>
    <li><a href="#zdůvodnění">Zdůvodnění</a></li>
    <li><a href="#poznámky-k-implementaci">Poznámky k implementaci</a></li>
    <li><a href="#otázky">Otázky</a></li>
    <li><a href="#migrace">Migrace</a></li>
    <li><a href="#příloha">Příloha</a></li>
    <li><a href="#odkazy">Odkazy</a></li>
  </ul>
</nav>
                    </div>
                </nav>
            </aside>
            

            
            <div class="proposal-main">
                <article class="proposal-content">
                    <h2 id="poznámka">Poznámka</h2>
<p>Implementováno od verze API 0.9.51.
Probíhá testování a nasazení v síti.
Předmět drobných úprav.
Pro konečnou specifikaci vizte <a href="../../../cs/docs/specs/i2np/">I2NP</a>
 a <a href="../../../cs/docs/specs/implementation/#tunnel-creation-ecies">Tunnel-Creation-ECIES</a>
.</p>
<h2 id="přehled">Přehled</h2>
<h3 id="shrnutí">Shrnutí</h3>
<p>Aktuální velikost zašifrovaných záznamů požadavků a odpovědí na konstrukci tunelu je 528.
U typických zpráv proměnných konstrukcí tunelu a odpovědí na proměnné konstrukce tunelu
je celková velikost 2113 bajtů. Tato zpráva je rozdělena na tři 1KB tunelové zprávy
pro zpětnou cestu.</p>
<p>Změny formátu 528-bajtového záznamu pro směrovače ECIES-X25519 jsou specifikovány v <a href="../../../cs/proposals/152-ecies-tunnels/">Prop152</a>
 a <a href="../../../cs/docs/specs/implementation/#tunnel-creation-ecies">Tunnel-Creation-ECIES</a>
.
Pro směs směrovačů ElGamal a ECIES-X25519 v tunelu musí velikost záznamu zůstat
528 bajtů. Avšak pokud jsou všechny směrovače v tunelu ECIES-X25519, je možné vytvořit nový, menší záznam konstrukce, protože šifrování ECIES-X25519 má mnohem menší režii
než ElGamal.</p>
<p>Menší zprávy by ušetřily šířku pásma. Také, pokud by se zprávy vešly do
jedné tunelové zprávy, zpětná cesta by byla třikrát účinnější.</p>
<p>Tento návrh definuje nové záznamy požadavků a odpovědí a nové zprávy požadavků a odpovědí na konstrukci.</p>
<p>Tvůrce tunelu a všechny přeskoky v vytvořeném tunelu musí používat ECIES-X25519, a alespoň verzi 0.9.51.
Tento návrh nebude užitečný, dokud většina směrovačů v síti nebude ECIES-X25519.
To se očekává na konci roku 2021.</p>
<h3 id="cíle">Cíle</h3>
<p>Další cíle vizte <a href="../../../cs/proposals/152-ecies-tunnels/">Prop152</a>
 a <a href="../../../cs/proposals/156-ecies-routers/">Prop156</a>
.</p>
<ul>
<li>Menší záznamy a zprávy</li>
<li>Zachovat dostatečný prostor pro budoucí možnosti, jak je definováno v <a href="../../../cs/proposals/152-ecies-tunnels/">Prop152</a>
 a <a href="../../../cs/docs/specs/implementation/#tunnel-creation-ecies">Tunnel-Creation-ECIES</a>
</li>
<li>Vejít se do jedné tunelové zprávy pro zpětnou cestu</li>
<li>Podporovat pouze přeskoky ECIES</li>
<li>Zachovat vylepšení implementovaná v <a href="../../../cs/proposals/152-ecies-tunnels/">Prop152</a>
 a <a href="../../../cs/docs/specs/implementation/#tunnel-creation-ecies">Tunnel-Creation-ECIES</a>
</li>
<li>Maximalizovat kompatibilitu se současnou sítí</li>
<li>Skrýt příchozí stavební zprávy před OBEP</li>
<li>Skrýt odchozí stavební odpovědní zprávy před IBGW</li>
<li>Nepožadovat &ldquo;vlajkový den&rdquo; upgrade celé sítě</li>
<li>Postupné zavádění k minimalizaci rizika</li>
<li>Opětovné použití existujících kryptografických primitiv</li>
</ul>
<h3 id="nekritické-cíle">Nekritické cíle</h3>
<p>Další nekritické cíle naleznete v <a href="../../../cs/proposals/156-ecies-routers/">Prop156</a>
.</p>
<ul>
<li>Neexistuje požadavek na směsné tunely ElGamal/ECIES</li>
<li>Změny ve vrstvovém šifrování, viz <a href="../../../cs/proposals/153-chacha20-layer-encryption/">Prop153</a>
</li>
<li>Žádné zrychlení kryptografických operací. Předpokládá se, že ChaCha20 a AES jsou podobné,
dokonce i s AESNI, alespoň pro malé velikosti dat v otázce.</li>
</ul>
<h2 id="návrh">Návrh</h2>
<h3 id="záznamy">Záznamy</h3>
<p>Viz přílohu pro výpočty.</p>
<p>Zašifrované záznamy požadavků a odpovědí budou mít 218 bajtů v porovnání s 528 bajty nyní.</p>
<p>Otevřené záznamy požadavků budou mít 154 bajtů,
v porovnání s 222 bajty pro záznamy ElGamal
a 464 bajty pro záznamy ECIES, jak je definováno v <a href="../../../cs/proposals/152-ecies-tunnels/">Prop152</a>
 a <a href="../../../cs/docs/specs/implementation/#tunnel-creation-ecies">Tunnel-Creation-ECIES</a>
.</p>
<p>Otevřené záznamy odpovědí budou mít 202 bajtů,
v porovnání s 496 bajty pro záznamy ElGamal
a 512 bajtů pro záznamy ECIES, jak je definováno v <a href="../../../cs/proposals/152-ecies-tunnels/">Prop152</a>
 a <a href="../../../cs/docs/specs/implementation/#tunnel-creation-ecies">Tunnel-Creation-ECIES</a>
.</p>
<p>Šifrování odpovědí bude ChaCha20 (NE ChaCha20/Poly1305),
takže otevřené záznamy nemusí být násobkem 16 bajtů.</p>
<p>Záznamy požadavků budou zmenšeny použitím HKDF k vytvoření
klíčů a IV vrstev a odpovědí, takže nemusí být výslovně zahrnuty v požadavku.</p>
<h3 id="zprávy-o-stavbě-tunelu">Zprávy o stavbě tunelu</h3>
<p>Obě budou &ldquo;proměnné&rdquo; s jedním bajtem čísla záznamů,
stejně jako u stávajících proměnných zpráv.</p>
<h4 id="shorttunnelbuild-typ-25">ShortTunnelBuild: Typ 25</h4>
<p>Typická délka (se 4 záznamy): 873 bajtů</p>
<p>Při použití pro stavbu příchozího tunelu
se doporučuje (ale není povinné), aby byla tato zpráva zašifrována česnekem autorem
cíleným na bránu pro příchozí (pokyny k doručení ROUTER),
aby byly skryty příchozí stavební zprávy před OBEP.
IBGW dešifruje zprávu,
vloží odpověď do odpovídajícího slotu
a odešle ShortTunnelBuildMessage na další přeskok.</p>
<p>Délka záznamu je zvolena tak, aby se STBM zašifrovaný česnekem vešel do
jedné tunelové zprávy. Viz níže uvedená příloha.</p>
<h4 id="outboundtunnelbuildreply-typ-26">OutboundTunnelBuildReply: Typ 26</h4>
<p>Definujeme novou zprávu OutboundTunnelBuildReply.
Používá se pouze pro odchozí stavby tunelů.
Účel je skrýt odchozí stavební odpovědní zprávy před IBGW.
Musí být zašifrována česnekem OBEP, cílená na autora
(pokyny pro doručení TUNNEL).
OBEP dešifruje tunelovou stavební zprávu,
vytvoří OutboundTunnelBuildReply zprávu,
a vloží odpověď do pole obyčejného textu.
Ostatní záznamy vloží do jiných slotů.
Poté zprávu zašifruje česnekem směrem k autorovi s odvozenými symetrickými klíči.</p>
<h4 id="poznámky">Poznámky</h4>
<p>Zašifrováním OTBRM a STBM česnekem se také vyhneme jakýmkoli potenciálním
problémům s kompatibilitou na IBGW a OBEP spárovaných tunelů.</p>
<h3 id="tok-zprávy">Tok zprávy</h3>
<pre tabindex="0"><code>STBM: Krátká zpráva o stavbě tunelu (typ 25)
  OTBRM: Zpráva o odpovědi na stavbu odchozího tunelu (typ 26)

  Odchozí stavba A-B-C
  Odpověď stávajícím příchozím tunelem D-E-F

                  Nový Tunel
           STBM      STBM      STBM
  Vytvořitel ------&gt; A ------&gt; B ------&gt; C ---\
                                     OBEP   \
                                            | Zabaleno česnekem
                                            | OTBRM
                                            | (TUNNEL doručení)
                                            | od OBEP k
                                            | vytvořiteli
                Stávající Tunel             /
  Vytvořitel &lt;-------F---------E-------- D &lt;--/
                                     IBGW


  Příchozí Stavba D-E-F
  Odesláno stávajícím odchozím tunelem A-B-C

                Stávající Tunel
  Vytvořitel ------&gt; A ------&gt; B ------&gt; C ---\
                                    OBEP    \
                                            | Zabaleno česnekem (volitelné)
                                            | STBM
                                            | (ROUTER doručení)
                                            | od vytvořitele
                  Nový Tunel                | k IBGW
            STBM      STBM      STBM        /
  Vytvořitel &lt;------ F &lt;------ E &lt;------ D &lt;--/
                                     IBGW
</code></pre><h3 id="šifrování-záznamů">Šifrování záznamů</h3>
<p>Šifrování záznamů požadavků a odpovědí: jak je definováno v <a href="../../../cs/proposals/152-ecies-tunnels/">Prop152</a>
 a <a href="../../../cs/docs/specs/implementation/#tunnel-creation-ecies">Tunnel-Creation-ECIES</a>
.</p>
<p>Šifrování záznamů odpovědí pro jiné sloty: ChaCha20.</p>
<h3 id="šifrování-vrstev">Šifrování vrstev</h3>
<p>V současnosti není plánována změna šifrování vrstev pro tunely vytvořené podle této specifikace; zůstane AES, jak je v současné době používáno pro všechny tunely.</p>
<p>Změna šifrování vrstvy na ChaCha20 je téma pro další výzkum.</p>
<h3 id="nová-tunelová-datová-zpráva">Nová Tunelová Datová Zpráva</h3>
<p>V současné době není plánována změna 1KB Tunelové Datové Zprávy používané pro tunely
vytvořené podle této specifikace.</p>
<p>Může být užitečné zavést novou I2NP zprávu, která je větší nebo proměnlivě velká,
současně s tímto návrhem,
pro použití nad těmito tunely.
To by snížilo režii pro velké zprávy.
Toto je téma pro další výzkum.</p>
<h2 id="specifikace">Specifikace</h2>
<h3 id="krátký-záznam-požadavku">Krátký záznam požadavku</h3>
<h4 id="krátký-nezakódovaný-záznam-požadavku">Krátký nezakódovaný záznam požadavku</h4>
<p>Toto je navrhovaná specifikace pro BuildRequestRecord tunelu pro směrovače ECIES-X25519.
Shrnutí změn z <a href="../../../cs/docs/specs/implementation/#tunnel-creation-ecies">Tunnel-Creation-ECIES</a>
:</p>
<ul>
<li>Změnit nezakódovanou délku z 464 na 154 bajtů</li>
<li>Změnit zakódovanou délku z 528 na 218 bajtů</li>
<li>Odstranit klíče a IV vrstev a odpovědí, budou generovány ze split() a KDF</li>
</ul>
<p>Záznam požadavku neobsahuje žádné ChaCha klíče odpovědí.
Tyto klíče jsou odvozeny z KDF. Viz níže.</p>
<p>Všechna pole jsou big-endian.</p>
<p>Nezakódovaná velikost: 154 bajtů.</p>
<pre tabindex="0"><code>bytes     0-3: ID tunelu pro příjem zpráv jako, nenulové
  bytes     4-7: další ID tunelu, nenulové
  bytes    8-39: hash identity dalšího směrovače
  byte       40: vlajky
  bytes   41-42: více vlajek, nepoužité, nastavené na 0 pro kompatibilitu
  byte       43: typ šifrování vrstvy
  bytes   44-47: čas požadavku (v minutách od epochy, zaokrouhleno dolů)
  bytes   48-51: expirace požadavku (v sekundách od vytvoření)
  bytes   52-55: další ID zprávy
  bytes    56-x: volby konstrukce tunelu (Mapping)
  bytes     x-x: další data, jak je naznačeno vlajkami nebo volbami
  bytes   x-153: náhodné vycpávání (viz níže)
</code></pre><p>Pole vlajek je stejné, jak je definováno v <a href="../../../cs/docs/specs/implementation/#tunnel-creation-ecies">Tunnel-Creation</a>
 a obsahuje následující::</p>
<p>Bitový pořadí: 76543210 (bit 7 je MSB)
bit 7: pokud je nastaven, povolit zprávy od kohokoli
bit 6: pokud je nastaven, povolit zprávy komukoli a odeslat odpověď na
specifikovaný další přeskok v Zprávě o odpovědi na konstrukci tunelu
bity 5-0: Nedefinováno, musí být nastavena na 0 pro kompatibilitu s budoucími možnostmi</p>
<p>Bit 7 naznačuje, že přeskok bude příchozí bránou (IBGW). Bit 6
naznačuje, že přeskok bude odchozím koncovým bodem (OBEP). Pokud není nastaven ani jeden z těchto bitů,
přeskok bude účastníkem ve střední části. Oba nemohou být nastaveny zároveň.</p>
<p>Typ šifrování vrstvy: 0 pro AES (jak v současných tunelech);
1 pro budoucnost (ChaCha?)</p>
<p>Expirace požadavku je pro budoucí proměnlivou dobu tunelu.
Prozatím je jediná podporovaná hodnota 600 (10 minut).</p>
<p>Tento klíč je vyžadován, protože na této vrstvě neexistuje DH pro stavební záznam.</p>
<p>Volby konstrukce tunelu je struktura Mapping, jak je definováno v <a href="../../../cs/docs/specs/common-structures/">Common</a>
.
Toto je pro budoucí použití. Žádné volby nejsou aktuálně definovány.
Pokud je struktura Mapping prázdná, jedná se o dva bajty 0x00 0x00.
Maximální velikost Mappingu (včetně pole délky) je 98 bajtů,
a maximální hodnota pole délky Mappingu je 96.</p>
<h4 id="zašifrovaný-krátký-záznam-požadavku">Zašifrovaný krátký záznam požadavku</h4>
<p>Všechna pole jsou big-endian kromě efemérního veřejného klíče, který je little-endian.</p>
<p>Zakódovaná velikost: 218 bajtů</p>
<pre tabindex="0"><code>bytes    0-15: Zkrácený hash identity hopa
  bytes   16-47: Efemérní veřejný klíč odesílatele X25519
  bytes  48-201: ChaCha20 zašifrovaný ShortBuildRequestRecord
  bytes 202-217: Poly1305 MAC
</code></pre><h3 id="krátký-záznam-odpovědi">Krátký záznam odpovědi</h3>
<h4 id="krátký-nezakódovaný-záznam-odpovědi">Krátký nezakódovaný záznam odpovědi</h4>
<p>Toto je navrhovaná specifikace pro ShortBuildReplyRecord tunelu pro směrovače ECIES-X25519.
Shrnutí změn z <a href="../../../cs/docs/specs/implementation/#tunnel-creation-ecies">Tunnel-Creation-ECIES</a>
:</p>
<ul>
<li>Změnit nezakódovanou délku z 512 na 202 bajtů</li>
<li>Změnit zakódovanou délku z 528 na 218 bajtů</li>
</ul>
<p>Odpovědi ECIES jsou šifrovány pomocí ChaCha20/Poly1305.</p>
<p>Všechna pole jsou big-endian.</p>
<p>Nezakódovaná velikost: 202 bajtů.</p>
<pre tabindex="0"><code>bytes    0-x: Možnosti odpovědi na konstrukci tunelu (Mapping)
  bytes    x-x: další data, jak je naznačeno možnostmi
  bytes  x-200: Náhodné vycpávání (viz níže)
  byte     201: Byte odpovědi
</code></pre><p>Možnosti odpovědi na konstrukci tunelu je struktura Mapping, jak je definováno v <a href="../../../cs/docs/specs/common-structures/">Common</a>
.
Toto je pro budoucí použití. Žádné volby nejsou aktuálně definovány.
Pokud je struktura Mapping prázdná, je to dvoubajtové 0x00 0x00.
Maximální velikost struktury Mapping (včetně pole délky) je 201 bajtů,
a maximální hodnota pole délky Mapping je 199.</p>
<p>Byte odpovědi je jednou z následujících hodnot
jak je definováno v <a href="../../../cs/docs/specs/implementation/#tunnel-creation-ecies">Tunnel-Creation</a>
 pro zabránění rozpoznávání otisků prstů:</p>
<ul>
<li>0x00 (přijmout)</li>
<li>30 (TUNNEL_REJECT_BANDWIDTH)</li>
</ul>
<h4 id="zašifrovaný-krátký-záznam-odpovědi">Zašifrovaný krátký záznam odpovědi</h4>
<p>Zakódovaná velikost: 218 bajtů</p>
<pre tabindex="0"><code>bytes   0-201: ChaCha20 zašifrovaný ShortBuildReplyRecord
  bytes 202-217: Poly1305 MAC
</code></pre><h3 id="kdf">KDF</h3>
<p>Viz níže uvedená sekce KDF.</p>
<h3 id="shorttunnelbuild">ShortTunnelBuild</h3>
<p>I2NP Typ 25</p>
<p>Tato zpráva je odeslána mezi střední přeskoky, OBEP a IBEP (vytvořitel).
Nesmí být odeslána do IBGW (místo toho použijte zabalenou česnekovým InboundTunnelBuild).
Při přijetí OBEP se transformuje na OutboundTunnelBuildReply,
zabalenou česnekem, a odesílá se autorovi.</p>
<pre tabindex="0"><code>+----+----+----+----+----+----+----+----+
  | num| ShortBuildRequestRecords...
  +----+----+----+----+----+----+----+----+

  num ::
         1 byte `Integer`
         Platné hodnoty: 1-8

  velikost záznamu: 218 bajtů
  celková velikost: 1+$num*218
</code></pre><h4 id="poznámky-1">Poznámky</h4>
<ul>
<li>Typický počet záznamů je 4, pro celkovou velikost 873.</li>
</ul>
<h3 id="outboundtunnelbuildreply">OutboundTunnelBuildReply</h3>
<p>I2NP Typ 26</p>
<p>Tato zpráva je odesílána pouze OBEP směrem k IBEP (vytvořiteli) prostřednictvím existujícího příchozího tunelu.
Nesmí být odeslána žádnému jinému přeskoku.
Vždy je zašifrován česnekem.</p>
<pre tabindex="0"><code>+----+----+----+----+----+----+----+----+
  | num|                                  |
  +----+                                  +
  |      ShortBuildReplyRecords...        |
  +----+----+----+----+----+----+----+----+

  num ::
         Celkový počet záznamů,
         1 byte `Integer`
         Platné hodnoty: 1-8

  ShortBuildReplyRecords ::
         Zašifrované záznamy
         délka: num * 218

  velikost zašifrovaného záznamu: 218 bajtů
  celková velikost: 1+$num*218
</code></pre><h4 id="poznámky-2">Poznámky</h4>
<ul>
<li>Typický počet záznamů je 4, pro celkovou velikost 873.</li>
<li>Tato zpráva by měla být šifrována česnekem.</li>
</ul>
<h3 id="kdf-1">KDF</h3>
<p>Používáme ck z Noise stavu po šifrování/odšifrování záznamu o stavbě tunelu
k odvození následujících klíčů: klíč odpovědi, AES klíč vrstvy, AES klíč IV a klíč/tag odpovědi pro OBEP.</p>
<p>Klíč odpovědi:
Na rozdíl od dlouhých záznamů nemůžeme použít levou část ck pro klíč odpovědi, protože to není naposledy a bude použito později.
Klíč odpovědi je používán ke šifrování odpovědi pomocí AEAD/ChaCha20/Poly1305 a ChaCha20 k odpovědi na jiné záznamy.
Oba používají stejný klíč, nonce je pozice záznamu ve zprávě počínaje od 0.</p>
<pre tabindex="0"><code>keydata = HKDF(ck, ZEROLEN, &#34;SMTunnelReplyKey&#34;, 64)
  replyKey = keydata[32:63]
  ck = keydata[0:31]

  Klíč vrstvy:
  Klíč vrstvy je prozatím vždy AES, ale stejný KDF lze použít pro ChaCha20

  keydata = HKDF(ck, ZEROLEN, &#34;SMTunnelLayerKey&#34;, 64)
  layerKey = keydata[32:63]

  Klíč IV pro ne-OBEP záznam:
  ivKey = keydata[0:31]
  protože je poslední

  Klíč IV pro OBEP záznam:
  ck = keydata[0:31]
  keydata = HKDF(ck, ZEROLEN, &#34;TunnelLayerIVKey&#34;, 64)
  ivKey = keydata[32:63]
  ck = keydata[0:31]

  OBEP klíč/tag odpovědi česnekem:
  keydata = HKDF(ck, ZEROLEN, &#34;RGarlicKeyAndTag&#34;, 64)
  replyKey = keydata[32:63]
  replyTag = keydata[0:7]
</code></pre><h2 id="zdůvodnění">Zdůvodnění</h2>
<p>Tento návrh maximalizuje opětovné použití stávajících kryptografických primitiv, protokolů a kódu.</p>
<p>Tento návrh minimalizuje riziko.</p>
<p>ChaCha20 je mírně rychlejší než AES pro malé záznamy, ve zkouškách na Javě.
ChaCha20 se vyhýbá požadavku na velikost dat jako násobek 16.</p>
<h2 id="poznámky-k-implementaci">Poznámky k implementaci</h2>
<ul>
<li>Stejně jako u stávající proměnné zprávy o stavbě tunelu,
zprávy menší než 4 záznamy nejsou doporučovány.
Typické výchozí nastavení je 3 přeskoky.
Příchozí tunely musí být postaveny s dalším záznamem pro
autora, aby poslední přeskok nevěděl, že je poslední.
Takže aby střední přeskoky nevěděly, zda je tunel příchozí nebo odchozí,
odchozí tunely by měly být postaveny se 4 záznamy také.</li>
</ul>
<h2 id="otázky">Otázky</h2>
<h2 id="migrace">Migrace</h2>
<p>Implementace, testování a zavádění bude trvat několik vydání
a přibližně jeden rok. Fáze jsou následující. Přiřazení
každé fáze ke konkrétnímu vydání je TBD a závisí na rychlosti
vývoje.</p>
<p>Podrobnosti implementace a migrace se mohou lišit pro
každou implementaci I2P.</p>
<p>Tvůrce tunelu musí zajistit, že všechny přeskoky ve vytvořeném tunelu jsou ECIES-X25519, A alespoň verze TBD.
Tvůrce tunelu NEUMÍTE být ECIES-X25519; může být ElGamal.
Pokud je však tvůrce ElGamal, odhaluje se nejbližšímu přeskoku jako tvůrce.
Takže v praxi by měly tyto tunely vytvářet pouze ECIES směrovače.</p>
<p>Není nutné, aby stávající tunel OBEP nebo IBGW byl ECIES nebo
nějaké konkrétní verze.
Nové zprávy jsou zabalené česnekem a nejsou viditelné v OBEP nebo IBGW
stávajícího tunelu.</p>
<p>Fáze 1: Implementace, není povolena ve výchozím nastavení</p>
<p>Fáze 2 (další vydání): Povolit ve výchozím nastavení</p>
<p>Neexistují žádné problémy s kompatibilitou zpětně. Nové zprávy mohou být odeslány pouze směrovačům, které je podporují.</p>
<h2 id="příloha">Příloha</h2>
<p>Bez režie česnekem pro nešifrovaný příchozí STBM,
pokud nepoužíváme ITBM:</p>
<pre tabindex="0"><code>Aktuální velikost pro 4 sloty: 4 * 528 + režie = 3 tunelové zprávy

  Konstrukční zpráva pro 4 sloty, aby se vešla do jedné tunelové zprávy, jen ECIES:

  1024
  - 21 fragment hlavičky
  ----
  1003
  - 35 nezabalených ROUTERových pokynů doručení
  ----
  968
  - 16 I2NP hlavička
  ----
  952
  - 1 počet slotů
  ----
  951
  / 4 sloty
  ----
  237 Nová velikost zašifrovaného stavebního záznamu (vs. 528 nyní)
  - 16 trunciovaný hash
  - 32 efemérní klíč
  - 16 MAC
  ----
  173 maximální velikost otevřeného stavebního záznamu (vs. 222 nyní)
</code></pre><p>S režie česnekem pro &lsquo;N&rsquo; vzorec šumu pro šifrování příchozího STBM,
pokud nepoužíváme ITBM:</p>
<pre tabindex="0"><code>Aktuální velikost pro 4 sloty: 4 * 528 + režie = 3 tunelové zprávy

  Česnekem šifrovaná konstrukční zpráva pro 4 sloty, aby se vešla do jedné tunelové zprávy, jen ECIES:

  1024
  - 21 fragment hlavičky
  ----
  1003
  - 35 nezabalených ROUTERových pokynů doručení
  ----
  968
  - 16 I2NP hlavička
  -  4 délka
  ----
  948
  - 32 bajtů efemérního klíče
  ----
  916
  - 7 bajtů DateTime blok
  ----
  909
  - 3 bajty česnekový blok režie
  ----
  906
  - 9 bajtů I2NP hlavička
  ----
  897
  - 1 bajt pokynů doručení ČESNEK LOKÁLNÍ
  ----
  896
  - 16 bajtů Poly1305 MAC
  ----
  880
  - 1 počet slotů
  ----
  879
  / 4 sloty
  ----
  219 Velikost nového zašifrovaného stavebního záznamu (vs. 528 nyní)
  - 16 zkrácený hash
  - 32 efemérní klíč
  - 16 MAC
  ----
  155 maximální velikost otevřeného stavebního záznamu (vs. 222 nyní)
</code></pre><p>Poznámky:</p>
<p>Aktuální velikost otevřeného stavebního záznamu před odstraněním nepotřebné vycpávky: 193</p>
<p>Odstranění úplného hash směrovače a generace klíčů/IV pomocí HKDF by uvolnilo dostatek prostoru pro budoucí možnosti.
Pokud je vše HKDF, požadovaný prostor otevřeného textu je asi 58 bajtů (bez žádných možností).</p>
<p>Česnekem zabalený OTBRM bude o něco menší než česnekem zabalený STBM,
protože dodací pokyny jsou LOKÁLNÍ, ne ROUTER,
neexistuje zahrnutý DATETIME blok a
používá 8-bajtový tag místo 32-bajtového efemérního klíče pro plné &lsquo;N&rsquo; zprávy.</p>
<h2 id="odkazy">Odkazy</h2>

                </article>

                
                <nav class="page-nav">
                    <a href="../../../cs/proposals/" class="page-nav-link">
                        ← Back to Proposals
                    </a>
                    
                    
                    
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                            
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                    <a href="../../../proposals/157-new-tbm.txt" class="page-nav-link" download>
                        Download Source (.txt)
                    </a>
                    
                </nav>
            </div>
        </div>
    </div>
</div>

<style>
.proposals-page {
    min-height: 100vh;
    padding: var(--spacing-xl) 0;
}

.breadcrumbs {
    display: flex;
    align-items: center;
    gap: var(--spacing-xs);
    margin-bottom: var(--spacing-lg);
    font-size: 0.875rem;
    color: var(--color-text-muted);
}

.breadcrumbs a {
    color: var(--color-text-muted);
    text-decoration: none;
    transition: color var(--transition-fast);
}

.breadcrumbs a:hover {
    color: var(--color-primary);
}

.separator {
    color: var(--color-border);
}

.current {
    color: var(--color-text);
}

 
.translation-disclaimer {
    background: #fef3c7;
    border: 1px solid #f59e0b;
    border-radius: var(--radius-md);
    padding: var(--spacing-md);
    margin-bottom: var(--spacing-lg);
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: var(--spacing-md);
    flex-wrap: wrap;
}

.dark .translation-disclaimer {
    background: #78350f;
    border-color: #d97706;
}

.disclaimer-message {
    color: #92400e;
    font-size: 0.875rem;
}

.dark .disclaimer-message {
    color: #fde047;
}

.disclaimer-link {
    color: #92400e;
    font-weight: 600;
    text-decoration: underline;
    white-space: nowrap;
}

.dark .disclaimer-link {
    color: #fde047;
}

 
.proposal-header {
    margin-bottom: var(--spacing-2xl);
}

.proposal-title-section {
    margin-bottom: var(--spacing-lg);
}

.proposal-title {
    font-size: 2.5rem;
    margin: 0 0 var(--spacing-sm) 0;
    color: var(--color-text);
}

.proposal-number {
    font-size: 0.875rem;
    color: var(--color-text-muted);
    font-weight: 600;
}

 
.proposal-meta-box {
    background: var(--color-bg-secondary);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-lg);
    padding: var(--spacing-lg);
}

.proposal-status {
    display: inline-block;
    padding: var(--spacing-xs) var(--spacing-md);
    border-radius: var(--radius-md);
    font-weight: 600;
    font-size: 0.875rem;
    margin-bottom: var(--spacing-md);
    text-transform: uppercase;
    letter-spacing: 0.05em;
}

 
.status-open {
    background: #dbeafe;
    color: #0369a1;
}

.dark .status-open {
    background: #0c4a6e;
    color: #7dd3fc;
}

.status-accepted {
    background: #dbeafe;
    color: #0369a1;
}

.dark .status-accepted {
    background: #0c4a6e;
    color: #7dd3fc;
}

.status-finished {
    background: #dcfce7;
    color: #15803d;
}

.dark .status-finished {
    background: #164e63;
    color: #86efac;
}

.status-closed {
    background: #dcfce7;
    color: #15803d;
}

.dark .status-closed {
    background: #164e63;
    color: #86efac;
}

.status-rejected {
    background: #fee2e2;
    color: #991b1b;
}

.dark .status-rejected {
    background: #7f1d1d;
    color: #fca5a5;
}

.status-draft,
.status-needs-revision,
.status-dead,
.status-needs-research {
    background: #fef3c7;
    color: #92400e;
}

.dark .status-draft,
.dark .status-needs-revision,
.dark .status-dead,
.dark .status-needs-research {
    background: #78350f;
    color: #fde047;
}

.status-meta,
.status-informational,
.status-reserve {
    background: #e9d5ff;
    color: #6b21a8;
}

.dark .status-meta,
.dark .status-informational,
.dark .status-reserve {
    background: #581c87;
    color: #e879f9;
}

 
.proposal-info-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: var(--spacing-md);
    margin-bottom: var(--spacing-lg);
}

.info-item {
    display: flex;
    flex-direction: column;
    gap: var(--spacing-xs);
}

.info-label {
    font-size: 0.75rem;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    color: var(--color-text-muted);
}

.info-value {
    font-size: 0.9375rem;
    color: var(--color-text);
    font-weight: 500;
}

 
.proposal-relationships {
    border-top: 1px solid var(--color-border);
    padding-top: var(--spacing-md);
}

.relationship {
    display: flex;
    gap: var(--spacing-md);
    margin-bottom: var(--spacing-sm);
}

.relationship:last-child {
    margin-bottom: 0;
}

.relationship-label {
    font-weight: 600;
    color: var(--color-text-muted);
    min-width: 120px;
}

.relationship-value {
    color: var(--color-text);
}

 
.proposal-layout {
    display: block;
}

.proposal-layout--with-toc {
    display: grid;
    grid-template-columns: 260px 1fr;
    gap: var(--spacing-2xl);
    align-items: start;
}

 
.proposal-toc-sidebar {
    position: sticky;
    top: 100px;
    max-height: calc(100vh - 120px);
    overflow-y: auto;
}

.toc-nav {
    background: var(--color-bg-secondary);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-lg);
    padding: var(--spacing-md);
}

.toc-header {
    display: flex;
    align-items: center;
    gap: var(--spacing-sm);
    font-weight: 700;
    font-size: 0.875rem;
    color: var(--color-text);
    padding-bottom: var(--spacing-md);
    margin-bottom: var(--spacing-md);
    border-bottom: 1px solid var(--color-border);
}

.toc-content {
    max-height: calc(100vh - 250px);
    overflow-y: auto;
}

.toc-content::-webkit-scrollbar {
    width: 4px;
}

.toc-content::-webkit-scrollbar-track {
    background: transparent;
}

.toc-content::-webkit-scrollbar-thumb {
    background: var(--color-border);
    border-radius: 2px;
}

.toc-content::-webkit-scrollbar-thumb:hover {
    background: var(--color-text-muted);
}

.toc-nav ul {
    list-style: none;
    padding-left: 0;
    margin: 0;
}

.toc-nav li {
    margin-bottom: 0.25rem;
}

.toc-nav ul ul {
    padding-left: var(--spacing-md);
    margin-top: 0.25rem;
}

.toc-nav a {
    color: var(--color-text-secondary);
    text-decoration: none;
    font-size: 0.8125rem;
    display: block;
    padding: 0.25rem 0.5rem;
    border-radius: var(--radius-sm);
    transition: all var(--transition-fast);
    line-height: 1.4;
}

.toc-nav a:hover {
    color: var(--color-primary);
    background: var(--color-bg-tertiary);
}

 
.proposal-main {
    min-width: 0;
}

 
.proposal-content {
    line-height: 1.8;
    color: var(--color-text);
    max-width: 900px;
}

.proposal-content h2 {
    margin-top: var(--spacing-2xl);
    margin-bottom: var(--spacing-md);
    font-size: 1.75rem;
    scroll-margin-top: 100px;
}

.proposal-content h3 {
    margin-top: var(--spacing-xl);
    margin-bottom: var(--spacing-sm);
    font-size: 1.375rem;
    scroll-margin-top: 100px;
}

.proposal-content h4 {
    margin-top: var(--spacing-lg);
    margin-bottom: var(--spacing-xs);
    font-size: 1.125rem;
    scroll-margin-top: 100px;
}

.proposal-content p {
    margin-bottom: var(--spacing-md);
}

.proposal-content ul,
.proposal-content ol {
    margin-bottom: var(--spacing-md);
    padding-left: var(--spacing-xl);
}

.proposal-content li {
    margin-bottom: var(--spacing-xs);
}

.proposal-content code {
    background: var(--color-bg-secondary);
    padding: 0.125rem 0.375rem;
    border-radius: var(--radius-sm);
    font-size: 0.875em;
    font-family: 'Courier New', monospace;
}

.proposal-content pre {
    background: var(--color-bg-secondary);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-md);
    padding: var(--spacing-md);
    overflow-x: auto;
    margin-bottom: var(--spacing-md);
    font-size: 0.875rem;
}

.proposal-content pre code {
    background: none;
    padding: 0;
}

.proposal-content blockquote {
    border-left: 4px solid var(--color-primary);
    padding-left: var(--spacing-md);
    margin-left: 0;
    margin-bottom: var(--spacing-md);
    font-style: italic;
    color: var(--color-text-secondary);
}

.proposal-content a {
    color: var(--color-primary);
    text-decoration: none;
    border-bottom: 1px solid transparent;
    transition: border-color var(--transition-fast);
}

.proposal-content a:hover {
    border-bottom-color: var(--color-primary);
}

.proposal-content table {
    width: 100%;
    border-collapse: collapse;
    margin-bottom: var(--spacing-md);
}

.proposal-content table th {
    background: var(--color-bg-secondary);
    padding: var(--spacing-sm);
    text-align: left;
    font-weight: 600;
    border-bottom: 2px solid var(--color-border);
}

.proposal-content table td {
    padding: var(--spacing-sm);
    border-bottom: 1px solid var(--color-border);
}

.proposal-content img {
    max-width: 100%;
    height: auto;
    border-radius: var(--radius-md);
    border: 1px solid var(--color-border);
    margin: var(--spacing-lg) 0;
    display: block;
}

 
.page-nav {
    margin-top: var(--spacing-2xl);
    padding-top: var(--spacing-xl);
    border-top: 1px solid var(--color-border);
    display: flex;
    gap: var(--spacing-md);
    flex-wrap: wrap;
}

.page-nav-link {
    display: inline-block;
    padding: var(--spacing-md) var(--spacing-lg);
    background: var(--color-bg-secondary);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-md);
    color: var(--color-text);
    text-decoration: none;
    transition: all var(--transition-fast);
}

.page-nav-link:hover {
    border-color: var(--color-primary);
    color: var(--color-primary);
}

 
@media (max-width: 1024px) {
    .proposal-layout--with-toc {
        grid-template-columns: 1fr;
    }

    .proposal-toc-sidebar {
        position: static;
        max-height: none;
        margin-bottom: var(--spacing-xl);
    }

    .toc-content {
        max-height: 300px;
    }
}

@media (max-width: 768px) {
    .proposal-title {
        font-size: 1.75rem;
    }

    .proposal-info-grid {
        grid-template-columns: 1fr;
    }
}
</style>



<script>
document.addEventListener('DOMContentLoaded', function() {
    const tocLinks = document.querySelectorAll('.toc-nav a');
    const headings = [];

    tocLinks.forEach(link => {
        const href = link.getAttribute('href');
        if (href && href.startsWith('#')) {
            const heading = document.getElementById(href.slice(1));
            if (heading) {
                headings.push({ element: heading, link: link });
            }
        }
    });

    function updateActiveLink() {
        const scrollPos = window.scrollY + 120;
        let activeIndex = 0;

        for (let i = 0; i < headings.length; i++) {
            if (headings[i].element.offsetTop <= scrollPos) {
                activeIndex = i;
            }
        }

        tocLinks.forEach(link => link.classList.remove('active'));
        if (headings[activeIndex]) {
            headings[activeIndex].link.classList.add('active');
        }
    }

    window.addEventListener('scroll', updateActiveLink);
    updateActiveLink();
});
</script>
<style>
.toc-nav a.active {
    color: var(--color-primary);
    background: var(--color-bg-tertiary);
    font-weight: 600;
}
</style>



    </main>

    <footer class="site-footer">
    <div class="container">
        <div class="footer-grid">
            <div class="footer-col footer-brand">
                <img src="../../../images/i2plogo_lightmode.svg" alt="I2P Logo" class="footer-logo logo-light" loading="lazy" decoding="async">
                <img src="../../../images/i2plogo_darkmode.svg" alt="I2P Logo" class="footer-logo logo-dark" loading="lazy" decoding="async">
                <p class="footer-tagline">Privacy. Security. Freedom.</p>
                <p class="footer-description">The Invisible Internet Project - A privacy-focused, anonymous network layer</p>

                <div class="footer-social-newsletter">
                    <div class="social-links">
                        <a href="https://mastodon.social/@i2p" target="_blank" rel="noopener" aria-label="Mastodon">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M21.327 8.566c0-4.339-2.843-5.61-2.843-5.61-1.433-.658-3.894-.935-6.451-.956h-.063c-2.557.021-5.016.298-6.45.956 0 0-2.843 1.272-2.843 5.61 0 .993-.019 2.181.012 3.441.103 4.243.778 8.425 4.701 9.463 1.809.479 3.362.579 4.612.51 2.268-.126 3.541-.809 3.541-.809l-.075-1.646s-1.621.511-3.441.449c-1.804-.062-3.707-.194-3.999-2.409a4.523 4.523 0 0 1-.04-.621s1.77.433 4.014.536c1.372.063 2.658-.08 3.965-.236 2.506-.299 4.688-1.843 4.962-3.254.434-2.223.398-5.424.398-5.424zm-3.353 5.59h-2.081V9.057c0-1.075-.452-1.62-1.357-1.62-1 0-1.501.647-1.501 1.927v2.791h-2.069V9.364c0-1.28-.501-1.927-1.502-1.927-.905 0-1.357.546-1.357 1.62v5.099H6.026V8.903c0-1.074.273-1.927.823-2.558.566-.631 1.307-.955 2.228-.955 1.065 0 1.872.409 2.405 1.228l.518.869.519-.869c.533-.819 1.34-1.228 2.405-1.228.92 0 1.662.324 2.228.955.549.631.822 1.484.822 2.558v5.253z"/>
                            </svg>
                        </a>
                        <a href="https://twitter.com/GetI2P" target="_blank" rel="noopener" aria-label="Twitter">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/>
                            </svg>
                        </a>
                        <a href="https://old.reddit.com/r/i2p" target="_blank" rel="noopener" aria-label="Reddit">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M12 0A12 12 0 0 0 0 12a12 12 0 0 0 12 12 12 12 0 0 0 12-12A12 12 0 0 0 12 0zm5.01 4.744c.688 0 1.25.561 1.25 1.249a1.25 1.25 0 0 1-2.498.056l-2.597-.547-.8 3.747c1.824.07 3.48.632 4.674 1.488.308-.309.73-.491 1.207-.491.968 0 1.754.786 1.754 1.754 0 .716-.435 1.333-1.01 1.614a3.111 3.111 0 0 1 .042.52c0 2.694-3.13 4.87-7.004 4.87-3.874 0-7.004-2.176-7.004-4.87 0-.183.015-.366.043-.534A1.748 1.748 0 0 1 4.028 12c0-.968.786-1.754 1.754-1.754.463 0 .898.196 1.207.49 1.207-.883 2.878-1.43 4.744-1.487l.885-4.182a.342.342 0 0 1 .14-.197.35.35 0 0 1 .238-.042l2.906.617a1.214 1.214 0 0 1 1.108-.701zM9.25 12C8.561 12 8 12.562 8 13.25c0 .687.561 1.248 1.25 1.248.687 0 1.248-.561 1.248-1.249 0-.688-.561-1.249-1.249-1.249zm5.5 0c-.687 0-1.248.561-1.248 1.25 0 .687.561 1.248 1.249 1.248.688 0 1.249-.561 1.249-1.249 0-.687-.562-1.249-1.25-1.249zm-5.466 3.99a.327.327 0 0 0-.231.094.33.33 0 0 0 0 .463c.842.842 2.484.913 2.961.913.477 0 2.105-.056 2.961-.913a.361.361 0 0 0 .029-.463.33.33 0 0 0-.464 0c-.547.533-1.684.73-2.512.73-.828 0-1.979-.196-2.512-.73a.326.326 0 0 0-.232-.095z"/>
                            </svg>
                        </a>
                        <a href="https://signal.group/#CjQKIOSUTtxlhbumAKcRsthPFkxkTUrkWcX39bbN6njLEgAIEhCTNsR0KDuiehAXZnkt42v5" target="_blank" rel="noopener" aria-label="Signal" class="signal-link">
                            <img src="../../../images/Signal-Logo-Black.svg" alt="Signal" class="signal-logo signal-logo-light" loading="lazy" decoding="async">
                            <img src="../../../images/Signal-Logo-White.svg" alt="Signal" class="signal-logo signal-logo-dark" loading="lazy" decoding="async">
                        </a>
                    </div>

                    
                    <div class="footer-newsletter-inline">
                        <p class="newsletter-description">Zůstaňte informováni o novinkách I2P:</p>
                        <form action="https://feedback.i2p.net/api/mailing-list/subscribe" method="POST" class="newsletter-form">
                            <input type="email" name="email" placeholder="Zadejte svůj email" required>
                            <button type="submit">Odebírat</button>
                        </form>
                    </div>
                </div>
            </div>

            <div class="footer-col">
                <h3>Rychlé odkazy</h3>
                <ul>
                    <li><a href="../../../cs/financial-support/">Darovat</a></li>
                    <li><a href="../../../cs/docs/overview/intro/">Úvod do I2P</a></li>
                </ul>
            </div>

            <div class="footer-col">
                <h3>Komunita</h3>
                <ul>
                    <li><a href="../../../cs/get-involved/">Zapojte se</a></li>
                    <li><a href="../../../cs/blog/">Blog</a></li>
                    <li><a href="http://i2pforum.net/" target="_blank" rel="noopener">Oficiální fóra</a></li>
                    <li><a href="../../../cs/contact/">Kontaktujte nás</a></li>
                </ul>
            </div>

            <div class="footer-col">
                <h3>Zdroje</h3>
                <ul>
                    <li><a href="https://i2p-metrics.np-tokumei.net/" target="_blank" rel="noopener">I2P Metriky</a></li>
                    <li><a href="../../../cs/papers/">Výzkum</a></li>
                    <li><a href="https://i2pgit.org/" target="_blank" rel="noopener">GitLab</a></li>
                    <li><a href="https://www.stormycloud.org/" target="_blank" rel="noopener">StormyCloud</a></li>
                </ul>
            </div>
        </div>

        <div class="footer-bottom">
            <p class="copyright">&copy; 2025 Projekt Neviditelný Internet. Licencováno pod Creative Commons.</p>
            <div class="footer-links">
                <a href="../../../cs/privacy/">Ochrana soukromí</a>
                <a href="../../../cs/terms/">Podmínky</a>
                <a href="../../../cs/about/media/">Tisk</a>
            </div>
        </div>
    </div>
</footer>


    
    
<div class="modal-overlay" id="poll">
    <div class="modal-content poll-modal-content">
        <a href="#" class="modal-close" aria-label="Zavřít">
            <span aria-hidden="true">&times;</span>
        </a>

        <div class="modal-header">
            <h2>Komunitní anketa</h2>
            <p class="modal-subtitle">Rádi bychom o vás slyšeli</p>
        </div>

        <div class="modal-body">
            
            <iframe 
                id="poll-iframe"
                data-poll-id="2"
                data-api-url="https://feedback.i2p.net"
                frameborder="0"
                scrolling="no"
                style="width: 100%; border: none; min-height: 400px;">
            </iframe>
        </div>

        <div class="modal-footer">
            <p class="modal-disclaimer">
                Váš hlas pomáhá utvářet budoucnost I2P.
            </p>
        </div>
    </div>
</div>


<script>
(function() {
    const iframe = document.getElementById('poll-iframe');
    if (!iframe) return;
    
    const hostname = window.location.hostname;
    let apiUrl = 'https://feedback.i2p.net';
    const pollId = iframe.getAttribute('data-poll-id') || '1';

    
    if (hostname.endsWith('.b32.i2p') || hostname.endsWith('.i2p')) {
        apiUrl = 'http://5kwyynf3eetgqa2nors6ctwo7doi7yu73k7uvypy5eqmm326zkiq.b32.i2p';
    }
    
    else if (hostname.endsWith('.onion')) {
        apiUrl = 'http://gfonxmohvarpmocsvllscsuszdu5rikipm6innvcwq4vpng7zzqmmfyd.onion';
    }

    
    const pollUrl = apiUrl + '/widgets/poll.html?poll_id=' + encodeURIComponent(pollId) + '&api_url=' + encodeURIComponent(apiUrl);
    iframe.src = pollUrl;
})();
</script>



    
    



    
    <script>
        (function () {
            'use strict';
            var hostname = window.location.hostname;
            var baseUrl;

            
            if (hostname.endsWith('.b32.i2p') || hostname.endsWith('.i2p')) {
                baseUrl = 'http://5kwyynf3eetgqa2nors6ctwo7doi7yu73k7uvypy5eqmm326zkiq.b32.i2p';
            } else if (hostname.endsWith('.onion')) {
                baseUrl = 'http://gfonxmohvarpmocsvllscsuszdu5rikipm6innvcwq4vpng7zzqmmfyd.onion';
            } else {
                baseUrl = 'https://feedback.i2p.net';
            }

            window.feedbackBaseUrl = baseUrl;

            
            document.querySelectorAll('[data-api-url]').forEach(function (widget) {
                widget.setAttribute('data-api-url', baseUrl);
            });

            
            document.write('<link rel="stylesheet" href="' + baseUrl + '/widgets/styles.css">');
            
        })();
    </script>

    

    
    
    

    

</body>

</html>
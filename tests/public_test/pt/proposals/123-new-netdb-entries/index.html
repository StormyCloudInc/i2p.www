<!DOCTYPE html>
<html lang="pt" data-theme="light">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <title>Novas Entradas netDB | I2P - O Projeto de Internet Invisível</title>

    <meta name="description" content="The Invisible Internet Project - A privacy-focused, anonymous network layer">
    <meta name="keywords" content="i2p, privacy, anonymity, dark net, encryption, security">

    
    <meta property="og:title" content="Novas Entradas netDB | I2P - O Projeto de Internet Invisível">
    <meta property="og:description" content="The Invisible Internet Project - A privacy-focused, anonymous network layer">
    <meta property="og:type" content="website">
    <meta property="og:url" content="/pt/proposals/123-new-netdb-entries/">

    
    <link rel="icon" type="image/svg+xml" href="../../../images/favicon.svg">
    <link rel="icon" type="image/png" href="../../../images/i2plogo.png" sizes="32x32">

    
    
    
    
    <link rel="stylesheet" href="../../../css/main.min.be6880f32f5ff44e57579da7b11513b973319944ebe38748e3ac7f3268662d18.css" integrity="sha256-vmiA8y9f9E5XV52nsRUTuXMxmUTr44dI46x/MmhmLRg=">
    


    
</head>

<body>
    
    <input type="checkbox" id="theme-toggle-checkbox" class="theme-checkbox" aria-hidden="true">

    
<div class="site-banner" id="site-banner" data-banner-id="banner-3" role="alert" aria-live="polite">
    <div class="container">
        <div class="banner-content">
            <span class="banner-message">Site Beta I2P Agora no Ar Reporte problemas por e-mail para stormycloud@mail.i2p</span>
            
        </div>
        
        <form method="GET" action="../../../api/banner/dismiss" style="display: inline;">
            <input type="hidden" name="id" value="banner-3">
            <button type="submit" class="banner-close" aria-label="Fechar banner" title="Fechar banner">
                <span aria-hidden="true">&times;</span>
            </button>
        </form>
        
    </div>
</div>


    <header class="site-header">
    <div class="container">
        <nav class="main-nav">
            <div class="nav-brand">
                <a href="../../../pt/" class="logo-link">
                    <img src="../../../images/i2plogo_lightmode.svg" alt="I2P Logo" class="logo logo-light">
                    <img src="../../../images/i2plogo_darkmode.svg" alt="I2P Logo" class="logo logo-dark">
                </a>
            </div>

            
            <input type="checkbox" id="mobile-menu-checkbox" class="mobile-menu-checkbox"
                aria-label="Toggle navigation menu">
            <label for="mobile-menu-checkbox" class="mobile-menu-toggle" aria-label="Toggle navigation menu">
                <span class="hamburger"></span>
            </label>

            <div class="nav-menu">
                <ul class="nav-links">
                    <li class="nav-dropdown">
                        <a href="../../../pt/about/" class="">Sobre</a>
                        <ul class="dropdown-menu">
                            <li><a href="../../../pt/about/">Visão Geral</a></li>
                            <li><a href="../../../pt/papers/">Artigos de Pesquisa</a></li>
                            <li><a href="../../../pt/about/media/">Imprensa</a></li>
                            <li><a href="../../../pt/contact/">Contate-nos</a></li>
                        </ul>
                    </li>
                    <li><a href="../../../pt/docs/" class="">Docs</a></li>
                    <li><a href="../../../pt/downloads/" class="">Downloads</a></li>
                    <li><a href="../../../pt/blog/" class="">Blog</a></li>
                    <li class="nav-dropdown">
                        <a href="../../../pt/get-involved/" class="">Participe</a>
                        <ul class="dropdown-menu">
                            <li><a href="../../../pt/get-involved/">Visão Geral</a></li>
                            <li><a href="../../../pt/feedback/">Sugestões de Recursos</a></li>
                        </ul>
                    </li>
                </ul>

                <div class="nav-actions">
                    
                    <div class="language-selector">
                        <button class="language-toggle" aria-label="Select language" title="Language">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none"
                                xmlns="http://www.w3.org/2000/svg">
                                <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2" />
                                <path
                                    d="M2 12h20M12 2a15.3 15.3 0 014 10 15.3 15.3 0 01-4 10 15.3 15.3 0 01-4-10 15.3 15.3 0 014-10z"
                                    stroke="currentColor" stroke-width="2" />
                            </svg>
                            <span class="current-lang">pt</span>
                        </button>
                        <div class="language-dropdown">
                            
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../en/proposals/123-new-netdb-entries/"
                                class="lang-option">Inglês</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../es/proposals/123-new-netdb-entries/"
                                class="lang-option">Espanhol</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../ko/proposals/123-new-netdb-entries/"
                                class="lang-option">Coreano</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../zh/proposals/123-new-netdb-entries/"
                                class="lang-option">Chinês</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../ru/proposals/123-new-netdb-entries/"
                                class="lang-option">Russo</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../cs/proposals/123-new-netdb-entries/"
                                class="lang-option">Tcheco</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../de/proposals/123-new-netdb-entries/"
                                class="lang-option">Alemão</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../fr/proposals/123-new-netdb-entries/"
                                class="lang-option">Francês</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../tr/proposals/123-new-netdb-entries/"
                                class="lang-option">Turco</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../vi/proposals/123-new-netdb-entries/"
                                class="lang-option">Vietnamita</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../hi/proposals/123-new-netdb-entries/"
                                class="lang-option">Hindi</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../ar/proposals/123-new-netdb-entries/"
                                class="lang-option">Árabe</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../pt/proposals/123-new-netdb-entries/"
                                class="lang-option active">Português</a>
                            
                            
                        </div>
                    </div>

                    
                    <label for="theme-toggle-checkbox" class="theme-toggle" aria-label="Toggle dark mode"
                        title="Toggle theme">
                        <svg class="sun-icon" width="20" height="20" viewBox="0 0 20 20" fill="none"
                            xmlns="http://www.w3.org/2000/svg">
                            <circle cx="10" cy="10" r="4" stroke="currentColor" stroke-width="2" />
                            <path
                                d="M10 2V4M10 16V18M18 10H16M4 10H2M15.657 4.343L14.243 5.757M5.757 14.243L4.343 15.657M15.657 15.657L14.243 14.243M5.757 5.757L4.343 4.343"
                                stroke="currentColor" stroke-width="2" stroke-linecap="round" />
                        </svg>
                        <svg class="moon-icon" width="20" height="20" viewBox="0 0 20 20" fill="none"
                            xmlns="http://www.w3.org/2000/svg">
                            <path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"
                                stroke="currentColor" stroke-width="2" stroke-linejoin="round" />
                        </svg>
                    </label>

                    
                    <a href="../../../pt/financial-support/" class="btn btn-primary" id="donate-btn">Donate</a>

                    
                    <a href="../../../pt/downloads/" class="btn btn-primary">Obter I2P</a>
                </div>
            </div>
        </nav>
    </div>
</header>

    <main id="main-content">
        



<div class="proposals-page">
    <div class="container">
        
        <nav class="breadcrumbs">
            <a href="../../../pt/">Home</a>
            <span class="separator">/</span>
            <a href="../../../pt/proposals/">Proposals</a>
            <span class="separator">/</span>
            <span class="current">Novas Entradas netDB</span>
        </nav>

        
<div class="translation-disclaimer" role="note">
    <span class="disclaimer-message">Esta tradução foi gerada usando aprendizado de máquina e pode não ser 100% precisa.</span>
    
    
    <a href="../../../en/proposals/123-new-netdb-entries/" class="disclaimer-link">Ver versão em inglês</a>
    
</div>



        
        <header class="proposal-header">
            <div class="proposal-title-section">
                <h1 class="proposal-title">Novas Entradas netDB</h1>
                <div class="proposal-number">Proposal 123</div>
            </div>

            
            <div class="proposal-meta-box">
                <div class="proposal-status status-abrir">
                    Abrir
                </div>

                
                <div class="proposal-info-grid">
                    
                    <div class="info-item">
                        <span class="info-label">Author</span>
                        <span class="info-value">zzz, str4d, orignal</span>
                    </div>
                    

                    
                    <div class="info-item">
                        <span class="info-label">Created</span>
                        <span class="info-value">2016-01-16</span>
                    </div>
                    

                    
                    <div class="info-item">
                        <span class="info-label">Last Updated</span>
                        <span class="info-value">2020-07-18</span>
                    </div>
                    

                    

                    
                </div>

                
                
                <div class="proposal-relationships">
                    
                    <div class="relationship">
                        <span class="relationship-label">Supercedes:</span>
                        <span class="relationship-value">110, 120, 121, 122</span>
                    </div>
                    
                    
                </div>
                
            </div>
        </header>

        
        <div class="proposal-layout proposal-layout--with-toc">
            
            
            <aside class="proposal-toc-sidebar">
                <nav class="toc-nav">
                    <div class="toc-header">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                            <path d="M4 6h16M4 12h16M4 18h16" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                        </svg>
                        On This Page
                    </div>
                    <div class="toc-content">
                        <nav id="TableOfContents">
  <ul>
    <li><a href="#status">Status</a></li>
    <li><a href="#visão-geral">Visão Geral</a></li>
    <li><a href="#proposta">Proposta</a>
      <ul>
        <li><a href="#goals">Goals</a></li>
        <li><a href="#non-goals--out-of-scope">Non-Goals / Out-of-scope</a></li>
        <li><a href="#justification">Justification</a></li>
        <li><a href="#objetivos">Objetivos</a></li>
        <li><a href="#não-objetivos--fora-de-escopo">Não-Objetivos / Fora de escopo</a></li>
        <li><a href="#justificativa">Justificativa</a></li>
        <li><a href="#tipos-de-dados-netdb">Tipos de Dados NetDB</a></li>
        <li><a href="#notas">Notas</a></li>
      </ul>
    </li>
    <li><a href="#standard-ls2-header">Standard LS2 Header</a>
      <ul>
        <li><a href="#processo-de-lookupstore">Processo de Lookup/Store</a></li>
        <li><a href="#formato">Formato</a></li>
        <li><a href="#considerações-de-privacidadesegurança">Considerações de Privacidade/Segurança</a></li>
        <li><a href="#notes">Notes</a></li>
      </ul>
    </li>
    <li><a href="#new-databaseentry-types">New DatabaseEntry types</a>
      <ul>
        <li><a href="#formato-1">Formato</a></li>
        <li><a href="#justificação">Justificação</a></li>
        <li><a href="#problemas">Problemas</a></li>
        <li><a href="#notas-1">Notas</a></li>
        <li><a href="#new-encryption-issues">New Encryption Issues</a></li>
        <li><a href="#leaseset-2">LeaseSet 2</a></li>
        <li><a href="#formato-2">Formato</a></li>
        <li><a href="#justificação-1">Justificação</a></li>
        <li><a href="#discussão">Discussão</a></li>
        <li><a href="#novos-problemas-de-criptografia">Novos Problemas de Criptografia</a></li>
        <li><a href="#notas-2">Notas</a></li>
        <li><a href="#ls2-criptografado">LS2 Criptografado</a></li>
        <li><a href="#definições">Definições</a></li>
        <li><a href="#formato-3">Formato</a></li>
        <li><a href="#notes-1">Notes</a></li>
        <li><a href="#meta-ls2">Meta LS2</a></li>
        <li><a href="#format">Format</a></li>
        <li><a href="#derivação-de-chave-de-ofuscação">Derivação de Chave de Ofuscação</a></li>
        <li><a href="#service-record">Service Record</a></li>
        <li><a href="#format-1">Format</a></li>
        <li><a href="#notes-2">Notes</a></li>
        <li><a href="#service-list">Service List</a></li>
        <li><a href="#format-2">Format</a></li>
        <li><a href="#notes-3">Notes</a></li>
      </ul>
    </li>
    <li><a href="#common-structures-spec-changes-required">Common Structures Spec Changes Required</a>
      <ul>
        <li><a href="#criptografia-e-processamento">Criptografia e processamento</a></li>
        <li><a href="#new-intermediate-structures">New Intermediate Structures</a></li>
        <li><a href="#new-netdb-types">New NetDB Types</a></li>
        <li><a href="#new-signature-type">New Signature Type</a></li>
      </ul>
    </li>
    <li><a href="#encryption-spec-changes-required">Encryption Spec Changes Required</a></li>
    <li><a href="#i2np-changes-required">I2NP Changes Required</a>
      <ul>
        <li><a href="#database-lookup-message">Database Lookup Message</a></li>
        <li><a href="#changes">Changes</a></li>
        <li><a href="#autorização-por-cliente">Autorização por cliente</a></li>
        <li><a href="#changes-1">Changes</a></li>
      </ul>
    </li>
    <li><a href="#i2cp-changes-required">I2CP Changes Required</a>
      <ul>
        <li><a href="#i2cp-options">I2CP Options</a></li>
        <li><a href="#session-config">Session Config</a></li>
        <li><a href="#encrypted-ls-com-endereços-base-32">Encrypted LS com Endereços Base 32</a></li>
        <li><a href="#ls-criptografada-com-chaves-offline">LS Criptografada com Chaves Offline</a></li>
        <li><a href="#notas-3">Notas</a></li>
        <li><a href="#meta-ls2-1">Meta LS2</a></li>
        <li><a href="#formato-4">Formato</a></li>
        <li><a href="#notas-4">Notas</a></li>
        <li><a href="#registro-de-serviço">Registro de Serviço</a></li>
        <li><a href="#formato-5">Formato</a></li>
        <li><a href="#notas-5">Notas</a></li>
        <li><a href="#lista-de-serviços">Lista de Serviços</a></li>
        <li><a href="#formato-6">Formato</a></li>
        <li><a href="#notas-6">Notas</a></li>
        <li><a href="#format-3">Format</a></li>
        <li><a href="#certificados-de-chave">Certificados de Chave</a></li>
        <li><a href="#novas-estruturas-intermediárias">Novas Estruturas Intermediárias</a></li>
        <li><a href="#novos-tipos-de-netdb">Novos Tipos de NetDB</a></li>
        <li><a href="#novo-tipo-de-assinatura">Novo Tipo de Assinatura</a></li>
        <li><a href="#justification-1">Justification</a></li>
        <li><a href="#usage">Usage</a></li>
        <li><a href="#mensagem-de-consulta-de-base-de-dados">Mensagem de Consulta de Base de Dados</a></li>
        <li><a href="#alterações">Alterações</a></li>
        <li><a href="#mensagem-de-armazenamento-de-base-de-dados">Mensagem de Armazenamento de Base de Dados</a></li>
        <li><a href="#alterações-1">Alterações</a></li>
      </ul>
    </li>
    <li><a href="#private-key-file-changes-required">Private Key File Changes Required</a>
      <ul>
        <li><a href="#changes-2">Changes</a></li>
        <li><a href="#opções-i2cp">Opções I2CP</a></li>
      </ul>
    </li>
    <li><a href="#streaming-changes-required">Streaming Changes Required</a>
      <ul>
        <li><a href="#configuração-de-sessão">Configuração de Sessão</a></li>
        <li><a href="#mensagem-de-solicitação-de-leaseset">Mensagem de Solicitação de LeaseSet</a></li>
      </ul>
    </li>
    <li><a href="#cabeçalho-ls2-padrão">Cabeçalho LS2 Padrão</a>
      <ul>
        <li><a href="#mensagem-de-solicitação-de-leaseset-de-variável">Mensagem de Solicitação de Leaseset de Variável</a></li>
        <li><a href="#criar-mensagem-leaseset2">Criar Mensagem Leaseset2</a></li>
      </ul>
    </li>
    <li><a href="#sam-v3-changes-required">SAM V3 Changes Required</a>
      <ul>
        <li><a href="#justificativa-1">Justificativa</a></li>
        <li><a href="#tipo-de-mensagem">Tipo de Mensagem</a></li>
      </ul>
    </li>
    <li><a href="#bob-changes-required">BOB Changes Required</a></li>
    <li><a href="#publishing-migration-compatibility">Publishing, Migration, Compatibility</a></li>
    <li><a href="#rollout">Rollout</a></li>
    <li><a href="#novos-tipos-de-databaseentry">Novos tipos de DatabaseEntry</a></li>
  </ul>
</nav>
                    </div>
                </nav>
            </aside>
            

            
            <div class="proposal-main">
                <article class="proposal-content">
                    <h2 id="status">Status</h2>
<p>Partes desta proposta estão completas e implementadas na versão 0.9.38 e 0.9.39. As especificações de Common Structures, I2CP, I2NP e outras agora estão atualizadas para refletir as mudanças que são suportadas atualmente.</p>
<p>As partes concluídas ainda estão sujeitas a revisões menores. Outras partes desta proposta ainda estão em desenvolvimento e sujeitas a revisões substanciais.</p>
<p>Service Lookup (tipos 9 e 11) são de baixa prioridade e não programados, e podem ser separados para uma proposta distinta.</p>
<h2 id="visão-geral">Visão Geral</h2>
<p>Esta é uma atualização e agregação das seguintes 4 propostas:</p>
<ul>
<li>110 LS2</li>
<li>120 Meta LS2 para multihoming massivo</li>
<li>121 LS2 Criptografado</li>
<li>122 Busca de serviço não autenticada (anycasting)</li>
</ul>
<p>Essas propostas são em sua maioria independentes, mas para manter a coerência definimos e usamos um formato comum para várias delas.</p>
<p>As seguintes propostas estão de certa forma relacionadas:</p>
<ul>
<li>140 Invisible Multihoming (incompatível com esta proposta)</li>
<li>142 New Crypto Template (para nova criptografia simétrica)</li>
<li>144 ECIES-X25519-AEAD-Ratchet</li>
<li>145 ECIES-P256</li>
<li>146 Red25519</li>
<li>148 EdDSA-BLAKE2b-Ed25519</li>
<li>149 B32 para LS2 Criptografado</li>
<li>150 Garlic Farm Protocol</li>
<li>151 ECDSA Blinding</li>
</ul>
<h2 id="proposta">Proposta</h2>
<p>Esta proposta define 5 novos tipos de DatabaseEntry e o processo para armazená-los e recuperá-los da base de dados da rede, bem como o método para assiná-los e verificar essas assinaturas.</p>
<h3 id="goals">Goals</h3>
<ul>
<li>Compatível com versões anteriores</li>
<li>LS2 utilizável com multihoming de estilo antigo</li>
<li>Nenhuma nova criptografia ou primitivas necessárias para suporte</li>
<li>Manter desacoplamento de criptografia e assinatura; suportar todas as versões atuais e futuras</li>
<li>Habilitar chaves de assinatura offline opcionais</li>
<li>Reduzir precisão de timestamps para reduzir fingerprinting</li>
<li>Habilitar nova criptografia para destinos</li>
<li>Habilitar multihoming massivo</li>
<li>Corrigir múltiplos problemas com LS criptografado existente</li>
<li>Blinding opcional para reduzir visibilidade por floodfills</li>
<li>Criptografado suporta tanto chave única quanto múltiplas chaves revogáveis</li>
<li>Busca de serviços para facilitar busca de outproxies, bootstrap de DHT de aplicação,
e outros usos</li>
<li>Não quebrar nada que dependa de hashes de destino binários de 32 bytes, ex. bittorrent</li>
<li>Adicionar flexibilidade aos leasesets via propriedades, como temos nos routerinfos.</li>
<li>Colocar timestamp publicado e expiração variável no cabeçalho, para que funcione mesmo
se o conteúdo estiver criptografado (não derivar timestamp do lease mais antigo)</li>
<li>Todos os novos tipos vivem no mesmo espaço DHT e mesmas localizações dos leasesets existentes,
para que usuários possam migrar do LS antigo para LS2,
ou mudar entre LS2, Meta e Encrypted,
sem alterar o Destination ou hash.</li>
<li>Um Destination existente pode ser convertido para usar chaves offline,
ou voltar para chaves online, sem alterar o Destination ou hash.</li>
</ul>
<h3 id="non-goals--out-of-scope">Non-Goals / Out-of-scope</h3>
<ul>
<li>Novo algoritmo de rotação DHT ou geração aleatória compartilhada</li>
<li>O tipo específico de nova criptografia e esquema de criptografia ponta-a-ponta
para usar esse novo tipo estaria em uma proposta separada.
Nenhuma nova criptografia é especificada ou discutida aqui.</li>
<li>Nova criptografia para RIs ou construção de tunnel.
Isso estaria em uma proposta separada.</li>
<li>Métodos de criptografia, transmissão e recepção de mensagens I2NP DLM / DSM / DSRM.
Não está mudando.</li>
<li>Como gerar e suportar Meta, incluindo comunicação inter-router de backend, gerenciamento, failover e coordenação.
O suporte pode ser adicionado ao I2CP, ou i2pcontrol, ou um novo protocolo.
Isso pode ou não ser padronizado.</li>
<li>Como realmente implementar e gerenciar tunnels com expiração mais longa, ou cancelar tunnels existentes.
Isso é extremamente difícil, e sem isso, você não pode ter um desligamento gracioso razoável.</li>
<li>Mudanças no modelo de ameaças</li>
<li>Formato de armazenamento offline, ou métodos para armazenar/recuperar/compartilhar os dados.</li>
<li>Detalhes de implementação não são discutidos aqui e ficam a cargo de cada projeto.</li>
</ul>
<h3 id="justification">Justification</h3>
<p>LS2 adiciona campos para alterar o tipo de criptografia e para futuras mudanças de protocolo.</p>
<p>LS2 criptografado corrige várias questões de segurança do LS criptografado existente ao usar criptografia assimétrica de todo o conjunto de leases.</p>
<p>Meta LS2 oferece multihoming flexível, eficiente, eficaz e em larga escala.</p>
<p>Service Record e Service List fornecem serviços anycast como consulta de nomes e inicialização de DHT.</p>
<h3 id="objetivos">Objetivos</h3>
<p>Os números de tipo são usados nas Mensagens I2NP Database Lookup/Store.</p>
<p>A coluna end-to-end refere-se a se as consultas/respostas são enviadas para um Destination em uma Garlic Message.</p>
<p>Tipos existentes:</p>
<table>
  <thead>
      <tr>
          <th>NetDB Data</th>
          <th>Lookup Type</th>
          <th>Store Type</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>any</td>
          <td>0</td>
          <td>any</td>
      </tr>
      <tr>
          <td>LS</td>
          <td>1</td>
          <td>1</td>
      </tr>
      <tr>
          <td>RI</td>
          <td>2</td>
          <td>0</td>
      </tr>
      <tr>
          <td>exploratory</td>
          <td>3</td>
          <td>DSRM</td>
      </tr>
      <tr>
          <td>Novos tipos:</td>
          <td></td>
          <td></td>
      </tr>
  </tbody>
</table>
<table>
  <thead>
      <tr>
          <th>NetDB Data</th>
          <th>Lookup Type</th>
          <th>Store Type</th>
          <th>Std. LS2 Header?</th>
          <th>Sent end-to-end?</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>LS2</td>
          <td>1</td>
          <td>3</td>
          <td>yes</td>
          <td>yes</td>
      </tr>
      <tr>
          <td>Encrypted LS2</td>
          <td>1</td>
          <td>5</td>
          <td>no</td>
          <td>no</td>
      </tr>
      <tr>
          <td>Meta LS2</td>
          <td>1</td>
          <td>7</td>
          <td>yes</td>
          <td>no</td>
      </tr>
      <tr>
          <td>Service Record</td>
          <td>n/a</td>
          <td>9</td>
          <td>yes</td>
          <td>no</td>
      </tr>
      <tr>
          <td>Service List</td>
          <td>4</td>
          <td>11</td>
          <td>no</td>
          <td>no</td>
      </tr>
  </tbody>
</table>
<h3 id="não-objetivos--fora-de-escopo">Não-Objetivos / Fora de escopo</h3>
<ul>
<li>
<p>Os tipos de lookup são atualmente os bits 3-2 na Database Lookup Message.
Quaisquer tipos adicionais exigiriam o uso do bit 4.</p>
</li>
<li>
<p>Todos os tipos de armazenamento são ímpares, pois os bits superiores no campo
de tipo da Database Store Message são ignorados pelos roteadores antigos.
Preferimos que a análise falhe como um LS do que como um RI comprimido.</p>
</li>
<li>
<p>O tipo deve ser explícito ou implícito ou nenhum dos dois nos dados cobertos pela assinatura?</p>
</li>
</ul>
<h3 id="justificativa">Justificativa</h3>
<p>Os tipos 3, 5 e 7 podem ser retornados em resposta a uma consulta de leaseset padrão (tipo 1). O tipo 9 nunca é retornado em resposta a uma consulta. O tipo 11 é retornado em resposta a um novo tipo de consulta de serviço (tipo 11).</p>
<p>Apenas o tipo 3 pode ser enviado em uma mensagem Garlic client-to-client.</p>
<h3 id="tipos-de-dados-netdb">Tipos de Dados NetDB</h3>
<p>Os tipos 3, 7 e 9 têm todos um formato comum::</p>
<p>Cabeçalho LS2 Padrão - conforme definido abaixo</p>
<p>Parte Específica do Tipo   - conforme definido abaixo em cada parte</p>
<p>Assinatura LS2 Padrão:   - Comprimento conforme implícito pelo tipo de assinatura da chave de assinatura</p>
<p>Tipo 5 (Criptografado) não começa com um Destination e tem um formato diferente. Veja abaixo.</p>
<p>Tipo 11 (Lista de Serviços) é uma agregação de vários Registros de Serviço e tem um formato diferente. Veja abaixo.</p>
<h3 id="notas">Notas</h3>
<p>TBD</p>
<h2 id="standard-ls2-header">Standard LS2 Header</h2>
<p>Os tipos 3, 7 e 9 usam o cabeçalho LS2 padrão, especificado abaixo:</p>
<h3 id="processo-de-lookupstore">Processo de Lookup/Store</h3>
<pre tabindex="0"><code>Standard LS2 Header:
  - Type (1 byte)
    Not actually in header, but part of data covered by signature.
    Take from field in Database Store Message.
  - Destination (387+ bytes)
  - Published timestamp (4 bytes, big endian, seconds since epoch, rolls over in 2106)
  - Expires (2 bytes, big endian) (offset from published timestamp in seconds, 18.2 hours max)
  - Flags (2 bytes)
    Bit order: 15 14 ... 3 2 1 0
    Bit 0: If 0, no offline keys; if 1, offline keys
    Bit 1: If 0, a standard published leaseset.
           If 1, an unpublished leaseset. Should not be flooded, published, or
           sent in response to a query. If this leaseset expires, do not query the
           netdb for a new one, unless bit 2 is set.
    Bit 2: If 0, a standard published leaseset.
           If 1, this unencrypted leaseset will be blinded and encrypted when published.
           If this leaseset expires, query the blinded location in the netdb for a new one.
           If this bit is set to 1, set bit 1 to 1 also.
           As of release 0.9.42.
    Bits 3-15: set to 0 for compatibility with future uses
  - If flag indicates offline keys, the offline signature section:
    Expires timestamp (4 bytes, big endian, seconds since epoch, rolls over in 2106)
    Transient sig type (2 bytes, big endian)
    Transient signing public key (length as implied by sig type)
    Signature of expires timestamp, transient sig type, and public key,
    by the destination public key,
    length as implied by destination public key sig type.
    This section can, and should, be generated offline.
</code></pre><h3 id="formato">Formato</h3>
<ul>
<li>
<p>Unpublished/published: Para uso ao enviar um database store ponto-a-ponto,
o router remetente pode desejar indicar que este leaseset não deve ser
enviado para outros. Atualmente usamos heurísticas para manter este estado.</p>
</li>
<li>
<p>Published: Substitui a lógica complexa necessária para determinar a &lsquo;versão&rsquo; do
leaseset. Atualmente, a versão é a expiração do lease que expira por último,
e um router de publicação deve incrementar essa expiração em pelo menos 1ms ao
publicar um leaseset que apenas remove um lease mais antigo.</p>
</li>
<li>
<p>Expires: Permite que uma entrada netDb expire antes da expiração do seu leaseSet com expiração mais tardia. Pode não ser útil para LS2, onde os leaseSets devem manter uma expiração máxima de 11 minutos, mas para outros tipos novos, é necessário (veja Meta LS e Service Record abaixo).</p>
</li>
<li>
<p>As chaves offline são opcionais, para reduzir a complexidade inicial/necessária de implementação.</p>
</li>
</ul>
<h3 id="considerações-de-privacidadesegurança">Considerações de Privacidade/Segurança</h3>
<ul>
<li>
<p>Poderia reduzir ainda mais a precisão do timestamp (10 minutos?) mas teria que adicionar
número de versão. Isso poderia quebrar o multihoming, a menos que tenhamos criptografia que preserva ordem?
Provavelmente não conseguimos fazer sem timestamps completamente.</p>
</li>
<li>
<p>Alternativa: timestamp de 3 bytes (época / 10 minutos), versão de 1 byte, expira em 2 bytes</p>
</li>
<li>
<p>O tipo é explícito ou implícito nos dados / assinatura? Constantes de &ldquo;Domain&rdquo; para assinatura?</p>
</li>
</ul>
<h3 id="notes">Notes</h3>
<ul>
<li>
<p>Os routers não devem publicar um LS mais de uma vez por segundo.
Se o fizerem, devem incrementar artificialmente o timestamp publicado em 1
sobre o LS publicado anteriormente.</p>
</li>
<li>
<p>As implementações de router podem armazenar em cache as chaves transitórias e assinatura para
evitar verificação a cada vez. Em particular, floodfills e routers em
ambas as extremidades de conexões de longa duração poderiam se beneficiar disso.</p>
</li>
<li>
<p>Chaves offline e assinatura são apropriadas apenas para destinos de longa duração,
ou seja, servidores, não clientes.</p>
</li>
</ul>
<h2 id="new-databaseentry-types">New DatabaseEntry types</h2>
<h3 id="formato-1">Formato</h3>
<p>Alterações do LeaseSet existente:</p>
<ul>
<li>Adicionar timestamp de publicação, timestamp de expiração, flags e propriedades</li>
<li>Adicionar tipo de encriptação</li>
<li>Remover chave de revogação</li>
</ul>
<p>Consultar com</p>
<pre><code>Standard LS flag (1)
</code></pre>
<p>Armazenar com</p>
<pre><code>Standard LS2 type (3)
</code></pre>
<p>Armazenar em</p>
<pre><code>Hash of destination
This hash is then used to generate the daily &quot;routing key&quot;, as in LS1
</code></pre>
<p>Expiração típica</p>
<pre><code>10 minutes, as in a regular LS.
</code></pre>
<p>Publicado por</p>
<pre><code>Destination
</code></pre>
<h3 id="justificação">Justificação</h3>
<pre tabindex="0"><code>Standard LS2 Header as specified above

  Standard LS2 Type-Specific Part
  - Properties (Mapping as specified in common structures spec, 2 zero bytes if none)
  - Number of key sections to follow (1 byte, max TBD)
  - Key sections:
    - Encryption type (2 bytes, big endian)
    - Encryption key length (2 bytes, big endian)
      This is explicit, so floodfills can parse LS2 with unknown encryption types.
    - Encryption key (number of bytes specified)
  - Number of lease2s (1 byte)
  - Lease2s (40 bytes each)
    These are leases, but with a 4-byte instead of an 8-byte expiration,
    seconds since the epoch (rolls over in 2106)

  Standard LS2 Signature:
  - Signature
    If flag indicates offline keys, this is signed by the transient pubkey,
    otherwise, by the destination pubkey
    Length as implied by sig type of signing key
    The signature is of everything above.
</code></pre><h3 id="problemas">Problemas</h3>
<ul>
<li>
<p>Properties: Expansão futura e flexibilidade.
Colocado primeiro caso seja necessário para análise dos dados restantes.</p>
</li>
<li>
<p>Vários pares de tipo de criptografia/chave pública são
para facilitar a transição para novos tipos de criptografia. A outra maneira de fazer isso
é publicar vários leaseSets, possivelmente usando os mesmos túneis,
como fazemos agora para destinos DSA e EdDSA.
A identificação do tipo de criptografia recebida em um túnel
pode ser feita com o mecanismo de session tag existente,
e/ou descriptografia de teste usando cada chave. Os comprimentos das mensagens
recebidas também podem fornecer uma pista.</p>
</li>
</ul>
<h3 id="notas-1">Notas</h3>
<p>Esta proposta continua a usar a chave pública no leaseset para a chave de encriptação ponta-a-ponta, e deixa o campo de chave pública no Destination não utilizado, como está agora. O tipo de encriptação não é especificado no certificado de chave do Destination, permanecerá 0.</p>
<p>Uma alternativa rejeitada é especificar o tipo de criptografia no certificado de chave de Destination, usar a chave pública no Destination, e não usar a chave pública no leaseset. Não planejamos fazer isso.</p>
<p>Benefícios do LS2:</p>
<ul>
<li>A localização da chave pública real não muda.</li>
<li>O tipo de criptografia, ou chave pública, pode mudar sem alterar o Destination.</li>
<li>Remove o campo de revogação não utilizado</li>
<li>Compatibilidade básica com outros tipos de DatabaseEntry nesta proposta</li>
<li>Permite múltiplos tipos de criptografia</li>
</ul>
<p>Desvantagens do LS2:</p>
<ul>
<li>Localização da chave pública e tipo de criptografia difere do RouterInfo</li>
<li>Mantém chave pública não utilizada no leaseset</li>
<li>Requer implementação em toda a rede; como alternativa, tipos experimentais
de criptografia podem ser usados, se permitido pelos floodfills
(mas veja as propostas relacionadas 136 e 137 sobre suporte para tipos de assinatura experimentais).
A proposta alternativa pode ser mais fácil de implementar e testar para tipos de criptografia experimentais.</li>
</ul>
<h3 id="new-encryption-issues">New Encryption Issues</h3>
<p>Parte disso está fora do escopo desta proposta, mas colocando notas aqui por enquanto, já que ainda não temos uma proposta de criptografia separada. Veja também as propostas ECIES 144 e 145.</p>
<ul>
<li>
<p>O tipo de criptografia representa a combinação
de curva, comprimento da chave e esquema ponta a ponta,
incluindo KDF e MAC, se houver.</p>
</li>
<li>
<p>Incluímos um campo de comprimento de chave, para que o LS2 seja
analisável e verificável pelo floodfill mesmo para tipos de criptografia desconhecidos.</p>
</li>
<li>
<p>O primeiro novo tipo de criptografia a ser proposto será
provavelmente ECIES/X25519. Como será usado end-to-end
(seja uma versão ligeiramente modificada do ElGamal/AES+SessionTag
ou algo completamente novo, por exemplo ChaCha/Poly) será especificado
em uma ou mais propostas separadas.
Veja também as propostas ECIES 144 e 145.</p>
</li>
</ul>
<h3 id="leaseset-2">LeaseSet 2</h3>
<ul>
<li>
<p>Expiração de 8 bytes em leases alterada para 4 bytes.</p>
</li>
<li>
<p>Se algum dia implementarmos revogação, podemos fazê-lo com um campo expires de zero,
ou zero leases, ou ambos. Não há necessidade de uma chave de revogação separada.</p>
</li>
<li>
<p>As chaves de encriptação estão ordenadas por preferência do servidor, a mais preferida primeiro.
O comportamento padrão do cliente é selecionar a primeira chave com
um tipo de encriptação suportado. Os clientes podem usar outros algoritmos de seleção
baseados no suporte de encriptação, desempenho relativo e outros fatores.</p>
</li>
</ul>
<h3 id="formato-2">Formato</h3>
<p>Objetivos:</p>
<ul>
<li>Adicionar blinding</li>
<li>Permitir múltiplos tipos de assinatura</li>
<li>Não exigir quaisquer primitivos criptográficos novos</li>
<li>Opcionalmente criptografar para cada destinatário, revogável</li>
<li>Suportar criptografia apenas de Standard LS2 e Meta LS2</li>
</ul>
<p>LS2 criptografado nunca é enviado em uma mensagem garlic ponto-a-ponto. Use o LS2 padrão conforme descrito acima.</p>
<p>Mudanças do LeaseSet criptografado existente:</p>
<ul>
<li>Criptografar tudo por segurança</li>
<li>Criptografar de forma segura, não apenas com AES</li>
<li>Criptografar para cada destinatário</li>
</ul>
<p>Consultar com</p>
<pre><code>Standard LS flag (1)
</code></pre>
<p>Armazenar com</p>
<pre><code>Encrypted LS2 type (5)
</code></pre>
<p>Armazenar em</p>
<pre><code>Hash of blinded sig type and blinded public key
Two byte sig type (big endian, e.g. 0x000b) || blinded public key
This hash is then used to generate the daily &quot;routing key&quot;, as in LS1
</code></pre>
<p>Expiração típica</p>
<pre><code>10 minutes, as in a regular LS, or hours, as in a meta LS.
</code></pre>
<p>Publicado por</p>
<pre><code>Destination
</code></pre>
<h3 id="justificação-1">Justificação</h3>
<p>Definimos as seguintes funções correspondentes aos blocos de construção criptográficos utilizados para LS2 criptografado:</p>
<p>CSRNG(n)</p>
<pre><code>n-byte output from a cryptographically-secure random number generator.

In addition to the requirement of CSRNG being cryptographically-secure (and thus
suitable for generating key material), it MUST be safe
for some n-byte output to be used for key material when the byte sequences immediately
preceding and following it are exposed on the network (such as in a salt, or encrypted
padding). Implementations that rely on a potentially-untrustworthy source should hash
any output that is to be exposed on the network. See [PRNG references](http://projectbullrun.org/dual-ec/ext-rand.html) and [Tor dev discussion](https://lists.torproject.org/pipermail/tor-dev/2015-November/009954.html).
</code></pre>
<p>H(p, d)</p>
<pre><code>SHA-256 hash function that takes a personalization string p and data d, and
produces an output of length 32 bytes.

Use SHA-256 as follows::

    H(p, d) := SHA-256(p || d)
</code></pre>
<p>STREAM</p>
<pre><code>The ChaCha20 stream cipher as specified in [RFC 7539 Section 2.4](https://tools.ietf.org/html/rfc7539#section-2.4), with the initial counter
set to 1. S_KEY_LEN = 32 and S_IV_LEN = 12.

ENCRYPT(k, iv, plaintext)
    Encrypts plaintext using the cipher key k, and nonce iv which MUST be unique for
    the key k. Returns a ciphertext that is the same size as the plaintext.

    The entire ciphertext must be indistinguishable from random if the key is secret.

DECRYPT(k, iv, ciphertext)
    Decrypts ciphertext using the cipher key k, and nonce iv. Returns the plaintext.
</code></pre>
<p>SIG</p>
<pre><code>The RedDSA signature scheme (corresponding to SigType 11) with key blinding.
It has the following functions:

DERIVE_PUBLIC(privkey)
    Returns the public key corresponding to the given private key.

SIGN(privkey, m)
    Returns a signature by the private key privkey over the given message m.

VERIFY(pubkey, m, sig)
    Verifies the signature sig against the public key pubkey and message m. Returns
    true if the signature is valid, false otherwise.

It must also support the following key blinding operations:

GENERATE_ALPHA(data, secret)
    Generate alpha for those who know the data and an optional secret.
    The result must be identically distributed as the private keys.

BLIND_PRIVKEY(privkey, alpha)
    Blinds a private key, using a secret alpha.

BLIND_PUBKEY(pubkey, alpha)
    Blinds a public key, using a secret alpha.
    For a given keypair (privkey, pubkey) the following relationship holds::

        BLIND_PUBKEY(pubkey, alpha) ==
        DERIVE_PUBLIC(BLIND_PRIVKEY(privkey, alpha))
</code></pre>
<p>DH</p>
<pre><code>X25519 public key agreement system. Private keys of 32 bytes, public keys of 32
bytes, produces outputs of 32 bytes. It has the following
functions:

GENERATE_PRIVATE()
    Generates a new private key.

DERIVE_PUBLIC(privkey)
    Returns the public key corresponding to the given private key.

DH(privkey, pubkey)
    Generates a shared secret from the given private and public keys.
</code></pre>
<p>HKDF(salt, ikm, info, n)</p>
<pre><code>A cryptographic key derivation function which takes some input key material ikm (which
should have good entropy but is not required to be a uniformly random string), a salt
of length 32 bytes, and a context-specific 'info' value, and produces an output
of n bytes suitable for use as key material.

Use HKDF as specified in [RFC 5869](https://tools.ietf.org/html/rfc5869), using the HMAC hash function SHA-256
as specified in [RFC 2104](https://tools.ietf.org/html/rfc2104). This means that SALT_LEN is 32 bytes max.
</code></pre>
<h3 id="discussão">Discussão</h3>
<p>O formato LS2 criptografado consiste em três camadas aninhadas:</p>
<ul>
<li>Uma camada externa contendo as informações de texto simples necessárias para armazenamento e recuperação.</li>
<li>Uma camada intermediária que gerencia a autenticação do cliente.</li>
<li>Uma camada interna que contém os dados reais do LS2.</li>
</ul>
<p>O formato geral é semelhante a::</p>
<pre><code>Layer 0 data + Enc(layer 1 data + Enc(layer 2 data)) + Signature
</code></pre>
<p>Note que LS2 criptografado é ofuscado. O Destination não está no cabeçalho. A localização de armazenamento DHT é SHA-256(tipo de assinatura || chave pública ofuscada), e rotacionada diariamente.</p>
<p>NÃO usa o cabeçalho LS2 padrão especificado acima.</p>
<h4 id="layer-0-outer">Layer 0 (outer)</h4>
<p>Tipo</p>
<pre><code>1 byte

Not actually in header, but part of data covered by signature.
Take from field in Database Store Message.
</code></pre>
<p>Tipo de Assinatura de Chave Pública Cega</p>
<pre><code>2 bytes, big endian
This will always be type 11, identifying a Red25519 blinded key.
</code></pre>
<p>Chave Pública Cega</p>
<pre><code>Length as implied by sig type
</code></pre>
<p>Carimbo de data/hora de publicação</p>
<pre><code>4 bytes, big endian

Seconds since epoch, rolls over in 2106
</code></pre>
<p>Expira</p>
<pre><code>2 bytes, big endian

Offset from published timestamp in seconds, 18.2 hours max
</code></pre>
<p>Flags</p>
<pre><code>2 bytes

Bit order: 15 14 ... 3 2 1 0

Bit 0: If 0, no offline keys; if 1, offline keys

Other bits: set to 0 for compatibility with future uses
</code></pre>
<p>Dados de chave transitória</p>
<pre><code>Present if flag indicates offline keys

Expires timestamp
    4 bytes, big endian

    Seconds since epoch, rolls over in 2106

Transient sig type
    2 bytes, big endian

Transient signing public key
    Length as implied by sig type

Signature
    Length as implied by blinded public key sig type

    Over expires timestamp, transient sig type, and transient public key.

    Verified with the blinded public key.
</code></pre>
<p>lenOuterCiphertext</p>
<pre><code>2 bytes, big endian
</code></pre>
<p>outerCiphertext</p>
<pre><code>lenOuterCiphertext bytes

Encrypted layer 1 data. See below for key derivation and encryption algorithms.
</code></pre>
<p>Assinatura</p>
<pre><code>Length as implied by sig type of the signing key used

The signature is of everything above.

If the flag indicates offline keys, the signature is verified with the transient
public key. Otherwise, the signature is verified with the blinded public key.
</code></pre>
<h4 id="layer-1-middle">Layer 1 (middle)</h4>
<p>Bandeiras</p>
<pre><code>1 byte

Bit order: 76543210

Bit 0: 0 for everybody, 1 for per-client, auth section to follow

Bits 3-1: Authentication scheme, only if bit 0 is set to 1 for per-client, otherwise 000
          000: DH client authentication (or no per-client authentication)
          001: PSK client authentication

Bits 7-4: Unused, set to 0 for future compatibility
</code></pre>
<p>Dados de autenticação do cliente DH</p>
<pre><code>Present if flag bit 0 is set to 1 and flag bits 3-1 are set to 000.

ephemeralPublicKey
    32 bytes

clients
    2 bytes, big endian

    Number of authClient entries to follow, 40 bytes each

authClient
    Authorization data for a single client.
    See below for the per-client authorization algorithm.

    clientID_i
        8 bytes

    clientCookie_i
        32 bytes
</code></pre>
<p>Dados de autenticação de cliente PSK</p>
<pre><code>Present if flag bit 0 is set to 1 and flag bits 3-1 are set to 001.

authSalt
    32 bytes

clients
    2 bytes, big endian

    Number of authClient entries to follow, 40 bytes each

authClient
    Authorization data for a single client.
    See below for the per-client authorization algorithm.

    clientID_i
        8 bytes

    clientCookie_i
        32 bytes
</code></pre>
<p>innerCiphertext</p>
<pre><code>Length implied by lenOuterCiphertext (whatever data remains)

Encrypted layer 2 data. See below for key derivation and encryption algorithms.
</code></pre>
<h4 id="layer-2-inner">Layer 2 (inner)</h4>
<p>Tipo</p>
<pre><code>1 byte

Either 3 (LS2) or 7 (Meta LS2)
</code></pre>
<p>Dados</p>
<pre><code>LeaseSet2 data for the given type.

Includes the header and signature.
</code></pre>
<h3 id="novos-problemas-de-criptografia">Novos Problemas de Criptografia</h3>
<p>Utilizamos o seguinte esquema para key blinding, baseado em Ed25519 e <a href="https://github.com/zcash/zips/tree/master/protocol/protocol.pdf">ZCash RedDSA</a>
. As assinaturas Re25519 são sobre a curva Ed25519, usando SHA-512 para o hash.</p>
<p>Não utilizamos o <a href="https://spec.torproject.org/rend-spec-v3">Tor&rsquo;s rend-spec-v3.txt appendix A.2</a>
, que tem objetivos de design similares, porque suas chaves públicas cegas podem estar fora do subgrupo de ordem prima, com implicações de segurança desconhecidas.</p>
<h4 id="goals-1">Goals</h4>
<ul>
<li>A chave pública de assinatura no destino não cegado deve ser
Ed25519 (tipo de assinatura 7) ou Red25519 (tipo de assinatura 11);
nenhum outro tipo de assinatura é suportado</li>
<li>Se a chave pública de assinatura estiver offline, a chave pública de assinatura transitória também deve ser Ed25519</li>
<li>O cegamento é computacionalmente simples</li>
<li>Usar primitivas criptográficas existentes</li>
<li>Chaves públicas cegadas não podem ser descegadas</li>
<li>Chaves públicas cegadas devem estar na curva Ed25519 e subgrupo de ordem prima</li>
<li>Deve conhecer a chave pública de assinatura do destino
(destino completo não é necessário) para derivar a chave pública cegada</li>
<li>Opcionalmente fornecer um segredo adicional necessário para derivar a chave pública cegada</li>
</ul>
<h4 id="security">Security</h4>
<p>A segurança de um esquema de blinding requer que a distribuição de alpha seja a mesma das chaves privadas não blindadas. No entanto, quando blindamos uma chave privada Ed25519 (sig type 7) para uma chave privada Red25519 (sig type 11), a distribuição é diferente. Para atender aos requisitos da <a href="https://github.com/zcash/zips/tree/master/protocol/protocol.pdf">seção 4.1.6.1 do zcash</a>
, Red25519 (sig type 11) deveria ser usado também para as chaves não blindadas, de modo que &ldquo;a combinação de uma chave pública re-randomizada e assinatura(s) sob essa chave não revelem a chave da qual foi re-randomizada.&rdquo; Permitimos o tipo 7 para destinos existentes, mas recomendamos o tipo 11 para novos destinos que serão criptografados.</p>
<h4 id="definitions">Definitions</h4>
<p>B</p>
<pre><code>The Ed25519 base point (generator) 2^255 - 19 as in [Ed25519](http://cr.yp.to/papers.html#ed25519)
</code></pre>
<p>L</p>
<pre><code>The Ed25519 order 2^252 + 27742317777372353535851937790883648493
as in [Ed25519](http://cr.yp.to/papers.html#ed25519)
</code></pre>
<p>DERIVE_PUBLIC(a)</p>
<pre><code>Convert a private key to public, as in Ed25519 (mulitply by G)
</code></pre>
<p>alpha</p>
<pre><code>A 32-byte random number known to those who know the destination.
</code></pre>
<p>GENERATE_ALPHA(destination, date, secret)</p>
<pre><code>Generate alpha for the current date, for those who know the destination and the secret.
The result must be identically distributed as Ed25519 private keys.
</code></pre>
<p>a</p>
<pre><code>The unblinded 32-byte EdDSA or RedDSA signing private key used to sign the destination
</code></pre>
<p>A</p>
<pre><code>The unblinded 32-byte EdDSA or RedDSA signing public key in the destination,
= DERIVE_PUBLIC(a), as in Ed25519
</code></pre>
<p>a&rsquo;</p>
<pre><code>The blinded 32-byte EdDSA signing private key used to sign the encrypted leaseset
This is a valid EdDSA private key.
</code></pre>
<p>A'</p>
<pre><code>The blinded 32-byte EdDSA signing public key in the Destination,
may be generated with DERIVE_PUBLIC(a'), or from A and alpha.
This is a valid EdDSA public key, on the curve and on the prime-order subgroup.
</code></pre>
<p>LEOS2IP(x)</p>
<pre><code>Flip the order of the input bytes to little-endian
</code></pre>
<p>H*(x)</p>
<pre><code>32 bytes = (LEOS2IP(SHA512(x))) mod B, same as in Ed25519 hash-and-reduce
</code></pre>
<h4 id="blinding-calculations">Blinding Calculations</h4>
<p>Uma nova chave secreta alpha e chaves cegas devem ser geradas a cada dia (UTC). A chave secreta alpha e as chaves cegas são calculadas da seguinte forma.</p>
<p>GENERATE_ALPHA(destination, date, secret), para todas as partes:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>// GENERATE_ALPHA(destination, date, secret)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  // secret is optional, else zero-length
</span></span><span style="display:flex;"><span>  A = destination&#39;s signing public key
</span></span><span style="display:flex;"><span>  stA = signature type of A, 2 bytes big endian (0x0007 or 0x000b)
</span></span><span style="display:flex;"><span>  stA&#39; = signature type of blinded public key A&#39;, 2 bytes big endian (0x000b)
</span></span><span style="display:flex;"><span>  keydata = A || stA || stA&#39;
</span></span><span style="display:flex;"><span>  datestring = 8 bytes ASCII YYYYMMDD from the current date UTC
</span></span><span style="display:flex;"><span>  secret = UTF-8 encoded string
</span></span><span style="display:flex;"><span>  seed = HKDF(H(&#34;I2PGenerateAlpha&#34;, keydata), datestring || secret, &#34;i2pblinding1&#34;, 64)
</span></span><span style="display:flex;"><span>  // treat seed as a 64 byte little-endian value
</span></span><span style="display:flex;"><span>  alpha = seed mod L
</span></span></code></pre></div><p>BLIND_PRIVKEY(), para o proprietário publicando o leaseSet:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>// BLIND_PRIVKEY()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  alpha = GENERATE_ALPHA(destination, date, secret)
</span></span><span style="display:flex;"><span>  // If for a Ed25519 private key (type 7)
</span></span><span style="display:flex;"><span>  seed = destination&#39;s signing private key
</span></span><span style="display:flex;"><span>  a = left half of SHA512(seed) and clamped as usual for Ed25519
</span></span><span style="display:flex;"><span>  // else, for a Red25519 private key (type 11)
</span></span><span style="display:flex;"><span>  a = destination&#39;s signing private key
</span></span><span style="display:flex;"><span>  // Addition using scalar arithmentic
</span></span><span style="display:flex;"><span>  blinded signing private key = a&#39; = BLIND_PRIVKEY(a, alpha) = (a + alpha) mod L
</span></span><span style="display:flex;"><span>  blinded signing public key = A&#39; = DERIVE_PUBLIC(a&#39;)
</span></span></code></pre></div><p>BLIND_PUBKEY(), para os clientes que recuperam o leaseset:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>// BLIND_PUBKEY()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  alpha = GENERATE_ALPHA(destination, date, secret)
</span></span><span style="display:flex;"><span>  A = destination&#39;s signing public key
</span></span><span style="display:flex;"><span>  // Addition using group elements (points on the curve)
</span></span><span style="display:flex;"><span>  blinded public key = A&#39; = BLIND_PUBKEY(A, alpha) = A + DERIVE_PUBLIC(alpha)
</span></span></code></pre></div><p>Ambos os métodos de calcular A&rsquo; produzem o mesmo resultado, conforme necessário.</p>
<h4 id="signing">Signing</h4>
<p>O leaseset não-cego é assinado pela chave privada de assinatura Ed25519 ou Red25519 não-cega e verificado com a chave pública de assinatura Ed25519 ou Red25519 não-cega (tipos de assinatura 7 ou 11) como de costume.</p>
<p>Se a chave pública de assinatura estiver offline, o leaseset não ofuscado é assinado pela chave privada de assinatura transitória Ed25519 ou Red25519 não ofuscada e verificado com a chave pública de assinatura transitória Ed25519 ou Red25519 não ofuscada (tipos de assinatura 7 ou 11) como de costume. Veja abaixo as notas adicionais sobre chaves offline para leasesets criptografados.</p>
<p>Para a assinatura do leaseset criptografado, usamos Red25519, baseado em <a href="https://github.com/zcash/zips/tree/master/protocol/protocol.pdf">RedDSA</a>
 para assinar e verificar com chaves ofuscadas. As assinaturas Red25519 são sobre a curva Ed25519, usando SHA-512 para o hash.</p>
<p>Red25519 é idêntico ao Ed25519 padrão, exceto conforme especificado abaixo.</p>
<h4 id="signverify-calculations">Sign/Verify Calculations</h4>
<p>A porção externa do leaseset criptografado usa chaves e assinaturas Red25519.</p>
<p>Red25519 é quase idêntico ao Ed25519. Existem duas diferenças:</p>
<p>As chaves privadas Red25519 são geradas a partir de números aleatórios e depois devem ser reduzidas mod L, onde L é definido acima. As chaves privadas Ed25519 são geradas a partir de números aleatórios e depois &ldquo;fixadas&rdquo; usando mascaramento bitwise nos bytes 0 e 31. Isso não é feito para Red25519. As funções GENERATE_ALPHA() e BLIND_PRIVKEY() definidas acima geram chaves privadas Red25519 adequadas usando mod L.</p>
<p>No Red25519, o cálculo de r para assinatura usa dados aleatórios adicionais e utiliza o valor da chave pública em vez do hash da chave privada. Devido aos dados aleatórios, cada assinatura Red25519 é diferente, mesmo ao assinar os mesmos dados com a mesma chave.</p>
<p>Assinatura:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>T = 80 random bytes
</span></span><span style="display:flex;"><span>  r = H*(T || publickey || message)
</span></span><span style="display:flex;"><span>  // rest is the same as in Ed25519
</span></span></code></pre></div><p>Verificação:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>// same as in Ed25519
</span></span></code></pre></div><h3 id="notas-2">Notas</h3>
<h4 id="derivation-of-subcredentials">Derivation of subcredentials</h4>
<p>Como parte do processo de blinding, precisamos garantir que um LS2 criptografado só possa ser descriptografado por alguém que conheça a chave pública de assinatura da Destination correspondente. A Destination completa não é necessária. Para conseguir isso, derivamos uma credencial da chave pública de assinatura:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>A = destination&#39;s signing public key
</span></span><span style="display:flex;"><span>  stA = signature type of A, 2 bytes big endian (0x0007 or 0x000b)
</span></span><span style="display:flex;"><span>  stA&#39; = signature type of A&#39;, 2 bytes big endian (0x000b)
</span></span><span style="display:flex;"><span>  keydata = A || stA || stA&#39;
</span></span><span style="display:flex;"><span>  credential = H(&#34;credential&#34;, keydata)
</span></span></code></pre></div><p>A string de personalização garante que a credencial não colida com qualquer hash usado como chave de busca DHT, como o hash de Destination simples.</p>
<p>Para uma determinada chave ofuscada, podemos então derivar uma subcredencial:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>subcredential = H(&#34;subcredential&#34;, credential || blindedPublicKey)
</span></span></code></pre></div><p>A subcredencial é incluída nos processos de derivação de chave abaixo, o que vincula essas chaves ao conhecimento da chave pública de assinatura do Destination.</p>
<h4 id="layer-1-encryption">Layer 1 encryption</h4>
<p>Primeiro, a entrada para o processo de derivação de chave é preparada:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>outerInput = subcredential || publishedTimestamp
</span></span></code></pre></div><p>Em seguida, um salt aleatório é gerado:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>outerSalt = CSRNG(32)
</span></span></code></pre></div><p>Então a chave usada para criptografar a camada 1 é derivada:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>keys = HKDF(outerSalt, outerInput, &#34;ELS2_L1K&#34;, 44)
</span></span><span style="display:flex;"><span>  outerKey = keys[0:31]
</span></span><span style="display:flex;"><span>  outerIV = keys[32:43]
</span></span></code></pre></div><p>Finalmente, o texto simples da camada 1 é criptografado e serializado:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>outerCiphertext = outerSalt || ENCRYPT(outerKey, outerIV, outerPlaintext)
</span></span></code></pre></div><h4 id="layer-1-decryption">Layer 1 decryption</h4>
<p>O salt é analisado a partir do texto cifrado da camada 1:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>outerSalt = outerCiphertext[0:31]
</span></span></code></pre></div><p>Então a chave usada para criptografar a camada 1 é derivada:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>outerInput = subcredential || publishedTimestamp
</span></span><span style="display:flex;"><span>  keys = HKDF(outerSalt, outerInput, &#34;ELS2_L1K&#34;, 44)
</span></span><span style="display:flex;"><span>  outerKey = keys[0:31]
</span></span><span style="display:flex;"><span>  outerIV = keys[32:43]
</span></span></code></pre></div><p>Finalmente, o texto cifrado da camada 1 é descriptografado:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>outerPlaintext = DECRYPT(outerKey, outerIV, outerCiphertext[32:end])
</span></span></code></pre></div><h4 id="layer-2-encryption">Layer 2 encryption</h4>
<p>Quando a autorização de cliente está habilitada, <code>authCookie</code> é calculado conforme descrito abaixo. Quando a autorização de cliente está desabilitada, <code>authCookie</code> é o array de bytes de comprimento zero.</p>
<p>A criptografia procede de forma similar à camada 1:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>innerInput = authCookie || subcredential || publishedTimestamp
</span></span><span style="display:flex;"><span>  innerSalt = CSRNG(32)
</span></span><span style="display:flex;"><span>  keys = HKDF(innerSalt, innerInput, &#34;ELS2_L2K&#34;, 44)
</span></span><span style="display:flex;"><span>  innerKey = keys[0:31]
</span></span><span style="display:flex;"><span>  innerIV = keys[32:43]
</span></span><span style="display:flex;"><span>  innerCiphertext = innerSalt || ENCRYPT(innerKey, innerIV, innerPlaintext)
</span></span></code></pre></div><h4 id="layer-2-decryption">Layer 2 decryption</h4>
<p>Quando a autorização de cliente está habilitada, <code>authCookie</code> é calculado como descrito abaixo. Quando a autorização de cliente está desabilitada, <code>authCookie</code> é o array de bytes de comprimento zero.</p>
<p>A descriptografia procede de maneira similar à camada 1:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>innerInput = authCookie || subcredential || publishedTimestamp
</span></span><span style="display:flex;"><span>  innerSalt = innerCiphertext[0:31]
</span></span><span style="display:flex;"><span>  keys = HKDF(innerSalt, innerInput, &#34;ELS2_L2K&#34;, 44)
</span></span><span style="display:flex;"><span>  innerKey = keys[0:31]
</span></span><span style="display:flex;"><span>  innerIV = keys[32:43]
</span></span><span style="display:flex;"><span>  innerPlaintext = DECRYPT(innerKey, innerIV, innerCiphertext[32:end])
</span></span></code></pre></div><h3 id="ls2-criptografado">LS2 Criptografado</h3>
<p>Quando a autorização de cliente está habilitada para um Destination, o servidor mantém uma lista de clientes que estão sendo autorizados a descriptografar os dados LS2 criptografados. Os dados armazenados por cliente dependem do mecanismo de autorização e incluem alguma forma de material de chave que cada cliente gera e envia para o servidor através de um mecanismo seguro fora da banda.</p>
<p>Existem duas alternativas para implementar autorização por cliente:</p>
<h4 id="dh-client-authorization">DH client authorization</h4>
<p>Cada cliente gera um par de chaves DH <code>[csk_i, cpk_i]</code>, e envia a chave pública <code>cpk_i</code> para o servidor.</p>
<p>Processamento do servidor
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</p>
<p>O servidor gera um novo <code>authCookie</code> e um par de chaves DH efêmero:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>authCookie = CSRNG(32)
</span></span><span style="display:flex;"><span>  esk = GENERATE_PRIVATE()
</span></span><span style="display:flex;"><span>  epk = DERIVE_PUBLIC(esk)
</span></span></code></pre></div><p>Então, para cada cliente autorizado, o servidor criptografa <code>authCookie</code> para sua chave pública:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>sharedSecret = DH(esk, cpk_i)
</span></span><span style="display:flex;"><span>  authInput = sharedSecret || cpk_i || subcredential || publishedTimestamp
</span></span><span style="display:flex;"><span>  okm = HKDF(epk, authInput, &#34;ELS2_XCA&#34;, 52)
</span></span><span style="display:flex;"><span>  clientKey_i = okm[0:31]
</span></span><span style="display:flex;"><span>  clientIV_i = okm[32:43]
</span></span><span style="display:flex;"><span>  clientID_i = okm[44:51]
</span></span><span style="display:flex;"><span>  clientCookie_i = ENCRYPT(clientKey_i, clientIV_i, authCookie)
</span></span></code></pre></div><p>O servidor coloca cada tupla <code>[clientID_i, clientCookie_i]</code> na camada 1 do LS2 criptografado, junto com <code>epk</code>.</p>
<p>Processamento do cliente
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</p>
<p>O cliente utiliza sua chave privada para derivar seu identificador de cliente esperado <code>clientID_i</code>, chave de criptografia <code>clientKey_i</code>, e IV de criptografia <code>clientIV_i</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>sharedSecret = DH(csk_i, epk)
</span></span><span style="display:flex;"><span>  authInput = sharedSecret || cpk_i || subcredential || publishedTimestamp
</span></span><span style="display:flex;"><span>  okm = HKDF(epk, authInput, &#34;ELS2_XCA&#34;, 52)
</span></span><span style="display:flex;"><span>  clientKey_i = okm[0:31]
</span></span><span style="display:flex;"><span>  clientIV_i = okm[32:43]
</span></span><span style="display:flex;"><span>  clientID_i = okm[44:51]
</span></span></code></pre></div><p>Em seguida, o cliente busca nos dados de autorização da camada 1 por uma entrada que contenha <code>clientID_i</code>. Se uma entrada correspondente existir, o cliente a descriptografa para obter <code>authCookie</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>authCookie = DECRYPT(clientKey_i, clientIV_i, clientCookie_i)
</span></span></code></pre></div><h4 id="pre-shared-key-client-authorization">Pre-shared key client authorization</h4>
<p>Cada cliente gera uma chave secreta de 32 bytes <code>psk_i</code>, e a envia para o servidor. Alternativamente, o servidor pode gerar a chave secreta, e enviá-la para um ou mais clientes.</p>
<p>Processamento do servidor
^^^^^^^^^^^^^^^^^^^^^</p>
<p>O servidor gera um novo <code>authCookie</code> e salt:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>authCookie = CSRNG(32)
</span></span><span style="display:flex;"><span>  authSalt = CSRNG(32)
</span></span></code></pre></div><p>Em seguida, para cada cliente autorizado, o servidor criptografa <code>authCookie</code> com sua chave pré-compartilhada:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>authInput = psk_i || subcredential || publishedTimestamp
</span></span><span style="display:flex;"><span>  okm = HKDF(authSalt, authInput, &#34;ELS2PSKA&#34;, 52)
</span></span><span style="display:flex;"><span>  clientKey_i = okm[0:31]
</span></span><span style="display:flex;"><span>  clientIV_i = okm[32:43]
</span></span><span style="display:flex;"><span>  clientID_i = okm[44:51]
</span></span><span style="display:flex;"><span>  clientCookie_i = ENCRYPT(clientKey_i, clientIV_i, authCookie)
</span></span></code></pre></div><p>O servidor coloca cada tupla <code>[clientID_i, clientCookie_i]</code> na camada 1 do LS2 criptografado, juntamente com <code>authSalt</code>.</p>
<p>Processamento do cliente ^^^^^^^^^^^^^^^^^^^^^</p>
<p>O cliente usa sua chave pré-compartilhada para derivar seu identificador de cliente esperado <code>clientID_i</code>, chave de criptografia <code>clientKey_i</code>, e IV de criptografia <code>clientIV_i</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>authInput = psk_i || subcredential || publishedTimestamp
</span></span><span style="display:flex;"><span>  okm = HKDF(authSalt, authInput, &#34;ELS2PSKA&#34;, 52)
</span></span><span style="display:flex;"><span>  clientKey_i = okm[0:31]
</span></span><span style="display:flex;"><span>  clientIV_i = okm[32:43]
</span></span><span style="display:flex;"><span>  clientID_i = okm[44:51]
</span></span></code></pre></div><p>Em seguida, o cliente procura nos dados de autorização da camada 1 por uma entrada que contenha <code>clientID_i</code>. Se uma entrada correspondente existir, o cliente a descriptografa para obter <code>authCookie</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>authCookie = DECRYPT(clientKey_i, clientIV_i, clientCookie_i)
</span></span></code></pre></div><h4 id="security-considerations">Security considerations</h4>
<p>Ambos os mecanismos de autorização de cliente acima fornecem privacidade para a associação de clientes. Uma entidade que conhece apenas o Destination pode ver quantos clientes estão inscritos a qualquer momento, mas não pode rastrear quais clientes estão sendo adicionados ou revogados.</p>
<p>Os servidores DEVEM randomizar a ordem dos clientes a cada vez que geram um LS2 criptografado, para evitar que os clientes descubram sua posição na lista e infiram quando outros clientes foram adicionados ou revogados.</p>
<p>Um servidor PODE escolher ocultar o número de clientes que estão inscritos inserindo entradas aleatórias na lista de dados de autorização.</p>
<p>Vantagens da autorização de cliente DH
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</p>
<ul>
<li>A segurança do esquema não depende exclusivamente da troca fora de banda do material
da chave do cliente. A chave privada do cliente nunca precisa sair do seu dispositivo,
e assim um adversário que consegue interceptar a troca fora de banda, mas não consegue
quebrar o algoritmo DH, não pode descriptografar o LS2 criptografado, ou determinar
por quanto tempo o cliente tem acesso concedido.</li>
</ul>
<p>Desvantagens da autorização de cliente DH
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</p>
<ul>
<li>Requer N + 1 operações DH no lado do servidor para N clientes.</li>
<li>Requer uma operação DH no lado do cliente.</li>
<li>Requer que o cliente gere a chave secreta.</li>
</ul>
<p>Vantagens da autorização de cliente PSK
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</p>
<ul>
<li>Não requer operações DH.</li>
<li>Permite ao servidor gerar a chave secreta.</li>
<li>Permite ao servidor compartilhar a mesma chave com múltiplos clientes, se desejado.</li>
</ul>
<p>Desvantagens da autorização de cliente PSK
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</p>
<ul>
<li>A segurança do esquema depende criticamente da troca fora de banda do material de chave do cliente. Um adversário que intercepte a troca para um cliente específico pode descriptografar qualquer LS2 criptografado subsequente para o qual esse cliente esteja autorizado, bem como determinar quando o acesso do cliente é revogado.</li>
</ul>
<h3 id="definições">Definições</h3>
<p>Veja a proposta 149.</p>
<p>Você não pode usar um LS2 criptografado para bittorrent, devido às respostas de announce compactas que têm 32 bytes. Os 32 bytes contêm apenas o hash. Não há espaço para uma indicação de que o leaseset está criptografado, ou os tipos de assinatura.</p>
<h3 id="formato-3">Formato</h3>
<p>Para leaseSets criptografados com chaves offline, as chaves privadas ofuscadas também devem ser geradas offline, uma para cada dia.</p>
<p>Como o bloco de assinatura offline opcional está na parte de texto limpo do leaseset criptografado, qualquer pessoa coletando dados dos floodfills poderia usar isso para rastrear o leaseset (mas não descriptografá-lo) ao longo de vários dias. Para evitar isso, o proprietário das chaves também deveria gerar novas chaves transitórias para cada dia. Tanto as chaves transitórias quanto as chaves cegas podem ser geradas com antecedência e entregues ao router em lote.</p>
<p>Não há formato de arquivo definido nesta proposta para empacotar múltiplas chaves transitórias e cegas e fornecê-las ao cliente ou router. Não há melhoria do protocolo I2CP definida nesta proposta para suportar leasesets criptografados com chaves offline.</p>
<h3 id="notes-1">Notes</h3>
<ul>
<li>
<p>Um serviço usando leaseSets criptografados publicaria a versão criptografada para os
floodfills. No entanto, por eficiência, enviaria leaseSets não criptografados para
os clientes na mensagem garlic encapsulada, uma vez autenticados (via whitelist, por
exemplo).</p>
</li>
<li>
<p>Os floodfills podem limitar o tamanho máximo para um valor razoável para prevenir abuso.</p>
</li>
<li>
<p>Após a descriptografia, várias verificações devem ser feitas, incluindo que
o timestamp interno e a expiração coincidam com aqueles no nível superior.</p>
</li>
<li>
<p>ChaCha20 foi selecionado em vez de AES. Embora as velocidades sejam similares quando há suporte de hardware AES disponível, ChaCha20 é 2,5-3x mais rápido quando o suporte de hardware AES não está disponível, como em dispositivos ARM de baixo desempenho.</p>
</li>
<li>
<p>Não nos importamos o suficiente com a velocidade para usar BLAKE2b com chave. Tem um
tamanho de saída grande o suficiente para acomodar o maior n que necessitamos (ou podemos chamá-lo uma vez por
chave desejada com um argumento contador). BLAKE2b é muito mais rápido que SHA-256, e
BLAKE2b com chave reduziria o número total de chamadas de função hash.
No entanto, veja a proposta 148, onde é proposto que mudemos para BLAKE2b por outras razões.
Veja <a href="https://www.lvh.io/posts/secure-key-derivation-performance.html">Secure key derivation performance</a>
.</p>
</li>
</ul>
<h3 id="meta-ls2">Meta LS2</h3>
<p>Isso é usado para substituir multihoming. Como qualquer leaseset, isso é assinado pelo criador. Esta é uma lista autenticada de hashes de destino.</p>
<p>O Meta LS2 é o topo de, e possivelmente nós intermediários de, uma estrutura de árvore. Ele contém um número de entradas, cada uma apontando para um LS, LS2, ou outro Meta LS2 para suportar multihoming massivo. Um Meta LS2 pode conter uma mistura de entradas LS, LS2 e Meta LS2. As folhas da árvore são sempre um LS ou LS2. A árvore é um DAG; loops são proibidos; clientes fazendo consultas devem detectar e se recusar a seguir loops.</p>
<p>Um Meta LS2 pode ter uma expiração muito mais longa que um LS ou LS2 padrão. O nível superior pode ter uma expiração várias horas após a data de publicação. O tempo máximo de expiração será aplicado pelos floodfills e clientes, e ainda está por definir.</p>
<p>O caso de uso para Meta LS2 é multihoming massivo, mas sem mais proteção para correlação de roteadores com leaseSets (no momento de reinicialização do router) do que é fornecido agora com LS ou LS2. Isso é equivalente ao caso de uso &ldquo;facebook&rdquo;, que provavelmente não precisa de proteção contra correlação. Este caso de uso provavelmente precisa de chaves offline, que são fornecidas no cabeçalho padrão em cada nó da árvore.</p>
<p>O protocolo de back-end para coordenação entre os routers folha, signatários Meta LS intermediários e mestres não está especificado aqui. Os requisitos são extremamente simples - apenas verificar se o peer está ativo e publicar um novo LS a cada poucas horas. A única complexidade é escolher novos publicadores para os Meta LSes de nível superior ou intermediário em caso de falha.</p>
<p>Mix-and-match leasesets onde leases de múltiplos routers são combinados, assinados e publicados em um único leaseset está documentado na proposta 140, &ldquo;invisible multihoming&rdquo;. Esta proposta é insustentável como escrita, porque conexões streaming não seriam &ldquo;sticky&rdquo; a um único router, veja <a href="http://zzz.i">http://zzz.i</a>
2p/topics/2335 .</p>
<p>O protocolo de back-end, e a interação com os componentes internos do router e cliente, seria bastante complexa para multihoming invisível.</p>
<p>Para evitar sobrecarregar o floodfill para o Meta LS de nível superior, a expiração deve ser de pelo menos várias horas. Os clientes devem fazer cache do Meta LS de nível superior e persistir através de reinicializações se não estiver expirado.</p>
<p>Precisamos definir algum algoritmo para os clientes percorrerem a árvore, incluindo alternativas de fallback, para que o uso seja disperso. Alguma função de distância de hash, custo e aleatoriedade. Se um nó tem tanto LS ou LS2 quanto Meta LS, precisamos saber quando é permitido usar esses leaseSets e quando continuar percorrendo a árvore.</p>
<p>Consultar com</p>
<pre><code>Standard LS flag (1)
</code></pre>
<p>Armazenar com</p>
<pre><code>Meta LS2 type (7)
</code></pre>
<p>Armazenar em</p>
<pre><code>Hash of destination
This hash is then used to generate the daily &quot;routing key&quot;, as in LS1
</code></pre>
<p>Expiração típica</p>
<pre><code>Hours. Max 18.2 hours (65535 seconds)
</code></pre>
<p>Publicado por</p>
<pre><code>&quot;master&quot; Destination or coordinator, or intermediate coordinators
</code></pre>
<h3 id="format">Format</h3>
<pre tabindex="0"><code>Standard LS2 Header as specified above

  Meta LS2 Type-Specific Part
  - Properties (Mapping as specified in common structures spec, 2 zero bytes if none)
  - Number of entries (1 byte) Maximum TBD
  - Entries. Each entry contains: (40 bytes)
    - Hash (32 bytes)
    - Flags (2 bytes)
      TBD. Set all to zero for compatibility with future uses.
    - Type (1 byte) The type of LS it is referencing;
      1 for LS, 3 for LS2, 5 for encrypted, 7 for meta, 0 for unknown.
    - Cost (priority) (1 byte)
    - Expires (4 bytes) (4 bytes, big endian, seconds since epoch, rolls over in 2106)
  - Number of revocations (1 byte) Maximum TBD
  - Revocations: Each revocation contains: (32 bytes)
    - Hash (32 bytes)

  Standard LS2 Signature:
  - Signature (40+ bytes)
    The signature is of everything above.
</code></pre><p>Flags e propriedades: para uso futuro</p>
<h3 id="derivação-de-chave-de-ofuscação">Derivação de Chave de Ofuscação</h3>
<ul>
<li>
<p>Um serviço distribuído usando isto teria um ou mais &ldquo;mestres&rdquo; com a
chave privada do destino do serviço. Eles determinariam (fora de banda) a
lista atual de destinos ativos e publicariam o Meta LS2. Para redundância,
múltiplos mestres poderiam fazer multihome (ou seja, publicar simultaneamente) o
Meta LS2.</p>
</li>
<li>
<p>Um serviço distribuído pode começar com um único destino ou usar
multihoming de estilo antigo, depois fazer a transição para um Meta LS2. Uma
consulta LS padrão pode retornar qualquer um entre um LS, LS2, ou Meta LS2.</p>
</li>
<li>
<p>Quando um serviço usa um Meta LS2, ele não tem túneis (leases).</p>
</li>
</ul>
<h3 id="service-record">Service Record</h3>
<p>Este é um registro individual que indica que um destino está participando de um serviço. É enviado do participante para o floodfill. Nunca é enviado individualmente por um floodfill, mas apenas como parte de uma Lista de Serviços. O Registro de Serviço também é usado para revogar a participação em um serviço, definindo a expiração como zero.</p>
<p>Isso não é um LS2, mas usa o formato padrão de cabeçalho e assinatura LS2.</p>
<p>Consultar com</p>
<pre><code>n/a, see Service List
</code></pre>
<p>Armazenar com</p>
<pre><code>Service Record type (9)
</code></pre>
<p>Armazenar em</p>
<pre><code>Hash of service name
This hash is then used to generate the daily &quot;routing key&quot;, as in LS1
</code></pre>
<p>Expiração típica</p>
<pre><code>Hours. Max 18.2 hours (65535 seconds)
</code></pre>
<p>Publicado por</p>
<pre><code>Destination
</code></pre>
<h3 id="format-1">Format</h3>
<pre tabindex="0"><code>Standard LS2 Header as specified above

  Service Record Type-Specific Part
  - Port (2 bytes, big endian) (0 if unspecified)
  - Hash of service name (32 bytes)

  Standard LS2 Signature:
  - Signature (40+ bytes)
    The signature is of everything above.
</code></pre><h3 id="notes-2">Notes</h3>
<ul>
<li>
<p>Se expires for todos zeros, o floodfill deve revogar o registro e não mais
incluí-lo na lista de serviços.</p>
</li>
<li>
<p>Armazenamento: O floodfill pode restringir rigorosamente o armazenamento desses registros e
limitar o número de registros armazenados por hash e sua expiração. Uma lista de permissões
de hashes também pode ser utilizada.</p>
</li>
<li>
<p>Qualquer outro tipo de netDb no mesmo hash tem prioridade, portanto um registro de serviço nunca pode
substituir um LS/RI, mas um LS/RI irá substituir todos os registros de serviço nesse hash.</p>
</li>
</ul>
<h3 id="service-list">Service List</h3>
<p>Isso não se parece em nada com um LS2 e usa um formato diferente.</p>
<p>A lista de serviços é criada e assinada pelo floodfill. É não autenticada no sentido de que qualquer pessoa pode ingressar em um serviço publicando um Service Record para um floodfill.</p>
<p>Uma Lista de Serviços contém Registros de Serviço Curtos, não Registros de Serviço completos. Estes contêm assinaturas mas apenas hashes, não destinos completos, portanto não podem ser verificados sem o destino completo.</p>
<p>A segurança, se houver, e a conveniência das listas de serviços ainda está por ser determinada (TBD). Os floodfills poderiam limitar a publicação e as consultas a uma lista de permissões de serviços, mas essa lista pode variar com base na implementação ou preferência do operador. Pode não ser possível alcançar consenso sobre uma lista de permissões comum e básica entre as implementações.</p>
<p>Se o nome do serviço estiver incluído no registo de serviço acima, então os operadores de floodfill podem objetar; se apenas o hash estiver incluído, não há verificação, e um registo de serviço pode &ldquo;entrar&rdquo; à frente de qualquer outro tipo de netDb e ser armazenado no floodfill.</p>
<p>Consultar com</p>
<pre><code>Service List lookup type (11)
</code></pre>
<p>Armazenar com</p>
<pre><code>Service List type (11)
</code></pre>
<p>Armazenar em</p>
<pre><code>Hash of service name
This hash is then used to generate the daily &quot;routing key&quot;, as in LS1
</code></pre>
<p>Expiração típica</p>
<pre><code>Hours, not specified in the list itself, up to local policy
</code></pre>
<p>Publicado por</p>
<pre><code>Nobody, never sent to floodfill, never flooded.
</code></pre>
<h3 id="format-2">Format</h3>
<p>NÃO usa o cabeçalho LS2 padrão especificado acima.</p>
<pre tabindex="0"><code>- Type (1 byte)
    Not actually in header, but part of data covered by signature.
    Take from field in Database Store Message.
  - Hash of the service name (implicit, in the Database Store message)
  - Hash of the Creator (floodfill) (32 bytes)
  - Published timestamp (8 bytes, big endian)

  - Number of Short Service Records (1 byte)
  - List of Short Service Records:
    Each Short Service Record contains (90+ bytes)
    - Dest hash (32 bytes)
    - Published timestamp (8 bytes, big endian)
    - Expires (4 bytes, big endian) (offset from published in ms)
    - Flags (2 bytes)
    - Port (2 bytes, big endian)
    - Sig length (2 bytes, big endian)
    - Signature of dest (40+ bytes)

  - Number of Revocation Records (1 byte)
  - List of Revocation Records:
    Each Revocation Record contains (86+ bytes)
    - Dest hash (32 bytes)
    - Published timestamp (8 bytes, big endian)
    - Flags (2 bytes)
    - Port (2 bytes, big endian)
    - Sig length (2 bytes, big endian)
    - Signature of dest (40+ bytes)

  - Signature of floodfill (40+ bytes)
    The signature is of everything above.
</code></pre><p>Para verificar a assinatura da Lista de Serviços:</p>
<ul>
<li>anexar o hash do nome do serviço</li>
<li>remover o hash do criador</li>
<li>Verificar assinatura dos conteúdos modificados</li>
</ul>
<p>Para verificar a assinatura de cada Short Service Record:</p>
<ul>
<li>Buscar destino</li>
<li>Verificar assinatura de (timestamp publicado + expira + flags + porta + Hash do
nome do serviço)</li>
</ul>
<p>Para verificar a assinatura de cada Registro de Revogação:</p>
<ul>
<li>Buscar destino</li>
<li>Verificar assinatura de (timestamp publicado + 4 bytes zero + flags + porta + Hash
do nome do serviço)</li>
</ul>
<h3 id="notes-3">Notes</h3>
<ul>
<li>
<p>Usamos o comprimento da assinatura em vez do tipo de assinatura para que possamos suportar tipos de assinatura desconhecidos.</p>
</li>
<li>
<p>Não há expiração de uma lista de serviços, os destinatários podem tomar sua própria decisão baseada na política ou na expiração dos registros individuais.</p>
</li>
<li>
<p>As Listas de Serviço não são inundadas, apenas os Registros de Serviço individuais são. Cada
floodfill cria, assina e armazena em cache uma Lista de Serviço. O floodfill usa sua
própria política para tempo de cache e o número máximo de registros de serviço e revogação.</p>
</li>
</ul>
<h2 id="common-structures-spec-changes-required">Common Structures Spec Changes Required</h2>
<h3 id="criptografia-e-processamento">Criptografia e processamento</h3>
<p>Fora do escopo desta proposta. Adicionar às propostas ECIES 144 e 145.</p>
<h3 id="new-intermediate-structures">New Intermediate Structures</h3>
<p>Adicionar novas estruturas para Lease2, MetaLease, LeaseSet2Header e OfflineSignature. Efetivo a partir da versão 0.9.38.</p>
<h3 id="new-netdb-types">New NetDB Types</h3>
<p>Adicionar estruturas para cada novo tipo de leaseSet, incorporadas do acima. Para LeaseSet2, EncryptedLeaseSet e MetaLeaseSet, efetivo a partir da versão 0.9.38. Para Service Record e Service List, preliminar e não agendado.</p>
<h3 id="new-signature-type">New Signature Type</h3>
<p>Adicionar RedDSA_SHA512_Ed25519 Tipo 11. Chave pública tem 32 bytes; chave privada tem 32 bytes; hash tem 64 bytes; assinatura tem 64 bytes.</p>
<h2 id="encryption-spec-changes-required">Encryption Spec Changes Required</h2>
<p>Fora do escopo desta proposta. Consulte as propostas 144 e 145.</p>
<h2 id="i2np-changes-required">I2NP Changes Required</h2>
<p>Adicionar nota: LS2 só pode ser publicado em floodfills com uma versão mínima.</p>
<h3 id="database-lookup-message">Database Lookup Message</h3>
<p>Adicionar o tipo de busca da lista de serviços.</p>
<h3 id="changes">Changes</h3>
<pre tabindex="0"><code>Flags byte: Lookup type field, currently bits 3-2, expands to bits 4-2.
  Lookup type 0x04 is defined as the service list lookup.

  Add note: Service list loookup may only be sent to floodfills with a minimum version.
  Minimum version is 0.9.38.
</code></pre><h3 id="autorização-por-cliente">Autorização por cliente</h3>
<p>Adicione todos os novos tipos de armazenamento.</p>
<h3 id="changes-1">Changes</h3>
<pre tabindex="0"><code>Type byte: Type field, currently bit 0, expands to bits 3-0.
  Type 3 is defined as a LS2 store.
  Type 5 is defined as a encrypted LS2 store.
  Type 7 is defined as a meta LS2 store.
  Type 9 is defined as a service record store.
  Type 11 is defined as a service list store.
  Other types are undefined and invalid.

  Add note: All new types may only be published to floodfills with a minimum version.
  Minimum version is 0.9.38.
</code></pre><h2 id="i2cp-changes-required">I2CP Changes Required</h2>
<h3 id="i2cp-options">I2CP Options</h3>
<p>Novas opções interpretadas no lado do router, enviadas no Mapeamento SessionConfig:</p>
<pre tabindex="0"><code>
  i2cp.leaseSetType=nnn       The type of leaseset to be sent in the Create Leaseset Message
                              Value is the same as the netdb store type in the table above.
                              Interpreted client-side, but also passed to the router in the
                              SessionConfig, to declare intent and check support.

  i2cp.leaseSetEncType=nnn[,nnn]  The encryption types to be used.
                                  Interpreted client-side, but also passed to the router in
                                  the SessionConfig, to declare intent and check support.
                                  See proposals 144 and 145.

  i2cp.leaseSetOfflineExpiration=nnn  The expiration of the offline signature, ASCII,
                                      seconds since the epoch.

  i2cp.leaseSetTransientPublicKey=[type:]b64  The base 64 of the transient private key,
                                              prefixed by an optional sig type number
                                              or name, default DSA_SHA1.
                                              Length as inferred from the sig type

  i2cp.leaseSetOfflineSignature=b64   The base 64 of the offline signature.
                                      Length as inferred from the destination
                                      signing public key type

  i2cp.leaseSetSecret=b64     The base 64 of a secret used to blind the
                              address of the leaseset, default &#34;&#34;

  i2cp.leaseSetAuthType=nnn   The type of authentication for encrypted LS2.
                              0 for no per-client authentication (the default)
                              1 for DH per-client authentication
                              2 for PSK per-client authentication

  i2cp.leaseSetPrivKey=b64    A base 64 private key for the router to use to
                              decrypt the encrypted LS2,
                              only if per-client authentication is enabled
</code></pre><p>Novas opções interpretadas do lado do cliente:</p>
<pre tabindex="0"><code>
  i2cp.leaseSetType=nnn     The type of leaseset to be sent in the Create Leaseset Message
                            Value is the same as the netdb store type in the table above.
                            Interpreted client-side, but also passed to the router in the
                            SessionConfig, to declare intent and check support.

  i2cp.leaseSetEncType=nnn[,nnn]  The encryption types to be used.
                                  Interpreted client-side, but also passed to the router in
                                  the SessionConfig, to declare intent and check support.
                                  See proposals 144 and 145.

  i2cp.leaseSetSecret=b64     The base 64 of a secret used to blind the
                              address of the leaseset, default &#34;&#34;

  i2cp.leaseSetAuthType=nnn       The type of authentication for encrypted LS2.
                                  0 for no per-client authentication (the default)
                                  1 for DH per-client authentication
                                  2 for PSK per-client authentication

  i2cp.leaseSetBlindedType=nnn   The sig type of the blinded key for encrypted LS2.
                                 Default depends on the destination sig type.

  i2cp.leaseSetClient.dh.nnn=b64name:b64pubkey   The base 64 of the client name (ignored, UI use only),
                                                 followed by a &#39;:&#39;, followed by the base 64 of the public
                                                 key to use for DH per-client auth. nnn starts with 0

  i2cp.leaseSetClient.psk.nnn=b64name:b64privkey   The base 64 of the client name (ignored, UI use only),
                                                   followed by a &#39;:&#39;, followed by the base 64 of the private
                                                   key to use for PSK per-client auth. nnn starts with 0
</code></pre><h3 id="session-config">Session Config</h3>
<p>Note que para assinaturas offline, as opções i2cp.leaseSetOfflineExpiration, i2cp.leaseSetTransientPublicKey, e i2cp.leaseSetOfflineSignature são obrigatórias, e a assinatura é feita pela chave privada de assinatura transiente.</p>
<h3 id="encrypted-ls-com-endereços-base-32">Encrypted LS com Endereços Base 32</h3>
<p>Router para cliente. Sem alterações. Os leases são enviados com timestamps de 8 bytes, mesmo se o leaseset retornado for um LS2 com timestamps de 4 bytes. Note que a resposta pode ser uma mensagem Create Leaseset ou Create Leaseset2.</p>
<h3 id="ls-criptografada-com-chaves-offline">LS Criptografada com Chaves Offline</h3>
<p>Router para cliente. Sem alterações. Os leases são enviados com timestamps de 8 bytes, mesmo que o leaseset retornado seja um LS2 com timestamps de 4 bytes. Note que a resposta pode ser uma mensagem Create Leaseset ou Create Leaseset2.</p>
<h3 id="notas-3">Notas</h3>
<p>Cliente para router. Nova mensagem, para usar no lugar da Mensagem Create Leaseset.</p>
<h3 id="meta-ls2-1">Meta LS2</h3>
<ul>
<li>
<p>Para que o router analise o tipo de armazenamento, o tipo deve estar na mensagem,
a menos que seja passado para o router previamente na configuração da sessão.
Para código de análise comum, é mais fácil tê-lo na própria mensagem.</p>
</li>
<li>
<p>Para que o router saiba o tipo e comprimento da chave privada,
ela deve estar após o lease set, a menos que o parser conheça o tipo antecipadamente
na configuração da sessão.
Para código de parsing comum, é mais fácil saber isso da própria mensagem.</p>
</li>
<li>
<p>A chave privada de assinatura, previamente definida para revogação e não utilizada,
não está presente no LS2.</p>
</li>
</ul>
<h3 id="formato-4">Formato</h3>
<p>O tipo de mensagem para a Mensagem Create Leaseset2 é 41.</p>
<h3 id="notas-4">Notas</h3>
<pre tabindex="0"><code>Session ID
  Type byte: Type of lease set to follow
             Type 1 is a LS
             Type 3 is a LS2
             Type 5 is a encrypted LS2
             Type 7 is a meta LS2
  LeaseSet: type specified above
  Number of private keys to follow (1 byte)
  Encryption Private Keys: For each public key in the lease set,
                           in the same order
                           (Not present for Meta LS2)
                           - Encryption type (2 bytes, big endian)
                           - Encryption key length (2 bytes, big endian)
                           - Encryption key (number of bytes specified)
</code></pre><h3 id="registro-de-serviço">Registro de Serviço</h3>
<ul>
<li>A versão mínima do router é 0.9.39.</li>
<li>A versão preliminar com tipo de mensagem 40 estava na 0.9.38, mas o formato foi alterado.
O tipo 40 foi abandonado e não é suportado.</li>
</ul>
<h3 id="formato-5">Formato</h3>
<ul>
<li>Mais alterações são necessárias para suportar LS criptografado e meta.</li>
</ul>
<h3 id="notas-5">Notas</h3>
<p>Cliente para roteador. Nova mensagem.</p>
<h3 id="lista-de-serviços">Lista de Serviços</h3>
<ul>
<li>
<p>O router precisa saber se um destino está ofuscado.
Se estiver ofuscado e usar uma autenticação secreta ou por cliente,
ele precisa ter essa informação também.</p>
</li>
<li>
<p>Uma Host Lookup de um endereço b32 de novo formato (&ldquo;b33&rdquo;)
informa ao router que o endereço é ofuscado, mas não há mecanismo para
passar a chave secreta ou privada para o router na mensagem Host Lookup.
Embora pudéssemos estender a mensagem Host Lookup para adicionar essa informação,
é mais limpo definir uma nova mensagem.</p>
</li>
<li>
<p>Precisamos de uma forma programática para o cliente informar o router.
Caso contrário, o usuário teria que configurar manualmente cada destino.</p>
</li>
</ul>
<h3 id="formato-6">Formato</h3>
<p>Antes de um cliente enviar uma mensagem para um destino blindado, ele deve procurar o &ldquo;b33&rdquo; em uma mensagem Host Lookup, ou enviar uma mensagem Blinding Info. Se o destino blindado requer uma autenticação secreta ou por cliente, o cliente deve enviar uma mensagem Blinding Info.</p>
<p>O router não envia uma resposta para esta mensagem.</p>
<h3 id="notas-6">Notas</h3>
<p>O tipo de mensagem para a Blinding Info Message é 42.</p>
<h3 id="format-3">Format</h3>
<pre tabindex="0"><code>Session ID
  Flags:       1 byte
               Bit order: 76543210
               Bit 0: 0 for everybody, 1 for per-client
               Bits 3-1: Authentication scheme, if bit 0 is set to 1 for per-client, otherwise 000
                         000: DH client authentication (or no per-client authentication)
                         001: PSK client authentication
               Bit 4: 1 if secret required, 0 if no secret required
               Bits 7-5: Unused, set to 0 for future compatibility
  Type byte:   Endpoint type to follow
               Type 0 is a Hash
               Type 1 is a host name String
               Type 2 is a Destination
               Type 3 is a Sig Type and Signing Public Key
  Blind Type:  2 byte blinded sig type (big endian)
  Expiration:  4 bytes, big endian, seconds since epoch
  Endpoint:    Data as specified above
               For type 0: 32 byte binary hash
               For type 1: host name String
               For type 2: binary Destination
               For type 3: 2 byte sig type (big endian)
                           Signing Public Key (length as implied by sig type)
  Private Key: Only if flag bit 0 is set to 1
               A 32-byte ECIES_X25519 private key
  Secret:      Only if flag bit 4 is set to 1
               A secret String
</code></pre><h3 id="certificados-de-chave">Certificados de Chave</h3>
<ul>
<li>A versão mínima do router é 0.9.43</li>
</ul>
<h3 id="novas-estruturas-intermediárias">Novas Estruturas Intermediárias</h3>
<h3 id="novos-tipos-de-netdb">Novos Tipos de NetDB</h3>
<p>Para suportar consultas de nomes de host &ldquo;b33&rdquo; e retornar uma indicação se o router não tiver a informação necessária, definimos códigos de resultado adicionais para a Mensagem de Resposta de Host, como segue:</p>
<pre tabindex="0"><code>2: Lookup password required
   3: Private key required
   4: Lookup password and private key required
   5: Leaseset decryption failure
</code></pre><p>Os valores 1-255 já estão definidos como erros, portanto não há problema de compatibilidade com versões anteriores.</p>
<h3 id="novo-tipo-de-assinatura">Novo Tipo de Assinatura</h3>
<p>Router para cliente. Nova mensagem.</p>
<h3 id="justification-1">Justification</h3>
<p>Um cliente não sabe a priori que um determinado Hash será resolvido para um Meta LS.</p>
<p>Se uma consulta de leaseset para um Destination retornar um Meta LS, o router fará a resolução recursiva. Para datagramas, o lado cliente não precisa saber; no entanto, para streaming, onde o protocolo verifica o destino no SYN ACK, ele deve saber qual é o destino &ldquo;real&rdquo;. Portanto, precisamos de uma nova mensagem.</p>
<h3 id="usage">Usage</h3>
<p>O router mantém um cache para o destino real que é usado de um meta LS. Quando o cliente envia uma mensagem para um destino que resolve para um meta LS, o router verifica o cache para o destino real usado pela última vez. Se o cache estiver vazio, o router seleciona um destino do meta LS e procura o leaseset. Se a busca do leaseset for bem-sucedida, o router adiciona esse destino ao cache e envia ao cliente uma Meta Redirect Message. Isso é feito apenas uma vez, a menos que o destino expire e precise ser alterado. O cliente também deve fazer cache da informação se necessário. A Meta Redirect Message NÃO é enviada em resposta a cada SendMessage.</p>
<p>O router apenas envia esta mensagem para clientes com versão 0.9.47 ou superior.</p>
<p>O cliente não envia uma resposta para esta mensagem.</p>
<h3 id="mensagem-de-consulta-de-base-de-dados">Mensagem de Consulta de Base de Dados</h3>
<p>O tipo de mensagem para a Meta Redirect Message é 43.</p>
<h3 id="alterações">Alterações</h3>
<pre tabindex="0"><code>Session ID (2 bytes) The value from the Send Message.
  Message ID generated by the router (4 bytes)
  4 byte nonce previously generated by the client
               (the value from the Send Message, may be zero)
  Flags:       2 bytes, bit order 15...0
               Unused, set to 0 for future compatibility
               Bit 0: 0 - the destination is no longer meta
                      1 - the destination is now meta
               Bits 15-1: Unused, set to 0 for future compatibility
  Original Destination (387+ bytes)
  (following fields only present if flags bit 0 is 1)
  MFlags:      2 bytes
               Unused, set to 0 for future compatibility
               From the Meta Lease for the actual Destination
  Expiration:  4 bytes, big endian, seconds since epoch
               From the Meta Lease for the actual Destination
  Cost (priority) 1 byte
               From the Meta Lease for the actual Destination
  Actual (real) Destination (387+ bytes)
</code></pre><h3 id="mensagem-de-armazenamento-de-base-de-dados">Mensagem de Armazenamento de Base de Dados</h3>
<p>Como gerar e suportar Meta, incluindo comunicação e coordenação entre routers, está fora do escopo desta proposta. Veja a proposta relacionada 150.</p>
<h3 id="alterações-1">Alterações</h3>
<p>Assinaturas offline não podem ser verificadas em streaming ou datagramas respondíveis. Veja as seções abaixo.</p>
<h2 id="private-key-file-changes-required">Private Key File Changes Required</h2>
<p>O formato do arquivo de chave privada (eepPriv.dat) não é uma parte oficial de nossas especificações, mas está documentado nos <a href="http://idk.i2p/javadoc-i2p/net/i2p/data/PrivateKeyFile.html">javadocs do Java I2P</a>
 e outras implementações o suportam. Isso permite a portabilidade de chaves privadas para diferentes implementações.</p>
<p>São necessárias alterações para armazenar a chave pública transitória e as informações de assinatura offline.</p>
<h3 id="changes-2">Changes</h3>
<pre tabindex="0"><code>If the signing private key is all zeros, the offline information section follows:

  - Expires timestamp
    (4 bytes, big endian, seconds since epoch, rolls over in 2106)
  - Sig type of transient Signing Public Key (2 bytes, big endian)
  - Transient Signing Public key
    (length as specified by transient sig type)
  - Signature of above three fields by offline key
    (length as specified by destination sig type)
  - Transient Signing Private key
    (length as specified by transient sig type)
</code></pre><h3 id="opções-i2cp">Opções I2CP</h3>
<p>Adicione suporte para as seguintes opções:</p>
<pre tabindex="0"><code>-d days              (specify expiration in days of offline sig, default 365)
      -o offlinedestfile   (generate the online key file,
                            using the offline key file specified)
      -r sigtype           (specify sig type of transient key, default Ed25519)
</code></pre><h2 id="streaming-changes-required">Streaming Changes Required</h2>
<p>Assinaturas offline não podem ser verificadas atualmente no streaming. A alteração abaixo adiciona o bloco de assinatura offline às opções. Isso evita ter que recuperar essas informações via I2CP.</p>
<h3 id="configuração-de-sessão">Configuração de Sessão</h3>
<pre tabindex="0"><code>Add new option:
  Bit:          11
  Flag:         OFFLINE_SIGNATURE
  Option order: 4
  Option data:  Variable bytes
  Function:     Contains the offline signature section from LS2.
                FROM_INCLUDED must also be set.
                Expires timestamp
                (4 bytes, big endian, seconds since epoch, rolls over in 2106)
                Transient sig type (2 bytes, big endian)
                Transient signing public key (length as implied by sig type)
                Signature of expires timestamp, transient sig type,
                and public key, by the destination public key,
                length as implied by destination public key sig type.

  Change option:
  Bit:          3
  Flag:         SIGNATURE_INCLUDED
  Option order: Change from 4 to 5

  Add information about transient keys to the
  Variable Length Signature Notes section:
  The offline signature option does not needed to be added for a CLOSE packet if
  a SYN packet containing the option was previously acked.
  More info TODO
</code></pre><h3 id="mensagem-de-solicitação-de-leaseset">Mensagem de Solicitação de LeaseSet</h3>
<ul>
<li>A alternativa é apenas adicionar uma flag e recuperar a chave pública transiente via I2CP
(Veja as seções Host Lookup / Host Reply Message acima)</li>
</ul>
<h2 id="cabeçalho-ls2-padrão">Cabeçalho LS2 Padrão</h2>
<p>As assinaturas offline não podem ser verificadas no processamento de datagrama repliable. Precisa de uma flag para indicar assinado offline, mas não há lugar para colocar uma flag. Exigirá um número de protocolo e formato completamente novos.</p>
<h3 id="mensagem-de-solicitação-de-leaseset-de-variável">Mensagem de Solicitação de Leaseset de Variável</h3>
<pre tabindex="0"><code>Define new protocol 19 - Repliable datagram with options?
  - Destination (387+ bytes)
  - Flags (2 bytes)
    Bit order: 15 14 ... 3 2 1 0
    Bit 0: If 0, no offline keys; if 1, offline keys
    Bits 1-15: set to 0 for compatibility with future uses
  - If flag indicates offline keys, the offline signature section:
    Expires timestamp
    (4 bytes, big endian, seconds since epoch, rolls over in 2106)
    Transient sig type (2 bytes, big endian)
    Transient signing public key (length as implied by sig type)
    Signature of expires timestamp, transient sig type,
    and public key, by the destination public key,
    length as implied by destination public key sig type.
    This section can, and should, be generated offline.
  - Data
</code></pre><h3 id="criar-mensagem-leaseset2">Criar Mensagem Leaseset2</h3>
<ul>
<li>Alternativa é apenas adicionar uma flag e recuperar a chave pública transitória via I2CP
(Ver seções Host Lookup / Host Reply Message acima)</li>
<li>Quaisquer outras opções que deveríamos adicionar agora que temos bytes de flag?</li>
</ul>
<h2 id="sam-v3-changes-required">SAM V3 Changes Required</h2>
<p>SAM deve ser aprimorado para suportar assinaturas offline no DESTINATION base 64.</p>
<h3 id="justificativa-1">Justificativa</h3>
<pre tabindex="0"><code>Note that in the SESSION CREATE DESTINATION=$privkey,
  the $privkey raw data (before base64 conversion)
  may be optionally followed by the Offline Signature as specified in the
  Common Structures Specification.

  If the signing private key is all zeros, the offline information section follows:

  - Expires timestamp
    (4 bytes, big endian, seconds since epoch, rolls over in 2106)
  - Sig type of transient Signing Public Key (2 bytes, big endian)
  - Transient Signing Public key
    (length as specified by transient sig type)
  - Signature of above three fields by offline key
    (length as specified by destination sig type)
  - Transient Signing Private key (length as specified by transient sig type)
</code></pre><p>Note que assinaturas offline são suportadas apenas para STREAM e RAW, não para DATAGRAM (até que definamos um novo protocolo DATAGRAM).</p>
<p>Note que o SESSION STATUS retornará uma Signing Private Key de todos zeros e os dados de Offline Signature exatamente como fornecidos no SESSION CREATE.</p>
<p>Observe que DEST GENERATE e SESSION CREATE DESTINATION=TRANSIENT não podem ser usados para criar um destino assinado offline.</p>
<h3 id="tipo-de-mensagem">Tipo de Mensagem</h3>
<p>Aumentar a versão para 3.4, ou deixá-la em 3.1/3.2/3.3 para que possa ser adicionada sem exigir todas as funcionalidades da 3.2/3.3?</p>
<p>Outras mudanças a definir. Veja a seção I2CP Host Reply Message acima.</p>
<h2 id="bob-changes-required">BOB Changes Required</h2>
<p>BOB teria que ser aprimorado para suportar assinaturas offline e/ou Meta LS. Esta é uma prioridade baixa e provavelmente nunca será especificada ou implementada. SAM V3 é a interface preferida.</p>
<h2 id="publishing-migration-compatibility">Publishing, Migration, Compatibility</h2>
<p>LS2 (exceto LS2 criptografado) é publicado no mesmo local DHT que LS1. Não há maneira de publicar tanto um LS1 quanto um LS2, a menos que LS2 esteja em um local diferente.</p>
<p>O LS2 criptografado é publicado no hash do tipo de chave ofuscada e dados da chave. Este hash é então usado para gerar a &ldquo;chave de roteamento&rdquo; diária, como no LS1.</p>
<p>LS2 seria usado apenas quando novos recursos são necessários (nova criptografia, LS criptografado, meta, etc.). LS2 só pode ser publicado para floodfills de uma versão especificada ou superior.</p>
<p>Servidores que publicam LS2 saberiam que quaisquer clientes conectando suportam LS2. Eles poderiam enviar LS2 no garlic.</p>
<p>Os clientes enviariam LS2 em garlics apenas se estivessem usando nova criptografia. Clientes compartilhados usariam LS1 indefinidamente? TODO: Como ter clientes compartilhados que suportem tanto criptografia antiga quanto nova?</p>
<h2 id="rollout">Rollout</h2>
<p>0.9.38 contém suporte floodfill para LS2 padrão, incluindo chaves offline.</p>
<p>A versão 0.9.39 contém suporte I2CP para LS2 e Encrypted LS2, assinatura/verificação do tipo de assinatura 11, suporte floodfill para Encrypted LS2 (tipos de assinatura 7 e 11, sem chaves offline), e criptografia/descriptografia LS2 (sem autorização por cliente).</p>
<p>A versão 0.9.40 está programada para incluir suporte para criptografar/descriptografar LS2 com autorização por cliente, suporte floodfill e I2CP para Meta LS2, suporte para LS2 criptografado com chaves offline, e suporte b32 para LS2 criptografado.</p>
<h2 id="novos-tipos-de-databaseentry">Novos tipos de DatabaseEntry</h2>
<p>O design criptografado do LS2 é fortemente influenciado pelos <a href="https://spec.torproject.org/rend-spec-v3">descritores de serviços ocultos v3 do Tor</a>
, que tinham objetivos de design similares.</p>

                </article>

                
                <nav class="page-nav">
                    <a href="../../../pt/proposals/" class="page-nav-link">
                        ← Back to Proposals
                    </a>
                    
                    
                    
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                            
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                    <a href="../../../proposals/123-new-netdb-entries.txt" class="page-nav-link" download>
                        Download Source (.txt)
                    </a>
                    
                </nav>
            </div>
        </div>
    </div>
</div>

<style>
.proposals-page {
    min-height: 100vh;
    padding: var(--spacing-xl) 0;
}

.breadcrumbs {
    display: flex;
    align-items: center;
    gap: var(--spacing-xs);
    margin-bottom: var(--spacing-lg);
    font-size: 0.875rem;
    color: var(--color-text-muted);
}

.breadcrumbs a {
    color: var(--color-text-muted);
    text-decoration: none;
    transition: color var(--transition-fast);
}

.breadcrumbs a:hover {
    color: var(--color-primary);
}

.separator {
    color: var(--color-border);
}

.current {
    color: var(--color-text);
}

 
.translation-disclaimer {
    background: #fef3c7;
    border: 1px solid #f59e0b;
    border-radius: var(--radius-md);
    padding: var(--spacing-md);
    margin-bottom: var(--spacing-lg);
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: var(--spacing-md);
    flex-wrap: wrap;
}

.dark .translation-disclaimer {
    background: #78350f;
    border-color: #d97706;
}

.disclaimer-message {
    color: #92400e;
    font-size: 0.875rem;
}

.dark .disclaimer-message {
    color: #fde047;
}

.disclaimer-link {
    color: #92400e;
    font-weight: 600;
    text-decoration: underline;
    white-space: nowrap;
}

.dark .disclaimer-link {
    color: #fde047;
}

 
.proposal-header {
    margin-bottom: var(--spacing-2xl);
}

.proposal-title-section {
    margin-bottom: var(--spacing-lg);
}

.proposal-title {
    font-size: 2.5rem;
    margin: 0 0 var(--spacing-sm) 0;
    color: var(--color-text);
}

.proposal-number {
    font-size: 0.875rem;
    color: var(--color-text-muted);
    font-weight: 600;
}

 
.proposal-meta-box {
    background: var(--color-bg-secondary);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-lg);
    padding: var(--spacing-lg);
}

.proposal-status {
    display: inline-block;
    padding: var(--spacing-xs) var(--spacing-md);
    border-radius: var(--radius-md);
    font-weight: 600;
    font-size: 0.875rem;
    margin-bottom: var(--spacing-md);
    text-transform: uppercase;
    letter-spacing: 0.05em;
}

 
.status-open {
    background: #dbeafe;
    color: #0369a1;
}

.dark .status-open {
    background: #0c4a6e;
    color: #7dd3fc;
}

.status-accepted {
    background: #dbeafe;
    color: #0369a1;
}

.dark .status-accepted {
    background: #0c4a6e;
    color: #7dd3fc;
}

.status-finished {
    background: #dcfce7;
    color: #15803d;
}

.dark .status-finished {
    background: #164e63;
    color: #86efac;
}

.status-closed {
    background: #dcfce7;
    color: #15803d;
}

.dark .status-closed {
    background: #164e63;
    color: #86efac;
}

.status-rejected {
    background: #fee2e2;
    color: #991b1b;
}

.dark .status-rejected {
    background: #7f1d1d;
    color: #fca5a5;
}

.status-draft,
.status-needs-revision,
.status-dead,
.status-needs-research {
    background: #fef3c7;
    color: #92400e;
}

.dark .status-draft,
.dark .status-needs-revision,
.dark .status-dead,
.dark .status-needs-research {
    background: #78350f;
    color: #fde047;
}

.status-meta,
.status-informational,
.status-reserve {
    background: #e9d5ff;
    color: #6b21a8;
}

.dark .status-meta,
.dark .status-informational,
.dark .status-reserve {
    background: #581c87;
    color: #e879f9;
}

 
.proposal-info-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: var(--spacing-md);
    margin-bottom: var(--spacing-lg);
}

.info-item {
    display: flex;
    flex-direction: column;
    gap: var(--spacing-xs);
}

.info-label {
    font-size: 0.75rem;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    color: var(--color-text-muted);
}

.info-value {
    font-size: 0.9375rem;
    color: var(--color-text);
    font-weight: 500;
}

 
.proposal-relationships {
    border-top: 1px solid var(--color-border);
    padding-top: var(--spacing-md);
}

.relationship {
    display: flex;
    gap: var(--spacing-md);
    margin-bottom: var(--spacing-sm);
}

.relationship:last-child {
    margin-bottom: 0;
}

.relationship-label {
    font-weight: 600;
    color: var(--color-text-muted);
    min-width: 120px;
}

.relationship-value {
    color: var(--color-text);
}

 
.proposal-layout {
    display: block;
}

.proposal-layout--with-toc {
    display: grid;
    grid-template-columns: 260px 1fr;
    gap: var(--spacing-2xl);
    align-items: start;
}

 
.proposal-toc-sidebar {
    position: sticky;
    top: 100px;
    max-height: calc(100vh - 120px);
    overflow-y: auto;
}

.toc-nav {
    background: var(--color-bg-secondary);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-lg);
    padding: var(--spacing-md);
}

.toc-header {
    display: flex;
    align-items: center;
    gap: var(--spacing-sm);
    font-weight: 700;
    font-size: 0.875rem;
    color: var(--color-text);
    padding-bottom: var(--spacing-md);
    margin-bottom: var(--spacing-md);
    border-bottom: 1px solid var(--color-border);
}

.toc-content {
    max-height: calc(100vh - 250px);
    overflow-y: auto;
}

.toc-content::-webkit-scrollbar {
    width: 4px;
}

.toc-content::-webkit-scrollbar-track {
    background: transparent;
}

.toc-content::-webkit-scrollbar-thumb {
    background: var(--color-border);
    border-radius: 2px;
}

.toc-content::-webkit-scrollbar-thumb:hover {
    background: var(--color-text-muted);
}

.toc-nav ul {
    list-style: none;
    padding-left: 0;
    margin: 0;
}

.toc-nav li {
    margin-bottom: 0.25rem;
}

.toc-nav ul ul {
    padding-left: var(--spacing-md);
    margin-top: 0.25rem;
}

.toc-nav a {
    color: var(--color-text-secondary);
    text-decoration: none;
    font-size: 0.8125rem;
    display: block;
    padding: 0.25rem 0.5rem;
    border-radius: var(--radius-sm);
    transition: all var(--transition-fast);
    line-height: 1.4;
}

.toc-nav a:hover {
    color: var(--color-primary);
    background: var(--color-bg-tertiary);
}

 
.proposal-main {
    min-width: 0;
}

 
.proposal-content {
    line-height: 1.8;
    color: var(--color-text);
    max-width: 900px;
}

.proposal-content h2 {
    margin-top: var(--spacing-2xl);
    margin-bottom: var(--spacing-md);
    font-size: 1.75rem;
    scroll-margin-top: 100px;
}

.proposal-content h3 {
    margin-top: var(--spacing-xl);
    margin-bottom: var(--spacing-sm);
    font-size: 1.375rem;
    scroll-margin-top: 100px;
}

.proposal-content h4 {
    margin-top: var(--spacing-lg);
    margin-bottom: var(--spacing-xs);
    font-size: 1.125rem;
    scroll-margin-top: 100px;
}

.proposal-content p {
    margin-bottom: var(--spacing-md);
}

.proposal-content ul,
.proposal-content ol {
    margin-bottom: var(--spacing-md);
    padding-left: var(--spacing-xl);
}

.proposal-content li {
    margin-bottom: var(--spacing-xs);
}

.proposal-content code {
    background: var(--color-bg-secondary);
    padding: 0.125rem 0.375rem;
    border-radius: var(--radius-sm);
    font-size: 0.875em;
    font-family: 'Courier New', monospace;
}

.proposal-content pre {
    background: var(--color-bg-secondary);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-md);
    padding: var(--spacing-md);
    overflow-x: auto;
    margin-bottom: var(--spacing-md);
    font-size: 0.875rem;
}

.proposal-content pre code {
    background: none;
    padding: 0;
}

.proposal-content blockquote {
    border-left: 4px solid var(--color-primary);
    padding-left: var(--spacing-md);
    margin-left: 0;
    margin-bottom: var(--spacing-md);
    font-style: italic;
    color: var(--color-text-secondary);
}

.proposal-content a {
    color: var(--color-primary);
    text-decoration: none;
    border-bottom: 1px solid transparent;
    transition: border-color var(--transition-fast);
}

.proposal-content a:hover {
    border-bottom-color: var(--color-primary);
}

.proposal-content table {
    width: 100%;
    border-collapse: collapse;
    margin-bottom: var(--spacing-md);
}

.proposal-content table th {
    background: var(--color-bg-secondary);
    padding: var(--spacing-sm);
    text-align: left;
    font-weight: 600;
    border-bottom: 2px solid var(--color-border);
}

.proposal-content table td {
    padding: var(--spacing-sm);
    border-bottom: 1px solid var(--color-border);
}

.proposal-content img {
    max-width: 100%;
    height: auto;
    border-radius: var(--radius-md);
    border: 1px solid var(--color-border);
    margin: var(--spacing-lg) 0;
    display: block;
}

 
.page-nav {
    margin-top: var(--spacing-2xl);
    padding-top: var(--spacing-xl);
    border-top: 1px solid var(--color-border);
    display: flex;
    gap: var(--spacing-md);
    flex-wrap: wrap;
}

.page-nav-link {
    display: inline-block;
    padding: var(--spacing-md) var(--spacing-lg);
    background: var(--color-bg-secondary);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-md);
    color: var(--color-text);
    text-decoration: none;
    transition: all var(--transition-fast);
}

.page-nav-link:hover {
    border-color: var(--color-primary);
    color: var(--color-primary);
}

 
@media (max-width: 1024px) {
    .proposal-layout--with-toc {
        grid-template-columns: 1fr;
    }

    .proposal-toc-sidebar {
        position: static;
        max-height: none;
        margin-bottom: var(--spacing-xl);
    }

    .toc-content {
        max-height: 300px;
    }
}

@media (max-width: 768px) {
    .proposal-title {
        font-size: 1.75rem;
    }

    .proposal-info-grid {
        grid-template-columns: 1fr;
    }
}
</style>



<script>
document.addEventListener('DOMContentLoaded', function() {
    const tocLinks = document.querySelectorAll('.toc-nav a');
    const headings = [];

    tocLinks.forEach(link => {
        const href = link.getAttribute('href');
        if (href && href.startsWith('#')) {
            const heading = document.getElementById(href.slice(1));
            if (heading) {
                headings.push({ element: heading, link: link });
            }
        }
    });

    function updateActiveLink() {
        const scrollPos = window.scrollY + 120;
        let activeIndex = 0;

        for (let i = 0; i < headings.length; i++) {
            if (headings[i].element.offsetTop <= scrollPos) {
                activeIndex = i;
            }
        }

        tocLinks.forEach(link => link.classList.remove('active'));
        if (headings[activeIndex]) {
            headings[activeIndex].link.classList.add('active');
        }
    }

    window.addEventListener('scroll', updateActiveLink);
    updateActiveLink();
});
</script>
<style>
.toc-nav a.active {
    color: var(--color-primary);
    background: var(--color-bg-tertiary);
    font-weight: 600;
}
</style>



    </main>

    <footer class="site-footer">
    <div class="container">
        <div class="footer-grid">
            <div class="footer-col footer-brand">
                <img src="../../../images/i2plogo_lightmode.svg" alt="I2P Logo" class="footer-logo logo-light" loading="lazy" decoding="async">
                <img src="../../../images/i2plogo_darkmode.svg" alt="I2P Logo" class="footer-logo logo-dark" loading="lazy" decoding="async">
                <p class="footer-tagline">Privacy. Security. Freedom.</p>
                <p class="footer-description">The Invisible Internet Project - A privacy-focused, anonymous network layer</p>

                <div class="footer-social-newsletter">
                    <div class="social-links">
                        <a href="https://mastodon.social/@i2p" target="_blank" rel="noopener" aria-label="Mastodon">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M21.327 8.566c0-4.339-2.843-5.61-2.843-5.61-1.433-.658-3.894-.935-6.451-.956h-.063c-2.557.021-5.016.298-6.45.956 0 0-2.843 1.272-2.843 5.61 0 .993-.019 2.181.012 3.441.103 4.243.778 8.425 4.701 9.463 1.809.479 3.362.579 4.612.51 2.268-.126 3.541-.809 3.541-.809l-.075-1.646s-1.621.511-3.441.449c-1.804-.062-3.707-.194-3.999-2.409a4.523 4.523 0 0 1-.04-.621s1.77.433 4.014.536c1.372.063 2.658-.08 3.965-.236 2.506-.299 4.688-1.843 4.962-3.254.434-2.223.398-5.424.398-5.424zm-3.353 5.59h-2.081V9.057c0-1.075-.452-1.62-1.357-1.62-1 0-1.501.647-1.501 1.927v2.791h-2.069V9.364c0-1.28-.501-1.927-1.502-1.927-.905 0-1.357.546-1.357 1.62v5.099H6.026V8.903c0-1.074.273-1.927.823-2.558.566-.631 1.307-.955 2.228-.955 1.065 0 1.872.409 2.405 1.228l.518.869.519-.869c.533-.819 1.34-1.228 2.405-1.228.92 0 1.662.324 2.228.955.549.631.822 1.484.822 2.558v5.253z"/>
                            </svg>
                        </a>
                        <a href="https://twitter.com/GetI2P" target="_blank" rel="noopener" aria-label="Twitter">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/>
                            </svg>
                        </a>
                        <a href="https://old.reddit.com/r/i2p" target="_blank" rel="noopener" aria-label="Reddit">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M12 0A12 12 0 0 0 0 12a12 12 0 0 0 12 12 12 12 0 0 0 12-12A12 12 0 0 0 12 0zm5.01 4.744c.688 0 1.25.561 1.25 1.249a1.25 1.25 0 0 1-2.498.056l-2.597-.547-.8 3.747c1.824.07 3.48.632 4.674 1.488.308-.309.73-.491 1.207-.491.968 0 1.754.786 1.754 1.754 0 .716-.435 1.333-1.01 1.614a3.111 3.111 0 0 1 .042.52c0 2.694-3.13 4.87-7.004 4.87-3.874 0-7.004-2.176-7.004-4.87 0-.183.015-.366.043-.534A1.748 1.748 0 0 1 4.028 12c0-.968.786-1.754 1.754-1.754.463 0 .898.196 1.207.49 1.207-.883 2.878-1.43 4.744-1.487l.885-4.182a.342.342 0 0 1 .14-.197.35.35 0 0 1 .238-.042l2.906.617a1.214 1.214 0 0 1 1.108-.701zM9.25 12C8.561 12 8 12.562 8 13.25c0 .687.561 1.248 1.25 1.248.687 0 1.248-.561 1.248-1.249 0-.688-.561-1.249-1.249-1.249zm5.5 0c-.687 0-1.248.561-1.248 1.25 0 .687.561 1.248 1.249 1.248.688 0 1.249-.561 1.249-1.249 0-.687-.562-1.249-1.25-1.249zm-5.466 3.99a.327.327 0 0 0-.231.094.33.33 0 0 0 0 .463c.842.842 2.484.913 2.961.913.477 0 2.105-.056 2.961-.913a.361.361 0 0 0 .029-.463.33.33 0 0 0-.464 0c-.547.533-1.684.73-2.512.73-.828 0-1.979-.196-2.512-.73a.326.326 0 0 0-.232-.095z"/>
                            </svg>
                        </a>
                        <a href="https://signal.group/#CjQKIOSUTtxlhbumAKcRsthPFkxkTUrkWcX39bbN6njLEgAIEhCTNsR0KDuiehAXZnkt42v5" target="_blank" rel="noopener" aria-label="Signal" class="signal-link">
                            <img src="../../../images/Signal-Logo-Black.svg" alt="Signal" class="signal-logo signal-logo-light" loading="lazy" decoding="async">
                            <img src="../../../images/Signal-Logo-White.svg" alt="Signal" class="signal-logo signal-logo-dark" loading="lazy" decoding="async">
                        </a>
                    </div>

                    
                    <div class="footer-newsletter-inline">
                        <p class="newsletter-description">Fique atualizado com as notícias do I2P:</p>
                        <form action="https://feedback.i2p.net/api/mailing-list/subscribe" method="POST" class="newsletter-form">
                            <input type="email" name="email" placeholder="Digite seu e-mail" required>
                            <button type="submit">Inscrever-se</button>
                        </form>
                    </div>
                </div>
            </div>

            <div class="footer-col">
                <h3>Links Rápidos</h3>
                <ul>
                    <li><a href="../../../pt/financial-support/">Doar</a></li>
                    <li><a href="../../../pt/docs/overview/intro/">Introdução ao I2P</a></li>
                </ul>
            </div>

            <div class="footer-col">
                <h3>Comunidade</h3>
                <ul>
                    <li><a href="../../../pt/get-involved/">Participe</a></li>
                    <li><a href="../../../pt/blog/">Blog</a></li>
                    <li><a href="http://i2pforum.net/" target="_blank" rel="noopener">Fóruns Oficiais</a></li>
                    <li><a href="../../../pt/contact/">Contato</a></li>
                </ul>
            </div>

            <div class="footer-col">
                <h3>Recursos</h3>
                <ul>
                    <li><a href="https://i2p-metrics.np-tokumei.net/" target="_blank" rel="noopener">Métricas I2P</a></li>
                    <li><a href="../../../pt/papers/">Pesquisa</a></li>
                    <li><a href="https://i2pgit.org/" target="_blank" rel="noopener">GitLab</a></li>
                    <li><a href="https://www.stormycloud.org/" target="_blank" rel="noopener">StormyCloud</a></li>
                </ul>
            </div>
        </div>

        <div class="footer-bottom">
            <p class="copyright">&copy; 2025 O Projeto de Internet Invisível. Licenciado sob Creative Commons.</p>
            <div class="footer-links">
                <a href="../../../pt/privacy/">Privacidade</a>
                <a href="../../../pt/terms/">Termos</a>
                <a href="../../../pt/about/media/">Imprensa</a>
            </div>
        </div>
    </div>
</footer>


    
    
<div class="modal-overlay" id="poll">
    <div class="modal-content poll-modal-content">
        <a href="#" class="modal-close" aria-label="Fechar">
            <span aria-hidden="true">&times;</span>
        </a>

        <div class="modal-header">
            <h2>Enquete da comunidade</h2>
            <p class="modal-subtitle">Gostaríamos de ouvir sua opinião</p>
        </div>

        <div class="modal-body">
            
            <iframe 
                id="poll-iframe"
                data-poll-id="2"
                data-api-url="https://feedback.i2p.net"
                frameborder="0"
                scrolling="no"
                style="width: 100%; border: none; min-height: 400px;">
            </iframe>
        </div>

        <div class="modal-footer">
            <p class="modal-disclaimer">
                Seu voto ajuda a moldar o futuro do I2P.
            </p>
        </div>
    </div>
</div>


<script>
(function() {
    const iframe = document.getElementById('poll-iframe');
    if (!iframe) return;
    
    const hostname = window.location.hostname;
    let apiUrl = 'https://feedback.i2p.net';
    const pollId = iframe.getAttribute('data-poll-id') || '1';

    
    if (hostname.endsWith('.b32.i2p') || hostname.endsWith('.i2p')) {
        apiUrl = 'http://5kwyynf3eetgqa2nors6ctwo7doi7yu73k7uvypy5eqmm326zkiq.b32.i2p';
    }
    
    else if (hostname.endsWith('.onion')) {
        apiUrl = 'http://gfonxmohvarpmocsvllscsuszdu5rikipm6innvcwq4vpng7zzqmmfyd.onion';
    }

    
    const pollUrl = apiUrl + '/widgets/poll.html?poll_id=' + encodeURIComponent(pollId) + '&api_url=' + encodeURIComponent(apiUrl);
    iframe.src = pollUrl;
})();
</script>



    
    



    
    <script>
        (function () {
            'use strict';
            var hostname = window.location.hostname;
            var baseUrl;

            
            if (hostname.endsWith('.b32.i2p') || hostname.endsWith('.i2p')) {
                baseUrl = 'http://5kwyynf3eetgqa2nors6ctwo7doi7yu73k7uvypy5eqmm326zkiq.b32.i2p';
            } else if (hostname.endsWith('.onion')) {
                baseUrl = 'http://gfonxmohvarpmocsvllscsuszdu5rikipm6innvcwq4vpng7zzqmmfyd.onion';
            } else {
                baseUrl = 'https://feedback.i2p.net';
            }

            window.feedbackBaseUrl = baseUrl;

            
            document.querySelectorAll('[data-api-url]').forEach(function (widget) {
                widget.setAttribute('data-api-url', baseUrl);
            });

            
            document.write('<link rel="stylesheet" href="' + baseUrl + '/widgets/styles.css">');
            
        })();
    </script>

    

    
    
    

    

</body>

</html>
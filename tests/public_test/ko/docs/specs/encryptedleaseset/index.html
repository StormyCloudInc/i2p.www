<!DOCTYPE html>
<html lang="ko" data-theme="light">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <title>암호화된 LeaseSet | I2P - 보이지 않는 인터넷 프로젝트</title>

    <meta name="description" content="비공개 Destinations(목적지 식별자)용 접근 제어된 LeaseSet 형식">
    <meta name="keywords" content="i2p, privacy, anonymity, dark net, encryption, security">

    
    <meta property="og:title" content="암호화된 LeaseSet | I2P - 보이지 않는 인터넷 프로젝트">
    <meta property="og:description" content="비공개 Destinations(목적지 식별자)용 접근 제어된 LeaseSet 형식">
    <meta property="og:type" content="website">
    <meta property="og:url" content="/ko/docs/specs/encryptedleaseset/">

    
    <link rel="icon" type="image/svg+xml" href="../../../../images/favicon.svg">
    <link rel="icon" type="image/png" href="../../../../images/i2plogo.png" sizes="32x32">

    
    
    
    
    <link rel="stylesheet" href="../../../../css/main.min.be6880f32f5ff44e57579da7b11513b973319944ebe38748e3ac7f3268662d18.css" integrity="sha256-vmiA8y9f9E5XV52nsRUTuXMxmUTr44dI46x/MmhmLRg=">
    


    
</head>

<body>
    
    <input type="checkbox" id="theme-toggle-checkbox" class="theme-checkbox" aria-hidden="true">

    
<div class="site-banner" id="site-banner" data-banner-id="banner-3" role="alert" aria-live="polite">
    <div class="container">
        <div class="banner-content">
            <span class="banner-message">I2P 베타 사이트 현재 운영 중 문의사항은 stormycloud@mail.i2p로 이메일 주세요</span>
            
        </div>
        
        <form method="GET" action="../../../../api/banner/dismiss" style="display: inline;">
            <input type="hidden" name="id" value="banner-3">
            <button type="submit" class="banner-close" aria-label="배너 닫기" title="배너 닫기">
                <span aria-hidden="true">&times;</span>
            </button>
        </form>
        
    </div>
</div>


    <header class="site-header">
    <div class="container">
        <nav class="main-nav">
            <div class="nav-brand">
                <a href="../../../../ko/" class="logo-link">
                    <img src="../../../../images/i2plogo_lightmode.svg" alt="I2P Logo" class="logo logo-light">
                    <img src="../../../../images/i2plogo_darkmode.svg" alt="I2P Logo" class="logo logo-dark">
                </a>
            </div>

            
            <input type="checkbox" id="mobile-menu-checkbox" class="mobile-menu-checkbox"
                aria-label="Toggle navigation menu">
            <label for="mobile-menu-checkbox" class="mobile-menu-toggle" aria-label="Toggle navigation menu">
                <span class="hamburger"></span>
            </label>

            <div class="nav-menu">
                <ul class="nav-links">
                    <li class="nav-dropdown">
                        <a href="../../../../ko/about/" class="">소개</a>
                        <ul class="dropdown-menu">
                            <li><a href="../../../../ko/about/">개요</a></li>
                            <li><a href="../../../../ko/papers/">연구 논문</a></li>
                            <li><a href="../../../../ko/about/media/">보도자료</a></li>
                            <li><a href="../../../../ko/contact/">문의하기</a></li>
                        </ul>
                    </li>
                    <li><a href="../../../../ko/docs/" class="active">문서</a></li>
                    <li><a href="../../../../ko/downloads/" class="">다운로드</a></li>
                    <li><a href="../../../../ko/blog/" class="">블로그</a></li>
                    <li class="nav-dropdown">
                        <a href="../../../../ko/get-involved/" class="">참여하기</a>
                        <ul class="dropdown-menu">
                            <li><a href="../../../../ko/get-involved/">개요</a></li>
                            <li><a href="../../../../ko/feedback/">기능 제안</a></li>
                        </ul>
                    </li>
                </ul>

                <div class="nav-actions">
                    
                    <div class="language-selector">
                        <button class="language-toggle" aria-label="Select language" title="Language">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none"
                                xmlns="http://www.w3.org/2000/svg">
                                <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2" />
                                <path
                                    d="M2 12h20M12 2a15.3 15.3 0 014 10 15.3 15.3 0 01-4 10 15.3 15.3 0 01-4-10 15.3 15.3 0 014-10z"
                                    stroke="currentColor" stroke-width="2" />
                            </svg>
                            <span class="current-lang">ko</span>
                        </button>
                        <div class="language-dropdown">
                            
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../../en/docs/specs/encryptedleaseset/"
                                class="lang-option">영어</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../../es/docs/specs/encryptedleaseset/"
                                class="lang-option">스페인어</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../../ko/docs/specs/encryptedleaseset/"
                                class="lang-option active">한국어</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../../zh/docs/specs/encryptedleaseset/"
                                class="lang-option">중국어</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../../ru/docs/specs/encryptedleaseset/"
                                class="lang-option">러시아어</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../../cs/docs/specs/encryptedleaseset/"
                                class="lang-option">체코어</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../../de/docs/specs/encryptedleaseset/"
                                class="lang-option">독일어</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../../fr/docs/specs/encryptedleaseset/"
                                class="lang-option">프랑스어</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../../tr/docs/specs/encryptedleaseset/"
                                class="lang-option">터키어</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../../vi/docs/specs/encryptedleaseset/"
                                class="lang-option">베트남어</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../../hi/docs/specs/encryptedleaseset/"
                                class="lang-option">힌디어</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../../ar/docs/specs/encryptedleaseset/"
                                class="lang-option">아랍어</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../../pt/docs/specs/encryptedleaseset/"
                                class="lang-option">포르투갈어</a>
                            
                            
                        </div>
                    </div>

                    
                    <label for="theme-toggle-checkbox" class="theme-toggle" aria-label="Toggle dark mode"
                        title="Toggle theme">
                        <svg class="sun-icon" width="20" height="20" viewBox="0 0 20 20" fill="none"
                            xmlns="http://www.w3.org/2000/svg">
                            <circle cx="10" cy="10" r="4" stroke="currentColor" stroke-width="2" />
                            <path
                                d="M10 2V4M10 16V18M18 10H16M4 10H2M15.657 4.343L14.243 5.757M5.757 14.243L4.343 15.657M15.657 15.657L14.243 14.243M5.757 5.757L4.343 4.343"
                                stroke="currentColor" stroke-width="2" stroke-linecap="round" />
                        </svg>
                        <svg class="moon-icon" width="20" height="20" viewBox="0 0 20 20" fill="none"
                            xmlns="http://www.w3.org/2000/svg">
                            <path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"
                                stroke="currentColor" stroke-width="2" stroke-linejoin="round" />
                        </svg>
                    </label>

                    
                    <a href="../../../../ko/financial-support/" class="btn btn-primary" id="donate-btn">Donate</a>

                    
                    <a href="../../../../ko/downloads/" class="btn btn-primary">I2P 다운로드</a>
                </div>
            </div>
        </nav>
    </div>
</header>

    <main id="main-content">
        




<div class="docs-page">
    <div class="container">
        
        <div class="docs-layout docs-layout--with-toc">
            
            
            <aside class="docs-toc-sidebar">
                <nav class="toc-nav">
                    <div class="toc-header">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                            <path d="M4 6h16M4 12h16M4 18h16" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                        </svg>
                        On This Page
                    </div>
                    <div class="toc-content">
                        <nav id="TableOfContents">
  <ul>
    <li><a href="#개요">개요</a></li>
    <li><a href="#버전-이력-및-구현-현황">버전 이력 및 구현 현황</a>
      <ul>
        <li><a href="#프로토콜-개발-타임라인">프로토콜 개발 타임라인</a></li>
        <li><a href="#구현-마일스톤">구현 마일스톤</a></li>
      </ul>
    </li>
    <li><a href="#암호학적-정의">암호학적 정의</a>
      <ul>
        <li><a href="#표기법-및-관례">표기법 및 관례</a></li>
        <li><a href="#암호학적으로-안전한-난수-생성기n">암호학적으로 안전한 난수 생성기(n)</a></li>
        <li><a href="#hp-d">H(p, d)</a></li>
        <li><a href="#스트림-chacha20">스트림: ChaCha20</a></li>
        <li><a href="#서명-red25519ed25519-기반-reddsa-서명-알고리즘">서명: Red25519(Ed25519 기반 RedDSA 서명 알고리즘)</a></li>
        <li><a href="#dh디피-헬먼-키-교환-x25519">DH(디피-헬먼 키 교환): X25519</a></li>
        <li><a href="#hkdfhmac-기반-추출-확장-키-파생-함수">HKDF(HMAC 기반 추출-확장 키 파생 함수)</a></li>
      </ul>
    </li>
    <li><a href="#형식-명세">형식 명세</a>
      <ul>
        <li><a href="#레이어-0-외부---평문">레이어 0 (외부) - 평문</a></li>
        <li><a href="#레이어-1-중간---클라이언트-인가">레이어 1 (중간) - 클라이언트 인가</a></li>
        <li><a href="#레이어-2-내부---leaseset-데이터">레이어 2 (내부) - LeaseSet 데이터</a></li>
      </ul>
    </li>
    <li><a href="#블라인딩-키-파생">블라인딩 키 파생</a>
      <ul>
        <li><a href="#개요-1">개요</a></li>
        <li><a href="#수학적-정의">수학적 정의</a></li>
        <li><a href="#알파-생성">알파 생성</a></li>
        <li><a href="#개인키-블라인딩">개인키 블라인딩</a></li>
        <li><a href="#공개-키-블라인딩">공개 키 블라인딩</a></li>
        <li><a href="#blinded-keys블라인딩된-키를-사용한-서명">Blinded Keys(블라인딩된 키)를 사용한 서명</a></li>
        <li><a href="#보안-고려사항">보안 고려사항</a></li>
      </ul>
    </li>
    <li><a href="#암호화-및-처리">암호화 및 처리</a>
      <ul>
        <li><a href="#하위-자격-증명-파생">하위 자격 증명 파생</a></li>
        <li><a href="#레이어-1-암호화">레이어 1 암호화</a></li>
        <li><a href="#2계층-암호화">2계층 암호화</a></li>
        <li><a href="#암호화-계층-요약">암호화 계층 요약</a></li>
      </ul>
    </li>
    <li><a href="#클라이언트별-권한-부여">클라이언트별 권한 부여</a>
      <ul>
        <li><a href="#개요-2">개요</a></li>
        <li><a href="#dh디피-헬먼-클라이언트-인가">DH(디피-헬먼) 클라이언트 인가</a></li>
        <li><a href="#psk-클라이언트-인가">PSK 클라이언트 인가</a></li>
        <li><a href="#비교-및-권장-사항">비교 및 권장 사항</a></li>
        <li><a href="#보안-고려-사항">보안 고려 사항</a></li>
      </ul>
    </li>
    <li><a href="#암호화된-leasesetsi2p-목적지-접근-정보-세트용-base32-주소-체계">암호화된 LeaseSets(I2P 목적지 접근 정보 세트)용 Base32 주소 체계</a>
      <ul>
        <li><a href="#개요-3">개요</a></li>
        <li><a href="#주소-형식-사양">주소 형식 사양</a></li>
        <li><a href="#주소-생성">주소 생성</a></li>
        <li><a href="#주소-파싱">주소 파싱</a></li>
        <li><a href="#기존-base32와의-비교">기존 Base32와의 비교</a></li>
        <li><a href="#주소록-통합">주소록 통합</a></li>
        <li><a href="#구현-예시">구현 예시</a></li>
        <li><a href="#보안-고려사항-1">보안 고려사항</a></li>
      </ul>
    </li>
    <li><a href="#오프라인-키-지원">오프라인 키 지원</a>
      <ul>
        <li><a href="#개요-4">개요</a></li>
        <li><a href="#오프라인-키-구조">오프라인 키 구조</a></li>
        <li><a href="#키-생성-과정">키 생성 과정</a></li>
      </ul>
    </li>
  </ul>

  <ul>
    <li>
      <ul>
        <li><a href="#security-considerations">Security Considerations</a></li>
        <li><a href="#file-format-todo">File Format (TODO)</a></li>
        <li><a href="#i2cp-protocol-enhancement-todo">I2CP Protocol Enhancement (TODO)</a></li>
        <li><a href="#implementation-status">Implementation Status</a></li>
      </ul>
    </li>
    <li><a href="#security-considerations-1">Security Considerations</a>
      <ul>
        <li><a href="#cryptographic-security">Cryptographic Security</a></li>
        <li><a href="#forward-secrecy">Forward Secrecy</a></li>
        <li><a href="#privacy-properties">Privacy Properties</a></li>
        <li><a href="#threat-model">Threat Model</a></li>
        <li><a href="#attack-scenarios">Attack Scenarios</a></li>
        <li><a href="#operational-security">Operational Security</a></li>
        <li><a href="#implementation-security">Implementation Security</a></li>
        <li><a href="#recommendations">Recommendations</a></li>
      </ul>
    </li>
    <li><a href="#implementation-notes">Implementation Notes</a>
      <ul>
        <li><a href="#java-i2p-implementation">Java I2P Implementation</a></li>
        <li><a href="#i2pd-c-implementation">i2pd (C++) Implementation</a></li>
        <li><a href="#testing-and-debugging">Testing and Debugging</a></li>
        <li><a href="#performance-considerations">Performance Considerations</a></li>
        <li><a href="#compatibility">Compatibility</a></li>
      </ul>
    </li>
    <li><a href="#references">References</a>
      <ul>
        <li><a href="#ietf-rfcs">IETF RFCs</a></li>
        <li><a href="#i2p-specifications">I2P Specifications</a></li>
        <li><a href="#cryptographic-references">Cryptographic References</a></li>
        <li><a href="#security-references">Security References</a></li>
        <li><a href="#implementation-references">Implementation References</a></li>
        <li><a href="#version-history">Version History</a></li>
      </ul>
    </li>
    <li><a href="#appendix-a-cryptographic-constants">Appendix A: Cryptographic Constants</a>
      <ul>
        <li><a href="#ed25519--red25519-constants">Ed25519 / Red25519 Constants</a></li>
        <li><a href="#chacha20-constants">ChaCha20 Constants</a></li>
        <li><a href="#hkdf-constants">HKDF Constants</a></li>
        <li><a href="#hash-personalization-strings">Hash Personalization Strings</a></li>
        <li><a href="#structure-sizes">Structure Sizes</a></li>
      </ul>
    </li>
    <li><a href="#appendix-b-test-vectors">Appendix B: Test Vectors</a>
      <ul>
        <li><a href="#test-vector-1-alpha-generation">Test Vector 1: Alpha Generation</a></li>
        <li><a href="#test-vector-2-chacha20-encryption">Test Vector 2: ChaCha20 Encryption</a></li>
        <li><a href="#test-vector-3-hkdf">Test Vector 3: HKDF</a></li>
        <li><a href="#test-vector-4-base32-address">Test Vector 4: Base32 Address</a></li>
      </ul>
    </li>
    <li><a href="#appendix-c-glossary">Appendix C: Glossary</a></li>
    <li><a href="#document-information">Document Information</a></li>
  </ul>
</nav>
                    </div>
                </nav>
            </aside>
            

            
            <div class="docs-main">
                
                <nav class="breadcrumbs">
                    <a href="../../../../ko/">Home</a>
                    <span class="separator">/</span>
                    <a href="../../../../ko/docs/">Docs</a>
                    
                        
                            <span class="separator">/</span>
                            <a href="../../../../ko/docs/specs/">Specifications</a>
                        
                    
                    <span class="separator">/</span>
                    <span class="current">암호화된 LeaseSet</span>
                </nav>

                
<div class="translation-disclaimer" role="note">
    <span class="disclaimer-message">이 번역은 기계 학습을 사용하여 생성되었으며 100% 정확하지 않을 수 있습니다.</span>
    
    
    <a href="../../../../en/docs/specs/encryptedleaseset/" class="disclaimer-link">영어 버전 보기</a>
    
</div>



                
                <header class="article-header">
                    <h1 class="article-title">암호화된 LeaseSet</h1>
                    
                        <p class="article-description">비공개 Destinations(목적지 식별자)용 접근 제어된 LeaseSet 형식</p>
                    
                    <div class="article-meta">
                        
                            <span class="meta-item">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                                    <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2"/>
                                    <path d="M12 6v6l4 2" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                                </svg>
                                Updated: 2025-10
                            </span>
                        
                        
                            <span class="meta-item">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                                    <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" stroke="currentColor" stroke-width="2"/>
                                </svg>
                                Accurate for: 2.10.0
                            </span>
                        
                    </div>
                </header>

                
                <article class="article-content">
                    <h2 id="개요">개요</h2>
<p>이 문서는 암호화된 LeaseSet2 (LS2)의 블라인딩, 암호화 및 복호화를 명세한다. 암호화된 LeaseSet은 I2P netDb(네트워크 데이터베이스)에서 은닉 서비스 정보의 접근 제어가 적용된 게시를 제공한다.</p>
<p><strong>주요 기능:</strong> - 전방향 기밀성을 위한 일일 키 순환 - 이중 계층 클라이언트 인가(DH(디피-헬만) 기반 및 PSK(사전 공유 키) 기반) - AES 하드웨어 지원이 없는 장치에서의 성능을 위한 ChaCha20 암호화 - key blinding(키 블라인딩)을 적용한 Red25519 서명 - 프라이버시 보존형 클라이언트 멤버십</p>
<p><strong>관련 문서:</strong> - <a href="../../../../ko/docs/specs/common-structures/">공통 구조 명세</a>
 - 암호화된 LeaseSet(리스셋: I2P 목적지의 연결 정보 묶음) 구조 - <a href="../../../../ko/proposals/123-new-netdb-entries/">제안 123: 새로운 netDB(I2P 네트워크 데이터베이스) 항목</a>
 - 암호화된 LeaseSets에 대한 배경 - <a href="../../../../ko/docs/specs/common-structures/">네트워크 데이터베이스 문서</a>
 - NetDB 사용</p>
<hr>
<h2 id="버전-이력-및-구현-현황">버전 이력 및 구현 현황</h2>
<h3 id="프로토콜-개발-타임라인">프로토콜 개발 타임라인</h3>
<p><strong>버전 번호 지정에 대한 중요 참고 사항:</strong>   I2P는 두 가지 별도의 버전 번호 체계를 사용합니다: - <strong>API/Router 버전:</strong> 0.9.x 계열 (기술 사양에서 사용) - <strong>제품 릴리스 버전:</strong> 2.x.x 계열 (공개 릴리스에 사용)</p>
<p>기술 사양서는 API 버전(예: 0.9.41)을 참조하고, 반면 최종 사용자는 제품 버전(예: 2.10.0)을 보게 됩니다.</p>
<h3 id="구현-마일스톤">구현 마일스톤</h3>
<table style="width:100%; border-collapse:collapse; margin-bottom:1.5rem;">
  <thead>
    <tr>
      <th style="border:1px solid var(--color-border); padding:0.5rem; background:var(--color-bg-secondary); text-align:left;">Version</th>
      <th style="border:1px solid var(--color-border); padding:0.5rem; background:var(--color-bg-secondary); text-align:center;">Release Date</th>
      <th style="border:1px solid var(--color-border); padding:0.5rem; background:var(--color-bg-secondary); text-align:left;">Features</th>
    </tr>
  </thead>
  <tbody>
    <tr><td style="border:1px solid var(--color-border); padding:0.5rem;"><strong>0.9.38</strong></td><td style="border:1px solid var(--color-border); padding:0.5rem; text-align:center;">January 2019</td><td style="border:1px solid var(--color-border); padding:0.5rem;">Floodfill support for standard LS2, offline keys</td></tr>
    <tr><td style="border:1px solid var(--color-border); padding:0.5rem;"><strong>0.9.39</strong></td><td style="border:1px solid var(--color-border); padding:0.5rem; text-align:center;">March 2019</td><td style="border:1px solid var(--color-border); padding:0.5rem;">Full encrypted LS2 support, Red25519 (sig type&nbsp;11)</td></tr>
    <tr><td style="border:1px solid var(--color-border); padding:0.5rem;"><strong>0.9.40</strong></td><td style="border:1px solid var(--color-border); padding:0.5rem; text-align:center;">May 2019</td><td style="border:1px solid var(--color-border); padding:0.5rem;"><strong>Per-client authorization, encrypted LS2 with offline keys, B32 support</strong></td></tr>
    <tr><td style="border:1px solid var(--color-border); padding:0.5rem;"><strong>0.9.41</strong></td><td style="border:1px solid var(--color-border); padding:0.5rem; text-align:center;">June 2019</td><td style="border:1px solid var(--color-border); padding:0.5rem;"><strong>Protocol finalized as stable</strong></td></tr>
    <tr><td style="border:1px solid var(--color-border); padding:0.5rem;"><strong>2.10.0</strong></td><td style="border:1px solid var(--color-border); padding:0.5rem; text-align:center;">September 2025</td><td style="border:1px solid var(--color-border); padding:0.5rem;">Latest Java implementation (API version 0.9.61)</td></tr>
    <tr><td style="border:1px solid var(--color-border); padding:0.5rem;"><strong>i2pd 2.58.0</strong></td><td style="border:1px solid var(--color-border); padding:0.5rem; text-align:center;">September 2025</td><td style="border:1px solid var(--color-border); padding:0.5rem;">Full C++ implementation compatibility</td></tr>
  </tbody>
</table>
### 현재 상태
<ul>
<li>✅ <strong>프로토콜 상태:</strong> 2019년 6월 이후 안정적이며 변경되지 않음</li>
<li>✅ <strong>Java I2P:</strong> 버전 0.9.40+에서 완전히 구현됨</li>
<li>✅ <strong>i2pd (C++):</strong> 버전 2.58.0+에서 완전히 구현됨</li>
<li>✅ <strong>상호운용성:</strong> 구현 간 완전한 상호운용성</li>
<li>✅ <strong>네트워크 배포:</strong> 6년 이상의 운영 경험으로 프로덕션 준비 완료</li>
</ul>
<hr>
<h2 id="암호학적-정의">암호학적 정의</h2>
<h3 id="표기법-및-관례">표기법 및 관례</h3>
<ul>
<li><code>||</code> 는 연결(이어붙이기)을 나타냅니다</li>
<li><code>mod L</code> 는 Ed25519의 차수(order) L에 대한 모듈러 감소를 나타냅니다</li>
<li>달리 명시되지 않는 한 모든 바이트 배열은 네트워크 바이트 순서(빅엔디언)입니다</li>
<li>리틀엔디언 값은 명시적으로 표시됩니다</li>
</ul>
<h3 id="암호학적으로-안전한-난수-생성기n">암호학적으로 안전한 난수 생성기(n)</h3>
<p><strong>암호학적으로 안전한 난수 생성기</strong></p>
<p>키 자료 생성에 적합한 암호학적으로 안전한 난수 데이터를 <code>n</code>바이트 생성합니다.</p>
<p><strong>보안 요구사항:</strong> - 암호학적으로 안전해야 함(키 생성에 적합해야 함) - 네트워크 상에서 인접한 바이트 시퀀스가 노출되더라도 안전해야 함 - 구현체는 잠재적으로 신뢰할 수 없는 소스에서 나온 출력값은 해시 처리하는 것이 좋음</p>
<p><strong>참고자료:</strong> - <a href="http://projectbullrun.org/dual-ec/ext-rand.html">PRNG(의사난수 생성기) 보안 고려사항</a>
 - <a href="https://lists.torproject.org/pipermail/tor-dev/2015-November/009954.html">Tor 개발자 토론</a>
</p>
<h3 id="hp-d">H(p, d)</h3>
<p><strong>개인화가 적용된 SHA-256 해시</strong></p>
<p>도메인 분리가 적용된 해시 함수로 다음을 입력으로 받습니다: - <code>p</code>: 개인화 문자열(도메인 분리를 제공합니다) - <code>d</code>: 해시할 데이터</p>
<p><strong>구현:</strong></p>
<pre tabindex="0"><code>H(p, d) := SHA-256(p || d)
</code></pre><p><strong>Usage:</strong> SHA-256의 서로 다른 프로토콜 용도 간 충돌 공격을 방지하기 위해 암호학적 도메인 분리를 제공합니다.</p>
<h3 id="스트림-chacha20">스트림: ChaCha20</h3>
<p><strong>스트림 암호: RFC 7539 2.4절에 정의된 ChaCha20</strong></p>
<p><strong>매개변수:</strong> - <code>S_KEY_LEN = 32</code> (256비트 키) - <code>S_IV_LEN = 12</code> (96비트 nonce(일회용 임의값)) - 초기 카운터: <code>1</code> (RFC 7539는 0 또는 1을 허용; AEAD 컨텍스트에서는 1을 권장)</p>
<p><strong>ENCRYPT(k, iv, plaintext)</strong></p>
<p>다음을 사용하여 평문을 암호화합니다: - <code>k</code>: 32바이트 암호 키 - <code>iv</code>: 12바이트 nonce(논스, 반드시 각 키마다 고유해야 함) - 평문과 동일한 크기의 암호문을 반환합니다</p>
<p><strong>보안 속성:</strong> 키가 비밀이라면 전체 암호문은 무작위와 구별되지 않아야 한다.</p>
<p><strong>복호화(k, iv, ciphertext)</strong></p>
<p>다음을 사용해 암호문을 복호화합니다: - <code>k</code>: 32바이트 암호 키 - <code>iv</code>: 12바이트 논스 - 평문을 반환합니다</p>
<p><strong>설계 근거:</strong> AES 대신 ChaCha20을 선택한 이유: - 하드웨어 가속이 없는 장치에서는 AES보다 2.5-3배 더 빠름 - 상수 시간 구현을 달성하기가 더 쉬움 - AES-NI(인텔의 AES 전용 명령어 집합) 사용이 가능한 경우에도 보안성과 속도가 비슷함</p>
<p><strong>참고 자료:</strong> - <a href="https://datatracker.ietf.org/doc/html/rfc7539">RFC 7539</a>
 - IETF 프로토콜용 ChaCha20 및 Poly1305</p>
<h3 id="서명-red25519ed25519-기반-reddsa-서명-알고리즘">서명: Red25519(Ed25519 기반 RedDSA 서명 알고리즘)</h3>
<p><strong>서명 방식: Red25519 (SigType 11)와 Key Blinding(키 블라인딩: 서명 키에 난수를 적용해 원본 키 노출을 방지하는 기법)</strong></p>
<p>Red25519는 Ed25519 곡선 위의 Ed25519 서명을 기반으로 하며, 해싱에는 SHA-512를 사용하고, ZCash RedDSA에 명시된 대로 key blinding(키 블라인딩: 원본 키와의 연결을 숨기기 위해 키를 변형하는 기법)을 지원합니다.</p>
<p><strong>기능:</strong></p>
<h4 id="derive_publicprivkey">DERIVE_PUBLIC(privkey)</h4>
<p>주어진 개인 키에 해당하는 공개 키를 반환합니다. - 기준점에 대한 표준 Ed25519 스칼라 곱셈을 사용합니다</p>
<h4 id="signprivkey-m">SIGN(privkey, m)</h4>
<p>개인 키 <code>privkey</code>로 메시지 <code>m</code>에 대한 서명을 반환합니다.</p>
<p><strong>Ed25519와 비교한 Red25519의 서명 차이점:</strong> 1. <strong>무작위 논스:</strong> 추가 80바이트의 무작위 데이터를 사용합니다</p>
<pre tabindex="0"><code>T = CSRNG(80)  // 80 random bytes
r = H*(T || publickey || message)
</code></pre><p>이로 인해 동일한 메시지와 키에 대해서도 모든 Red25519(서명 방식) 서명이 고유해집니다.</p>
<ol start="2">
<li><strong>개인 키 생성:</strong> Red25519 개인 키는 난수로부터 생성된 뒤 <code>mod L</code>로 축약되며, Ed25519의 bit-clamping(비트들을 특정 패턴으로 고정하는 방식) 방식을 사용하지 않습니다.</li>
</ol>
<h4 id="verifypubkey-m-sig">VERIFY(pubkey, m, sig)</h4>
<p>공개키 <code>pubkey</code>와 메시지 <code>m</code>에 대해 서명 <code>sig</code>를 검증합니다. - 서명이 유효하면 <code>true</code>를, 그렇지 않으면 <code>false</code>를 반환합니다 - 검증 방식은 Ed25519와 동일합니다</p>
<p><strong>키 블라인딩 작업:</strong></p>
<h4 id="generate_alphadata-secret">GENERATE_ALPHA(data, secret)</h4>
<p>키 블라인딩을 위한 alpha를 생성합니다. - <code>data</code>: 일반적으로 서명 공개 키와 서명 유형을 포함합니다 - <code>secret</code>: 선택적 추가 비밀값(사용하지 않으면 길이 0바이트) - 결과는 Ed25519 개인 키와 동일한 분포를 가집니다(mod L 환원 후)</p>
<h4 id="blind_privkeyprivkey-alpha">BLIND_PRIVKEY(privkey, alpha)</h4>
<p>비밀값 <code>alpha</code>를 사용하여 개인 키를 블라인드 처리합니다. - 구현: <code>blinded_privkey = (privkey + alpha) mod L</code> - 체에서 스칼라 산술을 사용합니다</p>
<h4 id="blind_pubkeypubkey-alpha">BLIND_PUBKEY(pubkey, alpha)</h4>
<p>비밀값 <code>alpha</code>를 사용하여 공개키를 블라인딩합니다. - 구현: <code>blinded_pubkey = pubkey + DERIVE_PUBLIC(alpha)</code> - 곡선 위에서 군 원소(점) 덧셈을 사용합니다.</p>
<p><strong>핵심 속성:</strong></p>
<pre tabindex="0"><code>BLIND_PUBKEY(pubkey, alpha) == DERIVE_PUBLIC(BLIND_PRIVKEY(privkey, alpha))
</code></pre><p><strong>보안 고려사항:</strong></p>
<p>ZCash Protocol Specification 5.4.6.1절에 따르면: 보안을 위해 alpha는 블라인딩 해제된 개인 키와 동일한 분포를 가져야 한다. 이는 &ldquo;재무작위화된 공개 키와 그 키로 생성된 서명(들)의 조합이, 해당 공개 키가 재무작위화되기 전의 원래 키를 드러내지 않는다&quot;는 것을 보장한다.</p>
<p><strong>지원되는 서명 유형:</strong> - <strong>유형 7 (Ed25519):</strong> 기존 destinations(목적지) 지원 (하위 호환성) - <strong>유형 11 (Red25519):</strong> 암호화를 사용하는 신규 destinations에 권장 - <strong>Blinded keys(블라인드 키):</strong> 항상 유형 11 (Red25519)을 사용</p>
<p><strong>참고 자료:</strong> - <a href="https://zips.z.cash/protocol/protocol.pdf">ZCash 프로토콜 명세서</a>
 - 섹션 5.4.6 RedDSA - <a href="../../../../ko/docs/specs/red25519-signature-scheme/">I2P Red25519 명세서</a>
</p>
<h3 id="dh디피-헬먼-키-교환-x25519">DH(디피-헬먼 키 교환): X25519</h3>
<p><strong>타원곡선 디피-헬만: X25519</strong></p>
<p>Curve25519 기반 공개 키 합의 시스템.</p>
<p><strong>매개변수:</strong> - 개인 키: 32 바이트 - 공개 키: 32 바이트 - 공유 비밀 출력: 32 바이트</p>
<p><strong>기능:</strong></p>
<h4 id="generate_private">GENERATE_PRIVATE()</h4>
<p>CSRNG(암호학적으로 안전한 난수 생성기)을 사용하여 새로운 32바이트 개인 키를 생성합니다.</p>
<h4 id="derive_publicprivkey-1">DERIVE_PUBLIC(privkey)</h4>
<p>주어진 비밀 키에서 32바이트 공개 키를 유도합니다. - Curve25519에서 스칼라 곱셈을 사용합니다</p>
<h4 id="dhprivkey-pubkey">DH(privkey, pubkey)</h4>
<p>디피-헬만 키 합의를 수행합니다. - <code>privkey</code>: 로컬 32바이트 개인 키 - <code>pubkey</code>: 원격 32바이트 공개 키 - 반환: 32바이트 공유 비밀</p>
<p><strong>보안 속성:</strong> - Curve25519에서의 계산적 디피-헬먼 가정 - 임시 키 사용 시 전방향 기밀성 - 타이밍 공격을 방지하기 위해 상수 시간 구현 필요</p>
<p><strong>참고 문헌:</strong> - <a href="https://datatracker.ietf.org/doc/html/rfc7748">RFC 7748</a>
 - 보안을 위한 타원곡선</p>
<h3 id="hkdfhmac-기반-추출-확장-키-파생-함수">HKDF(HMAC 기반 추출-확장 키 파생 함수)</h3>
<p><strong>HMAC 기반 키 파생 함수</strong></p>
<p>입력 키잉 재료에서 키 재료를 추출하고 확장합니다.</p>
<p><strong>매개변수:</strong> - <code>salt</code>: 최대 32바이트(보통 SHA-256의 경우 32바이트) - <code>ikm</code>: 입력 키 재료(길이 제한 없음, 충분한 엔트로피 권장) - <code>info</code>: 컨텍스트별 정보(도메인 분리) - <code>n</code>: 출력 길이(바이트 단위)</p>
<p><strong>구현:</strong></p>
<p>RFC 5869에 명시된 대로 다음과 같은 설정으로 HKDF를 사용합니다: - <strong>해시 함수:</strong> SHA-256 - <strong>HMAC:</strong> RFC 2104에 명시된 대로 - <strong>솔트 길이:</strong> 최대 32바이트(SHA-256의 HashLen)</p>
<p><strong>사용 패턴:</strong></p>
<pre tabindex="0"><code>keys = HKDF(salt, ikm, info, n)
</code></pre><p><strong>도메인 분리:</strong> <code>info</code> 매개변수는 프로토콜 내에서 HKDF의 서로 다른 사용 간에 암호학적 도메인 분리를 제공합니다.</p>
<p><strong>검증된 정보 값:</strong> - <code>&quot;ELS2_L1K&quot;</code> - 레이어 1(외부) 암호화 - <code>&quot;ELS2_L2K&quot;</code> - 레이어 2(내부) 암호화 - <code>&quot;ELS2_XCA&quot;</code> - DH 클라이언트 인증 - <code>&quot;ELS2PSKA&quot;</code> - PSK 클라이언트 인증 - <code>&quot;i2pblinding1&quot;</code> - 알파 생성</p>
<p><strong>참고 자료:</strong> - <a href="https://datatracker.ietf.org/doc/html/rfc5869">RFC 5869</a>
 - HKDF 명세 - <a href="https://datatracker.ietf.org/doc/html/rfc2104">RFC 2104</a>
 - HMAC 명세</p>
<hr>
<h2 id="형식-명세">형식 명세</h2>
<p>암호화된 LS2(LeaseSet2, I2P의 2세대 leaseSet 형식)는 세 개의 중첩된 계층으로 구성된다:</p>
<ol>
<li><strong>계층 0 (외부):</strong> 저장 및 검색을 위한 평문 정보</li>
<li><strong>계층 1 (중간):</strong> 클라이언트 인증 데이터(암호화됨)</li>
<li><strong>계층 2 (내부):</strong> 실제 LeaseSet2(I2P의 목적지 정보 데이터 구조) 데이터(암호화됨)</li>
</ol>
<p><strong>전체 구조:</strong></p>
<pre tabindex="0"><code>Layer 0 data + Enc(layer 1 data + Enc(layer 2 data)) + Signature
</code></pre><p><strong>중요:</strong> Encrypted LS2는 blinded keys(블라인딩된 키)를 사용합니다. Destination은 헤더에 포함되지 않습니다. DHT 저장 위치는 <code>SHA-256(sig type || blinded public key)</code>이며, 매일 변경됩니다.</p>
<h3 id="레이어-0-외부---평문">레이어 0 (외부) - 평문</h3>
<p>레이어 0은 표준 LS2 헤더를 사용하지 않습니다. 이는 blinded keys(블라인딩된 키: 원본 키를 숨기기 위해 변형한 키)에 최적화된 맞춤형 형식을 사용합니다.</p>
<p><strong>구조:</strong></p>
<table style="width:100%; border-collapse:collapse; margin-bottom:1.5rem;">
  <thead>
    <tr>
      <th style="border:1px solid var(--color-border); padding:0.5rem; background:var(--color-bg-secondary); text-align:left;">Field</th>
      <th style="border:1px solid var(--color-border); padding:0.5rem; background:var(--color-bg-secondary); text-align:center;">Size</th>
      <th style="border:1px solid var(--color-border); padding:0.5rem; background:var(--color-bg-secondary); text-align:left;">Description</th>
    </tr>
  </thead>
  <tbody>
    <tr><td style="border:1px solid var(--color-border); padding:0.5rem;">Type</td><td style="border:1px solid var(--color-border); padding:0.5rem; text-align:center;">1 byte</td><td style="border:1px solid var(--color-border); padding:0.5rem;">Not in header, from DatabaseStore message field</td></tr>
    <tr><td style="border:1px solid var(--color-border); padding:0.5rem;">Blinded Public Key Sig Type</td><td style="border:1px solid var(--color-border); padding:0.5rem; text-align:center;">2 bytes</td><td style="border:1px solid var(--color-border); padding:0.5rem;">Big endian, always <code>0x000b</code> (Red25519 type 11)</td></tr>
    <tr><td style="border:1px solid var(--color-border); padding:0.5rem;">Blinded Public Key</td><td style="border:1px solid var(--color-border); padding:0.5rem; text-align:center;">32 bytes</td><td style="border:1px solid var(--color-border); padding:0.5rem;">Red25519 blinded public key</td></tr>
    <tr><td style="border:1px solid var(--color-border); padding:0.5rem;">Published Timestamp</td><td style="border:1px solid var(--color-border); padding:0.5rem; text-align:center;">4 bytes</td><td style="border:1px solid var(--color-border); padding:0.5rem;">Big endian, seconds since epoch (rolls over in 2106)</td></tr>
    <tr><td style="border:1px solid var(--color-border); padding:0.5rem;">Expires</td><td style="border:1px solid var(--color-border); padding:0.5rem; text-align:center;">2 bytes</td><td style="border:1px solid var(--color-border); padding:0.5rem;">Big endian, offset from published in seconds (max 65,535 &asymp; 18.2 hours)</td></tr>
    <tr><td style="border:1px solid var(--color-border); padding:0.5rem;">Flags</td><td style="border:1px solid var(--color-border); padding:0.5rem; text-align:center;">2 bytes</td><td style="border:1px solid var(--color-border); padding:0.5rem;">Bit flags (see below)</td></tr>
    <tr><td style="border:1px solid var(--color-border); padding:0.5rem;">[Optional] Transient Key Data</td><td style="border:1px solid var(--color-border); padding:0.5rem; text-align:center;">Variable</td><td style="border:1px solid var(--color-border); padding:0.5rem;">Present if flag bit&nbsp;0 is set</td></tr>
    <tr><td style="border:1px solid var(--color-border); padding:0.5rem;">lenOuterCiphertext</td><td style="border:1px solid var(--color-border); padding:0.5rem; text-align:center;">2 bytes</td><td style="border:1px solid var(--color-border); padding:0.5rem;">Big endian, length of outer ciphertext</td></tr>
    <tr><td style="border:1px solid var(--color-border); padding:0.5rem;">outerCiphertext</td><td style="border:1px solid var(--color-border); padding:0.5rem; text-align:center;">lenOuterCiphertext</td><td style="border:1px solid var(--color-border); padding:0.5rem;">Encrypted Layer&nbsp;1 data</td></tr>
    <tr><td style="border:1px solid var(--color-border); padding:0.5rem;">Signature</td><td style="border:1px solid var(--color-border); padding:0.5rem; text-align:center;">64 bytes</td><td style="border:1px solid var(--color-border); padding:0.5rem;">Red25519 signature over all preceding data</td></tr>
  </tbody>
</table>
**Flags 필드(2바이트, 비트 15-0):** - **비트 0:** 오프라인 키 표시자   - `0` = 오프라인 키 없음   - `1` = 오프라인 키 존재(임시 키 데이터가 뒤따름) - **비트 1-15:** 예약됨, 향후 호환성을 위해 0이어야 함
<p><strong>임시 키 데이터 (플래그 비트 0 = 1인 경우에만 존재):</strong></p>
<table style="width:100%; border-collapse:collapse; margin-bottom:1.5rem;">
  <thead>
    <tr>
      <th style="border:1px solid var(--color-border); padding:0.5rem; background:var(--color-bg-secondary); text-align:left;">Field</th>
      <th style="border:1px solid var(--color-border); padding:0.5rem; background:var(--color-bg-secondary); text-align:center;">Size</th>
      <th style="border:1px solid var(--color-border); padding:0.5rem; background:var(--color-bg-secondary); text-align:left;">Description</th>
    </tr>
  </thead>
  <tbody>
    <tr><td style="border:1px solid var(--color-border); padding:0.5rem;">Expires Timestamp</td><td style="border:1px solid var(--color-border); padding:0.5rem; text-align:center;">4 bytes</td><td style="border:1px solid var(--color-border); padding:0.5rem;">Big endian, seconds since epoch</td></tr>
    <tr><td style="border:1px solid var(--color-border); padding:0.5rem;">Transient Sig Type</td><td style="border:1px solid var(--color-border); padding:0.5rem; text-align:center;">2 bytes</td><td style="border:1px solid var(--color-border); padding:0.5rem;">Big endian, signature type</td></tr>
    <tr><td style="border:1px solid var(--color-border); padding:0.5rem;">Transient Signing Public Key</td><td style="border:1px solid var(--color-border); padding:0.5rem; text-align:center;">Variable</td><td style="border:1px solid var(--color-border); padding:0.5rem;">Length implied by signature type</td></tr>
    <tr><td style="border:1px solid var(--color-border); padding:0.5rem;">Signature</td><td style="border:1px solid var(--color-border); padding:0.5rem; text-align:center;">64 bytes</td><td style="border:1px solid var(--color-border); padding:0.5rem;">Signed by blinded public key; covers expires timestamp, transient sig type, and transient public key</td></tr>
  </tbody>
</table>
**서명 검증:** - **오프라인 키 없이:** 블라인드된 공개키로 검증 - **오프라인 키 사용:** 임시 공개키로 검증
<p>서명은 Type부터 outerCiphertext까지의 모든 데이터를 포함한다(양 끝 포함).</p>
<h3 id="레이어-1-중간---클라이언트-인가">레이어 1 (중간) - 클라이언트 인가</h3>
<p><strong>복호화:</strong> <a href="#layer-1-encryption">레이어 1 암호화</a>
 섹션을 참조하세요.</p>
<p><strong>구조:</strong></p>
<table style="width:100%; border-collapse:collapse; margin-bottom:1.5rem;">
  <thead>
    <tr>
      <th style="border:1px solid var(--color-border); padding:0.5rem; background:var(--color-bg-secondary); text-align:left;">Field</th>
      <th style="border:1px solid var(--color-border); padding:0.5rem; background:var(--color-bg-secondary); text-align:center;">Size</th>
      <th style="border:1px solid var(--color-border); padding:0.5rem; background:var(--color-bg-secondary); text-align:left;">Description</th>
    </tr>
  </thead>
  <tbody>
    <tr><td style="border:1px solid var(--color-border); padding:0.5rem;">Flags</td><td style="border:1px solid var(--color-border); padding:0.5rem; text-align:center;">1 byte</td><td style="border:1px solid var(--color-border); padding:0.5rem;">Authorization flags (see below)</td></tr>
    <tr><td style="border:1px solid var(--color-border); padding:0.5rem;">[Optional] Auth Data</td><td style="border:1px solid var(--color-border); padding:0.5rem; text-align:center;">Variable</td><td style="border:1px solid var(--color-border); padding:0.5rem;">Present based on flags</td></tr>
    <tr><td style="border:1px solid var(--color-border); padding:0.5rem;">innerCiphertext</td><td style="border:1px solid var(--color-border); padding:0.5rem; text-align:center;">Variable</td><td style="border:1px solid var(--color-border); padding:0.5rem;">Encrypted Layer&nbsp;2 data (remainder)</td></tr>
  </tbody>
</table>
**플래그 필드(1바이트, 비트 7-0):** - **비트 0:** 인가 모드   - `0` = 클라이언트별 인가 없음(모두 허용)   - `1` = 클라이언트별 인가(인가 섹션이 뒤따름) - **비트 3-1:** 인증 방식(비트 0 = 1인 경우에만)   - `000` = DH 클라이언트 인증   - `001` = PSK 클라이언트 인증   - 기타 값은 예약됨 - **비트 7-4:** 사용되지 않음, 0이어야 함
<p><strong>DH 클라이언트 인증 데이터 (플래그 = 0x01, 비트 3-1 = 000):</strong></p>
<table style="width:100%; border-collapse:collapse; margin-bottom:1.5rem;">
  <thead>
    <tr>
      <th style="border:1px solid var(--color-border); padding:0.5rem; background:var(--color-bg-secondary); text-align:left;">Field</th>
      <th style="border:1px solid var(--color-border); padding:0.5rem; background:var(--color-bg-secondary); text-align:center;">Size</th>
      <th style="border:1px solid var(--color-border); padding:0.5rem; background:var(--color-bg-secondary); text-align:left;">Description</th>
    </tr>
  </thead>
  <tbody>
    <tr><td style="border:1px solid var(--color-border); padding:0.5rem;">ephemeralPublicKey</td><td style="border:1px solid var(--color-border); padding:0.5rem; text-align:center;">32 bytes</td><td style="border:1px solid var(--color-border); padding:0.5rem;">Server's ephemeral X25519 public key</td></tr>
    <tr><td style="border:1px solid var(--color-border); padding:0.5rem;">clients</td><td style="border:1px solid var(--color-border); padding:0.5rem; text-align:center;">2 bytes</td><td style="border:1px solid var(--color-border); padding:0.5rem;">Big endian, number of client entries</td></tr>
    <tr><td style="border:1px solid var(--color-border); padding:0.5rem;">authClient[]</td><td style="border:1px solid var(--color-border); padding:0.5rem; text-align:center;">40 bytes each</td><td style="border:1px solid var(--color-border); padding:0.5rem;">Array of client authorization entries</td></tr>
  </tbody>
</table>
**authClient(인증 클라이언트) 항목 (40바이트):** - `clientID_i`: 8바이트 - `clientCookie_i`: 32바이트 (암호화된 authCookie(인증 쿠키))
<p><strong>PSK 클라이언트 인증 데이터 (플래그 = 0x03, 비트 3-1 = 001):</strong></p>
<table style="width:100%; border-collapse:collapse; margin-bottom:1.5rem;">
  <thead>
    <tr>
      <th style="border:1px solid var(--color-border); padding:0.5rem; background:var(--color-bg-secondary); text-align:left;">Field</th>
      <th style="border:1px solid var(--color-border); padding:0.5rem; background:var(--color-bg-secondary); text-align:center;">Size</th>
      <th style="border:1px solid var(--color-border); padding:0.5rem; background:var(--color-bg-secondary); text-align:left;">Description</th>
    </tr>
  </thead>
  <tbody>
    <tr><td style="border:1px solid var(--color-border); padding:0.5rem;">authSalt</td><td style="border:1px solid var(--color-border); padding:0.5rem; text-align:center;">32 bytes</td><td style="border:1px solid var(--color-border); padding:0.5rem;">Salt for PSK key derivation</td></tr>
    <tr><td style="border:1px solid var(--color-border); padding:0.5rem;">clients</td><td style="border:1px solid var(--color-border); padding:0.5rem; text-align:center;">2 bytes</td><td style="border:1px solid var(--color-border); padding:0.5rem;">Big endian, number of client entries</td></tr>
    <tr><td style="border:1px solid var(--color-border); padding:0.5rem;">authClient[]</td><td style="border:1px solid var(--color-border); padding:0.5rem; text-align:center;">40 bytes each</td><td style="border:1px solid var(--color-border); padding:0.5rem;">Array of client authorization entries</td></tr>
  </tbody>
</table>
**authClient 항목 (40바이트):** - `clientID_i`: 8바이트 - `clientCookie_i`: 32바이트 (암호화된 authCookie)
<h3 id="레이어-2-내부---leaseset-데이터">레이어 2 (내부) - LeaseSet 데이터</h3>
<p><strong>복호화:</strong> <a href="#layer-2-encryption">Layer 2 Encryption</a>
 섹션을 참조하세요.</p>
<p><strong>구조:</strong></p>
<table style="width:100%; border-collapse:collapse; margin-bottom:1.5rem;">
  <thead>
    <tr>
      <th style="border:1px solid var(--color-border); padding:0.5rem; background:var(--color-bg-secondary); text-align:left;">Field</th>
      <th style="border:1px solid var(--color-border); padding:0.5rem; background:var(--color-bg-secondary); text-align:center;">Size</th>
      <th style="border:1px solid var(--color-border); padding:0.5rem; background:var(--color-bg-secondary); text-align:left;">Description</th>
    </tr>
  </thead>
  <tbody>
    <tr><td style="border:1px solid var(--color-border); padding:0.5rem;">Type</td><td style="border:1px solid var(--color-border); padding:0.5rem; text-align:center;">1 byte</td><td style="border:1px solid var(--color-border); padding:0.5rem;"><code>3</code> (LS2) or <code>7</code> (Meta LS2)</td></tr>
    <tr><td style="border:1px solid var(--color-border); padding:0.5rem;">Data</td><td style="border:1px solid var(--color-border); padding:0.5rem; text-align:center;">Variable</td><td style="border:1px solid var(--color-border); padding:0.5rem;">Complete LeaseSet2 or MetaLeaseSet2</td></tr>
  </tbody>
</table>
내부 계층에는 다음을 포함한 전체 LeaseSet2(2세대 LeaseSet 형식) 구조체가 포함됩니다: - LS2 헤더 - Lease 정보 - LS2 서명
<p><strong>검증 요구 사항:</strong> 복호화 후, 구현은 다음을 검증해야 합니다: 1. 내부 타임스탬프가 외부에 게시된 타임스탬프와 일치함 2. 내부 만료 시간이 외부 만료 시간과 일치함 3. LS2 서명이 유효함 4. Lease(I2P에서 tunnel 엔드포인트 정보를 담는 항목) 데이터가 올바른 형식임</p>
<p><strong>참고 자료:</strong> - <a href="../../../../ko/docs/specs/common-structures/">공통 구조 사양</a>
 - LeaseSet2(I2P의 차세대 leaseSet 형식) 형식 상세</p>
<hr>
<h2 id="블라인딩-키-파생">블라인딩 키 파생</h2>
<h3 id="개요-1">개요</h3>
<p>I2P는 Ed25519와 ZCash RedDSA를 기반으로 한 가법적 키 블라인딩(additive key blinding) 방식을 사용한다. 전방향 기밀성을 위해 블라인딩된 키는 매일(UTC 자정)에 교체된다.</p>
<p><strong>설계 근거:</strong></p>
<p>I2P는 Tor의 rend-spec-v3.txt Appendix A.2 접근 방식을 사용하지 않기로 명시적으로 선택했다. 명세에 따르면:</p>
<blockquote>
<p>&ldquo;우리는 유사한 설계 목표를 가진 Tor의 rend-spec-v3.txt 부록 A.2를 사용하지 않는다. 그 방식의 블라인딩된 공개키가 소수 차수 부분군(prime-order subgroup)에 속하지 않을 수 있으며, 이에 따른 보안상의 영향은 알려져 있지 않기 때문이다.&rdquo;</p></blockquote>
<p>I2P의 additive blinding(덧셈형 블라인딩)은 블라인딩된 키가 Ed25519 곡선의 소수 차수 부분군에 머무르도록 보장합니다.</p>
<h3 id="수학적-정의">수학적 정의</h3>
<p><strong>Ed25519 매개변수:</strong> - <code>B</code>: Ed25519의 기저점(생성원) = <code>2^255 - 19</code> - <code>L</code>: Ed25519의 위수 = <code>2^252 + 27742317777372353535851937790883648493</code></p>
<p><strong>주요 변수:</strong> - <code>A</code>: 블라인드 해제된 32바이트 서명 공개키 (Destination(목적지) 내) - <code>a</code>: 블라인드 해제된 32바이트 서명 개인키 - <code>A'</code>: 블라인드 처리된 32바이트 서명 공개키 (암호화된 LeaseSet에서 사용됨) - <code>a'</code>: 블라인드 처리된 32바이트 서명 개인키 - <code>alpha</code>: 32바이트 블라인딩 팩터 (비밀)</p>
<p><strong>도우미 함수:</strong></p>
<h4 id="leos2ipx">LEOS2IP(x)</h4>
<p>&ldquo;리틀 엔디언 옥텟 문자열을 정수로 변환&rdquo;</p>
<p>바이트 배열을 리틀 엔디언에서 정수 표현으로 변환합니다.</p>
<h4 id="hx">H*(x)</h4>
<p>&ldquo;해시와 환원&rdquo;</p>
<pre tabindex="0"><code>H*(x) = (LEOS2IP(SHA512(x))) mod L
</code></pre><p>Ed25519(타원곡선 디지털 서명 알고리즘) 키 생성과 동일한 연산입니다.</p>
<h3 id="알파-생성">알파 생성</h3>
<p><strong>일일 로테이션:</strong> 새로운 alpha(알파 값) 및 blinded keys(블라인딩 처리된 키)는 매일 UTC 자정(00:00:00 UTC)에 반드시 생성되어야 한다.</p>
<p><strong>GENERATE_ALPHA(destination, date, secret) 알고리즘:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># Input parameters</span>
</span></span><span style="display:flex;"><span>A <span style="color:#f92672">=</span> destination<span style="color:#e6db74">&#39;s signing public key (32 bytes)</span>
</span></span><span style="display:flex;"><span>stA <span style="color:#f92672">=</span> signature type of A (<span style="color:#ae81ff">2</span> bytes, big endian)
</span></span><span style="display:flex;"><span>     <span style="color:#75715e"># 0x0007 for Ed25519 or 0x000b for Red25519</span>
</span></span><span style="display:flex;"><span>stA<span style="color:#e6db74">&#39; = signature type of blinded key A&#39;</span> (<span style="color:#ae81ff">2</span> bytes, big endian) 
</span></span><span style="display:flex;"><span>     <span style="color:#75715e"># Always 0x000b (Red25519)</span>
</span></span><span style="display:flex;"><span>datestring <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;YYYYMMDD&#34;</span> (<span style="color:#ae81ff">8</span> bytes ASCII <span style="color:#f92672">from</span> current UTC date)
</span></span><span style="display:flex;"><span>secret <span style="color:#f92672">=</span> optional UTF<span style="color:#f92672">-</span><span style="color:#ae81ff">8</span> encoded string (zero<span style="color:#f92672">-</span>length <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> used)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Computation</span>
</span></span><span style="display:flex;"><span>keydata <span style="color:#f92672">=</span> A <span style="color:#f92672">||</span> stA <span style="color:#f92672">||</span> stA<span style="color:#e6db74">&#39;  # 36 bytes total</span>
</span></span><span style="display:flex;"><span>seed <span style="color:#f92672">=</span> HKDF(
</span></span><span style="display:flex;"><span>    salt<span style="color:#f92672">=</span>H(<span style="color:#e6db74">&#34;I2PGenerateAlpha&#34;</span>, keydata),
</span></span><span style="display:flex;"><span>    ikm<span style="color:#f92672">=</span>datestring <span style="color:#f92672">||</span> secret,
</span></span><span style="display:flex;"><span>    info<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;i2pblinding1&#34;</span>,
</span></span><span style="display:flex;"><span>    n<span style="color:#f92672">=</span><span style="color:#ae81ff">64</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Treat seed as 64-byte little-endian integer and reduce</span>
</span></span><span style="display:flex;"><span>alpha <span style="color:#f92672">=</span> seed mod L
</span></span></code></pre></div><p><strong>검증된 매개변수:</strong> - 솔트 개인화: &ldquo;I2PGenerateAlpha&rdquo; - HKDF(HMAC 기반 키 유도 함수) 정보: &ldquo;i2pblinding1&rdquo; - 출력: mod L 적용 전 64바이트 - Alpha 분포: <code>mod L</code> 적용 후 Ed25519 개인 키와 동일한 분포</p>
<h3 id="개인키-블라인딩">개인키 블라인딩</h3>
<p><strong>BLIND_PRIVKEY(a, alpha) 알고리즘:</strong></p>
<p>암호화된 LeaseSet을 게시하는 목적지 소유자의 경우:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># For Ed25519 private key (type 7)</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> sigtype <span style="color:#f92672">==</span> <span style="color:#ae81ff">7</span>:
</span></span><span style="display:flex;"><span>    seed <span style="color:#f92672">=</span> destination<span style="color:#e6db74">&#39;s signing private key (32 bytes)</span>
</span></span><span style="display:flex;"><span>    a <span style="color:#f92672">=</span> left_half(SHA512(seed))  <span style="color:#75715e"># 32 bytes</span>
</span></span><span style="display:flex;"><span>    a <span style="color:#f92672">=</span> clamp(a)  <span style="color:#75715e"># Ed25519 clamping</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span><span style="color:#75715e"># For Red25519 private key (type 11)</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">elif</span> sigtype <span style="color:#f92672">==</span> <span style="color:#ae81ff">11</span>:
</span></span><span style="display:flex;"><span>    a <span style="color:#f92672">=</span> destination<span style="color:#e6db74">&#39;s signing private key (32 bytes)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># No clamping for Red25519</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Additive blinding using scalar arithmetic</span>
</span></span><span style="display:flex;"><span>blinded_privkey <span style="color:#f92672">=</span> a<span style="color:#e6db74">&#39; = (a + alpha) mod L</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Derive blinded public key</span>
</span></span><span style="display:flex;"><span>blinded_pubkey <span style="color:#f92672">=</span> A<span style="color:#e6db74">&#39; = DERIVE_PUBLIC(a&#39;</span>)
</span></span></code></pre></div><p><strong>중요:</strong> 개인 키와 공개 키 사이의 올바른 대수적 관계를 유지하려면 <code>mod L</code> 환원이 필수적입니다.</p>
<h3 id="공개-키-블라인딩">공개 키 블라인딩</h3>
<p><strong>BLIND_PUBKEY(A, alpha) 알고리즘:</strong></p>
<p>암호화된 LeaseSet을 조회하고 검증하는 클라이언트의 경우:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>alpha <span style="color:#f92672">=</span> GENERATE_ALPHA(destination, date, secret)
</span></span><span style="display:flex;"><span>A <span style="color:#f92672">=</span> destination<span style="color:#e6db74">&#39;s signing public key (32 bytes)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Additive blinding using group elements (curve points)</span>
</span></span><span style="display:flex;"><span>blinded_pubkey <span style="color:#f92672">=</span> A<span style="color:#e6db74">&#39; = A + DERIVE_PUBLIC(alpha)</span>
</span></span></code></pre></div><p><strong>수학적 동치:</strong></p>
<p>두 방법 모두 동일한 결과를 산출합니다:</p>
<pre tabindex="0"><code>BLIND_PUBKEY(A, alpha) == DERIVE_PUBLIC(BLIND_PRIVKEY(a, alpha))
</code></pre><p>그 이유는 다음과 같습니다:</p>
<pre tabindex="0"><code>A&#39; = A + [alpha]B
   = [a]B + [alpha]B
   = [a + alpha]B  (group operation)
   = DERIVE_PUBLIC(a + alpha mod L)
</code></pre><h3 id="blinded-keys블라인딩된-키를-사용한-서명">Blinded Keys(블라인딩된 키)를 사용한 서명</h3>
<p><strong>블라인딩 해제된 LeaseSet 서명:</strong></p>
<p>블라인드되지 않은 LeaseSet(인증된 클라이언트에게 직접 전송됨)은 다음을 사용해 서명됩니다: - 표준 Ed25519(유형 7) 또는 Red25519(유형 11) 서명 - 블라인드되지 않은 서명용 개인 키 - 블라인드되지 않은 공개 키로 검증됨</p>
<p><strong>오프라인 키 사용 시:</strong> - 블라인드 해제된 임시 개인 키로 서명 - 블라인드 해제된 임시 공개 키로 검증 - 둘 다 타입 7 또는 11이어야 함</p>
<p><strong>암호화된 LeaseSet 서명:</strong></p>
<p>암호화된 LeaseSet의 외부 부분은 blinded keys(블라인딩된 키)와 함께 Red25519 서명을 사용합니다.</p>
<p><strong>Red25519 서명 알고리즘:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># Generate per-signature random nonce</span>
</span></span><span style="display:flex;"><span>T <span style="color:#f92672">=</span> CSRNG(<span style="color:#ae81ff">80</span>)  <span style="color:#75715e"># 80 random bytes</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Calculate r (differs from Ed25519)</span>
</span></span><span style="display:flex;"><span>r <span style="color:#f92672">=</span> H<span style="color:#f92672">*</span>(T <span style="color:#f92672">||</span> blinded_pubkey <span style="color:#f92672">||</span> message)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Rest is same as Ed25519</span>
</span></span><span style="display:flex;"><span>R <span style="color:#f92672">=</span> [r]B
</span></span><span style="display:flex;"><span>S <span style="color:#f92672">=</span> (r <span style="color:#f92672">+</span> H(R <span style="color:#f92672">||</span> A<span style="color:#e6db74">&#39; || message) * a&#39;</span>) mod L
</span></span><span style="display:flex;"><span>signature <span style="color:#f92672">=</span> R <span style="color:#f92672">||</span> S  <span style="color:#75715e"># 64 bytes total</span>
</span></span></code></pre></div><p><strong>Ed25519와의 주요 차이점:</strong> 1. 개인 키의 해시가 아니라 80바이트의 임의 데이터 <code>T</code>를 사용 2. 공개 키 값을 직접 사용 (개인 키의 해시가 아님) 3. 동일한 메시지와 키에 대해서도 각 서명은 고유함</p>
<p><strong>검증:</strong></p>
<p>Ed25519와 동일:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># Parse signature</span>
</span></span><span style="display:flex;"><span>R <span style="color:#f92672">=</span> signature[<span style="color:#ae81ff">0</span>:<span style="color:#ae81ff">32</span>]
</span></span><span style="display:flex;"><span>S <span style="color:#f92672">=</span> signature[<span style="color:#ae81ff">32</span>:<span style="color:#ae81ff">64</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Verify equation: [S]B = R + [H(R || A&#39; || message)]A&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">return</span> [S]B <span style="color:#f92672">==</span> R <span style="color:#f92672">+</span> [H(R <span style="color:#f92672">||</span> A<span style="color:#e6db74">&#39; || message)]A&#39;</span>
</span></span></code></pre></div><h3 id="보안-고려사항">보안 고려사항</h3>
<p><strong>알파 배포:</strong></p>
<p>보안을 위해, alpha는 블라인딩되지 않은 개인 키와 동일한 분포여야 합니다. Ed25519(type 7)을 Red25519(type 11)로 블라인딩할 때, 분포가 약간 달라집니다.</p>
<p><strong>권장사항:</strong> ZCash 요구사항을 충족하기 위해 언블라인드 키와 블라인드 키 모두에 Red25519 (type 11)를 사용하십시오: &ldquo;재랜덤화된 공개키와 해당 키로 생성된 서명(들)의 조합은 그것이 재랜덤화되기 전의 원래 키를 드러내지 않는다.&rdquo;</p>
<p><strong>Type 7 지원:</strong> Ed25519는 기존 Destination(목적지)과의 하위 호환성을 위해 지원되지만, 새로운 암호화된 Destination에는 type 11을 권장합니다.</p>
<p><strong>일일 로테이션의 이점:</strong> - 전방향 기밀성: 오늘의 블라인딩된 키가 탈취되더라도 어제의 것은 노출되지 않음 - 비연결성: 일일 로테이션은 DHT(분산 해시 테이블)를 통한 장기 추적을 방지 - 키 분리: 기간별로 서로 다른 키 사용</p>
<p><strong>참고 자료:</strong> - <a href="https://zips.z.cash/protocol/protocol.pdf">Zcash 프로토콜 사양서</a>
 - 섹션 5.4.6.1 - <a href="https://lists.torproject.org/pipermail/tor-dev/2013-December/005943.html">Tor 키 블라인딩 논의</a>
 - <a href="https://trac.torproject.org/projects/tor/ticket/8106">Tor 티켓 #8106</a>
</p>
<hr>
<h2 id="암호화-및-처리">암호화 및 처리</h2>
<h3 id="하위-자격-증명-파생">하위 자격 증명 파생</h3>
<p>암호화 전에, 암호화된 레이어가 Destination(I2P 목적지)의 서명 공개 키에 대한 지식에 결속되도록 자격 증명과 하위 자격 증명을 유도한다.</p>
<p><strong>목표:</strong> Destination(I2P 목적지 식별자)의 서명 공개키를 아는 사람만 암호화된 LeaseSet을 복호화할 수 있도록 한다. 전체 Destination은 필요하지 않다.</p>
<h4 id="자격-증명-계산">자격 증명 계산</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>A <span style="color:#f92672">=</span> destination<span style="color:#e6db74">&#39;s signing public key (32 bytes)</span>
</span></span><span style="display:flex;"><span>stA <span style="color:#f92672">=</span> signature type of A (<span style="color:#ae81ff">2</span> bytes big endian)
</span></span><span style="display:flex;"><span>     <span style="color:#75715e"># 0x0007 for Ed25519 or 0x000b for Red25519</span>
</span></span><span style="display:flex;"><span>stA<span style="color:#e6db74">&#39; = signature type of blinded key A&#39;</span> (<span style="color:#ae81ff">2</span> bytes big endian)
</span></span><span style="display:flex;"><span>     <span style="color:#75715e"># Always 0x000b (Red25519)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>keydata <span style="color:#f92672">=</span> A <span style="color:#f92672">||</span> stA <span style="color:#f92672">||</span> stA<span style="color:#e6db74">&#39;  # 36 bytes</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>credential <span style="color:#f92672">=</span> H(<span style="color:#e6db74">&#34;credential&#34;</span>, keydata)  <span style="color:#75715e"># 32 bytes</span>
</span></span></code></pre></div><p><strong>도메인 분리:</strong> <code>credential</code> 개인화 문자열은 이 해시가 DHT 조회 키나 다른 프로토콜 사용과 충돌하지 않도록 보장합니다.</p>
<h4 id="subcredential하위-자격-증명-계산">Subcredential(하위 자격 증명) 계산</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>blindedPublicKey <span style="color:#f92672">=</span> A<span style="color:#e6db74">&#39; (32 bytes, from blinding process)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>subcredential <span style="color:#f92672">=</span> H(<span style="color:#e6db74">&#34;subcredential&#34;</span>, credential <span style="color:#f92672">||</span> blindedPublicKey)  <span style="color:#75715e"># 32 bytes</span>
</span></span></code></pre></div><p><strong>목적:</strong> subcredential(하위 자격 증명)은 암호화된 LeaseSet을 다음에 바인딩합니다: 1. 특정 Destination(목적지) (credential(자격 증명)을 통해) 2. 특정 blinded key(블라인드된 키) (blindedPublicKey를 통해) 3. 특정 날짜 (blindedPublicKey의 일일 로테이션을 통해)</p>
<p>이는 재전송 공격과 서로 다른 날짜 간의 연계(링킹)를 방지합니다.</p>
<h3 id="레이어-1-암호화">레이어 1 암호화</h3>
<p><strong>컨텍스트:</strong> 레이어 1에는 클라이언트 인가 데이터가 포함되어 있으며, subcredential(하위 자격 증명)에서 유도된 키로 암호화됩니다.</p>
<h4 id="암호화-알고리즘">암호화 알고리즘</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># Prepare input</span>
</span></span><span style="display:flex;"><span>outerInput <span style="color:#f92672">=</span> subcredential <span style="color:#f92672">||</span> publishedTimestamp
</span></span><span style="display:flex;"><span><span style="color:#75715e"># publishedTimestamp: 4 bytes from Layer 0</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Generate random salt</span>
</span></span><span style="display:flex;"><span>outerSalt <span style="color:#f92672">=</span> CSRNG(<span style="color:#ae81ff">32</span>)  <span style="color:#75715e"># 32 bytes</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Derive encryption key and IV</span>
</span></span><span style="display:flex;"><span>keys <span style="color:#f92672">=</span> HKDF(
</span></span><span style="display:flex;"><span>    salt<span style="color:#f92672">=</span>outerSalt,
</span></span><span style="display:flex;"><span>    ikm<span style="color:#f92672">=</span>outerInput,
</span></span><span style="display:flex;"><span>    info<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;ELS2_L1K&#34;</span>,  <span style="color:#75715e"># Domain separation</span>
</span></span><span style="display:flex;"><span>    n<span style="color:#f92672">=</span><span style="color:#ae81ff">44</span>  <span style="color:#75715e"># 32 bytes key + 12 bytes IV</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>outerKey <span style="color:#f92672">=</span> keys[<span style="color:#ae81ff">0</span>:<span style="color:#ae81ff">31</span>]    <span style="color:#75715e"># 32 bytes (indices 0-31 inclusive)</span>
</span></span><span style="display:flex;"><span>outerIV <span style="color:#f92672">=</span> keys[<span style="color:#ae81ff">32</span>:<span style="color:#ae81ff">43</span>]    <span style="color:#75715e"># 12 bytes (indices 32-43 inclusive)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Encrypt and prepend salt</span>
</span></span><span style="display:flex;"><span>outerPlaintext <span style="color:#f92672">=</span> [Layer <span style="color:#ae81ff">1</span> data]
</span></span><span style="display:flex;"><span>outerCiphertext <span style="color:#f92672">=</span> outerSalt <span style="color:#f92672">||</span> ENCRYPT(outerKey, outerIV, outerPlaintext)
</span></span></code></pre></div><p><strong>출력:</strong> <code>outerCiphertext</code>는 <code>32 + len(outerPlaintext)</code> 바이트입니다.</p>
<p><strong>보안 속성:</strong> - Salt(해시 등에 추가하는 임의값)은 동일한 subcredential(하위 자격 증명)이어도 고유한 키/IV(초기화 벡터) 쌍을 보장함 - 컨텍스트 문자열 <code>&quot;ELS2_L1K&quot;</code>은 도메인 분리를 제공함 - ChaCha20은 의미론적 안전성(암호문이 난수와 구분되지 않음)을 제공함</p>
<h4 id="복호화-알고리즘">복호화 알고리즘</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># Parse salt from ciphertext</span>
</span></span><span style="display:flex;"><span>outerSalt <span style="color:#f92672">=</span> outerCiphertext[<span style="color:#ae81ff">0</span>:<span style="color:#ae81ff">31</span>]  <span style="color:#75715e"># First 32 bytes</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Derive decryption key and IV (same process as encryption)</span>
</span></span><span style="display:flex;"><span>outerInput <span style="color:#f92672">=</span> subcredential <span style="color:#f92672">||</span> publishedTimestamp
</span></span><span style="display:flex;"><span>keys <span style="color:#f92672">=</span> HKDF(
</span></span><span style="display:flex;"><span>    salt<span style="color:#f92672">=</span>outerSalt,
</span></span><span style="display:flex;"><span>    ikm<span style="color:#f92672">=</span>outerInput,
</span></span><span style="display:flex;"><span>    info<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;ELS2_L1K&#34;</span>,
</span></span><span style="display:flex;"><span>    n<span style="color:#f92672">=</span><span style="color:#ae81ff">44</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>outerKey <span style="color:#f92672">=</span> keys[<span style="color:#ae81ff">0</span>:<span style="color:#ae81ff">31</span>]    <span style="color:#75715e"># 32 bytes</span>
</span></span><span style="display:flex;"><span>outerIV <span style="color:#f92672">=</span> keys[<span style="color:#ae81ff">32</span>:<span style="color:#ae81ff">43</span>]    <span style="color:#75715e"># 12 bytes</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Decrypt (skip salt bytes)</span>
</span></span><span style="display:flex;"><span>outerPlaintext <span style="color:#f92672">=</span> DECRYPT(outerKey, outerIV, outerCiphertext[<span style="color:#ae81ff">32</span>:end])
</span></span></code></pre></div><p><strong>검증:</strong> 복호화 후 레이어 1 구조가 올바른 형식인지 검증한 다음 레이어 2로 진행하십시오.</p>
<h3 id="2계층-암호화">2계층 암호화</h3>
<p><strong>맥락:</strong> 레이어 2에는 실제 LeaseSet2 데이터가 포함되어 있으며, 클라이언트별 인증이 활성화된 경우 authCookie에서 파생된 키로, 그렇지 않으면 빈 문자열에서 파생된 키로 암호화된다.</p>
<h4 id="암호화-알고리즘-1">암호화 알고리즘</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># Determine authCookie based on authorization mode</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> per_client_auth_enabled:
</span></span><span style="display:flex;"><span>    authCookie <span style="color:#f92672">=</span> [<span style="color:#ae81ff">32</span><span style="color:#f92672">-</span>byte cookie <span style="color:#f92672">from</span> client authorization process]
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>    authCookie <span style="color:#f92672">=</span> <span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;&#39;</span>  <span style="color:#75715e"># Zero-length byte array</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Prepare input</span>
</span></span><span style="display:flex;"><span>innerInput <span style="color:#f92672">=</span> authCookie <span style="color:#f92672">||</span> subcredential <span style="color:#f92672">||</span> publishedTimestamp
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Generate random salt</span>
</span></span><span style="display:flex;"><span>innerSalt <span style="color:#f92672">=</span> CSRNG(<span style="color:#ae81ff">32</span>)  <span style="color:#75715e"># 32 bytes</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Derive encryption key and IV</span>
</span></span><span style="display:flex;"><span>keys <span style="color:#f92672">=</span> HKDF(
</span></span><span style="display:flex;"><span>    salt<span style="color:#f92672">=</span>innerSalt,
</span></span><span style="display:flex;"><span>    ikm<span style="color:#f92672">=</span>innerInput,
</span></span><span style="display:flex;"><span>    info<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;ELS2_L2K&#34;</span>,  <span style="color:#75715e"># Domain separation</span>
</span></span><span style="display:flex;"><span>    n<span style="color:#f92672">=</span><span style="color:#ae81ff">44</span>  <span style="color:#75715e"># 32 bytes key + 12 bytes IV</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>innerKey <span style="color:#f92672">=</span> keys[<span style="color:#ae81ff">0</span>:<span style="color:#ae81ff">31</span>]    <span style="color:#75715e"># 32 bytes</span>
</span></span><span style="display:flex;"><span>innerIV <span style="color:#f92672">=</span> keys[<span style="color:#ae81ff">32</span>:<span style="color:#ae81ff">43</span>]    <span style="color:#75715e"># 12 bytes</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Encrypt and prepend salt</span>
</span></span><span style="display:flex;"><span>innerPlaintext <span style="color:#f92672">=</span> [Layer <span style="color:#ae81ff">2</span> data: LS2 type byte <span style="color:#f92672">+</span> LeaseSet2 data]
</span></span><span style="display:flex;"><span>innerCiphertext <span style="color:#f92672">=</span> innerSalt <span style="color:#f92672">||</span> ENCRYPT(innerKey, innerIV, innerPlaintext)
</span></span></code></pre></div><p><strong>출력:</strong> <code>innerCiphertext</code>는 <code>32 + len(innerPlaintext)</code> 바이트입니다.</p>
<p><strong>키 바인딩:</strong> - 클라이언트 인증이 없는 경우: subcredential(하위 자격증명)과 타임스탬프에만 바인딩됨 - 클라이언트 인증이 활성화된 경우: authCookie에도 추가로 바인딩됨(승인된 각 클라이언트마다 다름)</p>
<h4 id="복호화-알고리즘-1">복호화 알고리즘</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># Determine authCookie (same as encryption)</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> per_client_auth_enabled:
</span></span><span style="display:flex;"><span>    authCookie <span style="color:#f92672">=</span> [<span style="color:#ae81ff">32</span><span style="color:#f92672">-</span>byte cookie <span style="color:#f92672">from</span> client authorization process]
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>    authCookie <span style="color:#f92672">=</span> <span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;&#39;</span>  <span style="color:#75715e"># Zero-length byte array</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Parse salt from ciphertext</span>
</span></span><span style="display:flex;"><span>innerSalt <span style="color:#f92672">=</span> innerCiphertext[<span style="color:#ae81ff">0</span>:<span style="color:#ae81ff">31</span>]  <span style="color:#75715e"># First 32 bytes</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Derive decryption key and IV</span>
</span></span><span style="display:flex;"><span>innerInput <span style="color:#f92672">=</span> authCookie <span style="color:#f92672">||</span> subcredential <span style="color:#f92672">||</span> publishedTimestamp
</span></span><span style="display:flex;"><span>keys <span style="color:#f92672">=</span> HKDF(
</span></span><span style="display:flex;"><span>    salt<span style="color:#f92672">=</span>innerSalt,
</span></span><span style="display:flex;"><span>    ikm<span style="color:#f92672">=</span>innerInput,
</span></span><span style="display:flex;"><span>    info<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;ELS2_L2K&#34;</span>,
</span></span><span style="display:flex;"><span>    n<span style="color:#f92672">=</span><span style="color:#ae81ff">44</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>innerKey <span style="color:#f92672">=</span> keys[<span style="color:#ae81ff">0</span>:<span style="color:#ae81ff">31</span>]    <span style="color:#75715e"># 32 bytes</span>
</span></span><span style="display:flex;"><span>innerIV <span style="color:#f92672">=</span> keys[<span style="color:#ae81ff">32</span>:<span style="color:#ae81ff">43</span>]    <span style="color:#75715e"># 12 bytes</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Decrypt (skip salt bytes)</span>
</span></span><span style="display:flex;"><span>innerPlaintext <span style="color:#f92672">=</span> DECRYPT(innerKey, innerIV, innerCiphertext[<span style="color:#ae81ff">32</span>:end])
</span></span></code></pre></div><p><strong>검증:</strong> 복호화 후: 1. LS2 타입 바이트가 유효한지 검증 (3 또는 7) 2. LeaseSet2 구조를 파싱 3. 내부 타임스탬프가 외부 게시된 타임스탬프와 일치하는지 검증 4. 내부 만료 시간이 외부 만료 시간과 일치하는지 검증 5. LeaseSet2 서명을 검증</p>
<h3 id="암호화-계층-요약">암호화 계층 요약</h3>
<pre tabindex="0"><code>┌─────────────────────────────────────────────────┐
│ Layer 0 (Plaintext)                             │
│ - Blinded public key                            │
│ - Timestamps                                    │
│ - Signature                                     │
│                                                 │
│  ┌─────────────────────────────────────────┐   │
│  │ Layer 1 (Encrypted with subcredential)  │   │
│  │ - Authorization flags                   │   │
│  │ - Client auth data (if enabled)         │   │
│  │                                          │   │
│  │  ┌────────────────────────────────┐     │   │
│  │  │ Layer 2 (Encrypted with        │     │   │
│  │  │          authCookie + subcred) │     │   │
│  │  │ - LeaseSet2 type               │     │   │
│  │  │ - LeaseSet2 data               │     │   │
│  │  │ - Leases                       │     │   │
│  │  │ - LS2 signature                │     │   │
│  │  └────────────────────────────────┘     │   │
│  └─────────────────────────────────────────┘   │
└─────────────────────────────────────────────────┘
</code></pre><p><strong>복호화 절차:</strong> 1. 블라인드된 공개키로 레이어 0 서명을 검증 2. 하위 자격 증명(subcredential)을 사용하여 레이어 1을 복호화 3. 인가 데이터(있는 경우)를 처리하여 authCookie를 획득 4. authCookie와 하위 자격 증명을 사용하여 레이어 2를 복호화 5. LeaseSet2를 검증하고 구문 분석</p>
<hr>
<h2 id="클라이언트별-권한-부여">클라이언트별 권한 부여</h2>
<h3 id="개요-2">개요</h3>
<p>클라이언트별 인가가 활성화되면, 서버는 인가된 클라이언트 목록을 유지합니다. 각 클라이언트는 out-of-band(별도 경로)로 안전하게 전송되어야 하는 키 자료를 보유합니다.</p>
<p><strong>두 가지 인가 메커니즘:</strong> 1. <strong>DH (Diffie-Hellman) 클라이언트 인가:</strong> 더 안전하며, X25519 키 합의를 사용합니다 2. <strong>PSK (사전 공유 키) 인가:</strong> 더 단순하며, 대칭 키를 사용합니다</p>
<p><strong>공통 보안 속성:</strong> - 클라이언트 구성원 프라이버시: 관찰자는 클라이언트 수는 볼 수 있지만 특정 클라이언트를 식별할 수 없음 - 익명 클라이언트 추가/철회: 특정 클라이언트가 언제 추가되거나 제거되는지 추적할 수 없음 - 8바이트 클라이언트 식별자 충돌 확률: ~18퀸틸리언(1.8×10^19)분의 1(무시 가능한 수준)</p>
<h3 id="dh디피-헬먼-클라이언트-인가">DH(디피-헬먼) 클라이언트 인가</h3>
<p><strong>개요:</strong> 각 클라이언트는 X25519 키 쌍을 생성하고 자신의 공개 키를 보안 대역외 채널을 통해 서버로 전송한다. 서버는 ephemeral DH(일시적 디피-헬먼 키 교환)를 사용해 각 클라이언트마다 고유한 authCookie를 암호화한다.</p>
<h4 id="클라이언트-키-생성">클라이언트 키 생성</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># Client generates keypair</span>
</span></span><span style="display:flex;"><span>csk_i <span style="color:#f92672">=</span> GENERATE_PRIVATE()  <span style="color:#75715e"># 32-byte X25519 private key</span>
</span></span><span style="display:flex;"><span>cpk_i <span style="color:#f92672">=</span> DERIVE_PUBLIC(csk_i)  <span style="color:#75715e"># 32-byte X25519 public key</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Client sends cpk_i to server via secure out-of-band channel</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Client KEEPS csk_i secret (never transmitted)</span>
</span></span></code></pre></div><p><strong>보안상의 이점:</strong> 클라이언트의 개인 키는 사용자의 장치를 절대 떠나지 않는다. 대역 외(out-of-band) 전송을 가로채는 공격자라도 X25519 DH를 깨뜨리지 않는 한, 향후 암호화된 LeaseSets를 복호화할 수 없다.</p>
<h4 id="서버-처리">서버 처리</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># Server generates new auth cookie and ephemeral keypair</span>
</span></span><span style="display:flex;"><span>authCookie <span style="color:#f92672">=</span> CSRNG(<span style="color:#ae81ff">32</span>)  <span style="color:#75715e"># 32-byte cookie</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>esk <span style="color:#f92672">=</span> GENERATE_PRIVATE()  <span style="color:#75715e"># 32-byte ephemeral private key</span>
</span></span><span style="display:flex;"><span>epk <span style="color:#f92672">=</span> DERIVE_PUBLIC(esk)  <span style="color:#75715e"># 32-byte ephemeral public key</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># For each authorized client i</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> cpk_i <span style="color:#f92672">in</span> authorized_clients:
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Perform DH key agreement</span>
</span></span><span style="display:flex;"><span>    sharedSecret <span style="color:#f92672">=</span> DH(esk, cpk_i)  <span style="color:#75715e"># 32 bytes</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Derive client-specific encryption key</span>
</span></span><span style="display:flex;"><span>    authInput <span style="color:#f92672">=</span> sharedSecret <span style="color:#f92672">||</span> cpk_i <span style="color:#f92672">||</span> subcredential <span style="color:#f92672">||</span> publishedTimestamp
</span></span><span style="display:flex;"><span>    okm <span style="color:#f92672">=</span> HKDF(
</span></span><span style="display:flex;"><span>        salt<span style="color:#f92672">=</span>epk,  <span style="color:#75715e"># Ephemeral public key as salt</span>
</span></span><span style="display:flex;"><span>        ikm<span style="color:#f92672">=</span>authInput,
</span></span><span style="display:flex;"><span>        info<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;ELS2_XCA&#34;</span>,  <span style="color:#75715e"># Domain separation</span>
</span></span><span style="display:flex;"><span>        n<span style="color:#f92672">=</span><span style="color:#ae81ff">52</span>  <span style="color:#75715e"># 32 key + 12 IV + 8 ID</span>
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Extract components</span>
</span></span><span style="display:flex;"><span>    clientKey_i <span style="color:#f92672">=</span> okm[<span style="color:#ae81ff">0</span>:<span style="color:#ae81ff">31</span>]    <span style="color:#75715e"># 32 bytes</span>
</span></span><span style="display:flex;"><span>    clientIV_i <span style="color:#f92672">=</span> okm[<span style="color:#ae81ff">32</span>:<span style="color:#ae81ff">43</span>]    <span style="color:#75715e"># 12 bytes</span>
</span></span><span style="display:flex;"><span>    clientID_i <span style="color:#f92672">=</span> okm[<span style="color:#ae81ff">44</span>:<span style="color:#ae81ff">51</span>]    <span style="color:#75715e"># 8 bytes</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Encrypt authCookie for this client</span>
</span></span><span style="display:flex;"><span>    clientCookie_i <span style="color:#f92672">=</span> ENCRYPT(clientKey_i, clientIV_i, authCookie)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Store [clientID_i, clientCookie_i] entry in Layer 1</span>
</span></span></code></pre></div><p><strong>계층 1 데이터 구조:</strong></p>
<pre tabindex="0"><code>ephemeralPublicKey (32 bytes)
clients (2 bytes) = N
[clientID_1 (8 bytes) || clientCookie_1 (32 bytes)]
[clientID_2 (8 bytes) || clientCookie_2 (32 bytes)]
...
[clientID_N (8 bytes) || clientCookie_N (32 bytes)]
</code></pre><p><strong>서버 권장 사항:</strong> - 게시되는 각 암호화된 LeaseSet마다 새로운 임시 키 쌍을 생성하세요 - 위치 기반 추적을 방지하기 위해 클라이언트 순서를 무작위로 섞으세요 - 실제 클라이언트 수를 숨기기 위해 더미 항목을 추가하는 것을 고려하세요</p>
<h4 id="클라이언트-처리">클라이언트 처리</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># Client has: csk_i (their private key), destination, date, secret</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Client receives: encrypted LeaseSet with epk in Layer 1</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Perform DH key agreement with server&#39;s ephemeral public key</span>
</span></span><span style="display:flex;"><span>sharedSecret <span style="color:#f92672">=</span> DH(csk_i, epk)  <span style="color:#75715e"># 32 bytes</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Derive expected client identifier and decryption key</span>
</span></span><span style="display:flex;"><span>cpk_i <span style="color:#f92672">=</span> DERIVE_PUBLIC(csk_i)  <span style="color:#75715e"># Client&#39;s own public key</span>
</span></span><span style="display:flex;"><span>authInput <span style="color:#f92672">=</span> sharedSecret <span style="color:#f92672">||</span> cpk_i <span style="color:#f92672">||</span> subcredential <span style="color:#f92672">||</span> publishedTimestamp
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>okm <span style="color:#f92672">=</span> HKDF(
</span></span><span style="display:flex;"><span>    salt<span style="color:#f92672">=</span>epk,
</span></span><span style="display:flex;"><span>    ikm<span style="color:#f92672">=</span>authInput,
</span></span><span style="display:flex;"><span>    info<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;ELS2_XCA&#34;</span>,
</span></span><span style="display:flex;"><span>    n<span style="color:#f92672">=</span><span style="color:#ae81ff">52</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>clientKey_i <span style="color:#f92672">=</span> okm[<span style="color:#ae81ff">0</span>:<span style="color:#ae81ff">31</span>]    <span style="color:#75715e"># 32 bytes</span>
</span></span><span style="display:flex;"><span>clientIV_i <span style="color:#f92672">=</span> okm[<span style="color:#ae81ff">32</span>:<span style="color:#ae81ff">43</span>]    <span style="color:#75715e"># 12 bytes</span>
</span></span><span style="display:flex;"><span>clientID_i <span style="color:#f92672">=</span> okm[<span style="color:#ae81ff">44</span>:<span style="color:#ae81ff">51</span>]    <span style="color:#75715e"># 8 bytes</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Search Layer 1 authorization data for clientID_i</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> (clientID, clientCookie) <span style="color:#f92672">in</span> layer1_auth_entries:
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> clientID <span style="color:#f92672">==</span> clientID_i:
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Found matching entry, decrypt authCookie</span>
</span></span><span style="display:flex;"><span>        authCookie <span style="color:#f92672">=</span> DECRYPT(clientKey_i, clientIV_i, clientCookie)
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Use authCookie to decrypt Layer 2</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">break</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># No matching entry - client not authorized or revoked</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">raise</span> AuthorizationError(<span style="color:#e6db74">&#34;Client not authorized&#34;</span>)
</span></span></code></pre></div><p><strong>클라이언트 오류 처리:</strong> - <code>clientID_i</code>를 찾을 수 없는 경우: 클라이언트 권한이 해지되었거나 처음부터 승인되지 않음 - 복호화에 실패한 경우: 데이터 손상 또는 잘못된 키(매우 드뭄) - 해지 여부를 감지하기 위해 클라이언트는 주기적으로 다시 가져와야 함</p>
<h3 id="psk-클라이언트-인가">PSK 클라이언트 인가</h3>
<p><strong>개요:</strong> 각 클라이언트는 사전 공유된 32바이트 대칭 키를 보유합니다. 서버는 각 클라이언트의 PSK(사전 공유 키)를 사용하여 동일한 authCookie를 암호화합니다.</p>
<h4 id="키-생성">키 생성</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># Option 1: Client generates key</span>
</span></span><span style="display:flex;"><span>psk_i <span style="color:#f92672">=</span> CSRNG(<span style="color:#ae81ff">32</span>)  <span style="color:#75715e"># 32-byte pre-shared key</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Client sends psk_i to server via secure out-of-band channel</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Option 2: Server generates key</span>
</span></span><span style="display:flex;"><span>psk_i <span style="color:#f92672">=</span> CSRNG(<span style="color:#ae81ff">32</span>)  <span style="color:#75715e"># 32-byte pre-shared key</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Server sends psk_i to one or more clients via secure out-of-band channel</span>
</span></span></code></pre></div><p><strong>보안 참고:</strong> 원한다면 동일한 PSK(사전 공유 키)를 여러 클라이언트가 공유할 수 있습니다(“그룹” 인가를 생성합니다).</p>
<h4 id="서버-처리-1">서버 처리</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># Server generates new auth cookie and salt</span>
</span></span><span style="display:flex;"><span>authCookie <span style="color:#f92672">=</span> CSRNG(<span style="color:#ae81ff">32</span>)  <span style="color:#75715e"># 32-byte cookie</span>
</span></span><span style="display:flex;"><span>authSalt <span style="color:#f92672">=</span> CSRNG(<span style="color:#ae81ff">32</span>)     <span style="color:#75715e"># 32-byte salt</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># For each authorized client i</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> psk_i <span style="color:#f92672">in</span> authorized_clients:
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Derive client-specific encryption key</span>
</span></span><span style="display:flex;"><span>    authInput <span style="color:#f92672">=</span> psk_i <span style="color:#f92672">||</span> subcredential <span style="color:#f92672">||</span> publishedTimestamp
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    okm <span style="color:#f92672">=</span> HKDF(
</span></span><span style="display:flex;"><span>        salt<span style="color:#f92672">=</span>authSalt,
</span></span><span style="display:flex;"><span>        ikm<span style="color:#f92672">=</span>authInput,
</span></span><span style="display:flex;"><span>        info<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;ELS2PSKA&#34;</span>,  <span style="color:#75715e"># Domain separation</span>
</span></span><span style="display:flex;"><span>        n<span style="color:#f92672">=</span><span style="color:#ae81ff">52</span>  <span style="color:#75715e"># 32 key + 12 IV + 8 ID</span>
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Extract components</span>
</span></span><span style="display:flex;"><span>    clientKey_i <span style="color:#f92672">=</span> okm[<span style="color:#ae81ff">0</span>:<span style="color:#ae81ff">31</span>]    <span style="color:#75715e"># 32 bytes</span>
</span></span><span style="display:flex;"><span>    clientIV_i <span style="color:#f92672">=</span> okm[<span style="color:#ae81ff">32</span>:<span style="color:#ae81ff">43</span>]    <span style="color:#75715e"># 12 bytes</span>
</span></span><span style="display:flex;"><span>    clientID_i <span style="color:#f92672">=</span> okm[<span style="color:#ae81ff">44</span>:<span style="color:#ae81ff">51</span>]    <span style="color:#75715e"># 8 bytes</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Encrypt authCookie for this client</span>
</span></span><span style="display:flex;"><span>    clientCookie_i <span style="color:#f92672">=</span> ENCRYPT(clientKey_i, clientIV_i, authCookie)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Store [clientID_i, clientCookie_i] entry in Layer 1</span>
</span></span></code></pre></div><p><strong>계층 1 데이터 구조:</strong></p>
<pre tabindex="0"><code>authSalt (32 bytes)
clients (2 bytes) = N
[clientID_1 (8 bytes) || clientCookie_1 (32 bytes)]
[clientID_2 (8 bytes) || clientCookie_2 (32 bytes)]
...
[clientID_N (8 bytes) || clientCookie_N (32 bytes)]
</code></pre><h4 id="클라이언트-처리-1">클라이언트 처리</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># Client has: psk_i (their pre-shared key), destination, date, secret</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Client receives: encrypted LeaseSet with authSalt in Layer 1</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Derive expected client identifier and decryption key</span>
</span></span><span style="display:flex;"><span>authInput <span style="color:#f92672">=</span> psk_i <span style="color:#f92672">||</span> subcredential <span style="color:#f92672">||</span> publishedTimestamp
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>okm <span style="color:#f92672">=</span> HKDF(
</span></span><span style="display:flex;"><span>    salt<span style="color:#f92672">=</span>authSalt,
</span></span><span style="display:flex;"><span>    ikm<span style="color:#f92672">=</span>authInput,
</span></span><span style="display:flex;"><span>    info<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;ELS2PSKA&#34;</span>,
</span></span><span style="display:flex;"><span>    n<span style="color:#f92672">=</span><span style="color:#ae81ff">52</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>clientKey_i <span style="color:#f92672">=</span> okm[<span style="color:#ae81ff">0</span>:<span style="color:#ae81ff">31</span>]    <span style="color:#75715e"># 32 bytes</span>
</span></span><span style="display:flex;"><span>clientIV_i <span style="color:#f92672">=</span> okm[<span style="color:#ae81ff">32</span>:<span style="color:#ae81ff">43</span>]    <span style="color:#75715e"># 12 bytes</span>
</span></span><span style="display:flex;"><span>clientID_i <span style="color:#f92672">=</span> okm[<span style="color:#ae81ff">44</span>:<span style="color:#ae81ff">51</span>]    <span style="color:#75715e"># 8 bytes</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Search Layer 1 authorization data for clientID_i</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> (clientID, clientCookie) <span style="color:#f92672">in</span> layer1_auth_entries:
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> clientID <span style="color:#f92672">==</span> clientID_i:
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Found matching entry, decrypt authCookie</span>
</span></span><span style="display:flex;"><span>        authCookie <span style="color:#f92672">=</span> DECRYPT(clientKey_i, clientIV_i, clientCookie)
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Use authCookie to decrypt Layer 2</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">break</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># No matching entry - client not authorized or revoked</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">raise</span> AuthorizationError(<span style="color:#e6db74">&#34;Client not authorized&#34;</span>)
</span></span></code></pre></div><h3 id="비교-및-권장-사항">비교 및 권장 사항</h3>
<table style="width:100%; border-collapse:collapse; margin-bottom:1.5rem;">
  <thead>
    <tr>
      <th style="border:1px solid var(--color-border); padding:0.5rem; background:var(--color-bg-secondary); text-align:left;">Feature</th>
      <th style="border:1px solid var(--color-border); padding:0.5rem; background:var(--color-bg-secondary); text-align:left;">DH Authorization</th>
      <th style="border:1px solid var(--color-border); padding:0.5rem; background:var(--color-bg-secondary); text-align:left;">PSK Authorization</th>
    </tr>
  </thead>
  <tbody>
    <tr><td style="border:1px solid var(--color-border); padding:0.5rem;"><strong>Key Exchange</strong></td><td style="border:1px solid var(--color-border); padding:0.5rem;">Asymmetric (X25519)</td><td style="border:1px solid var(--color-border); padding:0.5rem;">Symmetric (shared secret)</td></tr>
    <tr><td style="border:1px solid var(--color-border); padding:0.5rem;"><strong>Security</strong></td><td style="border:1px solid var(--color-border); padding:0.5rem;">Higher (forward secrecy)</td><td style="border:1px solid var(--color-border); padding:0.5rem;">Lower (depends on PSK secrecy)</td></tr>
    <tr><td style="border:1px solid var(--color-border); padding:0.5rem;"><strong>Client Privacy</strong></td><td style="border:1px solid var(--color-border); padding:0.5rem;">Private key never transmitted</td><td style="border:1px solid var(--color-border); padding:0.5rem;">PSK must be transmitted securely</td></tr>
    <tr><td style="border:1px solid var(--color-border); padding:0.5rem;"><strong>Performance</strong></td><td style="border:1px solid var(--color-border); padding:0.5rem;">N+1 DH operations</td><td style="border:1px solid var(--color-border); padding:0.5rem;">No DH operations</td></tr>
    <tr><td style="border:1px solid var(--color-border); padding:0.5rem;"><strong>Key Sharing</strong></td><td style="border:1px solid var(--color-border); padding:0.5rem;">One key per client</td><td style="border:1px solid var(--color-border); padding:0.5rem;">Can share key among multiple clients</td></tr>
    <tr><td style="border:1px solid var(--color-border); padding:0.5rem;"><strong>Revocation Detection</strong></td><td style="border:1px solid var(--color-border); padding:0.5rem;">Adversary cannot tell when revoked</td><td style="border:1px solid var(--color-border); padding:0.5rem;">Adversary can track revocation if PSK intercepted</td></tr>
    <tr><td style="border:1px solid var(--color-border); padding:0.5rem;"><strong>Use Case</strong></td><td style="border:1px solid var(--color-border); padding:0.5rem;">High security requirements</td><td style="border:1px solid var(--color-border); padding:0.5rem;">Performance-critical or group access</td></tr>
  </tbody>
</table>
**권장 사항:** - **DH authorization(Diffie-Hellman 기반 인가) 사용** forward secrecy(순방향 기밀성)가 중요한 고보안 애플리케이션의 경우 - **PSK authorization(사전 공유 키 기반 인가) 사용** 성능이 중요하거나 클라이언트 그룹을 관리해야 하는 경우 - **PSK를 절대 재사용하지 말 것** 서로 다른 서비스나 기간에 걸쳐 - **항상 보안 채널 사용** 키 배포 시 (예: Signal, OTR, PGP)
<h3 id="보안-고려-사항">보안 고려 사항</h3>
<p><strong>클라이언트 구성원 프라이버시:</strong></p>
<p>두 메커니즘은 다음을 통해 클라이언트 멤버십의 프라이버시를 제공합니다: 1. <strong>암호화된 클라이언트 식별자:</strong> HKDF(키 유도 함수) 출력에서 파생된 8바이트 clientID 2. <strong>구분 불가능한 쿠키:</strong> 모든 32바이트 clientCookie 값은 무작위로 보임 3. <strong>클라이언트별 메타데이터 없음:</strong> 어떤 항목이 어느 클라이언트에 속하는지 식별할 방법이 없음</p>
<p>관찰자는 다음을 확인할 수 있습니다: - 허가된 클라이언트 수(<code>clients</code> 필드에서) - 시간 경과에 따른 클라이언트 수 변화</p>
<p>관찰자는 다음을 볼 수 없습니다: - 어떤 특정 클라이언트가 승인되었는지 - 특정 클라이언트가 언제 추가되거나 제거되었는지 (개수가 동일하게 유지되는 경우) - 클라이언트를 식별할 수 있는 모든 정보</p>
<p><strong>무작위화 권장 사항:</strong></p>
<p>서버는 암호화된 LeaseSet(I2P 목적지에 연결하기 위한 정보 집합)을 생성할 때마다 클라이언트 순서를 무작위화하는 것이 권장된다:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> random
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Before serializing</span>
</span></span><span style="display:flex;"><span>auth_entries <span style="color:#f92672">=</span> [(clientID_i, clientCookie_i) <span style="color:#66d9ef">for</span> each client]
</span></span><span style="display:flex;"><span>random<span style="color:#f92672">.</span>shuffle(auth_entries)
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Now serialize in randomized order</span>
</span></span></code></pre></div><p><strong>장점:</strong> - 클라이언트가 목록 내에서 자신의 위치를 알아내는 것을 방지합니다 - 위치 변경에 기반한 추론 공격을 방지합니다 - 클라이언트 추가/철회를 구분할 수 없게 합니다</p>
<p><strong>클라이언트 수 숨기기:</strong></p>
<p>서버는 임의의 더미 항목을 삽입할 수 있다:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># Add dummy entries</span>
</span></span><span style="display:flex;"><span>num_dummies <span style="color:#f92672">=</span> random<span style="color:#f92672">.</span>randint(<span style="color:#ae81ff">0</span>, max_dummies)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> _ <span style="color:#f92672">in</span> range(num_dummies):
</span></span><span style="display:flex;"><span>    dummy_id <span style="color:#f92672">=</span> CSRNG(<span style="color:#ae81ff">8</span>)
</span></span><span style="display:flex;"><span>    dummy_cookie <span style="color:#f92672">=</span> CSRNG(<span style="color:#ae81ff">32</span>)
</span></span><span style="display:flex;"><span>    auth_entries<span style="color:#f92672">.</span>append((dummy_id, dummy_cookie))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Randomize all entries (real + dummy)</span>
</span></span><span style="display:flex;"><span>random<span style="color:#f92672">.</span>shuffle(auth_entries)
</span></span></code></pre></div><p><strong>비용:</strong> 더미 엔트리는 암호화된 LeaseSet의 크기를 증가시킵니다(엔트리당 40바이트).</p>
<p><strong>AuthCookie 로테이션:</strong></p>
<p>서버는 새 authCookie(인증 쿠키)를 생성하는 것이 권장된다:</p>
<ul>
<li>암호화된 LeaseSet이 게시될 때마다(보통 몇 시간마다 한 번)</li>
<li>클라이언트의 권한을 취소한 직후</li>
<li>클라이언트 변경이 없더라도 정기 일정(예: 매일)에 맞춰</li>
</ul>
<p><strong>장점:</strong> - authCookie가 탈취되었을 때 노출 범위를 제한합니다 - 권한이 철회된 클라이언트가 신속히 접근 권한을 잃도록 보장합니다 - Layer 2에 대해 전방향 기밀성을 제공합니다</p>
<hr>
<h2 id="암호화된-leasesetsi2p-목적지-접근-정보-세트용-base32-주소-체계">암호화된 LeaseSets(I2P 목적지 접근 정보 세트)용 Base32 주소 체계</h2>
<h3 id="개요-3">개요</h3>
<p>기존의 I2P base32 주소는 Destination(목적지)의 해시만 포함합니다(32 바이트 → 52 문자). 이는 암호화된 LeaseSets에 대해 충분하지 않은데, 그 이유는:</p>
<ol>
<li>클라이언트가 <strong>블라인딩된 공개키</strong>를 파생시키려면 <strong>블라인딩되지 않은 공개키</strong>가 필요합니다</li>
<li>클라이언트는 적절한 키 파생을 위해 <strong>서명 유형</strong>(블라인딩되지 않은 것과 블라인딩된 것)이 필요합니다</li>
<li>해시만으로는 이 정보를 제공하지 않습니다</li>
</ol>
<p><strong>해결책:</strong> 공개 키와 서명 유형을 포함하는 새로운 base32 형식.</p>
<h3 id="주소-형식-사양">주소 형식 사양</h3>
<p><strong>디코딩된 구조 (35바이트):</strong></p>
<pre tabindex="0"><code>┌─────────────────────────────────────────────────────┐
│ Byte 0   │ Byte 1  │ Byte 2  │ Bytes 3-34          │
│ Flags    │ Unblind │ Blinded │ Public Key          │
│ (XOR)    │ SigType │ SigType │ (32 bytes)          │
│          │ (XOR)   │ (XOR)   │                     │
└─────────────────────────────────────────────────────┘
</code></pre><p><strong>첫 3바이트 (체크섬과 XOR(배타적 논리합)):</strong></p>
<p>처음 3바이트에는 CRC-32 체크섬의 일부와 XOR(배타적 논리합)된 메타데이터가 포함된다:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># Data structure before XOR</span>
</span></span><span style="display:flex;"><span>flags <span style="color:#f92672">=</span> <span style="color:#ae81ff">0x00</span>           <span style="color:#75715e"># 1 byte (reserved for future use)</span>
</span></span><span style="display:flex;"><span>unblinded_sigtype <span style="color:#f92672">=</span> <span style="color:#ae81ff">0x07</span> <span style="color:#f92672">or</span> <span style="color:#ae81ff">0x0b</span>  <span style="color:#75715e"># 1 byte (7 or 11)</span>
</span></span><span style="display:flex;"><span>blinded_sigtype <span style="color:#f92672">=</span> <span style="color:#ae81ff">0x0b</span>  <span style="color:#75715e"># 1 byte (always 11)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Compute CRC-32 checksum of public key</span>
</span></span><span style="display:flex;"><span>checksum <span style="color:#f92672">=</span> crc32(pubkey)  <span style="color:#75715e"># 4-byte CRC-32 of bytes 3-34</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># XOR first 3 bytes with parts of checksum</span>
</span></span><span style="display:flex;"><span>data[<span style="color:#ae81ff">0</span>] <span style="color:#f92672">=</span> flags XOR (checksum <span style="color:#f92672">&gt;&gt;</span> <span style="color:#ae81ff">24</span>) <span style="color:#f92672">&amp;</span> <span style="color:#ae81ff">0xFF</span>
</span></span><span style="display:flex;"><span>data[<span style="color:#ae81ff">1</span>] <span style="color:#f92672">=</span> unblinded_sigtype XOR (checksum <span style="color:#f92672">&gt;&gt;</span> <span style="color:#ae81ff">16</span>) <span style="color:#f92672">&amp;</span> <span style="color:#ae81ff">0xFF</span>  
</span></span><span style="display:flex;"><span>data[<span style="color:#ae81ff">2</span>] <span style="color:#f92672">=</span> blinded_sigtype XOR (checksum <span style="color:#f92672">&gt;&gt;</span> <span style="color:#ae81ff">8</span>) <span style="color:#f92672">&amp;</span> <span style="color:#ae81ff">0xFF</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Bytes 3-34 contain the unmodified 32-byte public key</span>
</span></span><span style="display:flex;"><span>data[<span style="color:#ae81ff">3</span>:<span style="color:#ae81ff">34</span>] <span style="color:#f92672">=</span> pubkey
</span></span></code></pre></div><p><strong>체크섬 속성:</strong> - 표준 CRC-32 다항식을 사용 - 검출 실패 확률: 약 1/1,600만 - 주소 오타에 대한 오류 검출 기능 제공 - 인증 용도로는 사용할 수 없음(암호학적으로 안전하지 않음)</p>
<p><strong>인코딩된 형식:</strong></p>
<pre tabindex="0"><code>Base32Encode(35 bytes) || &#34;.b32.i2p&#34;
</code></pre><p><strong>특징:</strong> - 총 문자 수: 56 (35바이트 × 8비트 ÷ 문자당 5비트) - 접미사: &ldquo;.b32.i2p&rdquo; (기존의 base32와 동일) - 총 길이: 56 + 8 = 64자 (널 종료 문자 제외)</p>
<p><strong>Base32 인코딩:</strong> - 알파벳: <code>abcdefghijklmnopqrstuvwxyz234567</code> (RFC 4648 표준) - 끝의 사용되지 않는 5비트는 반드시 0이어야 함 - 대소문자 구분 없음 (관례적으로 소문자 사용)</p>
<h3 id="주소-생성">주소 생성</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> struct
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> zlib <span style="color:#f92672">import</span> crc32
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> base64
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">generate_encrypted_b32_address</span>(pubkey, unblinded_sigtype, blinded_sigtype):
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    Generate base32 address for encrypted LeaseSet.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    Args:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        pubkey: 32-byte public key (bytes)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        unblinded_sigtype: Unblinded signature type (7 or 11)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        blinded_sigtype: Blinded signature type (always 11)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    Returns:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        String address ending in .b32.i2p
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Verify inputs</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">assert</span> len(pubkey) <span style="color:#f92672">==</span> <span style="color:#ae81ff">32</span>, <span style="color:#e6db74">&#34;Public key must be 32 bytes&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">assert</span> unblinded_sigtype <span style="color:#f92672">in</span> [<span style="color:#ae81ff">7</span>, <span style="color:#ae81ff">11</span>], <span style="color:#e6db74">&#34;Unblinded sigtype must be 7 or 11&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">assert</span> blinded_sigtype <span style="color:#f92672">==</span> <span style="color:#ae81ff">11</span>, <span style="color:#e6db74">&#34;Blinded sigtype must be 11&#34;</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Compute CRC-32 of public key</span>
</span></span><span style="display:flex;"><span>    checksum <span style="color:#f92672">=</span> crc32(pubkey) <span style="color:#f92672">&amp;</span> <span style="color:#ae81ff">0xFFFFFFFF</span>  <span style="color:#75715e"># Ensure 32-bit unsigned</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Prepare metadata bytes</span>
</span></span><span style="display:flex;"><span>    flags <span style="color:#f92672">=</span> <span style="color:#ae81ff">0x00</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># XOR metadata with checksum parts</span>
</span></span><span style="display:flex;"><span>    byte0 <span style="color:#f92672">=</span> flags <span style="color:#f92672">^</span> ((checksum <span style="color:#f92672">&gt;&gt;</span> <span style="color:#ae81ff">24</span>) <span style="color:#f92672">&amp;</span> <span style="color:#ae81ff">0xFF</span>)
</span></span><span style="display:flex;"><span>    byte1 <span style="color:#f92672">=</span> unblinded_sigtype <span style="color:#f92672">^</span> ((checksum <span style="color:#f92672">&gt;&gt;</span> <span style="color:#ae81ff">16</span>) <span style="color:#f92672">&amp;</span> <span style="color:#ae81ff">0xFF</span>)
</span></span><span style="display:flex;"><span>    byte2 <span style="color:#f92672">=</span> blinded_sigtype <span style="color:#f92672">^</span> ((checksum <span style="color:#f92672">&gt;&gt;</span> <span style="color:#ae81ff">8</span>) <span style="color:#f92672">&amp;</span> <span style="color:#ae81ff">0xFF</span>)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Construct 35-byte data</span>
</span></span><span style="display:flex;"><span>    data <span style="color:#f92672">=</span> bytes([byte0, byte1, byte2]) <span style="color:#f92672">+</span> pubkey
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Base32 encode (standard alphabet)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Python&#39;s base64 module uses uppercase by default</span>
</span></span><span style="display:flex;"><span>    b32 <span style="color:#f92672">=</span> base64<span style="color:#f92672">.</span>b32encode(data)<span style="color:#f92672">.</span>decode(<span style="color:#e6db74">&#39;ascii&#39;</span>)<span style="color:#f92672">.</span>lower()<span style="color:#f92672">.</span>rstrip(<span style="color:#e6db74">&#39;=&#39;</span>)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Construct full address</span>
</span></span><span style="display:flex;"><span>    address <span style="color:#f92672">=</span> b32 <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;.b32.i2p&#34;</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> address
</span></span></code></pre></div><h3 id="주소-파싱">주소 파싱</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> struct
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> zlib <span style="color:#f92672">import</span> crc32
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> base64
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">parse_encrypted_b32_address</span>(address):
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    Parse base32 address for encrypted LeaseSet.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    Args:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        address: String address ending in .b32.i2p
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    Returns:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        Tuple of (pubkey, unblinded_sigtype, blinded_sigtype)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    Raises:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        ValueError: If address is invalid or checksum fails
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Remove suffix</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> address<span style="color:#f92672">.</span>endswith(<span style="color:#e6db74">&#39;.b32.i2p&#39;</span>):
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">raise</span> <span style="color:#a6e22e">ValueError</span>(<span style="color:#e6db74">&#34;Invalid address suffix&#34;</span>)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    b32 <span style="color:#f92672">=</span> address[:<span style="color:#f92672">-</span><span style="color:#ae81ff">8</span>]  <span style="color:#75715e"># Remove &#34;.b32.i2p&#34;</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Verify length (56 characters for 35 bytes)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> len(b32) <span style="color:#f92672">!=</span> <span style="color:#ae81ff">56</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">raise</span> <span style="color:#a6e22e">ValueError</span>(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Invalid length: </span><span style="color:#e6db74">{</span>len(b32)<span style="color:#e6db74">}</span><span style="color:#e6db74"> (expected 56)&#34;</span>)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Base32 decode</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Add padding if needed</span>
</span></span><span style="display:flex;"><span>    padding_needed <span style="color:#f92672">=</span> (<span style="color:#ae81ff">8</span> <span style="color:#f92672">-</span> (len(b32) <span style="color:#f92672">%</span> <span style="color:#ae81ff">8</span>)) <span style="color:#f92672">%</span> <span style="color:#ae81ff">8</span>
</span></span><span style="display:flex;"><span>    b32_padded <span style="color:#f92672">=</span> b32<span style="color:#f92672">.</span>upper() <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;=&#39;</span> <span style="color:#f92672">*</span> padding_needed
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">try</span>:
</span></span><span style="display:flex;"><span>        data <span style="color:#f92672">=</span> base64<span style="color:#f92672">.</span>b32decode(b32_padded)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">except</span> <span style="color:#a6e22e">Exception</span> <span style="color:#66d9ef">as</span> e:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">raise</span> <span style="color:#a6e22e">ValueError</span>(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Invalid base32 encoding: </span><span style="color:#e6db74">{</span>e<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Verify decoded length</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> len(data) <span style="color:#f92672">!=</span> <span style="color:#ae81ff">35</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">raise</span> <span style="color:#a6e22e">ValueError</span>(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Invalid decoded length: </span><span style="color:#e6db74">{</span>len(data)<span style="color:#e6db74">}</span><span style="color:#e6db74"> (expected 35)&#34;</span>)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Extract public key</span>
</span></span><span style="display:flex;"><span>    pubkey <span style="color:#f92672">=</span> data[<span style="color:#ae81ff">3</span>:<span style="color:#ae81ff">35</span>]
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Compute CRC-32 for verification</span>
</span></span><span style="display:flex;"><span>    checksum <span style="color:#f92672">=</span> crc32(pubkey) <span style="color:#f92672">&amp;</span> <span style="color:#ae81ff">0xFFFFFFFF</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Un-XOR metadata bytes</span>
</span></span><span style="display:flex;"><span>    flags <span style="color:#f92672">=</span> data[<span style="color:#ae81ff">0</span>] <span style="color:#f92672">^</span> ((checksum <span style="color:#f92672">&gt;&gt;</span> <span style="color:#ae81ff">24</span>) <span style="color:#f92672">&amp;</span> <span style="color:#ae81ff">0xFF</span>)
</span></span><span style="display:flex;"><span>    unblinded_sigtype <span style="color:#f92672">=</span> data[<span style="color:#ae81ff">1</span>] <span style="color:#f92672">^</span> ((checksum <span style="color:#f92672">&gt;&gt;</span> <span style="color:#ae81ff">16</span>) <span style="color:#f92672">&amp;</span> <span style="color:#ae81ff">0xFF</span>)
</span></span><span style="display:flex;"><span>    blinded_sigtype <span style="color:#f92672">=</span> data[<span style="color:#ae81ff">2</span>] <span style="color:#f92672">^</span> ((checksum <span style="color:#f92672">&gt;&gt;</span> <span style="color:#ae81ff">8</span>) <span style="color:#f92672">&amp;</span> <span style="color:#ae81ff">0xFF</span>)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Verify expected values</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> flags <span style="color:#f92672">!=</span> <span style="color:#ae81ff">0x00</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">raise</span> <span style="color:#a6e22e">ValueError</span>(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Invalid flags: </span><span style="color:#e6db74">{</span>flags<span style="color:#e6db74">:</span><span style="color:#e6db74">#x</span><span style="color:#e6db74">}</span><span style="color:#e6db74"> (expected 0x00)&#34;</span>)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> unblinded_sigtype <span style="color:#f92672">not</span> <span style="color:#f92672">in</span> [<span style="color:#ae81ff">7</span>, <span style="color:#ae81ff">11</span>]:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">raise</span> <span style="color:#a6e22e">ValueError</span>(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Invalid unblinded sigtype: </span><span style="color:#e6db74">{</span>unblinded_sigtype<span style="color:#e6db74">}</span><span style="color:#e6db74"> (expected 7 or 11)&#34;</span>)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> blinded_sigtype <span style="color:#f92672">!=</span> <span style="color:#ae81ff">11</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">raise</span> <span style="color:#a6e22e">ValueError</span>(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Invalid blinded sigtype: </span><span style="color:#e6db74">{</span>blinded_sigtype<span style="color:#e6db74">}</span><span style="color:#e6db74"> (expected 11)&#34;</span>)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> pubkey, unblinded_sigtype, blinded_sigtype
</span></span></code></pre></div><h3 id="기존-base32와의-비교">기존 Base32와의 비교</h3>
<table style="width:100%; border-collapse:collapse; margin-bottom:1.5rem;">
  <thead>
    <tr>
      <th style="border:1px solid var(--color-border); padding:0.5rem; background:var(--color-bg-secondary); text-align:left;">Feature</th>
      <th style="border:1px solid var(--color-border); padding:0.5rem; background:var(--color-bg-secondary); text-align:left;">Traditional B32</th>
      <th style="border:1px solid var(--color-border); padding:0.5rem; background:var(--color-bg-secondary); text-align:left;">Encrypted LS2 B32</th>
    </tr>
  </thead>
  <tbody>
    <tr><td style="border:1px solid var(--color-border); padding:0.5rem;"><strong>Content</strong></td><td style="border:1px solid var(--color-border); padding:0.5rem;">SHA-256 hash of Destination</td><td style="border:1px solid var(--color-border); padding:0.5rem;">Public key + signature types</td></tr>
    <tr><td style="border:1px solid var(--color-border); padding:0.5rem;"><strong>Decoded Size</strong></td><td style="border:1px solid var(--color-border); padding:0.5rem;">32 bytes</td><td style="border:1px solid var(--color-border); padding:0.5rem;">35 bytes</td></tr>
    <tr><td style="border:1px solid var(--color-border); padding:0.5rem;"><strong>Encoded Length</strong></td><td style="border:1px solid var(--color-border); padding:0.5rem;">52 characters</td><td style="border:1px solid var(--color-border); padding:0.5rem;">56 characters</td></tr>
    <tr><td style="border:1px solid var(--color-border); padding:0.5rem;"><strong>Suffix</strong></td><td style="border:1px solid var(--color-border); padding:0.5rem;">.b32.i2p</td><td style="border:1px solid var(--color-border); padding:0.5rem;">.b32.i2p</td></tr>
    <tr><td style="border:1px solid var(--color-border); padding:0.5rem;"><strong>Total Length</strong></td><td style="border:1px solid var(--color-border); padding:0.5rem;">60 chars</td><td style="border:1px solid var(--color-border); padding:0.5rem;">64 chars</td></tr>
    <tr><td style="border:1px solid var(--color-border); padding:0.5rem;"><strong>Checksum</strong></td><td style="border:1px solid var(--color-border); padding:0.5rem;">None</td><td style="border:1px solid var(--color-border); padding:0.5rem;">CRC-32 (XOR'd into first 3 bytes)</td></tr>
    <tr><td style="border:1px solid var(--color-border); padding:0.5rem;"><strong>Use Case</strong></td><td style="border:1px solid var(--color-border); padding:0.5rem;">Regular destinations</td><td style="border:1px solid var(--color-border); padding:0.5rem;">Encrypted LeaseSet destinations</td></tr>
  </tbody>
</table>
### 이용 제한
<p><strong>BitTorrent 비호환성:</strong></p>
<p>암호화된 LS2 주소는 BitTorrent의 compact announce 응답과 함께 사용할 수 없습니다:</p>
<pre tabindex="0"><code>Compact announce reply format:
┌────────────────────────────┐
│ 32-byte destination hash   │  ← Only hash, no signature types
│ 2-byte port                │
└────────────────────────────┘
</code></pre><p><strong>문제:</strong> Compact format(간결한 형식)에는 해시(32바이트)만 포함되어 있어 서명 유형이나 공개 키 정보를 위한 공간이 없습니다.</p>
<p><strong>해결 방법:</strong> 전체 announce 응답을 사용하거나 전체 주소를 지원하는 HTTP 기반 트래커를 사용하세요.</p>
<h3 id="주소록-통합">주소록 통합</h3>
<p>만약 클라이언트가 주소록에 전체 Destination(목적지)을 가지고 있다면:</p>
<ol>
<li>공개키를 포함한 전체 Destination(목적지)를 저장</li>
<li>해시를 통한 역방향 조회 지원</li>
<li>암호화된 LS2(leaseSet 2형식)를 만났을 때 주소록에서 공개키 가져오기</li>
<li>전체 Destination을 이미 알고 있다면 새로운 base32 형식이 필요 없음</li>
</ol>
<p><strong>암호화된 LS2(LeaseSet2)를 지원하는 주소록 형식:</strong> - 전체 destination 문자열이 포함된 hosts.txt - destination 열이 있는 SQLite 데이터베이스 - 전체 destination 데이터가 포함된 JSON/XML 형식</p>
<h3 id="구현-예시">구현 예시</h3>
<p><strong>예제 1: 주소 생성</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># Ed25519 destination example</span>
</span></span><span style="display:flex;"><span>pubkey <span style="color:#f92672">=</span> bytes<span style="color:#f92672">.</span>fromhex(<span style="color:#e6db74">&#39;a&#39;</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">64</span>)  <span style="color:#75715e"># 32-byte public key</span>
</span></span><span style="display:flex;"><span>unblinded_type <span style="color:#f92672">=</span> <span style="color:#ae81ff">7</span>   <span style="color:#75715e"># Ed25519</span>
</span></span><span style="display:flex;"><span>blinded_type <span style="color:#f92672">=</span> <span style="color:#ae81ff">11</span>    <span style="color:#75715e"># Red25519 (always)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>address <span style="color:#f92672">=</span> generate_encrypted_b32_address(pubkey, unblinded_type, blinded_type)
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Address: </span><span style="color:#e6db74">{</span>address<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Output: 56 base32 characters + .b32.i2p</span>
</span></span></code></pre></div><p><strong>예제 2: 파싱 및 검증</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>address <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;abc...xyz.b32.i2p&#34;</span>  <span style="color:#75715e"># 56 chars + suffix</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">try</span>:
</span></span><span style="display:flex;"><span>    pubkey, unblinded, blinded <span style="color:#f92672">=</span> parse_encrypted_b32_address(address)
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Public Key: </span><span style="color:#e6db74">{</span>pubkey<span style="color:#f92672">.</span>hex()<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Unblinded SigType: </span><span style="color:#e6db74">{</span>unblinded<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Blinded SigType: </span><span style="color:#e6db74">{</span>blinded<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">except</span> <span style="color:#a6e22e">ValueError</span> <span style="color:#66d9ef">as</span> e:
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Invalid address: </span><span style="color:#e6db74">{</span>e<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span></code></pre></div><p><strong>예제 3: Destination(목적지: I2P의 엔드포인트 식별자)에서 변환</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">destination_to_encrypted_b32</span>(destination):
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    Convert full Destination to encrypted LS2 base32 address.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    Args:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        destination: I2P Destination object
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    Returns:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        Base32 address string
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Extract public key and signature type from destination</span>
</span></span><span style="display:flex;"><span>    pubkey <span style="color:#f92672">=</span> destination<span style="color:#f92672">.</span>signing_public_key  <span style="color:#75715e"># 32 bytes</span>
</span></span><span style="display:flex;"><span>    sigtype <span style="color:#f92672">=</span> destination<span style="color:#f92672">.</span>sig_type  <span style="color:#75715e"># 7 or 11</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Blinded type is always 11 (Red25519)</span>
</span></span><span style="display:flex;"><span>    blinded_type <span style="color:#f92672">=</span> <span style="color:#ae81ff">11</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Generate address</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> generate_encrypted_b32_address(pubkey, sigtype, blinded_type)
</span></span></code></pre></div><h3 id="보안-고려사항-1">보안 고려사항</h3>
<p><strong>프라이버시:</strong> - Base32 주소는 공개키를 드러냅니다 - 이는 의도된 동작이며 프로토콜에서 요구됩니다 - 개인키를 드러내거나 보안을 훼손하지는 않습니다 - 공개키는 설계상 공개 정보입니다</p>
<p><strong>충돌 저항성:</strong> - CRC-32의 충돌 저항성은 32비트에 불과함 - 암호학적으로 안전하지 않음(오류 검출에만 사용) - 인증을 위해 체크섬에 절대 의존하지 말 것 - 완전한 목적지 검증은 여전히 필요함</p>
<p><strong>주소 검증:</strong> - 사용 전에 항상 체크섬을 검증할 것 - 유효하지 않은 서명 유형의 주소는 거부할 것 - 공개 키가 타원 곡선 상에 있는지 확인할 것(구현별)</p>
<p><strong>참고 자료:</strong> - <a href="../../../../ko/proposals/149-b32-encrypted-ls2/">제안 149: 암호화된 LS2(leaseSet 2)용 B32</a>
 - <a href="../../../../ko/docs/specs/b32-for-encrypted-leasesets/">B32 주소 지정 사양</a>
 - <a href="../../../../ko/docs/overview/naming/">I2P 이름 지정 사양</a>
</p>
<hr>
<h2 id="오프라인-키-지원">오프라인 키 지원</h2>
<h3 id="개요-4">개요</h3>
<p>오프라인 키를 사용하면 주 서명 키를 오프라인 상태(cold storage; 오프라인 보관)로 유지하면서, 일상적인 운영에는 임시 서명 키를 사용할 수 있습니다. 이는 보안 수준이 높은 서비스에 매우 중요합니다.</p>
<p><strong>암호화된 LS2(LeaseSet2, I2P의 새로운 leaseSet 형식) 특정 요구 사항:</strong> - 임시 키는 오프라인에서 생성되어야 함 - 블라인딩된 개인 키는 사전 생성되어야 함(하루에 하나) - 임시 키와 블라인딩된 키 모두 일괄 전달 - 표준화된 파일 형식은 아직 정의되지 않음(명세에서 TODO)</p>
<h3 id="오프라인-키-구조">오프라인 키 구조</h3>
<p><strong>레이어 0 임시 키 데이터 (플래그 비트 0 = 1인 경우):</strong></p>
<pre tabindex="0"><code>┌───────────────────────────────────────────────────┐
│ Expires Timestamp       │ 4 bytes (seconds)       │
│ Transient Sig Type      │ 2 bytes (big endian)    │
│ Transient Signing Pubkey│ Variable (sigtype len)  │
│ Signature (by blinded)  │ 64 bytes (Red25519)     │
└───────────────────────────────────────────────────┘
</code></pre><p><strong>서명 적용 범위:</strong> 오프라인 키 블록의 서명은 다음을 포함합니다: - 만료 타임스탬프 (4바이트) - 일시적 서명 유형 (2바이트)   - 일시적 서명용 공개 키 (가변)</p>
<p>이 서명은 <strong>블라인딩된 공개키</strong>를 사용해 검증되며, 블라인딩된 개인키를 보유한 엔티티가 이 임시 키를 승인했음을 증명합니다.</p>
<h3 id="키-생성-과정">키 생성 과정</h3>
<p><strong>오프라인 키를 사용하는 암호화된 LeaseSet의 경우:</strong></p>
<ol>
<li>
<p><strong>임시 키 쌍 생성</strong> (오프라인, 콜드 스토리지에서):</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># For each day in future</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> date <span style="color:#f92672">in</span> future_dates:
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Generate daily transient keypair</span>
</span></span><span style="display:flex;"><span>    transient_privkey <span style="color:#f92672">=</span> generate_red25519_privkey()  <span style="color:#75715e"># Type 11</span>
</span></span><span style="display:flex;"><span>    transient_pubkey <span style="color:#f92672">=</span> derive_public(transient_privkey)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Store for later delivery</span>
</span></span><span style="display:flex;"><span>    keys[date] <span style="color:#f92672">=</span> (transient_privkey, transient_pubkey)
</span></span></code></pre></div></li>
<li>
<p><strong>Generate daily blinded keypairs</strong> (offline, in cold storage):</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"></code></pre></div></li>
</ol>
<h1 id="각-날짜에-대해----for-date-in-future_dates">각 날짜에 대해    for date in future_dates:</h1>
<pre><code>   # Derive alpha for this date
   datestring = date.strftime(&quot;%Y%m%d&quot;)  # &quot;YYYYMMDD&quot;
   alpha = GENERATE_ALPHA(destination, datestring, secret)
   
   # Blind the signing private key
   a = destination_signing_privkey  # Type 7 or 11
   blinded_privkey = BLIND_PRIVKEY(a, alpha)  # Result is type 11
   blinded_pubkey = DERIVE_PUBLIC(blinded_privkey)
   
   # Store for later delivery
   blinded_keys[date] = (blinded_privkey, blinded_pubkey)
</code></pre>
<pre tabindex="0"><code>
3. **Sign transient keys with blinded keys** (offline):
```python
for date in future_dates:

    transient_pubkey = keys[date][1]
    blinded_privkey = blinded_keys[date][0]
    
    # Create signature data
    expires = int((date + timedelta(days=1)).timestamp())
    sig_data = struct.pack(&#39;&gt;I&#39;, expires)  # 4 bytes
    sig_data += struct.pack(&#39;&gt;H&#39;, 11)     # Transient type (Red25519)
    sig_data += transient_pubkey          # 32 bytes
    
    # Sign with blinded private key
    signature = RED25519_SIGN(blinded_privkey, sig_data)
    
    # Package for delivery
    offline_sig_blocks[date] = {
        &#39;expires&#39;: expires,
        &#39;transient_type&#39;: 11,
        &#39;transient_pubkey&#39;: transient_pubkey,
        &#39;signature&#39;: signature
    }
</code></pre><ol start="4">
<li><strong>Package for delivery to router:</strong>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"></code></pre></div></li>
</ol>
<h1 id="각-날짜에-대해----delivery_packagedate--">각 날짜에 대해    delivery_package[date] = {</h1>
<pre><code>   'transient_privkey': keys[date][0],
   'transient_pubkey': keys[date][1],
   'blinded_privkey': blinded_keys[date][0],
   'blinded_pubkey': blinded_keys[date][1],
   'offline_sig_block': offline_sig_blocks[date]
</code></pre>
<p>}</p>
<pre tabindex="0"><code>
### Router Usage

**Daily Key Loading:**

```python
# UTC 자정(또는 게시 전에)

date = datetime.utcnow().date()

# 오늘의 키 불러오기

today_keys = load_delivery_package(date)

transient_privkey = today_keys[&#39;transient_privkey&#39;] transient_pubkey = today_keys[&#39;transient_pubkey&#39;] blinded_privkey = today_keys[&#39;blinded_privkey&#39;] blinded_pubkey = today_keys[&#39;blinded_pubkey&#39;] offline_sig_block = today_keys[&#39;offline_sig_block&#39;]

# 오늘의 암호화된 LeaseSet에는 이 키들을 사용하세요.
</code></pre><p><strong>Publishing Process:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># 1. 내부 LeaseSet2 생성</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>inner_ls2 <span style="color:#f92672">=</span> create_leaseset2(
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    destinations, leases, expires, 
</span></span><span style="display:flex;"><span>    signing_key<span style="color:#f92672">=</span>transient_privkey  <span style="color:#75715e"># Use transient key</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 2. 2계층 암호화</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>layer2_ciphertext <span style="color:#f92672">=</span> encrypt_layer2(inner_ls2, authCookie, subcredential, timestamp)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 3. 인가 데이터와 함께 레이어 1 생성</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>layer1_plaintext <span style="color:#f92672">=</span> create_layer1(authorization_data, layer2_ciphertext)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 4. 레이어 1 암호화</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>layer1_ciphertext <span style="color:#f92672">=</span> encrypt_layer1(layer1_plaintext, subcredential, timestamp)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 5. 오프라인 서명 블록을 포함한 레이어 0 생성</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>layer0 <span style="color:#f92672">=</span> create_layer0(
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    blinded_pubkey,
</span></span><span style="display:flex;"><span>    timestamp,
</span></span><span style="display:flex;"><span>    expires,
</span></span><span style="display:flex;"><span>    flags<span style="color:#f92672">=</span><span style="color:#ae81ff">0x0001</span>,  <span style="color:#75715e"># Bit 0 set (offline keys present)</span>
</span></span><span style="display:flex;"><span>    offline_sig_block<span style="color:#f92672">=</span>offline_sig_block,
</span></span><span style="display:flex;"><span>    layer1_ciphertext<span style="color:#f92672">=</span>layer1_ciphertext
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 6. 임시 개인 키로 레이어 0에 서명</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>signature <span style="color:#f92672">=</span> RED25519_SIGN(transient_privkey, layer0)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 7. 서명을 추가하고 게시</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>encrypted_leaseset <span style="color:#f92672">=</span> layer0 <span style="color:#f92672">+</span> signature publish_to_netdb(encrypted_leaseset)
</span></span></code></pre></div><h3 id="security-considerations">Security Considerations</h3>
<p><strong>Tracking via Offline Signature Block:</strong></p>
<p>The offline signature block is in plaintext (Layer 0). An adversary scraping floodfills could:</p>
<ul>
<li>Track the same encrypted LeaseSet across multiple days</li>
<li>Correlate encrypted LeaseSets even though blinded keys change daily</li>
</ul>
<p><strong>Mitigation:</strong> Generate new transient keys daily (in addition to blinded keys):</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># 매일 새로운 임시 키와 새로운 블라인딩된 키를 모두 생성하십시오</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> date <span style="color:#f92672">in</span> future_dates:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># New transient keypair for this day</span>
</span></span><span style="display:flex;"><span>    transient_privkey <span style="color:#f92672">=</span> generate_red25519_privkey()
</span></span><span style="display:flex;"><span>    transient_pubkey <span style="color:#f92672">=</span> derive_public(transient_privkey)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># New blinded keypair for this day</span>
</span></span><span style="display:flex;"><span>    alpha <span style="color:#f92672">=</span> GENERATE_ALPHA(destination, datestring, secret)
</span></span><span style="display:flex;"><span>    blinded_privkey <span style="color:#f92672">=</span> BLIND_PRIVKEY(signing_privkey, alpha)
</span></span><span style="display:flex;"><span>    blinded_pubkey <span style="color:#f92672">=</span> DERIVE_PUBLIC(blinded_privkey)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Sign new transient key with new blinded key</span>
</span></span><span style="display:flex;"><span>    sig <span style="color:#f92672">=</span> RED25519_SIGN(blinded_privkey, transient_pubkey <span style="color:#f92672">||</span> metadata)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Now offline sig block changes daily</span>
</span></span></code></pre></div><p><strong>Benefits:</strong></p>
<ul>
<li>Prevents tracking across days via offline signature block</li>
<li>Provides same security as encrypted LS2 without offline keys</li>
<li>Each day appears completely independent</li>
</ul>
<p><strong>Cost:</strong></p>
<ul>
<li>More keys to generate and store</li>
<li>More complex key management</li>
</ul>
<h3 id="file-format-todo">File Format (TODO)</h3>
<p><strong>Current Status:</strong> No standardized file format defined for batch key delivery.</p>
<p><strong>Requirements for Future Format:</strong></p>
<ol>
<li>
<p><strong>Must support multiple dates:</strong></p>
<ul>
<li>Batch delivery of 30+ days worth of keys</li>
<li>Clear date association for each key set</li>
</ul>
</li>
<li>
<p><strong>Must include all necessary data:</strong></p>
<ul>
<li>Transient private key</li>
<li>Transient public key</li>
<li>Blinded private key</li>
<li>Blinded public key</li>
<li>Pre-computed offline signature block</li>
<li>Expiration timestamps</li>
</ul>
</li>
<li>
<p><strong>Should be tamper-evident:</strong></p>
<ul>
<li>Checksums or signatures over entire file</li>
<li>Integrity verification before loading</li>
</ul>
</li>
<li>
<p><strong>Should be encrypted:</strong></p>
<ul>
<li>Keys are sensitive material</li>
<li>Encrypt file with router&rsquo;s key or passphrase</li>
</ul>
</li>
</ol>
<p><strong>Proposed Format Example (JSON, encrypted):</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{   <span style="color:#f92672">&#34;version&#34;</span>: <span style="color:#ae81ff">1</span>,   <span style="color:#f92672">&#34;destination_hash&#34;</span>: <span style="color:#e6db74">&#34;base64...&#34;</span>,   <span style="color:#f92672">&#34;keys&#34;</span>: [
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;date&#34;</span>: <span style="color:#e6db74">&#34;2025-10-15&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;transient&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;type&#34;</span>: <span style="color:#ae81ff">11</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;privkey&#34;</span>: <span style="color:#e6db74">&#34;base64...&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;pubkey&#34;</span>: <span style="color:#e6db74">&#34;base64...&#34;</span>
</span></span><span style="display:flex;"><span>      },
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;blinded&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;privkey&#34;</span>: <span style="color:#e6db74">&#34;base64...&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;pubkey&#34;</span>: <span style="color:#e6db74">&#34;base64...&#34;</span>
</span></span><span style="display:flex;"><span>      },
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;offline_sig_block&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;expires&#34;</span>: <span style="color:#ae81ff">1729123200</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;signature&#34;</span>: <span style="color:#e6db74">&#34;base64...&#34;</span>
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>],   <span style="color:#f92672">&#34;signature&#34;</span>: <span style="color:#e6db74">&#34;base64...&#34;</span>  <span style="color:#75715e">// Signature over entire structure }
</span></span></span></code></pre></div><h3 id="i2cp-protocol-enhancement-todo">I2CP Protocol Enhancement (TODO)</h3>
<p><strong>Current Status:</strong> No I2CP protocol enhancement defined for offline keys with encrypted LeaseSet.</p>
<p><strong>Requirements:</strong></p>
<ol>
<li>
<p><strong>Key delivery mechanism:</strong></p>
<ul>
<li>Upload batch of keys from client to router</li>
<li>Acknowledgment of successful key loading</li>
</ul>
</li>
<li>
<p><strong>Key expiration notification:</strong></p>
<ul>
<li>Router notifies client when keys running low</li>
<li>Client can generate and upload new batch</li>
</ul>
</li>
<li>
<p><strong>Key revocation:</strong></p>
<ul>
<li>Emergency revocation of future keys if compromise suspected</li>
</ul>
</li>
</ol>
<p><strong>Proposed I2CP Messages:</strong></p>
<pre tabindex="0"><code>UPLOAD_OFFLINE_KEYS   - 암호화된 키 자료 묶음   - 포함되는 날짜 범위

OFFLINE_KEY_STATUS   - 남은 일수   - 다음 키 만료일

REVOKE_OFFLINE_KEYS     - 폐기할 날짜 범위   - 대체할 새 키(선택 사항)
</code></pre><h3 id="implementation-status">Implementation Status</h3>
<p><strong>Java I2P:</strong></p>
<ul>
<li>✅ Offline keys for standard LS2: Fully supported (since 0.9.38)</li>
<li>⚠️ Offline keys for encrypted LS2: Implemented (since 0.9.40)</li>
<li>❌ File format: Not standardized</li>
<li>❌ I2CP protocol: Not enhanced</li>
</ul>
<p><strong>i2pd (C++):</strong></p>
<ul>
<li>✅ Offline keys for standard LS2: Fully supported</li>
<li>✅ Offline keys for encrypted LS2: Fully supported (since 2.58.0)</li>
<li>❌ File format: Not standardized</li>
<li>❌ I2CP protocol: Not enhanced</li>
</ul>
<p><strong>References:</strong></p>
<ul>
<li><a href="../../../../ko/proposals/123-new-netdb-entries/">Offline Signatures Proposal</a>
</li>
<li><a href="../../../../ko/docs/specs/i2cp/">I2CP Specification</a>
</li>
</ul>
<hr>
<h2 id="security-considerations-1">Security Considerations</h2>
<h3 id="cryptographic-security">Cryptographic Security</h3>
<p><strong>Algorithm Selection:</strong></p>
<p>All cryptographic primitives are based on well-studied algorithms:</p>
<ul>
<li><strong>ChaCha20:</strong> Modern stream cipher, constant-time, no timing attacks</li>
<li><strong>SHA-256:</strong> NIST-approved hash, 128-bit security level</li>
<li><strong>HKDF:</strong> RFC 5869 standard, proven security bounds</li>
<li><strong>Ed25519/Red25519:</strong> Curve25519-based, ~128-bit security level</li>
<li><strong>X25519:</strong> Diffie-Hellman over Curve25519, ~128-bit security level</li>
</ul>
<p><strong>Key Sizes:</strong></p>
<ul>
<li>All symmetric keys: 256 bits (32 bytes)</li>
<li>All public/private keys: 256 bits (32 bytes)</li>
<li>All nonces/IVs: 96 bits (12 bytes)</li>
<li>All signatures: 512 bits (64 bytes)</li>
</ul>
<p>These sizes provide adequate security margins against current and near-future attacks.</p>
<h3 id="forward-secrecy">Forward Secrecy</h3>
<p><strong>Daily Key Rotation:</strong></p>
<p>Encrypted LeaseSets rotate keys daily (UTC midnight):</p>
<ul>
<li>New blinded public/private key pair</li>
<li>New storage location in DHT</li>
<li>New encryption keys for both layers</li>
</ul>
<p><strong>Benefits:</strong></p>
<ul>
<li>Compromising today&rsquo;s blinded key doesn&rsquo;t reveal yesterday&rsquo;s</li>
<li>Limits exposure window to 24 hours</li>
<li>Prevents long-term tracking via DHT</li>
</ul>
<p><strong>Enhanced with Ephemeral Keys:</strong></p>
<p>DH client authorization uses ephemeral keys:</p>
<ul>
<li>Server generates new ephemeral DH keypair for each publication</li>
<li>Compromising ephemeral key only affects that publication</li>
<li>True forward secrecy even if long-term keys compromised</li>
</ul>
<h3 id="privacy-properties">Privacy Properties</h3>
<p><strong>Destination Blinding:</strong></p>
<p>The blinded public key:</p>
<ul>
<li>Is unlinkable to the original destination (without knowing the secret)</li>
<li>Changes daily, preventing long-term correlation</li>
<li>Cannot be reversed to find the original public key</li>
</ul>
<p><strong>Client Membership Privacy:</strong></p>
<p>Per-client authorization provides:</p>
<ul>
<li><strong>Anonymity:</strong> No way to identify which clients are authorized</li>
<li><strong>Untraceability:</strong> Cannot track when specific clients added/revoked</li>
<li><strong>Size obfuscation:</strong> Can add dummy entries to hide true count</li>
</ul>
<p><strong>DHT Privacy:</strong></p>
<p>Storage location rotates daily:</p>
<pre tabindex="0"><code>location = SHA-256(sig_type || blinded_public_key)
</code></pre><p>This prevents:</p>
<ul>
<li>Correlation across days via DHT lookups</li>
<li>Long-term monitoring of service availability</li>
<li>Traffic analysis of DHT queries</li>
</ul>
<h3 id="threat-model">Threat Model</h3>
<p><strong>Adversary Capabilities:</strong></p>
<ol>
<li>
<p><strong>Network Adversary:</strong></p>
<ul>
<li>Can monitor all DHT traffic</li>
<li>Can observe encrypted LeaseSet publications</li>
<li>Cannot decrypt without proper keys</li>
</ul>
</li>
<li>
<p><strong>Floodfill Adversary:</strong></p>
<ul>
<li>Can store and analyze all encrypted LeaseSets</li>
<li>Can track publication patterns over time</li>
<li>Cannot decrypt Layer 1 or Layer 2</li>
<li>Can see client count (but not identities)</li>
</ul>
</li>
<li>
<p><strong>Authorized Client Adversary:</strong></p>
<ul>
<li>Can decrypt specific encrypted LeaseSets</li>
<li>Can access inner LeaseSet2 data</li>
<li>Cannot determine other clients&rsquo; identities</li>
<li>Cannot decrypt past LeaseSets (with ephemeral keys)</li>
</ul>
</li>
</ol>
<p><strong>Out of Scope:</strong></p>
<ul>
<li>Malicious router implementations</li>
<li>Compromised router host systems</li>
<li>Side-channel attacks (timing, power analysis)</li>
<li>Physical access to keys</li>
<li>Social engineering attacks</li>
</ul>
<h3 id="attack-scenarios">Attack Scenarios</h3>
<p><strong>1. Offline Keys Tracking Attack:</strong></p>
<p><strong>Attack:</strong> Adversary tracks encrypted LeaseSets via unchanging offline signature block.</p>
<p><strong>Mitigation:</strong> Generate new transient keys daily (in addition to blinded keys).</p>
<p><strong>Status:</strong> Documented recommendation, implementation-specific.</p>
<p><strong>2. Client Position Inference Attack:</strong></p>
<p><strong>Attack:</strong> If client order is static, clients can infer their position and detect when other clients added/removed.</p>
<p><strong>Mitigation:</strong> Randomize client order in authorization list for each publication.</p>
<p><strong>Status:</strong> Documented recommendation in specification.</p>
<p><strong>3. Client Count Analysis Attack:</strong></p>
<p><strong>Attack:</strong> Adversary monitors client count changes over time to infer service popularity or client churn.</p>
<p><strong>Mitigation:</strong> Add random dummy entries to authorization list.</p>
<p><strong>Status:</strong> Optional feature, deployment-specific trade-off (size vs. privacy).</p>
<p><strong>4. PSK Interception Attack:</strong></p>
<p><strong>Attack:</strong> Adversary intercepts PSK during out-of-band exchange and can decrypt all future encrypted LeaseSets.</p>
<p><strong>Mitigation:</strong> Use DH client authorization instead, or ensure secure key exchange (Signal, OTR, PGP).</p>
<p><strong>Status:</strong> Known limitation of PSK approach, documented in specification.</p>
<p><strong>5. Timing Correlation Attack:</strong></p>
<p><strong>Attack:</strong> Adversary correlates publication times across days to link encrypted LeaseSets.</p>
<p><strong>Mitigation:</strong> Randomize publication times, use delayed publishing.</p>
<p><strong>Status:</strong> Implementation-specific, not addressed in core specification.</p>
<p><strong>6. Long-term Secret Compromise:</strong></p>
<p><strong>Attack:</strong> Adversary compromises the blinding secret and can compute all past and future blinded keys.</p>
<p><strong>Mitigation:</strong></p>
<ul>
<li>Use optional secret parameter (not empty)</li>
<li>Rotate secret periodically</li>
<li>Use different secrets for different services</li>
</ul>
<p><strong>Status:</strong> Secret parameter is optional; using it is highly recommended.</p>
<h3 id="operational-security">Operational Security</h3>
<p><strong>Key Management:</strong></p>
<ol>
<li>
<p><strong>Signing Private Key:</strong></p>
<ul>
<li>Store offline in cold storage</li>
<li>Use only for generating blinded keys (batch process)</li>
<li>Never expose to online router</li>
</ul>
</li>
<li>
<p><strong>Blinded Private Keys:</strong></p>
<ul>
<li>Generate offline, deliver in batches</li>
<li>Rotate daily automatically</li>
<li>Delete after use (forward secrecy)</li>
</ul>
</li>
<li>
<p><strong>Transient Private Keys (with offline keys):</strong></p>
<ul>
<li>Generate offline, deliver in batches</li>
<li>Can be longer-lived (days/weeks)</li>
<li>Rotate regularly for enhanced privacy</li>
</ul>
</li>
<li>
<p><strong>Client Authorization Keys:</strong></p>
<ul>
<li>DH: Client private keys never leave client device</li>
<li>PSK: Use unique keys per client, secure exchange</li>
<li>Revoke immediately upon client removal</li>
</ul>
</li>
</ol>
<p><strong>Secret Management:</strong></p>
<p>The optional secret parameter in <code>GENERATE_ALPHA</code>:</p>
<ul>
<li>SHOULD be used for high-security services</li>
<li>MUST be transmitted securely to authorized clients</li>
<li>SHOULD be rotated periodically (e.g., monthly)</li>
<li>CAN be different for different client groups</li>
</ul>
<p><strong>Monitoring and Auditing:</strong></p>
<ol>
<li>
<p><strong>Publication Monitoring:</strong></p>
<ul>
<li>Verify encrypted LeaseSets published successfully</li>
<li>Monitor floodfill acceptance rates</li>
<li>Alert on publication failures</li>
</ul>
</li>
<li>
<p><strong>Client Access Monitoring:</strong></p>
<ul>
<li>Log client authorization attempts (without identifying clients)</li>
<li>Monitor for unusual patterns</li>
<li>Detect potential attacks early</li>
</ul>
</li>
<li>
<p><strong>Key Rotation Auditing:</strong></p>
<ul>
<li>Verify daily key rotation occurs</li>
<li>Check blinded key changes daily</li>
<li>Ensure old keys are deleted</li>
</ul>
</li>
</ol>
<h3 id="implementation-security">Implementation Security</h3>
<p><strong>Constant-Time Operations:</strong></p>
<p>Implementations MUST use constant-time operations for:</p>
<ul>
<li>All scalar arithmetic (mod L operations)</li>
<li>Private key comparisons</li>
<li>Signature verification</li>
<li>DH key agreement</li>
</ul>
<p><strong>Memory Security:</strong></p>
<ul>
<li>Zero sensitive key material after use</li>
<li>Use secure memory allocation for keys</li>
<li>Prevent keys from being paged to disk</li>
<li>Clear stack variables containing key material</li>
</ul>
<p><strong>Random Number Generation:</strong></p>
<ul>
<li>Use cryptographically secure RNG (CSRNG)</li>
<li>Properly seed RNG from OS entropy source</li>
<li>Do not use predictable RNGs for key material</li>
<li>Verify RNG output quality periodically</li>
</ul>
<p><strong>Input Validation:</strong></p>
<ul>
<li>Validate all public keys are on the curve</li>
<li>Check all signature types are supported</li>
<li>Verify all lengths before parsing</li>
<li>Reject malformed encrypted LeaseSets early</li>
</ul>
<p><strong>Error Handling:</strong></p>
<ul>
<li>Do not leak information via error messages</li>
<li>Use constant-time comparison for authentication</li>
<li>Do not expose timing differences in decryption</li>
<li>Log security-relevant events properly</li>
</ul>
<h3 id="recommendations">Recommendations</h3>
<p><strong>For Service Operators:</strong></p>
<ol>
<li>✅ <strong>Use Red25519 (type 11)</strong> for new destinations</li>
<li>✅ <strong>Use DH client authorization</strong> for high-security services</li>
<li>✅ <strong>Generate new transient keys daily</strong> when using offline keys</li>
<li>✅ <strong>Use the optional secret parameter</strong> in GENERATE_ALPHA</li>
<li>✅ <strong>Randomize client order</strong> in authorization lists</li>
<li>✅ <strong>Monitor publication success</strong> and investigate failures</li>
<li>⚠️ <strong>Consider dummy entries</strong> to hide client count (size trade-off)</li>
</ol>
<p><strong>For Client Implementers:</strong></p>
<ol>
<li>✅ <strong>Validate blinded public keys</strong> are on prime-order subgroup</li>
<li>✅ <strong>Verify all signatures</strong> before trusting data</li>
<li>✅ <strong>Use constant-time operations</strong> for cryptographic primitives</li>
<li>✅ <strong>Zero key material</strong> immediately after use</li>
<li>✅ <strong>Implement proper error handling</strong> without information leaks</li>
<li>✅ <strong>Support both Ed25519 and Red25519</strong> destination types</li>
</ol>
<p><strong>For Network Operators:</strong></p>
<ol>
<li>✅ <strong>Accept encrypted LeaseSets</strong> in floodfill routers</li>
<li>✅ <strong>Enforce reasonable size limits</strong> to prevent abuse</li>
<li>✅ <strong>Monitor for anomalous patterns</strong> (extremely large, frequent updates)</li>
<li>⚠️ <strong>Consider rate limiting</strong> encrypted LeaseSet publications</li>
</ol>
<hr>
<h2 id="implementation-notes">Implementation Notes</h2>
<h3 id="java-i2p-implementation">Java I2P Implementation</h3>
<p><strong>Repository:</strong> <a href="https://github.com/i2p/i2p.i2p">https://github.com/i2p/i2p.i2p</a>
</p>
<p><strong>Key Classes:</strong></p>
<ul>
<li><code>net.i2p.data.LeaseSet2</code> - LeaseSet2 structure</li>
<li><code>net.i2p.data.EncryptedLeaseSet</code> - Encrypted LS2 implementation</li>
<li><code>net.i2p.crypto.eddsa.EdDSAEngine</code> - Ed25519/Red25519 signatures</li>
<li><code>net.i2p.crypto.HKDF</code> - HKDF implementation</li>
<li><code>net.i2p.crypto.ChaCha20</code> - ChaCha20 cipher</li>
</ul>
<p><strong>Configuration:</strong></p>
<p>Enable encrypted LeaseSet in <code>clients.config</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-properties" data-lang="properties"><span style="display:flex;"><span><span style="color:#75715e"># 암호화된 LeaseSet 활성화</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">i2cp.encryptLeaseSet</span><span style="color:#f92672">=</span><span style="color:#e6db74">true</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 선택 사항: 클라이언트 인가 활성화</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">i2cp.enableAccessList</span><span style="color:#f92672">=</span><span style="color:#e6db74">true</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 선택 사항: DH(디피-헬먼) 인증 사용(기본값은 PSK(사전 공유 키))</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">i2cp.accessListType</span><span style="color:#f92672">=</span><span style="color:#e6db74">0</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 선택 사항: Blinding secret(주소 블라인딩에 사용하는 비밀값) (강력 권장)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">i2cp.blindingSecret</span><span style="color:#f92672">=</span><span style="color:#e6db74">your-secret-here</span>
</span></span></code></pre></div><p><strong>API Usage Example:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#75715e">// 암호화된 LeaseSet 생성 EncryptedLeaseSet els = new EncryptedLeaseSet();</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// 목적지 설정 els.setDestination(destination);</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// 클라이언트별 인가를 활성화 els.setAuthorizationEnabled(true); els.setAuthType(EncryptedLeaseSet.AUTH_DH);</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// 허가된 클라이언트(DH 공개 키) 추가: for (byte[] clientPubKey : authorizedClients) {</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    els.<span style="color:#a6e22e">addClient</span>(clientPubKey);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// blinding(블라인딩: I2P 목적지 공개키를 숨기는 기법) 매개변수를 설정 els.setBlindingSecret(&#34;your-secret&#34;);</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// 서명하고 게시 els.sign(signingPrivateKey); netDb.publish(els);</span>
</span></span></code></pre></div><h3 id="i2pd-c-implementation">i2pd (C++) Implementation</h3>
<p><strong>Repository:</strong> <a href="https://github.com/PurpleI2P/i2pd">https://github.com/PurpleI2P/i2pd</a>
</p>
<p><strong>Key Files:</strong></p>
<ul>
<li><code>libi2pd/LeaseSet.h/cpp</code> - LeaseSet implementations</li>
<li><code>libi2pd/Crypto.h/cpp</code> - Cryptographic primitives</li>
<li><code>libi2pd/Ed25519.h/cpp</code> - Ed25519/Red25519 signatures</li>
<li><code>libi2pd/ChaCha20.h/cpp</code> - ChaCha20 cipher</li>
</ul>
<p><strong>Configuration:</strong></p>
<p>Enable in tunnel configuration (<code>tunnels.conf</code>):</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ini" data-lang="ini"><span style="display:flex;"><span><span style="color:#a6e22e">[my-hidden-service] type</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">http host = 127.0.0.1 port = 8080 keys = my-service-keys.dat</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 암호화된 LeaseSet(목적지 접근 정보를 담는 I2P 데이터 구조) 활성화</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">encryptleaseset</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">true</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 선택 사항: 클라이언트 인증 유형(0=DH(디피-헬만), 1=PSK(사전 공유 키))</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">authtype</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">0</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 선택 사항: Blinding secret(블라인딩용 비밀값)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">secret</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">your-secret-here</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 선택 사항: 허용된 클라이언트(한 줄에 하나씩, base64로 인코딩된 공개 키)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">client.1</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">base64-인코딩된-클라이언트-공개키-1 client.2 = base64-인코딩된-클라이언트-공개키-2</span>
</span></span></code></pre></div><p><strong>API Usage Example:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#75715e">// 암호화된 LeaseSet 생성 auto encryptedLS = std::make_shared&lt;i2p::data::EncryptedLeaseSet&gt;(
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>    destination,
</span></span><span style="display:flex;"><span>    blindingSecret
</span></span><span style="display:flex;"><span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// 클라이언트별 인가 활성화 encryptedLS-&gt;SetAuthType(i2p::data::AUTH_TYPE_DH);
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// 허가된 클라이언트를 추가 for (const auto&amp; clientPubKey : authorizedClients) {
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>    encryptedLS<span style="color:#f92672">-&gt;</span>AddClient(clientPubKey);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// 서명하고 게시 encryptedLS-&gt;Sign(signingPrivKey); netdb.Publish(encryptedLS);
</span></span></span></code></pre></div><h3 id="testing-and-debugging">Testing and Debugging</h3>
<p><strong>Test Vectors:</strong></p>
<p>Generate test vectors for implementation verification:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># 테스트 벡터 1: 키 블라인딩</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>destination_pubkey <span style="color:#f92672">=</span> bytes<span style="color:#f92672">.</span>fromhex(<span style="color:#e6db74">&#39;a&#39;</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">64</span>) sigtype <span style="color:#f92672">=</span> <span style="color:#ae81ff">7</span> blinded_sigtype <span style="color:#f92672">=</span> <span style="color:#ae81ff">11</span> date <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;20251015&#34;</span> secret <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>alpha <span style="color:#f92672">=</span> generate_alpha(destination_pubkey, sigtype, blinded_sigtype, date, secret) print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Alpha: </span><span style="color:#e6db74">{</span>alpha<span style="color:#f92672">.</span>hex()<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 예상: (레퍼런스 구현과 대조하여 검증)</span>
</span></span></code></pre></div><p><strong>Unit Tests:</strong></p>
<p>Key areas to test:</p>
<ol>
<li>HKDF derivation with various inputs</li>
<li>ChaCha20 encryption/decryption</li>
<li>Red25519 signature generation and verification</li>
<li>Key blinding (private and public)</li>
<li>Layer 1/2 encryption/decryption</li>
<li>Client authorization (DH and PSK)</li>
<li>Base32 address generation and parsing</li>
</ol>
<p><strong>Integration Tests:</strong></p>
<ol>
<li>Publish encrypted LeaseSet to test network</li>
<li>Retrieve and decrypt from client</li>
<li>Verify daily key rotation</li>
<li>Test client authorization (add/remove clients)</li>
<li>Test offline keys (if supported)</li>
</ol>
<p><strong>Common Implementation Errors:</strong></p>
<ol>
<li><strong>Incorrect mod L reduction:</strong> Must use proper modular arithmetic</li>
<li><strong>Endianness errors:</strong> Most fields are big-endian, but some crypto uses little-endian</li>
<li><strong>Off-by-one in array slicing:</strong> Verify indices are inclusive/exclusive as needed</li>
<li><strong>Missing constant-time comparisons:</strong> Use constant-time for all sensitive comparisons</li>
<li><strong>Not zeroing key material:</strong> Always zero keys after use</li>
</ol>
<h3 id="performance-considerations">Performance Considerations</h3>
<p><strong>Computational Costs:</strong></p>
<table style="width:100%; border-collapse:collapse; margin-bottom:1.5rem;">
  <thead>
    <tr>
      <th style="border:1px solid var(--color-border); padding:0.5rem; background:var(--color-bg-secondary); text-align:left;">Operation</th>
      <th style="border:1px solid var(--color-border); padding:0.5rem; background:var(--color-bg-secondary); text-align:left;">Cost</th>
      <th style="border:1px solid var(--color-border); padding:0.5rem; background:var(--color-bg-secondary); text-align:left;">Notes</th>
    </tr>
  </thead>
  <tbody>
    <tr><td style="border:1px solid var(--color-border); padding:0.5rem;">Key blinding (server)</td><td style="border:1px solid var(--color-border); padding:0.5rem;">1 scalar mult</td><td style="border:1px solid var(--color-border); padding:0.5rem;">Per publication</td></tr>
    <tr><td style="border:1px solid var(--color-border); padding:0.5rem;">Key blinding (client)</td><td style="border:1px solid var(--color-border); padding:0.5rem;">1 point add + 1 scalar mult</td><td style="border:1px solid var(--color-border); padding:0.5rem;">Per retrieval</td></tr>
    <tr><td style="border:1px solid var(--color-border); padding:0.5rem;">Layer 1 encryption</td><td style="border:1px solid var(--color-border); padding:0.5rem;">1 HKDF + 1 ChaCha20</td><td style="border:1px solid var(--color-border); padding:0.5rem;">Fast</td></tr>
    <tr><td style="border:1px solid var(--color-border); padding:0.5rem;">Layer 2 encryption</td><td style="border:1px solid var(--color-border); padding:0.5rem;">1 HKDF + 1 ChaCha20</td><td style="border:1px solid var(--color-border); padding:0.5rem;">Fast</td></tr>
    <tr><td style="border:1px solid var(--color-border); padding:0.5rem;">DH client auth (server)</td><td style="border:1px solid var(--color-border); padding:0.5rem;">N+1 X25519 ops</td><td style="border:1px solid var(--color-border); padding:0.5rem;">N = number of clients</td></tr>
    <tr><td style="border:1px solid var(--color-border); padding:0.5rem;">DH client auth (client)</td><td style="border:1px solid var(--color-border); padding:0.5rem;">1 X25519 op</td><td style="border:1px solid var(--color-border); padding:0.5rem;">Per retrieval</td></tr>
    <tr><td style="border:1px solid var(--color-border); padding:0.5rem;">PSK client auth</td><td style="border:1px solid var(--color-border); padding:0.5rem;">0 DH ops</td><td style="border:1px solid var(--color-border); padding:0.5rem;">Only HKDF + ChaCha20</td></tr>
    <tr><td style="border:1px solid var(--color-border); padding:0.5rem;">Signature (Red25519)</td><td style="border:1px solid var(--color-border); padding:0.5rem;">1 signature op</td><td style="border:1px solid var(--color-border); padding:0.5rem;">Similar cost to Ed25519</td></tr>
  </tbody>
</table>
<p><strong>Size Overhead:</strong></p>
<table style="width:100%; border-collapse:collapse; margin-bottom:1.5rem;">
  <thead>
    <tr>
      <th style="border:1px solid var(--color-border); padding:0.5rem; background:var(--color-bg-secondary); text-align:left;">Component</th>
      <th style="border:1px solid var(--color-border); padding:0.5rem; background:var(--color-bg-secondary); text-align:left;">Size</th>
      <th style="border:1px solid var(--color-border); padding:0.5rem; background:var(--color-bg-secondary); text-align:left;">Frequency</th>
    </tr>
  </thead>
  <tbody>
    <tr><td style="border:1px solid var(--color-border); padding:0.5rem;">Blinded public key</td><td style="border:1px solid var(--color-border); padding:0.5rem;">32 bytes</td><td style="border:1px solid var(--color-border); padding:0.5rem;">Per LeaseSet</td></tr>
    <tr><td style="border:1px solid var(--color-border); padding:0.5rem;">Layer 1 encryption overhead</td><td style="border:1px solid var(--color-border); padding:0.5rem;">32 bytes (salt)</td><td style="border:1px solid var(--color-border); padding:0.5rem;">Per LeaseSet</td></tr>
    <tr><td style="border:1px solid var(--color-border); padding:0.5rem;">Layer 2 encryption overhead</td><td style="border:1px solid var(--color-border); padding:0.5rem;">32 bytes (salt)</td><td style="border:1px solid var(--color-border); padding:0.5rem;">Per LeaseSet</td></tr>
    <tr><td style="border:1px solid var(--color-border); padding:0.5rem;">DH auth per client</td><td style="border:1px solid var(--color-border); padding:0.5rem;">40 bytes</td><td style="border:1px solid var(--color-border); padding:0.5rem;">Per client per LeaseSet</td></tr>
    <tr><td style="border:1px solid var(--color-border); padding:0.5rem;">DH ephemeral pubkey</td><td style="border:1px solid var(--color-border); padding:0.5rem;">32 bytes</td><td style="border:1px solid var(--color-border); padding:0.5rem;">Per LeaseSet (if DH auth)</td></tr>
    <tr><td style="border:1px solid var(--color-border); padding:0.5rem;">PSK auth per client</td><td style="border:1px solid var(--color-border); padding:0.5rem;">40 bytes</td><td style="border:1px solid var(--color-border); padding:0.5rem;">Per client per LeaseSet</td></tr>
    <tr><td style="border:1px solid var(--color-border); padding:0.5rem;">PSK salt</td><td style="border:1px solid var(--color-border); padding:0.5rem;">32 bytes</td><td style="border:1px solid var(--color-border); padding:0.5rem;">Per LeaseSet (if PSK auth)</td></tr>
    <tr><td style="border:1px solid var(--color-border); padding:0.5rem;">Signature</td><td style="border:1px solid var(--color-border); padding:0.5rem;">64 bytes</td><td style="border:1px solid var(--color-border); padding:0.5rem;">Per LeaseSet</td></tr>
    <tr><td style="border:1px solid var(--color-border); padding:0.5rem;">Offline sig block</td><td style="border:1px solid var(--color-border); padding:0.5rem;">≈100 bytes</td><td style="border:1px solid var(--color-border); padding:0.5rem;">Per LeaseSet (if offline keys)</td></tr>
  </tbody>
</table>
<p><strong>Typical Sizes:</strong></p>
<ul>
<li><strong>No client auth:</strong> ~200 bytes overhead</li>
<li><strong>With 10 DH clients:</strong> ~600 bytes overhead</li>
<li><strong>With 100 DH clients:</strong> ~4200 bytes overhead</li>
</ul>
<p><strong>Optimization Tips:</strong></p>
<ol>
<li><strong>Batch key generation:</strong> Generate blinded keys for multiple days in advance</li>
<li><strong>Cache subcredentials:</strong> Compute once per day, reuse for all publications</li>
<li><strong>Reuse ephemeral keys:</strong> Can reuse ephemeral DH key for short period (minutes)</li>
<li><strong>Parallel client encryption:</strong> Encrypt client cookies in parallel</li>
<li><strong>Fast path for no auth:</strong> Skip authorization layer entirely when disabled</li>
</ol>
<h3 id="compatibility">Compatibility</h3>
<p><strong>Backward Compatibility:</strong></p>
<ul>
<li>Ed25519 (type 7) destinations supported for unblinded keys</li>
<li>Red25519 (type 11) required for blinded keys</li>
<li>Traditional LeaseSets still fully supported</li>
<li>Encrypted LeaseSets do not break existing network</li>
</ul>
<p><strong>Forward Compatibility:</strong></p>
<ul>
<li>Reserved flag bits for future features</li>
<li>Extensible authorization scheme (3 bits allow 8 types)</li>
<li>Version field in various structures</li>
</ul>
<p><strong>Interoperability:</strong></p>
<ul>
<li>Java I2P and i2pd fully interoperable since:
<ul>
<li>Java I2P 0.9.40 (May 2019)</li>
<li>i2pd 2.58.0 (September 2025)</li>
</ul>
</li>
<li>Encrypted LeaseSets work across implementations</li>
<li>Client authorization works across implementations</li>
</ul>
<hr>
<h2 id="references">References</h2>
<h3 id="ietf-rfcs">IETF RFCs</h3>
<ul>
<li><strong><a href="https://datatracker.ietf.org/doc/html/rfc2104">RFC 2104</a>
</strong> - HMAC: Keyed-Hashing for Message Authentication (February 1997)</li>
<li><strong><a href="https://datatracker.ietf.org/doc/html/rfc5869">RFC 5869</a>
</strong> - HMAC-based Extract-and-Expand Key Derivation Function (HKDF) (May 2010)</li>
<li><strong><a href="https://datatracker.ietf.org/doc/html/rfc7539">RFC 7539</a>
</strong> - ChaCha20 and Poly1305 for IETF Protocols (May 2015)</li>
<li><strong><a href="https://datatracker.ietf.org/doc/html/rfc7748">RFC 7748</a>
</strong> - Elliptic Curves for Security (January 2016)</li>
</ul>
<h3 id="i2p-specifications">I2P Specifications</h3>
<ul>
<li><strong><a href="../../../../ko/docs/specs/common-structures/">Common Structures Specification</a>
</strong> - LeaseSet2 and EncryptedLeaseSet structures</li>
<li><strong><a href="../../../../ko/proposals/123-new-netdb-entries/">Proposal 123: New netDB Entries</a>
</strong> - Background and design of LeaseSet2</li>
<li><strong><a href="../../../../ko/proposals/146-red25519/">Proposal 146: Red25519</a>
</strong> - Red25519 signature scheme specification</li>
<li><strong><a href="../../../../ko/proposals/149-b32-encrypted-ls2/">Proposal 149: B32 for Encrypted LS2</a>
</strong> - Base32 addressing for encrypted LeaseSets</li>
<li><strong><a href="../../../../ko/docs/specs/red25519-signature-scheme/">Red25519 Specification</a>
</strong> - Detailed Red25519 implementation</li>
<li><strong><a href="../../../../ko/docs/specs/b32-for-encrypted-leasesets/">B32 Addressing Specification</a>
</strong> - Base32 address format</li>
<li><strong><a href="../../../../ko/docs/specs/common-structures/">Network Database Documentation</a>
</strong> - NetDB usage and operations</li>
<li><strong><a href="../../../../ko/docs/specs/i2cp/">I2CP Specification</a>
</strong> - I2P Client Protocol</li>
</ul>
<h3 id="cryptographic-references">Cryptographic References</h3>
<ul>
<li><strong><a href="http://cr.yp.to/papers.html#ed25519">Ed25519 Paper</a>
</strong> - &ldquo;High-speed high-security signatures&rdquo; by Bernstein et al.</li>
<li><strong><a href="https://zips.z.cash/protocol/protocol.pdf">ZCash Protocol Specification</a>
</strong> - Section 5.4.6: RedDSA signature scheme</li>
<li><strong><a href="https://spec.torproject.org/rend-spec">Tor Rendezvous Specification v3</a>
</strong> - Tor&rsquo;s onion service specification (for comparison)</li>
</ul>
<h3 id="security-references">Security References</h3>
<ul>
<li><strong><a href="https://lists.torproject.org/pipermail/tor-dev/2013-December/005943.html">Key Blinding Security Discussion</a>
</strong> - Tor Project mailing list discussion</li>
<li><strong><a href="https://trac.torproject.org/projects/tor/ticket/8106">Tor Ticket #8106</a>
</strong> - Key blinding implementation discussion</li>
<li><strong><a href="http://projectbullrun.org/dual-ec/ext-rand.html">PRNG Security</a>
</strong> - Random number generator security considerations</li>
<li><strong><a href="https://lists.torproject.org/pipermail/tor-dev/2015-November/009954.html">Tor PRNG Discussion</a>
</strong> - Discussion of PRNG usage in Tor</li>
</ul>
<h3 id="implementation-references">Implementation References</h3>
<ul>
<li><strong><a href="https://github.com/i2p/i2p.i2p">Java I2P Repository</a>
</strong> - Official Java implementation</li>
<li><strong><a href="https://github.com/PurpleI2P/i2pd">i2pd Repository</a>
</strong> - C++ implementation</li>
<li><strong><a href="../../../../ko/">I2P Website</a>
</strong> - Official I2P project website</li>
<li><strong><a href="../../../../ko/docs/specs/">I2P Specifications</a>
</strong> - Complete specification index</li>
</ul>
<h3 id="version-history">Version History</h3>
<ul>
<li><strong><a href="../../../../en/blog">I2P Release Notes</a>
</strong> - Official release announcements</li>
<li><strong><a href="https://github.com/i2p/i2p.i2p/releases">Java I2P Releases</a>
</strong> - GitHub release history</li>
<li><strong><a href="https://github.com/PurpleI2P/i2pd/releases">i2pd Releases</a>
</strong> - GitHub release history</li>
</ul>
<hr>
<h2 id="appendix-a-cryptographic-constants">Appendix A: Cryptographic Constants</h2>
<h3 id="ed25519--red25519-constants">Ed25519 / Red25519 Constants</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># Ed25519 기저점(생성점)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>B <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span><span style="color:#f92672">**</span><span style="color:#ae81ff">255</span> <span style="color:#f92672">-</span> <span style="color:#ae81ff">19</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Ed25519의 차수(스칼라 필드 크기)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>L <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span><span style="color:#f92672">**</span><span style="color:#ae81ff">252</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">27742317777372353535851937790883648493</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 서명 유형 값</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>SIGTYPE_ED25519 <span style="color:#f92672">=</span> <span style="color:#ae81ff">7</span>    <span style="color:#75715e"># 0x0007 SIGTYPE_RED25519 = 11  # 0x000b</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 키 길이</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>PRIVKEY_SIZE <span style="color:#f92672">=</span> <span style="color:#ae81ff">32</span>  <span style="color:#75715e"># 바이트 PUBKEY_SIZE = 32   # 바이트 SIGNATURE_SIZE = 64  # 바이트</span>
</span></span></code></pre></div><h3 id="chacha20-constants">ChaCha20 Constants</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># ChaCha20 매개변수</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>CHACHA20_KEY_SIZE <span style="color:#f92672">=</span> <span style="color:#ae81ff">32</span>   <span style="color:#75715e"># 바이트 (256 비트) CHACHA20_NONCE_SIZE = 12  # 바이트 (96 비트) CHACHA20_INITIAL_COUNTER = 1  # RFC 7539에서는 0 또는 1을 허용함</span>
</span></span></code></pre></div><h3 id="hkdf-constants">HKDF Constants</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># HKDF(HMAC 기반 키 파생 함수) 매개변수</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>HKDF_HASH <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;SHA-256&#34;</span> HKDF_SALT_MAX <span style="color:#f92672">=</span> <span style="color:#ae81ff">32</span>  <span style="color:#75715e"># bytes (HashLen)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># HKDF(해시 기반 키 유도 함수) info 문자열(도메인 분리)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>HKDF_INFO_ALPHA <span style="color:#f92672">=</span> <span style="color:#e6db74">b</span><span style="color:#e6db74">&#34;i2pblinding1&#34;</span> HKDF_INFO_LAYER1 <span style="color:#f92672">=</span> <span style="color:#e6db74">b</span><span style="color:#e6db74">&#34;ELS2_L1K&#34;</span> HKDF_INFO_LAYER2 <span style="color:#f92672">=</span> <span style="color:#e6db74">b</span><span style="color:#e6db74">&#34;ELS2_L2K&#34;</span> HKDF_INFO_DH_AUTH <span style="color:#f92672">=</span> <span style="color:#e6db74">b</span><span style="color:#e6db74">&#34;ELS2_XCA&#34;</span> HKDF_INFO_PSK_AUTH <span style="color:#f92672">=</span> <span style="color:#e6db74">b</span><span style="color:#e6db74">&#34;ELS2PSKA&#34;</span>
</span></span></code></pre></div><h3 id="hash-personalization-strings">Hash Personalization Strings</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># SHA-256 개인화 문자열</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>HASH_PERS_ALPHA <span style="color:#f92672">=</span> <span style="color:#e6db74">b</span><span style="color:#e6db74">&#34;I2PGenerateAlpha&#34;</span> HASH_PERS_RED25519 <span style="color:#f92672">=</span> <span style="color:#e6db74">b</span><span style="color:#e6db74">&#34;I2P_Red25519H(x)&#34;</span> HASH_PERS_CREDENTIAL <span style="color:#f92672">=</span> <span style="color:#e6db74">b</span><span style="color:#e6db74">&#34;credential&#34;</span> HASH_PERS_SUBCREDENTIAL <span style="color:#f92672">=</span> <span style="color:#e6db74">b</span><span style="color:#e6db74">&#34;subcredential&#34;</span>
</span></span></code></pre></div><h3 id="structure-sizes">Structure Sizes</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># 레이어 0(외부) 크기</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>BLINDED_SIGTYPE_SIZE <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>   <span style="color:#75715e"># 바이트 BLINDED_PUBKEY_SIZE = 32   # 바이트 (Red25519용) PUBLISHED_TS_SIZE = 4      # 바이트 EXPIRES_SIZE = 2           # 바이트 FLAGS_SIZE = 2             # 바이트 LEN_OUTER_CIPHER_SIZE = 2  # 바이트 SIGNATURE_SIZE = 64        # 바이트 (Red25519)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 오프라인 키 블록 크기</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>OFFLINE_EXPIRES_SIZE <span style="color:#f92672">=</span> <span style="color:#ae81ff">4</span>   <span style="color:#75715e"># 바이트 OFFLINE_SIGTYPE_SIZE = 2   # 바이트 OFFLINE_SIGNATURE_SIZE = 64  # 바이트</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 레이어 1(중간)의 크기</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>AUTH_FLAGS_SIZE <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>        <span style="color:#75715e"># 바이트 EPHEMERAL_PUBKEY_SIZE = 32  # 바이트 (DH 인증) AUTH_SALT_SIZE = 32        # 바이트 (PSK 인증) NUM_CLIENTS_SIZE = 2       # 바이트 CLIENT_ID_SIZE = 8         # 바이트 CLIENT_COOKIE_SIZE = 32    # 바이트 AUTH_CLIENT_ENTRY_SIZE = 40  # 바이트 (CLIENT_ID + CLIENT_COOKIE)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 암호화 오버헤드</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>SALT_SIZE <span style="color:#f92672">=</span> <span style="color:#ae81ff">32</span>  <span style="color:#75715e"># 바이트 (각 암호화된 레이어 앞에 추가됨)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Base32 주소</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>B32_ENCRYPTED_DECODED_SIZE <span style="color:#f92672">=</span> <span style="color:#ae81ff">35</span>  <span style="color:#75715e"># 바이트 B32_ENCRYPTED_ENCODED_LEN = 56   # 문자 B32_SUFFIX = &#34;.b32.i2p&#34;</span>
</span></span></code></pre></div><hr>
<h2 id="appendix-b-test-vectors">Appendix B: Test Vectors</h2>
<h3 id="test-vector-1-alpha-generation">Test Vector 1: Alpha Generation</h3>
<p><strong>Input:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># 목적지 공개 키 (Ed25519)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>A <span style="color:#f92672">=</span> bytes<span style="color:#f92672">.</span>fromhex(<span style="color:#e6db74">&#39;aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa&#39;</span>) stA <span style="color:#f92672">=</span> <span style="color:#ae81ff">0x0007</span>  <span style="color:#75715e"># Ed25519 stA_prime = 0x000b  # Red25519 date = &#34;20251015&#34; secret = &#34;&#34;  # Empty secret</span>
</span></span></code></pre></div><p><strong>Computation:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>keydata <span style="color:#f92672">=</span> A <span style="color:#f92672">||</span> bytes([<span style="color:#ae81ff">0x00</span>, <span style="color:#ae81ff">0x07</span>]) <span style="color:#f92672">||</span> bytes([<span style="color:#ae81ff">0x00</span>, <span style="color:#ae81ff">0x0b</span>])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># keydata = 36 바이트</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>salt <span style="color:#f92672">=</span> SHA256(<span style="color:#e6db74">b</span><span style="color:#e6db74">&#34;I2PGenerateAlpha&#34;</span> <span style="color:#f92672">+</span> keydata) ikm <span style="color:#f92672">=</span> <span style="color:#e6db74">b</span><span style="color:#e6db74">&#34;20251015&#34;</span> info <span style="color:#f92672">=</span> <span style="color:#e6db74">b</span><span style="color:#e6db74">&#34;i2pblinding1&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>seed <span style="color:#f92672">=</span> HKDF(salt, ikm, info, <span style="color:#ae81ff">64</span>) alpha <span style="color:#f92672">=</span> LEOS2IP(seed) mod L
</span></span></code></pre></div><p><strong>Expected Output:</strong></p>
<pre tabindex="0"><code>(레퍼런스 구현과 대조하여 검증) alpha = [64-바이트 16진수 값]
</code></pre><h3 id="test-vector-2-chacha20-encryption">Test Vector 2: ChaCha20 Encryption</h3>
<p><strong>Input:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>key <span style="color:#f92672">=</span> bytes([i <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">32</span>)])  <span style="color:#75715e"># 0x00..0x1f nonce = bytes([i for i in range(12)])  # 0x00..0x0b plaintext = b&#34;Hello, I2P!&#34;</span>
</span></span></code></pre></div><p><strong>Computation:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>ciphertext <span style="color:#f92672">=</span> ChaCha20_Encrypt(key, nonce, plaintext, counter<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>)
</span></span></code></pre></div><p><strong>Expected Output:</strong></p>
<pre tabindex="0"><code>ciphertext = [RFC 7539 테스트 벡터와 대조하여 검증]
</code></pre><h3 id="test-vector-3-hkdf">Test Vector 3: HKDF</h3>
<p><strong>Input:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>salt <span style="color:#f92672">=</span> bytes(<span style="color:#ae81ff">32</span>)  <span style="color:#75715e"># 모두 0 ikm = b&#34;test input keying material&#34; info = b&#34;ELS2_L1K&#34; n = 44</span>
</span></span></code></pre></div><p><strong>Computation:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>keys <span style="color:#f92672">=</span> HKDF(salt, ikm, info, n)
</span></span></code></pre></div><p><strong>Expected Output:</strong></p>
<pre tabindex="0"><code>keys = [44바이트 16진수 값]
</code></pre><h3 id="test-vector-4-base32-address">Test Vector 4: Base32 Address</h3>
<p><strong>Input:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>pubkey <span style="color:#f92672">=</span> bytes<span style="color:#f92672">.</span>fromhex(<span style="color:#e6db74">&#39;bbbb&#39;</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;bb&#39;</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">30</span>)  <span style="color:#75715e"># 32바이트 unblinded_sigtype = 11  # Red25519 blinded_sigtype = 11    # Red25519</span>
</span></span></code></pre></div><p><strong>Computation:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>address <span style="color:#f92672">=</span> generate_encrypted_b32_address(pubkey, unblinded_sigtype, blinded_sigtype)
</span></span></code></pre></div><p><strong>Expected Output:</strong></p>
<pre tabindex="0"><code>address = [base32 문자 56개].b32.i2p

# 체크섬이 올바르게 검증되는지 확인
</code></pre><hr>
<h2 id="appendix-c-glossary">Appendix C: Glossary</h2>
<p><strong>Alpha (α):</strong> The secret blinding factor used to blind public and private keys. Generated from the destination, date, and optional secret.</p>
<p><strong>AuthCookie:</strong> A 32-byte random value encrypted for each authorized client, used as input to Layer 2 encryption.</p>
<p><strong>B (Base Point):</strong> The generator point for the Ed25519 elliptic curve.</p>
<p><strong>Blinded Key:</strong> A public or private key that has been transformed using the alpha blinding factor. Blinded keys cannot be linked to the original keys without knowing alpha.</p>
<p><strong>ChaCha20:</strong> A stream cipher providing fast, secure encryption without requiring AES hardware support.</p>
<p><strong>ClientID:</strong> An 8-byte identifier derived from HKDF output, used to identify authorization entries for clients.</p>
<p><strong>ClientCookie:</strong> A 32-byte encrypted value containing the authCookie for a specific client.</p>
<p><strong>Credential:</strong> A 32-byte value derived from the destination&rsquo;s public key and signature types, binding encryption to knowledge of the destination.</p>
<p><strong>CSRNG:</strong> Cryptographically Secure Random Number Generator. Must provide unpredictable output suitable for key generation.</p>
<p><strong>DH (Diffie-Hellman):</strong> A cryptographic protocol for securely establishing shared secrets. I2P uses X25519.</p>
<p><strong>Ed25519:</strong> An elliptic curve signature scheme providing fast signatures with 128-bit security level.</p>
<p><strong>Ephemeral Key:</strong> A short-lived cryptographic key, typically used once and then discarded.</p>
<p><strong>Floodfill:</strong> I2P routers that store and serve network database entries, including encrypted LeaseSets.</p>
<p><strong>HKDF:</strong> HMAC-based Key Derivation Function, used to derive multiple cryptographic keys from a single source.</p>
<p><strong>L (Order):</strong> The order of the Ed25519 scalar field (approximately 2^252).</p>
<p><strong>Layer 0 (Outer):</strong> The plaintext portion of an encrypted LeaseSet, containing blinded key and metadata.</p>
<p><strong>Layer 1 (Middle):</strong> The first encrypted layer, containing client authorization data.</p>
<p><strong>Layer 2 (Inner):</strong> The innermost encrypted layer, containing the actual LeaseSet2 data.</p>
<p><strong>LeaseSet2 (LS2):</strong> Second version of I2P&rsquo;s network database entry format, introducing encrypted variants.</p>
<p><strong>NetDB:</strong> The I2P network database, a distributed hash table storing router and destination information.</p>
<p><strong>Offline Keys:</strong> A feature allowing the main signing key to remain in cold storage while a transient key handles daily operations.</p>
<p><strong>PSK (Pre-Shared Key):</strong> A symmetric key shared in advance between two parties, used for PSK client authorization.</p>
<p><strong>Red25519:</strong> An Ed25519-based signature scheme with key blinding support, based on ZCash RedDSA.</p>
<p><strong>Salt:</strong> Random data used as input to key derivation functions to ensure unique outputs.</p>
<p><strong>SigType:</strong> A numeric identifier for signature algorithms (e.g., 7 = Ed25519, 11 = Red25519).</p>
<p><strong>Subcredential:</strong> A 32-byte value derived from the credential and blinded public key, binding encryption to a specific encrypted LeaseSet.</p>
<p><strong>Transient Key:</strong> A temporary signing key used with offline keys, with a limited validity period.</p>
<p><strong>X25519:</strong> An elliptic curve Diffie-Hellman protocol over Curve25519, providing key agreement.</p>
<hr>
<h2 id="document-information">Document Information</h2>
<p><strong>Status:</strong> This document represents the current stable encrypted LeaseSet specification as implemented in I2P since June 2019. The protocol is mature and widely deployed.</p>
<p><strong>Contributing:</strong> For corrections or improvements to this documentation, please submit issues or pull requests to the I2P specifications repository.</p>
<p><strong>Support:</strong> For questions about implementing encrypted LeaseSets:</p>
<ul>
<li>I2P Forum: <a href="https://i2pforum.net/">https://i2pforum.net/</a>
</li>
<li>IRC: #i2p-dev on OFTC</li>
<li>Matrix: #i2p-dev:matrix.org</li>
</ul>
<p><strong>Acknowledgments:</strong> This specification builds on work by the I2P development team, ZCash cryptography research, and Tor Project&rsquo;s key blinding research.</p>

                </article>

                
                <nav class="page-nav">
                    
                        <a href="../../../../ko/docs/specs/b32-for-encrypted-leasesets/" class="page-nav-link prev">
                            <span class="nav-label">← Previous</span>
                            <span class="nav-title">암호화된 leaseSet을 위한 B32</span>
                        </a>
                    
                    
                        <a href="../../../../ko/docs/specs/streaming/" class="page-nav-link next">
                            <span class="nav-label">Next →</span>
                            <span class="nav-title">스트리밍 프로토콜</span>
                        </a>
                    
                </nav>

                
                <div class="docs-feedback">
                    <p>Was this page helpful?</p>
                    <div class="feedback-buttons" id="feedback-buttons">
                        <button class="feedback-btn" id="feedback-yes">👍 Yes</button>
                        <button class="feedback-btn" id="feedback-no">👎 No</button>
                    </div>

                    
                    <div class="feedback-form-container" id="feedback-form-container" style="display: none;">
                        <p class="feedback-form-title">We're sorry to hear that. How can we improve this page?</p>
                        <form id="feedback-form">
                            <div class="form-group">
                                <label for="feedback-email">Email (optional - if you'd like a response)</label>
                                <input type="email" id="feedback-email" name="email" placeholder="your@email.com">
                            </div>
                            <div class="form-group">
                                <label for="feedback-message">Feedback *</label>
                                <textarea id="feedback-message" name="message" rows="4" required placeholder="Tell us what we can improve..."></textarea>
                            </div>
                            <button type="submit" class="btn-submit-feedback" id="feedback-submit-btn">
                                <span class="btn-text">Submit Feedback</span>
                                <span class="btn-loading" style="display: none;">Sending...</span>
                            </button>
                        </form>
                    </div>

                    
                    <div class="feedback-message" id="feedback-success" style="display: none;">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                            <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" stroke-width="2"/>
                        </svg>
                        <span id="feedback-success-text">Thanks for your feedback!</span>
                    </div>
                    <div class="feedback-message feedback-error" id="feedback-error" style="display: none;">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                            <circle cx="12" cy="12" r="10" stroke-width="2"/>
                            <path d="M12 8v4M12 16h.01" stroke-width="2" stroke-linecap="round"/>
                        </svg>
                        <span id="feedback-error-text">Something went wrong. Please try again.</span>
                    </div>

                    <p class="feedback-note">
                        Found an issue? <a href="https://gitlab.com/stormycloud-group/i-2-p-www-v-2/-/blob/main/hugo-site/content/ko/docs/specs/encryptedleaseset.md?ref_type=heads" target="_blank">Edit this page on GitLab</a>
                    </p>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
.docs-page {
    min-height: 100vh;
    padding: var(--spacing-xl) 0;
}

.breadcrumbs {
    display: flex;
    align-items: center;
    gap: var(--spacing-xs);
    margin-bottom: var(--spacing-lg);
    font-size: 0.875rem;
    color: var(--color-text-muted);
}

.breadcrumbs a {
    color: var(--color-text-muted);
    text-decoration: none;
    transition: color var(--transition-fast);
}

.breadcrumbs a:hover {
    color: var(--color-primary);
}

.separator {
    color: var(--color-border);
}

.current {
    color: var(--color-text);
}

 
.translation-disclaimer {
    background: #fef3c7;
    border: 1px solid #f59e0b;
    border-radius: var(--radius-md);
    padding: var(--spacing-md);
    margin-bottom: var(--spacing-lg);
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: var(--spacing-md);
    flex-wrap: wrap;
}

.dark .translation-disclaimer {
    background: #78350f;
    border-color: #d97706;
}

.disclaimer-message {
    color: #92400e;
    font-size: 0.875rem;
}

.dark .disclaimer-message {
    color: #fde047;
}

.disclaimer-link {
    color: #92400e;
    font-weight: 600;
    text-decoration: underline;
    white-space: nowrap;
}

.dark .disclaimer-link {
    color: #fde047;
}

 
.article-header {
    margin-bottom: var(--spacing-2xl);
}

.article-title {
    font-size: 2.5rem;
    margin: 0 0 var(--spacing-md) 0;
    color: var(--color-text);
}

.article-description {
    font-size: 1.125rem;
    color: var(--color-text-secondary);
    margin-bottom: var(--spacing-md);
}

.article-meta {
    display: flex;
    gap: var(--spacing-lg);
    flex-wrap: wrap;
}

.meta-item {
    display: flex;
    align-items: center;
    gap: var(--spacing-xs);
    font-size: 0.875rem;
    color: var(--color-text-muted);
}

.meta-item svg {
    color: var(--color-primary);
}

 
.docs-layout {
    display: block;
}

.docs-layout--with-toc {
    display: grid;
    grid-template-columns: 260px 1fr;
    gap: var(--spacing-2xl);
    align-items: start;
}

 
.docs-toc-sidebar {
    position: sticky;
    top: 100px;
    max-height: calc(100vh - 120px);
    overflow-y: auto;
}

.toc-nav {
    background: var(--color-bg-secondary);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-lg);
    padding: var(--spacing-md);
}

.toc-header {
    display: flex;
    align-items: center;
    gap: var(--spacing-sm);
    font-weight: 700;
    font-size: 0.875rem;
    color: var(--color-text);
    padding-bottom: var(--spacing-md);
    margin-bottom: var(--spacing-md);
    border-bottom: 1px solid var(--color-border);
}

.toc-content {
    max-height: calc(100vh - 250px);
    overflow-y: auto;
}

.toc-content::-webkit-scrollbar {
    width: 4px;
}

.toc-content::-webkit-scrollbar-track {
    background: transparent;
}

.toc-content::-webkit-scrollbar-thumb {
    background: var(--color-border);
    border-radius: 2px;
}

.toc-content::-webkit-scrollbar-thumb:hover {
    background: var(--color-text-muted);
}

.toc-nav ul {
    list-style: none;
    padding-left: 0;
    margin: 0;
}

.toc-nav li {
    margin-bottom: 0.25rem;
}

.toc-nav ul ul {
    padding-left: var(--spacing-md);
    margin-top: 0.25rem;
}

.toc-nav a {
    color: var(--color-text-secondary);
    text-decoration: none;
    font-size: 0.8125rem;
    display: block;
    padding: 0.25rem 0.5rem;
    border-radius: var(--radius-sm);
    transition: all var(--transition-fast);
    line-height: 1.4;
}

.toc-nav a:hover {
    color: var(--color-primary);
    background: var(--color-bg-tertiary);
}

 
.docs-main {
    min-width: 0;
    max-width: 900px;
}

 
.article-content {
    line-height: 1.8;
    color: var(--color-text);
}

.article-content h2 {
    margin-top: var(--spacing-2xl);
    margin-bottom: var(--spacing-md);
    font-size: 1.75rem;
    scroll-margin-top: 100px;
}

.article-content h3 {
    margin-top: var(--spacing-xl);
    margin-bottom: var(--spacing-sm);
    font-size: 1.375rem;
    scroll-margin-top: 100px;
}

.article-content h4 {
    margin-top: var(--spacing-lg);
    margin-bottom: var(--spacing-xs);
    font-size: 1.125rem;
    scroll-margin-top: 100px;
}

.article-content p {
    margin-bottom: var(--spacing-md);
}

.article-content ul,
.article-content ol {
    margin-bottom: var(--spacing-md);
    padding-left: var(--spacing-xl);
}

.article-content li {
    margin-bottom: var(--spacing-xs);
}

.article-content code {
    background: var(--color-bg-secondary);
    padding: 0.125rem 0.375rem;
    border-radius: var(--radius-sm);
    font-size: 0.875em;
    font-family: 'Courier New', monospace;
}

.article-content pre {
    background: var(--color-bg-secondary);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-md);
    padding: var(--spacing-md);
    overflow-x: auto;
    margin-bottom: var(--spacing-md);
}

.article-content pre code {
    background: none;
    padding: 0;
}

.article-content img {
    max-width: 100%;
    height: auto;
    border-radius: var(--radius-md);
    border: 1px solid var(--color-border);
    margin: var(--spacing-lg) 0;
    display: block;
}

.article-content a {
    color: var(--color-primary);
    text-decoration: none;
    border-bottom: 1px solid transparent;
    transition: border-color var(--transition-fast);
}

.article-content a:hover {
    border-bottom-color: var(--color-primary);
}

 
.page-nav {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: var(--spacing-md);
    margin-top: var(--spacing-2xl);
    padding-top: var(--spacing-xl);
    border-top: 1px solid var(--color-border);
}

.page-nav-link {
    display: flex;
    flex-direction: column;
    padding: var(--spacing-md);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-md);
    text-decoration: none;
    transition: all var(--transition-fast);
}

.page-nav-link:hover {
    border-color: var(--color-primary);
    box-shadow: var(--shadow-md);
}

.page-nav-link.next {
    text-align: right;
}

.nav-label {
    font-size: 0.875rem;
    color: var(--color-text-muted);
    margin-bottom: var(--spacing-xs);
}

.nav-title {
    font-weight: 600;
    color: var(--color-text);
}

 
.docs-feedback {
    margin-top: var(--spacing-2xl);
    padding: var(--spacing-lg);
    background: var(--color-bg-secondary);
    border-radius: var(--radius-md);
    text-align: center;
}

.feedback-buttons {
    display: flex;
    gap: var(--spacing-md);
    justify-content: center;
    margin: var(--spacing-md) 0;
}

.feedback-btn {
    padding: var(--spacing-sm) var(--spacing-lg);
    background: var(--color-bg);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-md);
    cursor: pointer;
    transition: all var(--transition-fast);
}

.feedback-btn:hover {
    border-color: var(--color-primary);
    background: var(--color-primary);
    color: white;
}

.feedback-note {
    font-size: 0.875rem;
    color: var(--color-text-muted);
    margin-top: var(--spacing-md);
}

.feedback-note a {
    color: var(--color-primary);
    text-decoration: none;
}

.feedback-note a:hover {
    text-decoration: underline;
}

 
.feedback-form-container {
    margin-top: var(--spacing-lg);
    padding: var(--spacing-lg);
    background: var(--color-bg);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-md);
    text-align: left;
}

.feedback-form-title {
    font-weight: 600;
    margin-bottom: var(--spacing-md);
    color: var(--color-text);
}

.form-group {
    margin-bottom: var(--spacing-md);
}

.form-group label {
    display: block;
    font-size: 0.875rem;
    font-weight: 600;
    margin-bottom: var(--spacing-xs);
    color: var(--color-text);
}

.form-group input[type="email"],
.form-group textarea {
    width: 100%;
    padding: var(--spacing-sm);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-md);
    background: var(--color-bg);
    color: var(--color-text);
    font-family: inherit;
    font-size: 0.9375rem;
    transition: border-color var(--transition-fast);
}

.form-group input[type="email"]:focus,
.form-group textarea:focus {
    outline: none;
    border-color: var(--color-primary);
}

.form-group textarea {
    resize: vertical;
    min-height: 100px;
}

.btn-submit-feedback {
    padding: var(--spacing-sm) var(--spacing-lg);
    background: var(--color-primary);
    color: white;
    border: none;
    border-radius: var(--radius-md);
    font-weight: 600;
    cursor: pointer;
    transition: all var(--transition-fast);
}

.btn-submit-feedback:hover:not(:disabled) {
    background: var(--color-primary-dark);
    transform: translateY(-1px);
}

.btn-submit-feedback:disabled {
    opacity: 0.6;
    cursor: not-allowed;
}

 
.feedback-message {
    display: flex;
    align-items: center;
    gap: var(--spacing-sm);
    padding: var(--spacing-md);
    background: #d1fae5;
    color: #065f46;
    border-radius: var(--radius-md);
    margin-top: var(--spacing-md);
}

.feedback-message.feedback-error {
    background: #fee2e2;
    color: #991b1b;
}

.feedback-message svg {
    flex-shrink: 0;
}

 
@media (max-width: 1024px) {
    .docs-layout--with-toc {
        grid-template-columns: 1fr;
    }

    .docs-toc-sidebar {
        position: static;
        max-height: none;
        margin-bottom: var(--spacing-xl);
    }

    .toc-content {
        max-height: 300px;
    }
}

@media (max-width: 768px) {
    .article-title {
        font-size: 1.75rem;
    }
}
</style>



<script>
document.addEventListener('DOMContentLoaded', function() {
    const tocLinks = document.querySelectorAll('.toc-nav a');
    const headings = [];

    tocLinks.forEach(link => {
        const href = link.getAttribute('href');
        if (href && href.startsWith('#')) {
            const heading = document.getElementById(href.slice(1));
            if (heading) {
                headings.push({ element: heading, link: link });
            }
        }
    });

    function updateActiveLink() {
        const scrollPos = window.scrollY + 120;
        let activeIndex = 0;

        for (let i = 0; i < headings.length; i++) {
            if (headings[i].element.offsetTop <= scrollPos) {
                activeIndex = i;
            }
        }

        tocLinks.forEach(link => link.classList.remove('active'));
        if (headings[activeIndex]) {
            headings[activeIndex].link.classList.add('active');
        }
    }

    window.addEventListener('scroll', updateActiveLink);
    updateActiveLink();
});
</script>
<style>
.toc-nav a.active {
    color: var(--color-primary);
    background: var(--color-bg-tertiary);
    font-weight: 600;
}
</style>



<script>
(function() {
    'use strict';
    
    
    let baseUrl = window.feedbackBaseUrl;
    if (!baseUrl) {
        const hostname = window.location.hostname;
        
        if (hostname.endsWith('.b32.i2p') || hostname.endsWith('.i2p')) {
            baseUrl = 'http://5kwyynf3eetgqa2nors6ctwo7doi7yu73k7uvypy5eqmm326zkiq.b32.i2p';
        } else if (hostname.endsWith('.onion')) {
            baseUrl = 'http://gfonxmohvarpmocsvllscsuszdu5rikipm6innvcwq4vpng7zzqmmfyd.onion';
        } else {
            baseUrl = 'https://feedback.i2p.net';
        }
    }
    
    const script = document.createElement('script');
    script.src = baseUrl + '/widgets/docs-feedback.js';
    script.async = true;
    script.onerror = function() {
        console.error('[Docs Feedback] Failed to load docs-feedback.js from:', baseUrl);
    };
    document.body.appendChild(script);
})();
</script>


    </main>

    <footer class="site-footer">
    <div class="container">
        <div class="footer-grid">
            <div class="footer-col footer-brand">
                <img src="../../../../images/i2plogo_lightmode.svg" alt="I2P Logo" class="footer-logo logo-light" loading="lazy" decoding="async">
                <img src="../../../../images/i2plogo_darkmode.svg" alt="I2P Logo" class="footer-logo logo-dark" loading="lazy" decoding="async">
                <p class="footer-tagline">Privacy. Security. Freedom.</p>
                <p class="footer-description">The Invisible Internet Project - A privacy-focused, anonymous network layer</p>

                <div class="footer-social-newsletter">
                    <div class="social-links">
                        <a href="https://mastodon.social/@i2p" target="_blank" rel="noopener" aria-label="Mastodon">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M21.327 8.566c0-4.339-2.843-5.61-2.843-5.61-1.433-.658-3.894-.935-6.451-.956h-.063c-2.557.021-5.016.298-6.45.956 0 0-2.843 1.272-2.843 5.61 0 .993-.019 2.181.012 3.441.103 4.243.778 8.425 4.701 9.463 1.809.479 3.362.579 4.612.51 2.268-.126 3.541-.809 3.541-.809l-.075-1.646s-1.621.511-3.441.449c-1.804-.062-3.707-.194-3.999-2.409a4.523 4.523 0 0 1-.04-.621s1.77.433 4.014.536c1.372.063 2.658-.08 3.965-.236 2.506-.299 4.688-1.843 4.962-3.254.434-2.223.398-5.424.398-5.424zm-3.353 5.59h-2.081V9.057c0-1.075-.452-1.62-1.357-1.62-1 0-1.501.647-1.501 1.927v2.791h-2.069V9.364c0-1.28-.501-1.927-1.502-1.927-.905 0-1.357.546-1.357 1.62v5.099H6.026V8.903c0-1.074.273-1.927.823-2.558.566-.631 1.307-.955 2.228-.955 1.065 0 1.872.409 2.405 1.228l.518.869.519-.869c.533-.819 1.34-1.228 2.405-1.228.92 0 1.662.324 2.228.955.549.631.822 1.484.822 2.558v5.253z"/>
                            </svg>
                        </a>
                        <a href="https://twitter.com/GetI2P" target="_blank" rel="noopener" aria-label="Twitter">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/>
                            </svg>
                        </a>
                        <a href="https://old.reddit.com/r/i2p" target="_blank" rel="noopener" aria-label="Reddit">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M12 0A12 12 0 0 0 0 12a12 12 0 0 0 12 12 12 12 0 0 0 12-12A12 12 0 0 0 12 0zm5.01 4.744c.688 0 1.25.561 1.25 1.249a1.25 1.25 0 0 1-2.498.056l-2.597-.547-.8 3.747c1.824.07 3.48.632 4.674 1.488.308-.309.73-.491 1.207-.491.968 0 1.754.786 1.754 1.754 0 .716-.435 1.333-1.01 1.614a3.111 3.111 0 0 1 .042.52c0 2.694-3.13 4.87-7.004 4.87-3.874 0-7.004-2.176-7.004-4.87 0-.183.015-.366.043-.534A1.748 1.748 0 0 1 4.028 12c0-.968.786-1.754 1.754-1.754.463 0 .898.196 1.207.49 1.207-.883 2.878-1.43 4.744-1.487l.885-4.182a.342.342 0 0 1 .14-.197.35.35 0 0 1 .238-.042l2.906.617a1.214 1.214 0 0 1 1.108-.701zM9.25 12C8.561 12 8 12.562 8 13.25c0 .687.561 1.248 1.25 1.248.687 0 1.248-.561 1.248-1.249 0-.688-.561-1.249-1.249-1.249zm5.5 0c-.687 0-1.248.561-1.248 1.25 0 .687.561 1.248 1.249 1.248.688 0 1.249-.561 1.249-1.249 0-.687-.562-1.249-1.25-1.249zm-5.466 3.99a.327.327 0 0 0-.231.094.33.33 0 0 0 0 .463c.842.842 2.484.913 2.961.913.477 0 2.105-.056 2.961-.913a.361.361 0 0 0 .029-.463.33.33 0 0 0-.464 0c-.547.533-1.684.73-2.512.73-.828 0-1.979-.196-2.512-.73a.326.326 0 0 0-.232-.095z"/>
                            </svg>
                        </a>
                        <a href="https://signal.group/#CjQKIOSUTtxlhbumAKcRsthPFkxkTUrkWcX39bbN6njLEgAIEhCTNsR0KDuiehAXZnkt42v5" target="_blank" rel="noopener" aria-label="Signal" class="signal-link">
                            <img src="../../../../images/Signal-Logo-Black.svg" alt="Signal" class="signal-logo signal-logo-light" loading="lazy" decoding="async">
                            <img src="../../../../images/Signal-Logo-White.svg" alt="Signal" class="signal-logo signal-logo-dark" loading="lazy" decoding="async">
                        </a>
                    </div>

                    
                    <div class="footer-newsletter-inline">
                        <p class="newsletter-description">I2P 뉴스 받기:</p>
                        <form action="https://feedback.i2p.net/api/mailing-list/subscribe" method="POST" class="newsletter-form">
                            <input type="email" name="email" placeholder="이메일을 입력하세요" required>
                            <button type="submit">구독하기</button>
                        </form>
                    </div>
                </div>
            </div>

            <div class="footer-col">
                <h3>빠른 링크</h3>
                <ul>
                    <li><a href="../../../../ko/financial-support/">기부하기</a></li>
                    <li><a href="../../../../ko/docs/overview/intro/">I2P 소개</a></li>
                </ul>
            </div>

            <div class="footer-col">
                <h3>커뮤니티</h3>
                <ul>
                    <li><a href="../../../../ko/get-involved/">참여하기</a></li>
                    <li><a href="../../../../ko/blog/">블로그</a></li>
                    <li><a href="http://i2pforum.net/" target="_blank" rel="noopener">공식 포럼</a></li>
                    <li><a href="../../../../ko/contact/">연락처</a></li>
                </ul>
            </div>

            <div class="footer-col">
                <h3>리소스</h3>
                <ul>
                    <li><a href="https://i2p-metrics.np-tokumei.net/" target="_blank" rel="noopener">I2P 메트릭</a></li>
                    <li><a href="../../../../ko/papers/">연구</a></li>
                    <li><a href="https://i2pgit.org/" target="_blank" rel="noopener">GitLab</a></li>
                    <li><a href="https://www.stormycloud.org/" target="_blank" rel="noopener">스톰이클라우드</a></li>
                </ul>
            </div>
        </div>

        <div class="footer-bottom">
            <p class="copyright">&copy; 2025 Invisible Internet Project. Creative Commons 라이선스 적용.</p>
            <div class="footer-links">
                <a href="../../../../ko/privacy/">개인정보 처리방침</a>
                <a href="../../../../ko/terms/">이용 약관</a>
                <a href="../../../../ko/about/media/">언론</a>
            </div>
        </div>
    </div>
</footer>


    
    
<div class="modal-overlay" id="poll">
    <div class="modal-content poll-modal-content">
        <a href="#" class="modal-close" aria-label="닫기">
            <span aria-hidden="true">&times;</span>
        </a>

        <div class="modal-header">
            <h2>커뮤니티 설문 조사</h2>
            <p class="modal-subtitle">귀하의 의견을 듣고 싶습니다</p>
        </div>

        <div class="modal-body">
            
            <iframe 
                id="poll-iframe"
                data-poll-id="2"
                data-api-url="https://feedback.i2p.net"
                frameborder="0"
                scrolling="no"
                style="width: 100%; border: none; min-height: 400px;">
            </iframe>
        </div>

        <div class="modal-footer">
            <p class="modal-disclaimer">
                귀하의 투표는 I2P의 미래를 형성하는 데 도움이 됩니다.
            </p>
        </div>
    </div>
</div>


<script>
(function() {
    const iframe = document.getElementById('poll-iframe');
    if (!iframe) return;
    
    const hostname = window.location.hostname;
    let apiUrl = 'https://feedback.i2p.net';
    const pollId = iframe.getAttribute('data-poll-id') || '1';

    
    if (hostname.endsWith('.b32.i2p') || hostname.endsWith('.i2p')) {
        apiUrl = 'http://5kwyynf3eetgqa2nors6ctwo7doi7yu73k7uvypy5eqmm326zkiq.b32.i2p';
    }
    
    else if (hostname.endsWith('.onion')) {
        apiUrl = 'http://gfonxmohvarpmocsvllscsuszdu5rikipm6innvcwq4vpng7zzqmmfyd.onion';
    }

    
    const pollUrl = apiUrl + '/widgets/poll.html?poll_id=' + encodeURIComponent(pollId) + '&api_url=' + encodeURIComponent(apiUrl);
    iframe.src = pollUrl;
})();
</script>



    
    



    
    <script>
        (function () {
            'use strict';
            var hostname = window.location.hostname;
            var baseUrl;

            
            if (hostname.endsWith('.b32.i2p') || hostname.endsWith('.i2p')) {
                baseUrl = 'http://5kwyynf3eetgqa2nors6ctwo7doi7yu73k7uvypy5eqmm326zkiq.b32.i2p';
            } else if (hostname.endsWith('.onion')) {
                baseUrl = 'http://gfonxmohvarpmocsvllscsuszdu5rikipm6innvcwq4vpng7zzqmmfyd.onion';
            } else {
                baseUrl = 'https://feedback.i2p.net';
            }

            window.feedbackBaseUrl = baseUrl;

            
            document.querySelectorAll('[data-api-url]').forEach(function (widget) {
                widget.setAttribute('data-api-url', baseUrl);
            });

            
            document.write('<link rel="stylesheet" href="' + baseUrl + '/widgets/styles.css">');
            
        })();
    </script>

    

    
    
    

    

</body>

</html>
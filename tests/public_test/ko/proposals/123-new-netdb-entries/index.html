<!DOCTYPE html>
<html lang="ko" data-theme="light">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <title>새로운 netDB 항목 | I2P - 보이지 않는 인터넷 프로젝트</title>

    <meta name="description" content="The Invisible Internet Project - A privacy-focused, anonymous network layer">
    <meta name="keywords" content="i2p, privacy, anonymity, dark net, encryption, security">

    
    <meta property="og:title" content="새로운 netDB 항목 | I2P - 보이지 않는 인터넷 프로젝트">
    <meta property="og:description" content="The Invisible Internet Project - A privacy-focused, anonymous network layer">
    <meta property="og:type" content="website">
    <meta property="og:url" content="/ko/proposals/123-new-netdb-entries/">

    
    <link rel="icon" type="image/svg+xml" href="../../../images/favicon.svg">
    <link rel="icon" type="image/png" href="../../../images/i2plogo.png" sizes="32x32">

    
    
    
    
    <link rel="stylesheet" href="../../../css/main.min.be6880f32f5ff44e57579da7b11513b973319944ebe38748e3ac7f3268662d18.css" integrity="sha256-vmiA8y9f9E5XV52nsRUTuXMxmUTr44dI46x/MmhmLRg=">
    


    
</head>

<body>
    
    <input type="checkbox" id="theme-toggle-checkbox" class="theme-checkbox" aria-hidden="true">

    
<div class="site-banner" id="site-banner" data-banner-id="banner-3" role="alert" aria-live="polite">
    <div class="container">
        <div class="banner-content">
            <span class="banner-message">I2P 베타 사이트 현재 운영 중 문의사항은 stormycloud@mail.i2p로 이메일 주세요</span>
            
        </div>
        
        <form method="GET" action="../../../api/banner/dismiss" style="display: inline;">
            <input type="hidden" name="id" value="banner-3">
            <button type="submit" class="banner-close" aria-label="배너 닫기" title="배너 닫기">
                <span aria-hidden="true">&times;</span>
            </button>
        </form>
        
    </div>
</div>


    <header class="site-header">
    <div class="container">
        <nav class="main-nav">
            <div class="nav-brand">
                <a href="../../../ko/" class="logo-link">
                    <img src="../../../images/i2plogo_lightmode.svg" alt="I2P Logo" class="logo logo-light">
                    <img src="../../../images/i2plogo_darkmode.svg" alt="I2P Logo" class="logo logo-dark">
                </a>
            </div>

            
            <input type="checkbox" id="mobile-menu-checkbox" class="mobile-menu-checkbox"
                aria-label="Toggle navigation menu">
            <label for="mobile-menu-checkbox" class="mobile-menu-toggle" aria-label="Toggle navigation menu">
                <span class="hamburger"></span>
            </label>

            <div class="nav-menu">
                <ul class="nav-links">
                    <li class="nav-dropdown">
                        <a href="../../../ko/about/" class="">소개</a>
                        <ul class="dropdown-menu">
                            <li><a href="../../../ko/about/">개요</a></li>
                            <li><a href="../../../ko/papers/">연구 논문</a></li>
                            <li><a href="../../../ko/about/media/">보도자료</a></li>
                            <li><a href="../../../ko/contact/">문의하기</a></li>
                        </ul>
                    </li>
                    <li><a href="../../../ko/docs/" class="">문서</a></li>
                    <li><a href="../../../ko/downloads/" class="">다운로드</a></li>
                    <li><a href="../../../ko/blog/" class="">블로그</a></li>
                    <li class="nav-dropdown">
                        <a href="../../../ko/get-involved/" class="">참여하기</a>
                        <ul class="dropdown-menu">
                            <li><a href="../../../ko/get-involved/">개요</a></li>
                            <li><a href="../../../ko/feedback/">기능 제안</a></li>
                        </ul>
                    </li>
                </ul>

                <div class="nav-actions">
                    
                    <div class="language-selector">
                        <button class="language-toggle" aria-label="Select language" title="Language">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none"
                                xmlns="http://www.w3.org/2000/svg">
                                <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2" />
                                <path
                                    d="M2 12h20M12 2a15.3 15.3 0 014 10 15.3 15.3 0 01-4 10 15.3 15.3 0 01-4-10 15.3 15.3 0 014-10z"
                                    stroke="currentColor" stroke-width="2" />
                            </svg>
                            <span class="current-lang">ko</span>
                        </button>
                        <div class="language-dropdown">
                            
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../en/proposals/123-new-netdb-entries/"
                                class="lang-option">영어</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../es/proposals/123-new-netdb-entries/"
                                class="lang-option">스페인어</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../ko/proposals/123-new-netdb-entries/"
                                class="lang-option active">한국어</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../zh/proposals/123-new-netdb-entries/"
                                class="lang-option">중국어</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../ru/proposals/123-new-netdb-entries/"
                                class="lang-option">러시아어</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../cs/proposals/123-new-netdb-entries/"
                                class="lang-option">체코어</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../de/proposals/123-new-netdb-entries/"
                                class="lang-option">독일어</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../fr/proposals/123-new-netdb-entries/"
                                class="lang-option">프랑스어</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../tr/proposals/123-new-netdb-entries/"
                                class="lang-option">터키어</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../vi/proposals/123-new-netdb-entries/"
                                class="lang-option">베트남어</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../hi/proposals/123-new-netdb-entries/"
                                class="lang-option">힌디어</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../ar/proposals/123-new-netdb-entries/"
                                class="lang-option">아랍어</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../pt/proposals/123-new-netdb-entries/"
                                class="lang-option">포르투갈어</a>
                            
                            
                        </div>
                    </div>

                    
                    <label for="theme-toggle-checkbox" class="theme-toggle" aria-label="Toggle dark mode"
                        title="Toggle theme">
                        <svg class="sun-icon" width="20" height="20" viewBox="0 0 20 20" fill="none"
                            xmlns="http://www.w3.org/2000/svg">
                            <circle cx="10" cy="10" r="4" stroke="currentColor" stroke-width="2" />
                            <path
                                d="M10 2V4M10 16V18M18 10H16M4 10H2M15.657 4.343L14.243 5.757M5.757 14.243L4.343 15.657M15.657 15.657L14.243 14.243M5.757 5.757L4.343 4.343"
                                stroke="currentColor" stroke-width="2" stroke-linecap="round" />
                        </svg>
                        <svg class="moon-icon" width="20" height="20" viewBox="0 0 20 20" fill="none"
                            xmlns="http://www.w3.org/2000/svg">
                            <path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"
                                stroke="currentColor" stroke-width="2" stroke-linejoin="round" />
                        </svg>
                    </label>

                    
                    <a href="../../../ko/financial-support/" class="btn btn-primary" id="donate-btn">Donate</a>

                    
                    <a href="../../../ko/downloads/" class="btn btn-primary">I2P 다운로드</a>
                </div>
            </div>
        </nav>
    </div>
</header>

    <main id="main-content">
        



<div class="proposals-page">
    <div class="container">
        
        <nav class="breadcrumbs">
            <a href="../../../ko/">Home</a>
            <span class="separator">/</span>
            <a href="../../../ko/proposals/">Proposals</a>
            <span class="separator">/</span>
            <span class="current">새로운 netDB 항목</span>
        </nav>

        
<div class="translation-disclaimer" role="note">
    <span class="disclaimer-message">이 번역은 기계 학습을 사용하여 생성되었으며 100% 정확하지 않을 수 있습니다.</span>
    
    
    <a href="../../../en/proposals/123-new-netdb-entries/" class="disclaimer-link">영어 버전 보기</a>
    
</div>



        
        <header class="proposal-header">
            <div class="proposal-title-section">
                <h1 class="proposal-title">새로운 netDB 항목</h1>
                <div class="proposal-number">Proposal 123</div>
            </div>

            
            <div class="proposal-meta-box">
                <div class="proposal-status status-열기">
                    열기
                </div>

                
                <div class="proposal-info-grid">
                    
                    <div class="info-item">
                        <span class="info-label">Author</span>
                        <span class="info-value">zzz, str4d, orignal</span>
                    </div>
                    

                    
                    <div class="info-item">
                        <span class="info-label">Created</span>
                        <span class="info-value">2016-01-16</span>
                    </div>
                    

                    
                    <div class="info-item">
                        <span class="info-label">Last Updated</span>
                        <span class="info-value">2020-07-18</span>
                    </div>
                    

                    

                    
                </div>

                
                
                <div class="proposal-relationships">
                    
                    <div class="relationship">
                        <span class="relationship-label">Supercedes:</span>
                        <span class="relationship-value">110, 120, 121, 122</span>
                    </div>
                    
                    
                </div>
                
            </div>
        </header>

        
        <div class="proposal-layout proposal-layout--with-toc">
            
            
            <aside class="proposal-toc-sidebar">
                <nav class="toc-nav">
                    <div class="toc-header">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                            <path d="M4 6h16M4 12h16M4 18h16" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                        </svg>
                        On This Page
                    </div>
                    <div class="toc-content">
                        <nav id="TableOfContents">
  <ul>
    <li><a href="#상태">상태</a></li>
    <li><a href="#개요">개요</a></li>
    <li><a href="#제안서">제안서</a>
      <ul>
        <li><a href="#goals">Goals</a></li>
        <li><a href="#non-goals--out-of-scope">Non-Goals / Out-of-scope</a></li>
        <li><a href="#justification">Justification</a></li>
        <li><a href="#목표">목표</a></li>
        <li><a href="#비목표--범위-외">비목표 / 범위 외</a></li>
        <li><a href="#정당화">정당화</a></li>
        <li><a href="#netdb-데이터-타입">NetDB 데이터 타입</a></li>
        <li><a href="#참고사항">참고사항</a></li>
      </ul>
    </li>
    <li><a href="#standard-ls2-header">Standard LS2 Header</a>
      <ul>
        <li><a href="#조회저장-과정">조회/저장 과정</a></li>
        <li><a href="#형식">형식</a></li>
        <li><a href="#개인정보보호보안-고려사항">개인정보보호/보안 고려사항</a></li>
        <li><a href="#notes">Notes</a></li>
      </ul>
    </li>
    <li><a href="#new-databaseentry-types">New DatabaseEntry types</a>
      <ul>
        <li><a href="#형식-1">형식</a></li>
        <li><a href="#정당화-1">정당화</a></li>
        <li><a href="#문제점">문제점</a></li>
        <li><a href="#참고사항-1">참고사항</a></li>
        <li><a href="#new-encryption-issues">New Encryption Issues</a></li>
        <li><a href="#leaseset-2">LeaseSet 2</a></li>
        <li><a href="#형식-2">형식</a></li>
        <li><a href="#정당화-2">정당화</a></li>
        <li><a href="#토론">토론</a></li>
        <li><a href="#새로운-암호화-문제">새로운 암호화 문제</a></li>
        <li><a href="#참고사항-2">참고사항</a></li>
        <li><a href="#암호화된-ls2">암호화된 LS2</a></li>
        <li><a href="#정의">정의</a></li>
        <li><a href="#형식-3">형식</a></li>
        <li><a href="#notes-1">Notes</a></li>
        <li><a href="#meta-ls2">Meta LS2</a></li>
        <li><a href="#format">Format</a></li>
        <li><a href="#blinding-key-유도">Blinding Key 유도</a></li>
        <li><a href="#service-record">Service Record</a></li>
        <li><a href="#format-1">Format</a></li>
        <li><a href="#notes-2">Notes</a></li>
        <li><a href="#service-list">Service List</a></li>
        <li><a href="#format-2">Format</a></li>
        <li><a href="#notes-3">Notes</a></li>
      </ul>
    </li>
    <li><a href="#common-structures-spec-changes-required">Common Structures Spec Changes Required</a>
      <ul>
        <li><a href="#암호화-및-처리">암호화 및 처리</a></li>
        <li><a href="#new-intermediate-structures">New Intermediate Structures</a></li>
        <li><a href="#new-netdb-types">New NetDB Types</a></li>
        <li><a href="#new-signature-type">New Signature Type</a></li>
      </ul>
    </li>
    <li><a href="#encryption-spec-changes-required">Encryption Spec Changes Required</a></li>
    <li><a href="#i2np-changes-required">I2NP Changes Required</a>
      <ul>
        <li><a href="#database-lookup-message">Database Lookup Message</a></li>
        <li><a href="#changes">Changes</a></li>
        <li><a href="#클라이언트별-인증">클라이언트별 인증</a></li>
        <li><a href="#changes-1">Changes</a></li>
      </ul>
    </li>
    <li><a href="#i2cp-changes-required">I2CP Changes Required</a>
      <ul>
        <li><a href="#i2cp-options">I2CP Options</a></li>
        <li><a href="#session-config">Session Config</a></li>
        <li><a href="#base-32-주소를-사용한-암호화된-ls">Base 32 주소를 사용한 암호화된 LS</a></li>
        <li><a href="#오프라인-키를-사용한-암호화된-ls">오프라인 키를 사용한 암호화된 LS</a></li>
        <li><a href="#참고사항-3">참고사항</a></li>
        <li><a href="#meta-ls2-1">Meta LS2</a></li>
        <li><a href="#형식-4">형식</a></li>
        <li><a href="#참고사항-4">참고사항</a></li>
        <li><a href="#서비스-기록">서비스 기록</a></li>
        <li><a href="#형식-5">형식</a></li>
        <li><a href="#참고사항-5">참고사항</a></li>
        <li><a href="#서비스-목록">서비스 목록</a></li>
        <li><a href="#형식-6">형식</a></li>
        <li><a href="#참고사항-6">참고사항</a></li>
        <li><a href="#format-3">Format</a></li>
        <li><a href="#키-인증서">키 인증서</a></li>
        <li><a href="#새로운-중간-구조체">새로운 중간 구조체</a></li>
        <li><a href="#새로운-netdb-타입">새로운 NetDB 타입</a></li>
        <li><a href="#새로운-서명-유형">새로운 서명 유형</a></li>
        <li><a href="#justification-1">Justification</a></li>
        <li><a href="#usage">Usage</a></li>
        <li><a href="#데이터베이스-조회-메시지">데이터베이스 조회 메시지</a></li>
        <li><a href="#변경사항">변경사항</a></li>
        <li><a href="#데이터베이스-저장-메시지">데이터베이스 저장 메시지</a></li>
        <li><a href="#변경사항-1">변경사항</a></li>
      </ul>
    </li>
    <li><a href="#private-key-file-changes-required">Private Key File Changes Required</a>
      <ul>
        <li><a href="#changes-2">Changes</a></li>
        <li><a href="#i2cp-옵션">I2CP 옵션</a></li>
      </ul>
    </li>
    <li><a href="#streaming-changes-required">Streaming Changes Required</a>
      <ul>
        <li><a href="#세션-설정">세션 설정</a></li>
        <li><a href="#request-leaseset-메시지">Request LeaseSet 메시지</a></li>
      </ul>
    </li>
    <li><a href="#표준-ls2-헤더">표준 LS2 헤더</a>
      <ul>
        <li><a href="#request-variable-leaseset-message">Request Variable Leaseset Message</a></li>
        <li><a href="#create-leaseset2-메시지">Create Leaseset2 메시지</a></li>
      </ul>
    </li>
    <li><a href="#sam-v3-changes-required">SAM V3 Changes Required</a>
      <ul>
        <li><a href="#근거">근거</a></li>
        <li><a href="#메시지-유형">메시지 유형</a></li>
      </ul>
    </li>
    <li><a href="#bob-changes-required">BOB Changes Required</a></li>
    <li><a href="#publishing-migration-compatibility">Publishing, Migration, Compatibility</a></li>
    <li><a href="#rollout">Rollout</a></li>
    <li><a href="#새로운-databaseentry-타입">새로운 DatabaseEntry 타입</a></li>
  </ul>
</nav>
                    </div>
                </nav>
            </aside>
            

            
            <div class="proposal-main">
                <article class="proposal-content">
                    <h2 id="상태">상태</h2>
<p>이 제안서의 일부가 완료되어 0.9.38과 0.9.39에서 구현되었습니다. Common Structures, I2CP, I2NP 및 기타 사양서들이 현재 지원되는 변경사항을 반영하도록 업데이트되었습니다.</p>
<p>완성된 부분들도 여전히 사소한 수정이 있을 수 있습니다. 이 제안서의 다른 부분들은 아직 개발 중이며 상당한 수정이 있을 수 있습니다.</p>
<p>Service Lookup (타입 9와 11)은 우선순위가 낮고 일정이 정해지지 않았으며, 별도의 제안서로 분리될 수 있습니다.</p>
<h2 id="개요">개요</h2>
<p>다음 4개 제안서의 업데이트 및 통합 내용입니다:</p>
<ul>
<li>110 LS2</li>
<li>120 대규모 멀티호밍을 위한 Meta LS2</li>
<li>121 암호화된 LS2</li>
<li>122 인증되지 않은 서비스 조회 (애니캐스팅)</li>
</ul>
<p>이러한 제안들은 대부분 독립적이지만, 일관성을 위해 여러 제안에서 공통 형식을 정의하고 사용합니다.</p>
<p>다음 제안들은 어느 정도 관련이 있습니다:</p>
<ul>
<li>140 Invisible Multihoming (이 제안과 호환되지 않음)</li>
<li>142 New Crypto Template (새로운 대칭 암호화용)</li>
<li>144 ECIES-X25519-AEAD-Ratchet</li>
<li>145 ECIES-P256</li>
<li>146 Red25519</li>
<li>148 EdDSA-BLAKE2b-Ed25519</li>
<li>149 B32 for Encrypted LS2</li>
<li>150 Garlic Farm Protocol</li>
<li>151 ECDSA Blinding</li>
</ul>
<h2 id="제안서">제안서</h2>
<p>이 제안은 5개의 새로운 DatabaseEntry 타입과 이를 netDb에 저장하고 검색하는 프로세스, 그리고 이를 서명하고 해당 서명을 검증하는 방법을 정의합니다.</p>
<h3 id="goals">Goals</h3>
<ul>
<li>하위 호환성 지원</li>
<li>LS2는 기존 스타일의 멀티호밍과 함께 사용 가능</li>
<li>지원을 위해 새로운 암호화 기법이나 기본 요소가 필요하지 않음</li>
<li>암호화와 서명의 분리를 유지하고 현재 및 미래의 모든 버전을 지원</li>
<li>선택적 오프라인 서명 키 지원</li>
<li>핑거프린팅을 줄이기 위해 타임스탬프 정확도 감소</li>
<li>목적지를 위한 새로운 암호화 기법 지원</li>
<li>대규모 멀티호밍 지원</li>
<li>기존 암호화된 LS의 여러 문제 수정</li>
<li>floodfill에 의한 가시성을 줄이기 위한 선택적 블라인딩</li>
<li>암호화된 방식은 단일 키와 취소 가능한 다중 키를 모두 지원</li>
<li>아웃프록시의 쉬운 조회, 애플리케이션 DHT 부트스트랩 및 기타 용도를 위한 서비스 조회</li>
<li>bittorrent와 같은 32바이트 바이너리 목적지 해시에 의존하는 기능을 손상시키지 않음</li>
<li>routerinfo에서와 같이 속성을 통해 leaseSet에 유연성 추가</li>
<li>내용이 암호화되어도 작동하도록 게시 타임스탬프와 가변 만료 시간을 헤더에 배치
(가장 이른 lease에서 타임스탬프를 도출하지 않음)</li>
<li>모든 새로운 타입들은 기존 leaseSet과 동일한 DHT 공간과 위치에 존재하므로,
사용자가 목적지나 해시를 변경하지 않고도 기존 LS에서 LS2로 마이그레이션하거나
LS2, Meta, Encrypted 간에 변경할 수 있음</li>
<li>기존 목적지는 목적지나 해시를 변경하지 않고도 오프라인 키를 사용하도록
변환하거나 다시 온라인 키로 되돌릴 수 있음</li>
</ul>
<h3 id="non-goals--out-of-scope">Non-Goals / Out-of-scope</h3>
<ul>
<li>새로운 DHT 순환 알고리즘 또는 공유 랜덤 생성</li>
<li>사용할 구체적인 새로운 암호화 유형 및 해당 새로운 유형을 사용하는 종단간 암호화 방식은
별도의 제안서에서 다룰 예정입니다.
여기서는 새로운 암호화 기술을 명시하거나 논의하지 않습니다.</li>
<li>RI 또는 터널 구축을 위한 새로운 암호화.
이는 별도의 제안서에서 다룰 예정입니다.</li>
<li>I2NP DLM / DSM / DSRM 메시지의 암호화, 전송, 수신 방법.
변경하지 않습니다.</li>
<li>백엔드 router 간 통신, 관리, 장애 조치, 조정을 포함한 Meta 생성 및 지원 방법.
I2CP, i2pcontrol 또는 새로운 프로토콜에 지원이 추가될 수 있습니다.
이는 표준화될 수도 있고 그렇지 않을 수도 있습니다.</li>
<li>더 긴 만료 시간을 가진 터널을 실제로 구현하고 관리하는 방법 또는 기존 터널을 취소하는 방법.
이는 매우 어려우며, 이것 없이는 합리적인 우아한 종료를 할 수 없습니다.</li>
<li>위협 모델 변경사항</li>
<li>오프라인 저장 형식 또는 데이터를 저장/검색/공유하는 방법.</li>
<li>구현 세부사항은 여기서 논의하지 않으며 각 프로젝트에 맡깁니다.</li>
</ul>
<h3 id="justification">Justification</h3>
<p>LS2는 암호화 유형 변경과 향후 프로토콜 변경을 위한 필드를 추가합니다.</p>
<p>암호화된 LS2는 전체 lease 세트의 비대칭 암호화를 사용하여 기존 암호화된 LS의 여러 보안 문제를 해결합니다.</p>
<p>Meta LS2는 유연하고 효율적이며 효과적인 대규모 멀티호밍을 제공합니다.</p>
<p>Service Record와 Service List는 네이밍 조회 및 DHT 부트스트래핑과 같은 애니캐스트 서비스를 제공합니다.</p>
<h3 id="목표">목표</h3>
<p>타입 번호는 I2NP Database Lookup/Store 메시지에서 사용됩니다.</p>
<p>end-to-end 열은 쿼리/응답이 Garlic Message로 Destination에 전송되는지 여부를 나타냅니다.</p>
<p>기존 유형:</p>
<table>
  <thead>
      <tr>
          <th>NetDB Data</th>
          <th>Lookup Type</th>
          <th>Store Type</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>any</td>
          <td>0</td>
          <td>any</td>
      </tr>
      <tr>
          <td>LS</td>
          <td>1</td>
          <td>1</td>
      </tr>
      <tr>
          <td>RI</td>
          <td>2</td>
          <td>0</td>
      </tr>
      <tr>
          <td>exploratory</td>
          <td>3</td>
          <td>DSRM</td>
      </tr>
      <tr>
          <td>새로운 유형:</td>
          <td></td>
          <td></td>
      </tr>
  </tbody>
</table>
<table>
  <thead>
      <tr>
          <th>NetDB Data</th>
          <th>Lookup Type</th>
          <th>Store Type</th>
          <th>Std. LS2 Header?</th>
          <th>Sent end-to-end?</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>LS2</td>
          <td>1</td>
          <td>3</td>
          <td>yes</td>
          <td>yes</td>
      </tr>
      <tr>
          <td>Encrypted LS2</td>
          <td>1</td>
          <td>5</td>
          <td>no</td>
          <td>no</td>
      </tr>
      <tr>
          <td>Meta LS2</td>
          <td>1</td>
          <td>7</td>
          <td>yes</td>
          <td>no</td>
      </tr>
      <tr>
          <td>Service Record</td>
          <td>n/a</td>
          <td>9</td>
          <td>yes</td>
          <td>no</td>
      </tr>
      <tr>
          <td>Service List</td>
          <td>4</td>
          <td>11</td>
          <td>no</td>
          <td>no</td>
      </tr>
  </tbody>
</table>
<h3 id="비목표--범위-외">비목표 / 범위 외</h3>
<ul>
<li>
<p>조회 유형은 현재 데이터베이스 조회 메시지의 비트 3-2에 있습니다.
추가 유형은 비트 4를 사용해야 합니다.</p>
</li>
<li>
<p>모든 저장 유형은 홀수입니다. 데이터베이스 저장 메시지 유형 필드의 상위 비트가 구형 router에 의해 무시되기 때문입니다.
압축된 RI로 파싱이 실패하는 것보다는 LS로 파싱이 실패하는 것을 선호합니다.</p>
</li>
<li>
<p>서명으로 보호되는 데이터에서 타입이 명시적이어야 하는가, 암시적이어야 하는가, 아니면 둘 다 아니어야 하는가?</p>
</li>
</ul>
<h3 id="정당화">정당화</h3>
<p>타입 3, 5, 7은 표준 leaseset 조회(타입 1)에 대한 응답으로 반환될 수 있습니다. 타입 9는 조회에 대한 응답으로 절대 반환되지 않습니다. 타입 11은 새로운 서비스 조회 타입(타입 11)에 대한 응답으로 반환됩니다.</p>
<p>클라이언트 간 Garlic 메시지에서는 타입 3만 전송할 수 있습니다.</p>
<h3 id="netdb-데이터-타입">NetDB 데이터 타입</h3>
<p>타입 3, 7, 9는 모두 공통 형식을 가집니다::</p>
<p>표준 LS2 헤더   - 아래에 정의된 대로</p>
<p>타입별 부분   - 각 부분에서 아래 정의된 대로</p>
<p>표준 LS2 서명:   - 서명 키의 sig type에 의해 암시된 길이</p>
<p>타입 5 (암호화)는 Destination으로 시작하지 않으며 다른 형식을 가집니다. 아래를 참조하세요.</p>
<p>타입 11 (Service List)은 여러 Service Record들의 집합이며 다른 형식을 가집니다. 아래를 참조하세요.</p>
<h3 id="참고사항">참고사항</h3>
<p>TBD</p>
<h2 id="standard-ls2-header">Standard LS2 Header</h2>
<p>타입 3, 7, 9는 아래에 명시된 표준 LS2 헤더를 사용합니다:</p>
<h3 id="조회저장-과정">조회/저장 과정</h3>
<pre tabindex="0"><code>Standard LS2 Header:
  - Type (1 byte)
    Not actually in header, but part of data covered by signature.
    Take from field in Database Store Message.
  - Destination (387+ bytes)
  - Published timestamp (4 bytes, big endian, seconds since epoch, rolls over in 2106)
  - Expires (2 bytes, big endian) (offset from published timestamp in seconds, 18.2 hours max)
  - Flags (2 bytes)
    Bit order: 15 14 ... 3 2 1 0
    Bit 0: If 0, no offline keys; if 1, offline keys
    Bit 1: If 0, a standard published leaseset.
           If 1, an unpublished leaseset. Should not be flooded, published, or
           sent in response to a query. If this leaseset expires, do not query the
           netdb for a new one, unless bit 2 is set.
    Bit 2: If 0, a standard published leaseset.
           If 1, this unencrypted leaseset will be blinded and encrypted when published.
           If this leaseset expires, query the blinded location in the netdb for a new one.
           If this bit is set to 1, set bit 1 to 1 also.
           As of release 0.9.42.
    Bits 3-15: set to 0 for compatibility with future uses
  - If flag indicates offline keys, the offline signature section:
    Expires timestamp (4 bytes, big endian, seconds since epoch, rolls over in 2106)
    Transient sig type (2 bytes, big endian)
    Transient signing public key (length as implied by sig type)
    Signature of expires timestamp, transient sig type, and public key,
    by the destination public key,
    length as implied by destination public key sig type.
    This section can, and should, be generated offline.
</code></pre><h3 id="형식">형식</h3>
<ul>
<li>
<p>Unpublished/published: 데이터베이스 스토어를 종단 간 전송할 때 사용하며, 전송하는 router가 이 leaseSet을 다른 곳으로 보내지 말아야 함을 나타내고자 할 때 사용합니다. 현재 이 상태를 유지하기 위해 휴리스틱을 사용하고 있습니다.</p>
</li>
<li>
<p>Published: leaseset의 &lsquo;버전&rsquo;을 결정하는 데 필요한 복잡한 로직을 대체합니다. 현재 버전은 마지막으로 만료되는 lease의 만료 시간이며, 게시하는 router는 오래된 lease만 제거하는 leaseset을 게시할 때 해당 만료 시간을 최소 1ms씩 증가시켜야 합니다.</p>
</li>
<li>
<p>Expires: netdb 항목의 만료 시간이 마지막으로 만료되는 leaseSet보다 더 이르게 설정될 수 있도록 허용합니다. leaseSet이 최대 11분의 만료 시간을 유지할 것으로 예상되는 LS2에는 유용하지 않을 수 있지만, 다른 새로운 타입들에는 필요합니다 (아래의 Meta LS와 Service Record 참조).</p>
</li>
<li>
<p>오프라인 키는 선택사항이며, 초기/필수 구현 복잡성을 줄이기 위한 것입니다.</p>
</li>
</ul>
<h3 id="개인정보보호보안-고려사항">개인정보보호/보안 고려사항</h3>
<ul>
<li>
<p>타임스탬프 정확도를 더욱 줄일 수 있지만 (10분?) 버전 번호를 추가해야 할 것입니다. 이는 순서 보존 암호화가 없다면 멀티호밍을 깨뜨릴 수 있습니다. 아마도 타임스탬프 없이는 할 수 없을 것입니다.</p>
</li>
<li>
<p>대안: 3바이트 타임스탬프 (epoch / 10분), 1바이트 버전, 2바이트 만료</p>
</li>
<li>
<p>데이터/서명에서 타입이 명시적인가 암시적인가? 서명을 위한 &ldquo;Domain&rdquo; 상수?</p>
</li>
</ul>
<h3 id="notes">Notes</h3>
<ul>
<li>
<p>Router는 초당 한 번 이상 LS를 게시해서는 안 됩니다.
만약 그렇게 한다면, 이전에 게시된 LS보다 게시 타임스탬프를 1씩 인위적으로 증가시켜야 합니다.</p>
</li>
<li>
<p>Router 구현체들은 매번 검증을 피하기 위해 임시 키와 서명을 캐시할 수 있습니다. 특히 floodfill들과 장기간 연결의 양 끝에 있는 router들이 이것으로부터 이익을 얻을 수 있습니다.</p>
</li>
<li>
<p>오프라인 키와 서명은 장기간 지속되는 destination에만 적합합니다.
즉, 클라이언트가 아닌 서버에 사용해야 합니다.</p>
</li>
</ul>
<h2 id="new-databaseentry-types">New DatabaseEntry types</h2>
<h3 id="형식-1">형식</h3>
<p>기존 LeaseSet으로부터의 변경사항:</p>
<ul>
<li>게시된 타임스탬프, 만료 타임스탬프, 플래그, 속성 추가</li>
<li>암호화 유형 추가</li>
<li>해지 키 제거</li>
</ul>
<p>다음으로 조회</p>
<pre><code>Standard LS flag (1)
</code></pre>
<p>저장 위치</p>
<pre><code>Standard LS2 type (3)
</code></pre>
<p>저장 위치</p>
<pre><code>Hash of destination
This hash is then used to generate the daily &quot;routing key&quot;, as in LS1
</code></pre>
<p>일반적인 만료</p>
<pre><code>10 minutes, as in a regular LS.
</code></pre>
<p>게시자</p>
<pre><code>Destination
</code></pre>
<h3 id="정당화-1">정당화</h3>
<pre tabindex="0"><code>Standard LS2 Header as specified above

  Standard LS2 Type-Specific Part
  - Properties (Mapping as specified in common structures spec, 2 zero bytes if none)
  - Number of key sections to follow (1 byte, max TBD)
  - Key sections:
    - Encryption type (2 bytes, big endian)
    - Encryption key length (2 bytes, big endian)
      This is explicit, so floodfills can parse LS2 with unknown encryption types.
    - Encryption key (number of bytes specified)
  - Number of lease2s (1 byte)
  - Lease2s (40 bytes each)
    These are leases, but with a 4-byte instead of an 8-byte expiration,
    seconds since the epoch (rolls over in 2106)

  Standard LS2 Signature:
  - Signature
    If flag indicates offline keys, this is signed by the transient pubkey,
    otherwise, by the destination pubkey
    Length as implied by sig type of signing key
    The signature is of everything above.
</code></pre><h3 id="문제점">문제점</h3>
<ul>
<li>
<p>Properties: 향후 확장 및 유연성을 위해 사용됩니다.
나머지 데이터의 파싱에 필요할 경우를 대비하여 맨 앞에 배치됩니다.</p>
</li>
<li>
<p>여러 암호화 유형/공개 키 쌍은
새로운 암호화 유형으로의 전환을 용이하게 하기 위한 것입니다. 다른 방법은
현재 DSA 및 EdDSA 목적지에 대해 하는 것처럼
동일한 tunnel을 사용하여 여러 leaseSet을 게시하는 것입니다.
tunnel에서 들어오는 암호화 유형의 식별은
기존 세션 태그 메커니즘 및/또는 각 키를 사용한 시행착오 복호화로
수행될 수 있습니다. 들어오는 메시지의 길이도
단서를 제공할 수 있습니다.</p>
</li>
</ul>
<h3 id="참고사항-1">참고사항</h3>
<p>이 제안은 종단 간 암호화 키에 대해 leaseset의 공개 키를 계속 사용하며, 현재와 같이 Destination의 공개 키 필드는 사용하지 않은 채로 둡니다. 암호화 유형은 Destination 키 인증서에 지정되지 않으며, 0으로 유지됩니다.</p>
<p>거부된 대안은 Destination 키 인증서에서 암호화 타입을 지정하고, Destination의 공개 키를 사용하며, leaseset의 공개 키는 사용하지 않는 것입니다. 우리는 이를 수행할 계획이 없습니다.</p>
<p>LS2의 이점:</p>
<ul>
<li>실제 공개 키의 위치는 변경되지 않습니다.</li>
<li>암호화 유형이나 공개 키는 Destination을 변경하지 않고도 변경될 수 있습니다.</li>
<li>사용되지 않는 폐기 필드를 제거합니다</li>
<li>이 제안서의 다른 DatabaseEntry 유형과의 기본 호환성</li>
<li>여러 암호화 유형 허용</li>
</ul>
<p>LS2의 단점:</p>
<ul>
<li>RouterInfo와 공개키 위치 및 암호화 타입이 다름</li>
<li>leaseset에서 사용되지 않는 공개키를 유지함</li>
<li>네트워크 전체에서 구현이 필요함; 대안으로, floodfill에서 허용하는 경우 실험적
암호화 타입을 사용할 수 있음
(하지만 실험적 서명 타입 지원에 관한 관련 제안 136 및 137 참조).
대안 제안은 실험적 암호화 타입에 대해 구현 및 테스트하기 더 쉬울 수 있음.</li>
</ul>
<h3 id="new-encryption-issues">New Encryption Issues</h3>
<p>이 중 일부는 이 제안서의 범위를 벗어나지만, 아직 별도의 암호화 제안서가 없기 때문에 현재로서는 여기에 메모를 남겨둡니다. ECIES 제안서 144번과 145번도 참조하세요.</p>
<ul>
<li>
<p>암호화 유형은 곡선, 키 길이, 그리고 종단 간 방식의 조합을 나타내며,
KDF와 MAC가 있는 경우 이를 포함합니다.</p>
</li>
<li>
<p>우리는 키 길이 필드를 포함했으므로, LS2가 알려지지 않은 암호화 유형에 대해서도 floodfill에 의해 파싱 및 검증 가능합니다.</p>
</li>
<li>
<p>제안될 첫 번째 새로운 암호화 유형은
아마도 ECIES/X25519일 것입니다. 엔드투엔드에서 사용되는 방식
(ElGamal/AES+SessionTag의 약간 수정된 버전이나
ChaCha/Poly와 같은 완전히 새로운 방식)은
하나 이상의 별도 제안서에서 명시될 예정입니다.
ECIES 제안서 144와 145도 참조하세요.</p>
</li>
</ul>
<h3 id="leaseset-2">LeaseSet 2</h3>
<ul>
<li>
<p>lease의 8바이트 만료 시간이 4바이트로 변경됨.</p>
</li>
<li>
<p>만약 우리가 취소 기능을 구현한다면, expires 필드를 0으로 설정하거나,
lease를 0개로 하거나, 또는 둘 다 사용할 수 있습니다. 별도의 취소 키는 필요하지 않습니다.</p>
</li>
<li>
<p>암호화 키는 서버 선호도 순서대로 정렬되며, 가장 선호하는 것이 먼저 나옵니다.
기본 클라이언트 동작은 지원되는 암호화 유형을 가진 첫 번째 키를 선택하는 것입니다. 클라이언트는 암호화 지원, 상대적 성능 및 기타 요소를 기반으로 다른 선택 알고리즘을 사용할 수 있습니다.</p>
</li>
</ul>
<h3 id="형식-2">형식</h3>
<p>목표:</p>
<ul>
<li>블라인딩 추가</li>
<li>여러 서명 유형 허용</li>
<li>새로운 암호화 프리미티브 불필요</li>
<li>각 수신자에게 선택적 암호화, 취소 가능</li>
<li>Standard LS2 및 Meta LS2의 암호화만 지원</li>
</ul>
<p>암호화된 LS2는 종단 간 garlic 메시지로 전송되지 않습니다. 위의 표준 LS2를 사용하세요.</p>
<p>기존 암호화된 LeaseSet에서의 변경사항:</p>
<ul>
<li>보안을 위해 전체를 암호화</li>
<li>AES만으로가 아닌 안전한 암호화 사용</li>
<li>각 수신자에게 개별적으로 암호화</li>
</ul>
<p>다음으로 조회</p>
<pre><code>Standard LS flag (1)
</code></pre>
<p>저장 위치</p>
<pre><code>Encrypted LS2 type (5)
</code></pre>
<p>저장 위치</p>
<pre><code>Hash of blinded sig type and blinded public key
Two byte sig type (big endian, e.g. 0x000b) || blinded public key
This hash is then used to generate the daily &quot;routing key&quot;, as in LS1
</code></pre>
<p>일반적인 만료</p>
<pre><code>10 minutes, as in a regular LS, or hours, as in a meta LS.
</code></pre>
<p>게시자</p>
<pre><code>Destination
</code></pre>
<h3 id="정당화-2">정당화</h3>
<p>암호화된 LS2에 사용되는 암호학적 구성 요소에 해당하는 다음 함수들을 정의합니다:</p>
<p>CSRNG(n)</p>
<pre><code>n-byte output from a cryptographically-secure random number generator.

In addition to the requirement of CSRNG being cryptographically-secure (and thus
suitable for generating key material), it MUST be safe
for some n-byte output to be used for key material when the byte sequences immediately
preceding and following it are exposed on the network (such as in a salt, or encrypted
padding). Implementations that rely on a potentially-untrustworthy source should hash
any output that is to be exposed on the network. See [PRNG references](http://projectbullrun.org/dual-ec/ext-rand.html) and [Tor dev discussion](https://lists.torproject.org/pipermail/tor-dev/2015-November/009954.html).
</code></pre>
<p>H(p, d)</p>
<pre><code>SHA-256 hash function that takes a personalization string p and data d, and
produces an output of length 32 bytes.

Use SHA-256 as follows::

    H(p, d) := SHA-256(p || d)
</code></pre>
<p>STREAM</p>
<pre><code>The ChaCha20 stream cipher as specified in [RFC 7539 Section 2.4](https://tools.ietf.org/html/rfc7539#section-2.4), with the initial counter
set to 1. S_KEY_LEN = 32 and S_IV_LEN = 12.

ENCRYPT(k, iv, plaintext)
    Encrypts plaintext using the cipher key k, and nonce iv which MUST be unique for
    the key k. Returns a ciphertext that is the same size as the plaintext.

    The entire ciphertext must be indistinguishable from random if the key is secret.

DECRYPT(k, iv, ciphertext)
    Decrypts ciphertext using the cipher key k, and nonce iv. Returns the plaintext.
</code></pre>
<p>SIG</p>
<pre><code>The RedDSA signature scheme (corresponding to SigType 11) with key blinding.
It has the following functions:

DERIVE_PUBLIC(privkey)
    Returns the public key corresponding to the given private key.

SIGN(privkey, m)
    Returns a signature by the private key privkey over the given message m.

VERIFY(pubkey, m, sig)
    Verifies the signature sig against the public key pubkey and message m. Returns
    true if the signature is valid, false otherwise.

It must also support the following key blinding operations:

GENERATE_ALPHA(data, secret)
    Generate alpha for those who know the data and an optional secret.
    The result must be identically distributed as the private keys.

BLIND_PRIVKEY(privkey, alpha)
    Blinds a private key, using a secret alpha.

BLIND_PUBKEY(pubkey, alpha)
    Blinds a public key, using a secret alpha.
    For a given keypair (privkey, pubkey) the following relationship holds::

        BLIND_PUBKEY(pubkey, alpha) ==
        DERIVE_PUBLIC(BLIND_PRIVKEY(privkey, alpha))
</code></pre>
<p>DH</p>
<pre><code>X25519 public key agreement system. Private keys of 32 bytes, public keys of 32
bytes, produces outputs of 32 bytes. It has the following
functions:

GENERATE_PRIVATE()
    Generates a new private key.

DERIVE_PUBLIC(privkey)
    Returns the public key corresponding to the given private key.

DH(privkey, pubkey)
    Generates a shared secret from the given private and public keys.
</code></pre>
<p>HKDF(salt, ikm, info, n)</p>
<pre><code>A cryptographic key derivation function which takes some input key material ikm (which
should have good entropy but is not required to be a uniformly random string), a salt
of length 32 bytes, and a context-specific 'info' value, and produces an output
of n bytes suitable for use as key material.

Use HKDF as specified in [RFC 5869](https://tools.ietf.org/html/rfc5869), using the HMAC hash function SHA-256
as specified in [RFC 2104](https://tools.ietf.org/html/rfc2104). This means that SALT_LEN is 32 bytes max.
</code></pre>
<h3 id="토론">토론</h3>
<p>암호화된 LS2 형식은 세 개의 중첩된 계층으로 구성됩니다:</p>
<ul>
<li>저장 및 검색에 필요한 평문 정보를 포함하는 외부 계층.</li>
<li>클라이언트 인증을 처리하는 중간 계층.</li>
<li>실제 LS2 데이터를 포함하는 내부 계층.</li>
</ul>
<p>전체 형식은 다음과 같습니다::</p>
<pre><code>Layer 0 data + Enc(layer 1 data + Enc(layer 2 data)) + Signature
</code></pre>
<p>암호화된 LS2는 블라인드 처리됩니다. Destination은 헤더에 포함되지 않습니다. DHT 저장 위치는 SHA-256(sig type || blinded public key)이며, 매일 순환됩니다.</p>
<p>위에서 지정된 표준 LS2 헤더를 사용하지 않습니다.</p>
<h4 id="layer-0-outer">Layer 0 (outer)</h4>
<p>유형</p>
<pre><code>1 byte

Not actually in header, but part of data covered by signature.
Take from field in Database Store Message.
</code></pre>
<p>Blinded Public Key 서명 유형</p>
<pre><code>2 bytes, big endian
This will always be type 11, identifying a Red25519 blinded key.
</code></pre>
<p>블라인드 공개 키</p>
<pre><code>Length as implied by sig type
</code></pre>
<p>게시 타임스탬프</p>
<pre><code>4 bytes, big endian

Seconds since epoch, rolls over in 2106
</code></pre>
<p>만료</p>
<pre><code>2 bytes, big endian

Offset from published timestamp in seconds, 18.2 hours max
</code></pre>
<p>플래그</p>
<pre><code>2 bytes

Bit order: 15 14 ... 3 2 1 0

Bit 0: If 0, no offline keys; if 1, offline keys

Other bits: set to 0 for compatibility with future uses
</code></pre>
<p>임시 키 데이터</p>
<pre><code>Present if flag indicates offline keys

Expires timestamp
    4 bytes, big endian

    Seconds since epoch, rolls over in 2106

Transient sig type
    2 bytes, big endian

Transient signing public key
    Length as implied by sig type

Signature
    Length as implied by blinded public key sig type

    Over expires timestamp, transient sig type, and transient public key.

    Verified with the blinded public key.
</code></pre>
<p>lenOuterCiphertext</p>
<pre><code>2 bytes, big endian
</code></pre>
<p>outerCiphertext</p>
<pre><code>lenOuterCiphertext bytes

Encrypted layer 1 data. See below for key derivation and encryption algorithms.
</code></pre>
<p>서명</p>
<pre><code>Length as implied by sig type of the signing key used

The signature is of everything above.

If the flag indicates offline keys, the signature is verified with the transient
public key. Otherwise, the signature is verified with the blinded public key.
</code></pre>
<h4 id="layer-1-middle">Layer 1 (middle)</h4>
<p>플래그</p>
<pre><code>1 byte

Bit order: 76543210

Bit 0: 0 for everybody, 1 for per-client, auth section to follow

Bits 3-1: Authentication scheme, only if bit 0 is set to 1 for per-client, otherwise 000
          000: DH client authentication (or no per-client authentication)
          001: PSK client authentication

Bits 7-4: Unused, set to 0 for future compatibility
</code></pre>
<p>DH 클라이언트 인증 데이터</p>
<pre><code>Present if flag bit 0 is set to 1 and flag bits 3-1 are set to 000.

ephemeralPublicKey
    32 bytes

clients
    2 bytes, big endian

    Number of authClient entries to follow, 40 bytes each

authClient
    Authorization data for a single client.
    See below for the per-client authorization algorithm.

    clientID_i
        8 bytes

    clientCookie_i
        32 bytes
</code></pre>
<p>PSK 클라이언트 인증 데이터</p>
<pre><code>Present if flag bit 0 is set to 1 and flag bits 3-1 are set to 001.

authSalt
    32 bytes

clients
    2 bytes, big endian

    Number of authClient entries to follow, 40 bytes each

authClient
    Authorization data for a single client.
    See below for the per-client authorization algorithm.

    clientID_i
        8 bytes

    clientCookie_i
        32 bytes
</code></pre>
<p>innerCiphertext</p>
<pre><code>Length implied by lenOuterCiphertext (whatever data remains)

Encrypted layer 2 data. See below for key derivation and encryption algorithms.
</code></pre>
<h4 id="layer-2-inner">Layer 2 (inner)</h4>
<p>유형</p>
<pre><code>1 byte

Either 3 (LS2) or 7 (Meta LS2)
</code></pre>
<p>데이터</p>
<pre><code>LeaseSet2 data for the given type.

Includes the header and signature.
</code></pre>
<h3 id="새로운-암호화-문제">새로운 암호화 문제</h3>
<p>다음은 Ed25519와 <a href="https://github.com/zcash/zips/tree/master/protocol/protocol.pdf">ZCash RedDSA</a>
를 기반으로 한 키 블라인딩 방식입니다. Re25519 서명은 Ed25519 곡선을 사용하며, 해시에는 SHA-512를 사용합니다.</p>
<p><a href="https://spec.torproject.org/rend-spec-v3">Tor의 rend-spec-v3.txt 부록 A.2</a>
는 유사한 설계 목표를 가지고 있지만, 우리는 이를 사용하지 않습니다. 이는 해당 방식의 블라인드 공개 키가 소수 차수 부분군(prime-order subgroup)에서 벗어날 수 있으며, 이로 인한 보안상의 영향이 불분명하기 때문입니다.</p>
<h4 id="goals-1">Goals</h4>
<ul>
<li>블라인드되지 않은 목적지의 서명 공개 키는
Ed25519 (sig type 7) 또는 Red25519 (sig type 11)이어야 함;
다른 sig type은 지원되지 않음</li>
<li>서명 공개 키가 오프라인인 경우, 임시 서명 공개 키도 Ed25519여야 함</li>
<li>블라인딩은 계산상 단순함</li>
<li>기존 암호화 기본 요소 사용</li>
<li>블라인드된 공개 키는 블라인드 해제될 수 없음</li>
<li>블라인드된 공개 키는 Ed25519 곡선과 소수 차수 부분군에 있어야 함</li>
<li>블라인드된 공개 키를 도출하기 위해 목적지의 서명 공개 키를
알아야 함 (전체 목적지는 필요하지 않음)</li>
<li>선택적으로 블라인드된 공개 키를 도출하는 데 필요한 추가 비밀 제공</li>
</ul>
<h4 id="security">Security</h4>
<p>블라인딩 방식의 보안성을 위해서는 alpha의 분포가 블라인드되지 않은 개인 키와 동일해야 합니다. 그러나 Ed25519 개인 키(sig type 7)를 Red25519 개인 키(sig type 11)로 블라인드할 때 분포가 달라집니다. <a href="https://github.com/zcash/zips/tree/master/protocol/protocol.pdf">zcash section 4.1.6.1</a>
의 요구사항을 충족하기 위해, Red25519(sig type 11)를 블라인드되지 않은 키에도 사용해야 &ldquo;재무작위화된 공개 키와 해당 키 하에서의 서명이 재무작위화된 원래 키를 노출하지 않도록&rdquo; 할 수 있습니다. 기존 destination에 대해서는 type 7을 허용하지만, 암호화될 새로운 destination에 대해서는 type 11을 권장합니다.</p>
<h4 id="definitions">Definitions</h4>
<p>B</p>
<pre><code>The Ed25519 base point (generator) 2^255 - 19 as in [Ed25519](http://cr.yp.to/papers.html#ed25519)
</code></pre>
<p>L</p>
<pre><code>The Ed25519 order 2^252 + 27742317777372353535851937790883648493
as in [Ed25519](http://cr.yp.to/papers.html#ed25519)
</code></pre>
<p>DERIVE_PUBLIC(a)</p>
<pre><code>Convert a private key to public, as in Ed25519 (mulitply by G)
</code></pre>
<p>알파</p>
<pre><code>A 32-byte random number known to those who know the destination.
</code></pre>
<p>GENERATE_ALPHA(destination, date, secret)</p>
<pre><code>Generate alpha for the current date, for those who know the destination and the secret.
The result must be identically distributed as Ed25519 private keys.
</code></pre>
<p>a</p>
<pre><code>The unblinded 32-byte EdDSA or RedDSA signing private key used to sign the destination
</code></pre>
<p>A</p>
<pre><code>The unblinded 32-byte EdDSA or RedDSA signing public key in the destination,
= DERIVE_PUBLIC(a), as in Ed25519
</code></pre>
<p>a&rsquo;</p>
<pre><code>The blinded 32-byte EdDSA signing private key used to sign the encrypted leaseset
This is a valid EdDSA private key.
</code></pre>
<p>A'</p>
<pre><code>The blinded 32-byte EdDSA signing public key in the Destination,
may be generated with DERIVE_PUBLIC(a'), or from A and alpha.
This is a valid EdDSA public key, on the curve and on the prime-order subgroup.
</code></pre>
<p>LEOS2IP(x)</p>
<pre><code>Flip the order of the input bytes to little-endian
</code></pre>
<p>H*(x)</p>
<pre><code>32 bytes = (LEOS2IP(SHA512(x))) mod B, same as in Ed25519 hash-and-reduce
</code></pre>
<h4 id="blinding-calculations">Blinding Calculations</h4>
<p>새로운 비밀 알파와 블라인드 키들은 매일 (UTC) 생성되어야 합니다. 비밀 알파와 블라인드 키들은 다음과 같이 계산됩니다.</p>
<p>GENERATE_ALPHA(destination, date, secret), 모든 당사자에 대해:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>// GENERATE_ALPHA(destination, date, secret)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  // secret is optional, else zero-length
</span></span><span style="display:flex;"><span>  A = destination&#39;s signing public key
</span></span><span style="display:flex;"><span>  stA = signature type of A, 2 bytes big endian (0x0007 or 0x000b)
</span></span><span style="display:flex;"><span>  stA&#39; = signature type of blinded public key A&#39;, 2 bytes big endian (0x000b)
</span></span><span style="display:flex;"><span>  keydata = A || stA || stA&#39;
</span></span><span style="display:flex;"><span>  datestring = 8 bytes ASCII YYYYMMDD from the current date UTC
</span></span><span style="display:flex;"><span>  secret = UTF-8 encoded string
</span></span><span style="display:flex;"><span>  seed = HKDF(H(&#34;I2PGenerateAlpha&#34;, keydata), datestring || secret, &#34;i2pblinding1&#34;, 64)
</span></span><span style="display:flex;"><span>  // treat seed as a 64 byte little-endian value
</span></span><span style="display:flex;"><span>  alpha = seed mod L
</span></span></code></pre></div><p>BLIND_PRIVKEY(), leaseset을 게시하는 소유자용:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>// BLIND_PRIVKEY()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  alpha = GENERATE_ALPHA(destination, date, secret)
</span></span><span style="display:flex;"><span>  // If for a Ed25519 private key (type 7)
</span></span><span style="display:flex;"><span>  seed = destination&#39;s signing private key
</span></span><span style="display:flex;"><span>  a = left half of SHA512(seed) and clamped as usual for Ed25519
</span></span><span style="display:flex;"><span>  // else, for a Red25519 private key (type 11)
</span></span><span style="display:flex;"><span>  a = destination&#39;s signing private key
</span></span><span style="display:flex;"><span>  // Addition using scalar arithmentic
</span></span><span style="display:flex;"><span>  blinded signing private key = a&#39; = BLIND_PRIVKEY(a, alpha) = (a + alpha) mod L
</span></span><span style="display:flex;"><span>  blinded signing public key = A&#39; = DERIVE_PUBLIC(a&#39;)
</span></span></code></pre></div><p>BLIND_PUBKEY(), leaseset을 검색하는 클라이언트들을 위해:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>// BLIND_PUBKEY()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  alpha = GENERATE_ALPHA(destination, date, secret)
</span></span><span style="display:flex;"><span>  A = destination&#39;s signing public key
</span></span><span style="display:flex;"><span>  // Addition using group elements (points on the curve)
</span></span><span style="display:flex;"><span>  blinded public key = A&#39; = BLIND_PUBKEY(A, alpha) = A + DERIVE_PUBLIC(alpha)
</span></span></code></pre></div><p>두 방법으로 계산한 A&rsquo; 값은 요구사항에 따라 동일한 결과를 산출합니다.</p>
<h4 id="signing">Signing</h4>
<p>블라인딩되지 않은 leaseSet은 평소와 같이 블라인딩되지 않은 Ed25519 또는 Red25519 서명 개인키로 서명되고, 블라인딩되지 않은 Ed25519 또는 Red25519 서명 공개키(sig 유형 7 또는 11)로 검증됩니다.</p>
<p>서명 공개 키가 오프라인 상태인 경우, unblinded leaseset은 unblinded transient Ed25519 또는 Red25519 서명 개인 키로 서명되고 일반적인 방식대로 unblinded Ed25519 또는 Red25519 transient 서명 공개 키(sig types 7 또는 11)로 검증됩니다. 암호화된 leaseset의 오프라인 키에 대한 추가 참고사항은 아래를 참조하십시오.</p>
<p>암호화된 leaseSet의 서명을 위해 우리는 블라인드 키로 서명하고 검증하기 위한 <a href="https://github.com/zcash/zips/tree/master/protocol/protocol.pdf">RedDSA</a>
 기반의 Red25519를 사용합니다. Red25519 서명은 해시를 위해 SHA-512를 사용하여 Ed25519 곡선 위에서 동작합니다.</p>
<p>Red25519는 아래에 명시된 사항을 제외하고는 표준 Ed25519와 동일합니다.</p>
<h4 id="signverify-calculations">Sign/Verify Calculations</h4>
<p>암호화된 leaseset의 외부 부분은 Red25519 키와 서명을 사용합니다.</p>
<p>Red25519는 Ed25519와 거의 동일합니다. 두 가지 차이점이 있습니다:</p>
<p>Red25519 개인키는 난수에서 생성된 후 위에서 정의된 L로 모듈로 축소되어야 합니다. Ed25519 개인키는 난수에서 생성된 후 바이트 0과 31에 비트 마스킹을 사용하여 &ldquo;클램핑&quot;됩니다. 이는 Red25519에서는 수행되지 않습니다. 위에서 정의된 GENERATE_ALPHA() 및 BLIND_PRIVKEY() 함수는 mod L을 사용하여 적절한 Red25519 개인키를 생성합니다.</p>
<p>Red25519에서 서명을 위한 r 계산은 추가적인 랜덤 데이터를 사용하며, 개인 키의 해시가 아닌 공개 키 값을 사용합니다. 랜덤 데이터로 인해 동일한 키로 동일한 데이터에 서명하더라도 모든 Red25519 서명은 서로 다릅니다.</p>
<p>서명:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>T = 80 random bytes
</span></span><span style="display:flex;"><span>  r = H*(T || publickey || message)
</span></span><span style="display:flex;"><span>  // rest is the same as in Ed25519
</span></span></code></pre></div><p>검증:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>// same as in Ed25519
</span></span></code></pre></div><h3 id="참고사항-2">참고사항</h3>
<h4 id="derivation-of-subcredentials">Derivation of subcredentials</h4>
<p>블라인딩 과정의 일환으로, 암호화된 LS2가 해당 Destination의 서명 공개 키를 알고 있는 사람만 복호화할 수 있도록 보장해야 합니다. 전체 Destination은 필요하지 않습니다. 이를 위해 서명 공개 키에서 credential을 파생시킵니다:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>A = destination&#39;s signing public key
</span></span><span style="display:flex;"><span>  stA = signature type of A, 2 bytes big endian (0x0007 or 0x000b)
</span></span><span style="display:flex;"><span>  stA&#39; = signature type of A&#39;, 2 bytes big endian (0x000b)
</span></span><span style="display:flex;"><span>  keydata = A || stA || stA&#39;
</span></span><span style="display:flex;"><span>  credential = H(&#34;credential&#34;, keydata)
</span></span></code></pre></div><p>개인화 문자열은 자격 증명이 평범한 Destination 해시와 같은 DHT 조회 키로 사용되는 어떤 해시와도 충돌하지 않도록 보장합니다.</p>
<p>주어진 블라인드 키에 대해, 우리는 서브크리덴셜을 도출할 수 있습니다:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>subcredential = H(&#34;subcredential&#34;, credential || blindedPublicKey)
</span></span></code></pre></div><p>subcredential은 아래의 키 유도 과정에 포함되며, 이는 해당 키들을 Destination의 서명 공개 키에 대한 지식에 바인딩합니다.</p>
<h4 id="layer-1-encryption">Layer 1 encryption</h4>
<p>먼저, 키 유도 프로세스의 입력이 준비됩니다:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>outerInput = subcredential || publishedTimestamp
</span></span></code></pre></div><p>다음으로, 무작위 솔트(salt)가 생성됩니다:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>outerSalt = CSRNG(32)
</span></span></code></pre></div><p>그런 다음 레이어 1을 암호화하는 데 사용되는 키가 도출됩니다:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>keys = HKDF(outerSalt, outerInput, &#34;ELS2_L1K&#34;, 44)
</span></span><span style="display:flex;"><span>  outerKey = keys[0:31]
</span></span><span style="display:flex;"><span>  outerIV = keys[32:43]
</span></span></code></pre></div><p>마지막으로, 레이어 1 평문이 암호화되고 직렬화됩니다:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>outerCiphertext = outerSalt || ENCRYPT(outerKey, outerIV, outerPlaintext)
</span></span></code></pre></div><h4 id="layer-1-decryption">Layer 1 decryption</h4>
<p>salt는 레이어 1 암호문에서 파싱됩니다:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>outerSalt = outerCiphertext[0:31]
</span></span></code></pre></div><p>그런 다음 레이어 1을 암호화하는 데 사용되는 키가 도출됩니다:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>outerInput = subcredential || publishedTimestamp
</span></span><span style="display:flex;"><span>  keys = HKDF(outerSalt, outerInput, &#34;ELS2_L1K&#34;, 44)
</span></span><span style="display:flex;"><span>  outerKey = keys[0:31]
</span></span><span style="display:flex;"><span>  outerIV = keys[32:43]
</span></span></code></pre></div><p>마지막으로, 레이어 1 암호문이 복호화됩니다:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>outerPlaintext = DECRYPT(outerKey, outerIV, outerCiphertext[32:end])
</span></span></code></pre></div><h4 id="layer-2-encryption">Layer 2 encryption</h4>
<p>클라이언트 인증이 활성화된 경우, <code>authCookie</code>는 아래 설명된 대로 계산됩니다. 클라이언트 인증이 비활성화된 경우, <code>authCookie</code>는 길이가 0인 바이트 배열입니다.</p>
<p>암호화는 레이어 1과 유사한 방식으로 진행됩니다:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>innerInput = authCookie || subcredential || publishedTimestamp
</span></span><span style="display:flex;"><span>  innerSalt = CSRNG(32)
</span></span><span style="display:flex;"><span>  keys = HKDF(innerSalt, innerInput, &#34;ELS2_L2K&#34;, 44)
</span></span><span style="display:flex;"><span>  innerKey = keys[0:31]
</span></span><span style="display:flex;"><span>  innerIV = keys[32:43]
</span></span><span style="display:flex;"><span>  innerCiphertext = innerSalt || ENCRYPT(innerKey, innerIV, innerPlaintext)
</span></span></code></pre></div><h4 id="layer-2-decryption">Layer 2 decryption</h4>
<p>클라이언트 인증이 활성화된 경우, <code>authCookie</code>는 아래에 설명된 대로 계산됩니다. 클라이언트 인증이 비활성화된 경우, <code>authCookie</code>는 길이가 0인 바이트 배열입니다.</p>
<p>복호화는 레이어 1과 유사한 방식으로 진행됩니다:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>innerInput = authCookie || subcredential || publishedTimestamp
</span></span><span style="display:flex;"><span>  innerSalt = innerCiphertext[0:31]
</span></span><span style="display:flex;"><span>  keys = HKDF(innerSalt, innerInput, &#34;ELS2_L2K&#34;, 44)
</span></span><span style="display:flex;"><span>  innerKey = keys[0:31]
</span></span><span style="display:flex;"><span>  innerIV = keys[32:43]
</span></span><span style="display:flex;"><span>  innerPlaintext = DECRYPT(innerKey, innerIV, innerCiphertext[32:end])
</span></span></code></pre></div><h3 id="암호화된-ls2">암호화된 LS2</h3>
<p>Destination에 대해 클라이언트 인증이 활성화되면, 서버는 암호화된 LS2 데이터를 복호화할 수 있도록 승인하는 클라이언트들의 목록을 유지합니다. 클라이언트별로 저장되는 데이터는 인증 메커니즘에 따라 달라지며, 각 클라이언트가 생성하여 보안이 확보된 대역 외 메커니즘을 통해 서버에 전송하는 어떤 형태의 키 자료를 포함합니다.</p>
<p>클라이언트별 인증을 구현하는 두 가지 대안이 있습니다:</p>
<h4 id="dh-client-authorization">DH client authorization</h4>
<p>각 클라이언트는 DH 키쌍 <code>[csk_i, cpk_i]</code>를 생성하고, 공개키 <code>cpk_i</code>를 서버에 전송합니다.</p>
<p>서버 처리
^^^^^^^^^^^^^^^^^</p>
<p>서버는 새로운 <code>authCookie</code>와 임시 DH 키페어를 생성합니다:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>authCookie = CSRNG(32)
</span></span><span style="display:flex;"><span>  esk = GENERATE_PRIVATE()
</span></span><span style="display:flex;"><span>  epk = DERIVE_PUBLIC(esk)
</span></span></code></pre></div><p>그런 다음 각 인증된 클라이언트에 대해 서버는 <code>authCookie</code>를 해당 공개 키로 암호화합니다:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>sharedSecret = DH(esk, cpk_i)
</span></span><span style="display:flex;"><span>  authInput = sharedSecret || cpk_i || subcredential || publishedTimestamp
</span></span><span style="display:flex;"><span>  okm = HKDF(epk, authInput, &#34;ELS2_XCA&#34;, 52)
</span></span><span style="display:flex;"><span>  clientKey_i = okm[0:31]
</span></span><span style="display:flex;"><span>  clientIV_i = okm[32:43]
</span></span><span style="display:flex;"><span>  clientID_i = okm[44:51]
</span></span><span style="display:flex;"><span>  clientCookie_i = ENCRYPT(clientKey_i, clientIV_i, authCookie)
</span></span></code></pre></div><p>서버는 각 <code>[clientID_i, clientCookie_i]</code> 튜플을 <code>epk</code>와 함께 암호화된 LS2의 레이어 1에 배치합니다.</p>
<p>클라이언트 처리
^^^^^^^^^^^^^^^^^</p>
<p>클라이언트는 자신의 개인 키를 사용하여 예상되는 클라이언트 식별자 <code>clientID_i</code>, 암호화 키 <code>clientKey_i</code>, 그리고 암호화 IV <code>clientIV_i</code>를 도출합니다:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>sharedSecret = DH(csk_i, epk)
</span></span><span style="display:flex;"><span>  authInput = sharedSecret || cpk_i || subcredential || publishedTimestamp
</span></span><span style="display:flex;"><span>  okm = HKDF(epk, authInput, &#34;ELS2_XCA&#34;, 52)
</span></span><span style="display:flex;"><span>  clientKey_i = okm[0:31]
</span></span><span style="display:flex;"><span>  clientIV_i = okm[32:43]
</span></span><span style="display:flex;"><span>  clientID_i = okm[44:51]
</span></span></code></pre></div><p>그런 다음 클라이언트는 레이어 1 인증 데이터에서 <code>clientID_i</code>를 포함하는 항목을 검색합니다. 일치하는 항목이 존재하면, 클라이언트는 이를 복호화하여 <code>authCookie</code>를 얻습니다:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>authCookie = DECRYPT(clientKey_i, clientIV_i, clientCookie_i)
</span></span></code></pre></div><h4 id="pre-shared-key-client-authorization">Pre-shared key client authorization</h4>
<p>각 클라이언트는 32바이트 비밀 키 <code>psk_i</code>를 생성하고 이를 서버에 전송합니다. 또는 서버가 비밀 키를 생성하여 하나 이상의 클라이언트에게 전송할 수도 있습니다.</p>
<p>서버 처리
^^^^^^^^^^^^^^^^^</p>
<p>서버는 새로운 <code>authCookie</code>와 salt를 생성합니다:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>authCookie = CSRNG(32)
</span></span><span style="display:flex;"><span>  authSalt = CSRNG(32)
</span></span></code></pre></div><p>그런 다음 인증된 각 클라이언트에 대해, 서버는 <code>authCookie</code>를 해당 클라이언트의 사전 공유 키로 암호화합니다:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>authInput = psk_i || subcredential || publishedTimestamp
</span></span><span style="display:flex;"><span>  okm = HKDF(authSalt, authInput, &#34;ELS2PSKA&#34;, 52)
</span></span><span style="display:flex;"><span>  clientKey_i = okm[0:31]
</span></span><span style="display:flex;"><span>  clientIV_i = okm[32:43]
</span></span><span style="display:flex;"><span>  clientID_i = okm[44:51]
</span></span><span style="display:flex;"><span>  clientCookie_i = ENCRYPT(clientKey_i, clientIV_i, authCookie)
</span></span></code></pre></div><p>서버는 각 <code>[clientID_i, clientCookie_i]</code> 튜플을 <code>authSalt</code>와 함께 암호화된 LS2의 레이어 1에 배치합니다.</p>
<p>클라이언트 처리
^^^^^^^^^^^^^^^^^</p>
<p>클라이언트는 사전 공유 키를 사용하여 예상되는 클라이언트 식별자 <code>clientID_i</code>, 암호화 키 <code>clientKey_i</code>, 그리고 암호화 IV <code>clientIV_i</code>를 도출합니다:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>authInput = psk_i || subcredential || publishedTimestamp
</span></span><span style="display:flex;"><span>  okm = HKDF(authSalt, authInput, &#34;ELS2PSKA&#34;, 52)
</span></span><span style="display:flex;"><span>  clientKey_i = okm[0:31]
</span></span><span style="display:flex;"><span>  clientIV_i = okm[32:43]
</span></span><span style="display:flex;"><span>  clientID_i = okm[44:51]
</span></span></code></pre></div><p>그러면 클라이언트는 <code>clientID_i</code>를 포함하는 항목에 대해 레이어 1 인증 데이터를 검색합니다. 일치하는 항목이 존재하면 클라이언트는 이를 복호화하여 <code>authCookie</code>를 얻습니다:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>authCookie = DECRYPT(clientKey_i, clientIV_i, clientCookie_i)
</span></span></code></pre></div><h4 id="security-considerations">Security considerations</h4>
<p>위의 두 클라이언트 인증 메커니즘 모두 클라이언트 멤버십에 대한 프라이버시를 제공합니다. Destination만 알고 있는 엔티티는 언제든지 구독 중인 클라이언트 수를 볼 수 있지만, 어떤 클라이언트가 추가되거나 해지되고 있는지는 추적할 수 없습니다.</p>
<p>서버는 암호화된 LS2를 생성할 때마다 클라이언트 순서를 무작위화해야 하며(SHOULD), 이는 클라이언트가 목록에서 자신의 위치를 알아내어 다른 클라이언트가 추가되거나 취소된 시점을 추론하는 것을 방지하기 위함입니다.</p>
<p>서버는 인증 데이터 목록에 임의의 항목을 삽입하여 구독한 클라이언트 수를 숨기는 것을 선택할 수 있습니다.</p>
<p>DH 클라이언트 인증의 장점
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</p>
<ul>
<li>이 방식의 보안은 클라이언트 키 자료의 대역 외 교환에만 의존하지 않습니다. 클라이언트의 개인 키는 해당 장치를 떠날 필요가 없으므로, 대역 외 교환을 가로챌 수 있지만 DH 알고리즘을 깰 수 없는 공격자는 암호화된 LS2를 복호화하거나 클라이언트에게 부여된 접근 시간을 알아낼 수 없습니다.</li>
</ul>
<p>DH 클라이언트 인증의 단점
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</p>
<ul>
<li>N명의 클라이언트에 대해 서버 측에서 N + 1번의 DH 연산이 필요합니다.</li>
<li>클라이언트 측에서 1번의 DH 연산이 필요합니다.</li>
<li>클라이언트가 비밀 키를 생성해야 합니다.</li>
</ul>
<p>PSK 클라이언트 인증의 장점 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ - DH 연산이 필요하지 않습니다. - 서버가 비밀 키를 생성할 수 있습니다. - 원한다면 서버가 여러 클라이언트와 동일한 키를 공유할 수 있습니다.</p>
<p>PSK 클라이언트 인증의 단점
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</p>
<ul>
<li>이 방식의 보안은 클라이언트 키 자료의 대역 외 교환에 결정적으로 의존합니다. 특정 클라이언트에 대한 교환을 가로챈 공격자는 해당 클라이언트가 인증된 모든 후속 암호화된 LS2를 해독할 수 있으며, 클라이언트의 액세스가 언제 취소되는지도 파악할 수 있습니다.</li>
</ul>
<h3 id="정의">정의</h3>
<p>제안서 149를 참조하세요.</p>
<p>비트토렌트에서는 암호화된 LS2를 사용할 수 없습니다. 32바이트인 컴팩트 announce 응답 때문입니다. 이 32바이트에는 해시만 포함되어 있습니다. leaseset이 암호화되어 있다는 표시나 서명 유형을 위한 공간이 없습니다.</p>
<h3 id="형식-3">형식</h3>
<p>오프라인 키를 사용하는 암호화된 leaseSet의 경우, blinded 개인 키도 오프라인에서 생성되어야 하며, 매일 하나씩 생성해야 합니다.</p>
<p>암호화된 leaseset의 평문 부분에 선택적 오프라인 서명 블록이 있기 때문에, floodfill을 스크래핑하는 누구든지 이를 사용하여 며칠에 걸쳐 leaseset을 추적할 수 있습니다(하지만 복호화는 할 수 없음). 이를 방지하기 위해 키 소유자는 매일 새로운 임시 키도 생성해야 합니다. 임시 키와 블라인드 키 모두 미리 생성할 수 있으며, 일괄적으로 router에 전달할 수 있습니다.</p>
<p>이 제안서에서는 여러 개의 transient key와 blinded key를 패키징하여 클라이언트나 router에 제공하기 위한 파일 형식이 정의되지 않았습니다. 또한 이 제안서에서는 오프라인 키를 사용한 암호화된 leaseSet을 지원하기 위한 I2CP 프로토콜 확장도 정의되지 않았습니다.</p>
<h3 id="notes-1">Notes</h3>
<ul>
<li>
<p>암호화된 leaseSet을 사용하는 서비스는 암호화된 버전을 floodfill에 게시합니다. 하지만 효율성을 위해, 인증된 후에는 (예: 화이트리스트를 통해) 래핑된 garlic 메시지에서 클라이언트에게 암호화되지 않은 leaseSet을 전송합니다.</p>
</li>
<li>
<p>Floodfill은 남용을 방지하기 위해 최대 크기를 합리적인 값으로 제한할 수 있습니다.</p>
</li>
<li>
<p>복호화 후에는 내부 타임스탬프와 만료 시간이 최상위 레벨의 것과 일치하는지 등 여러 검사를 수행해야 합니다.</p>
</li>
<li>
<p>ChaCha20이 AES 대신 선택되었습니다. AES 하드웨어 지원이 가능한 경우 속도는 비슷하지만, 저사양 ARM 기기와 같이 AES 하드웨어 지원이 없는 경우 ChaCha20이 2.5-3배 더 빠릅니다.</p>
</li>
<li>
<p>우리는 키 기반 BLAKE2b를 사용할 만큼 속도에 신경 쓰지 않습니다. BLAKE2b는 우리가 필요로 하는 가장 큰 n을 수용할 수 있을 만큼 충분히 큰 출력 크기를 가지고 있습니다 (또는 카운터 인수와 함께 원하는 키마다 한 번씩 호출할 수 있습니다). BLAKE2b는 SHA-256보다 훨씬 빠르며, 키 기반 BLAKE2b는 해시 함수 호출의 총 수를 줄일 수 있습니다.
하지만 제안 148을 참조하세요. 여기서는 다른 이유로 BLAKE2b로 전환할 것을 제안하고 있습니다.
<a href="https://www.lvh.io/posts/secure-key-derivation-performance.html">Secure key derivation performance</a>
를 참조하세요.</p>
</li>
</ul>
<h3 id="meta-ls2">Meta LS2</h3>
<p>이는 멀티호밍을 대체하는 데 사용됩니다. 다른 leaseSet과 마찬가지로 이는 생성자에 의해 서명됩니다. 이는 목적지 해시의 인증된 목록입니다.</p>
<p>Meta LS2는 트리 구조의 최상위 노드이며, 경우에 따라서는 중간 노드이기도 합니다. 이는 여러 개의 항목을 포함하고 있으며, 각 항목은 대규모 멀티호밍을 지원하기 위해 LS, LS2, 또는 다른 Meta LS2를 가리킵니다. Meta LS2는 LS, LS2, 그리고 Meta LS2 항목들을 혼합해서 포함할 수 있습니다. 트리의 잎 노드는 항상 LS 또는 LS2입니다. 이 트리는 DAG(방향성 비순환 그래프)이며, 루프는 금지되어 있습니다. 검색을 수행하는 클라이언트는 반드시 루프를 감지하고 루프를 따라가기를 거부해야 합니다.</p>
<p>Meta LS2는 표준 LS 또는 LS2보다 훨씬 긴 만료 시간을 가질 수 있습니다. 최상위 레벨은 발행 날짜로부터 몇 시간 후에 만료될 수 있습니다. 최대 만료 시간은 floodfill과 클라이언트에 의해 강제되며, 이는 미정입니다.</p>
<p>Meta LS2의 사용 사례는 대규모 멀티호밍이지만, 라우터와 leaseSet 간의 상관관계에 대한 보호(라우터 재시작 시)는 현재 LS 또는 LS2로 제공되는 것 이상은 없습니다. 이는 상관관계 보호가 필요하지 않을 수도 있는 &ldquo;facebook&rdquo; 사용 사례와 동등합니다. 이 사용 사례는 오프라인 키가 필요할 것으로 보이며, 이는 트리의 각 노드에서 표준 헤더로 제공됩니다.</p>
<p>leaf router들, 중간 및 master Meta LS 서명자들 간의 조정을 위한 백엔드 프로토콜은 여기서 명시되지 않습니다. 요구사항은 매우 간단합니다 - 피어가 작동 중인지 확인하고, 몇 시간마다 새로운 LS를 게시하는 것입니다. 유일한 복잡성은 장애 시 최상위 레벨 또는 중간 레벨 Meta LS들을 위한 새로운 게시자를 선택하는 것입니다.</p>
<p>여러 라우터의 lease들을 결합하고 서명하여 단일 leaseset에 게시하는 혼합-매칭 leaseSet은 제안서 140 &ldquo;invisible multihoming&quot;에 문서화되어 있습니다. 이 제안서는 작성된 대로는 실행 불가능한데, 스트리밍 연결이 단일 라우터에 &ldquo;sticky&quot;하지 않기 때문입니다. <a href="http://zzz.i">http://zzz.i</a>
2p/topics/2335 를 참조하세요.</p>
<p>백엔드 프로토콜과 router 및 클라이언트 내부와의 상호작용은 보이지 않는 멀티호밍에 대해 상당히 복잡할 것입니다.</p>
<p>최상위 Meta LS에 대한 floodfill의 과부하를 방지하기 위해, 만료 시간은 최소 몇 시간으로 설정해야 합니다. 클라이언트는 최상위 Meta LS를 캐시해야 하며, 만료되지 않은 경우 재시작 후에도 이를 유지해야 합니다.</p>
<p>클라이언트가 트리를 탐색할 수 있도록 하는 알고리즘을 정의해야 하며, 여기에는 폴백 기능도 포함되어야 사용량이 분산될 수 있습니다. 해시 거리, 비용, 무작위성의 함수 형태가 되어야 합니다. 노드가 LS 또는 LS2와 Meta LS를 모두 가지고 있는 경우, 언제 해당 leaseSet들을 사용할 수 있는지, 그리고 언제 트리 탐색을 계속해야 하는지 알아야 합니다.</p>
<p>다음으로 조회</p>
<pre><code>Standard LS flag (1)
</code></pre>
<p>저장 위치</p>
<pre><code>Meta LS2 type (7)
</code></pre>
<p>다음 위치에 저장:</p>
<pre><code>Hash of destination
This hash is then used to generate the daily &quot;routing key&quot;, as in LS1
</code></pre>
<p>일반적인 만료</p>
<pre><code>Hours. Max 18.2 hours (65535 seconds)
</code></pre>
<p>게시자</p>
<pre><code>&quot;master&quot; Destination or coordinator, or intermediate coordinators
</code></pre>
<h3 id="format">Format</h3>
<pre tabindex="0"><code>Standard LS2 Header as specified above

  Meta LS2 Type-Specific Part
  - Properties (Mapping as specified in common structures spec, 2 zero bytes if none)
  - Number of entries (1 byte) Maximum TBD
  - Entries. Each entry contains: (40 bytes)
    - Hash (32 bytes)
    - Flags (2 bytes)
      TBD. Set all to zero for compatibility with future uses.
    - Type (1 byte) The type of LS it is referencing;
      1 for LS, 3 for LS2, 5 for encrypted, 7 for meta, 0 for unknown.
    - Cost (priority) (1 byte)
    - Expires (4 bytes) (4 bytes, big endian, seconds since epoch, rolls over in 2106)
  - Number of revocations (1 byte) Maximum TBD
  - Revocations: Each revocation contains: (32 bytes)
    - Hash (32 bytes)

  Standard LS2 Signature:
  - Signature (40+ bytes)
    The signature is of everything above.
</code></pre><p>플래그 및 속성: 향후 사용을 위해</p>
<h3 id="blinding-key-유도">Blinding Key 유도</h3>
<ul>
<li>
<p>이 서비스를 사용하는 분산 서비스는 서비스 목적지의 개인 키를 가진 하나 이상의 &ldquo;마스터&quot;를 갖게 됩니다. 이들은 (대역 외에서) 현재 활성 목적지 목록을 결정하고 Meta LS2를 게시합니다. 중복성을 위해 여러 마스터가 멀티홈(즉, 동시에 게시)으로 Meta LS2를 게시할 수 있습니다.</p>
</li>
<li>
<p>분산 서비스는 단일 destination으로 시작하거나 구식 멀티호밍을 사용한 다음, Meta LS2로 전환할 수 있습니다. 표준 LS 조회는 LS, LS2, 또는 Meta LS2 중 하나를 반환할 수 있습니다.</p>
</li>
<li>
<p>서비스가 Meta LS2를 사용할 때는 터널(lease)이 없습니다.</p>
</li>
</ul>
<h3 id="service-record">Service Record</h3>
<p>이는 목적지가 서비스에 참여하고 있다는 개별 레코드입니다. 참여자에서 floodfill로 전송됩니다. floodfill에서 개별적으로 전송되지는 않으며, 오직 Service List의 일부로만 전송됩니다. Service Record는 만료 시간을 0으로 설정하여 서비스 참여를 철회하는 데에도 사용됩니다.</p>
<p>이것은 LS2가 아니지만 표준 LS2 헤더와 서명 형식을 사용합니다.</p>
<p>다음으로 조회</p>
<pre><code>n/a, see Service List
</code></pre>
<p>저장하기</p>
<pre><code>Service Record type (9)
</code></pre>
<p>다음 위치에 저장:</p>
<pre><code>Hash of service name
This hash is then used to generate the daily &quot;routing key&quot;, as in LS1
</code></pre>
<p>일반적인 만료</p>
<pre><code>Hours. Max 18.2 hours (65535 seconds)
</code></pre>
<p>게시자</p>
<pre><code>Destination
</code></pre>
<h3 id="format-1">Format</h3>
<pre tabindex="0"><code>Standard LS2 Header as specified above

  Service Record Type-Specific Part
  - Port (2 bytes, big endian) (0 if unspecified)
  - Hash of service name (32 bytes)

  Standard LS2 Signature:
  - Signature (40+ bytes)
    The signature is of everything above.
</code></pre><h3 id="notes-2">Notes</h3>
<ul>
<li>
<p>expires가 모두 0이면, floodfill은 해당 레코드를 취소하고 더 이상 서비스 목록에 포함하지 않아야 합니다.</p>
</li>
<li>
<p>Storage: floodfill은 이러한 레코드의 저장을 엄격하게 제한하고 해시당 저장되는 레코드 수와 만료 시간을 제한할 수 있습니다. 해시의 화이트리스트도 사용될 수 있습니다.</p>
</li>
<li>
<p>동일한 해시에서 다른 netdb 타입이 우선순위를 가지므로, 서비스 레코드는 LS/RI를 덮어쓸 수 없지만, LS/RI는 해당 해시의 모든 서비스 레코드를 덮어씁니다.</p>
</li>
</ul>
<h3 id="service-list">Service List</h3>
<p>이것은 LS2와는 전혀 다르며 다른 형식을 사용합니다.</p>
<p>서비스 목록은 floodfill에 의해 생성되고 서명됩니다. 누구나 floodfill에 Service Record를 게시하여 서비스에 참여할 수 있다는 점에서 인증되지 않은 방식입니다.</p>
<p>서비스 목록에는 전체 서비스 레코드가 아닌 단축 서비스 레코드가 포함됩니다. 이들은 서명을 포함하지만 전체 destination이 아닌 해시만 포함하므로, 전체 destination 없이는 검증할 수 없습니다.</p>
<p>서비스 목록의 보안성(있다면)과 바람직성은 아직 결정되지 않았습니다. Floodfill들은 서비스의 화이트리스트로 발행과 조회를 제한할 수 있지만, 해당 화이트리스트는 구현이나 운영자의 선호도에 따라 달라질 수 있습니다. 구현들 간에 공통적이고 기본적인 화이트리스트에 대한 합의를 달성하는 것은 불가능할 수도 있습니다.</p>
<p>위의 서비스 레코드에 서비스 이름이 포함되어 있다면 floodfill 운영자들이 이의를 제기할 수 있습니다. 해시만 포함되어 있다면 검증이 없으므로, 서비스 레코드가 다른 netDb 유형보다 먼저 &ldquo;들어가서&rdquo; floodfill에 저장될 수 있습니다.</p>
<p>다음으로 조회</p>
<pre><code>Service List lookup type (11)
</code></pre>
<p>저장 위치</p>
<pre><code>Service List type (11)
</code></pre>
<p>다음 위치에 저장:</p>
<pre><code>Hash of service name
This hash is then used to generate the daily &quot;routing key&quot;, as in LS1
</code></pre>
<p>일반적인 만료</p>
<pre><code>Hours, not specified in the list itself, up to local policy
</code></pre>
<p>게시자</p>
<pre><code>Nobody, never sent to floodfill, never flooded.
</code></pre>
<h3 id="format-2">Format</h3>
<p>위에서 명시한 표준 LS2 헤더를 사용하지 않습니다.</p>
<pre tabindex="0"><code>- Type (1 byte)
    Not actually in header, but part of data covered by signature.
    Take from field in Database Store Message.
  - Hash of the service name (implicit, in the Database Store message)
  - Hash of the Creator (floodfill) (32 bytes)
  - Published timestamp (8 bytes, big endian)

  - Number of Short Service Records (1 byte)
  - List of Short Service Records:
    Each Short Service Record contains (90+ bytes)
    - Dest hash (32 bytes)
    - Published timestamp (8 bytes, big endian)
    - Expires (4 bytes, big endian) (offset from published in ms)
    - Flags (2 bytes)
    - Port (2 bytes, big endian)
    - Sig length (2 bytes, big endian)
    - Signature of dest (40+ bytes)

  - Number of Revocation Records (1 byte)
  - List of Revocation Records:
    Each Revocation Record contains (86+ bytes)
    - Dest hash (32 bytes)
    - Published timestamp (8 bytes, big endian)
    - Flags (2 bytes)
    - Port (2 bytes, big endian)
    - Sig length (2 bytes, big endian)
    - Signature of dest (40+ bytes)

  - Signature of floodfill (40+ bytes)
    The signature is of everything above.
</code></pre><p>서비스 목록의 서명을 검증하려면:</p>
<ul>
<li>서비스 이름의 해시를 앞에 추가</li>
<li>생성자의 해시를 제거</li>
<li>수정된 내용의 서명을 확인</li>
</ul>
<p>각 Short Service Record의 서명을 검증하려면:</p>
<ul>
<li>목적지 가져오기</li>
<li>서명 확인 (게시된 타임스탬프 + 만료 시간 + 플래그 + 포트 + 서비스 이름의 해시)</li>
</ul>
<p>각 철회 기록(Revocation Record)의 서명을 검증하려면:</p>
<ul>
<li>목적지 가져오기</li>
<li>서명 확인 (게시된 타임스탬프 + 4개의 zero 바이트 + flags + port + 서비스 이름의 Hash)</li>
</ul>
<h3 id="notes-3">Notes</h3>
<ul>
<li>
<p>알 수 없는 signature 유형을 지원할 수 있도록 sig type 대신 signature length를 사용합니다.</p>
</li>
<li>
<p>서비스 목록에는 만료가 없으며, 수신자는 정책이나 개별 레코드의 만료를 기반으로 자체적으로 결정할 수 있습니다.</p>
</li>
<li>
<p>Service Lists는 플러딩되지 않으며, 개별 Service Records만 플러딩됩니다. 각 floodfill은 Service List를 생성하고, 서명하고, 캐시합니다. floodfill은 캐시 시간과 서비스 및 철회 레코드의 최대 개수에 대해 자체 정책을 사용합니다.</p>
</li>
</ul>
<h2 id="common-structures-spec-changes-required">Common Structures Spec Changes Required</h2>
<h3 id="암호화-및-처리">암호화 및 처리</h3>
<p>이 제안의 범위를 벗어남. ECIES 제안 144 및 145에 추가할 것.</p>
<h3 id="new-intermediate-structures">New Intermediate Structures</h3>
<p>Lease2, MetaLease, LeaseSet2Header, OfflineSignature에 대한 새로운 구조를 추가합니다. 릴리스 0.9.38부터 적용됩니다.</p>
<h3 id="new-netdb-types">New NetDB Types</h3>
<p>위 내용에서 각 새로운 leaseset 유형에 대한 구조를 추가합니다. LeaseSet2, EncryptedLeaseSet, MetaLeaseSet의 경우 릴리스 0.9.38부터 적용됩니다. Service Record와 Service List의 경우 예비 단계이며 일정이 미정입니다.</p>
<h3 id="new-signature-type">New Signature Type</h3>
<p>RedDSA_SHA512_Ed25519 타입 11을 추가합니다. 공개 키는 32바이트, 개인 키는 32바이트, 해시는 64바이트, 서명은 64바이트입니다.</p>
<h2 id="encryption-spec-changes-required">Encryption Spec Changes Required</h2>
<p>이 제안의 범위를 벗어남. 제안서 144 및 145를 참조하세요.</p>
<h2 id="i2np-changes-required">I2NP Changes Required</h2>
<p>참고 사항: LS2는 최소 버전 이상의 floodfill에만 게시할 수 있습니다.</p>
<h3 id="database-lookup-message">Database Lookup Message</h3>
<p>서비스 목록 조회 유형을 추가합니다.</p>
<h3 id="changes">Changes</h3>
<pre tabindex="0"><code>Flags byte: Lookup type field, currently bits 3-2, expands to bits 4-2.
  Lookup type 0x04 is defined as the service list lookup.

  Add note: Service list loookup may only be sent to floodfills with a minimum version.
  Minimum version is 0.9.38.
</code></pre><h3 id="클라이언트별-인증">클라이언트별 인증</h3>
<p>모든 새로운 저장소 유형을 추가합니다.</p>
<h3 id="changes-1">Changes</h3>
<pre tabindex="0"><code>Type byte: Type field, currently bit 0, expands to bits 3-0.
  Type 3 is defined as a LS2 store.
  Type 5 is defined as a encrypted LS2 store.
  Type 7 is defined as a meta LS2 store.
  Type 9 is defined as a service record store.
  Type 11 is defined as a service list store.
  Other types are undefined and invalid.

  Add note: All new types may only be published to floodfills with a minimum version.
  Minimum version is 0.9.38.
</code></pre><h2 id="i2cp-changes-required">I2CP Changes Required</h2>
<h3 id="i2cp-options">I2CP Options</h3>
<p>router 측에서 해석되는 새로운 옵션들, SessionConfig Mapping으로 전송됨:</p>
<pre tabindex="0"><code>
  i2cp.leaseSetType=nnn       The type of leaseset to be sent in the Create Leaseset Message
                              Value is the same as the netdb store type in the table above.
                              Interpreted client-side, but also passed to the router in the
                              SessionConfig, to declare intent and check support.

  i2cp.leaseSetEncType=nnn[,nnn]  The encryption types to be used.
                                  Interpreted client-side, but also passed to the router in
                                  the SessionConfig, to declare intent and check support.
                                  See proposals 144 and 145.

  i2cp.leaseSetOfflineExpiration=nnn  The expiration of the offline signature, ASCII,
                                      seconds since the epoch.

  i2cp.leaseSetTransientPublicKey=[type:]b64  The base 64 of the transient private key,
                                              prefixed by an optional sig type number
                                              or name, default DSA_SHA1.
                                              Length as inferred from the sig type

  i2cp.leaseSetOfflineSignature=b64   The base 64 of the offline signature.
                                      Length as inferred from the destination
                                      signing public key type

  i2cp.leaseSetSecret=b64     The base 64 of a secret used to blind the
                              address of the leaseset, default &#34;&#34;

  i2cp.leaseSetAuthType=nnn   The type of authentication for encrypted LS2.
                              0 for no per-client authentication (the default)
                              1 for DH per-client authentication
                              2 for PSK per-client authentication

  i2cp.leaseSetPrivKey=b64    A base 64 private key for the router to use to
                              decrypt the encrypted LS2,
                              only if per-client authentication is enabled
</code></pre><p>클라이언트 측에서 해석되는 새로운 옵션들:</p>
<pre tabindex="0"><code>
  i2cp.leaseSetType=nnn     The type of leaseset to be sent in the Create Leaseset Message
                            Value is the same as the netdb store type in the table above.
                            Interpreted client-side, but also passed to the router in the
                            SessionConfig, to declare intent and check support.

  i2cp.leaseSetEncType=nnn[,nnn]  The encryption types to be used.
                                  Interpreted client-side, but also passed to the router in
                                  the SessionConfig, to declare intent and check support.
                                  See proposals 144 and 145.

  i2cp.leaseSetSecret=b64     The base 64 of a secret used to blind the
                              address of the leaseset, default &#34;&#34;

  i2cp.leaseSetAuthType=nnn       The type of authentication for encrypted LS2.
                                  0 for no per-client authentication (the default)
                                  1 for DH per-client authentication
                                  2 for PSK per-client authentication

  i2cp.leaseSetBlindedType=nnn   The sig type of the blinded key for encrypted LS2.
                                 Default depends on the destination sig type.

  i2cp.leaseSetClient.dh.nnn=b64name:b64pubkey   The base 64 of the client name (ignored, UI use only),
                                                 followed by a &#39;:&#39;, followed by the base 64 of the public
                                                 key to use for DH per-client auth. nnn starts with 0

  i2cp.leaseSetClient.psk.nnn=b64name:b64privkey   The base 64 of the client name (ignored, UI use only),
                                                   followed by a &#39;:&#39;, followed by the base 64 of the private
                                                   key to use for PSK per-client auth. nnn starts with 0
</code></pre><h3 id="session-config">Session Config</h3>
<p>오프라인 서명의 경우, i2cp.leaseSetOfflineExpiration, i2cp.leaseSetTransientPublicKey, i2cp.leaseSetOfflineSignature 옵션이 필요하며, 서명은 임시 서명 개인키로 수행됩니다.</p>
<h3 id="base-32-주소를-사용한-암호화된-ls">Base 32 주소를 사용한 암호화된 LS</h3>
<p>라우터에서 클라이언트로. 변경 사항 없음. 반환되는 leaseSet이 4바이트 타임스탬프를 가진 LS2이더라도 lease들은 8바이트 타임스탬프와 함께 전송됩니다. 응답은 Create Leaseset 또는 Create Leaseset2 메시지일 수 있음을 참고하세요.</p>
<h3 id="오프라인-키를-사용한-암호화된-ls">오프라인 키를 사용한 암호화된 LS</h3>
<p>Router에서 client로. 변경사항 없음. 반환되는 leaseset이 4바이트 타임스탬프를 가진 LS2일지라도, lease들은 8바이트 타임스탬프와 함께 전송됩니다. 응답은 Create Leaseset 또는 Create Leaseset2 메시지일 수 있음에 유의하세요.</p>
<h3 id="참고사항-3">참고사항</h3>
<p>클라이언트에서 라우터로. Create Leaseset Message를 대신하여 사용할 새로운 메시지.</p>
<h3 id="meta-ls2-1">Meta LS2</h3>
<ul>
<li>
<p>라우터가 저장 타입을 파싱하려면, 세션 설정에서 라우터에 미리 전달되지 않는 한 타입이 메시지에 포함되어야 합니다.
일반적인 파싱 코드의 경우, 메시지 자체에 포함하는 것이 더 쉽습니다.</p>
</li>
<li>
<p>라우터가 개인키의 타입과 길이를 알기 위해서는,
파서가 세션 설정에서 미리 타입을 알고 있지 않는 한
개인키가 lease set 다음에 와야 합니다.
공통 파싱 코드의 경우, 메시지 자체에서 이를 아는 것이 더 쉽습니다.</p>
</li>
<li>
<p>이전에 폐기용으로 정의되었지만 사용되지 않았던 서명 개인키는
LS2에 존재하지 않습니다.</p>
</li>
</ul>
<h3 id="형식-4">형식</h3>
<p>Create Leaseset2 메시지의 메시지 타입은 41입니다.</p>
<h3 id="참고사항-4">참고사항</h3>
<pre tabindex="0"><code>Session ID
  Type byte: Type of lease set to follow
             Type 1 is a LS
             Type 3 is a LS2
             Type 5 is a encrypted LS2
             Type 7 is a meta LS2
  LeaseSet: type specified above
  Number of private keys to follow (1 byte)
  Encryption Private Keys: For each public key in the lease set,
                           in the same order
                           (Not present for Meta LS2)
                           - Encryption type (2 bytes, big endian)
                           - Encryption key length (2 bytes, big endian)
                           - Encryption key (number of bytes specified)
</code></pre><h3 id="서비스-기록">서비스 기록</h3>
<ul>
<li>최소 라우터 버전은 0.9.39입니다.</li>
<li>메시지 타입 40을 사용한 예비 버전이 0.9.38에 있었지만 형식이 변경되었습니다.
타입 40은 폐기되었으며 지원되지 않습니다.</li>
</ul>
<h3 id="형식-5">형식</h3>
<ul>
<li>암호화된 LS와 메타 LS를 지원하기 위해 더 많은 변경사항이 필요합니다.</li>
</ul>
<h3 id="참고사항-5">참고사항</h3>
<p>클라이언트에서 라우터로. 새 메시지.</p>
<h3 id="서비스-목록">서비스 목록</h3>
<ul>
<li>
<p>라우터는 목적지가 블라인드 처리되어 있는지 알아야 합니다.
만약 블라인드 처리되어 있고 시크릿 또는 클라이언트별 인증을 사용한다면,
해당 정보도 함께 가지고 있어야 합니다.</p>
</li>
<li>
<p>새로운 형식의 b32 주소(&ldquo;b33&rdquo;)에 대한 Host Lookup은
라우터에게 해당 주소가 블라인드 처리되었음을 알려주지만, Host Lookup 메시지에서
시크릿이나 개인 키를 라우터에 전달할 메커니즘이 없습니다.
Host Lookup 메시지를 확장하여 해당 정보를 추가할 수도 있지만,
새로운 메시지를 정의하는 것이 더 깔끔합니다.</p>
</li>
<li>
<p>클라이언트가 router에게 알려줄 수 있는 프로그래밍적 방법이 필요합니다.
그렇지 않으면 사용자가 각 destination을 수동으로 구성해야 합니다.</p>
</li>
</ul>
<h3 id="형식-6">형식</h3>
<p>클라이언트가 blinded destination에 메시지를 보내기 전에, Host Lookup 메시지에서 &ldquo;b33&quot;을 조회하거나 Blinding Info 메시지를 보내야 합니다. blinded destination에 비밀 키 또는 클라이언트별 인증이 필요한 경우, 클라이언트는 Blinding Info 메시지를 보내야 합니다.</p>
<p>router는 이 메시지에 대한 응답을 보내지 않습니다.</p>
<h3 id="참고사항-6">참고사항</h3>
<p>Blinding Info Message의 메시지 타입은 42입니다.</p>
<h3 id="format-3">Format</h3>
<pre tabindex="0"><code>Session ID
  Flags:       1 byte
               Bit order: 76543210
               Bit 0: 0 for everybody, 1 for per-client
               Bits 3-1: Authentication scheme, if bit 0 is set to 1 for per-client, otherwise 000
                         000: DH client authentication (or no per-client authentication)
                         001: PSK client authentication
               Bit 4: 1 if secret required, 0 if no secret required
               Bits 7-5: Unused, set to 0 for future compatibility
  Type byte:   Endpoint type to follow
               Type 0 is a Hash
               Type 1 is a host name String
               Type 2 is a Destination
               Type 3 is a Sig Type and Signing Public Key
  Blind Type:  2 byte blinded sig type (big endian)
  Expiration:  4 bytes, big endian, seconds since epoch
  Endpoint:    Data as specified above
               For type 0: 32 byte binary hash
               For type 1: host name String
               For type 2: binary Destination
               For type 3: 2 byte sig type (big endian)
                           Signing Public Key (length as implied by sig type)
  Private Key: Only if flag bit 0 is set to 1
               A 32-byte ECIES_X25519 private key
  Secret:      Only if flag bit 4 is set to 1
               A secret String
</code></pre><h3 id="키-인증서">키 인증서</h3>
<ul>
<li>최소 라우터 버전은 0.9.43입니다</li>
</ul>
<h3 id="새로운-중간-구조체">새로운 중간 구조체</h3>
<h3 id="새로운-netdb-타입">새로운 NetDB 타입</h3>
<p>&ldquo;b33&rdquo; 호스트명의 조회를 지원하고 router가 필요한 정보를 가지고 있지 않은 경우 표시를 반환하기 위해, Host Reply Message에 대한 추가 결과 코드를 다음과 같이 정의합니다:</p>
<pre tabindex="0"><code>2: Lookup password required
   3: Private key required
   4: Lookup password and private key required
   5: Leaseset decryption failure
</code></pre><p>1-255 값들은 이미 오류로 정의되어 있으므로, 역방향 호환성 문제는 없습니다.</p>
<h3 id="새로운-서명-유형">새로운 서명 유형</h3>
<p>라우터에서 클라이언트로. 새 메시지.</p>
<h3 id="justification-1">Justification</h3>
<p>클라이언트는 주어진 해시가 Meta LS로 해석될 것이라는 것을 사전에 알 수 없습니다.</p>
<p>Destination에 대한 leaseSet 조회가 Meta LS를 반환하면, router는 재귀 해결을 수행합니다. 데이터그램의 경우 클라이언트 측에서 알 필요가 없지만, SYN ACK에서 프로토콜이 destination을 확인하는 스트리밍의 경우 &ldquo;실제&rdquo; destination이 무엇인지 알아야 합니다. 따라서 새로운 메시지가 필요합니다.</p>
<h3 id="usage">Usage</h3>
<p>router는 메타 LS에서 사용되는 실제 목적지에 대한 캐시를 유지합니다. 클라이언트가 메타 LS로 해석되는 목적지에 메시지를 보낼 때, router는 마지막으로 사용된 실제 목적지에 대한 캐시를 확인합니다. 캐시가 비어있으면, router는 메타 LS에서 목적지를 선택하고 leaseSet을 조회합니다. leaseSet 조회가 성공하면, router는 해당 목적지를 캐시에 추가하고 클라이언트에게 Meta Redirect Message를 보냅니다. 이는 목적지가 만료되어 변경되어야 하는 경우가 아닌 한 한 번만 수행됩니다. 클라이언트도 필요한 경우 정보를 캐시해야 합니다. Meta Redirect Message는 모든 SendMessage에 대한 응답으로 전송되지 않습니다.</p>
<p>라우터는 버전 0.9.47 이상의 클라이언트에게만 이 메시지를 보냅니다.</p>
<p>클라이언트는 이 메시지에 대한 응답을 보내지 않습니다.</p>
<h3 id="데이터베이스-조회-메시지">데이터베이스 조회 메시지</h3>
<p>Meta Redirect Message의 메시지 타입은 43입니다.</p>
<h3 id="변경사항">변경사항</h3>
<pre tabindex="0"><code>Session ID (2 bytes) The value from the Send Message.
  Message ID generated by the router (4 bytes)
  4 byte nonce previously generated by the client
               (the value from the Send Message, may be zero)
  Flags:       2 bytes, bit order 15...0
               Unused, set to 0 for future compatibility
               Bit 0: 0 - the destination is no longer meta
                      1 - the destination is now meta
               Bits 15-1: Unused, set to 0 for future compatibility
  Original Destination (387+ bytes)
  (following fields only present if flags bit 0 is 1)
  MFlags:      2 bytes
               Unused, set to 0 for future compatibility
               From the Meta Lease for the actual Destination
  Expiration:  4 bytes, big endian, seconds since epoch
               From the Meta Lease for the actual Destination
  Cost (priority) 1 byte
               From the Meta Lease for the actual Destination
  Actual (real) Destination (387+ bytes)
</code></pre><h3 id="데이터베이스-저장-메시지">데이터베이스 저장 메시지</h3>
<p>Meta를 생성하고 지원하는 방법(라우터 간 통신 및 조정 포함)은 이 제안의 범위를 벗어납니다. 관련 제안 150을 참조하세요.</p>
<h3 id="변경사항-1">변경사항</h3>
<p>오프라인 서명은 스트리밍이나 응답 가능한 데이터그램에서 검증될 수 없습니다. 아래 섹션을 참조하세요.</p>
<h2 id="private-key-file-changes-required">Private Key File Changes Required</h2>
<p>개인 키 파일(eepPriv.dat) 형식은 우리 사양의 공식적인 부분은 아니지만 <a href="http://idk.i2p/javadoc-i2p/net/i2p/data/PrivateKeyFile.html">Java I2P javadocs</a>
에 문서화되어 있으며 다른 구현체들도 이를 지원합니다. 이를 통해 개인 키를 다른 구현체로 이식할 수 있습니다.</p>
<p>일시적 공개 키와 오프라인 서명 정보를 저장하기 위해 변경이 필요합니다.</p>
<h3 id="changes-2">Changes</h3>
<pre tabindex="0"><code>If the signing private key is all zeros, the offline information section follows:

  - Expires timestamp
    (4 bytes, big endian, seconds since epoch, rolls over in 2106)
  - Sig type of transient Signing Public Key (2 bytes, big endian)
  - Transient Signing Public key
    (length as specified by transient sig type)
  - Signature of above three fields by offline key
    (length as specified by destination sig type)
  - Transient Signing Private key
    (length as specified by transient sig type)
</code></pre><h3 id="i2cp-옵션">I2CP 옵션</h3>
<p>다음 옵션들에 대한 지원을 추가하세요:</p>
<pre tabindex="0"><code>-d days              (specify expiration in days of offline sig, default 365)
      -o offlinedestfile   (generate the online key file,
                            using the offline key file specified)
      -r sigtype           (specify sig type of transient key, default Ed25519)
</code></pre><h2 id="streaming-changes-required">Streaming Changes Required</h2>
<p>오프라인 서명은 현재 스트리밍에서 검증할 수 없습니다. 아래 변경 사항은 오프라인 서명 블록을 옵션에 추가합니다. 이를 통해 I2CP를 통해 이 정보를 검색할 필요가 없어집니다.</p>
<h3 id="세션-설정">세션 설정</h3>
<pre tabindex="0"><code>Add new option:
  Bit:          11
  Flag:         OFFLINE_SIGNATURE
  Option order: 4
  Option data:  Variable bytes
  Function:     Contains the offline signature section from LS2.
                FROM_INCLUDED must also be set.
                Expires timestamp
                (4 bytes, big endian, seconds since epoch, rolls over in 2106)
                Transient sig type (2 bytes, big endian)
                Transient signing public key (length as implied by sig type)
                Signature of expires timestamp, transient sig type,
                and public key, by the destination public key,
                length as implied by destination public key sig type.

  Change option:
  Bit:          3
  Flag:         SIGNATURE_INCLUDED
  Option order: Change from 4 to 5

  Add information about transient keys to the
  Variable Length Signature Notes section:
  The offline signature option does not needed to be added for a CLOSE packet if
  a SYN packet containing the option was previously acked.
  More info TODO
</code></pre><h3 id="request-leaseset-메시지">Request LeaseSet 메시지</h3>
<ul>
<li>대안으로는 플래그만 추가하고 I2CP를 통해 임시 공개 키를 검색하는 것입니다
(위의 Host Lookup / Host Reply Message 섹션 참조)</li>
</ul>
<h2 id="표준-ls2-헤더">표준 LS2 헤더</h2>
<p>오프라인 서명은 응답 가능한 데이터그램 처리에서 검증할 수 없습니다. 오프라인 서명되었음을 나타내는 플래그가 필요하지만 플래그를 넣을 곳이 없습니다. 완전히 새로운 프로토콜 번호와 형식이 필요할 것입니다.</p>
<h3 id="request-variable-leaseset-message">Request Variable Leaseset Message</h3>
<pre tabindex="0"><code>Define new protocol 19 - Repliable datagram with options?
  - Destination (387+ bytes)
  - Flags (2 bytes)
    Bit order: 15 14 ... 3 2 1 0
    Bit 0: If 0, no offline keys; if 1, offline keys
    Bits 1-15: set to 0 for compatibility with future uses
  - If flag indicates offline keys, the offline signature section:
    Expires timestamp
    (4 bytes, big endian, seconds since epoch, rolls over in 2106)
    Transient sig type (2 bytes, big endian)
    Transient signing public key (length as implied by sig type)
    Signature of expires timestamp, transient sig type,
    and public key, by the destination public key,
    length as implied by destination public key sig type.
    This section can, and should, be generated offline.
  - Data
</code></pre><h3 id="create-leaseset2-메시지">Create Leaseset2 메시지</h3>
<ul>
<li>대안으로는 플래그만 추가하고, I2CP를 통해 임시 공개 키를 검색하는 방법이 있습니다
(위의 Host Lookup / Host Reply Message 섹션 참조)</li>
<li>플래그 바이트를 사용할 수 있게 되었으니 지금 추가해야 할 다른 옵션이 있나요?</li>
</ul>
<h2 id="sam-v3-changes-required">SAM V3 Changes Required</h2>
<p>SAM은 DESTINATION base 64에서 오프라인 서명을 지원하도록 개선되어야 합니다.</p>
<h3 id="근거">근거</h3>
<pre tabindex="0"><code>Note that in the SESSION CREATE DESTINATION=$privkey,
  the $privkey raw data (before base64 conversion)
  may be optionally followed by the Offline Signature as specified in the
  Common Structures Specification.

  If the signing private key is all zeros, the offline information section follows:

  - Expires timestamp
    (4 bytes, big endian, seconds since epoch, rolls over in 2106)
  - Sig type of transient Signing Public Key (2 bytes, big endian)
  - Transient Signing Public key
    (length as specified by transient sig type)
  - Signature of above three fields by offline key
    (length as specified by destination sig type)
  - Transient Signing Private key (length as specified by transient sig type)
</code></pre><p>오프라인 서명은 STREAM과 RAW에서만 지원되며, DATAGRAM에서는 지원되지 않습니다(새로운 DATAGRAM 프로토콜을 정의할 때까지).</p>
<p>SESSION STATUS는 모든 비트가 0인 서명 개인 키와 SESSION CREATE에서 제공된 것과 정확히 동일한 오프라인 서명 데이터를 반환한다는 점에 유의하세요.</p>
<p>DEST GENERATE와 SESSION CREATE DESTINATION=TRANSIENT는 오프라인 서명된 destination을 생성하는 데 사용할 수 없습니다.</p>
<h3 id="메시지-유형">메시지 유형</h3>
<p>버전을 3.4로 올릴 것인지, 아니면 3.1/3.2/3.3으로 유지해서 모든 3.2/3.3 관련 요소들을 요구하지 않고도 추가할 수 있도록 할 것인지?</p>
<p>기타 변경 사항은 미정입니다. 위의 I2CP Host Reply Message 섹션을 참조하세요.</p>
<h2 id="bob-changes-required">BOB Changes Required</h2>
<p>BOB는 오프라인 서명 및/또는 Meta LS를 지원하도록 개선되어야 합니다. 이는 우선순위가 낮으며 아마도 명세화되거나 구현되지 않을 것입니다. SAM V3가 선호되는 인터페이스입니다.</p>
<h2 id="publishing-migration-compatibility">Publishing, Migration, Compatibility</h2>
<p>LS2 (암호화된 LS2 제외)는 LS1과 동일한 DHT 위치에 게시됩니다. LS2가 다른 위치에 있지 않은 이상, LS1과 LS2를 모두 게시할 방법은 없습니다.</p>
<p>암호화된 LS2는 블라인드된 키 타입과 키 데이터의 해시에 게시됩니다. 이 해시는 LS1에서와 같이 일일 &ldquo;라우팅 키&quot;를 생성하는 데 사용됩니다.</p>
<p>LS2는 새로운 기능이 필요한 경우에만 사용됩니다 (새로운 암호화, 암호화된 LS, 메타데이터 등). LS2는 지정된 버전 이상의 floodfill에만 게시할 수 있습니다.</p>
<p>LS2를 게시하는 서버는 연결하는 모든 클라이언트가 LS2를 지원한다는 것을 알 수 있습니다. 서버는 garlic encryption에 LS2를 보낼 수 있습니다.</p>
<p>클라이언트는 새로운 암호화를 사용하는 경우에만 garlic에서 LS2를 전송합니다. 공유 클라이언트는 LS1을 무기한 사용할까요? TODO: 이전 암호화와 새로운 암호화를 모두 지원하는 공유 클라이언트를 어떻게 구현할 수 있을까요?</p>
<h2 id="rollout">Rollout</h2>
<p>0.9.38은 오프라인 키를 포함한 표준 LS2에 대한 floodfill 지원을 포함합니다.</p>
<p>0.9.39는 LS2 및 Encrypted LS2에 대한 I2CP 지원, sig type 11 서명/검증, Encrypted LS2에 대한 floodfill 지원(오프라인 키 없이 sig type 7 및 11), 그리고 LS2 암호화/복호화(클라이언트별 인증 없이)를 포함합니다.</p>
<p>0.9.40은 클라이언트별 인증을 통한 LS2 암호화/복호화 지원, Meta LS2에 대한 floodfill 및 I2CP 지원, 오프라인 키를 사용한 암호화된 LS2 지원, 그리고 암호화된 LS2에 대한 b32 지원을 포함할 예정입니다.</p>
<h2 id="새로운-databaseentry-타입">새로운 DatabaseEntry 타입</h2>
<p>암호화된 LS2 설계는 유사한 설계 목표를 가졌던 <a href="https://spec.torproject.org/rend-spec-v3">Tor의 v3 숨겨진 서비스 디스크립터</a>
에 크게 영향을 받았습니다.</p>

                </article>

                
                <nav class="page-nav">
                    <a href="../../../ko/proposals/" class="page-nav-link">
                        ← Back to Proposals
                    </a>
                    
                    
                    
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                            
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                    <a href="../../../proposals/123-new-netdb-entries.txt" class="page-nav-link" download>
                        Download Source (.txt)
                    </a>
                    
                </nav>
            </div>
        </div>
    </div>
</div>

<style>
.proposals-page {
    min-height: 100vh;
    padding: var(--spacing-xl) 0;
}

.breadcrumbs {
    display: flex;
    align-items: center;
    gap: var(--spacing-xs);
    margin-bottom: var(--spacing-lg);
    font-size: 0.875rem;
    color: var(--color-text-muted);
}

.breadcrumbs a {
    color: var(--color-text-muted);
    text-decoration: none;
    transition: color var(--transition-fast);
}

.breadcrumbs a:hover {
    color: var(--color-primary);
}

.separator {
    color: var(--color-border);
}

.current {
    color: var(--color-text);
}

 
.translation-disclaimer {
    background: #fef3c7;
    border: 1px solid #f59e0b;
    border-radius: var(--radius-md);
    padding: var(--spacing-md);
    margin-bottom: var(--spacing-lg);
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: var(--spacing-md);
    flex-wrap: wrap;
}

.dark .translation-disclaimer {
    background: #78350f;
    border-color: #d97706;
}

.disclaimer-message {
    color: #92400e;
    font-size: 0.875rem;
}

.dark .disclaimer-message {
    color: #fde047;
}

.disclaimer-link {
    color: #92400e;
    font-weight: 600;
    text-decoration: underline;
    white-space: nowrap;
}

.dark .disclaimer-link {
    color: #fde047;
}

 
.proposal-header {
    margin-bottom: var(--spacing-2xl);
}

.proposal-title-section {
    margin-bottom: var(--spacing-lg);
}

.proposal-title {
    font-size: 2.5rem;
    margin: 0 0 var(--spacing-sm) 0;
    color: var(--color-text);
}

.proposal-number {
    font-size: 0.875rem;
    color: var(--color-text-muted);
    font-weight: 600;
}

 
.proposal-meta-box {
    background: var(--color-bg-secondary);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-lg);
    padding: var(--spacing-lg);
}

.proposal-status {
    display: inline-block;
    padding: var(--spacing-xs) var(--spacing-md);
    border-radius: var(--radius-md);
    font-weight: 600;
    font-size: 0.875rem;
    margin-bottom: var(--spacing-md);
    text-transform: uppercase;
    letter-spacing: 0.05em;
}

 
.status-open {
    background: #dbeafe;
    color: #0369a1;
}

.dark .status-open {
    background: #0c4a6e;
    color: #7dd3fc;
}

.status-accepted {
    background: #dbeafe;
    color: #0369a1;
}

.dark .status-accepted {
    background: #0c4a6e;
    color: #7dd3fc;
}

.status-finished {
    background: #dcfce7;
    color: #15803d;
}

.dark .status-finished {
    background: #164e63;
    color: #86efac;
}

.status-closed {
    background: #dcfce7;
    color: #15803d;
}

.dark .status-closed {
    background: #164e63;
    color: #86efac;
}

.status-rejected {
    background: #fee2e2;
    color: #991b1b;
}

.dark .status-rejected {
    background: #7f1d1d;
    color: #fca5a5;
}

.status-draft,
.status-needs-revision,
.status-dead,
.status-needs-research {
    background: #fef3c7;
    color: #92400e;
}

.dark .status-draft,
.dark .status-needs-revision,
.dark .status-dead,
.dark .status-needs-research {
    background: #78350f;
    color: #fde047;
}

.status-meta,
.status-informational,
.status-reserve {
    background: #e9d5ff;
    color: #6b21a8;
}

.dark .status-meta,
.dark .status-informational,
.dark .status-reserve {
    background: #581c87;
    color: #e879f9;
}

 
.proposal-info-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: var(--spacing-md);
    margin-bottom: var(--spacing-lg);
}

.info-item {
    display: flex;
    flex-direction: column;
    gap: var(--spacing-xs);
}

.info-label {
    font-size: 0.75rem;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    color: var(--color-text-muted);
}

.info-value {
    font-size: 0.9375rem;
    color: var(--color-text);
    font-weight: 500;
}

 
.proposal-relationships {
    border-top: 1px solid var(--color-border);
    padding-top: var(--spacing-md);
}

.relationship {
    display: flex;
    gap: var(--spacing-md);
    margin-bottom: var(--spacing-sm);
}

.relationship:last-child {
    margin-bottom: 0;
}

.relationship-label {
    font-weight: 600;
    color: var(--color-text-muted);
    min-width: 120px;
}

.relationship-value {
    color: var(--color-text);
}

 
.proposal-layout {
    display: block;
}

.proposal-layout--with-toc {
    display: grid;
    grid-template-columns: 260px 1fr;
    gap: var(--spacing-2xl);
    align-items: start;
}

 
.proposal-toc-sidebar {
    position: sticky;
    top: 100px;
    max-height: calc(100vh - 120px);
    overflow-y: auto;
}

.toc-nav {
    background: var(--color-bg-secondary);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-lg);
    padding: var(--spacing-md);
}

.toc-header {
    display: flex;
    align-items: center;
    gap: var(--spacing-sm);
    font-weight: 700;
    font-size: 0.875rem;
    color: var(--color-text);
    padding-bottom: var(--spacing-md);
    margin-bottom: var(--spacing-md);
    border-bottom: 1px solid var(--color-border);
}

.toc-content {
    max-height: calc(100vh - 250px);
    overflow-y: auto;
}

.toc-content::-webkit-scrollbar {
    width: 4px;
}

.toc-content::-webkit-scrollbar-track {
    background: transparent;
}

.toc-content::-webkit-scrollbar-thumb {
    background: var(--color-border);
    border-radius: 2px;
}

.toc-content::-webkit-scrollbar-thumb:hover {
    background: var(--color-text-muted);
}

.toc-nav ul {
    list-style: none;
    padding-left: 0;
    margin: 0;
}

.toc-nav li {
    margin-bottom: 0.25rem;
}

.toc-nav ul ul {
    padding-left: var(--spacing-md);
    margin-top: 0.25rem;
}

.toc-nav a {
    color: var(--color-text-secondary);
    text-decoration: none;
    font-size: 0.8125rem;
    display: block;
    padding: 0.25rem 0.5rem;
    border-radius: var(--radius-sm);
    transition: all var(--transition-fast);
    line-height: 1.4;
}

.toc-nav a:hover {
    color: var(--color-primary);
    background: var(--color-bg-tertiary);
}

 
.proposal-main {
    min-width: 0;
}

 
.proposal-content {
    line-height: 1.8;
    color: var(--color-text);
    max-width: 900px;
}

.proposal-content h2 {
    margin-top: var(--spacing-2xl);
    margin-bottom: var(--spacing-md);
    font-size: 1.75rem;
    scroll-margin-top: 100px;
}

.proposal-content h3 {
    margin-top: var(--spacing-xl);
    margin-bottom: var(--spacing-sm);
    font-size: 1.375rem;
    scroll-margin-top: 100px;
}

.proposal-content h4 {
    margin-top: var(--spacing-lg);
    margin-bottom: var(--spacing-xs);
    font-size: 1.125rem;
    scroll-margin-top: 100px;
}

.proposal-content p {
    margin-bottom: var(--spacing-md);
}

.proposal-content ul,
.proposal-content ol {
    margin-bottom: var(--spacing-md);
    padding-left: var(--spacing-xl);
}

.proposal-content li {
    margin-bottom: var(--spacing-xs);
}

.proposal-content code {
    background: var(--color-bg-secondary);
    padding: 0.125rem 0.375rem;
    border-radius: var(--radius-sm);
    font-size: 0.875em;
    font-family: 'Courier New', monospace;
}

.proposal-content pre {
    background: var(--color-bg-secondary);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-md);
    padding: var(--spacing-md);
    overflow-x: auto;
    margin-bottom: var(--spacing-md);
    font-size: 0.875rem;
}

.proposal-content pre code {
    background: none;
    padding: 0;
}

.proposal-content blockquote {
    border-left: 4px solid var(--color-primary);
    padding-left: var(--spacing-md);
    margin-left: 0;
    margin-bottom: var(--spacing-md);
    font-style: italic;
    color: var(--color-text-secondary);
}

.proposal-content a {
    color: var(--color-primary);
    text-decoration: none;
    border-bottom: 1px solid transparent;
    transition: border-color var(--transition-fast);
}

.proposal-content a:hover {
    border-bottom-color: var(--color-primary);
}

.proposal-content table {
    width: 100%;
    border-collapse: collapse;
    margin-bottom: var(--spacing-md);
}

.proposal-content table th {
    background: var(--color-bg-secondary);
    padding: var(--spacing-sm);
    text-align: left;
    font-weight: 600;
    border-bottom: 2px solid var(--color-border);
}

.proposal-content table td {
    padding: var(--spacing-sm);
    border-bottom: 1px solid var(--color-border);
}

.proposal-content img {
    max-width: 100%;
    height: auto;
    border-radius: var(--radius-md);
    border: 1px solid var(--color-border);
    margin: var(--spacing-lg) 0;
    display: block;
}

 
.page-nav {
    margin-top: var(--spacing-2xl);
    padding-top: var(--spacing-xl);
    border-top: 1px solid var(--color-border);
    display: flex;
    gap: var(--spacing-md);
    flex-wrap: wrap;
}

.page-nav-link {
    display: inline-block;
    padding: var(--spacing-md) var(--spacing-lg);
    background: var(--color-bg-secondary);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-md);
    color: var(--color-text);
    text-decoration: none;
    transition: all var(--transition-fast);
}

.page-nav-link:hover {
    border-color: var(--color-primary);
    color: var(--color-primary);
}

 
@media (max-width: 1024px) {
    .proposal-layout--with-toc {
        grid-template-columns: 1fr;
    }

    .proposal-toc-sidebar {
        position: static;
        max-height: none;
        margin-bottom: var(--spacing-xl);
    }

    .toc-content {
        max-height: 300px;
    }
}

@media (max-width: 768px) {
    .proposal-title {
        font-size: 1.75rem;
    }

    .proposal-info-grid {
        grid-template-columns: 1fr;
    }
}
</style>



<script>
document.addEventListener('DOMContentLoaded', function() {
    const tocLinks = document.querySelectorAll('.toc-nav a');
    const headings = [];

    tocLinks.forEach(link => {
        const href = link.getAttribute('href');
        if (href && href.startsWith('#')) {
            const heading = document.getElementById(href.slice(1));
            if (heading) {
                headings.push({ element: heading, link: link });
            }
        }
    });

    function updateActiveLink() {
        const scrollPos = window.scrollY + 120;
        let activeIndex = 0;

        for (let i = 0; i < headings.length; i++) {
            if (headings[i].element.offsetTop <= scrollPos) {
                activeIndex = i;
            }
        }

        tocLinks.forEach(link => link.classList.remove('active'));
        if (headings[activeIndex]) {
            headings[activeIndex].link.classList.add('active');
        }
    }

    window.addEventListener('scroll', updateActiveLink);
    updateActiveLink();
});
</script>
<style>
.toc-nav a.active {
    color: var(--color-primary);
    background: var(--color-bg-tertiary);
    font-weight: 600;
}
</style>



    </main>

    <footer class="site-footer">
    <div class="container">
        <div class="footer-grid">
            <div class="footer-col footer-brand">
                <img src="../../../images/i2plogo_lightmode.svg" alt="I2P Logo" class="footer-logo logo-light" loading="lazy" decoding="async">
                <img src="../../../images/i2plogo_darkmode.svg" alt="I2P Logo" class="footer-logo logo-dark" loading="lazy" decoding="async">
                <p class="footer-tagline">Privacy. Security. Freedom.</p>
                <p class="footer-description">The Invisible Internet Project - A privacy-focused, anonymous network layer</p>

                <div class="footer-social-newsletter">
                    <div class="social-links">
                        <a href="https://mastodon.social/@i2p" target="_blank" rel="noopener" aria-label="Mastodon">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M21.327 8.566c0-4.339-2.843-5.61-2.843-5.61-1.433-.658-3.894-.935-6.451-.956h-.063c-2.557.021-5.016.298-6.45.956 0 0-2.843 1.272-2.843 5.61 0 .993-.019 2.181.012 3.441.103 4.243.778 8.425 4.701 9.463 1.809.479 3.362.579 4.612.51 2.268-.126 3.541-.809 3.541-.809l-.075-1.646s-1.621.511-3.441.449c-1.804-.062-3.707-.194-3.999-2.409a4.523 4.523 0 0 1-.04-.621s1.77.433 4.014.536c1.372.063 2.658-.08 3.965-.236 2.506-.299 4.688-1.843 4.962-3.254.434-2.223.398-5.424.398-5.424zm-3.353 5.59h-2.081V9.057c0-1.075-.452-1.62-1.357-1.62-1 0-1.501.647-1.501 1.927v2.791h-2.069V9.364c0-1.28-.501-1.927-1.502-1.927-.905 0-1.357.546-1.357 1.62v5.099H6.026V8.903c0-1.074.273-1.927.823-2.558.566-.631 1.307-.955 2.228-.955 1.065 0 1.872.409 2.405 1.228l.518.869.519-.869c.533-.819 1.34-1.228 2.405-1.228.92 0 1.662.324 2.228.955.549.631.822 1.484.822 2.558v5.253z"/>
                            </svg>
                        </a>
                        <a href="https://twitter.com/GetI2P" target="_blank" rel="noopener" aria-label="Twitter">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/>
                            </svg>
                        </a>
                        <a href="https://old.reddit.com/r/i2p" target="_blank" rel="noopener" aria-label="Reddit">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M12 0A12 12 0 0 0 0 12a12 12 0 0 0 12 12 12 12 0 0 0 12-12A12 12 0 0 0 12 0zm5.01 4.744c.688 0 1.25.561 1.25 1.249a1.25 1.25 0 0 1-2.498.056l-2.597-.547-.8 3.747c1.824.07 3.48.632 4.674 1.488.308-.309.73-.491 1.207-.491.968 0 1.754.786 1.754 1.754 0 .716-.435 1.333-1.01 1.614a3.111 3.111 0 0 1 .042.52c0 2.694-3.13 4.87-7.004 4.87-3.874 0-7.004-2.176-7.004-4.87 0-.183.015-.366.043-.534A1.748 1.748 0 0 1 4.028 12c0-.968.786-1.754 1.754-1.754.463 0 .898.196 1.207.49 1.207-.883 2.878-1.43 4.744-1.487l.885-4.182a.342.342 0 0 1 .14-.197.35.35 0 0 1 .238-.042l2.906.617a1.214 1.214 0 0 1 1.108-.701zM9.25 12C8.561 12 8 12.562 8 13.25c0 .687.561 1.248 1.25 1.248.687 0 1.248-.561 1.248-1.249 0-.688-.561-1.249-1.249-1.249zm5.5 0c-.687 0-1.248.561-1.248 1.25 0 .687.561 1.248 1.249 1.248.688 0 1.249-.561 1.249-1.249 0-.687-.562-1.249-1.25-1.249zm-5.466 3.99a.327.327 0 0 0-.231.094.33.33 0 0 0 0 .463c.842.842 2.484.913 2.961.913.477 0 2.105-.056 2.961-.913a.361.361 0 0 0 .029-.463.33.33 0 0 0-.464 0c-.547.533-1.684.73-2.512.73-.828 0-1.979-.196-2.512-.73a.326.326 0 0 0-.232-.095z"/>
                            </svg>
                        </a>
                        <a href="https://signal.group/#CjQKIOSUTtxlhbumAKcRsthPFkxkTUrkWcX39bbN6njLEgAIEhCTNsR0KDuiehAXZnkt42v5" target="_blank" rel="noopener" aria-label="Signal" class="signal-link">
                            <img src="../../../images/Signal-Logo-Black.svg" alt="Signal" class="signal-logo signal-logo-light" loading="lazy" decoding="async">
                            <img src="../../../images/Signal-Logo-White.svg" alt="Signal" class="signal-logo signal-logo-dark" loading="lazy" decoding="async">
                        </a>
                    </div>

                    
                    <div class="footer-newsletter-inline">
                        <p class="newsletter-description">I2P 뉴스 받기:</p>
                        <form action="https://feedback.i2p.net/api/mailing-list/subscribe" method="POST" class="newsletter-form">
                            <input type="email" name="email" placeholder="이메일을 입력하세요" required>
                            <button type="submit">구독하기</button>
                        </form>
                    </div>
                </div>
            </div>

            <div class="footer-col">
                <h3>빠른 링크</h3>
                <ul>
                    <li><a href="../../../ko/financial-support/">기부하기</a></li>
                    <li><a href="../../../ko/docs/overview/intro/">I2P 소개</a></li>
                </ul>
            </div>

            <div class="footer-col">
                <h3>커뮤니티</h3>
                <ul>
                    <li><a href="../../../ko/get-involved/">참여하기</a></li>
                    <li><a href="../../../ko/blog/">블로그</a></li>
                    <li><a href="http://i2pforum.net/" target="_blank" rel="noopener">공식 포럼</a></li>
                    <li><a href="../../../ko/contact/">연락처</a></li>
                </ul>
            </div>

            <div class="footer-col">
                <h3>리소스</h3>
                <ul>
                    <li><a href="https://i2p-metrics.np-tokumei.net/" target="_blank" rel="noopener">I2P 메트릭</a></li>
                    <li><a href="../../../ko/papers/">연구</a></li>
                    <li><a href="https://i2pgit.org/" target="_blank" rel="noopener">GitLab</a></li>
                    <li><a href="https://www.stormycloud.org/" target="_blank" rel="noopener">스톰이클라우드</a></li>
                </ul>
            </div>
        </div>

        <div class="footer-bottom">
            <p class="copyright">&copy; 2025 Invisible Internet Project. Creative Commons 라이선스 적용.</p>
            <div class="footer-links">
                <a href="../../../ko/privacy/">개인정보 처리방침</a>
                <a href="../../../ko/terms/">이용 약관</a>
                <a href="../../../ko/about/media/">언론</a>
            </div>
        </div>
    </div>
</footer>


    
    
<div class="modal-overlay" id="poll">
    <div class="modal-content poll-modal-content">
        <a href="#" class="modal-close" aria-label="닫기">
            <span aria-hidden="true">&times;</span>
        </a>

        <div class="modal-header">
            <h2>커뮤니티 설문 조사</h2>
            <p class="modal-subtitle">귀하의 의견을 듣고 싶습니다</p>
        </div>

        <div class="modal-body">
            
            <iframe 
                id="poll-iframe"
                data-poll-id="2"
                data-api-url="https://feedback.i2p.net"
                frameborder="0"
                scrolling="no"
                style="width: 100%; border: none; min-height: 400px;">
            </iframe>
        </div>

        <div class="modal-footer">
            <p class="modal-disclaimer">
                귀하의 투표는 I2P의 미래를 형성하는 데 도움이 됩니다.
            </p>
        </div>
    </div>
</div>


<script>
(function() {
    const iframe = document.getElementById('poll-iframe');
    if (!iframe) return;
    
    const hostname = window.location.hostname;
    let apiUrl = 'https://feedback.i2p.net';
    const pollId = iframe.getAttribute('data-poll-id') || '1';

    
    if (hostname.endsWith('.b32.i2p') || hostname.endsWith('.i2p')) {
        apiUrl = 'http://5kwyynf3eetgqa2nors6ctwo7doi7yu73k7uvypy5eqmm326zkiq.b32.i2p';
    }
    
    else if (hostname.endsWith('.onion')) {
        apiUrl = 'http://gfonxmohvarpmocsvllscsuszdu5rikipm6innvcwq4vpng7zzqmmfyd.onion';
    }

    
    const pollUrl = apiUrl + '/widgets/poll.html?poll_id=' + encodeURIComponent(pollId) + '&api_url=' + encodeURIComponent(apiUrl);
    iframe.src = pollUrl;
})();
</script>



    
    



    
    <script>
        (function () {
            'use strict';
            var hostname = window.location.hostname;
            var baseUrl;

            
            if (hostname.endsWith('.b32.i2p') || hostname.endsWith('.i2p')) {
                baseUrl = 'http://5kwyynf3eetgqa2nors6ctwo7doi7yu73k7uvypy5eqmm326zkiq.b32.i2p';
            } else if (hostname.endsWith('.onion')) {
                baseUrl = 'http://gfonxmohvarpmocsvllscsuszdu5rikipm6innvcwq4vpng7zzqmmfyd.onion';
            } else {
                baseUrl = 'https://feedback.i2p.net';
            }

            window.feedbackBaseUrl = baseUrl;

            
            document.querySelectorAll('[data-api-url]').forEach(function (widget) {
                widget.setAttribute('data-api-url', baseUrl);
            });

            
            document.write('<link rel="stylesheet" href="' + baseUrl + '/widgets/styles.css">');
            
        })();
    </script>

    

    
    
    

    

</body>

</html>
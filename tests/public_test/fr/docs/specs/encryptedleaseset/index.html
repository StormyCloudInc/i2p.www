<!DOCTYPE html>
<html lang="fr" data-theme="light">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <title>LeaseSet (ensemble de baux I2P) chiffré | I2P - Le projet Internet invisible</title>

    <meta name="description" content="Format de LeaseSet avec contrôle d&#39;accès pour les Destinations privées">
    <meta name="keywords" content="i2p, privacy, anonymity, dark net, encryption, security">

    
    <meta property="og:title" content="LeaseSet (ensemble de baux I2P) chiffré | I2P - Le projet Internet invisible">
    <meta property="og:description" content="Format de LeaseSet avec contrôle d&#39;accès pour les Destinations privées">
    <meta property="og:type" content="website">
    <meta property="og:url" content="/fr/docs/specs/encryptedleaseset/">

    
    <link rel="icon" type="image/svg+xml" href="../../../../images/favicon.svg">
    <link rel="icon" type="image/png" href="../../../../images/i2plogo.png" sizes="32x32">

    
    
    
    
    <link rel="stylesheet" href="../../../../css/main.min.be6880f32f5ff44e57579da7b11513b973319944ebe38748e3ac7f3268662d18.css" integrity="sha256-vmiA8y9f9E5XV52nsRUTuXMxmUTr44dI46x/MmhmLRg=">
    


    
</head>

<body>
    
    <input type="checkbox" id="theme-toggle-checkbox" class="theme-checkbox" aria-hidden="true">

    
<div class="site-banner" id="site-banner" data-banner-id="banner-3" role="alert" aria-live="polite">
    <div class="container">
        <div class="banner-content">
            <span class="banner-message">Site Bêta I2P Maintenant En Ligne Signaler les problèmes e-mail à stormycloud@mail.i2p</span>
            
        </div>
        
        <form method="GET" action="../../../../api/banner/dismiss" style="display: inline;">
            <input type="hidden" name="id" value="banner-3">
            <button type="submit" class="banner-close" aria-label="Fermer la bannière" title="Fermer la bannière">
                <span aria-hidden="true">&times;</span>
            </button>
        </form>
        
    </div>
</div>


    <header class="site-header">
    <div class="container">
        <nav class="main-nav">
            <div class="nav-brand">
                <a href="../../../../fr/" class="logo-link">
                    <img src="../../../../images/i2plogo_lightmode.svg" alt="I2P Logo" class="logo logo-light">
                    <img src="../../../../images/i2plogo_darkmode.svg" alt="I2P Logo" class="logo logo-dark">
                </a>
            </div>

            
            <input type="checkbox" id="mobile-menu-checkbox" class="mobile-menu-checkbox"
                aria-label="Toggle navigation menu">
            <label for="mobile-menu-checkbox" class="mobile-menu-toggle" aria-label="Toggle navigation menu">
                <span class="hamburger"></span>
            </label>

            <div class="nav-menu">
                <ul class="nav-links">
                    <li class="nav-dropdown">
                        <a href="../../../../fr/about/" class="">À propos</a>
                        <ul class="dropdown-menu">
                            <li><a href="../../../../fr/about/">Aperçu</a></li>
                            <li><a href="../../../../fr/papers/">Articles de recherche</a></li>
                            <li><a href="../../../../fr/about/media/">Presse</a></li>
                            <li><a href="../../../../fr/contact/">Contactez-nous</a></li>
                        </ul>
                    </li>
                    <li><a href="../../../../fr/docs/" class="active">Docs</a></li>
                    <li><a href="../../../../fr/downloads/" class="">Téléchargements</a></li>
                    <li><a href="../../../../fr/blog/" class="">Blog</a></li>
                    <li class="nav-dropdown">
                        <a href="../../../../fr/get-involved/" class="">S&#39;impliquer</a>
                        <ul class="dropdown-menu">
                            <li><a href="../../../../fr/get-involved/">Aperçu</a></li>
                            <li><a href="../../../../fr/feedback/">Suggestions de fonctionnalités</a></li>
                        </ul>
                    </li>
                </ul>

                <div class="nav-actions">
                    
                    <div class="language-selector">
                        <button class="language-toggle" aria-label="Select language" title="Language">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none"
                                xmlns="http://www.w3.org/2000/svg">
                                <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2" />
                                <path
                                    d="M2 12h20M12 2a15.3 15.3 0 014 10 15.3 15.3 0 01-4 10 15.3 15.3 0 01-4-10 15.3 15.3 0 014-10z"
                                    stroke="currentColor" stroke-width="2" />
                            </svg>
                            <span class="current-lang">fr</span>
                        </button>
                        <div class="language-dropdown">
                            
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../../en/docs/specs/encryptedleaseset/"
                                class="lang-option">Anglais</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../../es/docs/specs/encryptedleaseset/"
                                class="lang-option">Espagnol</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../../ko/docs/specs/encryptedleaseset/"
                                class="lang-option">Coréen</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../../zh/docs/specs/encryptedleaseset/"
                                class="lang-option">Chinois</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../../ru/docs/specs/encryptedleaseset/"
                                class="lang-option">Russe</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../../cs/docs/specs/encryptedleaseset/"
                                class="lang-option">Tchèque</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../../de/docs/specs/encryptedleaseset/"
                                class="lang-option">Allemand</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../../fr/docs/specs/encryptedleaseset/"
                                class="lang-option active">Français</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../../tr/docs/specs/encryptedleaseset/"
                                class="lang-option">Turc</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../../vi/docs/specs/encryptedleaseset/"
                                class="lang-option">Vietnamien</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../../hi/docs/specs/encryptedleaseset/"
                                class="lang-option">Hindi</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../../ar/docs/specs/encryptedleaseset/"
                                class="lang-option">Arabe</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../../pt/docs/specs/encryptedleaseset/"
                                class="lang-option">Portugais</a>
                            
                            
                        </div>
                    </div>

                    
                    <label for="theme-toggle-checkbox" class="theme-toggle" aria-label="Toggle dark mode"
                        title="Toggle theme">
                        <svg class="sun-icon" width="20" height="20" viewBox="0 0 20 20" fill="none"
                            xmlns="http://www.w3.org/2000/svg">
                            <circle cx="10" cy="10" r="4" stroke="currentColor" stroke-width="2" />
                            <path
                                d="M10 2V4M10 16V18M18 10H16M4 10H2M15.657 4.343L14.243 5.757M5.757 14.243L4.343 15.657M15.657 15.657L14.243 14.243M5.757 5.757L4.343 4.343"
                                stroke="currentColor" stroke-width="2" stroke-linecap="round" />
                        </svg>
                        <svg class="moon-icon" width="20" height="20" viewBox="0 0 20 20" fill="none"
                            xmlns="http://www.w3.org/2000/svg">
                            <path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"
                                stroke="currentColor" stroke-width="2" stroke-linejoin="round" />
                        </svg>
                    </label>

                    
                    <a href="../../../../fr/financial-support/" class="btn btn-primary" id="donate-btn">Donate</a>

                    
                    <a href="../../../../fr/downloads/" class="btn btn-primary">Obtenir I2P</a>
                </div>
            </div>
        </nav>
    </div>
</header>

    <main id="main-content">
        




<div class="docs-page">
    <div class="container">
        
        <div class="docs-layout docs-layout--with-toc">
            
            
            <aside class="docs-toc-sidebar">
                <nav class="toc-nav">
                    <div class="toc-header">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                            <path d="M4 6h16M4 12h16M4 18h16" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                        </svg>
                        On This Page
                    </div>
                    <div class="toc-content">
                        <nav id="TableOfContents">
  <ul>
    <li><a href="#aperçu">Aperçu</a></li>
    <li><a href="#historique-des-versions-et-état-de-limplémentation">Historique des versions et état de l’implémentation</a>
      <ul>
        <li><a href="#chronologie-du-développement-du-protocole">Chronologie du développement du protocole</a></li>
        <li><a href="#jalons-dimplémentation">Jalons d’implémentation</a></li>
      </ul>
    </li>
    <li><a href="#définitions-cryptographiques">Définitions cryptographiques</a>
      <ul>
        <li><a href="#notations-et-conventions">Notations et conventions</a></li>
        <li><a href="#csrngn">CSRNG(n)</a></li>
        <li><a href="#hp-d">H(p, d)</a></li>
        <li><a href="#chiffrement-par-flux-chacha20">Chiffrement par flux: ChaCha20</a></li>
        <li><a href="#sig--red25519-algorithme-de-signature-ed25519-utilisé-par-i2p">SIG : Red25519 (algorithme de signature Ed25519 utilisé par I2P)</a></li>
        <li><a href="#dh-x25519">DH: X25519</a></li>
        <li><a href="#hkdf-fonction-de-dérivation-de-clés-basée-sur-hmac">HKDF (fonction de dérivation de clés basée sur HMAC)</a></li>
      </ul>
    </li>
    <li><a href="#spécification-du-format">Spécification du format</a>
      <ul>
        <li><a href="#couche-0-externe---texte-en-clair">Couche 0 (Externe) - Texte en clair</a></li>
        <li><a href="#couche-1-intermédiaire---autorisation-du-client">Couche 1 (Intermédiaire) - Autorisation du client</a></li>
        <li><a href="#couche-2-interne---données-du-leaseset">Couche 2 (interne) - Données du LeaseSet</a></li>
      </ul>
    </li>
    <li><a href="#dérivation-de-la-clé-daveuglement">Dérivation de la clé d&rsquo;aveuglement</a>
      <ul>
        <li><a href="#aperçu-1">Aperçu</a></li>
        <li><a href="#définitions-mathématiques">Définitions mathématiques</a></li>
        <li><a href="#génération-alpha">Génération Alpha</a></li>
        <li><a href="#aveuglement-de-clé-privée">Aveuglement de clé privée</a></li>
        <li><a href="#aveuglement-de-clé-publique">Aveuglement de clé publique</a></li>
        <li><a href="#signature-avec-des-clés-aveuglées">Signature avec des clés aveuglées</a></li>
        <li><a href="#considérations-de-sécurité">Considérations de sécurité</a></li>
      </ul>
    </li>
    <li><a href="#chiffrement-et-traitement">Chiffrement et traitement</a>
      <ul>
        <li><a href="#dérivation-du-subcredential-élément-didentification-dérivé">Dérivation du Subcredential (élément d&rsquo;identification dérivé)</a></li>
        <li><a href="#chiffrement-de-la-couche-1">Chiffrement de la couche 1</a></li>
        <li><a href="#chiffrement-de-la-couche-2">Chiffrement de la couche 2</a></li>
        <li><a href="#résumé-de-la-couche-de-chiffrement">Résumé de la couche de chiffrement</a></li>
      </ul>
    </li>
    <li><a href="#autorisation-par-client">Autorisation par client</a>
      <ul>
        <li><a href="#vue-densemble">Vue d&rsquo;ensemble</a></li>
        <li><a href="#autorisation-du-client-via-dh-échange-de-clés-diffiehellman">Autorisation du client via DH (échange de clés Diffie–Hellman)</a></li>
        <li><a href="#autorisation-du-client-par-psk">Autorisation du client par PSK</a></li>
        <li><a href="#comparaison-et-recommandations">Comparaison et recommandations</a></li>
        <li><a href="#considérations-de-sécurité-1">Considérations de sécurité</a></li>
      </ul>
    </li>
    <li><a href="#adressage-en-base32-pour-les-leasesets-chiffrés-ensembles-de-baux">Adressage en Base32 pour les LeaseSets chiffrés (ensembles de baux)</a>
      <ul>
        <li><a href="#vue-densemble-1">Vue d&rsquo;ensemble</a></li>
        <li><a href="#spécification-du-format-dadresse">Spécification du format d&rsquo;adresse</a></li>
        <li><a href="#génération-dadresses">Génération d&rsquo;adresses</a></li>
        <li><a href="#analyse-syntaxique-des-adresses">Analyse syntaxique des adresses</a></li>
        <li><a href="#comparaison-avec-le-base32-traditionnel">Comparaison avec le Base32 traditionnel</a></li>
        <li><a href="#intégration-du-carnet-dadresses">Intégration du carnet d’adresses</a></li>
        <li><a href="#exemples-dimplémentation">Exemples d&rsquo;implémentation</a></li>
        <li><a href="#considérations-de-sécurité-2">Considérations de sécurité</a></li>
      </ul>
    </li>
    <li><a href="#prise-en-charge-des-clés-hors-ligne">Prise en charge des clés hors ligne</a>
      <ul>
        <li><a href="#aperçu-2">Aperçu</a></li>
        <li><a href="#structure-de-la-clé-hors-ligne">Structure de la clé hors ligne</a></li>
        <li><a href="#processus-de-génération-de-clés">Processus de génération de clés</a></li>
      </ul>
    </li>
  </ul>

  <ul>
    <li>
      <ul>
        <li><a href="#security-considerations">Security Considerations</a></li>
        <li><a href="#file-format-todo">File Format (TODO)</a></li>
        <li><a href="#i2cp-protocol-enhancement-todo">I2CP Protocol Enhancement (TODO)</a></li>
        <li><a href="#implementation-status">Implementation Status</a></li>
      </ul>
    </li>
    <li><a href="#security-considerations-1">Security Considerations</a>
      <ul>
        <li><a href="#cryptographic-security">Cryptographic Security</a></li>
        <li><a href="#forward-secrecy">Forward Secrecy</a></li>
        <li><a href="#privacy-properties">Privacy Properties</a></li>
        <li><a href="#threat-model">Threat Model</a></li>
        <li><a href="#attack-scenarios">Attack Scenarios</a></li>
        <li><a href="#operational-security">Operational Security</a></li>
        <li><a href="#implementation-security">Implementation Security</a></li>
        <li><a href="#recommendations">Recommendations</a></li>
      </ul>
    </li>
    <li><a href="#implementation-notes">Implementation Notes</a>
      <ul>
        <li><a href="#java-i2p-implementation">Java I2P Implementation</a></li>
        <li><a href="#i2pd-c-implementation">i2pd (C++) Implementation</a></li>
        <li><a href="#testing-and-debugging">Testing and Debugging</a></li>
        <li><a href="#performance-considerations">Performance Considerations</a></li>
        <li><a href="#compatibility">Compatibility</a></li>
      </ul>
    </li>
    <li><a href="#references">References</a>
      <ul>
        <li><a href="#ietf-rfcs">IETF RFCs</a></li>
        <li><a href="#i2p-specifications">I2P Specifications</a></li>
        <li><a href="#cryptographic-references">Cryptographic References</a></li>
        <li><a href="#security-references">Security References</a></li>
        <li><a href="#implementation-references">Implementation References</a></li>
        <li><a href="#version-history">Version History</a></li>
      </ul>
    </li>
    <li><a href="#appendix-a-cryptographic-constants">Appendix A: Cryptographic Constants</a>
      <ul>
        <li><a href="#ed25519--red25519-constants">Ed25519 / Red25519 Constants</a></li>
        <li><a href="#chacha20-constants">ChaCha20 Constants</a></li>
        <li><a href="#hkdf-constants">HKDF Constants</a></li>
        <li><a href="#hash-personalization-strings">Hash Personalization Strings</a></li>
        <li><a href="#structure-sizes">Structure Sizes</a></li>
      </ul>
    </li>
    <li><a href="#appendix-b-test-vectors">Appendix B: Test Vectors</a>
      <ul>
        <li><a href="#test-vector-1-alpha-generation">Test Vector 1: Alpha Generation</a></li>
        <li><a href="#test-vector-2-chacha20-encryption">Test Vector 2: ChaCha20 Encryption</a></li>
        <li><a href="#test-vector-3-hkdf">Test Vector 3: HKDF</a></li>
        <li><a href="#test-vector-4-base32-address">Test Vector 4: Base32 Address</a></li>
      </ul>
    </li>
    <li><a href="#appendix-c-glossary">Appendix C: Glossary</a></li>
    <li><a href="#document-information">Document Information</a></li>
  </ul>
</nav>
                    </div>
                </nav>
            </aside>
            

            
            <div class="docs-main">
                
                <nav class="breadcrumbs">
                    <a href="../../../../fr/">Home</a>
                    <span class="separator">/</span>
                    <a href="../../../../fr/docs/">Docs</a>
                    
                        
                            <span class="separator">/</span>
                            <a href="../../../../fr/docs/specs/">Specifications</a>
                        
                    
                    <span class="separator">/</span>
                    <span class="current">LeaseSet (ensemble de baux I2P) chiffré</span>
                </nav>

                
<div class="translation-disclaimer" role="note">
    <span class="disclaimer-message">Cette traduction a été générée par apprentissage automatique et peut ne pas être exacte à 100%.</span>
    
    
    <a href="../../../../en/docs/specs/encryptedleaseset/" class="disclaimer-link">Voir la version anglaise</a>
    
</div>



                
                <header class="article-header">
                    <h1 class="article-title">LeaseSet (ensemble de baux I2P) chiffré</h1>
                    
                        <p class="article-description">Format de LeaseSet avec contrôle d&#39;accès pour les Destinations privées</p>
                    
                    <div class="article-meta">
                        
                            <span class="meta-item">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                                    <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2"/>
                                    <path d="M12 6v6l4 2" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                                </svg>
                                Updated: 2025-10
                            </span>
                        
                        
                            <span class="meta-item">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                                    <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" stroke="currentColor" stroke-width="2"/>
                                </svg>
                                Accurate for: 2.10.0
                            </span>
                        
                    </div>
                </header>

                
                <article class="article-content">
                    <h2 id="aperçu">Aperçu</h2>
<p>Ce document spécifie l’aveuglement, le chiffrement et le déchiffrement du LeaseSet2 (LS2) chiffré. Les LeaseSets chiffrés permettent la publication, avec contrôle d’accès, d’informations relatives aux services cachés dans la base de données du réseau I2P.</p>
<p><strong>Fonctionnalités clés:</strong> - Rotation quotidienne des clés pour une confidentialité persistante - Autorisation client à deux niveaux (basée sur DH et basée sur PSK) - Chiffrement ChaCha20 pour des performances accrues sur les appareils sans accélération matérielle AES - Signatures Red25519 avec aveuglement de clé - Adhésion des clients respectueuse de la vie privée</p>
<p><strong>Documentation associée :</strong> - <a href="../../../../fr/docs/specs/common-structures/">Spécification des structures communes</a>
 - Structure de LeaseSet (jeu de baux I2P) chiffré - <a href="../../../../fr/proposals/123-new-netdb-entries/">Proposition 123 : Nouvelles entrées netDB</a>
 - Contexte sur les LeaseSets chiffrés - <a href="../../../../fr/docs/specs/common-structures/">Documentation de la base de données réseau</a>
 - Utilisation de NetDB (base de données réseau I2P)</p>
<hr>
<h2 id="historique-des-versions-et-état-de-limplémentation">Historique des versions et état de l’implémentation</h2>
<h3 id="chronologie-du-développement-du-protocole">Chronologie du développement du protocole</h3>
<p><strong>Note importante sur la numérotation des versions :</strong>   I2P utilise deux systèmes distincts de numérotation des versions : - <strong>Version API/Router :</strong> série 0.9.x (utilisée dans les spécifications techniques) - <strong>Version de publication du produit :</strong> série 2.x.x (utilisée pour les versions publiques)</p>
<p>Les spécifications techniques font référence aux versions de l&rsquo;API (p. ex., 0.9.41), tandis que les utilisateurs finaux voient des versions du produit (p. ex., 2.10.0).</p>
<h3 id="jalons-dimplémentation">Jalons d’implémentation</h3>
<table style="width:100%; border-collapse:collapse; margin-bottom:1.5rem;">
  <thead>
    <tr>
      <th style="border:1px solid var(--color-border); padding:0.5rem; background:var(--color-bg-secondary); text-align:left;">Version</th>
      <th style="border:1px solid var(--color-border); padding:0.5rem; background:var(--color-bg-secondary); text-align:center;">Release Date</th>
      <th style="border:1px solid var(--color-border); padding:0.5rem; background:var(--color-bg-secondary); text-align:left;">Features</th>
    </tr>
  </thead>
  <tbody>
    <tr><td style="border:1px solid var(--color-border); padding:0.5rem;"><strong>0.9.38</strong></td><td style="border:1px solid var(--color-border); padding:0.5rem; text-align:center;">January 2019</td><td style="border:1px solid var(--color-border); padding:0.5rem;">Floodfill support for standard LS2, offline keys</td></tr>
    <tr><td style="border:1px solid var(--color-border); padding:0.5rem;"><strong>0.9.39</strong></td><td style="border:1px solid var(--color-border); padding:0.5rem; text-align:center;">March 2019</td><td style="border:1px solid var(--color-border); padding:0.5rem;">Full encrypted LS2 support, Red25519 (sig type&nbsp;11)</td></tr>
    <tr><td style="border:1px solid var(--color-border); padding:0.5rem;"><strong>0.9.40</strong></td><td style="border:1px solid var(--color-border); padding:0.5rem; text-align:center;">May 2019</td><td style="border:1px solid var(--color-border); padding:0.5rem;"><strong>Per-client authorization, encrypted LS2 with offline keys, B32 support</strong></td></tr>
    <tr><td style="border:1px solid var(--color-border); padding:0.5rem;"><strong>0.9.41</strong></td><td style="border:1px solid var(--color-border); padding:0.5rem; text-align:center;">June 2019</td><td style="border:1px solid var(--color-border); padding:0.5rem;"><strong>Protocol finalized as stable</strong></td></tr>
    <tr><td style="border:1px solid var(--color-border); padding:0.5rem;"><strong>2.10.0</strong></td><td style="border:1px solid var(--color-border); padding:0.5rem; text-align:center;">September 2025</td><td style="border:1px solid var(--color-border); padding:0.5rem;">Latest Java implementation (API version 0.9.61)</td></tr>
    <tr><td style="border:1px solid var(--color-border); padding:0.5rem;"><strong>i2pd 2.58.0</strong></td><td style="border:1px solid var(--color-border); padding:0.5rem; text-align:center;">September 2025</td><td style="border:1px solid var(--color-border); padding:0.5rem;">Full C++ implementation compatibility</td></tr>
  </tbody>
</table>
### État actuel
<ul>
<li>✅ <strong>État du protocole:</strong> Stable et inchangé depuis juin 2019</li>
<li>✅ <strong>Java I2P:</strong> Entièrement implémenté à partir de la version 0.9.40+</li>
<li>✅ <strong>i2pd (C++):</strong> Entièrement implémenté à partir de la version 2.58.0+</li>
<li>✅ <strong>Interopérabilité:</strong> Complète entre les implémentations</li>
<li>✅ <strong>Déploiement réseau:</strong> Prêt pour la production, avec plus de 6 ans d&rsquo;expérience opérationnelle</li>
</ul>
<hr>
<h2 id="définitions-cryptographiques">Définitions cryptographiques</h2>
<h3 id="notations-et-conventions">Notations et conventions</h3>
<ul>
<li><code>||</code> désigne la concaténation</li>
<li><code>mod L</code> désigne la réduction modulo l’ordre d’Ed25519</li>
<li>Tous les tableaux d’octets sont en ordre d’octets réseau (big-endian) sauf indication contraire</li>
<li>Les valeurs little-endian sont explicitement indiquées</li>
</ul>
<h3 id="csrngn">CSRNG(n)</h3>
<p><strong>Générateur de nombres aléatoires cryptographiquement sûr</strong></p>
<p>Produit <code>n</code> octets de données aléatoires cryptographiquement sûres, adaptées à la génération de key material (matériel de clés).</p>
<p><strong>Exigences de sécurité:</strong> - Doit être sécurisé sur le plan cryptographique (adapté à la génération de clés) - Doit rester sûr lorsque des séquences d’octets adjacentes sont exposées sur le réseau - Les implémentations devraient hacher la sortie provenant de sources potentiellement non fiables</p>
<p><strong>Références :</strong> - <a href="http://projectbullrun.org/dual-ec/ext-rand.html">Considérations de sécurité concernant les PRNG</a>
 - <a href="https://lists.torproject.org/pipermail/tor-dev/2015-November/009954.html">Discussion des développeurs de Tor</a>
</p>
<h3 id="hp-d">H(p, d)</h3>
<p><strong>Hachage SHA-256 avec personnalisation</strong></p>
<p>Fonction de hachage à séparation de domaine qui prend: - <code>p</code>: chaîne de personnalisation (fournit la séparation de domaine) - <code>d</code>: données à hacher</p>
<p><strong>Implémentation:</strong></p>
<pre tabindex="0"><code>H(p, d) := SHA-256(p || d)
</code></pre><p><strong>Utilisation:</strong> Fournit une séparation de domaines cryptographique pour empêcher les attaques par collision entre différents usages protocolaires de SHA-256.</p>
<h3 id="chiffrement-par-flux-chacha20">Chiffrement par flux: ChaCha20</h3>
<p><strong>Chiffre de flux : ChaCha20 conformément à la RFC 7539, section 2.4</strong></p>
<p><strong>Paramètres:</strong> - <code>S_KEY_LEN = 32</code> (clé de 256 bits) - <code>S_IV_LEN = 12</code> (nonce de 96 bits, nombre utilisé une seule fois) - Compteur initial: <code>1</code> (RFC 7539 autorise 0 ou 1 ; 1 est recommandé pour les contextes AEAD)</p>
<p><strong>CHIFFRER(k, iv, plaintext)</strong></p>
<p>Chiffre le texte en clair à l&rsquo;aide de: - <code>k</code>: clé de chiffrement de 32 octets - <code>iv</code>: nonce de 12 octets (DOIT être unique pour chaque clé) - Renvoie un texte chifré de la même taille que le texte en clair</p>
<p><strong>Propriété de sécurité :</strong> L’intégralité du texte chiffré doit être indiscernable d’une donnée aléatoire si la clé est secrète.</p>
<p><strong>DÉCHIFFRER(k, iv, ciphertext)</strong></p>
<p>Déchiffre le texte chiffré en utilisant: - <code>k</code>: clé de chiffrement de 32 octets - <code>iv</code>: nonce de 12 octets - Renvoie le texte en clair</p>
<p><strong>Justification de la conception :</strong> ChaCha20 a été préféré à AES car : - 2,5 à 3× plus rapide qu’AES sur les appareils sans accélération matérielle - Implémentation en temps constant plus facile à réaliser - Sécurité et vitesse comparables lorsque AES-NI est disponible</p>
<p><strong>Références:</strong> - <a href="https://datatracker.ietf.org/doc/html/rfc7539">RFC 7539</a>
 - ChaCha20 et Poly1305 pour les protocoles de l&rsquo;IETF</p>
<h3 id="sig--red25519-algorithme-de-signature-ed25519-utilisé-par-i2p">SIG : Red25519 (algorithme de signature Ed25519 utilisé par I2P)</h3>
<p><strong>Schéma de signature : Red25519 (SigType 11) avec Key Blinding (aveuglement de clé)</strong></p>
<p>Red25519 est basé sur des signatures Ed25519 sur la courbe Ed25519, utilisant SHA-512 pour le hachage, avec prise en charge de l&rsquo;aveuglement de clé tel que spécifié dans ZCash RedDSA.</p>
<p><strong>Fonctions :</strong></p>
<h4 id="derive_publicprivkey">DERIVE_PUBLIC(privkey)</h4>
<p>Renvoie la clé publique correspondant à la clé privée fournie. - Utilise la multiplication scalaire standard d&rsquo;Ed25519 par le point de base</p>
<h4 id="signprivkey-m">SIGN(privkey, m)</h4>
<p>Renvoie une signature générée par la clé privée <code>privkey</code> pour le message <code>m</code>.</p>
<p><strong>Différences de signature Red25519 par rapport à Ed25519 :</strong> 1. <strong>Nonce aléatoire (valeur aléatoire à usage unique) :</strong> Utilise 80 octets de données aléatoires supplémentaires</p>
<pre tabindex="0"><code>T = CSRNG(80)  // 80 random bytes
r = H*(T || publickey || message)
</code></pre><p>Cela rend chaque signature Red25519 (variante randomisée d&rsquo;Ed25519) unique, même pour le même message et la même clé.</p>
<ol start="2">
<li><strong>Génération de clés privées:</strong> Les clés privées Red25519 sont générées à partir de nombres aléatoires et réduites <code>mod L</code>, plutôt que d&rsquo;utiliser l&rsquo;approche de bit-clamping d&rsquo;Ed25519 (ajustement des bits par masquage).</li>
</ol>
<h4 id="verifypubkey-m-sig">VERIFY(pubkey, m, sig)</h4>
<p>Vérifie la signature <code>sig</code> par rapport à la clé publique <code>pubkey</code> et au message <code>m</code>. - Renvoie <code>true</code> si la signature est valide, <code>false</code> sinon - La vérification est identique à celle d’Ed25519</p>
<p><strong>Opérations d&rsquo;aveuglement de clé:</strong></p>
<h4 id="generate_alphadata-secret">GENERATE_ALPHA(data, secret)</h4>
<p>Génère alpha pour l&rsquo;aveuglement de clé. - <code>data</code>: Contient généralement la clé publique de signature et les types de signature - <code>secret</code>: Secret additionnel optionnel (de longueur nulle s&rsquo;il n&rsquo;est pas utilisé) - Le résultat a la même distribution que les clés privées Ed25519 (après réduction mod L)</p>
<h4 id="blind_privkeyprivkey-alpha">BLIND_PRIVKEY(privkey, alpha)</h4>
<p>Procède à l’aveuglement d’une clé privée à l’aide du secret <code>alpha</code>. - Implémentation : <code>blinded_privkey = (privkey + alpha) mod L</code> - Utilise l’arithmétique scalaire dans le corps</p>
<h4 id="blind_pubkeypubkey-alpha">BLIND_PUBKEY(pubkey, alpha)</h4>
<p>Aveugle une clé publique à l&rsquo;aide du secret <code>alpha</code>. - Implémentation: <code>blinded_pubkey = pubkey + DERIVE_PUBLIC(alpha)</code> - Utilise l&rsquo;addition d&rsquo;éléments du groupe (points) sur la courbe</p>
<p><strong>Propriété critique:</strong></p>
<pre tabindex="0"><code>BLIND_PUBKEY(pubkey, alpha) == DERIVE_PUBLIC(BLIND_PRIVKEY(privkey, alpha))
</code></pre><p><strong>Considérations de sécurité :</strong></p>
<p>D’après la spécification du protocole ZCash, section 5.4.6.1 : Pour des raisons de sécurité, alpha doit avoir la même distribution que les clés privées démasquées. Cela garantit que &ldquo;la combinaison d’une clé publique ré-aléatoirisée et de signature(s) effectuée(s) avec cette clé ne révèle pas la clé d’origine à partir de laquelle elle a été ré-aléatoirisée&rdquo;.</p>
<p><strong>Types de signatures pris en charge:</strong> - <strong>Type 7 (Ed25519):</strong> Pris en charge pour les destinations existantes (rétrocompatibilité) - <strong>Type 11 (Red25519):</strong> Recommandé pour les nouvelles destinations utilisant le chiffrement - <strong>Clés aveuglées:</strong> Utilisez toujours le type 11 (Red25519)</p>
<p><strong>Références:</strong> - <a href="https://zips.z.cash/protocol/protocol.pdf">Spécification du protocole ZCash</a>
 - Section 5.4.6 RedDSA - <a href="../../../../fr/docs/specs/red25519-signature-scheme/">Spécification Red25519 d&rsquo;I2P</a>
</p>
<h3 id="dh-x25519">DH: X25519</h3>
<p><strong>Diffie-Hellman sur courbe elliptique: X25519</strong></p>
<p>Système de négociation de clé publique basé sur Curve25519.</p>
<p><strong>Paramètres:</strong> - Clés privées: 32 octets - Clés publiques: 32 octets - Sortie du secret partagé: 32 octets</p>
<p><strong>Fonctions :</strong></p>
<h4 id="generate_private">GENERATE_PRIVATE()</h4>
<p>Génère une nouvelle clé privée de 32 octets à l&rsquo;aide d&rsquo;un CSRNG (générateur de nombres aléatoires cryptographiquement sécurisé).</p>
<h4 id="derive_publicprivkey-1">DERIVE_PUBLIC(privkey)</h4>
<p>Dérive la clé publique de 32 octets à partir de la clé privée donnée. - Utilise la multiplication scalaire sur Curve25519</p>
<h4 id="dhprivkey-pubkey">DH(privkey, pubkey)</h4>
<p>Effectue un accord de clé Diffie-Hellman. - <code>privkey</code>: Clé privée locale de 32 octets - <code>pubkey</code>: Clé publique distante de 32 octets - Renvoie: Secret partagé de 32 octets</p>
<p><strong>Propriétés de sécurité:</strong> - Hypothèse Diffie-Hellman computationnelle sur Curve25519 - Confidentialité persistante lorsque des clés éphémères sont utilisées - Implémentation en temps constant requise pour prévenir les attaques temporelles</p>
<p><strong>Références:</strong> - <a href="https://datatracker.ietf.org/doc/html/rfc7748">RFC 7748</a>
 - Courbes elliptiques pour la sécurité</p>
<h3 id="hkdf-fonction-de-dérivation-de-clés-basée-sur-hmac">HKDF (fonction de dérivation de clés basée sur HMAC)</h3>
<p><strong>Fonction de dérivation de clé basée sur HMAC</strong></p>
<p>Extrait et étend des données de clé à partir des données de clé d&rsquo;entrée.</p>
<p><strong>Paramètres:</strong> - <code>salt</code>: 32 octets maximum (généralement 32 octets pour SHA-256) - <code>ikm</code>: matériau de clé d&rsquo;entrée (de longueur quelconque, doit présenter une bonne entropie) - <code>info</code>: informations spécifiques au contexte (séparation des domaines) - <code>n</code>: longueur de sortie en octets</p>
<p><strong>Implémentation:</strong></p>
<p>Utilise HKDF (fonction de dérivation de clés basée sur HMAC) tel que spécifié dans la RFC 5869 avec: - <strong>Fonction de hachage:</strong> SHA-256 - <strong>HMAC:</strong> Tel que spécifié dans la RFC 2104 - <strong>Longueur du sel:</strong> Maximum 32 octets (HashLen pour SHA-256)</p>
<p><strong>Schéma d’utilisation:</strong></p>
<pre tabindex="0"><code>keys = HKDF(salt, ikm, info, n)
</code></pre><p><strong>Séparation des domaines:</strong> Le paramètre <code>info</code> assure une séparation cryptographique des domaines entre les différentes utilisations de HKDF dans le protocole.</p>
<p><strong>Valeurs d&rsquo;informations vérifiées:</strong> - &ldquo;ELS2_L1K&rdquo; - Chiffrement de la couche 1 (externe) - &ldquo;ELS2_L2K&rdquo; - Chiffrement de la couche 2 (interne) - &ldquo;ELS2_XCA&rdquo; - Autorisation client DH - &ldquo;ELS2PSKA&rdquo; - Autorisation client PSK - &ldquo;i2pblinding1&rdquo; - Génération alpha</p>
<p><strong>Références:</strong> - <a href="https://datatracker.ietf.org/doc/html/rfc5869">RFC 5869</a>
 - Spécification HKDF - <a href="https://datatracker.ietf.org/doc/html/rfc2104">RFC 2104</a>
 - Spécification HMAC</p>
<hr>
<h2 id="spécification-du-format">Spécification du format</h2>
<p>LS2 (version 2 de LeaseSet) chiffré se compose de trois couches imbriquées :</p>
<ol>
<li><strong>Couche 0 (Externe):</strong> Informations en clair pour le stockage et la récupération</li>
<li><strong>Couche 1 (Intermédiaire):</strong> Données d&rsquo;authentification du client (chiffrées)</li>
<li><strong>Couche 2 (Interne):</strong> Données LeaseSet2 proprement dites (chiffrées)</li>
</ol>
<p><strong>Structure générale:</strong></p>
<pre tabindex="0"><code>Layer 0 data + Enc(layer 1 data + Enc(layer 2 data)) + Signature
</code></pre><p><strong>Important:</strong> Le LS2 (format LeaseSet de seconde génération) chiffré utilise des clés aveuglées. La Destination (identité publique I2P) ne figure pas dans l&rsquo;en-tête. L&rsquo;emplacement de stockage dans la DHT est <code>SHA-256(sig type || blinded public key)</code>, avec rotation quotidienne.</p>
<h3 id="couche-0-externe---texte-en-clair">Couche 0 (Externe) - Texte en clair</h3>
<p>La couche 0 n&rsquo;utilise PAS l&rsquo;en-tête LS2 standard. Elle utilise un format personnalisé optimisé pour les clés aveuglées.</p>
<p><strong>Structure:</strong></p>
<table style="width:100%; border-collapse:collapse; margin-bottom:1.5rem;">
  <thead>
    <tr>
      <th style="border:1px solid var(--color-border); padding:0.5rem; background:var(--color-bg-secondary); text-align:left;">Field</th>
      <th style="border:1px solid var(--color-border); padding:0.5rem; background:var(--color-bg-secondary); text-align:center;">Size</th>
      <th style="border:1px solid var(--color-border); padding:0.5rem; background:var(--color-bg-secondary); text-align:left;">Description</th>
    </tr>
  </thead>
  <tbody>
    <tr><td style="border:1px solid var(--color-border); padding:0.5rem;">Type</td><td style="border:1px solid var(--color-border); padding:0.5rem; text-align:center;">1 byte</td><td style="border:1px solid var(--color-border); padding:0.5rem;">Not in header, from DatabaseStore message field</td></tr>
    <tr><td style="border:1px solid var(--color-border); padding:0.5rem;">Blinded Public Key Sig Type</td><td style="border:1px solid var(--color-border); padding:0.5rem; text-align:center;">2 bytes</td><td style="border:1px solid var(--color-border); padding:0.5rem;">Big endian, always <code>0x000b</code> (Red25519 type 11)</td></tr>
    <tr><td style="border:1px solid var(--color-border); padding:0.5rem;">Blinded Public Key</td><td style="border:1px solid var(--color-border); padding:0.5rem; text-align:center;">32 bytes</td><td style="border:1px solid var(--color-border); padding:0.5rem;">Red25519 blinded public key</td></tr>
    <tr><td style="border:1px solid var(--color-border); padding:0.5rem;">Published Timestamp</td><td style="border:1px solid var(--color-border); padding:0.5rem; text-align:center;">4 bytes</td><td style="border:1px solid var(--color-border); padding:0.5rem;">Big endian, seconds since epoch (rolls over in 2106)</td></tr>
    <tr><td style="border:1px solid var(--color-border); padding:0.5rem;">Expires</td><td style="border:1px solid var(--color-border); padding:0.5rem; text-align:center;">2 bytes</td><td style="border:1px solid var(--color-border); padding:0.5rem;">Big endian, offset from published in seconds (max 65,535 &asymp; 18.2 hours)</td></tr>
    <tr><td style="border:1px solid var(--color-border); padding:0.5rem;">Flags</td><td style="border:1px solid var(--color-border); padding:0.5rem; text-align:center;">2 bytes</td><td style="border:1px solid var(--color-border); padding:0.5rem;">Bit flags (see below)</td></tr>
    <tr><td style="border:1px solid var(--color-border); padding:0.5rem;">[Optional] Transient Key Data</td><td style="border:1px solid var(--color-border); padding:0.5rem; text-align:center;">Variable</td><td style="border:1px solid var(--color-border); padding:0.5rem;">Present if flag bit&nbsp;0 is set</td></tr>
    <tr><td style="border:1px solid var(--color-border); padding:0.5rem;">lenOuterCiphertext</td><td style="border:1px solid var(--color-border); padding:0.5rem; text-align:center;">2 bytes</td><td style="border:1px solid var(--color-border); padding:0.5rem;">Big endian, length of outer ciphertext</td></tr>
    <tr><td style="border:1px solid var(--color-border); padding:0.5rem;">outerCiphertext</td><td style="border:1px solid var(--color-border); padding:0.5rem; text-align:center;">lenOuterCiphertext</td><td style="border:1px solid var(--color-border); padding:0.5rem;">Encrypted Layer&nbsp;1 data</td></tr>
    <tr><td style="border:1px solid var(--color-border); padding:0.5rem;">Signature</td><td style="border:1px solid var(--color-border); padding:0.5rem; text-align:center;">64 bytes</td><td style="border:1px solid var(--color-border); padding:0.5rem;">Red25519 signature over all preceding data</td></tr>
  </tbody>
</table>
**Champ Flags (2 octets, bits 15-0):** - **Bit 0:** Indicateur de clés hors ligne   - `0` = Aucune clé hors ligne   - `1` = Clés hors ligne présentes (des données de clés éphémères suivent) - **Bits 1-15:** Réservés, doivent être à 0 pour une compatibilité future
<p><strong>Données de clé éphémère (présent si le bit de drapeau 0 = 1):</strong></p>
<table style="width:100%; border-collapse:collapse; margin-bottom:1.5rem;">
  <thead>
    <tr>
      <th style="border:1px solid var(--color-border); padding:0.5rem; background:var(--color-bg-secondary); text-align:left;">Field</th>
      <th style="border:1px solid var(--color-border); padding:0.5rem; background:var(--color-bg-secondary); text-align:center;">Size</th>
      <th style="border:1px solid var(--color-border); padding:0.5rem; background:var(--color-bg-secondary); text-align:left;">Description</th>
    </tr>
  </thead>
  <tbody>
    <tr><td style="border:1px solid var(--color-border); padding:0.5rem;">Expires Timestamp</td><td style="border:1px solid var(--color-border); padding:0.5rem; text-align:center;">4 bytes</td><td style="border:1px solid var(--color-border); padding:0.5rem;">Big endian, seconds since epoch</td></tr>
    <tr><td style="border:1px solid var(--color-border); padding:0.5rem;">Transient Sig Type</td><td style="border:1px solid var(--color-border); padding:0.5rem; text-align:center;">2 bytes</td><td style="border:1px solid var(--color-border); padding:0.5rem;">Big endian, signature type</td></tr>
    <tr><td style="border:1px solid var(--color-border); padding:0.5rem;">Transient Signing Public Key</td><td style="border:1px solid var(--color-border); padding:0.5rem; text-align:center;">Variable</td><td style="border:1px solid var(--color-border); padding:0.5rem;">Length implied by signature type</td></tr>
    <tr><td style="border:1px solid var(--color-border); padding:0.5rem;">Signature</td><td style="border:1px solid var(--color-border); padding:0.5rem; text-align:center;">64 bytes</td><td style="border:1px solid var(--color-border); padding:0.5rem;">Signed by blinded public key; covers expires timestamp, transient sig type, and transient public key</td></tr>
  </tbody>
</table>
**Vérification de la signature :** - **Sans clés hors ligne :** Vérifier avec une clé publique aveuglée - **Avec des clés hors ligne :** Vérifier avec une clé publique temporaire
<p>La signature couvre toutes les données de Type à outerCiphertext (inclus).</p>
<h3 id="couche-1-intermédiaire---autorisation-du-client">Couche 1 (Intermédiaire) - Autorisation du client</h3>
<p><strong>Déchiffrement:</strong> Voir la section <a href="#layer-1-encryption">Chiffrement de la couche 1</a>
.</p>
<p><strong>Structure:</strong></p>
<table style="width:100%; border-collapse:collapse; margin-bottom:1.5rem;">
  <thead>
    <tr>
      <th style="border:1px solid var(--color-border); padding:0.5rem; background:var(--color-bg-secondary); text-align:left;">Field</th>
      <th style="border:1px solid var(--color-border); padding:0.5rem; background:var(--color-bg-secondary); text-align:center;">Size</th>
      <th style="border:1px solid var(--color-border); padding:0.5rem; background:var(--color-bg-secondary); text-align:left;">Description</th>
    </tr>
  </thead>
  <tbody>
    <tr><td style="border:1px solid var(--color-border); padding:0.5rem;">Flags</td><td style="border:1px solid var(--color-border); padding:0.5rem; text-align:center;">1 byte</td><td style="border:1px solid var(--color-border); padding:0.5rem;">Authorization flags (see below)</td></tr>
    <tr><td style="border:1px solid var(--color-border); padding:0.5rem;">[Optional] Auth Data</td><td style="border:1px solid var(--color-border); padding:0.5rem; text-align:center;">Variable</td><td style="border:1px solid var(--color-border); padding:0.5rem;">Present based on flags</td></tr>
    <tr><td style="border:1px solid var(--color-border); padding:0.5rem;">innerCiphertext</td><td style="border:1px solid var(--color-border); padding:0.5rem; text-align:center;">Variable</td><td style="border:1px solid var(--color-border); padding:0.5rem;">Encrypted Layer&nbsp;2 data (remainder)</td></tr>
  </tbody>
</table>
**Champ Flags (1 octet, bits 7-0):** - **Bit 0:** Mode d'autorisation   - `0` = Aucune autorisation par client (tout le monde)   - `1` = Autorisation par client (section d'authentification suivante) - **Bits 3-1:** Schéma d'authentification (uniquement si bit 0 = 1)   - `000` = authentification client DH   - `001` = authentification client PSK   - Autres réservés - **Bits 7-4:** Non utilisés, doivent être 0
<p><strong>Données d&rsquo;autorisation client DH (flags = 0x01, bits 3-1 = 000):</strong></p>
<table style="width:100%; border-collapse:collapse; margin-bottom:1.5rem;">
  <thead>
    <tr>
      <th style="border:1px solid var(--color-border); padding:0.5rem; background:var(--color-bg-secondary); text-align:left;">Field</th>
      <th style="border:1px solid var(--color-border); padding:0.5rem; background:var(--color-bg-secondary); text-align:center;">Size</th>
      <th style="border:1px solid var(--color-border); padding:0.5rem; background:var(--color-bg-secondary); text-align:left;">Description</th>
    </tr>
  </thead>
  <tbody>
    <tr><td style="border:1px solid var(--color-border); padding:0.5rem;">ephemeralPublicKey</td><td style="border:1px solid var(--color-border); padding:0.5rem; text-align:center;">32 bytes</td><td style="border:1px solid var(--color-border); padding:0.5rem;">Server's ephemeral X25519 public key</td></tr>
    <tr><td style="border:1px solid var(--color-border); padding:0.5rem;">clients</td><td style="border:1px solid var(--color-border); padding:0.5rem; text-align:center;">2 bytes</td><td style="border:1px solid var(--color-border); padding:0.5rem;">Big endian, number of client entries</td></tr>
    <tr><td style="border:1px solid var(--color-border); padding:0.5rem;">authClient[]</td><td style="border:1px solid var(--color-border); padding:0.5rem; text-align:center;">40 bytes each</td><td style="border:1px solid var(--color-border); padding:0.5rem;">Array of client authorization entries</td></tr>
  </tbody>
</table>
**Entrée authClient (40 octets):** - `clientID_i`: 8 octets - `clientCookie_i`: 32 octets (authCookie chiffré)
<p><strong>Données d&rsquo;autorisation du client PSK (clé pré-partagée) (flags = 0x03, bits 3-1 = 001):</strong></p>
<table style="width:100%; border-collapse:collapse; margin-bottom:1.5rem;">
  <thead>
    <tr>
      <th style="border:1px solid var(--color-border); padding:0.5rem; background:var(--color-bg-secondary); text-align:left;">Field</th>
      <th style="border:1px solid var(--color-border); padding:0.5rem; background:var(--color-bg-secondary); text-align:center;">Size</th>
      <th style="border:1px solid var(--color-border); padding:0.5rem; background:var(--color-bg-secondary); text-align:left;">Description</th>
    </tr>
  </thead>
  <tbody>
    <tr><td style="border:1px solid var(--color-border); padding:0.5rem;">authSalt</td><td style="border:1px solid var(--color-border); padding:0.5rem; text-align:center;">32 bytes</td><td style="border:1px solid var(--color-border); padding:0.5rem;">Salt for PSK key derivation</td></tr>
    <tr><td style="border:1px solid var(--color-border); padding:0.5rem;">clients</td><td style="border:1px solid var(--color-border); padding:0.5rem; text-align:center;">2 bytes</td><td style="border:1px solid var(--color-border); padding:0.5rem;">Big endian, number of client entries</td></tr>
    <tr><td style="border:1px solid var(--color-border); padding:0.5rem;">authClient[]</td><td style="border:1px solid var(--color-border); padding:0.5rem; text-align:center;">40 bytes each</td><td style="border:1px solid var(--color-border); padding:0.5rem;">Array of client authorization entries</td></tr>
  </tbody>
</table>
**Entrée authClient (40 octets):** - `clientID_i`: 8 octets - `clientCookie_i`: 32 octets (authCookie chiffré)
<h3 id="couche-2-interne---données-du-leaseset">Couche 2 (interne) - Données du LeaseSet</h3>
<p><strong>Déchiffrement :</strong> Voir la section <a href="#layer-2-encryption">Chiffrement de couche 2</a>
.</p>
<p><strong>Structure :</strong></p>
<table style="width:100%; border-collapse:collapse; margin-bottom:1.5rem;">
  <thead>
    <tr>
      <th style="border:1px solid var(--color-border); padding:0.5rem; background:var(--color-bg-secondary); text-align:left;">Field</th>
      <th style="border:1px solid var(--color-border); padding:0.5rem; background:var(--color-bg-secondary); text-align:center;">Size</th>
      <th style="border:1px solid var(--color-border); padding:0.5rem; background:var(--color-bg-secondary); text-align:left;">Description</th>
    </tr>
  </thead>
  <tbody>
    <tr><td style="border:1px solid var(--color-border); padding:0.5rem;">Type</td><td style="border:1px solid var(--color-border); padding:0.5rem; text-align:center;">1 byte</td><td style="border:1px solid var(--color-border); padding:0.5rem;"><code>3</code> (LS2) or <code>7</code> (Meta LS2)</td></tr>
    <tr><td style="border:1px solid var(--color-border); padding:0.5rem;">Data</td><td style="border:1px solid var(--color-border); padding:0.5rem; text-align:center;">Variable</td><td style="border:1px solid var(--color-border); padding:0.5rem;">Complete LeaseSet2 or MetaLeaseSet2</td></tr>
  </tbody>
</table>
La couche interne contient la structure LeaseSet2 (deuxième version de LeaseSet) complète, incluant : - en-tête LS2 - informations de bail - signature LS2
<p><strong>Exigences de vérification :</strong> Après déchiffrement, les implémentations doivent vérifier : 1. L&rsquo;horodatage interne correspond à l&rsquo;horodatage externe publié 2. L&rsquo;expiration interne correspond à l&rsquo;expiration externe 3. La signature LS2 (leaseSet v2) est valide 4. Les données de lease sont bien formées</p>
<p><strong>Références:</strong> - <a href="../../../../fr/docs/specs/common-structures/">Spécification des structures communes</a>
 - détails du format LeaseSet2 (jeu de baux version 2)</p>
<hr>
<h2 id="dérivation-de-la-clé-daveuglement">Dérivation de la clé d&rsquo;aveuglement</h2>
<h3 id="aperçu-1">Aperçu</h3>
<p>I2P utilise un schéma d&rsquo;aveuglement de clé additif basé sur Ed25519 et ZCash RedDSA. Les clés aveuglées sont renouvelées quotidiennement (à minuit UTC) afin d&rsquo;assurer la confidentialité persistante (forward secrecy).</p>
<p><strong>Justification de la conception:</strong></p>
<p>I2P a explicitement choisi de NE PAS utiliser l’approche de l’annexe A.2 du document rend-spec-v3.txt de Tor. Selon la spécification :</p>
<blockquote>
<p>&ldquo;Nous n&rsquo;utilisons pas l&rsquo;annexe A.2 de rend-spec-v3.txt de Tor, dont les objectifs de conception sont similaires, car ses clés publiques aveuglées peuvent être hors du sous-groupe d&rsquo;ordre premier, avec des implications de sécurité inconnues.&rdquo;</p></blockquote>
<p>L&rsquo;aveuglement additif d&rsquo;I2P garantit que les clés aveuglées restent dans le sous-groupe d&rsquo;ordre premier de la courbe Ed25519.</p>
<h3 id="définitions-mathématiques">Définitions mathématiques</h3>
<p><strong>Paramètres Ed25519:</strong> - <code>B</code>: point de base Ed25519 (générateur) = <code>2^255 - 19</code> - <code>L</code>: ordre Ed25519 = <code>2^252 + 27742317777372353535851937790883648493</code></p>
<p><strong>Variables clés:</strong> - <code>A</code>: Clé publique de signature de 32 octets désaveuglée (dans la Destination) - <code>a</code>: Clé privée de signature de 32 octets désaveuglée - <code>A'</code>: Clé publique de signature de 32 octets aveuglée (utilisée dans le LeaseSet chiffré) - <code>a'</code>: Clé privée de signature de 32 octets aveuglée - <code>alpha</code>: Facteur d&rsquo;aveuglement de 32 octets (secret)</p>
<p><strong>Fonctions utilitaires:</strong></p>
<h4 id="leos2ipx">LEOS2IP(x)</h4>
<p>&ldquo;Conversion d’une chaîne d’octets Little-Endian en entier&rdquo;</p>
<p>Convertit un tableau d’octets en ordre little-endian en valeur entière.</p>
<h4 id="hx">H*(x)</h4>
<p>&ldquo;Hachage et réduction&rdquo;</p>
<pre tabindex="0"><code>H*(x) = (LEOS2IP(SHA512(x))) mod L
</code></pre><p>Même opération que lors de la génération de clés Ed25519.</p>
<h3 id="génération-alpha">Génération Alpha</h3>
<p><strong>Rotation quotidienne:</strong> Un nouvel alpha et des clés aveuglées DOIVENT être générés chaque jour à minuit UTC (00:00:00 UTC).</p>
<p><strong>GENERATE_ALPHA(destination, date, secret) Algorithme:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># Input parameters</span>
</span></span><span style="display:flex;"><span>A <span style="color:#f92672">=</span> destination<span style="color:#e6db74">&#39;s signing public key (32 bytes)</span>
</span></span><span style="display:flex;"><span>stA <span style="color:#f92672">=</span> signature type of A (<span style="color:#ae81ff">2</span> bytes, big endian)
</span></span><span style="display:flex;"><span>     <span style="color:#75715e"># 0x0007 for Ed25519 or 0x000b for Red25519</span>
</span></span><span style="display:flex;"><span>stA<span style="color:#e6db74">&#39; = signature type of blinded key A&#39;</span> (<span style="color:#ae81ff">2</span> bytes, big endian) 
</span></span><span style="display:flex;"><span>     <span style="color:#75715e"># Always 0x000b (Red25519)</span>
</span></span><span style="display:flex;"><span>datestring <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;YYYYMMDD&#34;</span> (<span style="color:#ae81ff">8</span> bytes ASCII <span style="color:#f92672">from</span> current UTC date)
</span></span><span style="display:flex;"><span>secret <span style="color:#f92672">=</span> optional UTF<span style="color:#f92672">-</span><span style="color:#ae81ff">8</span> encoded string (zero<span style="color:#f92672">-</span>length <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> used)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Computation</span>
</span></span><span style="display:flex;"><span>keydata <span style="color:#f92672">=</span> A <span style="color:#f92672">||</span> stA <span style="color:#f92672">||</span> stA<span style="color:#e6db74">&#39;  # 36 bytes total</span>
</span></span><span style="display:flex;"><span>seed <span style="color:#f92672">=</span> HKDF(
</span></span><span style="display:flex;"><span>    salt<span style="color:#f92672">=</span>H(<span style="color:#e6db74">&#34;I2PGenerateAlpha&#34;</span>, keydata),
</span></span><span style="display:flex;"><span>    ikm<span style="color:#f92672">=</span>datestring <span style="color:#f92672">||</span> secret,
</span></span><span style="display:flex;"><span>    info<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;i2pblinding1&#34;</span>,
</span></span><span style="display:flex;"><span>    n<span style="color:#f92672">=</span><span style="color:#ae81ff">64</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Treat seed as 64-byte little-endian integer and reduce</span>
</span></span><span style="display:flex;"><span>alpha <span style="color:#f92672">=</span> seed mod L
</span></span></code></pre></div><p><strong>Paramètres vérifiés:</strong> - Personnalisation du sel: <code>&quot;I2PGenerateAlpha&quot;</code> - Info HKDF: <code>&quot;i2pblinding1&quot;</code> - Sortie: 64 octets avant réduction - Distribution d&rsquo;alpha: Identique à celle des clés privées Ed25519 après <code>mod L</code></p>
<h3 id="aveuglement-de-clé-privée">Aveuglement de clé privée</h3>
<p><strong>Algorithme BLIND_PRIVKEY(a, alpha):</strong></p>
<p>Pour le propriétaire de la destination qui publie le LeaseSet chiffré :</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># For Ed25519 private key (type 7)</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> sigtype <span style="color:#f92672">==</span> <span style="color:#ae81ff">7</span>:
</span></span><span style="display:flex;"><span>    seed <span style="color:#f92672">=</span> destination<span style="color:#e6db74">&#39;s signing private key (32 bytes)</span>
</span></span><span style="display:flex;"><span>    a <span style="color:#f92672">=</span> left_half(SHA512(seed))  <span style="color:#75715e"># 32 bytes</span>
</span></span><span style="display:flex;"><span>    a <span style="color:#f92672">=</span> clamp(a)  <span style="color:#75715e"># Ed25519 clamping</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span><span style="color:#75715e"># For Red25519 private key (type 11)</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">elif</span> sigtype <span style="color:#f92672">==</span> <span style="color:#ae81ff">11</span>:
</span></span><span style="display:flex;"><span>    a <span style="color:#f92672">=</span> destination<span style="color:#e6db74">&#39;s signing private key (32 bytes)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># No clamping for Red25519</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Additive blinding using scalar arithmetic</span>
</span></span><span style="display:flex;"><span>blinded_privkey <span style="color:#f92672">=</span> a<span style="color:#e6db74">&#39; = (a + alpha) mod L</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Derive blinded public key</span>
</span></span><span style="display:flex;"><span>blinded_pubkey <span style="color:#f92672">=</span> A<span style="color:#e6db74">&#39; = DERIVE_PUBLIC(a&#39;</span>)
</span></span></code></pre></div><p><strong>Critique:</strong> La réduction <code>mod L</code> est essentielle pour maintenir la relation algébrique correcte entre la clé privée et la clé publique.</p>
<h3 id="aveuglement-de-clé-publique">Aveuglement de clé publique</h3>
<p><strong>Algorithme BLIND_PUBKEY(A, alpha):</strong></p>
<p>Pour les clients récupérant et vérifiant le LeaseSet chiffré :</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>alpha <span style="color:#f92672">=</span> GENERATE_ALPHA(destination, date, secret)
</span></span><span style="display:flex;"><span>A <span style="color:#f92672">=</span> destination<span style="color:#e6db74">&#39;s signing public key (32 bytes)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Additive blinding using group elements (curve points)</span>
</span></span><span style="display:flex;"><span>blinded_pubkey <span style="color:#f92672">=</span> A<span style="color:#e6db74">&#39; = A + DERIVE_PUBLIC(alpha)</span>
</span></span></code></pre></div><p><strong>Équivalence mathématique :</strong></p>
<p>Les deux méthodes produisent des résultats identiques :</p>
<pre tabindex="0"><code>BLIND_PUBKEY(A, alpha) == DERIVE_PUBLIC(BLIND_PRIVKEY(a, alpha))
</code></pre><p>C’est parce que :</p>
<pre tabindex="0"><code>A&#39; = A + [alpha]B
   = [a]B + [alpha]B
   = [a + alpha]B  (group operation)
   = DERIVE_PUBLIC(a + alpha mod L)
</code></pre><h3 id="signature-avec-des-clés-aveuglées">Signature avec des clés aveuglées</h3>
<p><strong>Signature de LeaseSet non aveuglé:</strong></p>
<p>Le LeaseSet non aveuglé (envoyé directement aux clients authentifiés) est signé avec : - Signature Ed25519 standard (type 7) ou Red25519 (type 11) - Clé privée de signature non aveuglée - Vérifiée avec la clé publique non aveuglée</p>
<p><strong>Avec des clés hors ligne:</strong> - Signé par une clé privée transitoire désaveuglée - Vérifié avec une clé publique transitoire désaveuglée - Les deux doivent être de type 7 ou 11</p>
<p><strong>Signature d&rsquo;un LeaseSet chiffré :</strong></p>
<p>La partie externe d&rsquo;un LeaseSet chiffré utilise des signatures Red25519 avec des clés aveuglées.</p>
<p><strong>Algorithme de signature Red25519:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># Generate per-signature random nonce</span>
</span></span><span style="display:flex;"><span>T <span style="color:#f92672">=</span> CSRNG(<span style="color:#ae81ff">80</span>)  <span style="color:#75715e"># 80 random bytes</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Calculate r (differs from Ed25519)</span>
</span></span><span style="display:flex;"><span>r <span style="color:#f92672">=</span> H<span style="color:#f92672">*</span>(T <span style="color:#f92672">||</span> blinded_pubkey <span style="color:#f92672">||</span> message)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Rest is same as Ed25519</span>
</span></span><span style="display:flex;"><span>R <span style="color:#f92672">=</span> [r]B
</span></span><span style="display:flex;"><span>S <span style="color:#f92672">=</span> (r <span style="color:#f92672">+</span> H(R <span style="color:#f92672">||</span> A<span style="color:#e6db74">&#39; || message) * a&#39;</span>) mod L
</span></span><span style="display:flex;"><span>signature <span style="color:#f92672">=</span> R <span style="color:#f92672">||</span> S  <span style="color:#75715e"># 64 bytes total</span>
</span></span></code></pre></div><p><strong>Principales différences par rapport à Ed25519:</strong> 1. Utilise 80 octets de données aléatoires <code>T</code> (et non le hachage de la clé privée) 2. Utilise directement la valeur de la clé publique (et non le hachage de la clé privée) 3. Chaque signature est unique, même pour le même message et la même clé</p>
<p><strong>Vérification:</strong></p>
<p>Identique à Ed25519 :</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># Parse signature</span>
</span></span><span style="display:flex;"><span>R <span style="color:#f92672">=</span> signature[<span style="color:#ae81ff">0</span>:<span style="color:#ae81ff">32</span>]
</span></span><span style="display:flex;"><span>S <span style="color:#f92672">=</span> signature[<span style="color:#ae81ff">32</span>:<span style="color:#ae81ff">64</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Verify equation: [S]B = R + [H(R || A&#39; || message)]A&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">return</span> [S]B <span style="color:#f92672">==</span> R <span style="color:#f92672">+</span> [H(R <span style="color:#f92672">||</span> A<span style="color:#e6db74">&#39; || message)]A&#39;</span>
</span></span></code></pre></div><h3 id="considérations-de-sécurité">Considérations de sécurité</h3>
<p><strong>Distribution alpha:</strong></p>
<p>Pour des raisons de sécurité, alpha doit suivre la même distribution que les clés privées non aveuglées. Lors de l&rsquo;aveuglement d&rsquo;Ed25519 (type 7) en Red25519 (type 11), les distributions diffèrent légèrement.</p>
<p><strong>Recommandation :</strong> Utilisez Red25519 (type 11) pour les clés à la fois désaveuglées et aveuglées afin de respecter les exigences de ZCash : &ldquo;la combinaison d’une clé publique ré-aléatoirisée et de signature(s) produite(s) avec cette clé ne révèle pas la clé source de la ré-aléatoirisation.&rdquo;</p>
<p><strong>Prise en charge du type 7 :</strong> Ed25519 est pris en charge pour assurer la rétrocompatibilité avec les destinations existantes, mais le type 11 est recommandé pour les nouvelles destinations chiffrées.</p>
<p><strong>Avantages de la rotation quotidienne :</strong> - Confidentialité persistante (PFS) : La compromission de la clé aveuglée d&rsquo;aujourd&rsquo;hui ne révèle pas celle d&rsquo;hier - Non-corrélabilité : La rotation quotidienne empêche le suivi à long terme via la DHT (table de hachage distribuée) - Séparation des clés : Des clés différentes pour des périodes distinctes</p>
<p><strong>Références :</strong> - <a href="https://zips.z.cash/protocol/protocol.pdf">Spécification du protocole ZCash</a>
 - Section 5.4.6.1 - <a href="https://lists.torproject.org/pipermail/tor-dev/2013-December/005943.html">Discussion Tor sur le Key Blinding (aveuglement de clé)</a>
 - <a href="https://trac.torproject.org/projects/tor/ticket/8106">Ticket Tor n° 8106</a>
</p>
<hr>
<h2 id="chiffrement-et-traitement">Chiffrement et traitement</h2>
<h3 id="dérivation-du-subcredential-élément-didentification-dérivé">Dérivation du Subcredential (élément d&rsquo;identification dérivé)</h3>
<p>Avant le chiffrement, nous dérivons un credential (valeur d&rsquo;authentification) et un subcredential (sous-valeur d&rsquo;authentification) afin d&rsquo;associer les couches chiffrées à la connaissance de la clé publique de signature de la Destination.</p>
<p><strong>Objectif:</strong> Garantir que seuls ceux qui connaissent la clé publique de signature de la Destination (identifiant de service I2P) peuvent déchiffrer le LeaseSet chiffré. La Destination complète n&rsquo;est pas nécessaire.</p>
<h4 id="calcul-des-informations-didentification">Calcul des informations d&rsquo;identification</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>A <span style="color:#f92672">=</span> destination<span style="color:#e6db74">&#39;s signing public key (32 bytes)</span>
</span></span><span style="display:flex;"><span>stA <span style="color:#f92672">=</span> signature type of A (<span style="color:#ae81ff">2</span> bytes big endian)
</span></span><span style="display:flex;"><span>     <span style="color:#75715e"># 0x0007 for Ed25519 or 0x000b for Red25519</span>
</span></span><span style="display:flex;"><span>stA<span style="color:#e6db74">&#39; = signature type of blinded key A&#39;</span> (<span style="color:#ae81ff">2</span> bytes big endian)
</span></span><span style="display:flex;"><span>     <span style="color:#75715e"># Always 0x000b (Red25519)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>keydata <span style="color:#f92672">=</span> A <span style="color:#f92672">||</span> stA <span style="color:#f92672">||</span> stA<span style="color:#e6db74">&#39;  # 36 bytes</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>credential <span style="color:#f92672">=</span> H(<span style="color:#e6db74">&#34;credential&#34;</span>, keydata)  <span style="color:#75715e"># 32 bytes</span>
</span></span></code></pre></div><p><strong>Séparation de domaines:</strong> La chaîne de personnalisation <code>&quot;credential&quot;</code> garantit que ce hachage n&rsquo;entre pas en collision avec les clés de recherche de la DHT ni avec d&rsquo;autres usages du protocole.</p>
<h4 id="calcul-du-subcredential-identifiant-dérivé">Calcul du Subcredential (identifiant dérivé)</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>blindedPublicKey <span style="color:#f92672">=</span> A<span style="color:#e6db74">&#39; (32 bytes, from blinding process)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>subcredential <span style="color:#f92672">=</span> H(<span style="color:#e6db74">&#34;subcredential&#34;</span>, credential <span style="color:#f92672">||</span> blindedPublicKey)  <span style="color:#75715e"># 32 bytes</span>
</span></span></code></pre></div><p><strong>Objectif:</strong> Le subcredential (identifiant secondaire) lie le LeaseSet chiffré à: 1. La Destination spécifique (via l’identifiant) 2. La clé aveuglée spécifique (via blindedPublicKey) 3. Le jour spécifique (via la rotation quotidienne de blindedPublicKey)</p>
<p>Cela empêche les attaques par rejeu et les recoupements d&rsquo;un jour à l&rsquo;autre.</p>
<h3 id="chiffrement-de-la-couche-1">Chiffrement de la couche 1</h3>
<p><strong>Contexte :</strong> La couche 1 contient des données d’autorisation du client et est chiffrée à l’aide d’une clé dérivée du subcredential (sous‑identifiant d’authentification).</p>
<h4 id="algorithme-de-chiffrement">Algorithme de chiffrement</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># Prepare input</span>
</span></span><span style="display:flex;"><span>outerInput <span style="color:#f92672">=</span> subcredential <span style="color:#f92672">||</span> publishedTimestamp
</span></span><span style="display:flex;"><span><span style="color:#75715e"># publishedTimestamp: 4 bytes from Layer 0</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Generate random salt</span>
</span></span><span style="display:flex;"><span>outerSalt <span style="color:#f92672">=</span> CSRNG(<span style="color:#ae81ff">32</span>)  <span style="color:#75715e"># 32 bytes</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Derive encryption key and IV</span>
</span></span><span style="display:flex;"><span>keys <span style="color:#f92672">=</span> HKDF(
</span></span><span style="display:flex;"><span>    salt<span style="color:#f92672">=</span>outerSalt,
</span></span><span style="display:flex;"><span>    ikm<span style="color:#f92672">=</span>outerInput,
</span></span><span style="display:flex;"><span>    info<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;ELS2_L1K&#34;</span>,  <span style="color:#75715e"># Domain separation</span>
</span></span><span style="display:flex;"><span>    n<span style="color:#f92672">=</span><span style="color:#ae81ff">44</span>  <span style="color:#75715e"># 32 bytes key + 12 bytes IV</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>outerKey <span style="color:#f92672">=</span> keys[<span style="color:#ae81ff">0</span>:<span style="color:#ae81ff">31</span>]    <span style="color:#75715e"># 32 bytes (indices 0-31 inclusive)</span>
</span></span><span style="display:flex;"><span>outerIV <span style="color:#f92672">=</span> keys[<span style="color:#ae81ff">32</span>:<span style="color:#ae81ff">43</span>]    <span style="color:#75715e"># 12 bytes (indices 32-43 inclusive)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Encrypt and prepend salt</span>
</span></span><span style="display:flex;"><span>outerPlaintext <span style="color:#f92672">=</span> [Layer <span style="color:#ae81ff">1</span> data]
</span></span><span style="display:flex;"><span>outerCiphertext <span style="color:#f92672">=</span> outerSalt <span style="color:#f92672">||</span> ENCRYPT(outerKey, outerIV, outerPlaintext)
</span></span></code></pre></div><p><strong>Sortie:</strong> <code>outerCiphertext</code> est de <code>32 + len(outerPlaintext)</code> octets.</p>
<p><strong>Propriétés de sécurité:</strong> - Le sel garantit des paires clé/IV uniques, même pour le même subcredential (sous-identifiant d’authentification) - La chaîne de contexte <code>&quot;ELS2_L1K&quot;</code> assure une séparation des domaines - ChaCha20 assure une sécurité sémantique (texte chiffré indiscernable du hasard)</p>
<h4 id="algorithme-de-déchiffrement">Algorithme de déchiffrement</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># Parse salt from ciphertext</span>
</span></span><span style="display:flex;"><span>outerSalt <span style="color:#f92672">=</span> outerCiphertext[<span style="color:#ae81ff">0</span>:<span style="color:#ae81ff">31</span>]  <span style="color:#75715e"># First 32 bytes</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Derive decryption key and IV (same process as encryption)</span>
</span></span><span style="display:flex;"><span>outerInput <span style="color:#f92672">=</span> subcredential <span style="color:#f92672">||</span> publishedTimestamp
</span></span><span style="display:flex;"><span>keys <span style="color:#f92672">=</span> HKDF(
</span></span><span style="display:flex;"><span>    salt<span style="color:#f92672">=</span>outerSalt,
</span></span><span style="display:flex;"><span>    ikm<span style="color:#f92672">=</span>outerInput,
</span></span><span style="display:flex;"><span>    info<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;ELS2_L1K&#34;</span>,
</span></span><span style="display:flex;"><span>    n<span style="color:#f92672">=</span><span style="color:#ae81ff">44</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>outerKey <span style="color:#f92672">=</span> keys[<span style="color:#ae81ff">0</span>:<span style="color:#ae81ff">31</span>]    <span style="color:#75715e"># 32 bytes</span>
</span></span><span style="display:flex;"><span>outerIV <span style="color:#f92672">=</span> keys[<span style="color:#ae81ff">32</span>:<span style="color:#ae81ff">43</span>]    <span style="color:#75715e"># 12 bytes</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Decrypt (skip salt bytes)</span>
</span></span><span style="display:flex;"><span>outerPlaintext <span style="color:#f92672">=</span> DECRYPT(outerKey, outerIV, outerCiphertext[<span style="color:#ae81ff">32</span>:end])
</span></span></code></pre></div><p><strong>Vérification:</strong> Après déchiffrement, vérifiez que la structure de la couche 1 est bien formée avant de passer à la couche 2.</p>
<h3 id="chiffrement-de-la-couche-2">Chiffrement de la couche 2</h3>
<p><strong>Contexte:</strong> La couche 2 contient les données LeaseSet2 proprement dites et est chiffrée avec une clé dérivée d&rsquo;authCookie (si l&rsquo;authentification par client est activée) ou de la chaîne vide (sinon).</p>
<h4 id="algorithme-de-chiffrement-1">Algorithme de chiffrement</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># Determine authCookie based on authorization mode</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> per_client_auth_enabled:
</span></span><span style="display:flex;"><span>    authCookie <span style="color:#f92672">=</span> [<span style="color:#ae81ff">32</span><span style="color:#f92672">-</span>byte cookie <span style="color:#f92672">from</span> client authorization process]
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>    authCookie <span style="color:#f92672">=</span> <span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;&#39;</span>  <span style="color:#75715e"># Zero-length byte array</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Prepare input</span>
</span></span><span style="display:flex;"><span>innerInput <span style="color:#f92672">=</span> authCookie <span style="color:#f92672">||</span> subcredential <span style="color:#f92672">||</span> publishedTimestamp
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Generate random salt</span>
</span></span><span style="display:flex;"><span>innerSalt <span style="color:#f92672">=</span> CSRNG(<span style="color:#ae81ff">32</span>)  <span style="color:#75715e"># 32 bytes</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Derive encryption key and IV</span>
</span></span><span style="display:flex;"><span>keys <span style="color:#f92672">=</span> HKDF(
</span></span><span style="display:flex;"><span>    salt<span style="color:#f92672">=</span>innerSalt,
</span></span><span style="display:flex;"><span>    ikm<span style="color:#f92672">=</span>innerInput,
</span></span><span style="display:flex;"><span>    info<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;ELS2_L2K&#34;</span>,  <span style="color:#75715e"># Domain separation</span>
</span></span><span style="display:flex;"><span>    n<span style="color:#f92672">=</span><span style="color:#ae81ff">44</span>  <span style="color:#75715e"># 32 bytes key + 12 bytes IV</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>innerKey <span style="color:#f92672">=</span> keys[<span style="color:#ae81ff">0</span>:<span style="color:#ae81ff">31</span>]    <span style="color:#75715e"># 32 bytes</span>
</span></span><span style="display:flex;"><span>innerIV <span style="color:#f92672">=</span> keys[<span style="color:#ae81ff">32</span>:<span style="color:#ae81ff">43</span>]    <span style="color:#75715e"># 12 bytes</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Encrypt and prepend salt</span>
</span></span><span style="display:flex;"><span>innerPlaintext <span style="color:#f92672">=</span> [Layer <span style="color:#ae81ff">2</span> data: LS2 type byte <span style="color:#f92672">+</span> LeaseSet2 data]
</span></span><span style="display:flex;"><span>innerCiphertext <span style="color:#f92672">=</span> innerSalt <span style="color:#f92672">||</span> ENCRYPT(innerKey, innerIV, innerPlaintext)
</span></span></code></pre></div><p><strong>Sortie :</strong> <code>innerCiphertext</code> fait <code>32 + len(innerPlaintext)</code> octets.</p>
<p><strong>Liaison de clé:</strong> - Si aucune authentification client : Associée uniquement à subcredential (sous-jeton d’authentification) et à l’horodatage - Si l’authentification client est activée : Associée en plus à authCookie (différent pour chaque client autorisé)</p>
<h4 id="algorithme-de-déchiffrement-1">Algorithme de déchiffrement</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># Determine authCookie (same as encryption)</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> per_client_auth_enabled:
</span></span><span style="display:flex;"><span>    authCookie <span style="color:#f92672">=</span> [<span style="color:#ae81ff">32</span><span style="color:#f92672">-</span>byte cookie <span style="color:#f92672">from</span> client authorization process]
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>    authCookie <span style="color:#f92672">=</span> <span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;&#39;</span>  <span style="color:#75715e"># Zero-length byte array</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Parse salt from ciphertext</span>
</span></span><span style="display:flex;"><span>innerSalt <span style="color:#f92672">=</span> innerCiphertext[<span style="color:#ae81ff">0</span>:<span style="color:#ae81ff">31</span>]  <span style="color:#75715e"># First 32 bytes</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Derive decryption key and IV</span>
</span></span><span style="display:flex;"><span>innerInput <span style="color:#f92672">=</span> authCookie <span style="color:#f92672">||</span> subcredential <span style="color:#f92672">||</span> publishedTimestamp
</span></span><span style="display:flex;"><span>keys <span style="color:#f92672">=</span> HKDF(
</span></span><span style="display:flex;"><span>    salt<span style="color:#f92672">=</span>innerSalt,
</span></span><span style="display:flex;"><span>    ikm<span style="color:#f92672">=</span>innerInput,
</span></span><span style="display:flex;"><span>    info<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;ELS2_L2K&#34;</span>,
</span></span><span style="display:flex;"><span>    n<span style="color:#f92672">=</span><span style="color:#ae81ff">44</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>innerKey <span style="color:#f92672">=</span> keys[<span style="color:#ae81ff">0</span>:<span style="color:#ae81ff">31</span>]    <span style="color:#75715e"># 32 bytes</span>
</span></span><span style="display:flex;"><span>innerIV <span style="color:#f92672">=</span> keys[<span style="color:#ae81ff">32</span>:<span style="color:#ae81ff">43</span>]    <span style="color:#75715e"># 12 bytes</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Decrypt (skip salt bytes)</span>
</span></span><span style="display:flex;"><span>innerPlaintext <span style="color:#f92672">=</span> DECRYPT(innerKey, innerIV, innerCiphertext[<span style="color:#ae81ff">32</span>:end])
</span></span></code></pre></div><p><strong>Vérification :</strong> Après déchiffrement : 1. Vérifier que l’octet de type LS2 est valide (3 ou 7) 2. Analyser la structure LeaseSet2 (deuxième génération de LeaseSet) 3. Vérifier que l’horodatage interne correspond à l’horodatage externe publié 4. Vérifier que l’expiration interne correspond à l’expiration externe 5. Vérifier la signature de LeaseSet2</p>
<h3 id="résumé-de-la-couche-de-chiffrement">Résumé de la couche de chiffrement</h3>
<pre tabindex="0"><code>┌─────────────────────────────────────────────────┐
│ Layer 0 (Plaintext)                             │
│ - Blinded public key                            │
│ - Timestamps                                    │
│ - Signature                                     │
│                                                 │
│  ┌─────────────────────────────────────────┐   │
│  │ Layer 1 (Encrypted with subcredential)  │   │
│  │ - Authorization flags                   │   │
│  │ - Client auth data (if enabled)         │   │
│  │                                          │   │
│  │  ┌────────────────────────────────┐     │   │
│  │  │ Layer 2 (Encrypted with        │     │   │
│  │  │          authCookie + subcred) │     │   │
│  │  │ - LeaseSet2 type               │     │   │
│  │  │ - LeaseSet2 data               │     │   │
│  │  │ - Leases                       │     │   │
│  │  │ - LS2 signature                │     │   │
│  │  └────────────────────────────────┘     │   │
│  └─────────────────────────────────────────┘   │
└─────────────────────────────────────────────────┘
</code></pre><p><strong>Flux de déchiffrement :</strong> 1. Vérifier la signature de la couche 0 avec la clé publique aveuglée 2. Déchiffrer la couche 1 à l&rsquo;aide de subcredential (justificatif dérivé) 3. Traiter les données d&rsquo;autorisation (si présentes) pour obtenir authCookie (jeton d&rsquo;authentification) 4. Déchiffrer la couche 2 en utilisant authCookie et subcredential 5. Vérifier et analyser LeaseSet2</p>
<hr>
<h2 id="autorisation-par-client">Autorisation par client</h2>
<h3 id="vue-densemble">Vue d&rsquo;ensemble</h3>
<p>Lorsque l’autorisation par client est activée, le serveur conserve une liste de clients autorisés. Chaque client dispose de données de clé qui doivent être transmises de manière sécurisée par un canal hors bande.</p>
<p><strong>Deux mécanismes d’autorisation :</strong> 1. <strong>Autorisation client DH (Diffie-Hellman):</strong> Plus sécurisé, utilise l’accord de clé X25519 2. <strong>Autorisation PSK (clé pré-partagée):</strong> Plus simple, utilise des clés symétriques</p>
<p><strong>Propriétés de sécurité courantes :</strong> - Confidentialité de l’appartenance des clients : Les observateurs voient le nombre de clients mais ne peuvent pas identifier de clients spécifiques - Ajout/révocation de clients de façon anonyme : Impossible de déterminer quand des clients spécifiques sont ajoutés ou retirés - Probabilité de collision d’un identifiant client sur 8 octets : ~1 sur 18 milliards de milliards (négligeable)</p>
<h3 id="autorisation-du-client-via-dh-échange-de-clés-diffiehellman">Autorisation du client via DH (échange de clés Diffie–Hellman)</h3>
<p><strong>Aperçu:</strong> Chaque client génère une paire de clés X25519 et envoie sa clé publique au serveur via un canal hors bande sécurisé. Le serveur utilise un Diffie-Hellman éphémère pour chiffrer un authCookie unique pour chaque client.</p>
<h4 id="génération-des-clés-client">Génération des clés client</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># Client generates keypair</span>
</span></span><span style="display:flex;"><span>csk_i <span style="color:#f92672">=</span> GENERATE_PRIVATE()  <span style="color:#75715e"># 32-byte X25519 private key</span>
</span></span><span style="display:flex;"><span>cpk_i <span style="color:#f92672">=</span> DERIVE_PUBLIC(csk_i)  <span style="color:#75715e"># 32-byte X25519 public key</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Client sends cpk_i to server via secure out-of-band channel</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Client KEEPS csk_i secret (never transmitted)</span>
</span></span></code></pre></div><p><strong>Avantage de sécurité :</strong> La clé privée du client ne quitte jamais son appareil. Un adversaire qui intercepte la transmission hors bande ne peut pas déchiffrer de futurs LeaseSets chiffrés sans casser X25519 DH (échange de clés Diffie-Hellman X25519).</p>
<h4 id="traitement-côté-serveur">Traitement côté serveur</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># Server generates new auth cookie and ephemeral keypair</span>
</span></span><span style="display:flex;"><span>authCookie <span style="color:#f92672">=</span> CSRNG(<span style="color:#ae81ff">32</span>)  <span style="color:#75715e"># 32-byte cookie</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>esk <span style="color:#f92672">=</span> GENERATE_PRIVATE()  <span style="color:#75715e"># 32-byte ephemeral private key</span>
</span></span><span style="display:flex;"><span>epk <span style="color:#f92672">=</span> DERIVE_PUBLIC(esk)  <span style="color:#75715e"># 32-byte ephemeral public key</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># For each authorized client i</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> cpk_i <span style="color:#f92672">in</span> authorized_clients:
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Perform DH key agreement</span>
</span></span><span style="display:flex;"><span>    sharedSecret <span style="color:#f92672">=</span> DH(esk, cpk_i)  <span style="color:#75715e"># 32 bytes</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Derive client-specific encryption key</span>
</span></span><span style="display:flex;"><span>    authInput <span style="color:#f92672">=</span> sharedSecret <span style="color:#f92672">||</span> cpk_i <span style="color:#f92672">||</span> subcredential <span style="color:#f92672">||</span> publishedTimestamp
</span></span><span style="display:flex;"><span>    okm <span style="color:#f92672">=</span> HKDF(
</span></span><span style="display:flex;"><span>        salt<span style="color:#f92672">=</span>epk,  <span style="color:#75715e"># Ephemeral public key as salt</span>
</span></span><span style="display:flex;"><span>        ikm<span style="color:#f92672">=</span>authInput,
</span></span><span style="display:flex;"><span>        info<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;ELS2_XCA&#34;</span>,  <span style="color:#75715e"># Domain separation</span>
</span></span><span style="display:flex;"><span>        n<span style="color:#f92672">=</span><span style="color:#ae81ff">52</span>  <span style="color:#75715e"># 32 key + 12 IV + 8 ID</span>
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Extract components</span>
</span></span><span style="display:flex;"><span>    clientKey_i <span style="color:#f92672">=</span> okm[<span style="color:#ae81ff">0</span>:<span style="color:#ae81ff">31</span>]    <span style="color:#75715e"># 32 bytes</span>
</span></span><span style="display:flex;"><span>    clientIV_i <span style="color:#f92672">=</span> okm[<span style="color:#ae81ff">32</span>:<span style="color:#ae81ff">43</span>]    <span style="color:#75715e"># 12 bytes</span>
</span></span><span style="display:flex;"><span>    clientID_i <span style="color:#f92672">=</span> okm[<span style="color:#ae81ff">44</span>:<span style="color:#ae81ff">51</span>]    <span style="color:#75715e"># 8 bytes</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Encrypt authCookie for this client</span>
</span></span><span style="display:flex;"><span>    clientCookie_i <span style="color:#f92672">=</span> ENCRYPT(clientKey_i, clientIV_i, authCookie)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Store [clientID_i, clientCookie_i] entry in Layer 1</span>
</span></span></code></pre></div><p><strong>Structure de données de la couche 1:</strong></p>
<pre tabindex="0"><code>ephemeralPublicKey (32 bytes)
clients (2 bytes) = N
[clientID_1 (8 bytes) || clientCookie_1 (32 bytes)]
[clientID_2 (8 bytes) || clientCookie_2 (32 bytes)]
...
[clientID_N (8 bytes) || clientCookie_N (32 bytes)]
</code></pre><p><strong>Recommandations serveur:</strong> - Générer une nouvelle paire de clés éphémère pour chaque LeaseSet chiffré publié - Randomiser l&rsquo;ordre des clients pour empêcher le suivi basé sur la position - Envisager d&rsquo;ajouter des entrées factices pour masquer le nombre réel de clients</p>
<h4 id="traitement-côté-client">Traitement côté client</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># Client has: csk_i (their private key), destination, date, secret</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Client receives: encrypted LeaseSet with epk in Layer 1</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Perform DH key agreement with server&#39;s ephemeral public key</span>
</span></span><span style="display:flex;"><span>sharedSecret <span style="color:#f92672">=</span> DH(csk_i, epk)  <span style="color:#75715e"># 32 bytes</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Derive expected client identifier and decryption key</span>
</span></span><span style="display:flex;"><span>cpk_i <span style="color:#f92672">=</span> DERIVE_PUBLIC(csk_i)  <span style="color:#75715e"># Client&#39;s own public key</span>
</span></span><span style="display:flex;"><span>authInput <span style="color:#f92672">=</span> sharedSecret <span style="color:#f92672">||</span> cpk_i <span style="color:#f92672">||</span> subcredential <span style="color:#f92672">||</span> publishedTimestamp
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>okm <span style="color:#f92672">=</span> HKDF(
</span></span><span style="display:flex;"><span>    salt<span style="color:#f92672">=</span>epk,
</span></span><span style="display:flex;"><span>    ikm<span style="color:#f92672">=</span>authInput,
</span></span><span style="display:flex;"><span>    info<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;ELS2_XCA&#34;</span>,
</span></span><span style="display:flex;"><span>    n<span style="color:#f92672">=</span><span style="color:#ae81ff">52</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>clientKey_i <span style="color:#f92672">=</span> okm[<span style="color:#ae81ff">0</span>:<span style="color:#ae81ff">31</span>]    <span style="color:#75715e"># 32 bytes</span>
</span></span><span style="display:flex;"><span>clientIV_i <span style="color:#f92672">=</span> okm[<span style="color:#ae81ff">32</span>:<span style="color:#ae81ff">43</span>]    <span style="color:#75715e"># 12 bytes</span>
</span></span><span style="display:flex;"><span>clientID_i <span style="color:#f92672">=</span> okm[<span style="color:#ae81ff">44</span>:<span style="color:#ae81ff">51</span>]    <span style="color:#75715e"># 8 bytes</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Search Layer 1 authorization data for clientID_i</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> (clientID, clientCookie) <span style="color:#f92672">in</span> layer1_auth_entries:
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> clientID <span style="color:#f92672">==</span> clientID_i:
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Found matching entry, decrypt authCookie</span>
</span></span><span style="display:flex;"><span>        authCookie <span style="color:#f92672">=</span> DECRYPT(clientKey_i, clientIV_i, clientCookie)
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Use authCookie to decrypt Layer 2</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">break</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># No matching entry - client not authorized or revoked</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">raise</span> AuthorizationError(<span style="color:#e6db74">&#34;Client not authorized&#34;</span>)
</span></span></code></pre></div><p><strong>Gestion des erreurs côté client:</strong> - Si <code>clientID_i</code> est introuvable : le client a été révoqué ou n&rsquo;a jamais été autorisé - Si le déchiffrement échoue : données corrompues ou clés incorrectes (extrêmement rare) - Les clients devraient réinterroger périodiquement pour détecter une révocation</p>
<h3 id="autorisation-du-client-par-psk">Autorisation du client par PSK</h3>
<p><strong>Vue d&rsquo;ensemble :</strong> Chaque client possède une clé symétrique de 32 octets pré-partagée (PSK). Le serveur chiffre le même authCookie à l&rsquo;aide de la PSK de chaque client.</p>
<h4 id="génération-de-clés">Génération de clés</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># Option 1: Client generates key</span>
</span></span><span style="display:flex;"><span>psk_i <span style="color:#f92672">=</span> CSRNG(<span style="color:#ae81ff">32</span>)  <span style="color:#75715e"># 32-byte pre-shared key</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Client sends psk_i to server via secure out-of-band channel</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Option 2: Server generates key</span>
</span></span><span style="display:flex;"><span>psk_i <span style="color:#f92672">=</span> CSRNG(<span style="color:#ae81ff">32</span>)  <span style="color:#75715e"># 32-byte pre-shared key</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Server sends psk_i to one or more clients via secure out-of-band channel</span>
</span></span></code></pre></div><p><strong>Note de sécurité:</strong> Le même PSK (clé pré-partagée) peut être partagé entre plusieurs clients si désiré (crée une autorisation de type &ldquo;groupe&rdquo;).</p>
<h4 id="traitement-côté-serveur-1">Traitement côté serveur</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># Server generates new auth cookie and salt</span>
</span></span><span style="display:flex;"><span>authCookie <span style="color:#f92672">=</span> CSRNG(<span style="color:#ae81ff">32</span>)  <span style="color:#75715e"># 32-byte cookie</span>
</span></span><span style="display:flex;"><span>authSalt <span style="color:#f92672">=</span> CSRNG(<span style="color:#ae81ff">32</span>)     <span style="color:#75715e"># 32-byte salt</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># For each authorized client i</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> psk_i <span style="color:#f92672">in</span> authorized_clients:
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Derive client-specific encryption key</span>
</span></span><span style="display:flex;"><span>    authInput <span style="color:#f92672">=</span> psk_i <span style="color:#f92672">||</span> subcredential <span style="color:#f92672">||</span> publishedTimestamp
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    okm <span style="color:#f92672">=</span> HKDF(
</span></span><span style="display:flex;"><span>        salt<span style="color:#f92672">=</span>authSalt,
</span></span><span style="display:flex;"><span>        ikm<span style="color:#f92672">=</span>authInput,
</span></span><span style="display:flex;"><span>        info<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;ELS2PSKA&#34;</span>,  <span style="color:#75715e"># Domain separation</span>
</span></span><span style="display:flex;"><span>        n<span style="color:#f92672">=</span><span style="color:#ae81ff">52</span>  <span style="color:#75715e"># 32 key + 12 IV + 8 ID</span>
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Extract components</span>
</span></span><span style="display:flex;"><span>    clientKey_i <span style="color:#f92672">=</span> okm[<span style="color:#ae81ff">0</span>:<span style="color:#ae81ff">31</span>]    <span style="color:#75715e"># 32 bytes</span>
</span></span><span style="display:flex;"><span>    clientIV_i <span style="color:#f92672">=</span> okm[<span style="color:#ae81ff">32</span>:<span style="color:#ae81ff">43</span>]    <span style="color:#75715e"># 12 bytes</span>
</span></span><span style="display:flex;"><span>    clientID_i <span style="color:#f92672">=</span> okm[<span style="color:#ae81ff">44</span>:<span style="color:#ae81ff">51</span>]    <span style="color:#75715e"># 8 bytes</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Encrypt authCookie for this client</span>
</span></span><span style="display:flex;"><span>    clientCookie_i <span style="color:#f92672">=</span> ENCRYPT(clientKey_i, clientIV_i, authCookie)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Store [clientID_i, clientCookie_i] entry in Layer 1</span>
</span></span></code></pre></div><p><strong>Structure de données de la couche 1:</strong></p>
<pre tabindex="0"><code>authSalt (32 bytes)
clients (2 bytes) = N
[clientID_1 (8 bytes) || clientCookie_1 (32 bytes)]
[clientID_2 (8 bytes) || clientCookie_2 (32 bytes)]
...
[clientID_N (8 bytes) || clientCookie_N (32 bytes)]
</code></pre><h4 id="traitement-côté-client-1">Traitement côté client</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># Client has: psk_i (their pre-shared key), destination, date, secret</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Client receives: encrypted LeaseSet with authSalt in Layer 1</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Derive expected client identifier and decryption key</span>
</span></span><span style="display:flex;"><span>authInput <span style="color:#f92672">=</span> psk_i <span style="color:#f92672">||</span> subcredential <span style="color:#f92672">||</span> publishedTimestamp
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>okm <span style="color:#f92672">=</span> HKDF(
</span></span><span style="display:flex;"><span>    salt<span style="color:#f92672">=</span>authSalt,
</span></span><span style="display:flex;"><span>    ikm<span style="color:#f92672">=</span>authInput,
</span></span><span style="display:flex;"><span>    info<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;ELS2PSKA&#34;</span>,
</span></span><span style="display:flex;"><span>    n<span style="color:#f92672">=</span><span style="color:#ae81ff">52</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>clientKey_i <span style="color:#f92672">=</span> okm[<span style="color:#ae81ff">0</span>:<span style="color:#ae81ff">31</span>]    <span style="color:#75715e"># 32 bytes</span>
</span></span><span style="display:flex;"><span>clientIV_i <span style="color:#f92672">=</span> okm[<span style="color:#ae81ff">32</span>:<span style="color:#ae81ff">43</span>]    <span style="color:#75715e"># 12 bytes</span>
</span></span><span style="display:flex;"><span>clientID_i <span style="color:#f92672">=</span> okm[<span style="color:#ae81ff">44</span>:<span style="color:#ae81ff">51</span>]    <span style="color:#75715e"># 8 bytes</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Search Layer 1 authorization data for clientID_i</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> (clientID, clientCookie) <span style="color:#f92672">in</span> layer1_auth_entries:
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> clientID <span style="color:#f92672">==</span> clientID_i:
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Found matching entry, decrypt authCookie</span>
</span></span><span style="display:flex;"><span>        authCookie <span style="color:#f92672">=</span> DECRYPT(clientKey_i, clientIV_i, clientCookie)
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Use authCookie to decrypt Layer 2</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">break</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># No matching entry - client not authorized or revoked</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">raise</span> AuthorizationError(<span style="color:#e6db74">&#34;Client not authorized&#34;</span>)
</span></span></code></pre></div><h3 id="comparaison-et-recommandations">Comparaison et recommandations</h3>
<table style="width:100%; border-collapse:collapse; margin-bottom:1.5rem;">
  <thead>
    <tr>
      <th style="border:1px solid var(--color-border); padding:0.5rem; background:var(--color-bg-secondary); text-align:left;">Feature</th>
      <th style="border:1px solid var(--color-border); padding:0.5rem; background:var(--color-bg-secondary); text-align:left;">DH Authorization</th>
      <th style="border:1px solid var(--color-border); padding:0.5rem; background:var(--color-bg-secondary); text-align:left;">PSK Authorization</th>
    </tr>
  </thead>
  <tbody>
    <tr><td style="border:1px solid var(--color-border); padding:0.5rem;"><strong>Key Exchange</strong></td><td style="border:1px solid var(--color-border); padding:0.5rem;">Asymmetric (X25519)</td><td style="border:1px solid var(--color-border); padding:0.5rem;">Symmetric (shared secret)</td></tr>
    <tr><td style="border:1px solid var(--color-border); padding:0.5rem;"><strong>Security</strong></td><td style="border:1px solid var(--color-border); padding:0.5rem;">Higher (forward secrecy)</td><td style="border:1px solid var(--color-border); padding:0.5rem;">Lower (depends on PSK secrecy)</td></tr>
    <tr><td style="border:1px solid var(--color-border); padding:0.5rem;"><strong>Client Privacy</strong></td><td style="border:1px solid var(--color-border); padding:0.5rem;">Private key never transmitted</td><td style="border:1px solid var(--color-border); padding:0.5rem;">PSK must be transmitted securely</td></tr>
    <tr><td style="border:1px solid var(--color-border); padding:0.5rem;"><strong>Performance</strong></td><td style="border:1px solid var(--color-border); padding:0.5rem;">N+1 DH operations</td><td style="border:1px solid var(--color-border); padding:0.5rem;">No DH operations</td></tr>
    <tr><td style="border:1px solid var(--color-border); padding:0.5rem;"><strong>Key Sharing</strong></td><td style="border:1px solid var(--color-border); padding:0.5rem;">One key per client</td><td style="border:1px solid var(--color-border); padding:0.5rem;">Can share key among multiple clients</td></tr>
    <tr><td style="border:1px solid var(--color-border); padding:0.5rem;"><strong>Revocation Detection</strong></td><td style="border:1px solid var(--color-border); padding:0.5rem;">Adversary cannot tell when revoked</td><td style="border:1px solid var(--color-border); padding:0.5rem;">Adversary can track revocation if PSK intercepted</td></tr>
    <tr><td style="border:1px solid var(--color-border); padding:0.5rem;"><strong>Use Case</strong></td><td style="border:1px solid var(--color-border); padding:0.5rem;">High security requirements</td><td style="border:1px solid var(--color-border); padding:0.5rem;">Performance-critical or group access</td></tr>
  </tbody>
</table>
**Recommandation:** - **Utilisez l’autorisation DH** pour des applications hautement sécurisées où la forward secrecy (confidentialité persistante) est importante - **Utilisez l’autorisation PSK** lorsque les performances sont critiques ou lors de la gestion de groupes de clients - **Ne réutilisez jamais les PSK** entre différents services ou périodes - **Utilisez toujours des canaux sécurisés** pour la distribution des clés (p. ex., Signal, OTR, PGP)
<h3 id="considérations-de-sécurité-1">Considérations de sécurité</h3>
<p><strong>Confidentialité de l&rsquo;appartenance des clients:</strong></p>
<p>Les deux mécanismes assurent la confidentialité de l’appartenance des clients grâce à : 1. <strong>Identifiants client chiffrés :</strong> clientID de 8 octets dérivé de la sortie de HKDF 2. <strong>Cookies indiscernables :</strong> tous les clientCookie de 32 octets semblent aléatoires 3. <strong>Aucune métadonnée spécifique à un client :</strong> aucun moyen d’identifier quelle entrée appartient à quel client</p>
<p>Un observateur peut voir : - Nombre de clients autorisés (d&rsquo;après le champ <code>clients</code>) - Évolution du nombre de clients au fil du temps</p>
<p>Un observateur NE PEUT PAS voir: - Quels clients spécifiques sont autorisés - Quand des clients spécifiques sont ajoutés ou supprimés (si le nombre reste inchangé) - Toute information permettant d’identifier un client</p>
<p><strong>Recommandations de randomisation :</strong></p>
<p>Les serveurs DEVRAIENT mélanger aléatoirement l’ordre des clients chaque fois qu’ils génèrent un LeaseSet chiffré :</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> random
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Before serializing</span>
</span></span><span style="display:flex;"><span>auth_entries <span style="color:#f92672">=</span> [(clientID_i, clientCookie_i) <span style="color:#66d9ef">for</span> each client]
</span></span><span style="display:flex;"><span>random<span style="color:#f92672">.</span>shuffle(auth_entries)
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Now serialize in randomized order</span>
</span></span></code></pre></div><p><strong>Avantages :</strong> - Empêche les clients de connaître leur position dans la liste - Empêche les attaques d&rsquo;inférence basées sur des changements de position - Rend indiscernables l&rsquo;ajout et la révocation de clients</p>
<p><strong>Masquer le nombre de clients:</strong></p>
<p>Les serveurs PEUVENT insérer des entrées factices aléatoires :</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># Add dummy entries</span>
</span></span><span style="display:flex;"><span>num_dummies <span style="color:#f92672">=</span> random<span style="color:#f92672">.</span>randint(<span style="color:#ae81ff">0</span>, max_dummies)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> _ <span style="color:#f92672">in</span> range(num_dummies):
</span></span><span style="display:flex;"><span>    dummy_id <span style="color:#f92672">=</span> CSRNG(<span style="color:#ae81ff">8</span>)
</span></span><span style="display:flex;"><span>    dummy_cookie <span style="color:#f92672">=</span> CSRNG(<span style="color:#ae81ff">32</span>)
</span></span><span style="display:flex;"><span>    auth_entries<span style="color:#f92672">.</span>append((dummy_id, dummy_cookie))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Randomize all entries (real + dummy)</span>
</span></span><span style="display:flex;"><span>random<span style="color:#f92672">.</span>shuffle(auth_entries)
</span></span></code></pre></div><p><strong>Coût:</strong> Les entrées factices augmentent la taille du LeaseSet chiffré (40 octets chacune).</p>
<p><strong>Rotation d&rsquo;AuthCookie (cookie d&rsquo;authentification):</strong></p>
<p>Les serveurs devraient générer un nouvel authCookie: - Chaque fois qu&rsquo;un LeaseSet chiffré est publié (toutes les quelques heures, en général) - Immédiatement après la révocation d&rsquo;un client - Selon un calendrier régulier (p. ex., quotidien), même si aucun client ne change</p>
<p><strong>Avantages:</strong> - Limite l&rsquo;exposition si authCookie est compromis - Garantit que les clients révoqués perdent rapidement l&rsquo;accès - Fournit la confidentialité persistante pour la couche 2</p>
<hr>
<h2 id="adressage-en-base32-pour-les-leasesets-chiffrés-ensembles-de-baux">Adressage en Base32 pour les LeaseSets chiffrés (ensembles de baux)</h2>
<h3 id="vue-densemble-1">Vue d&rsquo;ensemble</h3>
<p>Les adresses I2P en base32 traditionnelles ne contiennent que le hachage de la Destination (32 octets → 52 caractères). Cela est insuffisant pour les LeaseSets chiffrés, car :</p>
<ol>
<li>Les clients ont besoin de la <strong>clé publique non aveuglée</strong> pour dériver la clé publique aveuglée</li>
<li>Les clients ont besoin des <strong>types de signature</strong> (non aveuglée et aveuglée) pour une dérivation correcte des clés</li>
<li>Le hachage seul ne fournit pas ces informations</li>
</ol>
<p><strong>Solution :</strong> Un nouveau format base32 qui inclut les types de clé publique et de signature.</p>
<h3 id="spécification-du-format-dadresse">Spécification du format d&rsquo;adresse</h3>
<p><strong>Structure décodée (35 octets):</strong></p>
<pre tabindex="0"><code>┌─────────────────────────────────────────────────────┐
│ Byte 0   │ Byte 1  │ Byte 2  │ Bytes 3-34          │
│ Flags    │ Unblind │ Blinded │ Public Key          │
│ (XOR)    │ SigType │ SigType │ (32 bytes)          │
│          │ (XOR)   │ (XOR)   │                     │
└─────────────────────────────────────────────────────┘
</code></pre><p><strong>Les 3 premiers octets (XOR avec la somme de contrôle):</strong></p>
<p>Les 3 premiers octets contiennent des métadonnées combinées par XOR (ou exclusif) avec des portions d&rsquo;une somme de contrôle CRC-32 :</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># Data structure before XOR</span>
</span></span><span style="display:flex;"><span>flags <span style="color:#f92672">=</span> <span style="color:#ae81ff">0x00</span>           <span style="color:#75715e"># 1 byte (reserved for future use)</span>
</span></span><span style="display:flex;"><span>unblinded_sigtype <span style="color:#f92672">=</span> <span style="color:#ae81ff">0x07</span> <span style="color:#f92672">or</span> <span style="color:#ae81ff">0x0b</span>  <span style="color:#75715e"># 1 byte (7 or 11)</span>
</span></span><span style="display:flex;"><span>blinded_sigtype <span style="color:#f92672">=</span> <span style="color:#ae81ff">0x0b</span>  <span style="color:#75715e"># 1 byte (always 11)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Compute CRC-32 checksum of public key</span>
</span></span><span style="display:flex;"><span>checksum <span style="color:#f92672">=</span> crc32(pubkey)  <span style="color:#75715e"># 4-byte CRC-32 of bytes 3-34</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># XOR first 3 bytes with parts of checksum</span>
</span></span><span style="display:flex;"><span>data[<span style="color:#ae81ff">0</span>] <span style="color:#f92672">=</span> flags XOR (checksum <span style="color:#f92672">&gt;&gt;</span> <span style="color:#ae81ff">24</span>) <span style="color:#f92672">&amp;</span> <span style="color:#ae81ff">0xFF</span>
</span></span><span style="display:flex;"><span>data[<span style="color:#ae81ff">1</span>] <span style="color:#f92672">=</span> unblinded_sigtype XOR (checksum <span style="color:#f92672">&gt;&gt;</span> <span style="color:#ae81ff">16</span>) <span style="color:#f92672">&amp;</span> <span style="color:#ae81ff">0xFF</span>  
</span></span><span style="display:flex;"><span>data[<span style="color:#ae81ff">2</span>] <span style="color:#f92672">=</span> blinded_sigtype XOR (checksum <span style="color:#f92672">&gt;&gt;</span> <span style="color:#ae81ff">8</span>) <span style="color:#f92672">&amp;</span> <span style="color:#ae81ff">0xFF</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Bytes 3-34 contain the unmodified 32-byte public key</span>
</span></span><span style="display:flex;"><span>data[<span style="color:#ae81ff">3</span>:<span style="color:#ae81ff">34</span>] <span style="color:#f92672">=</span> pubkey
</span></span></code></pre></div><p><strong>Propriétés de la somme de contrôle :</strong> - Utilise le polynôme CRC-32 standard - Taux de faux négatifs : ~1 sur 16 millions - Permet de détecter les erreurs de frappe dans les adresses - Ne peut pas être utilisé pour l&rsquo;authentification (non sécurisé cryptographiquement)</p>
<p><strong>Format encodé:</strong></p>
<pre tabindex="0"><code>Base32Encode(35 bytes) || &#34;.b32.i2p&#34;
</code></pre><p><strong>Caractéristiques:</strong> - Nombre total de caractères: 56 (35 octets × 8 bits ÷ 5 bits par caractère) - Suffixe: &ldquo;.b32.i2p&rdquo; (identique à la base32 traditionnelle) - Longueur totale: 56 + 8 = 64 caractères (sans le terminateur nul)</p>
<p><strong>Encodage Base32:</strong> - Alphabet: <code>abcdefghijklmnopqrstuvwxyz234567</code> (standard RFC 4648) - 5 bits inutilisés à la fin DOIVENT être à 0 - Insensible à la casse (par convention en minuscules)</p>
<h3 id="génération-dadresses">Génération d&rsquo;adresses</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> struct
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> zlib <span style="color:#f92672">import</span> crc32
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> base64
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">generate_encrypted_b32_address</span>(pubkey, unblinded_sigtype, blinded_sigtype):
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    Generate base32 address for encrypted LeaseSet.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    Args:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        pubkey: 32-byte public key (bytes)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        unblinded_sigtype: Unblinded signature type (7 or 11)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        blinded_sigtype: Blinded signature type (always 11)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    Returns:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        String address ending in .b32.i2p
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Verify inputs</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">assert</span> len(pubkey) <span style="color:#f92672">==</span> <span style="color:#ae81ff">32</span>, <span style="color:#e6db74">&#34;Public key must be 32 bytes&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">assert</span> unblinded_sigtype <span style="color:#f92672">in</span> [<span style="color:#ae81ff">7</span>, <span style="color:#ae81ff">11</span>], <span style="color:#e6db74">&#34;Unblinded sigtype must be 7 or 11&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">assert</span> blinded_sigtype <span style="color:#f92672">==</span> <span style="color:#ae81ff">11</span>, <span style="color:#e6db74">&#34;Blinded sigtype must be 11&#34;</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Compute CRC-32 of public key</span>
</span></span><span style="display:flex;"><span>    checksum <span style="color:#f92672">=</span> crc32(pubkey) <span style="color:#f92672">&amp;</span> <span style="color:#ae81ff">0xFFFFFFFF</span>  <span style="color:#75715e"># Ensure 32-bit unsigned</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Prepare metadata bytes</span>
</span></span><span style="display:flex;"><span>    flags <span style="color:#f92672">=</span> <span style="color:#ae81ff">0x00</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># XOR metadata with checksum parts</span>
</span></span><span style="display:flex;"><span>    byte0 <span style="color:#f92672">=</span> flags <span style="color:#f92672">^</span> ((checksum <span style="color:#f92672">&gt;&gt;</span> <span style="color:#ae81ff">24</span>) <span style="color:#f92672">&amp;</span> <span style="color:#ae81ff">0xFF</span>)
</span></span><span style="display:flex;"><span>    byte1 <span style="color:#f92672">=</span> unblinded_sigtype <span style="color:#f92672">^</span> ((checksum <span style="color:#f92672">&gt;&gt;</span> <span style="color:#ae81ff">16</span>) <span style="color:#f92672">&amp;</span> <span style="color:#ae81ff">0xFF</span>)
</span></span><span style="display:flex;"><span>    byte2 <span style="color:#f92672">=</span> blinded_sigtype <span style="color:#f92672">^</span> ((checksum <span style="color:#f92672">&gt;&gt;</span> <span style="color:#ae81ff">8</span>) <span style="color:#f92672">&amp;</span> <span style="color:#ae81ff">0xFF</span>)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Construct 35-byte data</span>
</span></span><span style="display:flex;"><span>    data <span style="color:#f92672">=</span> bytes([byte0, byte1, byte2]) <span style="color:#f92672">+</span> pubkey
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Base32 encode (standard alphabet)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Python&#39;s base64 module uses uppercase by default</span>
</span></span><span style="display:flex;"><span>    b32 <span style="color:#f92672">=</span> base64<span style="color:#f92672">.</span>b32encode(data)<span style="color:#f92672">.</span>decode(<span style="color:#e6db74">&#39;ascii&#39;</span>)<span style="color:#f92672">.</span>lower()<span style="color:#f92672">.</span>rstrip(<span style="color:#e6db74">&#39;=&#39;</span>)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Construct full address</span>
</span></span><span style="display:flex;"><span>    address <span style="color:#f92672">=</span> b32 <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;.b32.i2p&#34;</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> address
</span></span></code></pre></div><h3 id="analyse-syntaxique-des-adresses">Analyse syntaxique des adresses</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> struct
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> zlib <span style="color:#f92672">import</span> crc32
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> base64
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">parse_encrypted_b32_address</span>(address):
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    Parse base32 address for encrypted LeaseSet.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    Args:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        address: String address ending in .b32.i2p
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    Returns:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        Tuple of (pubkey, unblinded_sigtype, blinded_sigtype)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    Raises:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        ValueError: If address is invalid or checksum fails
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Remove suffix</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> address<span style="color:#f92672">.</span>endswith(<span style="color:#e6db74">&#39;.b32.i2p&#39;</span>):
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">raise</span> <span style="color:#a6e22e">ValueError</span>(<span style="color:#e6db74">&#34;Invalid address suffix&#34;</span>)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    b32 <span style="color:#f92672">=</span> address[:<span style="color:#f92672">-</span><span style="color:#ae81ff">8</span>]  <span style="color:#75715e"># Remove &#34;.b32.i2p&#34;</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Verify length (56 characters for 35 bytes)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> len(b32) <span style="color:#f92672">!=</span> <span style="color:#ae81ff">56</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">raise</span> <span style="color:#a6e22e">ValueError</span>(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Invalid length: </span><span style="color:#e6db74">{</span>len(b32)<span style="color:#e6db74">}</span><span style="color:#e6db74"> (expected 56)&#34;</span>)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Base32 decode</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Add padding if needed</span>
</span></span><span style="display:flex;"><span>    padding_needed <span style="color:#f92672">=</span> (<span style="color:#ae81ff">8</span> <span style="color:#f92672">-</span> (len(b32) <span style="color:#f92672">%</span> <span style="color:#ae81ff">8</span>)) <span style="color:#f92672">%</span> <span style="color:#ae81ff">8</span>
</span></span><span style="display:flex;"><span>    b32_padded <span style="color:#f92672">=</span> b32<span style="color:#f92672">.</span>upper() <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;=&#39;</span> <span style="color:#f92672">*</span> padding_needed
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">try</span>:
</span></span><span style="display:flex;"><span>        data <span style="color:#f92672">=</span> base64<span style="color:#f92672">.</span>b32decode(b32_padded)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">except</span> <span style="color:#a6e22e">Exception</span> <span style="color:#66d9ef">as</span> e:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">raise</span> <span style="color:#a6e22e">ValueError</span>(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Invalid base32 encoding: </span><span style="color:#e6db74">{</span>e<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Verify decoded length</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> len(data) <span style="color:#f92672">!=</span> <span style="color:#ae81ff">35</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">raise</span> <span style="color:#a6e22e">ValueError</span>(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Invalid decoded length: </span><span style="color:#e6db74">{</span>len(data)<span style="color:#e6db74">}</span><span style="color:#e6db74"> (expected 35)&#34;</span>)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Extract public key</span>
</span></span><span style="display:flex;"><span>    pubkey <span style="color:#f92672">=</span> data[<span style="color:#ae81ff">3</span>:<span style="color:#ae81ff">35</span>]
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Compute CRC-32 for verification</span>
</span></span><span style="display:flex;"><span>    checksum <span style="color:#f92672">=</span> crc32(pubkey) <span style="color:#f92672">&amp;</span> <span style="color:#ae81ff">0xFFFFFFFF</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Un-XOR metadata bytes</span>
</span></span><span style="display:flex;"><span>    flags <span style="color:#f92672">=</span> data[<span style="color:#ae81ff">0</span>] <span style="color:#f92672">^</span> ((checksum <span style="color:#f92672">&gt;&gt;</span> <span style="color:#ae81ff">24</span>) <span style="color:#f92672">&amp;</span> <span style="color:#ae81ff">0xFF</span>)
</span></span><span style="display:flex;"><span>    unblinded_sigtype <span style="color:#f92672">=</span> data[<span style="color:#ae81ff">1</span>] <span style="color:#f92672">^</span> ((checksum <span style="color:#f92672">&gt;&gt;</span> <span style="color:#ae81ff">16</span>) <span style="color:#f92672">&amp;</span> <span style="color:#ae81ff">0xFF</span>)
</span></span><span style="display:flex;"><span>    blinded_sigtype <span style="color:#f92672">=</span> data[<span style="color:#ae81ff">2</span>] <span style="color:#f92672">^</span> ((checksum <span style="color:#f92672">&gt;&gt;</span> <span style="color:#ae81ff">8</span>) <span style="color:#f92672">&amp;</span> <span style="color:#ae81ff">0xFF</span>)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Verify expected values</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> flags <span style="color:#f92672">!=</span> <span style="color:#ae81ff">0x00</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">raise</span> <span style="color:#a6e22e">ValueError</span>(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Invalid flags: </span><span style="color:#e6db74">{</span>flags<span style="color:#e6db74">:</span><span style="color:#e6db74">#x</span><span style="color:#e6db74">}</span><span style="color:#e6db74"> (expected 0x00)&#34;</span>)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> unblinded_sigtype <span style="color:#f92672">not</span> <span style="color:#f92672">in</span> [<span style="color:#ae81ff">7</span>, <span style="color:#ae81ff">11</span>]:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">raise</span> <span style="color:#a6e22e">ValueError</span>(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Invalid unblinded sigtype: </span><span style="color:#e6db74">{</span>unblinded_sigtype<span style="color:#e6db74">}</span><span style="color:#e6db74"> (expected 7 or 11)&#34;</span>)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> blinded_sigtype <span style="color:#f92672">!=</span> <span style="color:#ae81ff">11</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">raise</span> <span style="color:#a6e22e">ValueError</span>(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Invalid blinded sigtype: </span><span style="color:#e6db74">{</span>blinded_sigtype<span style="color:#e6db74">}</span><span style="color:#e6db74"> (expected 11)&#34;</span>)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> pubkey, unblinded_sigtype, blinded_sigtype
</span></span></code></pre></div><h3 id="comparaison-avec-le-base32-traditionnel">Comparaison avec le Base32 traditionnel</h3>
<table style="width:100%; border-collapse:collapse; margin-bottom:1.5rem;">
  <thead>
    <tr>
      <th style="border:1px solid var(--color-border); padding:0.5rem; background:var(--color-bg-secondary); text-align:left;">Feature</th>
      <th style="border:1px solid var(--color-border); padding:0.5rem; background:var(--color-bg-secondary); text-align:left;">Traditional B32</th>
      <th style="border:1px solid var(--color-border); padding:0.5rem; background:var(--color-bg-secondary); text-align:left;">Encrypted LS2 B32</th>
    </tr>
  </thead>
  <tbody>
    <tr><td style="border:1px solid var(--color-border); padding:0.5rem;"><strong>Content</strong></td><td style="border:1px solid var(--color-border); padding:0.5rem;">SHA-256 hash of Destination</td><td style="border:1px solid var(--color-border); padding:0.5rem;">Public key + signature types</td></tr>
    <tr><td style="border:1px solid var(--color-border); padding:0.5rem;"><strong>Decoded Size</strong></td><td style="border:1px solid var(--color-border); padding:0.5rem;">32 bytes</td><td style="border:1px solid var(--color-border); padding:0.5rem;">35 bytes</td></tr>
    <tr><td style="border:1px solid var(--color-border); padding:0.5rem;"><strong>Encoded Length</strong></td><td style="border:1px solid var(--color-border); padding:0.5rem;">52 characters</td><td style="border:1px solid var(--color-border); padding:0.5rem;">56 characters</td></tr>
    <tr><td style="border:1px solid var(--color-border); padding:0.5rem;"><strong>Suffix</strong></td><td style="border:1px solid var(--color-border); padding:0.5rem;">.b32.i2p</td><td style="border:1px solid var(--color-border); padding:0.5rem;">.b32.i2p</td></tr>
    <tr><td style="border:1px solid var(--color-border); padding:0.5rem;"><strong>Total Length</strong></td><td style="border:1px solid var(--color-border); padding:0.5rem;">60 chars</td><td style="border:1px solid var(--color-border); padding:0.5rem;">64 chars</td></tr>
    <tr><td style="border:1px solid var(--color-border); padding:0.5rem;"><strong>Checksum</strong></td><td style="border:1px solid var(--color-border); padding:0.5rem;">None</td><td style="border:1px solid var(--color-border); padding:0.5rem;">CRC-32 (XOR'd into first 3 bytes)</td></tr>
    <tr><td style="border:1px solid var(--color-border); padding:0.5rem;"><strong>Use Case</strong></td><td style="border:1px solid var(--color-border); padding:0.5rem;">Regular destinations</td><td style="border:1px solid var(--color-border); padding:0.5rem;">Encrypted LeaseSet destinations</td></tr>
  </tbody>
</table>
### Restrictions d'utilisation
<p><strong>Incompatibilité avec BitTorrent:</strong></p>
<p>Les adresses LS2 chiffrées NE PEUVENT PAS être utilisées avec les réponses d’annonce compactes de BitTorrent :</p>
<pre tabindex="0"><code>Compact announce reply format:
┌────────────────────────────┐
│ 32-byte destination hash   │  ← Only hash, no signature types
│ 2-byte port                │
└────────────────────────────┘
</code></pre><p><strong>Problème:</strong> Le format compact ne contient que le hachage (32 octets), sans espace pour les types de signature ni les informations de clé publique.</p>
<p><strong>Solution :</strong> Utilisez des réponses d&rsquo;annonce complètes ou des trackers basés sur HTTP qui prennent en charge les adresses complètes.</p>
<h3 id="intégration-du-carnet-dadresses">Intégration du carnet d’adresses</h3>
<p>Si un client dispose de la Destination complète (identifiant cryptographique I2P) dans un carnet d’adresses :</p>
<ol>
<li>Stocker la Destination complète (identité I2P) (inclut la clé publique)</li>
<li>Prendre en charge la recherche inverse par hachage</li>
<li>Lorsqu&rsquo;un LS2 (LeaseSet version 2) chiffré est rencontré, récupérer la clé publique depuis le carnet d&rsquo;adresses</li>
<li>Pas besoin d&rsquo;un nouveau format base32 si la Destination complète est déjà connue</li>
</ol>
<p><strong>Formats de carnet d’adresses qui prennent en charge LS2 (LeaseSet2, nouvelle version de leaseSet) chiffré:</strong> - hosts.txt avec des chaînes de destination complètes - bases de données SQLite avec colonne de destination - formats JSON/XML avec des données de destination complètes</p>
<h3 id="exemples-dimplémentation">Exemples d&rsquo;implémentation</h3>
<p><strong>Exemple 1 : Générer une adresse</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># Ed25519 destination example</span>
</span></span><span style="display:flex;"><span>pubkey <span style="color:#f92672">=</span> bytes<span style="color:#f92672">.</span>fromhex(<span style="color:#e6db74">&#39;a&#39;</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">64</span>)  <span style="color:#75715e"># 32-byte public key</span>
</span></span><span style="display:flex;"><span>unblinded_type <span style="color:#f92672">=</span> <span style="color:#ae81ff">7</span>   <span style="color:#75715e"># Ed25519</span>
</span></span><span style="display:flex;"><span>blinded_type <span style="color:#f92672">=</span> <span style="color:#ae81ff">11</span>    <span style="color:#75715e"># Red25519 (always)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>address <span style="color:#f92672">=</span> generate_encrypted_b32_address(pubkey, unblinded_type, blinded_type)
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Address: </span><span style="color:#e6db74">{</span>address<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Output: 56 base32 characters + .b32.i2p</span>
</span></span></code></pre></div><p><strong>Exemple 2: Analyser et valider</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>address <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;abc...xyz.b32.i2p&#34;</span>  <span style="color:#75715e"># 56 chars + suffix</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">try</span>:
</span></span><span style="display:flex;"><span>    pubkey, unblinded, blinded <span style="color:#f92672">=</span> parse_encrypted_b32_address(address)
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Public Key: </span><span style="color:#e6db74">{</span>pubkey<span style="color:#f92672">.</span>hex()<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Unblinded SigType: </span><span style="color:#e6db74">{</span>unblinded<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Blinded SigType: </span><span style="color:#e6db74">{</span>blinded<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">except</span> <span style="color:#a6e22e">ValueError</span> <span style="color:#66d9ef">as</span> e:
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Invalid address: </span><span style="color:#e6db74">{</span>e<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span></code></pre></div><p><strong>Exemple 3 : Conversion depuis une Destination (identité publique I2P)</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">destination_to_encrypted_b32</span>(destination):
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    Convert full Destination to encrypted LS2 base32 address.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    Args:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        destination: I2P Destination object
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    Returns:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        Base32 address string
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Extract public key and signature type from destination</span>
</span></span><span style="display:flex;"><span>    pubkey <span style="color:#f92672">=</span> destination<span style="color:#f92672">.</span>signing_public_key  <span style="color:#75715e"># 32 bytes</span>
</span></span><span style="display:flex;"><span>    sigtype <span style="color:#f92672">=</span> destination<span style="color:#f92672">.</span>sig_type  <span style="color:#75715e"># 7 or 11</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Blinded type is always 11 (Red25519)</span>
</span></span><span style="display:flex;"><span>    blinded_type <span style="color:#f92672">=</span> <span style="color:#ae81ff">11</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Generate address</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> generate_encrypted_b32_address(pubkey, sigtype, blinded_type)
</span></span></code></pre></div><h3 id="considérations-de-sécurité-2">Considérations de sécurité</h3>
<p><strong>Confidentialité:</strong> - L&rsquo;adresse Base32 révèle la clé publique - C&rsquo;est intentionnel et requis par le protocole - Ne révèle PAS la clé privée et ne compromet pas la sécurité - Les clés publiques sont, par conception, des informations publiques</p>
<p><strong>Résistance aux collisions:</strong> - CRC-32 n&rsquo;offre que 32 bits de résistance aux collisions - Non sécurisé cryptographiquement (à utiliser uniquement pour la détection d&rsquo;erreurs) - Ne PAS s’appuyer sur la somme de contrôle pour l’authentification - Une vérification complète de la destination reste nécessaire</p>
<p><strong>Validation d&rsquo;adresse:</strong> - Toujours valider la somme de contrôle avant utilisation - Rejeter les adresses avec des types de signature invalides - Vérifier que la clé publique est sur la courbe (spécifique à l&rsquo;implémentation)</p>
<p><strong>Références:</strong> - <a href="../../../../fr/proposals/149-b32-encrypted-ls2/">Proposition 149 : B32 pour LS2 chiffré</a>
 - <a href="../../../../fr/docs/specs/b32-for-encrypted-leasesets/">Spécification d&rsquo;adressage B32</a>
 - <a href="../../../../fr/docs/overview/naming/">Spécification de nommage I2P</a>
</p>
<hr>
<h2 id="prise-en-charge-des-clés-hors-ligne">Prise en charge des clés hors ligne</h2>
<h3 id="aperçu-2">Aperçu</h3>
<p>Les clés hors ligne permettent à la clé de signature principale de rester hors ligne (stockage à froid) tandis qu&rsquo;une clé de signature éphémère est utilisée pour les opérations quotidiennes. Cela est essentiel pour les services à haute sécurité.</p>
<p><strong>Exigences spécifiques pour LS2 chiffré:</strong> - Les clés éphémères doivent être générées hors ligne - Les clés privées aveuglées doivent être pré-générées (une par jour) - Les clés, qu’elles soient éphémères ou aveuglées, sont fournies par lots - Aucun format de fichier standardisé n’est encore défini (à faire dans la spécification)</p>
<h3 id="structure-de-la-clé-hors-ligne">Structure de la clé hors ligne</h3>
<p><strong>Données de clé éphémère de la couche 0 (lorsque le bit de drapeau 0 = 1) :</strong></p>
<pre tabindex="0"><code>┌───────────────────────────────────────────────────┐
│ Expires Timestamp       │ 4 bytes (seconds)       │
│ Transient Sig Type      │ 2 bytes (big endian)    │
│ Transient Signing Pubkey│ Variable (sigtype len)  │
│ Signature (by blinded)  │ 64 bytes (Red25519)     │
└───────────────────────────────────────────────────┘
</code></pre><p><strong>Portée de la signature:</strong> La signature dans le bloc de clé hors ligne couvre : - Horodatage d’expiration (4 octets) - Type de signature temporaire (2 octets)   - Clé publique de signature temporaire (variable)</p>
<p>Cette signature est vérifiée à l&rsquo;aide de la <strong>clé publique aveuglée</strong>, prouvant que l&rsquo;entité détenant la clé privée aveuglée a autorisé cette clé éphémère.</p>
<h3 id="processus-de-génération-de-clés">Processus de génération de clés</h3>
<p><strong>Pour un LeaseSet chiffré avec des clés hors ligne:</strong></p>
<ol>
<li>
<p><strong>Générer des paires de clés éphémères</strong> (hors ligne, en stockage à froid):</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># For each day in future</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> date <span style="color:#f92672">in</span> future_dates:
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Generate daily transient keypair</span>
</span></span><span style="display:flex;"><span>    transient_privkey <span style="color:#f92672">=</span> generate_red25519_privkey()  <span style="color:#75715e"># Type 11</span>
</span></span><span style="display:flex;"><span>    transient_pubkey <span style="color:#f92672">=</span> derive_public(transient_privkey)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Store for later delivery</span>
</span></span><span style="display:flex;"><span>    keys[date] <span style="color:#f92672">=</span> (transient_privkey, transient_pubkey)
</span></span></code></pre></div></li>
<li>
<p><strong>Generate daily blinded keypairs</strong> (offline, in cold storage):</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"></code></pre></div></li>
</ol>
<h1 id="pour-chaque-jour----for-date-in-future_dates">Pour chaque jour    for date in future_dates:</h1>
<pre><code>   # Derive alpha for this date
   datestring = date.strftime(&quot;%Y%m%d&quot;)  # &quot;YYYYMMDD&quot;
   alpha = GENERATE_ALPHA(destination, datestring, secret)
   
   # Blind the signing private key
   a = destination_signing_privkey  # Type 7 or 11
   blinded_privkey = BLIND_PRIVKEY(a, alpha)  # Result is type 11
   blinded_pubkey = DERIVE_PUBLIC(blinded_privkey)
   
   # Store for later delivery
   blinded_keys[date] = (blinded_privkey, blinded_pubkey)
</code></pre>
<pre tabindex="0"><code>
3. **Sign transient keys with blinded keys** (offline):
```python
for date in future_dates:

    transient_pubkey = keys[date][1]
    blinded_privkey = blinded_keys[date][0]
    
    # Create signature data
    expires = int((date + timedelta(days=1)).timestamp())
    sig_data = struct.pack(&#39;&gt;I&#39;, expires)  # 4 bytes
    sig_data += struct.pack(&#39;&gt;H&#39;, 11)     # Transient type (Red25519)
    sig_data += transient_pubkey          # 32 bytes
    
    # Sign with blinded private key
    signature = RED25519_SIGN(blinded_privkey, sig_data)
    
    # Package for delivery
    offline_sig_blocks[date] = {
        &#39;expires&#39;: expires,
        &#39;transient_type&#39;: 11,
        &#39;transient_pubkey&#39;: transient_pubkey,
        &#39;signature&#39;: signature
    }
</code></pre><ol start="4">
<li><strong>Package for delivery to router:</strong>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"></code></pre></div></li>
</ol>
<h1 id="pour-chaque-date----delivery_packagedate--">Pour chaque date    delivery_package[date] = {</h1>
<pre><code>   'transient_privkey': keys[date][0],
   'transient_pubkey': keys[date][1],
   'blinded_privkey': blinded_keys[date][0],
   'blinded_pubkey': blinded_keys[date][1],
   'offline_sig_block': offline_sig_blocks[date]
</code></pre>
<p>}</p>
<pre tabindex="0"><code>
### Router Usage

**Daily Key Loading:**

```python
# À minuit UTC (ou avant publication)

date = datetime.utcnow().date()

# Charger les clés du jour

today_keys = load_delivery_package(date)

transient_privkey = today_keys[&#39;transient_privkey&#39;] transient_pubkey = today_keys[&#39;transient_pubkey&#39;] blinded_privkey = today_keys[&#39;blinded_privkey&#39;] blinded_pubkey = today_keys[&#39;blinded_pubkey&#39;] offline_sig_block = today_keys[&#39;offline_sig_block&#39;]

# Utilisez ces clés pour le LeaseSet (ensemble de baux) chiffré d&#39;aujourd&#39;hui
</code></pre><p><strong>Publishing Process:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># 1. Créer un LeaseSet2 interne</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>inner_ls2 <span style="color:#f92672">=</span> create_leaseset2(
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    destinations, leases, expires, 
</span></span><span style="display:flex;"><span>    signing_key<span style="color:#f92672">=</span>transient_privkey  <span style="color:#75715e"># Use transient key</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 2. Chiffrer la couche 2</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>layer2_ciphertext <span style="color:#f92672">=</span> encrypt_layer2(inner_ls2, authCookie, subcredential, timestamp)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 3. Créer la couche 1 avec des données d’autorisation</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>layer1_plaintext <span style="color:#f92672">=</span> create_layer1(authorization_data, layer2_ciphertext)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 4. Chiffrer la couche 1</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>layer1_ciphertext <span style="color:#f92672">=</span> encrypt_layer1(layer1_plaintext, subcredential, timestamp)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 5. Créer la couche 0 avec un bloc de signature hors ligne</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>layer0 <span style="color:#f92672">=</span> create_layer0(
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    blinded_pubkey,
</span></span><span style="display:flex;"><span>    timestamp,
</span></span><span style="display:flex;"><span>    expires,
</span></span><span style="display:flex;"><span>    flags<span style="color:#f92672">=</span><span style="color:#ae81ff">0x0001</span>,  <span style="color:#75715e"># Bit 0 set (offline keys present)</span>
</span></span><span style="display:flex;"><span>    offline_sig_block<span style="color:#f92672">=</span>offline_sig_block,
</span></span><span style="display:flex;"><span>    layer1_ciphertext<span style="color:#f92672">=</span>layer1_ciphertext
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 6. Signer la couche 0 avec une clé privée éphémère</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>signature <span style="color:#f92672">=</span> RED25519_SIGN(transient_privkey, layer0)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 7. Ajouter la signature et publier</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>encrypted_leaseset <span style="color:#f92672">=</span> layer0 <span style="color:#f92672">+</span> signature publish_to_netdb(encrypted_leaseset)
</span></span></code></pre></div><h3 id="security-considerations">Security Considerations</h3>
<p><strong>Tracking via Offline Signature Block:</strong></p>
<p>The offline signature block is in plaintext (Layer 0). An adversary scraping floodfills could:</p>
<ul>
<li>Track the same encrypted LeaseSet across multiple days</li>
<li>Correlate encrypted LeaseSets even though blinded keys change daily</li>
</ul>
<p><strong>Mitigation:</strong> Generate new transient keys daily (in addition to blinded keys):</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># Générez LES DEUX, de nouvelles clés éphémères et de nouvelles clés aveuglées, chaque jour</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> date <span style="color:#f92672">in</span> future_dates:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># New transient keypair for this day</span>
</span></span><span style="display:flex;"><span>    transient_privkey <span style="color:#f92672">=</span> generate_red25519_privkey()
</span></span><span style="display:flex;"><span>    transient_pubkey <span style="color:#f92672">=</span> derive_public(transient_privkey)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># New blinded keypair for this day</span>
</span></span><span style="display:flex;"><span>    alpha <span style="color:#f92672">=</span> GENERATE_ALPHA(destination, datestring, secret)
</span></span><span style="display:flex;"><span>    blinded_privkey <span style="color:#f92672">=</span> BLIND_PRIVKEY(signing_privkey, alpha)
</span></span><span style="display:flex;"><span>    blinded_pubkey <span style="color:#f92672">=</span> DERIVE_PUBLIC(blinded_privkey)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Sign new transient key with new blinded key</span>
</span></span><span style="display:flex;"><span>    sig <span style="color:#f92672">=</span> RED25519_SIGN(blinded_privkey, transient_pubkey <span style="color:#f92672">||</span> metadata)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Now offline sig block changes daily</span>
</span></span></code></pre></div><p><strong>Benefits:</strong></p>
<ul>
<li>Prevents tracking across days via offline signature block</li>
<li>Provides same security as encrypted LS2 without offline keys</li>
<li>Each day appears completely independent</li>
</ul>
<p><strong>Cost:</strong></p>
<ul>
<li>More keys to generate and store</li>
<li>More complex key management</li>
</ul>
<h3 id="file-format-todo">File Format (TODO)</h3>
<p><strong>Current Status:</strong> No standardized file format defined for batch key delivery.</p>
<p><strong>Requirements for Future Format:</strong></p>
<ol>
<li>
<p><strong>Must support multiple dates:</strong></p>
<ul>
<li>Batch delivery of 30+ days worth of keys</li>
<li>Clear date association for each key set</li>
</ul>
</li>
<li>
<p><strong>Must include all necessary data:</strong></p>
<ul>
<li>Transient private key</li>
<li>Transient public key</li>
<li>Blinded private key</li>
<li>Blinded public key</li>
<li>Pre-computed offline signature block</li>
<li>Expiration timestamps</li>
</ul>
</li>
<li>
<p><strong>Should be tamper-evident:</strong></p>
<ul>
<li>Checksums or signatures over entire file</li>
<li>Integrity verification before loading</li>
</ul>
</li>
<li>
<p><strong>Should be encrypted:</strong></p>
<ul>
<li>Keys are sensitive material</li>
<li>Encrypt file with router&rsquo;s key or passphrase</li>
</ul>
</li>
</ol>
<p><strong>Proposed Format Example (JSON, encrypted):</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{   <span style="color:#f92672">&#34;version&#34;</span>: <span style="color:#ae81ff">1</span>,   <span style="color:#f92672">&#34;destination_hash&#34;</span>: <span style="color:#e6db74">&#34;base64...&#34;</span>,   <span style="color:#f92672">&#34;keys&#34;</span>: [
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;date&#34;</span>: <span style="color:#e6db74">&#34;2025-10-15&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;transient&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;type&#34;</span>: <span style="color:#ae81ff">11</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;privkey&#34;</span>: <span style="color:#e6db74">&#34;base64...&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;pubkey&#34;</span>: <span style="color:#e6db74">&#34;base64...&#34;</span>
</span></span><span style="display:flex;"><span>      },
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;blinded&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;privkey&#34;</span>: <span style="color:#e6db74">&#34;base64...&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;pubkey&#34;</span>: <span style="color:#e6db74">&#34;base64...&#34;</span>
</span></span><span style="display:flex;"><span>      },
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;offline_sig_block&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;expires&#34;</span>: <span style="color:#ae81ff">1729123200</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;signature&#34;</span>: <span style="color:#e6db74">&#34;base64...&#34;</span>
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>],   <span style="color:#f92672">&#34;signature&#34;</span>: <span style="color:#e6db74">&#34;base64...&#34;</span>  <span style="color:#75715e">// Signature over entire structure }
</span></span></span></code></pre></div><h3 id="i2cp-protocol-enhancement-todo">I2CP Protocol Enhancement (TODO)</h3>
<p><strong>Current Status:</strong> No I2CP protocol enhancement defined for offline keys with encrypted LeaseSet.</p>
<p><strong>Requirements:</strong></p>
<ol>
<li>
<p><strong>Key delivery mechanism:</strong></p>
<ul>
<li>Upload batch of keys from client to router</li>
<li>Acknowledgment of successful key loading</li>
</ul>
</li>
<li>
<p><strong>Key expiration notification:</strong></p>
<ul>
<li>Router notifies client when keys running low</li>
<li>Client can generate and upload new batch</li>
</ul>
</li>
<li>
<p><strong>Key revocation:</strong></p>
<ul>
<li>Emergency revocation of future keys if compromise suspected</li>
</ul>
</li>
</ol>
<p><strong>Proposed I2CP Messages:</strong></p>
<pre tabindex="0"><code>UPLOAD_OFFLINE_KEYS   - Lot de matériel de clés chiffré   - Plage de dates couverte

OFFLINE_KEY_STATUS   - Nombre de jours restants   - Date d&#39;expiration de la prochaine clé

REVOKE_OFFLINE_KEYS     - Plage de dates à révoquer   - Nouvelles clés de remplacement (facultatif)
</code></pre><h3 id="implementation-status">Implementation Status</h3>
<p><strong>Java I2P:</strong></p>
<ul>
<li>✅ Offline keys for standard LS2: Fully supported (since 0.9.38)</li>
<li>⚠️ Offline keys for encrypted LS2: Implemented (since 0.9.40)</li>
<li>❌ File format: Not standardized</li>
<li>❌ I2CP protocol: Not enhanced</li>
</ul>
<p><strong>i2pd (C++):</strong></p>
<ul>
<li>✅ Offline keys for standard LS2: Fully supported</li>
<li>✅ Offline keys for encrypted LS2: Fully supported (since 2.58.0)</li>
<li>❌ File format: Not standardized</li>
<li>❌ I2CP protocol: Not enhanced</li>
</ul>
<p><strong>References:</strong></p>
<ul>
<li><a href="../../../../fr/proposals/123-new-netdb-entries/">Offline Signatures Proposal</a>
</li>
<li><a href="../../../../fr/docs/specs/i2cp/">I2CP Specification</a>
</li>
</ul>
<hr>
<h2 id="security-considerations-1">Security Considerations</h2>
<h3 id="cryptographic-security">Cryptographic Security</h3>
<p><strong>Algorithm Selection:</strong></p>
<p>All cryptographic primitives are based on well-studied algorithms:</p>
<ul>
<li><strong>ChaCha20:</strong> Modern stream cipher, constant-time, no timing attacks</li>
<li><strong>SHA-256:</strong> NIST-approved hash, 128-bit security level</li>
<li><strong>HKDF:</strong> RFC 5869 standard, proven security bounds</li>
<li><strong>Ed25519/Red25519:</strong> Curve25519-based, ~128-bit security level</li>
<li><strong>X25519:</strong> Diffie-Hellman over Curve25519, ~128-bit security level</li>
</ul>
<p><strong>Key Sizes:</strong></p>
<ul>
<li>All symmetric keys: 256 bits (32 bytes)</li>
<li>All public/private keys: 256 bits (32 bytes)</li>
<li>All nonces/IVs: 96 bits (12 bytes)</li>
<li>All signatures: 512 bits (64 bytes)</li>
</ul>
<p>These sizes provide adequate security margins against current and near-future attacks.</p>
<h3 id="forward-secrecy">Forward Secrecy</h3>
<p><strong>Daily Key Rotation:</strong></p>
<p>Encrypted LeaseSets rotate keys daily (UTC midnight):</p>
<ul>
<li>New blinded public/private key pair</li>
<li>New storage location in DHT</li>
<li>New encryption keys for both layers</li>
</ul>
<p><strong>Benefits:</strong></p>
<ul>
<li>Compromising today&rsquo;s blinded key doesn&rsquo;t reveal yesterday&rsquo;s</li>
<li>Limits exposure window to 24 hours</li>
<li>Prevents long-term tracking via DHT</li>
</ul>
<p><strong>Enhanced with Ephemeral Keys:</strong></p>
<p>DH client authorization uses ephemeral keys:</p>
<ul>
<li>Server generates new ephemeral DH keypair for each publication</li>
<li>Compromising ephemeral key only affects that publication</li>
<li>True forward secrecy even if long-term keys compromised</li>
</ul>
<h3 id="privacy-properties">Privacy Properties</h3>
<p><strong>Destination Blinding:</strong></p>
<p>The blinded public key:</p>
<ul>
<li>Is unlinkable to the original destination (without knowing the secret)</li>
<li>Changes daily, preventing long-term correlation</li>
<li>Cannot be reversed to find the original public key</li>
</ul>
<p><strong>Client Membership Privacy:</strong></p>
<p>Per-client authorization provides:</p>
<ul>
<li><strong>Anonymity:</strong> No way to identify which clients are authorized</li>
<li><strong>Untraceability:</strong> Cannot track when specific clients added/revoked</li>
<li><strong>Size obfuscation:</strong> Can add dummy entries to hide true count</li>
</ul>
<p><strong>DHT Privacy:</strong></p>
<p>Storage location rotates daily:</p>
<pre tabindex="0"><code>location = SHA-256(sig_type || blinded_public_key)
</code></pre><p>This prevents:</p>
<ul>
<li>Correlation across days via DHT lookups</li>
<li>Long-term monitoring of service availability</li>
<li>Traffic analysis of DHT queries</li>
</ul>
<h3 id="threat-model">Threat Model</h3>
<p><strong>Adversary Capabilities:</strong></p>
<ol>
<li>
<p><strong>Network Adversary:</strong></p>
<ul>
<li>Can monitor all DHT traffic</li>
<li>Can observe encrypted LeaseSet publications</li>
<li>Cannot decrypt without proper keys</li>
</ul>
</li>
<li>
<p><strong>Floodfill Adversary:</strong></p>
<ul>
<li>Can store and analyze all encrypted LeaseSets</li>
<li>Can track publication patterns over time</li>
<li>Cannot decrypt Layer 1 or Layer 2</li>
<li>Can see client count (but not identities)</li>
</ul>
</li>
<li>
<p><strong>Authorized Client Adversary:</strong></p>
<ul>
<li>Can decrypt specific encrypted LeaseSets</li>
<li>Can access inner LeaseSet2 data</li>
<li>Cannot determine other clients&rsquo; identities</li>
<li>Cannot decrypt past LeaseSets (with ephemeral keys)</li>
</ul>
</li>
</ol>
<p><strong>Out of Scope:</strong></p>
<ul>
<li>Malicious router implementations</li>
<li>Compromised router host systems</li>
<li>Side-channel attacks (timing, power analysis)</li>
<li>Physical access to keys</li>
<li>Social engineering attacks</li>
</ul>
<h3 id="attack-scenarios">Attack Scenarios</h3>
<p><strong>1. Offline Keys Tracking Attack:</strong></p>
<p><strong>Attack:</strong> Adversary tracks encrypted LeaseSets via unchanging offline signature block.</p>
<p><strong>Mitigation:</strong> Generate new transient keys daily (in addition to blinded keys).</p>
<p><strong>Status:</strong> Documented recommendation, implementation-specific.</p>
<p><strong>2. Client Position Inference Attack:</strong></p>
<p><strong>Attack:</strong> If client order is static, clients can infer their position and detect when other clients added/removed.</p>
<p><strong>Mitigation:</strong> Randomize client order in authorization list for each publication.</p>
<p><strong>Status:</strong> Documented recommendation in specification.</p>
<p><strong>3. Client Count Analysis Attack:</strong></p>
<p><strong>Attack:</strong> Adversary monitors client count changes over time to infer service popularity or client churn.</p>
<p><strong>Mitigation:</strong> Add random dummy entries to authorization list.</p>
<p><strong>Status:</strong> Optional feature, deployment-specific trade-off (size vs. privacy).</p>
<p><strong>4. PSK Interception Attack:</strong></p>
<p><strong>Attack:</strong> Adversary intercepts PSK during out-of-band exchange and can decrypt all future encrypted LeaseSets.</p>
<p><strong>Mitigation:</strong> Use DH client authorization instead, or ensure secure key exchange (Signal, OTR, PGP).</p>
<p><strong>Status:</strong> Known limitation of PSK approach, documented in specification.</p>
<p><strong>5. Timing Correlation Attack:</strong></p>
<p><strong>Attack:</strong> Adversary correlates publication times across days to link encrypted LeaseSets.</p>
<p><strong>Mitigation:</strong> Randomize publication times, use delayed publishing.</p>
<p><strong>Status:</strong> Implementation-specific, not addressed in core specification.</p>
<p><strong>6. Long-term Secret Compromise:</strong></p>
<p><strong>Attack:</strong> Adversary compromises the blinding secret and can compute all past and future blinded keys.</p>
<p><strong>Mitigation:</strong></p>
<ul>
<li>Use optional secret parameter (not empty)</li>
<li>Rotate secret periodically</li>
<li>Use different secrets for different services</li>
</ul>
<p><strong>Status:</strong> Secret parameter is optional; using it is highly recommended.</p>
<h3 id="operational-security">Operational Security</h3>
<p><strong>Key Management:</strong></p>
<ol>
<li>
<p><strong>Signing Private Key:</strong></p>
<ul>
<li>Store offline in cold storage</li>
<li>Use only for generating blinded keys (batch process)</li>
<li>Never expose to online router</li>
</ul>
</li>
<li>
<p><strong>Blinded Private Keys:</strong></p>
<ul>
<li>Generate offline, deliver in batches</li>
<li>Rotate daily automatically</li>
<li>Delete after use (forward secrecy)</li>
</ul>
</li>
<li>
<p><strong>Transient Private Keys (with offline keys):</strong></p>
<ul>
<li>Generate offline, deliver in batches</li>
<li>Can be longer-lived (days/weeks)</li>
<li>Rotate regularly for enhanced privacy</li>
</ul>
</li>
<li>
<p><strong>Client Authorization Keys:</strong></p>
<ul>
<li>DH: Client private keys never leave client device</li>
<li>PSK: Use unique keys per client, secure exchange</li>
<li>Revoke immediately upon client removal</li>
</ul>
</li>
</ol>
<p><strong>Secret Management:</strong></p>
<p>The optional secret parameter in <code>GENERATE_ALPHA</code>:</p>
<ul>
<li>SHOULD be used for high-security services</li>
<li>MUST be transmitted securely to authorized clients</li>
<li>SHOULD be rotated periodically (e.g., monthly)</li>
<li>CAN be different for different client groups</li>
</ul>
<p><strong>Monitoring and Auditing:</strong></p>
<ol>
<li>
<p><strong>Publication Monitoring:</strong></p>
<ul>
<li>Verify encrypted LeaseSets published successfully</li>
<li>Monitor floodfill acceptance rates</li>
<li>Alert on publication failures</li>
</ul>
</li>
<li>
<p><strong>Client Access Monitoring:</strong></p>
<ul>
<li>Log client authorization attempts (without identifying clients)</li>
<li>Monitor for unusual patterns</li>
<li>Detect potential attacks early</li>
</ul>
</li>
<li>
<p><strong>Key Rotation Auditing:</strong></p>
<ul>
<li>Verify daily key rotation occurs</li>
<li>Check blinded key changes daily</li>
<li>Ensure old keys are deleted</li>
</ul>
</li>
</ol>
<h3 id="implementation-security">Implementation Security</h3>
<p><strong>Constant-Time Operations:</strong></p>
<p>Implementations MUST use constant-time operations for:</p>
<ul>
<li>All scalar arithmetic (mod L operations)</li>
<li>Private key comparisons</li>
<li>Signature verification</li>
<li>DH key agreement</li>
</ul>
<p><strong>Memory Security:</strong></p>
<ul>
<li>Zero sensitive key material after use</li>
<li>Use secure memory allocation for keys</li>
<li>Prevent keys from being paged to disk</li>
<li>Clear stack variables containing key material</li>
</ul>
<p><strong>Random Number Generation:</strong></p>
<ul>
<li>Use cryptographically secure RNG (CSRNG)</li>
<li>Properly seed RNG from OS entropy source</li>
<li>Do not use predictable RNGs for key material</li>
<li>Verify RNG output quality periodically</li>
</ul>
<p><strong>Input Validation:</strong></p>
<ul>
<li>Validate all public keys are on the curve</li>
<li>Check all signature types are supported</li>
<li>Verify all lengths before parsing</li>
<li>Reject malformed encrypted LeaseSets early</li>
</ul>
<p><strong>Error Handling:</strong></p>
<ul>
<li>Do not leak information via error messages</li>
<li>Use constant-time comparison for authentication</li>
<li>Do not expose timing differences in decryption</li>
<li>Log security-relevant events properly</li>
</ul>
<h3 id="recommendations">Recommendations</h3>
<p><strong>For Service Operators:</strong></p>
<ol>
<li>✅ <strong>Use Red25519 (type 11)</strong> for new destinations</li>
<li>✅ <strong>Use DH client authorization</strong> for high-security services</li>
<li>✅ <strong>Generate new transient keys daily</strong> when using offline keys</li>
<li>✅ <strong>Use the optional secret parameter</strong> in GENERATE_ALPHA</li>
<li>✅ <strong>Randomize client order</strong> in authorization lists</li>
<li>✅ <strong>Monitor publication success</strong> and investigate failures</li>
<li>⚠️ <strong>Consider dummy entries</strong> to hide client count (size trade-off)</li>
</ol>
<p><strong>For Client Implementers:</strong></p>
<ol>
<li>✅ <strong>Validate blinded public keys</strong> are on prime-order subgroup</li>
<li>✅ <strong>Verify all signatures</strong> before trusting data</li>
<li>✅ <strong>Use constant-time operations</strong> for cryptographic primitives</li>
<li>✅ <strong>Zero key material</strong> immediately after use</li>
<li>✅ <strong>Implement proper error handling</strong> without information leaks</li>
<li>✅ <strong>Support both Ed25519 and Red25519</strong> destination types</li>
</ol>
<p><strong>For Network Operators:</strong></p>
<ol>
<li>✅ <strong>Accept encrypted LeaseSets</strong> in floodfill routers</li>
<li>✅ <strong>Enforce reasonable size limits</strong> to prevent abuse</li>
<li>✅ <strong>Monitor for anomalous patterns</strong> (extremely large, frequent updates)</li>
<li>⚠️ <strong>Consider rate limiting</strong> encrypted LeaseSet publications</li>
</ol>
<hr>
<h2 id="implementation-notes">Implementation Notes</h2>
<h3 id="java-i2p-implementation">Java I2P Implementation</h3>
<p><strong>Repository:</strong> <a href="https://github.com/i2p/i2p.i2p">https://github.com/i2p/i2p.i2p</a>
</p>
<p><strong>Key Classes:</strong></p>
<ul>
<li><code>net.i2p.data.LeaseSet2</code> - LeaseSet2 structure</li>
<li><code>net.i2p.data.EncryptedLeaseSet</code> - Encrypted LS2 implementation</li>
<li><code>net.i2p.crypto.eddsa.EdDSAEngine</code> - Ed25519/Red25519 signatures</li>
<li><code>net.i2p.crypto.HKDF</code> - HKDF implementation</li>
<li><code>net.i2p.crypto.ChaCha20</code> - ChaCha20 cipher</li>
</ul>
<p><strong>Configuration:</strong></p>
<p>Enable encrypted LeaseSet in <code>clients.config</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-properties" data-lang="properties"><span style="display:flex;"><span><span style="color:#75715e"># Activer le LeaseSet (descripteur d&#39;accès à une destination I2P) chiffré</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">i2cp.encryptLeaseSet</span><span style="color:#f92672">=</span><span style="color:#e6db74">true</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Facultatif : activer l’autorisation des clients</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">i2cp.enableAccessList</span><span style="color:#f92672">=</span><span style="color:#e6db74">true</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Facultatif : utiliser l’autorisation DH (Diffie-Hellman) (par défaut : PSK, clé pré-partagée)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">i2cp.accessListType</span><span style="color:#f92672">=</span><span style="color:#e6db74">0</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Facultatif : Blinding secret (secret d’aveuglement, fortement recommandé)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">i2cp.blindingSecret</span><span style="color:#f92672">=</span><span style="color:#e6db74">votre-secret-ici</span>
</span></span></code></pre></div><p><strong>API Usage Example:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#75715e">// Créer un LeaseSet chiffré EncryptedLeaseSet els = new EncryptedLeaseSet();</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Définir la destination els.setDestination(destination);</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Activer l&#39;autorisation par client els.setAuthorizationEnabled(true); els.setAuthType(EncryptedLeaseSet.AUTH_DH);</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Ajouter des clients autorisés (clés publiques DH (Diffie-Hellman)) for (byte[] clientPubKey : authorizedClients) {</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    els.<span style="color:#a6e22e">addClient</span>(clientPubKey);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Définir les paramètres d&#39;aveuglement (blinding) els.setBlindingSecret(&#34;your-secret&#34;);</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Signer et publier els.sign(signingPrivateKey); netDb.publish(els);</span>
</span></span></code></pre></div><h3 id="i2pd-c-implementation">i2pd (C++) Implementation</h3>
<p><strong>Repository:</strong> <a href="https://github.com/PurpleI2P/i2pd">https://github.com/PurpleI2P/i2pd</a>
</p>
<p><strong>Key Files:</strong></p>
<ul>
<li><code>libi2pd/LeaseSet.h/cpp</code> - LeaseSet implementations</li>
<li><code>libi2pd/Crypto.h/cpp</code> - Cryptographic primitives</li>
<li><code>libi2pd/Ed25519.h/cpp</code> - Ed25519/Red25519 signatures</li>
<li><code>libi2pd/ChaCha20.h/cpp</code> - ChaCha20 cipher</li>
</ul>
<p><strong>Configuration:</strong></p>
<p>Enable in tunnel configuration (<code>tunnels.conf</code>):</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ini" data-lang="ini"><span style="display:flex;"><span><span style="color:#a6e22e">[my-hidden-service] type</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">http host = 127.0.0.1 port = 8080 keys = my-service-keys.dat</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Activer le LeaseSet chiffré</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">encryptleaseset</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">true</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Optionnel : Type d’autorisation client (0=DH, 1=PSK)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">authtype</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">0</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Optionnel: Secret d&#39;aveuglement</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">secret</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">your-secret-here</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Facultatif : Clients autorisés (une par ligne, clés publiques encodées en base64)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">client.1</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">base64-encoded-client-pubkey-1 client.2 = base64-encoded-client-pubkey-2</span>
</span></span></code></pre></div><p><strong>API Usage Example:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#75715e">// Créer un LeaseSet chiffré auto encryptedLS = std::make_shared&lt;i2p::data::EncryptedLeaseSet&gt;(
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>    destination,
</span></span><span style="display:flex;"><span>    blindingSecret
</span></span><span style="display:flex;"><span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Activer l&#39;autorisation par client encryptedLS-&gt;SetAuthType(i2p::data::AUTH_TYPE_DH);
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Ajouter les clients autorisés for (const auto&amp; clientPubKey : authorizedClients) {
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>    encryptedLS<span style="color:#f92672">-&gt;</span>AddClient(clientPubKey);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Signer et publier encryptedLS-&gt;Sign(signingPrivKey); netdb.Publish(encryptedLS);
</span></span></span></code></pre></div><h3 id="testing-and-debugging">Testing and Debugging</h3>
<p><strong>Test Vectors:</strong></p>
<p>Generate test vectors for implementation verification:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># Vecteur de test 1 : Aveuglement de clé</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>destination_pubkey <span style="color:#f92672">=</span> bytes<span style="color:#f92672">.</span>fromhex(<span style="color:#e6db74">&#39;a&#39;</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">64</span>) sigtype <span style="color:#f92672">=</span> <span style="color:#ae81ff">7</span> blinded_sigtype <span style="color:#f92672">=</span> <span style="color:#ae81ff">11</span> date <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;20251015&#34;</span> secret <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>alpha <span style="color:#f92672">=</span> generate_alpha(destination_pubkey, sigtype, blinded_sigtype, date, secret) print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Alpha: </span><span style="color:#e6db74">{</span>alpha<span style="color:#f92672">.</span>hex()<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Attendu: (vérifier par rapport à l&#39;implémentation de référence)</span>
</span></span></code></pre></div><p><strong>Unit Tests:</strong></p>
<p>Key areas to test:</p>
<ol>
<li>HKDF derivation with various inputs</li>
<li>ChaCha20 encryption/decryption</li>
<li>Red25519 signature generation and verification</li>
<li>Key blinding (private and public)</li>
<li>Layer 1/2 encryption/decryption</li>
<li>Client authorization (DH and PSK)</li>
<li>Base32 address generation and parsing</li>
</ol>
<p><strong>Integration Tests:</strong></p>
<ol>
<li>Publish encrypted LeaseSet to test network</li>
<li>Retrieve and decrypt from client</li>
<li>Verify daily key rotation</li>
<li>Test client authorization (add/remove clients)</li>
<li>Test offline keys (if supported)</li>
</ol>
<p><strong>Common Implementation Errors:</strong></p>
<ol>
<li><strong>Incorrect mod L reduction:</strong> Must use proper modular arithmetic</li>
<li><strong>Endianness errors:</strong> Most fields are big-endian, but some crypto uses little-endian</li>
<li><strong>Off-by-one in array slicing:</strong> Verify indices are inclusive/exclusive as needed</li>
<li><strong>Missing constant-time comparisons:</strong> Use constant-time for all sensitive comparisons</li>
<li><strong>Not zeroing key material:</strong> Always zero keys after use</li>
</ol>
<h3 id="performance-considerations">Performance Considerations</h3>
<p><strong>Computational Costs:</strong></p>
<table style="width:100%; border-collapse:collapse; margin-bottom:1.5rem;">
  <thead>
    <tr>
      <th style="border:1px solid var(--color-border); padding:0.5rem; background:var(--color-bg-secondary); text-align:left;">Operation</th>
      <th style="border:1px solid var(--color-border); padding:0.5rem; background:var(--color-bg-secondary); text-align:left;">Cost</th>
      <th style="border:1px solid var(--color-border); padding:0.5rem; background:var(--color-bg-secondary); text-align:left;">Notes</th>
    </tr>
  </thead>
  <tbody>
    <tr><td style="border:1px solid var(--color-border); padding:0.5rem;">Key blinding (server)</td><td style="border:1px solid var(--color-border); padding:0.5rem;">1 scalar mult</td><td style="border:1px solid var(--color-border); padding:0.5rem;">Per publication</td></tr>
    <tr><td style="border:1px solid var(--color-border); padding:0.5rem;">Key blinding (client)</td><td style="border:1px solid var(--color-border); padding:0.5rem;">1 point add + 1 scalar mult</td><td style="border:1px solid var(--color-border); padding:0.5rem;">Per retrieval</td></tr>
    <tr><td style="border:1px solid var(--color-border); padding:0.5rem;">Layer 1 encryption</td><td style="border:1px solid var(--color-border); padding:0.5rem;">1 HKDF + 1 ChaCha20</td><td style="border:1px solid var(--color-border); padding:0.5rem;">Fast</td></tr>
    <tr><td style="border:1px solid var(--color-border); padding:0.5rem;">Layer 2 encryption</td><td style="border:1px solid var(--color-border); padding:0.5rem;">1 HKDF + 1 ChaCha20</td><td style="border:1px solid var(--color-border); padding:0.5rem;">Fast</td></tr>
    <tr><td style="border:1px solid var(--color-border); padding:0.5rem;">DH client auth (server)</td><td style="border:1px solid var(--color-border); padding:0.5rem;">N+1 X25519 ops</td><td style="border:1px solid var(--color-border); padding:0.5rem;">N = number of clients</td></tr>
    <tr><td style="border:1px solid var(--color-border); padding:0.5rem;">DH client auth (client)</td><td style="border:1px solid var(--color-border); padding:0.5rem;">1 X25519 op</td><td style="border:1px solid var(--color-border); padding:0.5rem;">Per retrieval</td></tr>
    <tr><td style="border:1px solid var(--color-border); padding:0.5rem;">PSK client auth</td><td style="border:1px solid var(--color-border); padding:0.5rem;">0 DH ops</td><td style="border:1px solid var(--color-border); padding:0.5rem;">Only HKDF + ChaCha20</td></tr>
    <tr><td style="border:1px solid var(--color-border); padding:0.5rem;">Signature (Red25519)</td><td style="border:1px solid var(--color-border); padding:0.5rem;">1 signature op</td><td style="border:1px solid var(--color-border); padding:0.5rem;">Similar cost to Ed25519</td></tr>
  </tbody>
</table>
<p><strong>Size Overhead:</strong></p>
<table style="width:100%; border-collapse:collapse; margin-bottom:1.5rem;">
  <thead>
    <tr>
      <th style="border:1px solid var(--color-border); padding:0.5rem; background:var(--color-bg-secondary); text-align:left;">Component</th>
      <th style="border:1px solid var(--color-border); padding:0.5rem; background:var(--color-bg-secondary); text-align:left;">Size</th>
      <th style="border:1px solid var(--color-border); padding:0.5rem; background:var(--color-bg-secondary); text-align:left;">Frequency</th>
    </tr>
  </thead>
  <tbody>
    <tr><td style="border:1px solid var(--color-border); padding:0.5rem;">Blinded public key</td><td style="border:1px solid var(--color-border); padding:0.5rem;">32 bytes</td><td style="border:1px solid var(--color-border); padding:0.5rem;">Per LeaseSet</td></tr>
    <tr><td style="border:1px solid var(--color-border); padding:0.5rem;">Layer 1 encryption overhead</td><td style="border:1px solid var(--color-border); padding:0.5rem;">32 bytes (salt)</td><td style="border:1px solid var(--color-border); padding:0.5rem;">Per LeaseSet</td></tr>
    <tr><td style="border:1px solid var(--color-border); padding:0.5rem;">Layer 2 encryption overhead</td><td style="border:1px solid var(--color-border); padding:0.5rem;">32 bytes (salt)</td><td style="border:1px solid var(--color-border); padding:0.5rem;">Per LeaseSet</td></tr>
    <tr><td style="border:1px solid var(--color-border); padding:0.5rem;">DH auth per client</td><td style="border:1px solid var(--color-border); padding:0.5rem;">40 bytes</td><td style="border:1px solid var(--color-border); padding:0.5rem;">Per client per LeaseSet</td></tr>
    <tr><td style="border:1px solid var(--color-border); padding:0.5rem;">DH ephemeral pubkey</td><td style="border:1px solid var(--color-border); padding:0.5rem;">32 bytes</td><td style="border:1px solid var(--color-border); padding:0.5rem;">Per LeaseSet (if DH auth)</td></tr>
    <tr><td style="border:1px solid var(--color-border); padding:0.5rem;">PSK auth per client</td><td style="border:1px solid var(--color-border); padding:0.5rem;">40 bytes</td><td style="border:1px solid var(--color-border); padding:0.5rem;">Per client per LeaseSet</td></tr>
    <tr><td style="border:1px solid var(--color-border); padding:0.5rem;">PSK salt</td><td style="border:1px solid var(--color-border); padding:0.5rem;">32 bytes</td><td style="border:1px solid var(--color-border); padding:0.5rem;">Per LeaseSet (if PSK auth)</td></tr>
    <tr><td style="border:1px solid var(--color-border); padding:0.5rem;">Signature</td><td style="border:1px solid var(--color-border); padding:0.5rem;">64 bytes</td><td style="border:1px solid var(--color-border); padding:0.5rem;">Per LeaseSet</td></tr>
    <tr><td style="border:1px solid var(--color-border); padding:0.5rem;">Offline sig block</td><td style="border:1px solid var(--color-border); padding:0.5rem;">≈100 bytes</td><td style="border:1px solid var(--color-border); padding:0.5rem;">Per LeaseSet (if offline keys)</td></tr>
  </tbody>
</table>
<p><strong>Typical Sizes:</strong></p>
<ul>
<li><strong>No client auth:</strong> ~200 bytes overhead</li>
<li><strong>With 10 DH clients:</strong> ~600 bytes overhead</li>
<li><strong>With 100 DH clients:</strong> ~4200 bytes overhead</li>
</ul>
<p><strong>Optimization Tips:</strong></p>
<ol>
<li><strong>Batch key generation:</strong> Generate blinded keys for multiple days in advance</li>
<li><strong>Cache subcredentials:</strong> Compute once per day, reuse for all publications</li>
<li><strong>Reuse ephemeral keys:</strong> Can reuse ephemeral DH key for short period (minutes)</li>
<li><strong>Parallel client encryption:</strong> Encrypt client cookies in parallel</li>
<li><strong>Fast path for no auth:</strong> Skip authorization layer entirely when disabled</li>
</ol>
<h3 id="compatibility">Compatibility</h3>
<p><strong>Backward Compatibility:</strong></p>
<ul>
<li>Ed25519 (type 7) destinations supported for unblinded keys</li>
<li>Red25519 (type 11) required for blinded keys</li>
<li>Traditional LeaseSets still fully supported</li>
<li>Encrypted LeaseSets do not break existing network</li>
</ul>
<p><strong>Forward Compatibility:</strong></p>
<ul>
<li>Reserved flag bits for future features</li>
<li>Extensible authorization scheme (3 bits allow 8 types)</li>
<li>Version field in various structures</li>
</ul>
<p><strong>Interoperability:</strong></p>
<ul>
<li>Java I2P and i2pd fully interoperable since:
<ul>
<li>Java I2P 0.9.40 (May 2019)</li>
<li>i2pd 2.58.0 (September 2025)</li>
</ul>
</li>
<li>Encrypted LeaseSets work across implementations</li>
<li>Client authorization works across implementations</li>
</ul>
<hr>
<h2 id="references">References</h2>
<h3 id="ietf-rfcs">IETF RFCs</h3>
<ul>
<li><strong><a href="https://datatracker.ietf.org/doc/html/rfc2104">RFC 2104</a>
</strong> - HMAC: Keyed-Hashing for Message Authentication (February 1997)</li>
<li><strong><a href="https://datatracker.ietf.org/doc/html/rfc5869">RFC 5869</a>
</strong> - HMAC-based Extract-and-Expand Key Derivation Function (HKDF) (May 2010)</li>
<li><strong><a href="https://datatracker.ietf.org/doc/html/rfc7539">RFC 7539</a>
</strong> - ChaCha20 and Poly1305 for IETF Protocols (May 2015)</li>
<li><strong><a href="https://datatracker.ietf.org/doc/html/rfc7748">RFC 7748</a>
</strong> - Elliptic Curves for Security (January 2016)</li>
</ul>
<h3 id="i2p-specifications">I2P Specifications</h3>
<ul>
<li><strong><a href="../../../../fr/docs/specs/common-structures/">Common Structures Specification</a>
</strong> - LeaseSet2 and EncryptedLeaseSet structures</li>
<li><strong><a href="../../../../fr/proposals/123-new-netdb-entries/">Proposal 123: New netDB Entries</a>
</strong> - Background and design of LeaseSet2</li>
<li><strong><a href="../../../../fr/proposals/146-red25519/">Proposal 146: Red25519</a>
</strong> - Red25519 signature scheme specification</li>
<li><strong><a href="../../../../fr/proposals/149-b32-encrypted-ls2/">Proposal 149: B32 for Encrypted LS2</a>
</strong> - Base32 addressing for encrypted LeaseSets</li>
<li><strong><a href="../../../../fr/docs/specs/red25519-signature-scheme/">Red25519 Specification</a>
</strong> - Detailed Red25519 implementation</li>
<li><strong><a href="../../../../fr/docs/specs/b32-for-encrypted-leasesets/">B32 Addressing Specification</a>
</strong> - Base32 address format</li>
<li><strong><a href="../../../../fr/docs/specs/common-structures/">Network Database Documentation</a>
</strong> - NetDB usage and operations</li>
<li><strong><a href="../../../../fr/docs/specs/i2cp/">I2CP Specification</a>
</strong> - I2P Client Protocol</li>
</ul>
<h3 id="cryptographic-references">Cryptographic References</h3>
<ul>
<li><strong><a href="http://cr.yp.to/papers.html#ed25519">Ed25519 Paper</a>
</strong> - &ldquo;High-speed high-security signatures&rdquo; by Bernstein et al.</li>
<li><strong><a href="https://zips.z.cash/protocol/protocol.pdf">ZCash Protocol Specification</a>
</strong> - Section 5.4.6: RedDSA signature scheme</li>
<li><strong><a href="https://spec.torproject.org/rend-spec">Tor Rendezvous Specification v3</a>
</strong> - Tor&rsquo;s onion service specification (for comparison)</li>
</ul>
<h3 id="security-references">Security References</h3>
<ul>
<li><strong><a href="https://lists.torproject.org/pipermail/tor-dev/2013-December/005943.html">Key Blinding Security Discussion</a>
</strong> - Tor Project mailing list discussion</li>
<li><strong><a href="https://trac.torproject.org/projects/tor/ticket/8106">Tor Ticket #8106</a>
</strong> - Key blinding implementation discussion</li>
<li><strong><a href="http://projectbullrun.org/dual-ec/ext-rand.html">PRNG Security</a>
</strong> - Random number generator security considerations</li>
<li><strong><a href="https://lists.torproject.org/pipermail/tor-dev/2015-November/009954.html">Tor PRNG Discussion</a>
</strong> - Discussion of PRNG usage in Tor</li>
</ul>
<h3 id="implementation-references">Implementation References</h3>
<ul>
<li><strong><a href="https://github.com/i2p/i2p.i2p">Java I2P Repository</a>
</strong> - Official Java implementation</li>
<li><strong><a href="https://github.com/PurpleI2P/i2pd">i2pd Repository</a>
</strong> - C++ implementation</li>
<li><strong><a href="../../../../fr/">I2P Website</a>
</strong> - Official I2P project website</li>
<li><strong><a href="../../../../fr/docs/specs/">I2P Specifications</a>
</strong> - Complete specification index</li>
</ul>
<h3 id="version-history">Version History</h3>
<ul>
<li><strong><a href="../../../../en/blog">I2P Release Notes</a>
</strong> - Official release announcements</li>
<li><strong><a href="https://github.com/i2p/i2p.i2p/releases">Java I2P Releases</a>
</strong> - GitHub release history</li>
<li><strong><a href="https://github.com/PurpleI2P/i2pd/releases">i2pd Releases</a>
</strong> - GitHub release history</li>
</ul>
<hr>
<h2 id="appendix-a-cryptographic-constants">Appendix A: Cryptographic Constants</h2>
<h3 id="ed25519--red25519-constants">Ed25519 / Red25519 Constants</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># Point de base Ed25519 (générateur)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>B <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span><span style="color:#f92672">**</span><span style="color:#ae81ff">255</span> <span style="color:#f92672">-</span> <span style="color:#ae81ff">19</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Ordre d&#39;Ed25519 (taille du corps scalaire)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>L <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span><span style="color:#f92672">**</span><span style="color:#ae81ff">252</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">27742317777372353535851937790883648493</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Valeurs des types de signature</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>SIGTYPE_ED25519 <span style="color:#f92672">=</span> <span style="color:#ae81ff">7</span>    <span style="color:#75715e"># 0x0007 SIGTYPE_RED25519 = 11  # 0x000b</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Tailles de clés</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>PRIVKEY_SIZE <span style="color:#f92672">=</span> <span style="color:#ae81ff">32</span>  <span style="color:#75715e"># bytes PUBKEY_SIZE = 32   # bytes SIGNATURE_SIZE = 64  # bytes</span>
</span></span></code></pre></div><h3 id="chacha20-constants">ChaCha20 Constants</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># Paramètres de ChaCha20</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>CHACHA20_KEY_SIZE <span style="color:#f92672">=</span> <span style="color:#ae81ff">32</span>   <span style="color:#75715e"># octets (256 bits) CHACHA20_NONCE_SIZE = 12  # octets (96 bits) CHACHA20_INITIAL_COUNTER = 1  # RFC 7539 autorise 0 ou 1</span>
</span></span></code></pre></div><h3 id="hkdf-constants">HKDF Constants</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># Paramètres de HKDF (fonction de dérivation de clés basée sur HMAC)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>HKDF_HASH <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;SHA-256&#34;</span> HKDF_SALT_MAX <span style="color:#f92672">=</span> <span style="color:#ae81ff">32</span>  <span style="color:#75715e"># bytes (HashLen)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Chaînes d&#39;info HKDF (séparation des domaines)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>HKDF_INFO_ALPHA <span style="color:#f92672">=</span> <span style="color:#e6db74">b</span><span style="color:#e6db74">&#34;i2pblinding1&#34;</span> HKDF_INFO_LAYER1 <span style="color:#f92672">=</span> <span style="color:#e6db74">b</span><span style="color:#e6db74">&#34;ELS2_L1K&#34;</span> HKDF_INFO_LAYER2 <span style="color:#f92672">=</span> <span style="color:#e6db74">b</span><span style="color:#e6db74">&#34;ELS2_L2K&#34;</span> HKDF_INFO_DH_AUTH <span style="color:#f92672">=</span> <span style="color:#e6db74">b</span><span style="color:#e6db74">&#34;ELS2_XCA&#34;</span> HKDF_INFO_PSK_AUTH <span style="color:#f92672">=</span> <span style="color:#e6db74">b</span><span style="color:#e6db74">&#34;ELS2PSKA&#34;</span>
</span></span></code></pre></div><h3 id="hash-personalization-strings">Hash Personalization Strings</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># Chaînes de personnalisation pour SHA-256</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>HASH_PERS_ALPHA <span style="color:#f92672">=</span> <span style="color:#e6db74">b</span><span style="color:#e6db74">&#34;I2PGenerateAlpha&#34;</span> HASH_PERS_RED25519 <span style="color:#f92672">=</span> <span style="color:#e6db74">b</span><span style="color:#e6db74">&#34;I2P_Red25519H(x)&#34;</span> HASH_PERS_CREDENTIAL <span style="color:#f92672">=</span> <span style="color:#e6db74">b</span><span style="color:#e6db74">&#34;credential&#34;</span> HASH_PERS_SUBCREDENTIAL <span style="color:#f92672">=</span> <span style="color:#e6db74">b</span><span style="color:#e6db74">&#34;subcredential&#34;</span>
</span></span></code></pre></div><h3 id="structure-sizes">Structure Sizes</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># Tailles de la couche 0 (externe)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>BLINDED_SIGTYPE_SIZE <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>   <span style="color:#75715e"># octets BLINDED_PUBKEY_SIZE = 32   # octets (pour Red25519) PUBLISHED_TS_SIZE = 4      # octets EXPIRES_SIZE = 2           # octets FLAGS_SIZE = 2             # octets LEN_OUTER_CIPHER_SIZE = 2  # octets SIGNATURE_SIZE = 64        # octets (Red25519)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Tailles des blocs de clés hors ligne</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>OFFLINE_EXPIRES_SIZE <span style="color:#f92672">=</span> <span style="color:#ae81ff">4</span>   <span style="color:#75715e"># octets OFFLINE_SIGTYPE_SIZE = 2   # octets OFFLINE_SIGNATURE_SIZE = 64  # octets</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Tailles de la couche 1 (intermédiaire)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>AUTH_FLAGS_SIZE <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>        <span style="color:#75715e"># octet EPHEMERAL_PUBKEY_SIZE = 32  # octets (authentification DH) AUTH_SALT_SIZE = 32        # octets (authentification PSK) NUM_CLIENTS_SIZE = 2       # octets CLIENT_ID_SIZE = 8         # octets CLIENT_COOKIE_SIZE = 32    # octets AUTH_CLIENT_ENTRY_SIZE = 40  # octets (CLIENT_ID + CLIENT_COOKIE)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Surcoût du chiffrement</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>SALT_SIZE <span style="color:#f92672">=</span> <span style="color:#ae81ff">32</span>  <span style="color:#75715e"># octets (ajoutés en tête de chaque couche chiffrée)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Adresse Base32</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>B32_ENCRYPTED_DECODED_SIZE <span style="color:#f92672">=</span> <span style="color:#ae81ff">35</span>  <span style="color:#75715e"># octets B32_ENCRYPTED_ENCODED_LEN = 56   # caractères B32_SUFFIX = &#34;.b32.i2p&#34;</span>
</span></span></code></pre></div><hr>
<h2 id="appendix-b-test-vectors">Appendix B: Test Vectors</h2>
<h3 id="test-vector-1-alpha-generation">Test Vector 1: Alpha Generation</h3>
<p><strong>Input:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># Clé publique de destination (Ed25519)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>A <span style="color:#f92672">=</span> bytes<span style="color:#f92672">.</span>fromhex(<span style="color:#e6db74">&#39;aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa&#39;</span>) stA <span style="color:#f92672">=</span> <span style="color:#ae81ff">0x0007</span>  <span style="color:#75715e"># Ed25519 stA_prime = 0x000b  # Red25519 date = &#34;20251015&#34; secret = &#34;&#34;  # Secret vide</span>
</span></span></code></pre></div><p><strong>Computation:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>keydata <span style="color:#f92672">=</span> A <span style="color:#f92672">||</span> bytes([<span style="color:#ae81ff">0x00</span>, <span style="color:#ae81ff">0x07</span>]) <span style="color:#f92672">||</span> bytes([<span style="color:#ae81ff">0x00</span>, <span style="color:#ae81ff">0x0b</span>])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># keydata = 36 octets</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>salt <span style="color:#f92672">=</span> SHA256(<span style="color:#e6db74">b</span><span style="color:#e6db74">&#34;I2PGenerateAlpha&#34;</span> <span style="color:#f92672">+</span> keydata) ikm <span style="color:#f92672">=</span> <span style="color:#e6db74">b</span><span style="color:#e6db74">&#34;20251015&#34;</span> info <span style="color:#f92672">=</span> <span style="color:#e6db74">b</span><span style="color:#e6db74">&#34;i2pblinding1&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>seed <span style="color:#f92672">=</span> HKDF(salt, ikm, info, <span style="color:#ae81ff">64</span>) alpha <span style="color:#f92672">=</span> LEOS2IP(seed) mod L
</span></span></code></pre></div><p><strong>Expected Output:</strong></p>
<pre tabindex="0"><code>(Vérifier par rapport à l’implémentation de référence) alpha = [valeur hexadécimale de 64 octets]
</code></pre><h3 id="test-vector-2-chacha20-encryption">Test Vector 2: ChaCha20 Encryption</h3>
<p><strong>Input:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>key <span style="color:#f92672">=</span> bytes([i <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">32</span>)])  <span style="color:#75715e"># 0x00..0x1f nonce = bytes([i for i in range(12)])  # 0x00..0x0b plaintext = b&#34;Hello, I2P!&#34;</span>
</span></span></code></pre></div><p><strong>Computation:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>ciphertext <span style="color:#f92672">=</span> ChaCha20_Encrypt(key, nonce, plaintext, counter<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>)
</span></span></code></pre></div><p><strong>Expected Output:</strong></p>
<pre tabindex="0"><code>ciphertext = [vérifier par rapport aux vecteurs de test de la RFC 7539]
</code></pre><h3 id="test-vector-3-hkdf">Test Vector 3: HKDF</h3>
<p><strong>Input:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>salt <span style="color:#f92672">=</span> bytes(<span style="color:#ae81ff">32</span>)  <span style="color:#75715e"># Tous à zéro ikm = b&#34;test input keying material&#34; info = b&#34;ELS2_L1K&#34; n = 44</span>
</span></span></code></pre></div><p><strong>Computation:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>keys <span style="color:#f92672">=</span> HKDF(salt, ikm, info, n)
</span></span></code></pre></div><p><strong>Expected Output:</strong></p>
<pre tabindex="0"><code>keys = [valeur hexadécimale de 44 octets]
</code></pre><h3 id="test-vector-4-base32-address">Test Vector 4: Base32 Address</h3>
<p><strong>Input:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>pubkey <span style="color:#f92672">=</span> bytes<span style="color:#f92672">.</span>fromhex(<span style="color:#e6db74">&#39;bbbb&#39;</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;bb&#39;</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">30</span>)  <span style="color:#75715e"># 32 octets unblinded_sigtype = 11  # Red25519 blinded_sigtype = 11    # Red25519</span>
</span></span></code></pre></div><p><strong>Computation:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>address <span style="color:#f92672">=</span> generate_encrypted_b32_address(pubkey, unblinded_sigtype, blinded_sigtype)
</span></span></code></pre></div><p><strong>Expected Output:</strong></p>
<pre tabindex="0"><code>address = [56 caractères en base32].b32.i2p

# Vérifiez que la somme de contrôle est valide
</code></pre><hr>
<h2 id="appendix-c-glossary">Appendix C: Glossary</h2>
<p><strong>Alpha (α):</strong> The secret blinding factor used to blind public and private keys. Generated from the destination, date, and optional secret.</p>
<p><strong>AuthCookie:</strong> A 32-byte random value encrypted for each authorized client, used as input to Layer 2 encryption.</p>
<p><strong>B (Base Point):</strong> The generator point for the Ed25519 elliptic curve.</p>
<p><strong>Blinded Key:</strong> A public or private key that has been transformed using the alpha blinding factor. Blinded keys cannot be linked to the original keys without knowing alpha.</p>
<p><strong>ChaCha20:</strong> A stream cipher providing fast, secure encryption without requiring AES hardware support.</p>
<p><strong>ClientID:</strong> An 8-byte identifier derived from HKDF output, used to identify authorization entries for clients.</p>
<p><strong>ClientCookie:</strong> A 32-byte encrypted value containing the authCookie for a specific client.</p>
<p><strong>Credential:</strong> A 32-byte value derived from the destination&rsquo;s public key and signature types, binding encryption to knowledge of the destination.</p>
<p><strong>CSRNG:</strong> Cryptographically Secure Random Number Generator. Must provide unpredictable output suitable for key generation.</p>
<p><strong>DH (Diffie-Hellman):</strong> A cryptographic protocol for securely establishing shared secrets. I2P uses X25519.</p>
<p><strong>Ed25519:</strong> An elliptic curve signature scheme providing fast signatures with 128-bit security level.</p>
<p><strong>Ephemeral Key:</strong> A short-lived cryptographic key, typically used once and then discarded.</p>
<p><strong>Floodfill:</strong> I2P routers that store and serve network database entries, including encrypted LeaseSets.</p>
<p><strong>HKDF:</strong> HMAC-based Key Derivation Function, used to derive multiple cryptographic keys from a single source.</p>
<p><strong>L (Order):</strong> The order of the Ed25519 scalar field (approximately 2^252).</p>
<p><strong>Layer 0 (Outer):</strong> The plaintext portion of an encrypted LeaseSet, containing blinded key and metadata.</p>
<p><strong>Layer 1 (Middle):</strong> The first encrypted layer, containing client authorization data.</p>
<p><strong>Layer 2 (Inner):</strong> The innermost encrypted layer, containing the actual LeaseSet2 data.</p>
<p><strong>LeaseSet2 (LS2):</strong> Second version of I2P&rsquo;s network database entry format, introducing encrypted variants.</p>
<p><strong>NetDB:</strong> The I2P network database, a distributed hash table storing router and destination information.</p>
<p><strong>Offline Keys:</strong> A feature allowing the main signing key to remain in cold storage while a transient key handles daily operations.</p>
<p><strong>PSK (Pre-Shared Key):</strong> A symmetric key shared in advance between two parties, used for PSK client authorization.</p>
<p><strong>Red25519:</strong> An Ed25519-based signature scheme with key blinding support, based on ZCash RedDSA.</p>
<p><strong>Salt:</strong> Random data used as input to key derivation functions to ensure unique outputs.</p>
<p><strong>SigType:</strong> A numeric identifier for signature algorithms (e.g., 7 = Ed25519, 11 = Red25519).</p>
<p><strong>Subcredential:</strong> A 32-byte value derived from the credential and blinded public key, binding encryption to a specific encrypted LeaseSet.</p>
<p><strong>Transient Key:</strong> A temporary signing key used with offline keys, with a limited validity period.</p>
<p><strong>X25519:</strong> An elliptic curve Diffie-Hellman protocol over Curve25519, providing key agreement.</p>
<hr>
<h2 id="document-information">Document Information</h2>
<p><strong>Status:</strong> This document represents the current stable encrypted LeaseSet specification as implemented in I2P since June 2019. The protocol is mature and widely deployed.</p>
<p><strong>Contributing:</strong> For corrections or improvements to this documentation, please submit issues or pull requests to the I2P specifications repository.</p>
<p><strong>Support:</strong> For questions about implementing encrypted LeaseSets:</p>
<ul>
<li>I2P Forum: <a href="https://i2pforum.net/">https://i2pforum.net/</a>
</li>
<li>IRC: #i2p-dev on OFTC</li>
<li>Matrix: #i2p-dev:matrix.org</li>
</ul>
<p><strong>Acknowledgments:</strong> This specification builds on work by the I2P development team, ZCash cryptography research, and Tor Project&rsquo;s key blinding research.</p>

                </article>

                
                <nav class="page-nav">
                    
                        <a href="../../../../fr/docs/specs/i2cp/" class="page-nav-link prev">
                            <span class="nav-label">← Previous</span>
                            <span class="nav-title">Protocole client I2P (I2CP)</span>
                        </a>
                    
                    
                        <a href="../../../../fr/docs/specs/implementation/" class="page-nav-link next">
                            <span class="nav-label">Next →</span>
                            <span class="nav-title">Guide d’exploitation des tunnels</span>
                        </a>
                    
                </nav>

                
                <div class="docs-feedback">
                    <p>Was this page helpful?</p>
                    <div class="feedback-buttons" id="feedback-buttons">
                        <button class="feedback-btn" id="feedback-yes">👍 Yes</button>
                        <button class="feedback-btn" id="feedback-no">👎 No</button>
                    </div>

                    
                    <div class="feedback-form-container" id="feedback-form-container" style="display: none;">
                        <p class="feedback-form-title">We're sorry to hear that. How can we improve this page?</p>
                        <form id="feedback-form">
                            <div class="form-group">
                                <label for="feedback-email">Email (optional - if you'd like a response)</label>
                                <input type="email" id="feedback-email" name="email" placeholder="your@email.com">
                            </div>
                            <div class="form-group">
                                <label for="feedback-message">Feedback *</label>
                                <textarea id="feedback-message" name="message" rows="4" required placeholder="Tell us what we can improve..."></textarea>
                            </div>
                            <button type="submit" class="btn-submit-feedback" id="feedback-submit-btn">
                                <span class="btn-text">Submit Feedback</span>
                                <span class="btn-loading" style="display: none;">Sending...</span>
                            </button>
                        </form>
                    </div>

                    
                    <div class="feedback-message" id="feedback-success" style="display: none;">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                            <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" stroke-width="2"/>
                        </svg>
                        <span id="feedback-success-text">Thanks for your feedback!</span>
                    </div>
                    <div class="feedback-message feedback-error" id="feedback-error" style="display: none;">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                            <circle cx="12" cy="12" r="10" stroke-width="2"/>
                            <path d="M12 8v4M12 16h.01" stroke-width="2" stroke-linecap="round"/>
                        </svg>
                        <span id="feedback-error-text">Something went wrong. Please try again.</span>
                    </div>

                    <p class="feedback-note">
                        Found an issue? <a href="https://gitlab.com/stormycloud-group/i-2-p-www-v-2/-/blob/main/hugo-site/content/fr/docs/specs/encryptedleaseset.md?ref_type=heads" target="_blank">Edit this page on GitLab</a>
                    </p>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
.docs-page {
    min-height: 100vh;
    padding: var(--spacing-xl) 0;
}

.breadcrumbs {
    display: flex;
    align-items: center;
    gap: var(--spacing-xs);
    margin-bottom: var(--spacing-lg);
    font-size: 0.875rem;
    color: var(--color-text-muted);
}

.breadcrumbs a {
    color: var(--color-text-muted);
    text-decoration: none;
    transition: color var(--transition-fast);
}

.breadcrumbs a:hover {
    color: var(--color-primary);
}

.separator {
    color: var(--color-border);
}

.current {
    color: var(--color-text);
}

 
.translation-disclaimer {
    background: #fef3c7;
    border: 1px solid #f59e0b;
    border-radius: var(--radius-md);
    padding: var(--spacing-md);
    margin-bottom: var(--spacing-lg);
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: var(--spacing-md);
    flex-wrap: wrap;
}

.dark .translation-disclaimer {
    background: #78350f;
    border-color: #d97706;
}

.disclaimer-message {
    color: #92400e;
    font-size: 0.875rem;
}

.dark .disclaimer-message {
    color: #fde047;
}

.disclaimer-link {
    color: #92400e;
    font-weight: 600;
    text-decoration: underline;
    white-space: nowrap;
}

.dark .disclaimer-link {
    color: #fde047;
}

 
.article-header {
    margin-bottom: var(--spacing-2xl);
}

.article-title {
    font-size: 2.5rem;
    margin: 0 0 var(--spacing-md) 0;
    color: var(--color-text);
}

.article-description {
    font-size: 1.125rem;
    color: var(--color-text-secondary);
    margin-bottom: var(--spacing-md);
}

.article-meta {
    display: flex;
    gap: var(--spacing-lg);
    flex-wrap: wrap;
}

.meta-item {
    display: flex;
    align-items: center;
    gap: var(--spacing-xs);
    font-size: 0.875rem;
    color: var(--color-text-muted);
}

.meta-item svg {
    color: var(--color-primary);
}

 
.docs-layout {
    display: block;
}

.docs-layout--with-toc {
    display: grid;
    grid-template-columns: 260px 1fr;
    gap: var(--spacing-2xl);
    align-items: start;
}

 
.docs-toc-sidebar {
    position: sticky;
    top: 100px;
    max-height: calc(100vh - 120px);
    overflow-y: auto;
}

.toc-nav {
    background: var(--color-bg-secondary);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-lg);
    padding: var(--spacing-md);
}

.toc-header {
    display: flex;
    align-items: center;
    gap: var(--spacing-sm);
    font-weight: 700;
    font-size: 0.875rem;
    color: var(--color-text);
    padding-bottom: var(--spacing-md);
    margin-bottom: var(--spacing-md);
    border-bottom: 1px solid var(--color-border);
}

.toc-content {
    max-height: calc(100vh - 250px);
    overflow-y: auto;
}

.toc-content::-webkit-scrollbar {
    width: 4px;
}

.toc-content::-webkit-scrollbar-track {
    background: transparent;
}

.toc-content::-webkit-scrollbar-thumb {
    background: var(--color-border);
    border-radius: 2px;
}

.toc-content::-webkit-scrollbar-thumb:hover {
    background: var(--color-text-muted);
}

.toc-nav ul {
    list-style: none;
    padding-left: 0;
    margin: 0;
}

.toc-nav li {
    margin-bottom: 0.25rem;
}

.toc-nav ul ul {
    padding-left: var(--spacing-md);
    margin-top: 0.25rem;
}

.toc-nav a {
    color: var(--color-text-secondary);
    text-decoration: none;
    font-size: 0.8125rem;
    display: block;
    padding: 0.25rem 0.5rem;
    border-radius: var(--radius-sm);
    transition: all var(--transition-fast);
    line-height: 1.4;
}

.toc-nav a:hover {
    color: var(--color-primary);
    background: var(--color-bg-tertiary);
}

 
.docs-main {
    min-width: 0;
    max-width: 900px;
}

 
.article-content {
    line-height: 1.8;
    color: var(--color-text);
}

.article-content h2 {
    margin-top: var(--spacing-2xl);
    margin-bottom: var(--spacing-md);
    font-size: 1.75rem;
    scroll-margin-top: 100px;
}

.article-content h3 {
    margin-top: var(--spacing-xl);
    margin-bottom: var(--spacing-sm);
    font-size: 1.375rem;
    scroll-margin-top: 100px;
}

.article-content h4 {
    margin-top: var(--spacing-lg);
    margin-bottom: var(--spacing-xs);
    font-size: 1.125rem;
    scroll-margin-top: 100px;
}

.article-content p {
    margin-bottom: var(--spacing-md);
}

.article-content ul,
.article-content ol {
    margin-bottom: var(--spacing-md);
    padding-left: var(--spacing-xl);
}

.article-content li {
    margin-bottom: var(--spacing-xs);
}

.article-content code {
    background: var(--color-bg-secondary);
    padding: 0.125rem 0.375rem;
    border-radius: var(--radius-sm);
    font-size: 0.875em;
    font-family: 'Courier New', monospace;
}

.article-content pre {
    background: var(--color-bg-secondary);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-md);
    padding: var(--spacing-md);
    overflow-x: auto;
    margin-bottom: var(--spacing-md);
}

.article-content pre code {
    background: none;
    padding: 0;
}

.article-content img {
    max-width: 100%;
    height: auto;
    border-radius: var(--radius-md);
    border: 1px solid var(--color-border);
    margin: var(--spacing-lg) 0;
    display: block;
}

.article-content a {
    color: var(--color-primary);
    text-decoration: none;
    border-bottom: 1px solid transparent;
    transition: border-color var(--transition-fast);
}

.article-content a:hover {
    border-bottom-color: var(--color-primary);
}

 
.page-nav {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: var(--spacing-md);
    margin-top: var(--spacing-2xl);
    padding-top: var(--spacing-xl);
    border-top: 1px solid var(--color-border);
}

.page-nav-link {
    display: flex;
    flex-direction: column;
    padding: var(--spacing-md);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-md);
    text-decoration: none;
    transition: all var(--transition-fast);
}

.page-nav-link:hover {
    border-color: var(--color-primary);
    box-shadow: var(--shadow-md);
}

.page-nav-link.next {
    text-align: right;
}

.nav-label {
    font-size: 0.875rem;
    color: var(--color-text-muted);
    margin-bottom: var(--spacing-xs);
}

.nav-title {
    font-weight: 600;
    color: var(--color-text);
}

 
.docs-feedback {
    margin-top: var(--spacing-2xl);
    padding: var(--spacing-lg);
    background: var(--color-bg-secondary);
    border-radius: var(--radius-md);
    text-align: center;
}

.feedback-buttons {
    display: flex;
    gap: var(--spacing-md);
    justify-content: center;
    margin: var(--spacing-md) 0;
}

.feedback-btn {
    padding: var(--spacing-sm) var(--spacing-lg);
    background: var(--color-bg);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-md);
    cursor: pointer;
    transition: all var(--transition-fast);
}

.feedback-btn:hover {
    border-color: var(--color-primary);
    background: var(--color-primary);
    color: white;
}

.feedback-note {
    font-size: 0.875rem;
    color: var(--color-text-muted);
    margin-top: var(--spacing-md);
}

.feedback-note a {
    color: var(--color-primary);
    text-decoration: none;
}

.feedback-note a:hover {
    text-decoration: underline;
}

 
.feedback-form-container {
    margin-top: var(--spacing-lg);
    padding: var(--spacing-lg);
    background: var(--color-bg);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-md);
    text-align: left;
}

.feedback-form-title {
    font-weight: 600;
    margin-bottom: var(--spacing-md);
    color: var(--color-text);
}

.form-group {
    margin-bottom: var(--spacing-md);
}

.form-group label {
    display: block;
    font-size: 0.875rem;
    font-weight: 600;
    margin-bottom: var(--spacing-xs);
    color: var(--color-text);
}

.form-group input[type="email"],
.form-group textarea {
    width: 100%;
    padding: var(--spacing-sm);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-md);
    background: var(--color-bg);
    color: var(--color-text);
    font-family: inherit;
    font-size: 0.9375rem;
    transition: border-color var(--transition-fast);
}

.form-group input[type="email"]:focus,
.form-group textarea:focus {
    outline: none;
    border-color: var(--color-primary);
}

.form-group textarea {
    resize: vertical;
    min-height: 100px;
}

.btn-submit-feedback {
    padding: var(--spacing-sm) var(--spacing-lg);
    background: var(--color-primary);
    color: white;
    border: none;
    border-radius: var(--radius-md);
    font-weight: 600;
    cursor: pointer;
    transition: all var(--transition-fast);
}

.btn-submit-feedback:hover:not(:disabled) {
    background: var(--color-primary-dark);
    transform: translateY(-1px);
}

.btn-submit-feedback:disabled {
    opacity: 0.6;
    cursor: not-allowed;
}

 
.feedback-message {
    display: flex;
    align-items: center;
    gap: var(--spacing-sm);
    padding: var(--spacing-md);
    background: #d1fae5;
    color: #065f46;
    border-radius: var(--radius-md);
    margin-top: var(--spacing-md);
}

.feedback-message.feedback-error {
    background: #fee2e2;
    color: #991b1b;
}

.feedback-message svg {
    flex-shrink: 0;
}

 
@media (max-width: 1024px) {
    .docs-layout--with-toc {
        grid-template-columns: 1fr;
    }

    .docs-toc-sidebar {
        position: static;
        max-height: none;
        margin-bottom: var(--spacing-xl);
    }

    .toc-content {
        max-height: 300px;
    }
}

@media (max-width: 768px) {
    .article-title {
        font-size: 1.75rem;
    }
}
</style>



<script>
document.addEventListener('DOMContentLoaded', function() {
    const tocLinks = document.querySelectorAll('.toc-nav a');
    const headings = [];

    tocLinks.forEach(link => {
        const href = link.getAttribute('href');
        if (href && href.startsWith('#')) {
            const heading = document.getElementById(href.slice(1));
            if (heading) {
                headings.push({ element: heading, link: link });
            }
        }
    });

    function updateActiveLink() {
        const scrollPos = window.scrollY + 120;
        let activeIndex = 0;

        for (let i = 0; i < headings.length; i++) {
            if (headings[i].element.offsetTop <= scrollPos) {
                activeIndex = i;
            }
        }

        tocLinks.forEach(link => link.classList.remove('active'));
        if (headings[activeIndex]) {
            headings[activeIndex].link.classList.add('active');
        }
    }

    window.addEventListener('scroll', updateActiveLink);
    updateActiveLink();
});
</script>
<style>
.toc-nav a.active {
    color: var(--color-primary);
    background: var(--color-bg-tertiary);
    font-weight: 600;
}
</style>



<script>
(function() {
    'use strict';
    
    
    let baseUrl = window.feedbackBaseUrl;
    if (!baseUrl) {
        const hostname = window.location.hostname;
        
        if (hostname.endsWith('.b32.i2p') || hostname.endsWith('.i2p')) {
            baseUrl = 'http://5kwyynf3eetgqa2nors6ctwo7doi7yu73k7uvypy5eqmm326zkiq.b32.i2p';
        } else if (hostname.endsWith('.onion')) {
            baseUrl = 'http://gfonxmohvarpmocsvllscsuszdu5rikipm6innvcwq4vpng7zzqmmfyd.onion';
        } else {
            baseUrl = 'https://feedback.i2p.net';
        }
    }
    
    const script = document.createElement('script');
    script.src = baseUrl + '/widgets/docs-feedback.js';
    script.async = true;
    script.onerror = function() {
        console.error('[Docs Feedback] Failed to load docs-feedback.js from:', baseUrl);
    };
    document.body.appendChild(script);
})();
</script>


    </main>

    <footer class="site-footer">
    <div class="container">
        <div class="footer-grid">
            <div class="footer-col footer-brand">
                <img src="../../../../images/i2plogo_lightmode.svg" alt="I2P Logo" class="footer-logo logo-light" loading="lazy" decoding="async">
                <img src="../../../../images/i2plogo_darkmode.svg" alt="I2P Logo" class="footer-logo logo-dark" loading="lazy" decoding="async">
                <p class="footer-tagline">Privacy. Security. Freedom.</p>
                <p class="footer-description">The Invisible Internet Project - A privacy-focused, anonymous network layer</p>

                <div class="footer-social-newsletter">
                    <div class="social-links">
                        <a href="https://mastodon.social/@i2p" target="_blank" rel="noopener" aria-label="Mastodon">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M21.327 8.566c0-4.339-2.843-5.61-2.843-5.61-1.433-.658-3.894-.935-6.451-.956h-.063c-2.557.021-5.016.298-6.45.956 0 0-2.843 1.272-2.843 5.61 0 .993-.019 2.181.012 3.441.103 4.243.778 8.425 4.701 9.463 1.809.479 3.362.579 4.612.51 2.268-.126 3.541-.809 3.541-.809l-.075-1.646s-1.621.511-3.441.449c-1.804-.062-3.707-.194-3.999-2.409a4.523 4.523 0 0 1-.04-.621s1.77.433 4.014.536c1.372.063 2.658-.08 3.965-.236 2.506-.299 4.688-1.843 4.962-3.254.434-2.223.398-5.424.398-5.424zm-3.353 5.59h-2.081V9.057c0-1.075-.452-1.62-1.357-1.62-1 0-1.501.647-1.501 1.927v2.791h-2.069V9.364c0-1.28-.501-1.927-1.502-1.927-.905 0-1.357.546-1.357 1.62v5.099H6.026V8.903c0-1.074.273-1.927.823-2.558.566-.631 1.307-.955 2.228-.955 1.065 0 1.872.409 2.405 1.228l.518.869.519-.869c.533-.819 1.34-1.228 2.405-1.228.92 0 1.662.324 2.228.955.549.631.822 1.484.822 2.558v5.253z"/>
                            </svg>
                        </a>
                        <a href="https://twitter.com/GetI2P" target="_blank" rel="noopener" aria-label="Twitter">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/>
                            </svg>
                        </a>
                        <a href="https://old.reddit.com/r/i2p" target="_blank" rel="noopener" aria-label="Reddit">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M12 0A12 12 0 0 0 0 12a12 12 0 0 0 12 12 12 12 0 0 0 12-12A12 12 0 0 0 12 0zm5.01 4.744c.688 0 1.25.561 1.25 1.249a1.25 1.25 0 0 1-2.498.056l-2.597-.547-.8 3.747c1.824.07 3.48.632 4.674 1.488.308-.309.73-.491 1.207-.491.968 0 1.754.786 1.754 1.754 0 .716-.435 1.333-1.01 1.614a3.111 3.111 0 0 1 .042.52c0 2.694-3.13 4.87-7.004 4.87-3.874 0-7.004-2.176-7.004-4.87 0-.183.015-.366.043-.534A1.748 1.748 0 0 1 4.028 12c0-.968.786-1.754 1.754-1.754.463 0 .898.196 1.207.49 1.207-.883 2.878-1.43 4.744-1.487l.885-4.182a.342.342 0 0 1 .14-.197.35.35 0 0 1 .238-.042l2.906.617a1.214 1.214 0 0 1 1.108-.701zM9.25 12C8.561 12 8 12.562 8 13.25c0 .687.561 1.248 1.25 1.248.687 0 1.248-.561 1.248-1.249 0-.688-.561-1.249-1.249-1.249zm5.5 0c-.687 0-1.248.561-1.248 1.25 0 .687.561 1.248 1.249 1.248.688 0 1.249-.561 1.249-1.249 0-.687-.562-1.249-1.25-1.249zm-5.466 3.99a.327.327 0 0 0-.231.094.33.33 0 0 0 0 .463c.842.842 2.484.913 2.961.913.477 0 2.105-.056 2.961-.913a.361.361 0 0 0 .029-.463.33.33 0 0 0-.464 0c-.547.533-1.684.73-2.512.73-.828 0-1.979-.196-2.512-.73a.326.326 0 0 0-.232-.095z"/>
                            </svg>
                        </a>
                        <a href="https://signal.group/#CjQKIOSUTtxlhbumAKcRsthPFkxkTUrkWcX39bbN6njLEgAIEhCTNsR0KDuiehAXZnkt42v5" target="_blank" rel="noopener" aria-label="Signal" class="signal-link">
                            <img src="../../../../images/Signal-Logo-Black.svg" alt="Signal" class="signal-logo signal-logo-light" loading="lazy" decoding="async">
                            <img src="../../../../images/Signal-Logo-White.svg" alt="Signal" class="signal-logo signal-logo-dark" loading="lazy" decoding="async">
                        </a>
                    </div>

                    
                    <div class="footer-newsletter-inline">
                        <p class="newsletter-description">Restez informé des actualités I2P :</p>
                        <form action="https://feedback.i2p.net/api/mailing-list/subscribe" method="POST" class="newsletter-form">
                            <input type="email" name="email" placeholder="Entrez votre email" required>
                            <button type="submit">S&#39;abonner</button>
                        </form>
                    </div>
                </div>
            </div>

            <div class="footer-col">
                <h3>Liens Rapides</h3>
                <ul>
                    <li><a href="../../../../fr/financial-support/">Faire un don</a></li>
                    <li><a href="../../../../fr/docs/overview/intro/">Introduction à I2P</a></li>
                </ul>
            </div>

            <div class="footer-col">
                <h3>Communauté</h3>
                <ul>
                    <li><a href="../../../../fr/get-involved/">Participez</a></li>
                    <li><a href="../../../../fr/blog/">Blog</a></li>
                    <li><a href="http://i2pforum.net/" target="_blank" rel="noopener">Forums Officiels</a></li>
                    <li><a href="../../../../fr/contact/">Contact</a></li>
                </ul>
            </div>

            <div class="footer-col">
                <h3>Ressources</h3>
                <ul>
                    <li><a href="https://i2p-metrics.np-tokumei.net/" target="_blank" rel="noopener">Mesures I2P</a></li>
                    <li><a href="../../../../fr/papers/">Recherche</a></li>
                    <li><a href="https://i2pgit.org/" target="_blank" rel="noopener">GitLab</a></li>
                    <li><a href="https://www.stormycloud.org/" target="_blank" rel="noopener">StormyCloud</a></li>
                </ul>
            </div>
        </div>

        <div class="footer-bottom">
            <p class="copyright">&copy; 2025 Le Projet Internet Invisible. Sous licence Creative Commons.</p>
            <div class="footer-links">
                <a href="../../../../fr/privacy/">Confidentialité</a>
                <a href="../../../../fr/terms/">Conditions d&#39;utilisation</a>
                <a href="../../../../fr/about/media/">Presse</a>
            </div>
        </div>
    </div>
</footer>


    
    
<div class="modal-overlay" id="poll">
    <div class="modal-content poll-modal-content">
        <a href="#" class="modal-close" aria-label="Fermer">
            <span aria-hidden="true">&times;</span>
        </a>

        <div class="modal-header">
            <h2>Sondage de la communauté</h2>
            <p class="modal-subtitle">Nous aimerions avoir de vos nouvelles</p>
        </div>

        <div class="modal-body">
            
            <iframe 
                id="poll-iframe"
                data-poll-id="2"
                data-api-url="https://feedback.i2p.net"
                frameborder="0"
                scrolling="no"
                style="width: 100%; border: none; min-height: 400px;">
            </iframe>
        </div>

        <div class="modal-footer">
            <p class="modal-disclaimer">
                Votre vote aide à façonner l&#39;avenir d&#39;I2P.
            </p>
        </div>
    </div>
</div>


<script>
(function() {
    const iframe = document.getElementById('poll-iframe');
    if (!iframe) return;
    
    const hostname = window.location.hostname;
    let apiUrl = 'https://feedback.i2p.net';
    const pollId = iframe.getAttribute('data-poll-id') || '1';

    
    if (hostname.endsWith('.b32.i2p') || hostname.endsWith('.i2p')) {
        apiUrl = 'http://5kwyynf3eetgqa2nors6ctwo7doi7yu73k7uvypy5eqmm326zkiq.b32.i2p';
    }
    
    else if (hostname.endsWith('.onion')) {
        apiUrl = 'http://gfonxmohvarpmocsvllscsuszdu5rikipm6innvcwq4vpng7zzqmmfyd.onion';
    }

    
    const pollUrl = apiUrl + '/widgets/poll.html?poll_id=' + encodeURIComponent(pollId) + '&api_url=' + encodeURIComponent(apiUrl);
    iframe.src = pollUrl;
})();
</script>



    
    



    
    <script>
        (function () {
            'use strict';
            var hostname = window.location.hostname;
            var baseUrl;

            
            if (hostname.endsWith('.b32.i2p') || hostname.endsWith('.i2p')) {
                baseUrl = 'http://5kwyynf3eetgqa2nors6ctwo7doi7yu73k7uvypy5eqmm326zkiq.b32.i2p';
            } else if (hostname.endsWith('.onion')) {
                baseUrl = 'http://gfonxmohvarpmocsvllscsuszdu5rikipm6innvcwq4vpng7zzqmmfyd.onion';
            } else {
                baseUrl = 'https://feedback.i2p.net';
            }

            window.feedbackBaseUrl = baseUrl;

            
            document.querySelectorAll('[data-api-url]').forEach(function (widget) {
                widget.setAttribute('data-api-url', baseUrl);
            });

            
            document.write('<link rel="stylesheet" href="' + baseUrl + '/widgets/styles.css">');
            
        })();
    </script>

    

    
    
    

    

</body>

</html>
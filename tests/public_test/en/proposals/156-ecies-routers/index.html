<!DOCTYPE html>
<html lang="en" data-theme="light">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <title>ECIES Routers | I2P - The Invisible Internet Project</title>

    <meta name="description" content="The Invisible Internet Project - A privacy-focused, anonymous network layer">
    <meta name="keywords" content="i2p, privacy, anonymity, dark net, encryption, security">

    
    <meta property="og:title" content="ECIES Routers | I2P - The Invisible Internet Project">
    <meta property="og:description" content="The Invisible Internet Project - A privacy-focused, anonymous network layer">
    <meta property="og:type" content="website">
    <meta property="og:url" content="/en/proposals/156-ecies-routers/">

    
    <link rel="icon" type="image/svg+xml" href="../../../images/favicon.svg">
    <link rel="icon" type="image/png" href="../../../images/i2plogo.png" sizes="32x32">

    
    
    
    
    <link rel="stylesheet" href="../../../css/main.min.be6880f32f5ff44e57579da7b11513b973319944ebe38748e3ac7f3268662d18.css" integrity="sha256-vmiA8y9f9E5XV52nsRUTuXMxmUTr44dI46x/MmhmLRg=">
    


    
</head>

<body>
    
    <input type="checkbox" id="theme-toggle-checkbox" class="theme-checkbox" aria-hidden="true">

    
<div class="site-banner" id="site-banner" data-banner-id="banner-3" role="alert" aria-live="polite">
    <div class="container">
        <div class="banner-content">
            <span class="banner-message">I2P Beta Site Now Live E-Mail issues to stormycloud@mail.i2p</span>
            
        </div>
        
        <form method="GET" action="../../../api/banner/dismiss" style="display: inline;">
            <input type="hidden" name="id" value="banner-3">
            <button type="submit" class="banner-close" aria-label="Close banner" title="Close banner">
                <span aria-hidden="true">&times;</span>
            </button>
        </form>
        
    </div>
</div>


    <header class="site-header">
    <div class="container">
        <nav class="main-nav">
            <div class="nav-brand">
                <a href="../../../en/" class="logo-link">
                    <img src="../../../images/i2plogo_lightmode.svg" alt="I2P Logo" class="logo logo-light">
                    <img src="../../../images/i2plogo_darkmode.svg" alt="I2P Logo" class="logo logo-dark">
                </a>
            </div>

            
            <input type="checkbox" id="mobile-menu-checkbox" class="mobile-menu-checkbox"
                aria-label="Toggle navigation menu">
            <label for="mobile-menu-checkbox" class="mobile-menu-toggle" aria-label="Toggle navigation menu">
                <span class="hamburger"></span>
            </label>

            <div class="nav-menu">
                <ul class="nav-links">
                    <li class="nav-dropdown">
                        <a href="../../../en/about/" class="">About</a>
                        <ul class="dropdown-menu">
                            <li><a href="../../../en/about/">Overview</a></li>
                            <li><a href="../../../en/papers/">Research Papers</a></li>
                            <li><a href="../../../en/about/media/">Press</a></li>
                            <li><a href="../../../en/contact/">Contact Us</a></li>
                        </ul>
                    </li>
                    <li><a href="../../../en/docs/" class="">Docs</a></li>
                    <li><a href="../../../en/downloads/" class="">Downloads</a></li>
                    <li><a href="../../../en/blog/" class="">Blog</a></li>
                    <li class="nav-dropdown">
                        <a href="../../../en/get-involved/" class="">Get Involved</a>
                        <ul class="dropdown-menu">
                            <li><a href="../../../en/get-involved/">Overview</a></li>
                            <li><a href="../../../en/feedback/">Feature Suggestions</a></li>
                        </ul>
                    </li>
                </ul>

                <div class="nav-actions">
                    
                    <div class="language-selector">
                        <button class="language-toggle" aria-label="Select language" title="Language">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none"
                                xmlns="http://www.w3.org/2000/svg">
                                <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2" />
                                <path
                                    d="M2 12h20M12 2a15.3 15.3 0 014 10 15.3 15.3 0 01-4 10 15.3 15.3 0 01-4-10 15.3 15.3 0 014-10z"
                                    stroke="currentColor" stroke-width="2" />
                            </svg>
                            <span class="current-lang">en</span>
                        </button>
                        <div class="language-dropdown">
                            
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../en/proposals/156-ecies-routers/"
                                class="lang-option active">English</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../es/proposals/156-ecies-routers/"
                                class="lang-option">Spanish</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../ko/proposals/156-ecies-routers/"
                                class="lang-option">Korean</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../zh/proposals/156-ecies-routers/"
                                class="lang-option">Chinese</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../ru/proposals/156-ecies-routers/"
                                class="lang-option">Russian</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../cs/proposals/156-ecies-routers/"
                                class="lang-option">Czech</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../de/proposals/156-ecies-routers/"
                                class="lang-option">German</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../fr/proposals/156-ecies-routers/"
                                class="lang-option">French</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../tr/proposals/156-ecies-routers/"
                                class="lang-option">Turkish</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../vi/proposals/156-ecies-routers/"
                                class="lang-option">Vietnamese</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../hi/proposals/156-ecies-routers/"
                                class="lang-option">Hindi</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../ar/proposals/156-ecies-routers/"
                                class="lang-option">Arabic</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../pt/proposals/156-ecies-routers/"
                                class="lang-option">Portuguese</a>
                            
                            
                        </div>
                    </div>

                    
                    <label for="theme-toggle-checkbox" class="theme-toggle" aria-label="Toggle dark mode"
                        title="Toggle theme">
                        <svg class="sun-icon" width="20" height="20" viewBox="0 0 20 20" fill="none"
                            xmlns="http://www.w3.org/2000/svg">
                            <circle cx="10" cy="10" r="4" stroke="currentColor" stroke-width="2" />
                            <path
                                d="M10 2V4M10 16V18M18 10H16M4 10H2M15.657 4.343L14.243 5.757M5.757 14.243L4.343 15.657M15.657 15.657L14.243 14.243M5.757 5.757L4.343 4.343"
                                stroke="currentColor" stroke-width="2" stroke-linecap="round" />
                        </svg>
                        <svg class="moon-icon" width="20" height="20" viewBox="0 0 20 20" fill="none"
                            xmlns="http://www.w3.org/2000/svg">
                            <path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"
                                stroke="currentColor" stroke-width="2" stroke-linejoin="round" />
                        </svg>
                    </label>

                    
                    <a href="../../../en/financial-support/" class="btn btn-primary" id="donate-btn">Donate</a>

                    
                    <a href="../../../en/downloads/" class="btn btn-primary">Get I2P</a>
                </div>
            </div>
        </nav>
    </div>
</header>

    <main id="main-content">
        



<div class="proposals-page">
    <div class="container">
        
        <nav class="breadcrumbs">
            <a href="../../../en/">Home</a>
            <span class="separator">/</span>
            <a href="../../../en/proposals/">Proposals</a>
            <span class="separator">/</span>
            <span class="current">ECIES Routers</span>
        </nav>

        


        
        <header class="proposal-header">
            <div class="proposal-title-section">
                <h1 class="proposal-title">ECIES Routers</h1>
                <div class="proposal-number">Proposal 156</div>
            </div>

            
            <div class="proposal-meta-box">
                <div class="proposal-status status-closed">
                    Closed
                </div>

                
                <div class="proposal-info-grid">
                    
                    <div class="info-item">
                        <span class="info-label">Author</span>
                        <span class="info-value">zzz, orignal</span>
                    </div>
                    

                    
                    <div class="info-item">
                        <span class="info-label">Created</span>
                        <span class="info-value">2020-09-01</span>
                    </div>
                    

                    
                    <div class="info-item">
                        <span class="info-label">Last Updated</span>
                        <span class="info-value">2025-03-05</span>
                    </div>
                    

                    
                    <div class="info-item">
                        <span class="info-label">Target Version</span>
                        <span class="info-value">0.9.51</span>
                    </div>
                    

                    
                </div>

                
                
            </div>
        </header>

        
        <div class="proposal-layout proposal-layout--with-toc">
            
            
            <aside class="proposal-toc-sidebar">
                <nav class="toc-nav">
                    <div class="toc-header">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                            <path d="M4 6h16M4 12h16M4 18h16" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                        </svg>
                        On This Page
                    </div>
                    <div class="toc-content">
                        <nav id="TableOfContents">
  <ul>
    <li><a href="#note">Note</a></li>
    <li><a href="#overview">Overview</a>
      <ul>
        <li><a href="#summary">Summary</a></li>
        <li><a href="#goals">Goals</a></li>
        <li><a href="#non-goals">Non-Goals</a></li>
      </ul>
    </li>
    <li><a href="#design">Design</a>
      <ul>
        <li><a href="#key-location-and-crypto-type">Key Location and Crypto Type</a></li>
        <li><a href="#tunnel-build-message">Tunnel Build Message</a></li>
        <li><a href="#end-to-end-encryption">End-to-End Encryption</a></li>
      </ul>
    </li>
    <li><a href="#specification">Specification</a>
      <ul>
        <li><a href="#request-encryption">Request Encryption</a></li>
        <li><a href="#reply-encryption">Reply Encryption</a></li>
      </ul>
    </li>
    <li><a href="#justification">Justification</a></li>
    <li><a href="#implementation-notes">Implementation Notes</a></li>
    <li><a href="#issues">Issues</a></li>
    <li><a href="#migration">Migration</a>
      <ul>
        <li><a href="#basic-point-to-point">Basic Point-to-Point</a></li>
        <li><a href="#netdb-compatibility">NetDB Compatibility</a></li>
        <li><a href="#tunnel-building">Tunnel Building</a></li>
        <li><a href="#ratchet-messages-to-ecies-floodfills">Ratchet messages to ECIES floodfills</a></li>
        <li><a href="#rekeying-and-new-installs">Rekeying and New Installs</a></li>
        <li><a href="#new-tunnel-build-message-phase-2">New Tunnel Build Message (Phase 2)</a></li>
        <li><a href="#rekeying-complete">Rekeying Complete</a></li>
      </ul>
    </li>
    <li><a href="#references">References</a></li>
  </ul>
</nav>
                    </div>
                </nav>
            </aside>
            

            
            <div class="proposal-main">
                <article class="proposal-content">
                    <h2 id="note">Note</h2>
<p>Network deployment and testing in progress.
Subject to revision.
Status:</p>
<ul>
<li>ECIES Routers implemented as of 0.9.48, see <a href="../../../en/docs/specs/common-structures/">Common Structures</a>
.</li>
<li>Tunnel building implemented as of 0.9.48, see <a href="../../../en/docs/specs/implementation/">Tunnel Creation ECIES</a>
.</li>
<li>Encrypted messages to ECIES routers implemented as of 0.9.49, see <a href="../../../en/docs/specs/ecies/">ECIES</a>
.</li>
<li>New tunnel build messages implemented as of 0.9.51.</li>
</ul>
<h2 id="overview">Overview</h2>
<h3 id="summary">Summary</h3>
<p>Router Identities currently contain an ElGamal encryption key.
This has been the standard since the beginnings of I2P.
ElGamal is slow and needs to be replaced in all places it is used.</p>
<p>The proposals for LS2 <a href="../../../en/proposals/123-new-netdb-entries">Proposal 123</a>
 and ECIES-X25519-AEAD-Ratchet <a href="../../../en/proposals/144-ecies-x25519-aead-ratchet">Proposal 144</a>

(now specified in <a href="../../../en/docs/specs/ecies/">ECIES</a>
) defined the replacement of ElGamal with ECIES
for Destinations.</p>
<p>This proposal defines the replacement of ElGamal with ECIES-X25519 for routers.
This proposal provides an overview of the changes required.
Most of the details are in other proposals and specifications.
See the reference section for links.</p>
<h3 id="goals">Goals</h3>
<p>See <a href="../../../en/proposals/152-ecies-tunnels">Proposal 152</a>
 for additional goals.</p>
<ul>
<li>Replace ElGamal with ECIES-X25519 in Router Identities</li>
<li>Reuse existing cryptographic primitives</li>
<li>Improve tunnel build message security where possible while maintaining compatibility</li>
<li>Support tunnels with mixed ElGamal/ECIES peers</li>
<li>Maximize compatibility with current network</li>
<li>Do not require &ldquo;flag day&rdquo; upgrade to entire network</li>
<li>Gradual rollout to minimize risk</li>
<li>New, smaller tunnel build message</li>
</ul>
<h3 id="non-goals">Non-Goals</h3>
<p>See <a href="../../../en/proposals/152-ecies-tunnels">Proposal 152</a>
 for additional non-goals.</p>
<ul>
<li>No requirement for dual-key routers</li>
<li>Layer encryption changes, for that see <a href="../../../en/proposals/153-chacha20-layer-encryption">Proposal 153</a>
</li>
</ul>
<h2 id="design">Design</h2>
<h3 id="key-location-and-crypto-type">Key Location and Crypto Type</h3>
<p>For Destinations, the key is in the leaseset, not in the Destination, and
we support multiple encryption types in the same leaseset.</p>
<p>None of that is required for routers. The router&rsquo;s encryption key
is in its Router Identity. See the common structures spec <a href="../../../en/docs/specs/common-structures/">Common Structures</a>
.</p>
<p>For routers, we will replace the 256 byte ElGamal key in the Router Identity
with a 32 byte X25519 key and 224 bytes of padding.
This will be indicated by the crypto type in the key certificate.
The crypto type (same as used in the LS2) is 4.
This indicates a little-endian 32-byte X25519 public key.
This is the standard construction as defined in the common structures spec <a href="../../../en/docs/specs/common-structures/">Common Structures</a>
.</p>
<p>This is identical to the method proposed for ECIES-P256
for crypto types 1-3 in proposal 145 <a href="../../../en/proposals/145-ecies">Proposal 145</a>
.
While this proposal was never adopted, the Java implementation developers prepared for
crypto types in Router Identity key certificates by adding checks in several
places in the code base. Most of this work was done in mid-2019.</p>
<h3 id="tunnel-build-message">Tunnel Build Message</h3>
<p>Several changes to the tunnel creation specification <a href="../../../en/docs/specs/implementation/">Tunnel Creation</a>

are required to use ECIES instead of ElGamal.
In addition, we will make improvements to the tunnel build messages
to increase security.</p>
<p>In phase 1, we will change the format and encryption of the
Build Request Record and Build Response Record for ECIES hops.
These changes will be compatible with existing ElGamal routers.
These changes are defined in proposal 152 <a href="../../../en/proposals/152-ecies-tunnels">Proposal 152</a>
.</p>
<p>In phase 2, we will add a new version of the
Build Request Message, Build Reply Message,
Build Request Record and Build Response Record.
The size will be reduced for efficiency.
These changes must be supported by all hops in a tunnel, and all hops must be ECIES.
These changes are defined in proposal 157 <a href="../../../en/proposals/157-new-tbm">Proposal 157</a>
.</p>
<h3 id="end-to-end-encryption">End-to-End Encryption</h3>
<h4 id="history">History</h4>
<p>In the original design of Java I2P, there was a single ElGamal Session Key Manager (SKM)
shared by the router and all its local Destinations.
As a shared SKM could leak information and allow correlation by attackers,
the design was changed to support separate ElGamal SKMs for the router and each Destination.
The ElGamal design supported only anonymous senders;
the sender sent ephemeral keys only, not a static key.
The message was not bound to the sender&rsquo;s identity.</p>
<p>Then, we designed the ECIES Ratchet SKM in
ECIES-X25519-AEAD-Ratchet <a href="../../../en/proposals/144-ecies-x25519-aead-ratchet">Proposal 144</a>
, now specified in <a href="../../../en/docs/specs/ecies/">ECIES</a>
.
This design was specified using the Noise &ldquo;IK&rdquo; pattern, which included the sender&rsquo;s
static key in the first message. This protocol is used for ECIES (type 4) Destinations.
The IK pattern does not allow for anonymous senders.</p>
<p>Therefore, we included in the proposal a way to also send anonymous messages
to a Ratchet SKM, using a zero-filled static key. This simulated a Noise &ldquo;N&rdquo; pattern,
but in a compatible way, so a ECIES SKM could receive both anonymous and non-anonymous messages.
The intent was to use zero-key for ECIES routers.</p>
<h4 id="use-cases-and-threat-models">Use Cases and Threat Models</h4>
<p>The use case and threat model for messages sent to routers is very different from
that for end-to-end messages between Destinations.</p>
<p>Destination use case and threat model:</p>
<ul>
<li>Non-anonymous from/to destinations (sender includes static key)</li>
<li>Efficiently support sustained traffic between destinations (full handshake, streaming, and tags)</li>
<li>Always sent through outbound and inbound tunnels</li>
<li>Hide all identifying characteristics from OBEP and IBGW, requiring Elligator2 encoding of ephemeral keys.</li>
<li>Both participants must use the same encryption type</li>
</ul>
<p>Router use case and threat model:</p>
<ul>
<li>Anonymous messages from routers or destinations (sender does not include static key)</li>
<li>For encrypted Database Lookups and Stores only, generally to floodfills</li>
<li>Occasional messages</li>
<li>Multiple messages should not be correlated</li>
<li>Always sent through outbound tunnel directly to a router. No inbound tunnels used</li>
<li>OBEP knows that it is forwarding the message to a router and knows its encryption type</li>
<li>The two participants may have different encryption types</li>
<li>Database Lookup replies are one-time messages using the reply key and tag in the Database Lookup message</li>
<li>Database Store confirmations are one-time messages using a bundled Delivery Status message</li>
</ul>
<p>Router use-case non-goals:</p>
<ul>
<li>No need for non-anonymous messages</li>
<li>No need to send messages through inbound exploratory tunnels (a router does not publish exploratory leasesets)</li>
<li>No need for sustained message traffic using tags</li>
<li>No need to run &ldquo;dual key&rdquo; Session Key Managers as described in <a href="../../../en/docs/specs/ecies/">ECIES</a>
 for Destinations. Routers only have one public key.</li>
</ul>
<h4 id="design-conclusions">Design Conclusions</h4>
<p>The ECIES Router SKM does not need a full Ratchet SKM as specified in <a href="../../../en/docs/specs/ecies/">ECIES</a>
 for Destinations.
There is no requirement for non-anonymous messages using the IK pattern.
The threat model does not require Elligator2-encoded ephemeral keys.</p>
<p>Therefore, the router SKM will use the Noise &ldquo;N&rdquo; pattern, same as specified
in <a href="../../../en/proposals/152-ecies-tunnels">Proposal 152</a>
 for tunnel building.
It will use the same payload format as specified in <a href="../../../en/docs/specs/ecies/">ECIES</a>
 for Destinations.
The zero static key (no binding or session) mode of IK specified in <a href="../../../en/docs/specs/ecies/">ECIES</a>
 will not be used.</p>
<p>Replies to lookups will be encrypted with a ratchet tag if requested in the lookup.
This is as documented in <a href="../../../en/proposals/154-ecies-lookups">Proposal 154</a>
, now specified in <a href="../../../en/docs/specs/i2np/">I2NP</a>
.</p>
<p>The design enables the router to have a single ECIES Session Key Manager.
There is no need to run &ldquo;dual key&rdquo; Session Key Managers as
described in <a href="../../../en/docs/specs/ecies/">ECIES</a>
 for Destinations.
Routers only have one public key.</p>
<p>An ECIES router does not have an ElGamal static key.
The router still needs an implementation of ElGamal to build tunnels
through ElGamal routers and send encrypted messages to ElGamal routers.</p>
<p>An ECIES router MAY require a partial ElGamal Session Key Manager to
receive ElGamal-tagged messages received as replies to NetDB lookups
from pre-0.9.46 floodfill routers, as those routers do not
have an implementation of ECIES-tagged replies as specified in <a href="../../../en/proposals/152-ecies-tunnels">Proposal 152</a>
.
If not, an ECIES router may not request an encrypted reply from a
pre-0.9.46 floodfill router.</p>
<p>This is optional. Decision may vary in various I2P implementations
and may depend on the amount of the network that has upgraded to
0.9.46 or higher.
As of this date, approximately 85% of the network is 0.9.46 or higher.</p>
<h2 id="specification">Specification</h2>
<p>X25519: See <a href="../../../en/docs/specs/ecies/">ECIES</a>
.</p>
<p>Router Identity and Key Certificate: See <a href="../../../en/docs/specs/common-structures/">Common Structures</a>
.</p>
<p>Tunnel Building: See <a href="../../../en/proposals/152-ecies-tunnels">Proposal 152</a>
.</p>
<p>New Tunnel Build Message: See <a href="../../../en/proposals/157-new-tbm">Proposal 157</a>
.</p>
<h3 id="request-encryption">Request Encryption</h3>
<p>The request encryption is the same as that specified in <a href="../../../en/docs/specs/implementation/">Tunnel Creation ECIES</a>
 and <a href="../../../en/proposals/152-ecies-tunnels">Proposal 152</a>
,
using the Noise &ldquo;N&rdquo; pattern.</p>
<p>Replies to lookups will be encrypted with a ratchet tag if requested in the lookup.
Database Lookup request messages contain the 32-byte reply key and 8-byte reply tag
as specified in <a href="../../../en/docs/specs/i2np/">I2NP</a>
 and <a href="../../../en/proposals/154-ecies-lookups">Proposal 154</a>
. The key and tag are used to encrypt the reply.</p>
<p>Tag sets are not created.
The zero static key scheme specified in
ECIES-X25519-AEAD-Ratchet <a href="../../../en/proposals/144-ecies-x25519-aead-ratchet">Proposal 144</a>
 and <a href="../../../en/docs/specs/ecies/">ECIES</a>
 will not be used.
Ephemeral keys will not be Elligator2-encoded.</p>
<p>Generally, these will be New Session messages and will be sent with a zero static key
(no binding or session), as the sender of the message is anonymous.</p>
<h4 id="kdf-for-initial-ck-and-h">KDF for Initial ck and h</h4>
<p>This is standard <a href="https://noiseprotocol.org/noise.html">Noise</a>
 for pattern &ldquo;N&rdquo; with a standard protocol name.
This is the same as specified in <a href="../../../en/docs/specs/implementation/">Tunnel Creation ECIES</a>
 and <a href="../../../en/proposals/152-ecies-tunnels">Proposal 152</a>
 for tunnel build messages.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>This is the &#34;e&#34; message pattern:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  // Define protocol_name.
</span></span><span style="display:flex;"><span>  Set protocol_name = &#34;Noise_N_25519_ChaChaPoly_SHA256&#34;
</span></span><span style="display:flex;"><span>  (31 bytes, US-ASCII encoded, no NULL termination).
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  // Define Hash h = 32 bytes
</span></span><span style="display:flex;"><span>  // Pad to 32 bytes. Do NOT hash it, because it is not more than 32 bytes.
</span></span><span style="display:flex;"><span>  h = protocol_name || 0
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  Define ck = 32 byte chaining key. Copy the h data to ck.
</span></span><span style="display:flex;"><span>  Set chainKey = h
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  // MixHash(null prologue)
</span></span><span style="display:flex;"><span>  h = SHA256(h);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  // up until here, can all be precalculated by all routers.
</span></span></code></pre></div><h4 id="kdf-for-message">KDF for Message</h4>
<p>Message creators generate an ephemeral X25519 keypair for each message.
Ephemeral keys must be unique per message.
This is the same as specified in <a href="../../../en/docs/specs/implementation/">Tunnel Creation ECIES</a>
 and <a href="../../../en/proposals/152-ecies-tunnels">Proposal 152</a>
 for tunnel build messages.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>// Target router&#39;s X25519 static keypair (hesk, hepk) from the Router Identity
</span></span><span style="display:flex;"><span>  hesk = GENERATE_PRIVATE()
</span></span><span style="display:flex;"><span>  hepk = DERIVE_PUBLIC(hesk)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  // MixHash(hepk)
</span></span><span style="display:flex;"><span>  // || below means append
</span></span><span style="display:flex;"><span>  h = SHA256(h || hepk);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  // up until here, can all be precalculated by each router
</span></span><span style="display:flex;"><span>  // for all incoming messages
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  // Sender generates an X25519 ephemeral keypair
</span></span><span style="display:flex;"><span>  sesk = GENERATE_PRIVATE()
</span></span><span style="display:flex;"><span>  sepk = DERIVE_PUBLIC(sesk)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  // MixHash(sepk)
</span></span><span style="display:flex;"><span>  h = SHA256(h || sepk);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  End of &#34;e&#34; message pattern.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  This is the &#34;es&#34; message pattern:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  // Noise es
</span></span><span style="display:flex;"><span>  // Sender performs an X25519 DH with receiver&#39;s static public key.
</span></span><span style="display:flex;"><span>  // The target router
</span></span><span style="display:flex;"><span>  // extracts the sender&#39;s ephemeral key preceding the encrypted record.
</span></span><span style="display:flex;"><span>  sharedSecret = DH(sesk, hepk) = DH(hesk, sepk)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  // MixKey(DH())
</span></span><span style="display:flex;"><span>  //[chainKey, k] = MixKey(sharedSecret)
</span></span><span style="display:flex;"><span>  // ChaChaPoly parameters to encrypt/decrypt
</span></span><span style="display:flex;"><span>  keydata = HKDF(chainKey, sharedSecret, &#34;&#34;, 64)
</span></span><span style="display:flex;"><span>  // Chain key is not used
</span></span><span style="display:flex;"><span>  //chainKey = keydata[0:31]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  // AEAD parameters
</span></span><span style="display:flex;"><span>  k = keydata[32:63]
</span></span><span style="display:flex;"><span>  n = 0
</span></span><span style="display:flex;"><span>  plaintext = 464 byte build request record
</span></span><span style="display:flex;"><span>  ad = h
</span></span><span style="display:flex;"><span>  ciphertext = ENCRYPT(k, n, plaintext, ad)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  End of &#34;es&#34; message pattern.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  // MixHash(ciphertext) is not required
</span></span><span style="display:flex;"><span>  //h = SHA256(h || ciphertext)
</span></span></code></pre></div><h4 id="payload">Payload</h4>
<p>The payload is the same block format as defined in <a href="../../../en/docs/specs/ecies/">ECIES</a>
 and <a href="../../../en/proposals/144-ecies-x25519-aead-ratchet">Proposal 144</a>
.
All messages must contain a DateTime block for replay prevention.</p>
<h3 id="reply-encryption">Reply Encryption</h3>
<p>Replies to Database Lookup messages are Database Store or Database Search Reply messages.
They are encrypted as Existing Session messages with
the 32-byte reply key and 8-byte reply tag
as specified in <a href="../../../en/docs/specs/i2np/">I2NP</a>
 and <a href="../../../en/proposals/154-ecies-lookups">Proposal 154</a>
.</p>
<p>There are no explicit replies to Database Store messages. The sender may bundle its
own reply as a Garlic Message to itself, containing a Delivery Status message.</p>
<h2 id="justification">Justification</h2>
<p>This design maximizes reuse of existing cryptographic primitives, protocols, and code.</p>
<p>This design minimizes risk.</p>
<h2 id="implementation-notes">Implementation Notes</h2>
<p>Older routers do not check the encryption type of the router and will send ElGamal-encrypted
build records or netdb messages.
Some recent routers are buggy and will send various types of malformed build records.
Some recent routers may send non-anonymous (full ratchet) netdb messages.
Implementers should detect and reject these records and messages
as early as possible, to reduce CPU usage.</p>
<h2 id="issues">Issues</h2>
<p>Proposal 145 <a href="../../../en/proposals/145-ecies">Proposal 145</a>
 may or may not be rewritten to be mostly-compatible with
Proposal 152 <a href="../../../en/proposals/152-ecies-tunnels">Proposal 152</a>
.</p>
<h2 id="migration">Migration</h2>
<p>The implementation, testing, and rollout will take several releases
and approximately one year. The phases are as follows. Assignment of
each phase to a particular release is TBD and depends on
the pace of development.</p>
<p>Details of the implementation and migration may vary for
each I2P implementation.</p>
<h3 id="basic-point-to-point">Basic Point-to-Point</h3>
<p>ECIES routers can connect to and receive connections from ElGamal routers.
This should be possible now, as several checks were added to the Java code base
by mid-2019 in reaction to unfinished proposal 145 <a href="../../../en/proposals/145-ecies">Proposal 145</a>
.
Ensure there&rsquo;s nothing in the code bases
that prevents point-to-point connections to non-ElGamal routers.</p>
<p>Code correctness checks:</p>
<ul>
<li>Ensure that ElGamal routers do not request AEAD-encrypted replies to DatabaseLookup messages
(when the reply comes back through an exploratory tunnel to the router)</li>
<li>Ensure that ECIES routers do not request AES-encrypted replies to DatabaseLookup messages
(when the reply comes back through an exploratory tunnel to the router)</li>
</ul>
<p>Until later phases, when specifications and implementations are complete:</p>
<ul>
<li>Ensure that tunnel builds are not attempted by ElGamal routers through ECIES routers.</li>
<li>Ensure that encrypted ElGamal messages are not sent by ElGamal routers to ECIES floodfill routers.
(DatabaseLookups and DatabaseStores)</li>
<li>Ensure that encrypted ECIES messages are not sent by ECIES routers to ElGamal floodfill routers.
(DatabaseLookups and DatabaseStores)</li>
<li>Ensure that ECIES routers do not automatically become floodfill.</li>
</ul>
<p>No changes should be required.
Target release, if changes required: 0.9.48</p>
<h3 id="netdb-compatibility">NetDB Compatibility</h3>
<p>Ensure that ECIES router infos may be stored to and retrieved from ElGamal floodfills.
This should be possible now, as several checks were added to the Java code base
by mid-2019 in reaction to unfinished proposal 145 <a href="../../../en/proposals/145-ecies">Proposal 145</a>
.
Ensure there&rsquo;s nothing in the code bases
that prevents storage of non-ElGamal RouterInfos in the network database.</p>
<p>No changes should be required.
Target release, if changes required: 0.9.48</p>
<h3 id="tunnel-building">Tunnel Building</h3>
<p>Implement tunnel building as defined in proposal 152 <a href="../../../en/proposals/152-ecies-tunnels">Proposal 152</a>
.
Start with having an ECIES router build tunnels with all ElGamal hops;
use its own build request record for an inbound tunnel to test and debug.</p>
<p>Then test and support ECIES routers building tunnels with a mix of
ElGamal and ECIES hops.</p>
<p>Then enable tunnel building through ECIES routers.
No minimum version check should be necessary unless incompatible changes
to proposal 152 are made after a release.</p>
<p>Target release: 0.9.48, late 2020</p>
<h3 id="ratchet-messages-to-ecies-floodfills">Ratchet messages to ECIES floodfills</h3>
<p>Implement and test reception of ECIES messages (with zero static key) by ECIES floodfills,
as defined in proposal 144 <a href="../../../en/proposals/144-ecies-x25519-aead-ratchet">Proposal 144</a>
.
Implement ant test reception of AEAD replies to DatabaseLookup messages by ECIES routers.</p>
<p>Enable auto-floodfill by ECIES routers.
Then enable sending ECIES messages to ECIES routers.
No minimum version check should be necessary unless incompatible changes
to proposal 152 are made after a release.</p>
<p>Target release: 0.9.49, early 2021.
ECIES routers may automatically become floodfill.</p>
<h3 id="rekeying-and-new-installs">Rekeying and New Installs</h3>
<p>New installs will default to ECIES as of release 0.9.49.</p>
<p>Gradually rekey all routers to minimize risk and disruption to the network.
Use existing code that did the rekeying for sig type migration years ago.
This code gives each router a small random chance of rekeying at each restart.
After several restarts, a router will probably have rekeyed to ECIES.</p>
<p>The criterion for starting rekeying is that a sufficient portion of the network,
perhaps 50%, can build tunnels through ECIES routers (0.9.48 or higher).</p>
<p>Before aggressively rekeying the entire network, the vast majority
(perhaps 90% or more) must be able to build tunnels through ECIES routers (0.9.48 or higher)
AND send messages to ECIES floodfills (0.9.49 or higher).
This target will probably be reached for the 0.9.52 release.</p>
<p>Rekeying will take several releases.</p>
<p>Target release:
0.9.49 for new routers to default to ECIES;
0.9.49 to slowly start rekeying;
0.9.50 - 0.9.52 to repeatedly increase the rekeying rate;
late 2021 for the majority of the network to be rekeyed.</p>
<h3 id="new-tunnel-build-message-phase-2">New Tunnel Build Message (Phase 2)</h3>
<p>Implement and test the new Tunnel Build Message as defined in proposal 157 <a href="../../../en/proposals/157-new-tbm">Proposal 157</a>
.
Roll the support out in release 0.9.51.
Do additional testing, then enable in release 0.9.52.</p>
<p>Testing will be difficult.
Before this can be widely tested, a good subset of the network must support it.
Before it is broadly useful, a majority of the network must support it.
If specification or implementation changes are required after testing,
that would delay the rollout for an additional release.</p>
<p>Target release: 0.9.52, late 2021.</p>
<h3 id="rekeying-complete">Rekeying Complete</h3>
<p>At this point, routers older than some version TBD will
not be able to build tunnels through most peers.</p>
<p>Target release: 0.9.53, early 2022.</p>
<h2 id="references">References</h2>
<ul>
<li><a href="../../../en/docs/specs/common-structures/">Common</a>
</li>
<li><a href="../../../en/docs/specs/ecies/">ECIES</a>
</li>
<li><a href="../../../en/docs/specs/ecies/">ECIES-ROUTERS</a>
</li>
<li><a href="../../../en/docs/specs/i2np/">I2NP</a>
</li>
<li><a href="https://noiseprotocol.org/noise.html">NOISE</a>
</li>
<li><a href="../../../en/proposals/123-new-netdb-entries/">Prop123</a>
</li>
<li><a href="../../../en/proposals/144-ecies-x25519-aead-ratchet/">Prop144</a>
</li>
<li><a href="../../../en/proposals/145-ecies/">Prop145</a>
</li>
<li><a href="../../../en/proposals/152-ecies-tunnels/">Prop152</a>
</li>
<li><a href="../../../en/proposals/153-chacha20-layer-encryption/">Prop153</a>
</li>
<li><a href="../../../en/proposals/154-ecies-lookups/">Prop154</a>
</li>
<li><a href="../../../en/proposals/157-new-tbm/">Prop157</a>
</li>
<li><a href="../../../en/docs/specs/implementation/#tunnel-creation-ecies">Tunnel-Creation</a>
</li>
<li><a href="../../../en/docs/specs/implementation/#tunnel-creation-ecies">Tunnel-Creation-ECIES</a>
</li>
</ul>

                </article>

                
                <nav class="page-nav">
                    <a href="../../../en/proposals/" class="page-nav-link">
                        ‚Üê Back to Proposals
                    </a>
                    
                    
                    
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                            
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                    <a href="../../../proposals/156-ecies-routers.txt" class="page-nav-link" download>
                        Download Source (.txt)
                    </a>
                    
                </nav>
            </div>
        </div>
    </div>
</div>

<style>
.proposals-page {
    min-height: 100vh;
    padding: var(--spacing-xl) 0;
}

.breadcrumbs {
    display: flex;
    align-items: center;
    gap: var(--spacing-xs);
    margin-bottom: var(--spacing-lg);
    font-size: 0.875rem;
    color: var(--color-text-muted);
}

.breadcrumbs a {
    color: var(--color-text-muted);
    text-decoration: none;
    transition: color var(--transition-fast);
}

.breadcrumbs a:hover {
    color: var(--color-primary);
}

.separator {
    color: var(--color-border);
}

.current {
    color: var(--color-text);
}

 
.translation-disclaimer {
    background: #fef3c7;
    border: 1px solid #f59e0b;
    border-radius: var(--radius-md);
    padding: var(--spacing-md);
    margin-bottom: var(--spacing-lg);
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: var(--spacing-md);
    flex-wrap: wrap;
}

.dark .translation-disclaimer {
    background: #78350f;
    border-color: #d97706;
}

.disclaimer-message {
    color: #92400e;
    font-size: 0.875rem;
}

.dark .disclaimer-message {
    color: #fde047;
}

.disclaimer-link {
    color: #92400e;
    font-weight: 600;
    text-decoration: underline;
    white-space: nowrap;
}

.dark .disclaimer-link {
    color: #fde047;
}

 
.proposal-header {
    margin-bottom: var(--spacing-2xl);
}

.proposal-title-section {
    margin-bottom: var(--spacing-lg);
}

.proposal-title {
    font-size: 2.5rem;
    margin: 0 0 var(--spacing-sm) 0;
    color: var(--color-text);
}

.proposal-number {
    font-size: 0.875rem;
    color: var(--color-text-muted);
    font-weight: 600;
}

 
.proposal-meta-box {
    background: var(--color-bg-secondary);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-lg);
    padding: var(--spacing-lg);
}

.proposal-status {
    display: inline-block;
    padding: var(--spacing-xs) var(--spacing-md);
    border-radius: var(--radius-md);
    font-weight: 600;
    font-size: 0.875rem;
    margin-bottom: var(--spacing-md);
    text-transform: uppercase;
    letter-spacing: 0.05em;
}

 
.status-open {
    background: #dbeafe;
    color: #0369a1;
}

.dark .status-open {
    background: #0c4a6e;
    color: #7dd3fc;
}

.status-accepted {
    background: #dbeafe;
    color: #0369a1;
}

.dark .status-accepted {
    background: #0c4a6e;
    color: #7dd3fc;
}

.status-finished {
    background: #dcfce7;
    color: #15803d;
}

.dark .status-finished {
    background: #164e63;
    color: #86efac;
}

.status-closed {
    background: #dcfce7;
    color: #15803d;
}

.dark .status-closed {
    background: #164e63;
    color: #86efac;
}

.status-rejected {
    background: #fee2e2;
    color: #991b1b;
}

.dark .status-rejected {
    background: #7f1d1d;
    color: #fca5a5;
}

.status-draft,
.status-needs-revision,
.status-dead,
.status-needs-research {
    background: #fef3c7;
    color: #92400e;
}

.dark .status-draft,
.dark .status-needs-revision,
.dark .status-dead,
.dark .status-needs-research {
    background: #78350f;
    color: #fde047;
}

.status-meta,
.status-informational,
.status-reserve {
    background: #e9d5ff;
    color: #6b21a8;
}

.dark .status-meta,
.dark .status-informational,
.dark .status-reserve {
    background: #581c87;
    color: #e879f9;
}

 
.proposal-info-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: var(--spacing-md);
    margin-bottom: var(--spacing-lg);
}

.info-item {
    display: flex;
    flex-direction: column;
    gap: var(--spacing-xs);
}

.info-label {
    font-size: 0.75rem;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    color: var(--color-text-muted);
}

.info-value {
    font-size: 0.9375rem;
    color: var(--color-text);
    font-weight: 500;
}

 
.proposal-relationships {
    border-top: 1px solid var(--color-border);
    padding-top: var(--spacing-md);
}

.relationship {
    display: flex;
    gap: var(--spacing-md);
    margin-bottom: var(--spacing-sm);
}

.relationship:last-child {
    margin-bottom: 0;
}

.relationship-label {
    font-weight: 600;
    color: var(--color-text-muted);
    min-width: 120px;
}

.relationship-value {
    color: var(--color-text);
}

 
.proposal-layout {
    display: block;
}

.proposal-layout--with-toc {
    display: grid;
    grid-template-columns: 260px 1fr;
    gap: var(--spacing-2xl);
    align-items: start;
}

 
.proposal-toc-sidebar {
    position: sticky;
    top: 100px;
    max-height: calc(100vh - 120px);
    overflow-y: auto;
}

.toc-nav {
    background: var(--color-bg-secondary);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-lg);
    padding: var(--spacing-md);
}

.toc-header {
    display: flex;
    align-items: center;
    gap: var(--spacing-sm);
    font-weight: 700;
    font-size: 0.875rem;
    color: var(--color-text);
    padding-bottom: var(--spacing-md);
    margin-bottom: var(--spacing-md);
    border-bottom: 1px solid var(--color-border);
}

.toc-content {
    max-height: calc(100vh - 250px);
    overflow-y: auto;
}

.toc-content::-webkit-scrollbar {
    width: 4px;
}

.toc-content::-webkit-scrollbar-track {
    background: transparent;
}

.toc-content::-webkit-scrollbar-thumb {
    background: var(--color-border);
    border-radius: 2px;
}

.toc-content::-webkit-scrollbar-thumb:hover {
    background: var(--color-text-muted);
}

.toc-nav ul {
    list-style: none;
    padding-left: 0;
    margin: 0;
}

.toc-nav li {
    margin-bottom: 0.25rem;
}

.toc-nav ul ul {
    padding-left: var(--spacing-md);
    margin-top: 0.25rem;
}

.toc-nav a {
    color: var(--color-text-secondary);
    text-decoration: none;
    font-size: 0.8125rem;
    display: block;
    padding: 0.25rem 0.5rem;
    border-radius: var(--radius-sm);
    transition: all var(--transition-fast);
    line-height: 1.4;
}

.toc-nav a:hover {
    color: var(--color-primary);
    background: var(--color-bg-tertiary);
}

 
.proposal-main {
    min-width: 0;
}

 
.proposal-content {
    line-height: 1.8;
    color: var(--color-text);
    max-width: 900px;
}

.proposal-content h2 {
    margin-top: var(--spacing-2xl);
    margin-bottom: var(--spacing-md);
    font-size: 1.75rem;
    scroll-margin-top: 100px;
}

.proposal-content h3 {
    margin-top: var(--spacing-xl);
    margin-bottom: var(--spacing-sm);
    font-size: 1.375rem;
    scroll-margin-top: 100px;
}

.proposal-content h4 {
    margin-top: var(--spacing-lg);
    margin-bottom: var(--spacing-xs);
    font-size: 1.125rem;
    scroll-margin-top: 100px;
}

.proposal-content p {
    margin-bottom: var(--spacing-md);
}

.proposal-content ul,
.proposal-content ol {
    margin-bottom: var(--spacing-md);
    padding-left: var(--spacing-xl);
}

.proposal-content li {
    margin-bottom: var(--spacing-xs);
}

.proposal-content code {
    background: var(--color-bg-secondary);
    padding: 0.125rem 0.375rem;
    border-radius: var(--radius-sm);
    font-size: 0.875em;
    font-family: 'Courier New', monospace;
}

.proposal-content pre {
    background: var(--color-bg-secondary);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-md);
    padding: var(--spacing-md);
    overflow-x: auto;
    margin-bottom: var(--spacing-md);
    font-size: 0.875rem;
}

.proposal-content pre code {
    background: none;
    padding: 0;
}

.proposal-content blockquote {
    border-left: 4px solid var(--color-primary);
    padding-left: var(--spacing-md);
    margin-left: 0;
    margin-bottom: var(--spacing-md);
    font-style: italic;
    color: var(--color-text-secondary);
}

.proposal-content a {
    color: var(--color-primary);
    text-decoration: none;
    border-bottom: 1px solid transparent;
    transition: border-color var(--transition-fast);
}

.proposal-content a:hover {
    border-bottom-color: var(--color-primary);
}

.proposal-content table {
    width: 100%;
    border-collapse: collapse;
    margin-bottom: var(--spacing-md);
}

.proposal-content table th {
    background: var(--color-bg-secondary);
    padding: var(--spacing-sm);
    text-align: left;
    font-weight: 600;
    border-bottom: 2px solid var(--color-border);
}

.proposal-content table td {
    padding: var(--spacing-sm);
    border-bottom: 1px solid var(--color-border);
}

.proposal-content img {
    max-width: 100%;
    height: auto;
    border-radius: var(--radius-md);
    border: 1px solid var(--color-border);
    margin: var(--spacing-lg) 0;
    display: block;
}

 
.page-nav {
    margin-top: var(--spacing-2xl);
    padding-top: var(--spacing-xl);
    border-top: 1px solid var(--color-border);
    display: flex;
    gap: var(--spacing-md);
    flex-wrap: wrap;
}

.page-nav-link {
    display: inline-block;
    padding: var(--spacing-md) var(--spacing-lg);
    background: var(--color-bg-secondary);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-md);
    color: var(--color-text);
    text-decoration: none;
    transition: all var(--transition-fast);
}

.page-nav-link:hover {
    border-color: var(--color-primary);
    color: var(--color-primary);
}

 
@media (max-width: 1024px) {
    .proposal-layout--with-toc {
        grid-template-columns: 1fr;
    }

    .proposal-toc-sidebar {
        position: static;
        max-height: none;
        margin-bottom: var(--spacing-xl);
    }

    .toc-content {
        max-height: 300px;
    }
}

@media (max-width: 768px) {
    .proposal-title {
        font-size: 1.75rem;
    }

    .proposal-info-grid {
        grid-template-columns: 1fr;
    }
}
</style>



<script>
document.addEventListener('DOMContentLoaded', function() {
    const tocLinks = document.querySelectorAll('.toc-nav a');
    const headings = [];

    tocLinks.forEach(link => {
        const href = link.getAttribute('href');
        if (href && href.startsWith('#')) {
            const heading = document.getElementById(href.slice(1));
            if (heading) {
                headings.push({ element: heading, link: link });
            }
        }
    });

    function updateActiveLink() {
        const scrollPos = window.scrollY + 120;
        let activeIndex = 0;

        for (let i = 0; i < headings.length; i++) {
            if (headings[i].element.offsetTop <= scrollPos) {
                activeIndex = i;
            }
        }

        tocLinks.forEach(link => link.classList.remove('active'));
        if (headings[activeIndex]) {
            headings[activeIndex].link.classList.add('active');
        }
    }

    window.addEventListener('scroll', updateActiveLink);
    updateActiveLink();
});
</script>
<style>
.toc-nav a.active {
    color: var(--color-primary);
    background: var(--color-bg-tertiary);
    font-weight: 600;
}
</style>



    </main>

    <footer class="site-footer">
    <div class="container">
        <div class="footer-grid">
            <div class="footer-col footer-brand">
                <img src="../../../images/i2plogo_lightmode.svg" alt="I2P Logo" class="footer-logo logo-light" loading="lazy" decoding="async">
                <img src="../../../images/i2plogo_darkmode.svg" alt="I2P Logo" class="footer-logo logo-dark" loading="lazy" decoding="async">
                <p class="footer-tagline">Privacy. Security. Freedom.</p>
                <p class="footer-description">The Invisible Internet Project - A privacy-focused, anonymous network layer</p>

                <div class="footer-social-newsletter">
                    <div class="social-links">
                        <a href="https://mastodon.social/@i2p" target="_blank" rel="noopener" aria-label="Mastodon">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M21.327 8.566c0-4.339-2.843-5.61-2.843-5.61-1.433-.658-3.894-.935-6.451-.956h-.063c-2.557.021-5.016.298-6.45.956 0 0-2.843 1.272-2.843 5.61 0 .993-.019 2.181.012 3.441.103 4.243.778 8.425 4.701 9.463 1.809.479 3.362.579 4.612.51 2.268-.126 3.541-.809 3.541-.809l-.075-1.646s-1.621.511-3.441.449c-1.804-.062-3.707-.194-3.999-2.409a4.523 4.523 0 0 1-.04-.621s1.77.433 4.014.536c1.372.063 2.658-.08 3.965-.236 2.506-.299 4.688-1.843 4.962-3.254.434-2.223.398-5.424.398-5.424zm-3.353 5.59h-2.081V9.057c0-1.075-.452-1.62-1.357-1.62-1 0-1.501.647-1.501 1.927v2.791h-2.069V9.364c0-1.28-.501-1.927-1.502-1.927-.905 0-1.357.546-1.357 1.62v5.099H6.026V8.903c0-1.074.273-1.927.823-2.558.566-.631 1.307-.955 2.228-.955 1.065 0 1.872.409 2.405 1.228l.518.869.519-.869c.533-.819 1.34-1.228 2.405-1.228.92 0 1.662.324 2.228.955.549.631.822 1.484.822 2.558v5.253z"/>
                            </svg>
                        </a>
                        <a href="https://twitter.com/GetI2P" target="_blank" rel="noopener" aria-label="Twitter">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/>
                            </svg>
                        </a>
                        <a href="https://old.reddit.com/r/i2p" target="_blank" rel="noopener" aria-label="Reddit">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M12 0A12 12 0 0 0 0 12a12 12 0 0 0 12 12 12 12 0 0 0 12-12A12 12 0 0 0 12 0zm5.01 4.744c.688 0 1.25.561 1.25 1.249a1.25 1.25 0 0 1-2.498.056l-2.597-.547-.8 3.747c1.824.07 3.48.632 4.674 1.488.308-.309.73-.491 1.207-.491.968 0 1.754.786 1.754 1.754 0 .716-.435 1.333-1.01 1.614a3.111 3.111 0 0 1 .042.52c0 2.694-3.13 4.87-7.004 4.87-3.874 0-7.004-2.176-7.004-4.87 0-.183.015-.366.043-.534A1.748 1.748 0 0 1 4.028 12c0-.968.786-1.754 1.754-1.754.463 0 .898.196 1.207.49 1.207-.883 2.878-1.43 4.744-1.487l.885-4.182a.342.342 0 0 1 .14-.197.35.35 0 0 1 .238-.042l2.906.617a1.214 1.214 0 0 1 1.108-.701zM9.25 12C8.561 12 8 12.562 8 13.25c0 .687.561 1.248 1.25 1.248.687 0 1.248-.561 1.248-1.249 0-.688-.561-1.249-1.249-1.249zm5.5 0c-.687 0-1.248.561-1.248 1.25 0 .687.561 1.248 1.249 1.248.688 0 1.249-.561 1.249-1.249 0-.687-.562-1.249-1.25-1.249zm-5.466 3.99a.327.327 0 0 0-.231.094.33.33 0 0 0 0 .463c.842.842 2.484.913 2.961.913.477 0 2.105-.056 2.961-.913a.361.361 0 0 0 .029-.463.33.33 0 0 0-.464 0c-.547.533-1.684.73-2.512.73-.828 0-1.979-.196-2.512-.73a.326.326 0 0 0-.232-.095z"/>
                            </svg>
                        </a>
                        <a href="https://signal.group/#CjQKIOSUTtxlhbumAKcRsthPFkxkTUrkWcX39bbN6njLEgAIEhCTNsR0KDuiehAXZnkt42v5" target="_blank" rel="noopener" aria-label="Signal" class="signal-link">
                            <img src="../../../images/Signal-Logo-Black.svg" alt="Signal" class="signal-logo signal-logo-light" loading="lazy" decoding="async">
                            <img src="../../../images/Signal-Logo-White.svg" alt="Signal" class="signal-logo signal-logo-dark" loading="lazy" decoding="async">
                        </a>
                    </div>

                    
                    <div class="footer-newsletter-inline">
                        <p class="newsletter-description">Stay updated with I2P news:</p>
                        <form action="https://feedback.i2p.net/api/mailing-list/subscribe" method="POST" class="newsletter-form">
                            <input type="email" name="email" placeholder="Enter your email" required>
                            <button type="submit">Subscribe</button>
                        </form>
                    </div>
                </div>
            </div>

            <div class="footer-col">
                <h3>Quick Links</h3>
                <ul>
                    <li><a href="../../../en/financial-support/">Donate</a></li>
                    <li><a href="../../../en/docs/overview/intro/">I2P Introduction</a></li>
                </ul>
            </div>

            <div class="footer-col">
                <h3>Community</h3>
                <ul>
                    <li><a href="../../../en/get-involved/">Get Involved</a></li>
                    <li><a href="../../../en/blog/">Blog</a></li>
                    <li><a href="http://i2pforum.net/" target="_blank" rel="noopener">Official Forums</a></li>
                    <li><a href="../../../en/contact/">Contact</a></li>
                </ul>
            </div>

            <div class="footer-col">
                <h3>Resources</h3>
                <ul>
                    <li><a href="https://i2p-metrics.np-tokumei.net/" target="_blank" rel="noopener">I2P Metrics</a></li>
                    <li><a href="../../../en/papers/">Research</a></li>
                    <li><a href="https://i2pgit.org/" target="_blank" rel="noopener">GitLab</a></li>
                    <li><a href="https://www.stormycloud.org/" target="_blank" rel="noopener">StormyCloud</a></li>
                </ul>
            </div>
        </div>

        <div class="footer-bottom">
            <p class="copyright">&copy; 2025 The Invisible Internet Project. Licensed under Creative Commons.</p>
            <div class="footer-links">
                <a href="../../../en/privacy/">Privacy</a>
                <a href="../../../en/terms/">Terms</a>
                <a href="../../../en/about/media/">Press</a>
            </div>
        </div>
    </div>
</footer>


    
    
<div class="modal-overlay" id="poll">
    <div class="modal-content poll-modal-content">
        <a href="#" class="modal-close" aria-label="Close">
            <span aria-hidden="true">&times;</span>
        </a>

        <div class="modal-header">
            <h2>Community Poll</h2>
            <p class="modal-subtitle">We&#39;d love to hear from you</p>
        </div>

        <div class="modal-body">
            
            <iframe 
                id="poll-iframe"
                data-poll-id="2"
                data-api-url="https://feedback.i2p.net"
                frameborder="0"
                scrolling="no"
                style="width: 100%; border: none; min-height: 400px;">
            </iframe>
        </div>

        <div class="modal-footer">
            <p class="modal-disclaimer">
                Your vote helps shape the future of I2P.
            </p>
        </div>
    </div>
</div>


<script>
(function() {
    const iframe = document.getElementById('poll-iframe');
    if (!iframe) return;
    
    const hostname = window.location.hostname;
    let apiUrl = 'https://feedback.i2p.net';
    const pollId = iframe.getAttribute('data-poll-id') || '1';

    
    if (hostname.endsWith('.b32.i2p') || hostname.endsWith('.i2p')) {
        apiUrl = 'http://5kwyynf3eetgqa2nors6ctwo7doi7yu73k7uvypy5eqmm326zkiq.b32.i2p';
    }
    
    else if (hostname.endsWith('.onion')) {
        apiUrl = 'http://gfonxmohvarpmocsvllscsuszdu5rikipm6innvcwq4vpng7zzqmmfyd.onion';
    }

    
    const pollUrl = apiUrl + '/widgets/poll.html?poll_id=' + encodeURIComponent(pollId) + '&api_url=' + encodeURIComponent(apiUrl);
    iframe.src = pollUrl;
})();
</script>



    
    



    
    <script>
        (function () {
            'use strict';
            var hostname = window.location.hostname;
            var baseUrl;

            
            if (hostname.endsWith('.b32.i2p') || hostname.endsWith('.i2p')) {
                baseUrl = 'http://5kwyynf3eetgqa2nors6ctwo7doi7yu73k7uvypy5eqmm326zkiq.b32.i2p';
            } else if (hostname.endsWith('.onion')) {
                baseUrl = 'http://gfonxmohvarpmocsvllscsuszdu5rikipm6innvcwq4vpng7zzqmmfyd.onion';
            } else {
                baseUrl = 'https://feedback.i2p.net';
            }

            window.feedbackBaseUrl = baseUrl;

            
            document.querySelectorAll('[data-api-url]').forEach(function (widget) {
                widget.setAttribute('data-api-url', baseUrl);
            });

            
            document.write('<link rel="stylesheet" href="' + baseUrl + '/widgets/styles.css">');
            
        })();
    </script>

    

    
    
    

    

</body>

</html>
<!DOCTYPE html>
<html lang="hi" data-theme="light">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <title>ECIES-X25519-AEAD-Ratchet (क्रमिक कुंजी-परिवर्तन तंत्र) एन्क्रिप्शन विनिर्देश | I2P - अदृश्य इंटरनेट परियोजना</title>

    <meta name="description" content="I2P के लिए एलिप्टिक कर्व इंटीग्रेटेड एन्क्रिप्शन स्कीम (X25519 &#43; AEAD)">
    <meta name="keywords" content="i2p, privacy, anonymity, dark net, encryption, security">

    
    <meta property="og:title" content="ECIES-X25519-AEAD-Ratchet (क्रमिक कुंजी-परिवर्तन तंत्र) एन्क्रिप्शन विनिर्देश | I2P - अदृश्य इंटरनेट परियोजना">
    <meta property="og:description" content="I2P के लिए एलिप्टिक कर्व इंटीग्रेटेड एन्क्रिप्शन स्कीम (X25519 &#43; AEAD)">
    <meta property="og:type" content="website">
    <meta property="og:url" content="/hi/docs/specs/ecies/">

    
    <link rel="icon" type="image/svg+xml" href="../../../../images/favicon.svg">
    <link rel="icon" type="image/png" href="../../../../images/i2plogo.png" sizes="32x32">

    
    
    
    
    <link rel="stylesheet" href="../../../../css/main.min.be6880f32f5ff44e57579da7b11513b973319944ebe38748e3ac7f3268662d18.css" integrity="sha256-vmiA8y9f9E5XV52nsRUTuXMxmUTr44dI46x/MmhmLRg=">
    


    
</head>

<body>
    
    <input type="checkbox" id="theme-toggle-checkbox" class="theme-checkbox" aria-hidden="true">

    
<div class="site-banner" id="site-banner" data-banner-id="banner-3" role="alert" aria-live="polite">
    <div class="container">
        <div class="banner-content">
            <span class="banner-message">I2P बीटा साइट अब लाइव है समस्याओं के लिए ई-मेल करें stormycloud@mail.i2p</span>
            
        </div>
        
        <form method="GET" action="../../../../api/banner/dismiss" style="display: inline;">
            <input type="hidden" name="id" value="banner-3">
            <button type="submit" class="banner-close" aria-label="बैनर बंद करें" title="बैनर बंद करें">
                <span aria-hidden="true">&times;</span>
            </button>
        </form>
        
    </div>
</div>


    <header class="site-header">
    <div class="container">
        <nav class="main-nav">
            <div class="nav-brand">
                <a href="../../../../hi/" class="logo-link">
                    <img src="../../../../images/i2plogo_lightmode.svg" alt="I2P Logo" class="logo logo-light">
                    <img src="../../../../images/i2plogo_darkmode.svg" alt="I2P Logo" class="logo logo-dark">
                </a>
            </div>

            
            <input type="checkbox" id="mobile-menu-checkbox" class="mobile-menu-checkbox"
                aria-label="Toggle navigation menu">
            <label for="mobile-menu-checkbox" class="mobile-menu-toggle" aria-label="Toggle navigation menu">
                <span class="hamburger"></span>
            </label>

            <div class="nav-menu">
                <ul class="nav-links">
                    <li class="nav-dropdown">
                        <a href="../../../../hi/about/" class="">के बारे में</a>
                        <ul class="dropdown-menu">
                            <li><a href="../../../../hi/about/">समीक्षा</a></li>
                            <li><a href="../../../../hi/papers/">अनुसंधान पत्र</a></li>
                            <li><a href="../../../../hi/about/media/">प्रेस</a></li>
                            <li><a href="../../../../hi/contact/">संपर्क करें</a></li>
                        </ul>
                    </li>
                    <li><a href="../../../../hi/docs/" class="active">दस्तावेज़</a></li>
                    <li><a href="../../../../hi/downloads/" class="">डाउनलोड्स</a></li>
                    <li><a href="../../../../hi/blog/" class="">ब्लॉग</a></li>
                    <li class="nav-dropdown">
                        <a href="../../../../hi/get-involved/" class="">शामिल हों</a>
                        <ul class="dropdown-menu">
                            <li><a href="../../../../hi/get-involved/">समीक्षा</a></li>
                            <li><a href="../../../../hi/feedback/">फीचर सुझाव</a></li>
                        </ul>
                    </li>
                </ul>

                <div class="nav-actions">
                    
                    <div class="language-selector">
                        <button class="language-toggle" aria-label="Select language" title="Language">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none"
                                xmlns="http://www.w3.org/2000/svg">
                                <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2" />
                                <path
                                    d="M2 12h20M12 2a15.3 15.3 0 014 10 15.3 15.3 0 01-4 10 15.3 15.3 0 01-4-10 15.3 15.3 0 014-10z"
                                    stroke="currentColor" stroke-width="2" />
                            </svg>
                            <span class="current-lang">hi</span>
                        </button>
                        <div class="language-dropdown">
                            
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../../en/docs/specs/ecies/"
                                class="lang-option">अंग्रेजी</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../../es/docs/specs/ecies/"
                                class="lang-option">स्पेनिश</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../../ko/docs/specs/ecies/"
                                class="lang-option">कोरियाई</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../../zh/docs/specs/ecies/"
                                class="lang-option">चीनी</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../../ru/docs/specs/ecies/"
                                class="lang-option">रूसी</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../../cs/docs/specs/ecies/"
                                class="lang-option">चेक</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../../de/docs/specs/ecies/"
                                class="lang-option">जर्मन</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../../fr/docs/specs/ecies/"
                                class="lang-option">फ्रेंच</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../../tr/docs/specs/ecies/"
                                class="lang-option">तुर्की</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../../vi/docs/specs/ecies/"
                                class="lang-option">वियतनामी</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../../hi/docs/specs/ecies/"
                                class="lang-option active">हिन्दी</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../../ar/docs/specs/ecies/"
                                class="lang-option">अरबी</a>
                            
                            
                            
                            
                            
                            
                            
                            
                            <a href="../../../../pt/docs/specs/ecies/"
                                class="lang-option">पुर्तगाली</a>
                            
                            
                        </div>
                    </div>

                    
                    <label for="theme-toggle-checkbox" class="theme-toggle" aria-label="Toggle dark mode"
                        title="Toggle theme">
                        <svg class="sun-icon" width="20" height="20" viewBox="0 0 20 20" fill="none"
                            xmlns="http://www.w3.org/2000/svg">
                            <circle cx="10" cy="10" r="4" stroke="currentColor" stroke-width="2" />
                            <path
                                d="M10 2V4M10 16V18M18 10H16M4 10H2M15.657 4.343L14.243 5.757M5.757 14.243L4.343 15.657M15.657 15.657L14.243 14.243M5.757 5.757L4.343 4.343"
                                stroke="currentColor" stroke-width="2" stroke-linecap="round" />
                        </svg>
                        <svg class="moon-icon" width="20" height="20" viewBox="0 0 20 20" fill="none"
                            xmlns="http://www.w3.org/2000/svg">
                            <path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"
                                stroke="currentColor" stroke-width="2" stroke-linejoin="round" />
                        </svg>
                    </label>

                    
                    <a href="../../../../hi/financial-support/" class="btn btn-primary" id="donate-btn">Donate</a>

                    
                    <a href="../../../../hi/downloads/" class="btn btn-primary">I2P प्राप्त करें</a>
                </div>
            </div>
        </nav>
    </div>
</header>

    <main id="main-content">
        




<div class="docs-page">
    <div class="container">
        
        <div class="docs-layout docs-layout--with-toc">
            
            
            <aside class="docs-toc-sidebar">
                <nav class="toc-nav">
                    <div class="toc-header">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                            <path d="M4 6h16M4 12h16M4 18h16" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                        </svg>
                        On This Page
                    </div>
                    <div class="toc-content">
                        <nav id="TableOfContents">
  <ul>
    <li><a href="#अवलकन">अवलोकन</a>
      <ul>
        <li><a href="#उददशय">उद्देश्य</a></li>
        <li><a href="#elgamalaessessiontags-क-तलन-म-मखय-सधर">ElGamal/AES+SessionTags की तुलना में मुख्य सुधार</a></li>
        <li><a href="#परनयजन-सथत">परिनियोजन स्थिति</a></li>
        <li><a href="#करयनवयन-सथत">कार्यान्वयन स्थिति</a></li>
      </ul>
    </li>
    <li><a href="#परटकल-क-बनयद">प्रोटोकॉल की बुनियाद</a>
      <ul>
        <li><a href="#noise-protocol-framework-करपटगरफ-म-हडशक-और-कज-सहमत-परटकल-डजइन-करन-क-एक-ढच">Noise Protocol Framework (क्रिप्टोग्राफी में हैंडशेक और कुंजी-सहमति प्रोटोकॉल डिज़ाइन करने का एक ढांचा)</a></li>
        <li><a href="#noise-protocol-पहचनकरत-noise-protocol-एक-करपटगरफक-हडशक-ढच">Noise Protocol पहचानकर्ता (Noise Protocol: एक क्रिप्टोग्राफ़िक हैंडशेक ढांचा)</a></li>
        <li><a href="#noise-करपटगरफक-परटकल-फरमवरक-हडशक-पटरन">Noise (क्रिप्टोग्राफ़िक प्रोटोकॉल फ्रेमवर्क) हैंडशेक पैटर्न</a></li>
        <li><a href="#noise-सरकष-गणधरम">Noise सुरक्षा गुणधर्म</a></li>
        <li><a href="#ik-और-xk-क-बच-अतर">IK और XK के बीच अंतर</a></li>
        <li><a href="#signal-double-ratchet-डबल-रचट-एलगरदम-क-अवधरणए">Signal Double Ratchet (डबल रैचेट एल्गोरिद्म) की अवधारणाएँ</a></li>
        <li><a href="#noise-करपटगरफक-परटकल-फरमवरक-क-लए-i2p-वसतर">Noise (क्रिप्टोग्राफिक प्रोटोकॉल फ्रेमवर्क) के लिए I2P विस्तारों</a></li>
      </ul>
    </li>
    <li><a href="#करपटगरफ-क-मल-घटक">क्रिप्टोग्राफी के मूल घटक</a>
      <ul>
        <li><a href="#x25519-डफ-हलमन">X25519 डिफ़ी-हेलमैन</a></li>
        <li><a href="#x25519-generate_private">X25519 GENERATE_PRIVATE()</a></li>
        <li><a href="#x25519-derive_publicprivkey">X25519 DERIVE_PUBLIC(privkey)</a></li>
        <li><a href="#x25519-dhprivkey-pubkey">X25519 DH(privkey, pubkey)</a></li>
        <li><a href="#chacha20-poly1305-aead-सबदध-डट-क-सथ-परमणत-एनकरपशन">ChaCha20-Poly1305 AEAD (संबद्ध डेटा के साथ प्रमाणित एन्क्रिप्शन)</a></li>
        <li><a href="#chacha20-poly1305-encryptk-n-plaintext-ad">ChaCha20-Poly1305 ENCRYPT(k, n, plaintext, ad)</a></li>
        <li><a href="#chacha20-poly1305-decryptk-n-ciphertext-ad">ChaCha20-Poly1305 DECRYPT(k, n, ciphertext, ad)</a></li>
        <li><a href="#sha-256-हश-फकशन">SHA-256 हैश फ़ंक्शन</a></li>
        <li><a href="#sha-256-hp-d">SHA-256 H(p, d)</a></li>
        <li><a href="#sha-256-mixhashd">SHA-256 MixHash(d)</a></li>
        <li><a href="#hkdf-कज-वयतपतत">HKDF कुंजी व्युत्पत्ति</a></li>
        <li><a href="#elligator2-एनकडग">Elligator2 एन्कोडिंग</a></li>
        <li><a href="#elligator2-generate_private_elg2">Elligator2 GENERATE_PRIVATE_ELG2()</a></li>
        <li><a href="#elligator2-encode_elg2pubkey">Elligator2 ENCODE_ELG2(pubkey)</a></li>
        <li><a href="#elligator2-एक-करपटगरफक-मपग-तकनक-decode_elg2encodedkey">Elligator2 (एक क्रिप्टोग्राफिक मैपिंग तकनीक) DECODE_ELG2(encodedKey)</a></li>
      </ul>
    </li>
    <li><a href="#सदश-पररप">संदेश प्रारूप</a>
      <ul>
        <li><a href="#अवलकन-1">अवलोकन</a></li>
        <li><a href="#i2np-garlic-message-कटनर">I2NP Garlic Message कंटेनर</a></li>
        <li><a href="#नय-सतर-ns-सदश">नया सत्र (NS) संदेश</a></li>
        <li><a href="#binding-बइडग-सहत-ns-सदश-परकर-1b">Binding (बाइंडिंग) सहित NS संदेश (प्रकार 1b)</a></li>
        <li><a href="#बइडग-क-बन-ns-सदश-परकर-1c">बाइंडिंग के बिना NS संदेश (प्रकार 1c)</a></li>
        <li><a href="#ns-एक-बर-क-सदश-परकर-1d">NS एक-बार का संदेश (प्रकार 1d)</a></li>
        <li><a href="#नय-सशन-उततर-nsr-सदश">नया सेशन उत्तर (NSR) संदेश</a></li>
        <li><a href="#वदयमन-सतर-es-सदश">विद्यमान सत्र (ES) संदेश</a></li>
      </ul>
    </li>
    <li><a href="#कज-वयतपतत-फलन">कुंजी व्युत्पत्ति फलन</a>
      <ul>
        <li><a href="#परतक-वधन-और-सथरक">प्रतीक-विधान और स्थिरांक</a></li>
        <li><a href="#ns-सदश-क-लए-कज-वयतपतत-फलन">NS संदेश के लिए कुंजी व्युत्पत्ति फलन</a></li>
        <li><a href="#kdf-1-पररभक-शरखल-कज">KDF 1: प्रारंभिक श्रृंखला कुंजी</a></li>
        <li><a href="#kdf-2-कज-वयतपनन-फकशन-bob-क-सथर-कज-क-मशरण">KDF 2 (कुंजी व्युत्पन्न फ़ंक्शन): Bob की स्थिर कुंजी का मिश्रण</a></li>
        <li><a href="#kdf-3-ऐलस-क-असथय-कज-उतपतत">KDF 3: ऐलिस की अस्थायी कुंजी उत्पत्ति</a></li>
        <li><a href="#kdf-कज-वयतपतत-फकशन-4-ns-सथर-कज-अनभग-es-dh">KDF (कुंजी व्युत्पत्ति फ़ंक्शन) 4: NS स्थिर कुंजी अनुभाग (es DH)</a></li>
        <li><a href="#kdf-कज-वयतपतत-फकशन-5-ns-पलड-अनभग-ss-dh-सटटक-सटटक-डफ-हलमन-कवल-बइड">KDF (कुंजी व्युत्पत्ति फ़ंक्शन) 5: NS पेलोड अनुभाग (ss DH (स्टैटिक-स्टैटिक डिफी-हेलमैन), केवल बाइंड)</a></li>
        <li><a href="#nsr-उततर-टगसट-कज-वयतपनन-फकशन">NSR उत्तर टैगसेट कुंजी व्युत्पन्न फ़ंक्शन</a></li>
        <li><a href="#nsr-सदश-कज-वयतपतत-फकशन">NSR संदेश कुंजी व्युत्पत्ति फ़ंक्शन</a></li>
        <li><a href="#kdf-6-nsr-असथय-कज-सजन">KDF 6: NSR अस्थायी कुंजी सृजन</a></li>
        <li><a href="#kdf-7-nsr-कज-अनभग-ee-और-se-dh-diffie-hellman-कज-वनमय">KDF 7: NSR कुंजी अनुभाग (ee और se DH (Diffie-Hellman कुंजी-विनिमय))</a></li>
        <li><a href="#kdf-8-nsr-पलड-अनभग">KDF 8: NSR पेलोड अनुभाग</a></li>
        <li><a href="#es-सदश-kdfs-key-derivation-functions-कज-वयतपतत-फकशन">ES संदेश KDFs (Key Derivation Functions, कुंजी व्युत्पत्ति फ़ंक्शन)</a></li>
        <li><a href="#dh_initialize-फकशन">DH_INITIALIZE फ़ंक्शन</a></li>
      </ul>
    </li>
    <li><a href="#रचट-करपटगरफक-कज-अदयतन-ततर-यतरणए">रैचेट (क्रिप्टोग्राफ़िक कुंजी अद्यतन तंत्र) यंत्रणाएँ</a>
      <ul>
        <li><a href="#ratchet-करपटगरफ-म-करमक-कज-अदयतन-ततर-क-अवलकन">Ratchet (क्रिप्टोग्राफी में क्रमिक कुंजी-अद्यतन तंत्र) का अवलोकन</a></li>
        <li><a href="#dh-ratchet-डफ-हलमन-रचट-सदश-दर-सदश-कज-बदलन-वल-ततर">DH Ratchet (डिफी-हेल्मन रैचेट, संदेश-दर-संदेश कुंजी बदलने वाला तंत्र)</a></li>
        <li><a href="#dh-ratchet-diffie-hellman-आधरत-करमक-कज-अदयतन-ततर-क-आवतत">DH Ratchet (Diffie-Hellman आधारित क्रमिक कुंजी-अद्यतन तंत्र) की आवृत्ति</a></li>
        <li><a href="#dh-ratchet-diffie-hellman-आधरत-कज-घमव-ततर-क-टग-और-कज-पहचनकरत">DH Ratchet (Diffie-Hellman आधारित कुंजी-घुमाव तंत्र) के टैग और कुंजी पहचानकर्ता</a></li>
        <li><a href="#dh-ratchet-डफ-हलमन-रचट-सदश-परवह">DH Ratchet (डिफी-हेलमैन रैचेट) संदेश प्रवाह</a></li>
        <li><a href="#nextkey-बलक-पररप">NextKey ब्लॉक प्रारूप</a></li>
        <li><a href="#dh-ratchet-kdf-dh-रचट-आधरत-कज-वयतपनन-फकशन">DH Ratchet KDF (DH रैचेट आधारित कुंजी व्युत्पन्न फ़ंक्शन)</a></li>
        <li><a href="#dh-ratchet-diffie-hellman-आधरत-रचट-क-सथत-क-परबधन">DH Ratchet (Diffie-Hellman आधारित रैचेट) की स्थिति का प्रबंधन</a></li>
        <li><a href="#सशन-टग-रचट">सेशन टैग रैचेट</a></li>
        <li><a href="#session-tag-ratchet-एक-परगतशल-कज-अदयतन-ततर-क-उददशय">Session Tag Ratchet (एक प्रगतिशील कुंजी-अद्यतन तंत्र) का उद्देश्य</a></li>
        <li><a href="#session-tag-ratchet-करमक-अदयतन-ततर-सतर">Session Tag Ratchet (क्रमिक अद्यतन तंत्र) सूत्र</a></li>
        <li><a href="#session-tag-ratchet-करमक-कज-अदयतन-ततर-परषक-क-करयनवयन">Session Tag Ratchet (क्रमिक कुंजी-अद्यतन तंत्र) प्रेषक का कार्यान्वयन</a></li>
        <li><a href="#session-tag-ratchet-सशन-टग-क-लए-कज-आग-बढन-वल-ततर-रसवर-करयनवयन">Session Tag Ratchet (सेशन टैग के लिए कुंजी आगे बढ़ाने वाला तंत्र) रिसीवर कार्यान्वयन</a></li>
        <li><a href="#session-tag-सशन-टग-लक-अहड-रणनत">Session Tag (सेशन टैग) लुक-अहेड रणनीति</a></li>
        <li><a href="#सशन-टग-क-आउट-ऑफ-ऑरडर-करम-स-बहर-हडलग">सेशन टैग की आउट-ऑफ-ऑर्डर (क्रम से बाहर) हैंडलिंग</a></li>
        <li><a href="#सममत-कज-रचट">सममित कुंजी रैचेट</a></li>
        <li><a href="#symmetric-key-ratchet-करमक-कज-परवरतन-ततर-क-उददशय">Symmetric Key Ratchet (क्रमिक कुंजी-परिवर्तन तंत्र) का उद्देश्य</a></li>
        <li><a href="#सममत-कज-ratchet-करमक-कज-अदयतन-ततर-क-सतर">सममित कुंजी Ratchet (क्रमिक कुंजी-अद्यतन तंत्र) का सूत्र</a></li>
        <li><a href="#सममत-कज-रचट-परषक-करयनवयन">सममित कुंजी रैचेट प्रेषक कार्यान्वयन</a></li>
        <li><a href="#सममत-कज-ratchet-करमक-कज-परवरतन-ततर-परपतकरत-क-करयनवयन">सममित कुंजी Ratchet (क्रमिक कुंजी-परिवर्तन तंत्र) प्राप्तकर्ता का कार्यान्वयन</a></li>
        <li><a href="#session-tags-सतर-टगस-क-सथ-सममत-रचट-क-समकलन">Session Tags (सत्र टैग्स) के साथ सममित रैचेट का समकालन</a></li>
        <li><a href="#सममत-ratchet-कज-अदयतन-ततर-nonce-एक-बर-परयकत-हन-वल-यदचछक-मन-नरमण">सममित Ratchet (कुंजी-अद्यतन तंत्र) Nonce (एक बार प्रयुक्त होने वाला यादृच्छिक मान) निर्माण</a></li>
      </ul>
    </li>
    <li><a href="#सतर-परबधन">सत्र प्रबंधन</a>
      <ul>
        <li><a href="#सतर-सदरभ">सत्र संदर्भ</a></li>
        <li><a href="#सशन-बइडग">सेशन बाइंडिंग</a></li>
        <li><a href="#बधत-सतर">बंधित सत्र</a></li>
        <li><a href="#unbound-सतर">Unbound सत्र</a></li>
        <li><a href="#सतर-यगमन">सत्र युग्मन</a></li>
        <li><a href="#यगमत-सतर-बनन">युग्मित सत्र बनाना</a></li>
        <li><a href="#session-pairing-सतर-पयरग-क-लभ">Session Pairing (सत्र पेयरिंग) के लाभ</a></li>
        <li><a href="#सतर-यगमन-क-नयम">सत्र युग्मन के नियम</a></li>
        <li><a href="#सतर-जवनचकर">सत्र जीवनचक्र</a></li>
        <li><a href="#सतर-जवनचकर-नरमण-चरण">सत्र जीवनचक्र: निर्माण चरण</a></li>
        <li><a href="#सतर-जवनचकर-सकरय-चरण">सत्र जीवनचक्र: सक्रिय चरण</a></li>
        <li><a href="#सतर-जवनचकर-समपत-चरण">सत्र जीवनचक्र: समाप्ति चरण</a></li>
        <li><a href="#कई-ns-सदश">कई NS संदेश</a></li>
        <li><a href="#कई-nsr-सदश">कई NSR संदेश</a></li>
        <li><a href="#सतर-सटट-मशन">सत्र स्टेट मशीन</a></li>
      </ul>
    </li>
    <li><a href="#पलड-पररप">पेलोड प्रारूप</a>
      <ul>
        <li><a href="#बलक-सरचन">ब्लॉक संरचना</a></li>
        <li><a href="#बलक-परकर">ब्लॉक प्रकार</a></li>
        <li><a href="#बलक-करम-नरधरण-नयम">ब्लॉक क्रम निर्धारण नियम</a></li>
        <li><a href="#ns-सदश-करम">NS संदेश क्रम</a></li>
        <li><a href="#nsr-सदश-क-करम">NSR संदेशों का क्रम</a></li>
        <li><a href="#es-सदश-क-करम">ES संदेशों का क्रम</a></li>
        <li><a href="#datetime-बलक-परकर-0">DateTime ब्लॉक (प्रकार 0)</a></li>
        <li><a href="#garlic-clove-block-i2p-म-garlic-encryption-क-भतर-क-clove-बलक-परकर-11">Garlic Clove Block (I2P में garlic encryption के भीतर का &lsquo;clove&rsquo; ब्लॉक) (प्रकार 11)</a></li>
        <li><a href="#nextkey-block-अगल-कज-बलक-परकर-7">NextKey Block (अगली कुंजी ब्लॉक) (प्रकार 7)</a></li>
        <li><a href="#ack-बलक-परकर-8">ACK ब्लॉक (प्रकार 8)</a></li>
        <li><a href="#ack-अनरध-बलक-परकर-9">ACK अनुरोध ब्लॉक (प्रकार 9)</a></li>
        <li><a href="#समपन-बलक-परकर-4">समापन ब्लॉक (प्रकार 4)</a></li>
        <li><a href="#वकलप-बलक-परकर-5">विकल्प ब्लॉक (प्रकार 5)</a></li>
        <li><a href="#messagenumbers-बलक-परकर-6">MessageNumbers ब्लॉक (प्रकार 6)</a></li>
        <li><a href="#पडग-बलक-टइप-254">पैडिंग ब्लॉक (टाइप 254)</a></li>
      </ul>
    </li>
    <li><a href="#करयनवयन-मरगदरशक">कार्यान्वयन मार्गदर्शिका</a>
      <ul>
        <li><a href="#परवपकषए">पूर्वापेक्षाएँ</a></li>
        <li><a href="#अनशसत-करयनवयन-करम">अनुशंसित कार्यान्वयन क्रम</a></li>
        <li><a href="#परषक-करयनवयन">प्रेषक कार्यान्वयन</a></li>
        <li><a href="#रसवर-क-करयनवयन">रिसीवर का कार्यान्वयन</a></li>
        <li><a href="#सदश-वरगकरण">संदेश वर्गीकरण</a></li>
        <li><a href="#सतर-परबधन-क-सरवततम-परथए">सत्र प्रबंधन की सर्वोत्तम प्रथाएँ</a></li>
        <li><a href="#परकषण-रणनतय">परीक्षण रणनीतियाँ</a></li>
        <li><a href="#परदरशन-सबध-वचर">प्रदर्शन संबंधी विचार</a></li>
      </ul>
    </li>
    <li><a href="#सरकष-सबध-वचर">सुरक्षा संबंधी विचार</a>
      <ul>
        <li><a href="#धमक-मडल">धमकी मॉडल</a></li>
        <li><a href="#करपटगरफक-धरणए">क्रिप्टोग्राफिक धारणाएँ</a></li>
        <li><a href="#कज-परबधन">कुंजी प्रबंधन</a></li>
        <li><a href="#हमल-क-शमन-उपय">हमलों के शमन उपाय</a></li>
        <li><a href="#रपल-हमल-क-शमन-उपय">रीप्ले हमले के शमन उपाय</a></li>
        <li><a href="#key-compromise-impersonation-kci-कज-समझत-क-करण-परतरपण-शमन-उपय">Key Compromise Impersonation (KCI) (कुंजी-समझौते के कारण प्रतिरूपण) शमन उपाय</a></li>
        <li><a href="#denial-of-service-सव-असवकरण-क-शमन-उपय">Denial-of-Service (सेवा-अस्वीकरण) के शमन उपाय</a></li>
        <li><a href="#टरफक-वशलषण-परतरध">ट्रैफ़िक विश्लेषण प्रतिरोध</a></li>
        <li><a href="#करयनवयन-म-समनय-गलतय">कार्यान्वयन में सामान्य गलतियाँ</a></li>
      </ul>
    </li>
  </ul>

  <ul>
    <li>
      <ul>
        <li><a href="#security-audits">Security Audits</a></li>
      </ul>
    </li>
    <li><a href="#configuration-and-deployment">Configuration and Deployment</a>
      <ul>
        <li><a href="#i2cp-configuration">I2CP Configuration</a></li>
        <li><a href="#java-i2p-configuration">Java I2P Configuration</a></li>
        <li><a href="#i2pd-configuration">i2pd Configuration</a></li>
        <li><a href="#compatibility-matrix">Compatibility Matrix</a></li>
        <li><a href="#migration-guide">Migration Guide</a></li>
        <li><a href="#performance-tuning">Performance Tuning</a></li>
        <li><a href="#monitoring-and-debugging">Monitoring and Debugging</a></li>
      </ul>
    </li>
    <li><a href="#references">References</a>
      <ul>
        <li><a href="#specifications">Specifications</a></li>
        <li><a href="#cryptographic-standards">Cryptographic Standards</a></li>
        <li><a href="#implementation-resources">Implementation Resources</a></li>
        <li><a href="#additional-information">Additional Information</a></li>
      </ul>
    </li>
    <li><a href="#appendix-a-kdf-summary">Appendix A: KDF Summary</a></li>
    <li><a href="#appendix-b-message-size-calculator">Appendix B: Message Size Calculator</a></li>
    <li><a href="#appendix-c-glossary">Appendix C: Glossary</a></li>
  </ul>
</nav>
                    </div>
                </nav>
            </aside>
            

            
            <div class="docs-main">
                
                <nav class="breadcrumbs">
                    <a href="../../../../hi/">Home</a>
                    <span class="separator">/</span>
                    <a href="../../../../hi/docs/">Docs</a>
                    
                        
                            <span class="separator">/</span>
                            <a href="../../../../hi/docs/specs/">Specifications</a>
                        
                    
                    <span class="separator">/</span>
                    <span class="current">ECIES-X25519-AEAD-Ratchet (क्रमिक कुंजी-परिवर्तन तंत्र) एन्क्रिप्शन विनिर्देश</span>
                </nav>

                
<div class="translation-disclaimer" role="note">
    <span class="disclaimer-message">यह अनुवाद मशीन लर्निंग का उपयोग करके उत्पन्न किया गया था और 100% सटीक नहीं हो सकता है।</span>
    
    
    <a href="../../../../en/docs/specs/ecies/" class="disclaimer-link">अंग्रेज़ी संस्करण देखें</a>
    
</div>



                
                <header class="article-header">
                    <h1 class="article-title">ECIES-X25519-AEAD-Ratchet (क्रमिक कुंजी-परिवर्तन तंत्र) एन्क्रिप्शन विनिर्देश</h1>
                    
                        <p class="article-description">I2P के लिए एलिप्टिक कर्व इंटीग्रेटेड एन्क्रिप्शन स्कीम (X25519 &#43; AEAD)</p>
                    
                    <div class="article-meta">
                        
                            <span class="meta-item">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                                    <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2"/>
                                    <path d="M12 6v6l4 2" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                                </svg>
                                Updated: 2025-10
                            </span>
                        
                        
                            <span class="meta-item">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                                    <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" stroke="currentColor" stroke-width="2"/>
                                </svg>
                                Accurate for: 2.10.0
                            </span>
                        
                    </div>
                </header>

                
                <article class="article-content">
                    <h2 id="अवलकन">अवलोकन</h2>
<h3 id="उददशय">उद्देश्य</h3>
<p>ECIES-X25519-AEAD-Ratchet I2P का आधुनिक एंड-टू-एंड एन्क्रिप्शन प्रोटोकॉल है, जो पुराने ElGamal/AES+SessionTags सिस्टम की जगह लेता है। यह forward secrecy (कुंजियाँ बाद में लीक होने पर भी पूर्व संदेश गोपनीय रहते हैं), प्रमाणीकृत एन्क्रिप्शन, और प्रदर्शन व सुरक्षा में उल्लेखनीय सुधार प्रदान करता है।</p>
<h3 id="elgamalaessessiontags-क-तलन-म-मखय-सधर">ElGamal/AES+SessionTags की तुलना में मुख्य सुधार</h3>
<ul>
<li><strong>छोटी कुंजियाँ</strong>: 32-बाइट कुंजियाँ बनाम 256-बाइट ElGamal पब्लिक कुंजियाँ (87.5% कमी)</li>
<li><strong>Forward Secrecy (आगे की गोपनीयता)</strong>: DH ratcheting (क्रमिक कुंजी नवीनीकरण) के माध्यम से हासिल (पुराने प्रोटोकॉल में उपलब्ध नहीं)</li>
<li><strong>आधुनिक क्रिप्टोग्राफ़ी</strong>: X25519 DH, ChaCha20-Poly1305 AEAD (Associated Data सहित प्रमाणित एन्क्रिप्शन), SHA-256</li>
<li><strong>प्रमाणित एन्क्रिप्शन</strong>: AEAD संरचना के माध्यम से अंतर्निर्मित प्रमाणीकरण</li>
<li><strong>Bidirectional Protocol (द्विदिश प्रोटोकॉल)</strong>: युग्मित inbound/outbound सेशन बनाम एकदिश पुराना प्रोटोकॉल</li>
<li><strong>कुशल टैग</strong>: 8-बाइट सेशन टैग बनाम 32-बाइट टैग (75% कमी)</li>
<li><strong>Traffic Obfuscation (ट्रैफ़िक अस्पष्टता)</strong>: Elligator2 encoding से हैंडशेक्स रैंडम से अप्रभेद्य हो जाते हैं</li>
</ul>
<h3 id="परनयजन-सथत">परिनियोजन स्थिति</h3>
<ul>
<li><strong>प्रारंभिक रिलीज़</strong>: संस्करण 0.9.46 (May 25, 2020)</li>
<li><strong>नेटवर्क परिनियोजन</strong>: 2020 तक पूर्ण</li>
<li><strong>वर्तमान स्थिति</strong>: परिपक्व, व्यापक रूप से परिनियोजित (प्रोडक्शन में 5+ वर्ष)</li>
<li><strong>Router समर्थन</strong>: संस्करण 0.9.46 या उच्चतर आवश्यक</li>
<li><strong>Floodfill आवश्यकताएँ</strong>: एन्क्रिप्टेड लुकअप्स हेतु लगभग 100% अपनाने की आवश्यकता</li>
</ul>
<h3 id="करयनवयन-सथत">कार्यान्वयन स्थिति</h3>
<p><strong>पूर्णतः कार्यान्वित:</strong> - New Session (NS) संदेश बाइंडिंग सहित - New Session Reply (NSR) संदेश - Existing Session (ES) संदेश - DH ratchet मेकैनिज़्म (Diffie–Hellman आधारित कुंजी-रोटेशन तंत्र) - सेशन टैग और सिमेट्रिक की रैचेट्स - DateTime, NextKey, ACK, ACK Request, Garlic Clove (I2P &lsquo;garlic&rsquo; संदेश का उप-घटक), और Padding ब्लॉक्स</p>
<p><strong>लागू नहीं (संस्करण 0.9.50 तक):</strong> - MessageNumbers ब्लॉक (type 6) - Options ब्लॉक (type 5) - Termination ब्लॉक (type 4) - प्रोटोकॉल-स्तरीय स्वचालित प्रतिक्रियाएँ - शून्य स्थिर कुंजी मोड - मल्टीकास्ट सत्र</p>
<p><strong>नोट</strong>: संस्करण 1.5.0 से 2.10.0 तक (2021–2025) के लिए कार्यान्वयन स्थिति का सत्यापन आवश्यक है, क्योंकि कुछ सुविधाएँ जोड़ी गई हो सकती हैं।</p>
<hr>
<h2 id="परटकल-क-बनयद">प्रोटोकॉल की बुनियाद</h2>
<h3 id="noise-protocol-framework-करपटगरफ-म-हडशक-और-कज-सहमत-परटकल-डजइन-करन-क-एक-ढच">Noise Protocol Framework (क्रिप्टोग्राफी में हैंडशेक और कुंजी-सहमति प्रोटोकॉल डिज़ाइन करने का एक ढांचा)</h3>
<p>ECIES-X25519-AEAD-Ratchet <a href="https://noiseprotocol.org/">Noise Protocol Framework</a>
 (Revision 34, 2018-07-11) पर आधारित है, विशेष रूप से <strong>IK</strong> (परस्परक्रियात्मक, ज्ञात दूरस्थ स्थिर कुंजी) हैंडशेक पैटर्न पर, और इसमें I2P-विशिष्ट विस्तार शामिल हैं।</p>
<h3 id="noise-protocol-पहचनकरत-noise-protocol-एक-करपटगरफक-हडशक-ढच">Noise Protocol पहचानकर्ता (Noise Protocol: एक क्रिप्टोग्राफ़िक हैंडशेक ढांचा)</h3>
<pre tabindex="0"><code>Noise_IKelg2+hs2_25519_ChaChaPoly_SHA256
</code></pre><p><strong>पहचानकर्ता घटक:</strong> - <code>Noise</code> - आधारभूत फ्रेमवर्क - <code>IK</code> - ज्ञात दूरस्थ स्थिर कुंजी के साथ इंटरैक्टिव हैंडशेक पैटर्न - <code>elg2</code> - अस्थायी कुंजियों के लिए Elligator2 एन्कोडिंग (I2P विस्तार) - <code>+hs2</code> - दूसरे संदेश से पहले टैग को मिलाने के लिए MixHash कॉल किया जाता है (I2P विस्तार) - <code>25519</code> - X25519 Diffie-Hellman फ़ंक्शन - <code>ChaChaPoly</code> - ChaCha20-Poly1305 AEAD साइफ़र (संबद्ध डेटा सहित प्रमाणित एन्क्रिप्शन) - <code>SHA256</code> - SHA-256 हैश फ़ंक्शन</p>
<h3 id="noise-करपटगरफक-परटकल-फरमवरक-हडशक-पटरन">Noise (क्रिप्टोग्राफ़िक प्रोटोकॉल फ्रेमवर्क) हैंडशेक पैटर्न</h3>
<p><strong>IK पैटर्न संकेतन:</strong></p>
<pre tabindex="0"><code>&lt;- s                    (Bob&#39;s static key known to Alice)
...
-&gt; e, es, s, ss         (Alice sends ephemeral, DH es, static key, DH ss)
&lt;- e, ee, se            (Bob sends ephemeral, DH ee, DH se)
</code></pre><p><strong>टोकन के अर्थ:</strong> - <code>e</code> - अस्थायी कुंजी प्रेषण - <code>s</code> - स्थिर कुंजी प्रेषण - <code>es</code> - Alice की अस्थायी कुंजी और Bob की स्थिर कुंजी के बीच DH (Diffie-Hellman कुंजी विनिमय) - <code>ss</code> - Alice की स्थिर कुंजी और Bob की स्थिर कुंजी के बीच DH - <code>ee</code> - Alice की अस्थायी कुंजी और Bob की अस्थायी कुंजी के बीच DH - <code>se</code> - Bob की स्थिर कुंजी और Alice की अस्थायी कुंजी के बीच DH</p>
<h3 id="noise-सरकष-गणधरम">Noise सुरक्षा गुणधर्म</h3>
<p>Noise की शब्दावली में, IK पैटर्न प्रदान करता है:</p>
<table style="width:100%; border-collapse:collapse; margin-bottom:1.5rem;">
  <thead>
    <tr>
      <th style="border:1px solid var(--color-border); padding:0.5rem; background:var(--color-bg-secondary); text-align:left;">Message</th>
      <th style="border:1px solid var(--color-border); padding:0.5rem; background:var(--color-bg-secondary); text-align:left;">Authentication Level</th>
      <th style="border:1px solid var(--color-border); padding:0.5rem; background:var(--color-bg-secondary); text-align:left;">Confidentiality Level</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">Message&nbsp;1 (NS)</td>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">Level&nbsp;1 (sender auth, KCI vulnerable)</td>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">Level&nbsp;2 (weak forward secrecy)</td>
    </tr>
    <tr>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">Message&nbsp;2 (NSR)</td>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">Level&nbsp;2 (mutual auth)</td>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">Level&nbsp;4 (weak forward secrecy)</td>
    </tr>
    <tr>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">Transport (ES)</td>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">Level&nbsp;2 (mutual auth)</td>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">Level&nbsp;5 (strong forward secrecy)</td>
    </tr>
  </tbody>
</table>
**प्रमाणीकरण स्तर:** - **स्तर 1**: पेलोड का प्रमाणीकरण इस रूप में होता है कि वह प्रेषक की स्थिर कुंजी के स्वामी का है, लेकिन Key Compromise Impersonation (KCI, कुंजी समझौता प्रतिरूपण) के प्रति संवेदनशील - **स्तर 2**: NSR के बाद KCI हमलों के प्रति प्रतिरोधी
<p><strong>गोपनीयता स्तर:</strong> - <strong>स्तर 2</strong>: यदि प्रेषक की स्थिर कुंजी बाद में समझौता हो जाती है, तो Forward secrecy (आगे की गोपनीयता) - <strong>स्तर 4</strong>: यदि प्रेषक की अस्थायी कुंजी बाद में समझौता हो जाती है, तो Forward secrecy - <strong>स्तर 5</strong>: दोनों अस्थायी कुंजियों के हटाए जाने के बाद पूर्ण Forward secrecy</p>
<h3 id="ik-और-xk-क-बच-अतर">IK और XK के बीच अंतर</h3>
<p>IK पैटर्न, NTCP2 और SSU2 में प्रयुक्त XK पैटर्न से भिन्न है:</p>
<ol>
<li><strong>चार DH ऑपरेशन्स</strong>: IK 4 DH ऑपरेशन्स (es, ss, ee, se) का उपयोग करता है, जबकि XK में 3 होते हैं</li>
<li><strong>तुरंत प्रमाणीकरण</strong>: पहले संदेश में Alice का प्रमाणीकरण हो जाता है (प्रमाणीकरण स्तर 1)</li>
<li><strong>तेज़ Forward Secrecy (forward secrecy: भविष्य में कुंजियाँ लीक होने पर भी पुराने संदेश सुरक्षित रहते हैं)</strong>: दूसरे संदेश (1-RTT) के बाद पूर्ण forward secrecy (स्तर 5) प्राप्त हो जाती है</li>
<li><strong>ट्रेड-ऑफ</strong>: पहले संदेश का पेलोड forward-secret नहीं है (जबकि XK में सभी पेलोड forward-secret होते हैं)</li>
</ol>
<p><strong>सारांश</strong>: IK (एक हैंडशेक पैटर्न) Bob की प्रतिक्रिया की 1-RTT (एक राउंड-ट्रिप में) डिलीवरी को पूर्ण forward secrecy (आगे की गोपनीयता) के साथ सक्षम करता है, जिसकी कीमत यह है कि प्रारंभिक अनुरोध में forward secrecy नहीं होती।</p>
<h3 id="signal-double-ratchet-डबल-रचट-एलगरदम-क-अवधरणए">Signal Double Ratchet (डबल रैचेट एल्गोरिद्म) की अवधारणाएँ</h3>
<p>ECIES (Elliptic Curve Integrated Encryption Scheme — दीर्घवृत्तीय वक्र एकीकृत एन्क्रिप्शन योजना) <a href="https://signal.org/docs/specifications/doubleratchet/">Signal डबल रैचेट एल्गोरिथ्म</a>
 से अवधारणाएँ सम्मिलित करता है:</p>
<ul>
<li><strong>DH Ratchet</strong>: (Diffie-Hellman आधारित रैचेट तंत्र) नियमित अंतराल पर नई DH कुंजियों का आदान-प्रदान करके forward secrecy (आगत गोपनीयता) प्रदान करता है</li>
<li><strong>Symmetric Key Ratchet</strong>: (सममित-कुंजी रैचेट तंत्र) प्रत्येक संदेश के लिए नई सेशन कुंजियाँ व्युत्पन्न करता है</li>
<li><strong>Session Tag Ratchet</strong>: (सेशन टैग रैचेट तंत्र) नियतात्मक रूप से एक-बार-उपयोग वाले सेशन टैग उत्पन्न करता है</li>
</ul>
<p><strong>Signal से मुख्य अंतर:</strong> - <strong>कम बार होने वाला Ratcheting</strong> (कुंजी-अद्यतन शृंखला प्रक्रिया): I2P केवल आवश्यकता पड़ने पर ही ratchet करता है (टैग लगभग समाप्त होने पर या नीति के अनुसार) - <strong>Header Encryption के बजाय Session Tags</strong> (सत्र टैग): एन्क्रिप्टेड हेडर के बजाय नियतात्मक टैग का प्रयोग करता है - <strong>Explicit ACKs</strong> (स्वीकृतियाँ): केवल रिवर्स ट्रैफिक पर निर्भर रहने के बजाय इन-बैंड ACK ब्लॉक्स का उपयोग करता है - <strong>अलग Tag और Key Ratchets</strong>: रिसीवर के लिए अधिक कुशल (कुंजी गणना को टाल सकता है)</p>
<h3 id="noise-करपटगरफक-परटकल-फरमवरक-क-लए-i2p-वसतर">Noise (क्रिप्टोग्राफिक प्रोटोकॉल फ्रेमवर्क) के लिए I2P विस्तारों</h3>
<ol>
<li><strong>Elligator2 Encoding</strong>: क्षणिक कुंजियाँ इस प्रकार एन्कोड की जाती हैं कि वे यादृच्छिक से अप्रभेद्य हों</li>
<li><strong>NSR से पहले टैग जोड़ा गया</strong>: सहसंबंध के लिए NSR संदेश से पहले सेशन टैग जोड़ा गया</li>
<li><strong>परिभाषित पेलोड फ़ॉर्मेट</strong>: सभी संदेश प्रकारों के लिए ब्लॉक-आधारित पेलोड संरचना</li>
<li><strong>I2NP एन्कैप्सुलेशन</strong>: सभी संदेश I2NP Garlic Message हेडर में लपेटे जाते हैं</li>
<li><strong>अलग डेटा चरण</strong>: ट्रांसपोर्ट संदेश (ES) मानक Noise (क्रिप्टोग्राफ़िक हैंडशेक प्रोटोकॉल) डेटा चरण से अलग हो जाते हैं</li>
</ol>
<hr>
<h2 id="करपटगरफ-क-मल-घटक">क्रिप्टोग्राफी के मूल घटक</h2>
<h3 id="x25519-डफ-हलमन">X25519 डिफ़ी-हेलमैन</h3>
<p><strong>विनिर्देश</strong>: <a href="https://tools.ietf.org/html/rfc7748">RFC 7748</a>
</p>
<p><strong>मुख्य विशेषताएँ:</strong> - <strong>निजी कुंजी का आकार</strong>: 32 बाइट - <strong>सार्वजनिक कुंजी का आकार</strong>: 32 बाइट - <strong>साझा रहस्य का आकार</strong>: 32 बाइट - <strong>Endianness</strong> (बाइट क्रम): Little-endian (निम्नतम बाइट पहले) - <strong>वक्र</strong>: Curve25519</p>
<p><strong>संचालन:</strong></p>
<h3 id="x25519-generate_private">X25519 GENERATE_PRIVATE()</h3>
<p>एक यादृच्छिक 32-बाइट निजी कुंजी उत्पन्न करता है:</p>
<pre tabindex="0"><code>privkey = CSRNG(32)
</code></pre><h3 id="x25519-derive_publicprivkey">X25519 DERIVE_PUBLIC(privkey)</h3>
<p>संबंधित सार्वजनिक कुंजी व्युत्पन्न करता है:</p>
<pre tabindex="0"><code>pubkey = curve25519_scalarmult_base(privkey)
</code></pre><p>32-बाइट little-endian (जहाँ सबसे कम महत्वपूर्ण बाइट पहले होती है) सार्वजनिक कुंजी वापस करता है।</p>
<h3 id="x25519-dhprivkey-pubkey">X25519 DH(privkey, pubkey)</h3>
<p>Diffie-Hellman key agreement (कुंजी-सहमति प्रोटोकॉल) निष्पादित करता है:</p>
<pre tabindex="0"><code>sharedSecret = curve25519_scalarmult(privkey, pubkey)
</code></pre><p>32-बाइट का साझा रहस्य लौटाता है।</p>
<p><strong>सुरक्षा नोट</strong>: कार्यान्वयनकर्ताओं को यह सत्यापित करना अनिवार्य है कि shared secret (साझा गोपनीय मान) सभी शून्य न हो (कमज़ोर कुंजी)। ऐसा होने पर अस्वीकार करें और हैंडशेक (प्रारंभिक आदान-प्रदान) रद्द कर दें।</p>
<h3 id="chacha20-poly1305-aead-सबदध-डट-क-सथ-परमणत-एनकरपशन">ChaCha20-Poly1305 AEAD (संबद्ध डेटा के साथ प्रमाणित एन्क्रिप्शन)</h3>
<p><strong>विनिर्देश</strong>: <a href="https://tools.ietf.org/html/rfc7539">RFC 7539</a>
 अनुभाग 2.8</p>
<p><strong>पैरामीटर्स:</strong> - <strong>कुंजी आकार</strong>: 32 बाइट (256 बिट) - <strong>नॉन्स आकार</strong>: 12 बाइट (96 बिट) - <strong>MAC आकार</strong>: 16 बाइट (128 बिट) - <strong>ब्लॉक आकार</strong>: 64 बाइट (आंतरिक)</p>
<p><strong>Nonce (एक बार प्रयुक्त मान) का प्रारूप:</strong></p>
<pre tabindex="0"><code>Byte 0-3:   0x00 0x00 0x00 0x00  (always zero)
Byte 4-11:  Little-endian counter (message number N)
</code></pre><p><strong>AEAD (Authenticated Encryption with Associated Data; प्रमाणित एन्क्रिप्शन विद संबद्ध डेटा) संरचना:</strong></p>
<p>AEAD (Authenticated Encryption with Associated Data, संबद्ध डेटा सहित प्रमाणीकृत एन्क्रिप्शन) ChaCha20 stream cipher को Poly1305 MAC के साथ संयोजित करता है:</p>
<ol>
<li>कुंजी और nonce (एक-बार प्रयुक्त संख्या) से ChaCha20 keystream (कुंजी-धारा) उत्पन्न करें</li>
<li>plaintext (साधारण पाठ) को keystream के साथ XOR (एक्सक्लूसिव-OR) द्वारा एन्क्रिप्ट करें</li>
<li>(associated data (संलग्न डेटा) || ciphertext (कूटपाठ)) पर Poly1305 MAC (संदेश प्रमाणीकरण कोड) की गणना करें</li>
<li>ciphertext के अंत में 16-बाइट MAC जोड़ें</li>
</ol>
<h3 id="chacha20-poly1305-encryptk-n-plaintext-ad">ChaCha20-Poly1305 ENCRYPT(k, n, plaintext, ad)</h3>
<p>प्रामाणीकरण के साथ सादा पाठ को एन्क्रिप्ट करता है:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># Inputs</span>
</span></span><span style="display:flex;"><span>k <span style="color:#f92672">=</span> <span style="color:#ae81ff">32</span><span style="color:#f92672">-</span>byte cipher key
</span></span><span style="display:flex;"><span>n <span style="color:#f92672">=</span> <span style="color:#ae81ff">12</span><span style="color:#f92672">-</span>byte nonce (first <span style="color:#ae81ff">4</span> bytes zero, last <span style="color:#ae81ff">8</span> bytes <span style="color:#f92672">=</span> message number)
</span></span><span style="display:flex;"><span>plaintext <span style="color:#f92672">=</span> data to encrypt (<span style="color:#ae81ff">0</span> to <span style="color:#ae81ff">65519</span> bytes)
</span></span><span style="display:flex;"><span>ad <span style="color:#f92672">=</span> associated data (optional, used <span style="color:#f92672">in</span> MAC calculation)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Output</span>
</span></span><span style="display:flex;"><span>ciphertext <span style="color:#f92672">=</span> chacha20_encrypt(k, n, plaintext)
</span></span><span style="display:flex;"><span>mac <span style="color:#f92672">=</span> poly1305(ad <span style="color:#f92672">||</span> ciphertext, poly1305_key_gen(k, n))
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">return</span> ciphertext <span style="color:#f92672">||</span> mac  <span style="color:#75715e"># Total length = len(plaintext) + 16</span>
</span></span></code></pre></div><p><strong>गुण:</strong> - Ciphertext (एन्क्रिप्ट किया गया पाठ) की लंबाई plaintext (मूल पाठ) जितनी ही होती है (stream cipher (बाइट/बिट धारा पर काम करने वाला सिफर)) - आउटपुट plaintext_length + 16 bytes होता है (इसमें MAC (संदेश प्रमाणीकरण कोड) शामिल है) - यदि key (कुंजी) गोपनीय है तो पूरा आउटपुट यादृच्छिक से अभेद्य होता है - MAC associated data (सहबद्ध डेटा) और ciphertext दोनों को प्रमाणित करता है</p>
<h3 id="chacha20-poly1305-decryptk-n-ciphertext-ad">ChaCha20-Poly1305 DECRYPT(k, n, ciphertext, ad)</h3>
<p>डिक्रिप्ट करता है और प्रमाणीकरण सत्यापित करता है:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># Split ciphertext and MAC</span>
</span></span><span style="display:flex;"><span>ct_without_mac <span style="color:#f92672">=</span> ciphertext[<span style="color:#ae81ff">0</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">16</span>]
</span></span><span style="display:flex;"><span>received_mac <span style="color:#f92672">=</span> ciphertext[<span style="color:#f92672">-</span><span style="color:#ae81ff">16</span>:]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Verify MAC</span>
</span></span><span style="display:flex;"><span>expected_mac <span style="color:#f92672">=</span> poly1305(ad <span style="color:#f92672">||</span> ct_without_mac, poly1305_key_gen(k, n))
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> constant_time_compare(received_mac, expected_mac):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">raise</span> AuthenticationError(<span style="color:#e6db74">&#34;MAC verification failed&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Decrypt</span>
</span></span><span style="display:flex;"><span>plaintext <span style="color:#f92672">=</span> chacha20_decrypt(k, n, ct_without_mac)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">return</span> plaintext
</span></span></code></pre></div><p><strong>महत्वपूर्ण सुरक्षा आवश्यकताएँ:</strong> - Nonces (एक-बार-उपयोग संख्या) प्रत्येक संदेश के लिए उसी कुंजी के साथ अनिवार्य रूप से अद्वितीय हों - Nonces का पुन: उपयोग कदापि नहीं किया जाना चाहिए (पुन: उपयोग करने पर विनाशकारी विफलता) - MAC (संदेश प्रमाणीकरण कोड) सत्यापन में टाइमिंग हमलों को रोकने के लिए constant-time (स्थिर-समय) तुलना का उपयोग करना अनिवार्य है - असफल MAC सत्यापन का परिणाम संदेश के पूर्ण अस्वीकार में होना अनिवार्य है (कोई आंशिक डिक्रिप्शन नहीं)</p>
<h3 id="sha-256-हश-फकशन">SHA-256 हैश फ़ंक्शन</h3>
<p><strong>विनिर्देशन</strong>: NIST FIPS 180-4</p>
<p><strong>विशेषताएँ:</strong> - <strong>आउटपुट आकार</strong>: 32 बाइट (256 बिट) - <strong>ब्लॉक आकार</strong>: 64 बाइट (512 बिट) - <strong>सुरक्षा स्तर</strong>: 128 बिट (टकराव-प्रतिरोध)</p>
<p><strong>संचालन:</strong></p>
<h3 id="sha-256-hp-d">SHA-256 H(p, d)</h3>
<p>personalization string (व्यक्तिकरण स्ट्रिंग) के साथ SHA-256 हैश:</p>
<pre tabindex="0"><code>H(p, d) := SHA256(p || d)
</code></pre><p>जहाँ <code>||</code> संयोजन को दर्शाता है, <code>p</code> personalization string (व्यक्तिकरण स्ट्रिंग) है, और <code>d</code> डेटा है।</p>
<h3 id="sha-256-mixhashd">SHA-256 MixHash(d)</h3>
<p>नए डेटा के साथ चल रहे हैश को अद्यतन करता है:</p>
<pre tabindex="0"><code>h = SHA256(h || d)
</code></pre><p>ट्रांसक्रिप्ट हैश बनाए रखने के लिए पूरे Noise हैंडशेक के दौरान उपयोग किया जाता है।</p>
<h3 id="hkdf-कज-वयतपतत">HKDF कुंजी व्युत्पत्ति</h3>
<p><strong>विनिर्देश</strong>: <a href="https://tools.ietf.org/html/rfc5869">RFC 5869</a>
</p>
<p><strong>विवरण</strong>: SHA-256 का उपयोग करने वाला HMAC (हैश-आधारित संदेश प्रमाणीकरण कोड)-आधारित कुंजी व्युत्पत्ति फ़ंक्शन</p>
<p><strong>पैरामीटर्स:</strong> - <strong>हैश फ़ंक्शन</strong>: HMAC-SHA256 (HMAC-आधारित संदेश प्रमाणीकरण कोड, जो SHA-256 हैश का उपयोग करता है) - <strong>सॉल्ट लंबाई</strong>: अधिकतम 32 बाइट (SHA-256 (256-बिट का सुरक्षित हैश एल्गोरिद्म) आउटपुट आकार) - <strong>आउटपुट लंबाई</strong>: परिवर्तनीय (अधिकतम 255 * 32 बाइट)</p>
<p><strong>HKDF (HMAC-आधारित कुंजी व्युत्पन्न फ़ंक्शन):</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">HKDF</span>(salt, ikm, info, length):
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    Args:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        salt: Salt value (32 bytes max for SHA-256)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        ikm: Input key material (any length)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        info: Context-specific info string
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        length: Desired output length in bytes
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    Returns:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        output: Derived key material (length bytes)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Extract phase</span>
</span></span><span style="display:flex;"><span>    prk <span style="color:#f92672">=</span> HMAC<span style="color:#f92672">-</span>SHA256(salt, ikm)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Expand phase</span>
</span></span><span style="display:flex;"><span>    n <span style="color:#f92672">=</span> ceil(length <span style="color:#f92672">/</span> <span style="color:#ae81ff">32</span>)
</span></span><span style="display:flex;"><span>    t <span style="color:#f92672">=</span> <span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;&#39;</span>
</span></span><span style="display:flex;"><span>    okm <span style="color:#f92672">=</span> <span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;&#39;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">1</span>, n <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>):
</span></span><span style="display:flex;"><span>        t <span style="color:#f92672">=</span> HMAC<span style="color:#f92672">-</span>SHA256(prk, t <span style="color:#f92672">||</span> info <span style="color:#f92672">||</span> byte(i))
</span></span><span style="display:flex;"><span>        okm <span style="color:#f92672">=</span> okm <span style="color:#f92672">||</span> t
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> okm[<span style="color:#ae81ff">0</span>:length]
</span></span></code></pre></div><p><strong>सामान्य उपयोग के पैटर्न:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># Generate two keys (64 bytes total)</span>
</span></span><span style="display:flex;"><span>keydata <span style="color:#f92672">=</span> HKDF(chainKey, sharedSecret, <span style="color:#e6db74">&#34;KDFDHRatchetStep&#34;</span>, <span style="color:#ae81ff">64</span>)
</span></span><span style="display:flex;"><span>nextRootKey <span style="color:#f92672">=</span> keydata[<span style="color:#ae81ff">0</span>:<span style="color:#ae81ff">31</span>]
</span></span><span style="display:flex;"><span>chainKey <span style="color:#f92672">=</span> keydata[<span style="color:#ae81ff">32</span>:<span style="color:#ae81ff">63</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Generate session tag (8 bytes)</span>
</span></span><span style="display:flex;"><span>tagdata <span style="color:#f92672">=</span> HKDF(chainKey, CONSTANT, <span style="color:#e6db74">&#34;SessionTagKeyGen&#34;</span>, <span style="color:#ae81ff">64</span>)
</span></span><span style="display:flex;"><span>nextChainKey <span style="color:#f92672">=</span> tagdata[<span style="color:#ae81ff">0</span>:<span style="color:#ae81ff">31</span>]
</span></span><span style="display:flex;"><span>sessionTag <span style="color:#f92672">=</span> tagdata[<span style="color:#ae81ff">32</span>:<span style="color:#ae81ff">39</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Generate symmetric key (32 bytes)</span>
</span></span><span style="display:flex;"><span>keydata <span style="color:#f92672">=</span> HKDF(chainKey, ZEROLEN, <span style="color:#e6db74">&#34;SymmetricRatchet&#34;</span>, <span style="color:#ae81ff">64</span>)
</span></span><span style="display:flex;"><span>nextChainKey <span style="color:#f92672">=</span> keydata[<span style="color:#ae81ff">0</span>:<span style="color:#ae81ff">31</span>]
</span></span><span style="display:flex;"><span>sessionKey <span style="color:#f92672">=</span> keydata[<span style="color:#ae81ff">32</span>:<span style="color:#ae81ff">63</span>]
</span></span></code></pre></div><p><strong>ECIES में प्रयुक्त इन्फो स्ट्रिंग्स:</strong> - <code>&quot;KDFDHRatchetStep&quot;</code> - DH रैचेट (क्रमिक कुंजी अद्यतन तंत्र) कुंजी व्युत्पत्ति - <code>&quot;TagAndKeyGenKeys&quot;</code> - टैग और कुंजी-श्रृंखला कुंजियों का आरंभिककरण - <code>&quot;STInitialization&quot;</code> - सेशन टैग रैचेट आरंभिककरण - <code>&quot;SessionTagKeyGen&quot;</code> - सेशन टैग उत्पादन - <code>&quot;SymmetricRatchet&quot;</code> - सममित कुंजी उत्पादन - <code>&quot;XDHRatchetTagSet&quot;</code> - DH रैचेट टैगसेट (टैग का समूह) कुंजी - <code>&quot;SessionReplyTags&quot;</code> - NSR टैगसेट उत्पादन - <code>&quot;AttachPayloadKDF&quot;</code> - NSR पेलोड कुंजी व्युत्पत्ति</p>
<h3 id="elligator2-एनकडग">Elligator2 एन्कोडिंग</h3>
<p><strong>उद्देश्य</strong>: X25519 पब्लिक कीज़ को इस तरह एन्कोड करना कि वे समान-वितरित यादृच्छिक 32-बाइट स्ट्रिंग्स से अप्रभेद्य हों।</p>
<p><strong>विनिर्देश</strong>: <a href="https://elligator.cr.yp.to/elligator-20130828.pdf">Elligator2 शोधपत्र</a>
</p>
<p><strong>समस्या</strong>: मानक X25519 (एक ECDH एलिप्टिक-कर्व योजना) सार्वजनिक कुंजियों की संरचना पहचानने योग्य होती है। कोई पर्यवेक्षक इन कुंजियों का पता लगाकर handshake संदेशों की पहचान कर सकता है, भले ही सामग्री एन्क्रिप्टेड हो।</p>
<p><strong>समाधान</strong>: Elligator2 ~50% मान्य X25519 सार्वजनिक कुंजियों और यादृच्छिक दिखने वाली 254-बिट स्ट्रिंगों के बीच bijective mapping (एक-एक तथा सर्व-व्यापी प्रतिचित्रण) प्रदान करता है।</p>
<p><strong>Elligator2 (एक क्रिप्टोग्राफ़िक मैपिंग तकनीक) के साथ कुंजी जनन:</strong></p>
<h3 id="elligator2-generate_private_elg2">Elligator2 GENERATE_PRIVATE_ELG2()</h3>
<p>ऐसी निजी कुंजी उत्पन्न करता है जो Elligator2 (एक क्रिप्टोग्राफ़िक मैपिंग तकनीक) से एन्कोड होने योग्य सार्वजनिक कुंजी पर मैप होती है:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">while</span> <span style="color:#66d9ef">True</span>:
</span></span><span style="display:flex;"><span>    privkey <span style="color:#f92672">=</span> CSRNG(<span style="color:#ae81ff">32</span>)
</span></span><span style="display:flex;"><span>    pubkey <span style="color:#f92672">=</span> DERIVE_PUBLIC(privkey)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Test if public key is Elligator2-encodable</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">try</span>:
</span></span><span style="display:flex;"><span>        encoded <span style="color:#f92672">=</span> ENCODE_ELG2(pubkey)
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Success - this key pair is suitable</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> privkey
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">except</span> NotEncodableError:
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Try again with new random key</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">continue</span>
</span></span></code></pre></div><p><strong>महत्वपूर्ण</strong>: यादृच्छिक रूप से उत्पन्न निजी कुंजियों में से लगभग 50% ऐसी सार्वजनिक कुंजियाँ उत्पन्न करेंगी जिन्हें एन्कोड नहीं किया जा सकता। इन्हें त्याग देना चाहिए और पुनः उत्पन्न करने का प्रयास करना चाहिए।</p>
<p><strong>प्रदर्शन अनुकूलन</strong>: हैंडशेक के दौरान विलंब से बचने के लिए उपयुक्त कुंजी-युग्मों का एक पूल बनाए रखने हेतु पृष्ठभूमि थ्रेड में कुंजियाँ पहले से उत्पन्न करें।</p>
<h3 id="elligator2-encode_elg2pubkey">Elligator2 ENCODE_ELG2(pubkey)</h3>
<p>एक सार्वजनिक कुंजी को 32 यादृच्छिक जैसी दिखने वाली बाइट्स में एन्कोड करता है:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">ENCODE_ELG2</span>(pubkey):
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    Encodes X25519 public key using Elligator2.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    Args:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        pubkey: 32-byte X25519 public key (little-endian)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    Returns:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        encoded: 32-byte encoded key indistinguishable from random
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    Raises:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        NotEncodableError: If pubkey cannot be encoded
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Perform Elligator2 representative calculation</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Returns 254-bit value (31.75 bytes)</span>
</span></span><span style="display:flex;"><span>    encodedKey <span style="color:#f92672">=</span> elligator2_encode(pubkey)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Add 2 random bits to MSB to make full 32 bytes</span>
</span></span><span style="display:flex;"><span>    randomByte <span style="color:#f92672">=</span> CSRNG(<span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>    encodedKey[<span style="color:#ae81ff">31</span>] <span style="color:#f92672">|=</span> (randomByte <span style="color:#f92672">&amp;</span> <span style="color:#ae81ff">0xc0</span>)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> encodedKey
</span></span></code></pre></div><p><strong>एन्कोडिंग विवरण:</strong> - Elligator2 254 बिट उत्पन्न करता है (पूर्ण 256 नहीं) - बाइट 31 के शीर्ष 2 बिट रैंडम पैडिंग होते हैं - परिणाम 32-बाइट स्पेस में समान रूप से वितरित होता है - मान्य X25519 सार्वजनिक कुंजियों में से लगभग 50% को सफलतापूर्वक एन्कोड करता है</p>
<h3 id="elligator2-एक-करपटगरफक-मपग-तकनक-decode_elg2encodedkey">Elligator2 (एक क्रिप्टोग्राफिक मैपिंग तकनीक) DECODE_ELG2(encodedKey)</h3>
<p>डिकोड करने पर मूल सार्वजनिक कुंजी प्राप्त होती है:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">DECODE_ELG2</span>(encodedKey):
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    Decodes Elligator2-encoded key back to X25519 public key.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    Args:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        encodedKey: 32-byte encoded key
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    Returns:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        pubkey: 32-byte X25519 public key (little-endian)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Mask out 2 random padding bits from MSB</span>
</span></span><span style="display:flex;"><span>    encodedKey[<span style="color:#ae81ff">31</span>] <span style="color:#f92672">&amp;=</span> <span style="color:#ae81ff">0x3f</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Perform Elligator2 representative inversion</span>
</span></span><span style="display:flex;"><span>    pubkey <span style="color:#f92672">=</span> elligator2_decode(encodedKey)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> pubkey
</span></span></code></pre></div><p><strong>सुरक्षा गुणधर्म:</strong> - एन्कोडेड कुंजियाँ परिकलनिक रूप से यादृच्छिक बाइट्स से अप्रभेद्य होती हैं - कोई भी सांख्यिकीय परीक्षण Elligator2-एन्कोडेड कुंजियों का विश्वसनीय रूप से पता नहीं लगा सकता - डिकोडिंग नियतात्मक होती है (एक ही एन्कोडेड कुंजी हमेशा वही सार्वजनिक कुंजी उत्पन्न करती है) - एन्कोडिंग एन्कोड करने योग्य उपसमुच्चय में आने वाली ~50% कुंजियों के लिए bijective (एक-एक तथा सर्व-समापी) होती है</p>
<p><strong>कार्यान्वयन नोट्स:</strong> - हैंडशेक के दौरान पुनः-एन्कोडिंग से बचने के लिए सृजन चरण में एन्कोडेड कुंजियाँ संग्रहीत करें - Elligator2 (एक क्रिप्टोग्राफ़िक मैपिंग तकनीक) जनरेशन से प्राप्त अनुपयुक्त कुंजियाँ NTCP2 के लिए उपयोग की जा सकती हैं (जिसमें Elligator2 की आवश्यकता नहीं होती) - प्रदर्शन के लिए पृष्ठभूमि में कुंजी सृजन आवश्यक है - 50% अस्वीकृति दर के कारण औसत सृजन समय दोगुना हो जाता है</p>
<hr>
<h2 id="सदश-पररप">संदेश प्रारूप</h2>
<h3 id="अवलकन-1">अवलोकन</h3>
<p>ECIES (Elliptic Curve Integrated Encryption Scheme - दीर्घवृत्तीय वक्र एकीकृत एन्क्रिप्शन योजना) तीन संदेश प्रकार परिभाषित करता है:</p>
<ol>
<li><strong>नया सत्र (NS)</strong>: Alice द्वारा Bob को भेजा गया प्रारंभिक हैंडशेक संदेश</li>
<li><strong>नया सत्र प्रत्युत्तर (NSR)</strong>: Bob द्वारा Alice को भेजा गया हैंडशेक प्रत्युत्तर</li>
<li><strong>मौजूदा सत्र (ES)</strong>: आगे के सभी संदेश, दोनों दिशाओं में</li>
</ol>
<p>सभी संदेश I2NP Garlic Message फ़ॉर्मैट में एनकैप्सुलेट किए जाते हैं, और उन पर अतिरिक्त एन्क्रिप्शन परतें लागू की जाती हैं।</p>
<h3 id="i2np-garlic-message-कटनर">I2NP Garlic Message कंटेनर</h3>
<p>सभी ECIES (Elliptic Curve Integrated Encryption Scheme—अण्डवक्र समेकित एन्क्रिप्शन योजना) संदेश मानक I2NP Garlic Message हेडर में लिपटे होते हैं:</p>
<pre tabindex="0"><code>+----+----+----+----+----+----+----+----+
|type|      msg_id       |  expiration   |
+----+----+----+----+----+----+----+----+
                         |  size   |chks|
+----+----+----+----+----+----+----+----+
|      length       |                   |
+----+----+----+----+                   +
|          encrypted data               |
~                                       ~
</code></pre><p><strong>फ़ील्ड्स:</strong> - <code>type</code>: 0x26 (Garlic Message) - <code>msg_id</code>: 4-बाइट I2NP संदेश ID - <code>expiration</code>: 8-बाइट Unix टाइमस्टैम्प (मिलीसेकंड) - <code>size</code>: 2-बाइट पेलोड का आकार - <code>chks</code>: 1-बाइट चेकसम - <code>length</code>: 4-बाइट एन्क्रिप्टेड डेटा की लंबाई - <code>encrypted data</code>: ECIES-एन्क्रिप्टेड पेलोड</p>
<p><strong>उद्देश्य</strong>: I2NP-स्तर पर संदेश पहचान और रूटिंग प्रदान करता है। <code>length</code> फ़ील्ड प्राप्तकर्ताओं को कुल एन्क्रिप्टेड पेलोड का आकार जानने की अनुमति देती है।</p>
<h3 id="नय-सतर-ns-सदश">नया सत्र (NS) संदेश</h3>
<p>New Session संदेश Alice से Bob तक एक नया सेशन आरंभ करता है। यह तीन प्रकारों में आता है:</p>
<ol>
<li><strong>Binding सहित</strong> (1b): द्विदिश संचार के लिए Alice की स्थिर कुंजी शामिल करता है (Binding: पहचान/कुंजी को बाँधकर प्रमाणित संबंध)</li>
<li><strong>Binding रहित</strong> (1c): एक-दिशा संचार के लिए स्थिर कुंजी को छोड़ देता है</li>
<li><strong>एक-बार</strong> (1d): सत्र स्थापना के बिना एकल-संदेश मोड</li>
</ol>
<h3 id="binding-बइडग-सहत-ns-सदश-परकर-1b">Binding (बाइंडिंग) सहित NS संदेश (प्रकार 1b)</h3>
<p><strong>उपयोग मामला</strong>: स्ट्रीमिंग, उत्तर-योग्य डेटाग्राम, उत्तर की आवश्यकता वाले किसी भी प्रोटोकॉल</p>
<p><strong>कुल लंबाई</strong>: 96 + payload_length बाइट्स</p>
<p><strong>प्रारूप</strong>:</p>
<pre tabindex="0"><code>+----+----+----+----+----+----+----+----+
|                                       |
+                                       +
|   New Session Ephemeral Public Key    |
+             32 bytes                  +
|     Encoded with Elligator2           |
+                                       +
|                                       |
+----+----+----+----+----+----+----+----+
|                                       |
+         Static Key Section            +
|       ChaCha20 encrypted data         |
+            32 bytes                   +
|                                       |
+                                       +
|                                       |
+----+----+----+----+----+----+----+----+
|  Poly1305 Message Authentication Code |
+    (MAC) for Static Key Section       +
|             16 bytes                  |
+----+----+----+----+----+----+----+----+
|                                       |
+            Payload Section            +
|       ChaCha20 encrypted data         |
~          Variable length              ~
|                                       |
+                                       +
|                                       |
+----+----+----+----+----+----+----+----+
|  Poly1305 Message Authentication Code |
+         (MAC) for Payload Section     +
|             16 bytes                  |
+----+----+----+----+----+----+----+----+
</code></pre><p><strong>फ़ील्ड विवरण:</strong></p>
<p><strong>क्षणिक सार्वजनिक कुंजी</strong> (32 बाइट, स्पष्ट-पाठ): - ऐलिस की एक-बार उपयोग वाली X25519 सार्वजनिक कुंजी - Elligator2 के साथ एन्कोड की गई (यादृच्छिक से अप्रभेद्य) - प्रत्येक NS message (NS संदेश) के लिए नई उत्पन्न की जाती है (कभी पुनः उपयोग नहीं होती) - लिटिल-एंडियन प्रारूप</p>
<p><strong>स्थैतिक कुंजी अनुभाग</strong> (32 बाइट एन्क्रिप्टेड, 48 बाइट MAC (Message Authentication Code—संदेश प्रमाणीकरण कोड) के साथ): - Alice की X25519 (एलिप्टिक-कर्व कुंजी-अदला-बदली एल्गोरिथ्म) स्थैतिक सार्वजनिक कुंजी (32 बाइट) शामिल है - ChaCha20 (स्ट्रीम साइफर) से एन्क्रिप्टेड - Poly1305 MAC (16 बाइट) से प्रमाणीकृत - Bob द्वारा सत्र को Alice के destination से बाँधने के लिए प्रयुक्त</p>
<p><strong>पेलोड अनुभाग</strong> (परिवर्ती लंबाई में एन्क्रिप्टेड, +16 बाइट MAC): - इसमें garlic cloves (garlic संदेश के उप-संदेश) और अन्य ब्लॉक शामिल होते हैं - पहले ब्लॉक के रूप में DateTime ब्लॉक शामिल होना चाहिए - सामान्यतः एप्लिकेशन डेटा वाले Garlic Clove blocks शामिल होते हैं - तुरंत ratchet (कुंजी-परिवर्तन तंत्र) के लिए NextKey ब्लॉक शामिल हो सकता है - ChaCha20 से एन्क्रिप्टेड - Poly1305 MAC (16 बाइट) से प्रमाणीकरण</p>
<p><strong>सुरक्षा गुणधर्म:</strong> - अस्थायी कुंजी forward secrecy (आगे की गोपनीयता) घटक प्रदान करती है - स्थिर कुंजी Alice का प्रमाणीकरण करती है (गंतव्य से बाइंडिंग) - डोमेन पृथक्करण के लिए दोनों हिस्सों में अलग-अलग MACs (Message Authentication Codes) हैं - संपूर्ण हैंडशेक 2 DH ऑपरेशन (es, ss) करता है</p>
<h3 id="बइडग-क-बन-ns-सदश-परकर-1c">बाइंडिंग के बिना NS संदेश (प्रकार 1c)</h3>
<p><strong>उपयोग मामला</strong>: Raw datagrams (कनेक्शन-रहित पैकेट-आधारित संदेश) जहाँ किसी उत्तर की न अपेक्षा होती है और न इच्छा</p>
<p><strong>कुल लंबाई</strong>: 96 + payload_length बाइट्स</p>
<p><strong>प्रारूप</strong>:</p>
<pre tabindex="0"><code>+----+----+----+----+----+----+----+----+
|                                       |
+                                       +
|   New Session Ephemeral Public Key    |
+             32 bytes                  +
|     Encoded with Elligator2           |
+                                       +
|                                       |
+----+----+----+----+----+----+----+----+
|                                       |
+           Flags Section               +
|       ChaCha20 encrypted data         |
+            32 bytes                   +
|           All zeros                   |
+                                       +
|                                       |
+----+----+----+----+----+----+----+----+
|  Poly1305 Message Authentication Code |
+         (MAC) for above section       +
|             16 bytes                  |
+----+----+----+----+----+----+----+----+
|                                       |
+            Payload Section            +
|       ChaCha20 encrypted data         |
~          Variable length              ~
|                                       |
+                                       +
|                                       |
+----+----+----+----+----+----+----+----+
|  Poly1305 Message Authentication Code |
+         (MAC) for Payload Section     +
|             16 bytes                  |
+----+----+----+----+----+----+----+----+
</code></pre><p><strong>मुख्य अंतर</strong>: Flags Section (फ़्लैग्स अनुभाग) में स्थिर कुंजी की जगह शून्य के 32 बाइट्स होते हैं।</p>
<p><strong>Detection</strong>: Bob 32-बाइट सेक्शन को डिक्रिप्ट करके और यह जांचकर कि सभी बाइट शून्य हैं, संदेश का प्रकार निर्धारित करता है: - सभी शून्य → Unbound session (बाइंड न किया हुआ सत्र) (प्रकार 1c) - गैर-शून्य → Bound session with static key (स्थिर कुंजी वाला बाउंड सत्र) (प्रकार 1b)</p>
<p><strong>गुण:</strong> - static key (स्थिर कुंजी) न होने का मतलब Alice के गंतव्य से कोई बाइंडिंग नहीं होती - Bob उत्तर नहीं भेज सकता (कोई गंतव्य ज्ञात नहीं) - केवल 1 DH (Diffie-Hellman) ऑपरेशन (es) करता है - Noise &ldquo;N&rdquo; pattern (Noise प्रोटोकॉल का &ldquo;N&rdquo; पैटर्न) का अनुसरण करता है, &ldquo;IK&rdquo; के बजाय - जब उत्तर की कभी आवश्यकता नहीं होती, तब अधिक कुशल</p>
<p><strong>फ्लैग्स अनुभाग</strong> (भविष्य में उपयोग के लिए सुरक्षित): वर्तमान में सभी मान शून्य हैं। भविष्य के संस्करणों में feature negotiation (फ़ीचर पर सहमति स्थापित करने की प्रक्रिया) के लिए उपयोग किया जा सकता है।</p>
<h3 id="ns-एक-बर-क-सदश-परकर-1d">NS एक-बार का संदेश (प्रकार 1d)</h3>
<p><strong>उपयोग परिदृश्य</strong>: बिना सत्र के और बिना उत्तर की अपेक्षा के एकल गुमनाम संदेश</p>
<p><strong>कुल लंबाई</strong>: 96 + payload_length बाइट्स</p>
<p><strong>प्रारूप</strong>: बाइंडिंग के बिना NS के समान (type 1c)</p>
<p><strong>अंतर</strong>:  - Type 1c उसी सत्र में कई संदेश भेज सकता है (आगे ES संदेश आते हैं) - Type 1d सत्र स्थापना के बिना ठीक एक संदेश भेजता है - व्यवहार में, कार्यान्वयन प्रारम्भ में इन्हें समान रूप से मान सकते हैं</p>
<p><strong>विशेषताएँ:</strong> - अधिकतम गुमनामी (कोई स्थिर कुंजी नहीं, कोई सत्र नहीं) - किसी भी पक्ष द्वारा सत्र स्थिति संग्रहीत नहीं की जाती - Noise &ldquo;N&rdquo; पैटर्न का अनुसरण करता है - एकल DH (Diffie-Hellman) ऑपरेशन (es)</p>
<h3 id="नय-सशन-उततर-nsr-सदश">नया सेशन उत्तर (NSR) संदेश</h3>
<p>Bob, Alice के NS संदेश के जवाब में, एक या अधिक NSR संदेश भेजता है। NSR, Noise IK handshake (प्रारंभिक सुरक्षित हैंडशेक) को पूर्ण करता है और द्विदिश सत्र स्थापित करता है।</p>
<p><strong>कुल लंबाई</strong>: 72 + payload_length बाइट्स</p>
<p><strong>प्रारूप</strong>:</p>
<pre tabindex="0"><code>+----+----+----+----+----+----+----+----+
|       Session Tag   8 bytes           |
+----+----+----+----+----+----+----+----+
|                                       |
+        Ephemeral Public Key           +
|                                       |
+            32 bytes                   +
|     Encoded with Elligator2           |
+                                       +
|                                       |
+----+----+----+----+----+----+----+----+
|  Poly1305 Message Authentication Code |
+  (MAC) for Key Section (empty)        +
|             16 bytes                  |
+----+----+----+----+----+----+----+----+
|                                       |
+            Payload Section            +
|       ChaCha20 encrypted data         |
~          Variable length              ~
|                                       |
+                                       +
|                                       |
+----+----+----+----+----+----+----+----+
|  Poly1305 Message Authentication Code |
+         (MAC) for Payload Section     +
|             16 bytes                  |
+----+----+----+----+----+----+----+----+
</code></pre><p><strong>फ़ील्ड विवरण:</strong></p>
<p><strong>सेशन टैग</strong> (8 बाइट, सादा पाठ): - NSR tagset (टैगों का समूह) से उत्पन्न (KDF (Key Derivation Function, कुंजी व्युत्पन्न फलन) अनुभाग देखें) - इस उत्तर को Alice के NS संदेश से संबद्ध करता है - Alice को यह पहचानने देता है कि यह NSR किस NS का उत्तर है - एक-बार उपयोग (कभी पुन: उपयोग नहीं किया जाता)</p>
<p><strong>अस्थायी सार्वजनिक कुंजी</strong> (32 बाइट्स, सादा-पाठ): - बॉब की एक-बार-प्रयोग वाली X25519 (कुंजी-विनिमय वक्र) सार्वजनिक कुंजी - Elligator2 (एन्कोडिंग योजना) से एन्कोड की गई - प्रत्येक NSR संदेश (एक विशेष संदेश प्रकार) के लिए नई उत्पन्न की जाती है - भेजे गए प्रत्येक NSR के लिए अलग होना आवश्यक है</p>
<p><strong>Key Section MAC</strong> (16 बाइट्स): - खाली डेटा (ZEROLEN) को प्रमाणित करता है - Noise IK प्रोटोकॉल (se pattern) का हिस्सा - हैश प्रतिलेख को संबद्ध डेटा के रूप में उपयोग करता है - NSR को NS से बाँधने के लिए अत्यंत महत्वपूर्ण</p>
<p><strong>पेलोड सेक्शन</strong> (परिवर्तनीय लंबाई): - इसमें garlic cloves (गार्लिक संदेश के उपघटक) और ब्लॉक्स शामिल होते हैं - आम तौर पर एप्लिकेशन-लेयर के प्रत्युत्तर शामिल होते हैं - खाली हो सकता है (ACK-only NSR) - अधिकतम आकार: 65519 bytes (65535 - 16 byte MAC)</p>
<p><strong>कई NSR संदेश:</strong></p>
<p>Bob एक NS के प्रत्युत्तर में अनेक NSR संदेश भेज सकता है:</p>
<ul>
<li>प्रत्येक NSR के पास एक अद्वितीय अस्थायी कुंजी होती है</li>
<li>प्रत्येक NSR में एक अद्वितीय session tag (सत्र टैग) होता है</li>
<li>Alice पहले प्राप्त NSR का उपयोग हैंडशेक पूरा करने के लिए करती है</li>
<li>अन्य NSR रिडंडेंसी हैं (पैकेट लॉस की स्थिति में)</li>
</ul>
<p><strong>महत्वपूर्ण समय-क्रम:</strong> - Alice को ES संदेश भेजने से पहले एक NSR (एक संदेश प्रकार) प्राप्त करना चाहिए - Bob को ES संदेश भेजने से पहले एक ES संदेश प्राप्त करना चाहिए - NSR split() ऑपरेशन के माध्यम से द्विदिश सत्र कुंजियाँ स्थापित करता है</p>
<p><strong>सुरक्षा गुणधर्म:</strong> - Noise IK handshake (Noise प्रोटोकॉल का IK हैंडशेक पैटर्न) पूरा करता है - 2 अतिरिक्त DH operations (Diffie-Hellman कुंजी-विनिमय क्रियाएँ) (ee, se) निष्पादित करता है - NS+NSR मिलाकर कुल 4 DH operations - द्विपक्षीय प्रमाणीकरण (स्तर 2) प्राप्त करता है - NSR पेलोड के लिए कमजोर फ़ॉरवर्ड सीक्रेसी (स्तर 4) प्रदान करता है</p>
<h3 id="वदयमन-सतर-es-सदश">विद्यमान सत्र (ES) संदेश</h3>
<p>NS/NSR हैंडशेक के बाद सभी संदेश Existing Session (मौजूदा सत्र) प्रारूप का उपयोग करते हैं। ES संदेशों का उपयोग Alice और Bob दोनों द्वारा द्विदिश रूप से किया जाता है।</p>
<p><strong>कुल लंबाई</strong>: 8 + payload_length + 16 बाइट (न्यूनतम 24 बाइट)</p>
<p><strong>प्रारूप</strong>:</p>
<pre tabindex="0"><code>+----+----+----+----+----+----+----+----+
|       Session Tag   8 bytes           |
+----+----+----+----+----+----+----+----+
|                                       |
+            Payload Section            +
|       ChaCha20 encrypted data         |
~          Variable length              ~
|                                       |
+                                       +
|                                       |
+----+----+----+----+----+----+----+----+
|  Poly1305 Message Authentication Code |
+              (MAC)                    +
|             16 bytes                  |
+----+----+----+----+----+----+----+----+
</code></pre><p><strong>फ़ील्ड विवरण:</strong></p>
<p><strong>Session Tag</strong> (8 बाइट, स्पष्ट-पाठ): - वर्तमान निर्गामी tagset से उत्पन्न - सत्र और संदेश संख्या की पहचान करता है - प्राप्तकर्ता टैग के आधार पर सत्र कुंजी और nonce (एक बार प्रयुक्त होने वाला यादृच्छिक मान) प्राप्त करता है - एक-बार उपयोग (प्रत्येक टैग का ठीक एक बार ही प्रयोग होता है) - प्रारूप: HKDF (HMAC-आधारित कुंजी व्युत्पत्ति फ़ंक्शन) आउटपुट के पहले 8 बाइट</p>
<p><strong>पेलोड अनुभाग</strong> (परिवर्तनीय लंबाई): - इसमें garlic cloves (I2P में &lsquo;garlic encryption&rsquo; के अंदर उप-संदेश इकाइयाँ) और ब्लॉक होते हैं - कोई अनिवार्य ब्लॉक नहीं (खाली हो सकता है) - सामान्य ब्लॉक: Garlic Clove, NextKey, ACK, ACK Request, Padding - अधिकतम आकार: 65519 bytes (65535 - 16 byte MAC)</p>
<p><strong>MAC</strong> (16 बाइट्स): - Poly1305 प्रमाणीकरण टैग - पूरे पेलोड पर गणना की जाती है - संबद्ध डेटा: 8-बाइट का सेशन टैग - सही ढंग से सत्यापित होना आवश्यक है, अन्यथा संदेश अस्वीकार कर दिया जाता है</p>
<p><strong>टैग लुकअप प्रक्रिया:</strong></p>
<ol>
<li>रिसीवर 8-बाइट टैग निकालता है</li>
<li>सभी वर्तमान आगत टैगसेट्स में टैग ढूँढता है</li>
<li>संबद्ध सेशन कुंजी और संदेश संख्या N प्राप्त करता है</li>
<li>नॉन्स (एक-बार प्रयुक्त मान) बनाता है: <code>[0x00, 0x00, 0x00, 0x00, N (8 bytes little-endian)]</code></li>
<li>AEAD (Authenticated Encryption with Associated Data - संबद्ध डेटा सहित प्रमाणीकरणयुक्त एन्क्रिप्शन) का उपयोग करते हुए, टैग को संबद्ध डेटा के रूप में लेकर पेलोड को डिक्रिप्ट करता है</li>
<li>टैगसेट से टैग हटाता है (एक-बार उपयोग)</li>
<li>डिक्रिप्ट किए गए ब्लॉक्स का प्रसंस्करण करता है</li>
</ol>
<p><strong>Session Tag (सत्र टैग) नहीं मिला:</strong></p>
<p>यदि tag किसी भी tagset में नहीं मिलता है: - संभवतः NS संदेश → NS डिक्रिप्शन का प्रयास करें - संभवतः NSR संदेश → NSR डिक्रिप्शन का प्रयास करें - संभवतः out-of-order ES → tagset अपडेट के लिए थोड़ी देर प्रतीक्षा करें - संभवतः रीप्ले हमला → अस्वीकार करें - संभवतः दूषित डेटा → अस्वीकार करें</p>
<p><strong>रिक्त पेलोड:</strong></p>
<p>ES messages (एक विशेष प्रकार के संदेश) में खाली पेलोड (0 बाइट) हो सकते हैं: - जब ACK अनुरोध प्राप्त हो, तो यह स्पष्ट ACK के रूप में कार्य करता है - एप्लिकेशन डेटा के बिना प्रोटोकॉल-स्तर की प्रतिक्रिया प्रदान करता है - फिर भी एक session tag (सत्र टैग) का उपभोग करता है - जब उच्चतर लेयर के पास भेजने के लिए तत्काल डेटा न हो, तब उपयोगी</p>
<p><strong>सुरक्षा विशेषताएँ:</strong> - NSR प्राप्त होने के बाद पूर्ण फॉरवर्ड सीक्रेसी (लेवल 5) - AEAD (एसोसिएटेड डेटा के साथ प्रमाणीकृत एन्क्रिप्शन) के माध्यम से प्रमाणीकृत एन्क्रिप्शन - टैग अतिरिक्त एसोसिएटेड डेटा के रूप में कार्य करता है - ratchet (क्रमिक कुंजी-अपडेट तंत्र) आवश्यक होने से पहले प्रति tagset अधिकतम 65535 संदेश</p>
<hr>
<h2 id="कज-वयतपतत-फलन">कुंजी व्युत्पत्ति फलन</h2>
<p>यह अनुभाग ECIES (दीर्घवृत्तीय वक्र एकीकृत एन्क्रिप्शन योजना) में प्रयुक्त सभी KDF (कुंजी-व्युत्पत्ति फ़ंक्शन) क्रियाओं का प्रलेखन करता है, तथा पूर्ण क्रिप्टोग्राफ़िक व्युत्पत्तियाँ प्रदर्शित करता है।</p>
<h3 id="परतक-वधन-और-सथरक">प्रतीक-विधान और स्थिरांक</h3>
<p><strong>स्थिरांक:</strong> - <code>ZEROLEN</code> - शून्य-लंबाई बाइट ऐरे (रिक्त स्ट्रिंग) - <code>||</code> - संयोजन ऑपरेटर</p>
<p><strong>वेरिएबल्स:</strong> - <code>h</code> - रनिंग हैश ट्रांस्क्रिप्ट (32 बाइट्स) - <code>chainKey</code> - HKDF के लिए चेनिंग की (32 बाइट्स) - <code>k</code> - सममित सिफर कुंजी (32 बाइट्स) - <code>n</code> - Nonce (एक-बार प्रयुक्त यादृच्छिक संख्या) / संदेश संख्या</p>
<p><strong>कुंजियाँ:</strong> - <code>ask</code> / <code>apk</code> - Alice की स्थिर निजी/सार्वजनिक कुंजी - <code>aesk</code> / <code>aepk</code> - Alice की अस्थायी निजी/सार्वजनिक कुंजी - <code>bsk</code> / <code>bpk</code> - Bob की स्थिर निजी/सार्वजनिक कुंजी - <code>besk</code> / <code>bepk</code> - Bob की अस्थायी निजी/सार्वजनिक कुंजी</p>
<h3 id="ns-सदश-क-लए-कज-वयतपतत-फलन">NS संदेश के लिए कुंजी व्युत्पत्ति फलन</h3>
<h3 id="kdf-1-पररभक-शरखल-कज">KDF 1: प्रारंभिक श्रृंखला कुंजी</h3>
<p>प्रोटोकॉल प्रारंभ पर केवल एक बार किया जाता है (पूर्व-गणना की जा सकती है):</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># Protocol name (40 bytes, ASCII, no null termination)</span>
</span></span><span style="display:flex;"><span>protocol_name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Noise_IKelg2+hs2_25519_ChaChaPoly_SHA256&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Initialize hash</span>
</span></span><span style="display:flex;"><span>h <span style="color:#f92672">=</span> SHA256(protocol_name)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Initialize chaining key</span>
</span></span><span style="display:flex;"><span>chainKey <span style="color:#f92672">=</span> h
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># MixHash with empty prologue</span>
</span></span><span style="display:flex;"><span>h <span style="color:#f92672">=</span> SHA256(h)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># State: chainKey and h initialized</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Can be precalculated for all outbound sessions</span>
</span></span></code></pre></div><p><strong>परिणाम:</strong> - <code>chainKey</code> = सभी आगामी KDFs (कुंजी व्युत्पत्ति फलन) के लिए प्रारंभिक चेनिंग कुंजी - <code>h</code> = प्रारंभिक ट्रांस्क्रिप्ट हैश</p>
<h3 id="kdf-2-कज-वयतपनन-फकशन-bob-क-सथर-कज-क-मशरण">KDF 2 (कुंजी व्युत्पन्न फ़ंक्शन): Bob की स्थिर कुंजी का मिश्रण</h3>
<p>Bob यह कार्य एक बार करता है (इसे सभी इनबाउंड सत्रों के लिए पहले से गणना किया जा सकता है):</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># Bob&#39;s static keys (published in LeaseSet)</span>
</span></span><span style="display:flex;"><span>bsk <span style="color:#f92672">=</span> GENERATE_PRIVATE()
</span></span><span style="display:flex;"><span>bpk <span style="color:#f92672">=</span> DERIVE_PUBLIC(bsk)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Mix Bob&#39;s public key into hash</span>
</span></span><span style="display:flex;"><span>h <span style="color:#f92672">=</span> SHA256(h <span style="color:#f92672">||</span> bpk)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># State: h updated with Bob&#39;s identity</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Can be precalculated by Bob for all inbound sessions</span>
</span></span></code></pre></div><h3 id="kdf-3-ऐलस-क-असथय-कज-उतपतत">KDF 3: ऐलिस की अस्थायी कुंजी उत्पत्ति</h3>
<p>Alice प्रत्येक NS संदेश के लिए नई कुंजियाँ उत्पन्न करती है:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># Generate ephemeral key pair suitable for Elligator2</span>
</span></span><span style="display:flex;"><span>aesk <span style="color:#f92672">=</span> GENERATE_PRIVATE_ELG2()
</span></span><span style="display:flex;"><span>aepk <span style="color:#f92672">=</span> DERIVE_PUBLIC(aesk)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Mix ephemeral public key into hash</span>
</span></span><span style="display:flex;"><span>h <span style="color:#f92672">=</span> SHA256(h <span style="color:#f92672">||</span> aepk)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Elligator2 encode for transmission</span>
</span></span><span style="display:flex;"><span>elg2_aepk <span style="color:#f92672">=</span> ENCODE_ELG2(aepk)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># State: h updated with Alice&#39;s ephemeral key</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Send elg2_aepk as first 32 bytes of NS message</span>
</span></span></code></pre></div><h3 id="kdf-कज-वयतपतत-फकशन-4-ns-सथर-कज-अनभग-es-dh">KDF (कुंजी व्युत्पत्ति फ़ंक्शन) 4: NS स्थिर कुंजी अनुभाग (es DH)</h3>
<p>एलिस की स्थिर कुंजी को एन्क्रिप्ट करने के लिए कुंजियाँ व्युत्पन्न करता है:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># Perform first DH (ephemeral-static)</span>
</span></span><span style="display:flex;"><span>sharedSecret <span style="color:#f92672">=</span> DH(aesk, bpk)  <span style="color:#75715e"># Alice computes</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Equivalent: sharedSecret = DH(bsk, aepk)  # Bob computes</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Derive cipher key from shared secret</span>
</span></span><span style="display:flex;"><span>keydata <span style="color:#f92672">=</span> HKDF(chainKey, sharedSecret, <span style="color:#e6db74">&#34;&#34;</span>, <span style="color:#ae81ff">64</span>)
</span></span><span style="display:flex;"><span>chainKey <span style="color:#f92672">=</span> keydata[<span style="color:#ae81ff">0</span>:<span style="color:#ae81ff">31</span>]
</span></span><span style="display:flex;"><span>k <span style="color:#f92672">=</span> keydata[<span style="color:#ae81ff">32</span>:<span style="color:#ae81ff">63</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># AEAD encryption parameters</span>
</span></span><span style="display:flex;"><span>nonce <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>associated_data <span style="color:#f92672">=</span> h  <span style="color:#75715e"># Current hash transcript</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Encrypt static key section</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> binding_requested:
</span></span><span style="display:flex;"><span>    plaintext <span style="color:#f92672">=</span> apk  <span style="color:#75715e"># Alice&#39;s static public key (32 bytes)</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>    plaintext <span style="color:#f92672">=</span> bytes(<span style="color:#ae81ff">32</span>)  <span style="color:#75715e"># All zeros for unbound</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>ciphertext <span style="color:#f92672">=</span> ENCRYPT(k, nonce, plaintext, associated_data)
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ciphertext = 32 bytes encrypted + 16 bytes MAC = 48 bytes</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Mix ciphertext into hash</span>
</span></span><span style="display:flex;"><span>h <span style="color:#f92672">=</span> SHA256(h <span style="color:#f92672">||</span> ciphertext)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># State: Static key section encrypted, h updated</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Send ciphertext (48 bytes) as next part of NS message</span>
</span></span></code></pre></div><h3 id="kdf-कज-वयतपतत-फकशन-5-ns-पलड-अनभग-ss-dh-सटटक-सटटक-डफ-हलमन-कवल-बइड">KDF (कुंजी व्युत्पत्ति फ़ंक्शन) 5: NS पेलोड अनुभाग (ss DH (स्टैटिक-स्टैटिक डिफी-हेलमैन), केवल बाइंड)</h3>
<p>बाउंड सत्रों के लिए, पेलोड एन्क्रिप्शन हेतु दूसरा DH (Diffie-Hellman कुंजी विनिमय) करें:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">if</span> binding_requested:
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Alice&#39;s static keys</span>
</span></span><span style="display:flex;"><span>    ask <span style="color:#f92672">=</span> GENERATE_PRIVATE()  <span style="color:#75715e"># Alice&#39;s long-term key</span>
</span></span><span style="display:flex;"><span>    apk <span style="color:#f92672">=</span> DERIVE_PUBLIC(ask)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Perform second DH (static-static)</span>
</span></span><span style="display:flex;"><span>    sharedSecret <span style="color:#f92672">=</span> DH(ask, bpk)  <span style="color:#75715e"># Alice computes</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Equivalent: sharedSecret = DH(bsk, apk)  # Bob computes</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Derive cipher key</span>
</span></span><span style="display:flex;"><span>    keydata <span style="color:#f92672">=</span> HKDF(chainKey, sharedSecret, <span style="color:#e6db74">&#34;&#34;</span>, <span style="color:#ae81ff">64</span>)
</span></span><span style="display:flex;"><span>    chainKey <span style="color:#f92672">=</span> keydata[<span style="color:#ae81ff">0</span>:<span style="color:#ae81ff">31</span>]
</span></span><span style="display:flex;"><span>    k <span style="color:#f92672">=</span> keydata[<span style="color:#ae81ff">32</span>:<span style="color:#ae81ff">63</span>]
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    nonce <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>    associated_data <span style="color:#f92672">=</span> h
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Unbound: reuse keys from static key section</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># chainKey and k unchanged</span>
</span></span><span style="display:flex;"><span>    nonce <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>  <span style="color:#75715e"># Increment nonce (reusing same key)</span>
</span></span><span style="display:flex;"><span>    associated_data <span style="color:#f92672">=</span> h
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Encrypt payload</span>
</span></span><span style="display:flex;"><span>payload <span style="color:#f92672">=</span> build_payload()  <span style="color:#75715e"># DateTime + Garlic Cloves + etc.</span>
</span></span><span style="display:flex;"><span>ciphertext <span style="color:#f92672">=</span> ENCRYPT(k, nonce, payload, associated_data)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Mix ciphertext into hash</span>
</span></span><span style="display:flex;"><span>h <span style="color:#f92672">=</span> SHA256(h <span style="color:#f92672">||</span> ciphertext)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># State: Payload encrypted, h contains complete NS transcript</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Save chainKey and h for NSR processing</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Send ciphertext as final part of NS message</span>
</span></span></code></pre></div><p><strong>महत्वपूर्ण टिप्पणियाँ:</strong></p>
<ol>
<li>
<p><strong>Bound बनाम Unbound</strong>:</p>
<ul>
<li>Bound 2 DH (Diffie-Hellman कुंजी-विनिमय) ऑपरेशन करता है (es + ss)</li>
<li>Unbound 1 DH ऑपरेशन करता है (केवल es)</li>
<li>Unbound नई key (कुंजी) व्युत्पन्न करने के बजाय nonce (एक बार उपयोग होने वाला मान) को बढ़ाता है</li>
</ul>
</li>
<li>
<p><strong>कुंजी पुन:उपयोग सुरक्षा</strong>:</p>
<ul>
<li>भिन्न nonce (एक-बार उपयोग होने वाली संख्या) मान (0 बनाम 1) कुंजी/nonce के पुन:उपयोग को रोकते हैं</li>
<li>भिन्न संबद्ध डेटा (h अलग है) डोमेन पृथक्करण प्रदान करता है</li>
</ul>
</li>
<li>
<p><strong>हैश ट्रांसक्रिप्ट</strong>:</p>
<ul>
<li><code>h</code> में अब शामिल हैं: protocol_name, empty prologue, bpk, aepk, static_key_ciphertext, payload_ciphertext</li>
<li>यह ट्रांसक्रिप्ट NS संदेश के सभी भागों को एक साथ बाँधता है</li>
</ul>
</li>
</ol>
<h3 id="nsr-उततर-टगसट-कज-वयतपनन-फकशन">NSR उत्तर टैगसेट कुंजी व्युत्पन्न फ़ंक्शन</h3>
<p>Bob NSR संदेशों (NSR नामक संदेश प्रकार) के लिए टैग उत्पन्न करता है:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># Chain key from NS payload section</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># chainKey = final chainKey from NS KDF</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Generate tagset key</span>
</span></span><span style="display:flex;"><span>tagsetKey <span style="color:#f92672">=</span> HKDF(chainKey, ZEROLEN, <span style="color:#e6db74">&#34;SessionReplyTags&#34;</span>, <span style="color:#ae81ff">32</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Initialize NSR tagset (see DH_INITIALIZE below)</span>
</span></span><span style="display:flex;"><span>tagset_nsr <span style="color:#f92672">=</span> DH_INITIALIZE(chainKey, tagsetKey)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Get tag for this NSR</span>
</span></span><span style="display:flex;"><span>tagsetEntry <span style="color:#f92672">=</span> tagset_nsr<span style="color:#f92672">.</span>GET_NEXT_ENTRY()
</span></span><span style="display:flex;"><span>tag <span style="color:#f92672">=</span> tagsetEntry<span style="color:#f92672">.</span>SESSION_TAG  <span style="color:#75715e"># 8 bytes</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># State: tag available for NSR message</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Send tag as first 8 bytes of NSR</span>
</span></span></code></pre></div><h3 id="nsr-सदश-कज-वयतपतत-फकशन">NSR संदेश कुंजी व्युत्पत्ति फ़ंक्शन</h3>
<h3 id="kdf-6-nsr-असथय-कज-सजन">KDF 6: NSR अस्थायी कुंजी सृजन</h3>
<p>Bob प्रत्येक NSR के लिए एक नई ephemeral key (क्षणिक कुंजी) उत्पन्न करता है:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># Mix tag into hash (I2P extension to Noise)</span>
</span></span><span style="display:flex;"><span>h <span style="color:#f92672">=</span> SHA256(h <span style="color:#f92672">||</span> tag)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Generate ephemeral key pair</span>
</span></span><span style="display:flex;"><span>besk <span style="color:#f92672">=</span> GENERATE_PRIVATE_ELG2()
</span></span><span style="display:flex;"><span>bepk <span style="color:#f92672">=</span> DERIVE_PUBLIC(besk)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Mix ephemeral public key into hash</span>
</span></span><span style="display:flex;"><span>h <span style="color:#f92672">=</span> SHA256(h <span style="color:#f92672">||</span> bepk)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Elligator2 encode for transmission</span>
</span></span><span style="display:flex;"><span>elg2_bepk <span style="color:#f92672">=</span> ENCODE_ELG2(bepk)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># State: h updated with tag and Bob&#39;s ephemeral key</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Send elg2_bepk as bytes 9-40 of NSR message</span>
</span></span></code></pre></div><h3 id="kdf-7-nsr-कज-अनभग-ee-और-se-dh-diffie-hellman-कज-वनमय">KDF 7: NSR कुंजी अनुभाग (ee और se DH (Diffie-Hellman कुंजी-विनिमय))</h3>
<p>NSR key section (NSR का कुंजी अनुभाग) के लिए कुंजियाँ व्युत्पन्न करता है:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># Perform third DH (ephemeral-ephemeral)</span>
</span></span><span style="display:flex;"><span>sharedSecret_ee <span style="color:#f92672">=</span> DH(aesk, bepk)  <span style="color:#75715e"># Alice computes</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Equivalent: sharedSecret_ee = DH(besk, aepk)  # Bob computes</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Mix ee into chain</span>
</span></span><span style="display:flex;"><span>keydata <span style="color:#f92672">=</span> HKDF(chainKey, sharedSecret_ee, <span style="color:#e6db74">&#34;&#34;</span>, <span style="color:#ae81ff">32</span>)
</span></span><span style="display:flex;"><span>chainKey <span style="color:#f92672">=</span> keydata[<span style="color:#ae81ff">0</span>:<span style="color:#ae81ff">31</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Perform fourth DH (static-ephemeral)</span>
</span></span><span style="display:flex;"><span>sharedSecret_se <span style="color:#f92672">=</span> DH(ask, bepk)  <span style="color:#75715e"># Alice computes</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Equivalent: sharedSecret_se = DH(besk, apk)  # Bob computes</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Derive cipher key from se</span>
</span></span><span style="display:flex;"><span>keydata <span style="color:#f92672">=</span> HKDF(chainKey, sharedSecret_se, <span style="color:#e6db74">&#34;&#34;</span>, <span style="color:#ae81ff">64</span>)
</span></span><span style="display:flex;"><span>chainKey <span style="color:#f92672">=</span> keydata[<span style="color:#ae81ff">0</span>:<span style="color:#ae81ff">31</span>]
</span></span><span style="display:flex;"><span>k <span style="color:#f92672">=</span> keydata[<span style="color:#ae81ff">32</span>:<span style="color:#ae81ff">63</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># AEAD encryption of empty data (key section has no payload)</span>
</span></span><span style="display:flex;"><span>nonce <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>associated_data <span style="color:#f92672">=</span> h
</span></span><span style="display:flex;"><span>ciphertext <span style="color:#f92672">=</span> ENCRYPT(k, nonce, ZEROLEN, associated_data)
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ciphertext = 16 bytes (MAC only, no plaintext)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Mix ciphertext into hash</span>
</span></span><span style="display:flex;"><span>h <span style="color:#f92672">=</span> SHA256(h <span style="color:#f92672">||</span> ciphertext)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># State: Key section encrypted, chainKey contains all 4 DH results</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Send ciphertext (16 bytes MAC) as bytes 41-56 of NSR</span>
</span></span></code></pre></div><p><strong>महत्वपूर्ण</strong>: यह Noise IK handshake (Noise प्रोटोकॉल का IK हैंडशेक) को पूरा करता है। <code>chainKey</code> में अब सभी 4 DH ऑपरेशन्स (es, ss, ee, se) का योगदान शामिल है।</p>
<h3 id="kdf-8-nsr-पलड-अनभग">KDF 8: NSR पेलोड अनुभाग</h3>
<p>NSR पेलोड एन्क्रिप्शन हेतु कुंजियाँ व्युत्पन्न करता है:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># Split chainKey into bidirectional keys</span>
</span></span><span style="display:flex;"><span>keydata <span style="color:#f92672">=</span> HKDF(chainKey, ZEROLEN, <span style="color:#e6db74">&#34;&#34;</span>, <span style="color:#ae81ff">64</span>)
</span></span><span style="display:flex;"><span>k_ab <span style="color:#f92672">=</span> keydata[<span style="color:#ae81ff">0</span>:<span style="color:#ae81ff">31</span>]   <span style="color:#75715e"># Alice → Bob key</span>
</span></span><span style="display:flex;"><span>k_ba <span style="color:#f92672">=</span> keydata[<span style="color:#ae81ff">32</span>:<span style="color:#ae81ff">63</span>]  <span style="color:#75715e"># Bob → Alice key</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Initialize ES tagsets for both directions</span>
</span></span><span style="display:flex;"><span>tagset_ab <span style="color:#f92672">=</span> DH_INITIALIZE(chainKey, k_ab)  <span style="color:#75715e"># Alice → Bob</span>
</span></span><span style="display:flex;"><span>tagset_ba <span style="color:#f92672">=</span> DH_INITIALIZE(chainKey, k_ba)  <span style="color:#75715e"># Bob → Alice</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Derive NSR payload key (Bob → Alice)</span>
</span></span><span style="display:flex;"><span>k_nsr <span style="color:#f92672">=</span> HKDF(k_ba, ZEROLEN, <span style="color:#e6db74">&#34;AttachPayloadKDF&#34;</span>, <span style="color:#ae81ff">32</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Encrypt NSR payload</span>
</span></span><span style="display:flex;"><span>nonce <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>associated_data <span style="color:#f92672">=</span> h  <span style="color:#75715e"># Binds payload to entire NSR</span>
</span></span><span style="display:flex;"><span>payload <span style="color:#f92672">=</span> build_payload()  <span style="color:#75715e"># Usually application reply</span>
</span></span><span style="display:flex;"><span>ciphertext <span style="color:#f92672">=</span> ENCRYPT(k_nsr, nonce, payload, associated_data)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># State: Bidirectional ES sessions established</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># tagset_ab and tagset_ba ready for ES messages</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Send ciphertext as bytes 57+ of NSR message</span>
</span></span></code></pre></div><p><strong>महत्वपूर्ण टिप्पणियाँ:</strong></p>
<ol>
<li>
<p><strong>विभाजन ऑपरेशन</strong>:</p>
<ul>
<li>प्रत्येक दिशा के लिए स्वतंत्र कुंजियाँ बनाता है</li>
<li>Alice→Bob और Bob→Alice के बीच कुंजियों के पुन: उपयोग को रोकता है</li>
</ul>
</li>
<li>
<p><strong>NSR पेलोड बाइंडिंग</strong>:</p>
<ul>
<li>हैंडशेक से पेलोड को बांधने के लिए <code>h</code> को associated data (संबद्ध डेटा) के रूप में उपयोग करता है</li>
<li>अलग KDF (&ldquo;AttachPayloadKDF&rdquo;) domain separation (डोमेन पृथक्करण) प्रदान करता है</li>
</ul>
</li>
<li>
<p><strong>ES तत्परता</strong>:</p>
<ul>
<li>NSR के बाद, दोनों पक्ष ES संदेश भेज सकते हैं</li>
<li>Alice को ES भेजने से पहले NSR प्राप्त करना होगा</li>
<li>Bob को ES भेजने से पहले ES प्राप्त करना होगा</li>
</ul>
</li>
</ol>
<h3 id="es-सदश-kdfs-key-derivation-functions-कज-वयतपतत-फकशन">ES संदेश KDFs (Key Derivation Functions, कुंजी व्युत्पत्ति फ़ंक्शन)</h3>
<p>ES संदेश टैगसेट्स से पूर्व-उत्पन्न सत्र कुंजियों का उपयोग करते हैं:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># Sender gets next tag and key</span>
</span></span><span style="display:flex;"><span>tagsetEntry <span style="color:#f92672">=</span> outbound_tagset<span style="color:#f92672">.</span>GET_NEXT_ENTRY()
</span></span><span style="display:flex;"><span>tag <span style="color:#f92672">=</span> tagsetEntry<span style="color:#f92672">.</span>SESSION_TAG     <span style="color:#75715e"># 8 bytes</span>
</span></span><span style="display:flex;"><span>k <span style="color:#f92672">=</span> tagsetEntry<span style="color:#f92672">.</span>SESSION_KEY       <span style="color:#75715e"># 32 bytes</span>
</span></span><span style="display:flex;"><span>N <span style="color:#f92672">=</span> tagsetEntry<span style="color:#f92672">.</span>INDEX             <span style="color:#75715e"># Message number</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Construct nonce (12 bytes)</span>
</span></span><span style="display:flex;"><span>nonce <span style="color:#f92672">=</span> [<span style="color:#ae81ff">0x00</span>, <span style="color:#ae81ff">0x00</span>, <span style="color:#ae81ff">0x00</span>, <span style="color:#ae81ff">0x00</span>] <span style="color:#f92672">+</span> little_endian_8_bytes(N)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># AEAD encryption</span>
</span></span><span style="display:flex;"><span>associated_data <span style="color:#f92672">=</span> tag  <span style="color:#75715e"># Tag is associated data</span>
</span></span><span style="display:flex;"><span>payload <span style="color:#f92672">=</span> build_payload()
</span></span><span style="display:flex;"><span>ciphertext <span style="color:#f92672">=</span> ENCRYPT(k, nonce, payload, associated_data)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Send: tag || ciphertext (8 + len(ciphertext) bytes)</span>
</span></span></code></pre></div><p><strong>प्राप्तकर्ता प्रक्रिया:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># Extract tag</span>
</span></span><span style="display:flex;"><span>tag <span style="color:#f92672">=</span> message[<span style="color:#ae81ff">0</span>:<span style="color:#ae81ff">8</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Look up tag in inbound tagsets</span>
</span></span><span style="display:flex;"><span>tagsetEntry <span style="color:#f92672">=</span> inbound_tagset<span style="color:#f92672">.</span>GET_SESSION_KEY(tag)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> tagsetEntry <span style="color:#f92672">is</span> <span style="color:#66d9ef">None</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Not an ES message, try NS/NSR decryption</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> try_handshake_decryption(message)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>k <span style="color:#f92672">=</span> tagsetEntry<span style="color:#f92672">.</span>SESSION_KEY
</span></span><span style="display:flex;"><span>N <span style="color:#f92672">=</span> tagsetEntry<span style="color:#f92672">.</span>INDEX
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Construct nonce</span>
</span></span><span style="display:flex;"><span>nonce <span style="color:#f92672">=</span> [<span style="color:#ae81ff">0x00</span>, <span style="color:#ae81ff">0x00</span>, <span style="color:#ae81ff">0x00</span>, <span style="color:#ae81ff">0x00</span>] <span style="color:#f92672">+</span> little_endian_8_bytes(N)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># AEAD decryption</span>
</span></span><span style="display:flex;"><span>associated_data <span style="color:#f92672">=</span> tag
</span></span><span style="display:flex;"><span>ciphertext <span style="color:#f92672">=</span> message[<span style="color:#ae81ff">8</span>:]
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">try</span>:
</span></span><span style="display:flex;"><span>    payload <span style="color:#f92672">=</span> DECRYPT(k, nonce, ciphertext, associated_data)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">except</span> AuthenticationError:
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># MAC verification failed, reject message</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> reject_message()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Process payload blocks</span>
</span></span><span style="display:flex;"><span>process_payload(payload)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Remove tag from tagset (one-time use)</span>
</span></span><span style="display:flex;"><span>inbound_tagset<span style="color:#f92672">.</span>remove(tag)
</span></span></code></pre></div><h3 id="dh_initialize-फकशन">DH_INITIALIZE फ़ंक्शन</h3>
<p>एक दिशा के लिए एक tagset (टैग्स का समूह) बनाता है:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">DH_INITIALIZE</span>(rootKey, k):
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    Initializes a tagset with session tag and symmetric key ratchets.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    Args:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        rootKey: Chain key from previous DH ratchet (32 bytes)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        k: Key material from split() or DH ratchet (32 bytes)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    Returns:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        tagset: Initialized tagset object
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Derive next root key and chain key</span>
</span></span><span style="display:flex;"><span>    keydata <span style="color:#f92672">=</span> HKDF(rootKey, k, <span style="color:#e6db74">&#34;KDFDHRatchetStep&#34;</span>, <span style="color:#ae81ff">64</span>)
</span></span><span style="display:flex;"><span>    nextRootKey <span style="color:#f92672">=</span> keydata[<span style="color:#ae81ff">0</span>:<span style="color:#ae81ff">31</span>]
</span></span><span style="display:flex;"><span>    chainKey_tagset <span style="color:#f92672">=</span> keydata[<span style="color:#ae81ff">32</span>:<span style="color:#ae81ff">63</span>]
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Derive separate chain keys for tags and keys</span>
</span></span><span style="display:flex;"><span>    keydata <span style="color:#f92672">=</span> HKDF(chainKey_tagset, ZEROLEN, <span style="color:#e6db74">&#34;TagAndKeyGenKeys&#34;</span>, <span style="color:#ae81ff">64</span>)
</span></span><span style="display:flex;"><span>    sessTag_ck <span style="color:#f92672">=</span> keydata[<span style="color:#ae81ff">0</span>:<span style="color:#ae81ff">31</span>]   <span style="color:#75715e"># Session tag chain key</span>
</span></span><span style="display:flex;"><span>    symmKey_ck <span style="color:#f92672">=</span> keydata[<span style="color:#ae81ff">32</span>:<span style="color:#ae81ff">63</span>]  <span style="color:#75715e"># Symmetric key chain key</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Create tagset object</span>
</span></span><span style="display:flex;"><span>    tagset <span style="color:#f92672">=</span> Tagset()
</span></span><span style="display:flex;"><span>    tagset<span style="color:#f92672">.</span>nextRootKey <span style="color:#f92672">=</span> nextRootKey
</span></span><span style="display:flex;"><span>    tagset<span style="color:#f92672">.</span>sessTag_chainKey <span style="color:#f92672">=</span> sessTag_ck
</span></span><span style="display:flex;"><span>    tagset<span style="color:#f92672">.</span>symmKey_chainKey <span style="color:#f92672">=</span> symmKey_ck
</span></span><span style="display:flex;"><span>    tagset<span style="color:#f92672">.</span>lastIndex <span style="color:#f92672">=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> tagset
</span></span></code></pre></div><p><strong>उपयोग संदर्भ:</strong></p>
<ol>
<li><strong>NSR Tagset (NSR टैगसेट)</strong>: <code>DH_INITIALIZE(chainKey_from_NS, tagsetKey_NSR)</code></li>
<li><strong>ES Tagsets (ES टैगसेट्स)</strong>: <code>DH_INITIALIZE(chainKey_from_NSR, k_ab or k_ba)</code></li>
<li><strong>Ratcheted Tagsets (रैचेटेड टैगसेट्स)</strong>: <code>DH_INITIALIZE(nextRootKey_from_previous, tagsetKey_from_DH)</code></li>
</ol>
<hr>
<h2 id="रचट-करपटगरफक-कज-अदयतन-ततर-यतरणए">रैचेट (क्रिप्टोग्राफ़िक कुंजी अद्यतन तंत्र) यंत्रणाएँ</h2>
<p>ECIES (Elliptic Curve Integrated Encryption Scheme—एलिप्टिक कर्व आधारित एकीकृत एन्क्रिप्शन योजना) forward secrecy और कुशल सत्र प्रबंधन प्रदान करने के लिए तीन समकालिक ratchet तंत्रों का उपयोग करता है।</p>
<h3 id="ratchet-करपटगरफ-म-करमक-कज-अदयतन-ततर-क-अवलकन">Ratchet (क्रिप्टोग्राफी में क्रमिक कुंजी-अद्यतन तंत्र) का अवलोकन</h3>
<p><strong>तीन Ratchet (कुंजी-अग्रसारण तंत्र) प्रकार:</strong></p>
<ol>
<li><strong>DH Ratchet</strong> (क्रमिक कुंजी-अपडेट तंत्र): नई रूट कुंजियाँ उत्पन्न करने के लिए Diffie-Hellman कुंजी विनिमय करता है</li>
<li><strong>Session Tag Ratchet</strong> (Session tags: अस्थायी, एक-बार-उपयोग पहचान टैग): नियतात्मक रूप से एक-बार-उपयोग session tags व्युत्पन्न करता है</li>
<li><strong>Symmetric Key Ratchet</strong>: संदेश एन्क्रिप्शन के लिए सत्र कुंजियाँ व्युत्पन्न करता है</li>
</ol>
<p><strong>संबंध:</strong></p>
<pre tabindex="0"><code>DH Ratchet (periodic)
    ↓
Creates new tagset
    ↓
Session Tag Ratchet (per message) ← synchronized → Symmetric Key Ratchet (per message)
    ↓                                                      ↓
Session Tags (8 bytes each)                      Session Keys (32 bytes each)
</code></pre><p><strong>मुख्य गुणधर्म:</strong></p>
<ul>
<li><strong>प्रेषक</strong>: आवश्यकतानुसार टैग और कुंजियाँ बनाता है (संग्रहण की आवश्यकता नहीं)</li>
<li><strong>ग्राही</strong>: look-ahead window (अग्र-दृष्टि विंडो) के लिए टैग पहले से बनाता है (संग्रहण आवश्यक)</li>
<li><strong>समकालिकता</strong>: टैग सूचकांक कुंजी सूचकांक निर्धारित करता है (N_tag = N_key)</li>
<li><strong>फॉरवर्ड सीक्रेसी</strong>: आवधिक DH ratchet (Diffie-Hellman आधारित रैचेट तंत्र) के माध्यम से प्राप्त</li>
<li><strong>दक्षता</strong>: ग्राही टैग प्राप्त होने तक कुंजी गणना स्थगित कर सकता है</li>
</ul>
<h3 id="dh-ratchet-डफ-हलमन-रचट-सदश-दर-सदश-कज-बदलन-वल-ततर">DH Ratchet (डिफी-हेल्मन रैचेट, संदेश-दर-संदेश कुंजी बदलने वाला तंत्र)</h3>
<p>DH ratchet (Diffie-Hellman आधारित क्रमिक कुंजी-अपडेट तंत्र) समय-समय पर नई अल्पकालिक कुंजियों का आदान-प्रदान करके फॉरवर्ड सीक्रेसी प्रदान करता है।</p>
<h3 id="dh-ratchet-diffie-hellman-आधरत-करमक-कज-अदयतन-ततर-क-आवतत">DH Ratchet (Diffie-Hellman आधारित क्रमिक कुंजी-अद्यतन तंत्र) की आवृत्ति</h3>
<p><strong>आवश्यक Ratchet (क्रमिक कुंजी-अपडेट तंत्र) शर्तें:</strong> - टैग सेट समाप्ति के करीब (टैग 65535 अधिकतम है) - कार्यान्वयन-विशिष्ट नीतियाँ:   - संदेशों की संख्या की सीमा (उदा., हर 4096 संदेशों पर)   - समय सीमा (उदा., हर 10 मिनट में)   - डेटा मात्रा सीमा (उदा., हर 100 MB पर)</p>
<p><strong>अनुशंसित पहला Ratchet (क्रिप्टोग्राफ़िक रैचेट तंत्र)</strong>: सीमा तक पहुँचने से बचने के लिए टैग नंबर 4096 के आसपास</p>
<p><strong>अधिकतम मान:</strong> - <strong>अधिकतम tag set (टैग का समूह) ID</strong>: 65535 - <strong>अधिकतम कुंजी ID</strong>: 32767 - <strong>प्रति tag set अधिकतम संदेश</strong>: 65535 - <strong>प्रति सत्र सैद्धांतिक अधिकतम डेटा</strong>: ~6.9 TB (64K tag sets × 64K messages × 1730 बाइट औसत)</p>
<h3 id="dh-ratchet-diffie-hellman-आधरत-कज-घमव-ततर-क-टग-और-कज-पहचनकरत">DH Ratchet (Diffie-Hellman आधारित कुंजी-घुमाव तंत्र) के टैग और कुंजी पहचानकर्ता</h3>
<p><strong>प्रारंभिक टैग सेट</strong> (हैंडशेक के बाद): - टैग सेट ID: 0 - अभी तक कोई NextKey (अगली कुंजी) ब्लॉक नहीं भेजे गए हैं - कोई कुंजी ID आवंटित नहीं की गई है</p>
<p><strong>पहले Ratchet (क्रमिक-अपडेट एन्क्रिप्शन तंत्र) के बाद</strong>: - टैग सेट आईडी: 1 = (1 + एलिस की कुंजी आईडी + बॉब की कुंजी आईडी) = (1 + 0 + 0) - एलिस कुंजी आईडी 0 के साथ NextKey भेजती है - बॉब कुंजी आईडी 0 के साथ NextKey भेजकर उत्तर देता है</p>
<p><strong>परवर्ती टैग सेट</strong>: - टैग सेट ID = 1 + प्रेषक की कुंजी ID + प्राप्तकर्ता की कुंजी ID - उदाहरण: टैग सेट 5 = (1 + sender_key_2 + receiver_key_2)</p>
<p><strong>टैग सेट प्रगति तालिका:</strong></p>
<table style="width:100%; border-collapse:collapse; margin-bottom:1.5rem;">
  <thead>
    <tr>
      <th style="border:1px solid var(--color-border); padding:0.5rem; background:var(--color-bg-secondary); text-align:left;">Tag Set ID</th>
      <th style="border:1px solid var(--color-border); padding:0.5rem; background:var(--color-bg-secondary); text-align:left;">Sender Key ID</th>
      <th style="border:1px solid var(--color-border); padding:0.5rem; background:var(--color-bg-secondary); text-align:left;">Receiver Key ID</th>
      <th style="border:1px solid var(--color-border); padding:0.5rem; background:var(--color-bg-secondary); text-align:left;">Notes</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">0</td>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">n/a</td>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">n/a</td>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">Initial tag set (post-NSR)</td>
    </tr>
    <tr>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">1</td>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">0 *</td>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">0 *</td>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">First ratchet (both generate new keys)</td>
    </tr>
    <tr>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">2</td>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">1 *</td>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">0</td>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">Sender generates new key</td>
    </tr>
    <tr>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">3</td>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">1</td>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">1 *</td>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">Receiver generates new key</td>
    </tr>
    <tr>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">4</td>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">2 *</td>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">1</td>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">Sender generates new key</td>
    </tr>
    <tr>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">5</td>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">2</td>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">2 *</td>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">Receiver generates new key</td>
    </tr>
    <tr>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">...</td>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">...</td>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">...</td>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">Pattern repeats</td>
    </tr>
    <tr>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">65534</td>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">32767 *</td>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">32766</td>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">Second-to-last tag set</td>
    </tr>
    <tr>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">65535</td>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">32767</td>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">32767 *</td>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">Final tag set</td>
    </tr>
  </tbody>
</table>
\* = इस ratchet (क्रमिक कुंजी-अग्रसारण तंत्र) में नई कुंजी उत्पन्न की गई
<p><strong>Key ID नियम:</strong> - ID 0 से शुरू होकर क्रमिक होते हैं - ID में वृद्धि केवल तब होती है जब नई कुंजी उत्पन्न की जाती है - अधिकतम कुंजी ID 32767 (15 बिट) है - कुंजी ID 32767 के बाद नया सत्र आवश्यक है</p>
<h3 id="dh-ratchet-डफ-हलमन-रचट-सदश-परवह">DH Ratchet (डिफी-हेलमैन रैचेट) संदेश प्रवाह</h3>
<p><strong>भूमिकाएँ:</strong> - <strong>टैग प्रेषक</strong>: आउटबाउंड टैग सेट का स्वामी होता है, संदेश भेजता है - <strong>टैग प्राप्तकर्ता</strong>: इनबाउंड टैग सेट का स्वामी होता है, संदेश प्राप्त करता है</p>
<p><strong>पैटर्न:</strong> टैग प्रेषक ratchet (क्रिप्टोग्राफ़िक आगे-खिसकने वाली कुंजी-अद्यतन प्रक्रिया) तब आरंभ करता है जब टैग सेट लगभग समाप्त हो जाता है।</p>
<p><strong>संदेश प्रवाह आरेख:</strong></p>
<pre tabindex="0"><code>Tag Sender                         Tag Receiver

       ... using tag set #0 ...

(Tag set #0 approaching exhaustion)
(Generate new key #0)

NextKey forward, request reverse, with key #0  --------&gt;
(Repeat until NextKey ACK received)
                                   (Generate new key #0)
                                   (Perform DH: sender_key_0 × receiver_key_0)
                                   (Create inbound tag set #1)

        &lt;---------------           NextKey reverse, with key #0
                                   (Repeat until tag from tag set #1 received)

(Receive NextKey with key #0)
(Perform DH: sender_key_0 × receiver_key_0)
(Create outbound tag set #1)


       ... using tag set #1 ...


(Tag set #1 approaching exhaustion)
(Generate new key #1)

NextKey forward, with key #1        --------&gt;
(Repeat until NextKey ACK received)
                                   (Reuse existing key #0)
                                   (Perform DH: sender_key_1 × receiver_key_0)
                                   (Create inbound tag set #2)

        &lt;--------------            NextKey reverse, id 0 (ACK)
                                   (Repeat until tag from tag set #2 received)

(Receive NextKey with id 0)
(Perform DH: sender_key_1 × receiver_key_0)
(Create outbound tag set #2)


       ... using tag set #2 ...


(Tag set #2 approaching exhaustion)
(Reuse existing key #1)

NextKey forward, request reverse, id 1  --------&gt;
(Repeat until NextKey received)
                                   (Generate new key #1)
                                   (Perform DH: sender_key_1 × receiver_key_1)
                                   (Create inbound tag set #3)

        &lt;--------------            NextKey reverse, with key #1

(Receive NextKey with key #1)
(Perform DH: sender_key_1 × receiver_key_1)
(Create outbound tag set #3)


       ... using tag set #3 ...

       (Pattern repeats: even-numbered tag sets
        use forward key, odd-numbered use reverse key)
</code></pre><p><strong>रैचेट पैटर्न:</strong></p>
<p><strong>सम-संख्या वाले टैग सेट बनाना</strong> (2, 4, 6, &hellip;): 1. प्रेषक नई कुंजी उत्पन्न करता है 2. प्रेषक नई कुंजी के साथ NextKey ब्लॉक भेजता है 3. प्राप्तकर्ता पुरानी कुंजी ID के साथ NextKey ब्लॉक भेजता है (ACK) 4. दोनों (नई प्रेषक कुंजी × पुरानी प्राप्तकर्ता कुंजी) के साथ DH (Diffie-Hellman कुंजी-विनिमय) करते हैं</p>
<p><strong>विषम-संख्या वाले Tag Sets (टैग सेट) का निर्माण</strong> (3, 5, 7, &hellip;): 1. प्रेषक रिवर्स कुंजी का अनुरोध करता है (अनुरोध फ़्लैग के साथ NextKey भेजता है) 2. प्राप्तकर्ता नई कुंजी उत्पन्न करता है 3. प्राप्तकर्ता नई कुंजी के साथ NextKey ब्लॉक भेजता है 4. दोनों (प्रेषक की पुरानी कुंजी × प्राप्तकर्ता की नई कुंजी) के साथ DH (Diffie-Hellman कुंजी-विनिमय) करते हैं</p>
<h3 id="nextkey-बलक-पररप">NextKey ब्लॉक प्रारूप</h3>
<p>विस्तृत NextKey ब्लॉक विनिर्देश के लिए Payload Format अनुभाग देखें।</p>
<p><strong>मुख्य तत्व:</strong> - <strong>फ्लैग्स बाइट</strong>:   - बिट 0: कुंजी मौजूद (1) या केवल ID (0)   - बिट 1: रिवर्स कुंजी (1) या फॉरवर्ड कुंजी (0)   - बिट 2: रिवर्स कुंजी का अनुरोध (1) या कोई अनुरोध नहीं (0) - <strong>कुंजी ID</strong>: 2 बाइट, big-endian (सबसे-महत्त्वपूर्ण-बाइट-प्रथम क्रम) (0-32767) - <strong>सार्वजनिक कुंजी</strong>: 32 बाइट X25519 (यदि बिट 0 = 1)</p>
<p><strong>NextKey Blocks (NextKey ब्लॉक्स) के उदाहरण:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># Sender initiates ratchet with new key (key ID 0, tag set 1)</span>
</span></span><span style="display:flex;"><span>NextKey(flags<span style="color:#f92672">=</span><span style="color:#ae81ff">0x01</span>, key_id<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>, pubkey<span style="color:#f92672">=</span>sender_key_0)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Receiver replies with new key (key ID 0, tag set 1)</span>
</span></span><span style="display:flex;"><span>NextKey(flags<span style="color:#f92672">=</span><span style="color:#ae81ff">0x03</span>, key_id<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>, pubkey<span style="color:#f92672">=</span>receiver_key_0)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Sender ratchets again with new key (key ID 1, tag set 2)</span>
</span></span><span style="display:flex;"><span>NextKey(flags<span style="color:#f92672">=</span><span style="color:#ae81ff">0x01</span>, key_id<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>, pubkey<span style="color:#f92672">=</span>sender_key_1)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Receiver ACKs with old key ID (tag set 2)</span>
</span></span><span style="display:flex;"><span>NextKey(flags<span style="color:#f92672">=</span><span style="color:#ae81ff">0x02</span>, key_id<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Sender requests reverse key (tag set 3)</span>
</span></span><span style="display:flex;"><span>NextKey(flags<span style="color:#f92672">=</span><span style="color:#ae81ff">0x04</span>, key_id<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Receiver sends new reverse key (key ID 1, tag set 3)</span>
</span></span><span style="display:flex;"><span>NextKey(flags<span style="color:#f92672">=</span><span style="color:#ae81ff">0x03</span>, key_id<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>, pubkey<span style="color:#f92672">=</span>receiver_key_1)
</span></span></code></pre></div><h3 id="dh-ratchet-kdf-dh-रचट-आधरत-कज-वयतपनन-फकशन">DH Ratchet KDF (DH रैचेट आधारित कुंजी व्युत्पन्न फ़ंक्शन)</h3>
<p>जब नई कुंजियों का आदान-प्रदान होता है:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># Tag sender generates or reuses key</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> generating_new:
</span></span><span style="display:flex;"><span>    sender_sk <span style="color:#f92672">=</span> GENERATE_PRIVATE()
</span></span><span style="display:flex;"><span>    sender_pk <span style="color:#f92672">=</span> DERIVE_PUBLIC(sender_sk)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Reuse existing key pair</span>
</span></span><span style="display:flex;"><span>    sender_pk <span style="color:#f92672">=</span> existing_sender_pk
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Tag receiver generates or reuses key</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> generating_new:
</span></span><span style="display:flex;"><span>    receiver_sk <span style="color:#f92672">=</span> GENERATE_PRIVATE()
</span></span><span style="display:flex;"><span>    receiver_pk <span style="color:#f92672">=</span> DERIVE_PUBLIC(receiver_sk)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Reuse existing key pair</span>
</span></span><span style="display:flex;"><span>    receiver_pk <span style="color:#f92672">=</span> existing_receiver_pk
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Both parties perform DH</span>
</span></span><span style="display:flex;"><span>sharedSecret <span style="color:#f92672">=</span> DH(sender_sk, receiver_pk)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Derive tagset key</span>
</span></span><span style="display:flex;"><span>tagsetKey <span style="color:#f92672">=</span> HKDF(sharedSecret, ZEROLEN, <span style="color:#e6db74">&#34;XDHRatchetTagSet&#34;</span>, <span style="color:#ae81ff">32</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Get next root key from previous tagset</span>
</span></span><span style="display:flex;"><span>rootKey <span style="color:#f92672">=</span> previous_tagset<span style="color:#f92672">.</span>nextRootKey
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Initialize new tagset</span>
</span></span><span style="display:flex;"><span>new_tagset <span style="color:#f92672">=</span> DH_INITIALIZE(rootKey, tagsetKey)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Tag sender: outbound tagset</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Tag receiver: inbound tagset</span>
</span></span></code></pre></div><p><strong>महत्त्वपूर्ण समय-निर्धारण:</strong></p>
<p><strong>टैग प्रेषक:</strong> - तुरंत नया आउटबाउंड टैग सेट बनाता है - तुरंत नए टैग का उपयोग शुरू करता है - पुराना आउटबाउंड टैग सेट हटाता है</p>
<p><strong>टैग रिसीवर:</strong> - नया इनबाउंड टैग सेट बनाता है - grace period (अनुग्रह अवधि) (3 मिनट) के लिए पुराने इनबाउंड टैग सेट को बनाए रखता है - grace period के दौरान पुराने और नए दोनों टैग सेट से टैग स्वीकार करता है - grace period के बाद पुराने इनबाउंड टैग सेट को हटा देता है</p>
<h3 id="dh-ratchet-diffie-hellman-आधरत-रचट-क-सथत-क-परबधन">DH Ratchet (Diffie-Hellman आधारित रैचेट) की स्थिति का प्रबंधन</h3>
<p><strong>प्रेषक की स्थिति:</strong> - वर्तमान आउटबाउंड टैग सेट - टैग सेट ID और कुंजी IDs - अगली रूट कुंजी (अगले ratchet (क्रमिक कुंजी-परिवर्तन प्रक्रिया) के लिए) - वर्तमान टैग सेट में संदेशों की संख्या</p>
<p><strong>प्राप्तकर्ता स्थिति:</strong> - वर्तमान इनबाउंड टैग सेट (अनुग्रह अवधि के दौरान 2 हो सकते हैं) - पिछले संदेशों की संख्याएँ (PN) अंतर का पता लगाने के लिए - पहले से जनित टैगों की लुक-अहेड विंडो - अगली रूट कुंजी (अगले ratchet (क्रमिक कुंजी-परिवर्तन तंत्र) के लिए)</p>
<p><strong>स्टेट ट्रांज़िशन नियम:</strong></p>
<ol>
<li>
<p><strong>प्रथम रैचेट से पहले</strong>:</p>
<ul>
<li>टैग सेट 0 (NSR से) का उपयोग</li>
<li>कोई कुंजी ID आवंटित नहीं किए गए हैं</li>
</ul>
</li>
<li>
<p><strong>Ratchet (क्रमिक कुंजी-परिवर्तन तंत्र) आरंभ करना</strong>:</p>
<ul>
<li>नई कुंजी उत्पन्न करें (यदि इस दौर में प्रेषक उत्पन्न कर रहा हो)</li>
<li>ES message में NextKey block भेजें</li>
<li>नई outbound tag set (प्रेषित दिशा में उपयोग होने वाला टैग-समूह) बनाने से पहले NextKey reply की प्रतीक्षा करें</li>
</ul>
</li>
<li>
<p><strong>Ratchet Request (क्रमिक कुंजी-परिवर्तन अनुरोध) प्राप्त करना</strong>:</p>
<ul>
<li>नई कुंजी उत्पन्न करें (यदि इस राउंड में रिसीवर उत्पन्न कर रहा है)</li>
<li>प्राप्त कुंजी के साथ DH (Diffie-Hellman कुंजी आदान-प्रदान) करें</li>
<li>नया inbound tag set (आने वाले संदेशों के लिए टैग समूह) बनाएँ</li>
<li>NextKey (अगली-कुंजी) उत्तर भेजें</li>
<li>अनुग्रह अवधि के लिए पुराना inbound tag set बनाए रखें</li>
</ul>
</li>
<li>
<p><strong>Ratchet (क्रिप्टोग्राफ़िक रैचेट) का समापन</strong>:</p>
<ul>
<li>NextKey उत्तर प्राप्त करें</li>
<li>डिफ़ी-हेलमैन (DH) करें</li>
<li>नया आउटबाउंड टैग सेट बनाएं</li>
<li>नए टैग का उपयोग शुरू करें</li>
</ul>
</li>
</ol>
<h3 id="सशन-टग-रचट">सेशन टैग रैचेट</h3>
<p>session tag ratchet (session tags उत्पन्न करने वाला तंत्र) नियतात्मक रूप से एक-बार-उपयोग वाले 8-बाइट session tags उत्पन्न करता है।</p>
<h3 id="session-tag-ratchet-एक-परगतशल-कज-अदयतन-ततर-क-उददशय">Session Tag Ratchet (एक प्रगतिशील कुंजी-अद्यतन तंत्र) का उद्देश्य</h3>
<ul>
<li>स्पष्ट टैग प्रेषण को प्रतिस्थापित करता है (ElGamal 32-बाइट टैग भेजता था)</li>
<li>प्राप्तकर्ता को look-ahead window (आगे की झलक के लिए विंडो) हेतु टैग पहले से उत्पन्न करने में सक्षम बनाता है</li>
<li>प्रेषक मांग पर उत्पन्न करता है (भंडारण की आवश्यकता नहीं)</li>
<li>सूचकांक के माध्यम से symmetric key ratchet (सममित कुंजी के क्रमिक-अपडेट तंत्र) के साथ समकालित होता है</li>
</ul>
<h3 id="session-tag-ratchet-करमक-अदयतन-ततर-सतर">Session Tag Ratchet (क्रमिक अद्यतन तंत्र) सूत्र</h3>
<p><strong>आरंभीकरण:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># From DH_INITIALIZE</span>
</span></span><span style="display:flex;"><span>sessTag_ck <span style="color:#f92672">=</span> initial_chain_key  <span style="color:#75715e"># 32 bytes</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Initialize session tag ratchet</span>
</span></span><span style="display:flex;"><span>keydata <span style="color:#f92672">=</span> HKDF(sessTag_ck, ZEROLEN, <span style="color:#e6db74">&#34;STInitialization&#34;</span>, <span style="color:#ae81ff">64</span>)
</span></span><span style="display:flex;"><span>sessTag_chainKey <span style="color:#f92672">=</span> keydata[<span style="color:#ae81ff">0</span>:<span style="color:#ae81ff">31</span>]    <span style="color:#75715e"># First chain key</span>
</span></span><span style="display:flex;"><span>SESSTAG_CONSTANT <span style="color:#f92672">=</span> keydata[<span style="color:#ae81ff">32</span>:<span style="color:#ae81ff">63</span>]   <span style="color:#75715e"># Constant for all tags in this tagset</span>
</span></span></code></pre></div><p><strong>टैग जनरेशन (टैग N के लिए):</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># Generate tag N</span>
</span></span><span style="display:flex;"><span>keydata <span style="color:#f92672">=</span> HKDF(sessTag_chainKey_(N<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>), SESSTAG_CONSTANT, <span style="color:#e6db74">&#34;SessionTagKeyGen&#34;</span>, <span style="color:#ae81ff">64</span>)
</span></span><span style="display:flex;"><span>sessTag_chainKey_N <span style="color:#f92672">=</span> keydata[<span style="color:#ae81ff">0</span>:<span style="color:#ae81ff">31</span>]  <span style="color:#75715e"># Chain key for next tag</span>
</span></span><span style="display:flex;"><span>tag_N <span style="color:#f92672">=</span> keydata[<span style="color:#ae81ff">32</span>:<span style="color:#ae81ff">39</span>]              <span style="color:#75715e"># Session tag (8 bytes)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Chain continues for each tag</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># tag_0, tag_1, tag_2, ..., tag_65535</span>
</span></span></code></pre></div><p><strong>पूर्ण अनुक्रम:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># Tag 0</span>
</span></span><span style="display:flex;"><span>keydata_0 <span style="color:#f92672">=</span> HKDF(sessTag_chainKey, SESSTAG_CONSTANT, <span style="color:#e6db74">&#34;SessionTagKeyGen&#34;</span>, <span style="color:#ae81ff">64</span>)
</span></span><span style="display:flex;"><span>sessTag_chainKey_0 <span style="color:#f92672">=</span> keydata_0[<span style="color:#ae81ff">0</span>:<span style="color:#ae81ff">31</span>]
</span></span><span style="display:flex;"><span>tag_0 <span style="color:#f92672">=</span> keydata_0[<span style="color:#ae81ff">32</span>:<span style="color:#ae81ff">39</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Tag 1</span>
</span></span><span style="display:flex;"><span>keydata_1 <span style="color:#f92672">=</span> HKDF(sessTag_chainKey_0, SESSTAG_CONSTANT, <span style="color:#e6db74">&#34;SessionTagKeyGen&#34;</span>, <span style="color:#ae81ff">64</span>)
</span></span><span style="display:flex;"><span>sessTag_chainKey_1 <span style="color:#f92672">=</span> keydata_1[<span style="color:#ae81ff">0</span>:<span style="color:#ae81ff">31</span>]
</span></span><span style="display:flex;"><span>tag_1 <span style="color:#f92672">=</span> keydata_1[<span style="color:#ae81ff">32</span>:<span style="color:#ae81ff">39</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Tag N</span>
</span></span><span style="display:flex;"><span>keydata_N <span style="color:#f92672">=</span> HKDF(sessTag_chainKey_(N<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>), SESSTAG_CONSTANT, <span style="color:#e6db74">&#34;SessionTagKeyGen&#34;</span>, <span style="color:#ae81ff">64</span>)
</span></span><span style="display:flex;"><span>sessTag_chainKey_N <span style="color:#f92672">=</span> keydata_N[<span style="color:#ae81ff">0</span>:<span style="color:#ae81ff">31</span>]
</span></span><span style="display:flex;"><span>tag_N <span style="color:#f92672">=</span> keydata_N[<span style="color:#ae81ff">32</span>:<span style="color:#ae81ff">39</span>]
</span></span></code></pre></div><h3 id="session-tag-ratchet-करमक-कज-अदयतन-ततर-परषक-क-करयनवयन">Session Tag Ratchet (क्रमिक कुंजी-अद्यतन तंत्र) प्रेषक का कार्यान्वयन</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">OutboundTagset</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">__init__</span>(self, sessTag_ck):
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Initialize</span>
</span></span><span style="display:flex;"><span>        keydata <span style="color:#f92672">=</span> HKDF(sessTag_ck, ZEROLEN, <span style="color:#e6db74">&#34;STInitialization&#34;</span>, <span style="color:#ae81ff">64</span>)
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>chainKey <span style="color:#f92672">=</span> keydata[<span style="color:#ae81ff">0</span>:<span style="color:#ae81ff">31</span>]
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>constant <span style="color:#f92672">=</span> keydata[<span style="color:#ae81ff">32</span>:<span style="color:#ae81ff">63</span>]
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>index <span style="color:#f92672">=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">get_next_tag</span>(self):
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Increment index</span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>index <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> self<span style="color:#f92672">.</span>index <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">65535</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">raise</span> TagsetExhausted(<span style="color:#e6db74">&#34;Ratchet required&#34;</span>)
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Generate tag</span>
</span></span><span style="display:flex;"><span>        keydata <span style="color:#f92672">=</span> HKDF(self<span style="color:#f92672">.</span>chainKey, self<span style="color:#f92672">.</span>constant, <span style="color:#e6db74">&#34;SessionTagKeyGen&#34;</span>, <span style="color:#ae81ff">64</span>)
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>chainKey <span style="color:#f92672">=</span> keydata[<span style="color:#ae81ff">0</span>:<span style="color:#ae81ff">31</span>]
</span></span><span style="display:flex;"><span>        tag <span style="color:#f92672">=</span> keydata[<span style="color:#ae81ff">32</span>:<span style="color:#ae81ff">39</span>]
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> (tag, self<span style="color:#f92672">.</span>index)
</span></span></code></pre></div><p><strong>प्रेषक प्रक्रिया:</strong> 1. प्रत्येक संदेश के लिए <code>get_next_tag()</code> कॉल करें 2. ES संदेश में लौटा हुआ टैग का उपयोग करें 3. संभावित ACK (पुष्टिकरण) ट्रैकिंग के लिए इंडेक्स N सहेजें 4. टैग को संग्रहीत करने की आवश्यकता नहीं (आवश्यकतानुसार उत्पन्न किया जाता है)</p>
<h3 id="session-tag-ratchet-सशन-टग-क-लए-कज-आग-बढन-वल-ततर-रसवर-करयनवयन">Session Tag Ratchet (सेशन टैग के लिए कुंजी आगे बढ़ाने वाला तंत्र) रिसीवर कार्यान्वयन</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">InboundTagset</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">__init__</span>(self, sessTag_ck, look_ahead<span style="color:#f92672">=</span><span style="color:#ae81ff">32</span>):
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Initialize</span>
</span></span><span style="display:flex;"><span>        keydata <span style="color:#f92672">=</span> HKDF(sessTag_ck, ZEROLEN, <span style="color:#e6db74">&#34;STInitialization&#34;</span>, <span style="color:#ae81ff">64</span>)
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>chainKey <span style="color:#f92672">=</span> keydata[<span style="color:#ae81ff">0</span>:<span style="color:#ae81ff">31</span>]
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>constant <span style="color:#f92672">=</span> keydata[<span style="color:#ae81ff">32</span>:<span style="color:#ae81ff">63</span>]
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>index <span style="color:#f92672">=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>look_ahead <span style="color:#f92672">=</span> look_ahead
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>tags <span style="color:#f92672">=</span> {}  <span style="color:#75715e"># Dictionary: tag -&gt; index</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Pre-generate initial tags</span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>extend(look_ahead)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">extend</span>(self, count):
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;&#34;&#34;Generate &#39;count&#39; more tags&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> _ <span style="color:#f92672">in</span> range(count):
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>index <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> self<span style="color:#f92672">.</span>index <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">65535</span>:
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">return</span>  <span style="color:#75715e"># Cannot exceed maximum</span>
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># Generate tag</span>
</span></span><span style="display:flex;"><span>            keydata <span style="color:#f92672">=</span> HKDF(self<span style="color:#f92672">.</span>chainKey, self<span style="color:#f92672">.</span>constant, <span style="color:#e6db74">&#34;SessionTagKeyGen&#34;</span>, <span style="color:#ae81ff">64</span>)
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>chainKey <span style="color:#f92672">=</span> keydata[<span style="color:#ae81ff">0</span>:<span style="color:#ae81ff">31</span>]
</span></span><span style="display:flex;"><span>            tag <span style="color:#f92672">=</span> keydata[<span style="color:#ae81ff">32</span>:<span style="color:#ae81ff">39</span>]
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># Store tag</span>
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>tags[tag] <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>index
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">lookup_tag</span>(self, tag):
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;&#34;&#34;Look up tag and return index&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> tag <span style="color:#f92672">in</span> self<span style="color:#f92672">.</span>tags:
</span></span><span style="display:flex;"><span>            index <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>tags[tag]
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># Remove tag (one-time use)</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">del</span> self<span style="color:#f92672">.</span>tags[tag]
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> index
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">None</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">check_and_extend</span>(self):
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;&#34;&#34;Extend if tag count is low&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        current_count <span style="color:#f92672">=</span> len(self<span style="color:#f92672">.</span>tags)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> current_count <span style="color:#f92672">&lt;</span> self<span style="color:#f92672">.</span>look_ahead <span style="color:#f92672">//</span> <span style="color:#ae81ff">2</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># Extend to restore window</span>
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>extend(self<span style="color:#f92672">.</span>look_ahead <span style="color:#f92672">-</span> current_count)
</span></span></code></pre></div><p><strong>रिसीवर प्रक्रिया:</strong> 1. लुक-अहेड विंडो के लिए पहले से टैग जनरेट करें (उदा., 32 टैग) 2. टैग को हैश टेबल या डिक्शनरी में संग्रहीत करें 3. जब संदेश आए, तो टैग ढूंढकर इंडेक्स N प्राप्त करें 4. स्टोरेज से टैग हटाएँ (एक बार उपयोग) 5. यदि टैग की संख्या सीमा से नीचे गिर जाए, तो विंडो का विस्तार करें</p>
<h3 id="session-tag-सशन-टग-लक-अहड-रणनत">Session Tag (सेशन टैग) लुक-अहेड रणनीति</h3>
<p><strong>उद्देश्य</strong>: मेमोरी उपयोग और out-of-order message handling (संदेशों को आगमन-क्रम से हटकर संसाधित करना) के बीच संतुलन</p>
<p><strong>अनुशंसित Look-Ahead (पूर्व-दृष्टि) आकार:</strong></p>
<table style="width:100%; border-collapse:collapse; margin-bottom:1.5rem;">
  <thead>
    <tr>
      <th style="border:1px solid var(--color-border); padding:0.5rem; background:var(--color-bg-secondary); text-align:left;">Tagset Type</th>
      <th style="border:1px solid var(--color-border); padding:0.5rem; background:var(--color-bg-secondary); text-align:center;">Initial Size</th>
      <th style="border:1px solid var(--color-border); padding:0.5rem; background:var(--color-bg-secondary); text-align:center;">Maximum Size</th>
      <th style="border:1px solid var(--color-border); padding:0.5rem; background:var(--color-bg-secondary); text-align:left;">Notes</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">NSR tagset</td>
      <td style="border:1px solid var(--color-border); padding:0.5rem; text-align:center;">12</td>
      <td style="border:1px solid var(--color-border); padding:0.5rem; text-align:center;">12</td>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">Short-lived</td>
    </tr>
    <tr>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">ES tagset 0</td>
      <td style="border:1px solid var(--color-border); padding:0.5rem; text-align:center;">24</td>
      <td style="border:1px solid var(--color-border); padding:0.5rem; text-align:center;">160</td>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">Initial ES tagset</td>
    </tr>
    <tr>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">ES tagset 1+</td>
      <td style="border:1px solid var(--color-border); padding:0.5rem; text-align:center;">160</td>
      <td style="border:1px solid var(--color-border); padding:0.5rem; text-align:center;">160</td>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">Ratcheted tagsets</td>
    </tr>
  </tbody>
</table>
**अनुकूली लुक-अहेड:**
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># Dynamic look-ahead based on highest tag received</span>
</span></span><span style="display:flex;"><span>look_ahead <span style="color:#f92672">=</span> min(tsmax, tsmin <span style="color:#f92672">+</span> N <span style="color:#f92672">//</span> <span style="color:#ae81ff">4</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Example:</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># tsmin = 24, tsmax = 160</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># N = 0:   look_ahead = min(160, 24 + 0/4) = 24</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># N = 100: look_ahead = min(160, 24 + 100/4) = 49</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># N = 500: look_ahead = min(160, 24 + 500/4) = 149</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># N = 544: look_ahead = min(160, 24 + 544/4) = 160</span>
</span></span></code></pre></div><p><strong>पीछे से ट्रिम:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># Trim tags far behind highest received</span>
</span></span><span style="display:flex;"><span>trim_behind <span style="color:#f92672">=</span> look_ahead <span style="color:#f92672">//</span> <span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># If highest received tag is N=100, trim tags below N=50</span>
</span></span></code></pre></div><p><strong>मेमोरी गणना:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># Per tag: 8 bytes (tag) + 2 bytes (index) + overhead ≈ 16 bytes</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Look-ahead of 160 tags ≈ 2.5 KB per inbound tagset</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># With multiple sessions:</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 100 inbound sessions × 2.5 KB = 250 KB total</span>
</span></span></code></pre></div><h3 id="सशन-टग-क-आउट-ऑफ-ऑरडर-करम-स-बहर-हडलग">सेशन टैग की आउट-ऑफ-ऑर्डर (क्रम से बाहर) हैंडलिंग</h3>
<p><strong>परिदृश्य</strong>: संदेश क्रम से बाहर पहुँचते हैं</p>
<pre tabindex="0"><code>Expected: tag_5, tag_6, tag_7, tag_8
Received: tag_5, tag_7, tag_6, tag_8
</code></pre><p><strong>प्राप्तकर्ता का व्यवहार:</strong></p>
<ol>
<li>
<p>tag_5 प्राप्त करें:</p>
<ul>
<li>खोजें: इंडेक्स 5 पर मिला</li>
<li>संदेश संसाधित करें</li>
<li>tag_5 हटाएँ</li>
<li>अधिकतम प्राप्त: 5</li>
</ul>
</li>
<li>
<p>tag_7 प्राप्त करें (क्रम से बाहर):</p>
<ul>
<li>खोजें: index 7 पर मिला</li>
<li>संदेश संसाधित करें</li>
<li>tag_7 हटाएँ</li>
<li>उच्चतम प्राप्त: 7</li>
<li>नोट: tag_6 अभी भी भंडारण में है (अभी तक प्राप्त नहीं हुआ)</li>
</ul>
</li>
<li>
<p>tag_6 प्राप्त करें (विलंबित):</p>
<ul>
<li>खोजें: सूचकांक 6 पर मिला</li>
<li>संदेश संसाधित करें</li>
<li>tag_6 हटाएँ</li>
<li>अब तक प्राप्त उच्चतम: 7 (अपरिवर्तित)</li>
</ul>
</li>
<li>
<p>tag_8 प्राप्त करें:</p>
<ul>
<li>खोजें: इंडेक्स 8 पर मिला</li>
<li>संदेश संसाधित करें</li>
<li>tag_8 हटाएँ</li>
<li>सर्वाधिक प्राप्त: 8</li>
</ul>
</li>
</ol>
<p><strong>विंडो रखरखाव:</strong> - उच्चतम प्राप्त इंडेक्स का ट्रैक रखें - लापता इंडेक्स (अंतराल) की सूची बनाए रखें - उच्चतम इंडेक्स के आधार पर विंडो का विस्तार करें - वैकल्पिक: टाइमआउट के बाद पुराने अंतरालों को समाप्त करें</p>
<h3 id="सममत-कज-रचट">सममित कुंजी रैचेट</h3>
<p>symmetric key ratchet (कुंजियों को क्रमिक रूप से अद्यतन करने की प्रक्रिया) 32-byte की एन्क्रिप्शन कुंजियाँ उत्पन्न करती है, जो session tags के साथ समकालित होती हैं।</p>
<h3 id="symmetric-key-ratchet-करमक-कज-परवरतन-ततर-क-उददशय">Symmetric Key Ratchet (क्रमिक कुंजी-परिवर्तन तंत्र) का उद्देश्य</h3>
<ul>
<li>प्रत्येक संदेश के लिए एक विशिष्ट एन्क्रिप्शन कुंजी प्रदान करता है</li>
<li>Session tag ratchet (कुंजी-क्रम आगे बढ़ाने का तंत्र) के साथ समकालित (वही सूचकांक)</li>
<li>प्रेषक आवश्यकतानुसार उत्पन्न कर सकता है</li>
<li>प्राप्तकर्ता टैग प्राप्त होने तक उत्पन्न करना स्थगित कर सकता है</li>
</ul>
<h3 id="सममत-कज-ratchet-करमक-कज-अदयतन-ततर-क-सतर">सममित कुंजी Ratchet (क्रमिक कुंजी-अद्यतन तंत्र) का सूत्र</h3>
<p><strong>आरंभिकरण:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># From DH_INITIALIZE</span>
</span></span><span style="display:flex;"><span>symmKey_ck <span style="color:#f92672">=</span> initial_chain_key  <span style="color:#75715e"># 32 bytes</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># No additional initialization needed</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Unlike session tag ratchet, no constant is derived</span>
</span></span></code></pre></div><p><strong>कुंजी निर्माण (कुंजी N के लिए):</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># Generate key N</span>
</span></span><span style="display:flex;"><span>SYMMKEY_CONSTANT <span style="color:#f92672">=</span> ZEROLEN  <span style="color:#75715e"># Empty string</span>
</span></span><span style="display:flex;"><span>keydata <span style="color:#f92672">=</span> HKDF(symmKey_chainKey_(N<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>), SYMMKEY_CONSTANT, <span style="color:#e6db74">&#34;SymmetricRatchet&#34;</span>, <span style="color:#ae81ff">64</span>)
</span></span><span style="display:flex;"><span>symmKey_chainKey_N <span style="color:#f92672">=</span> keydata[<span style="color:#ae81ff">0</span>:<span style="color:#ae81ff">31</span>]  <span style="color:#75715e"># Chain key for next key</span>
</span></span><span style="display:flex;"><span>key_N <span style="color:#f92672">=</span> keydata[<span style="color:#ae81ff">32</span>:<span style="color:#ae81ff">63</span>]              <span style="color:#75715e"># Session key (32 bytes)</span>
</span></span></code></pre></div><p><strong>पूर्ण अनुक्रम:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># Key 0</span>
</span></span><span style="display:flex;"><span>keydata_0 <span style="color:#f92672">=</span> HKDF(symmKey_ck, ZEROLEN, <span style="color:#e6db74">&#34;SymmetricRatchet&#34;</span>, <span style="color:#ae81ff">64</span>)
</span></span><span style="display:flex;"><span>symmKey_chainKey_0 <span style="color:#f92672">=</span> keydata_0[<span style="color:#ae81ff">0</span>:<span style="color:#ae81ff">31</span>]
</span></span><span style="display:flex;"><span>key_0 <span style="color:#f92672">=</span> keydata_0[<span style="color:#ae81ff">32</span>:<span style="color:#ae81ff">63</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Key 1</span>
</span></span><span style="display:flex;"><span>keydata_1 <span style="color:#f92672">=</span> HKDF(symmKey_chainKey_0, ZEROLEN, <span style="color:#e6db74">&#34;SymmetricRatchet&#34;</span>, <span style="color:#ae81ff">64</span>)
</span></span><span style="display:flex;"><span>symmKey_chainKey_1 <span style="color:#f92672">=</span> keydata_1[<span style="color:#ae81ff">0</span>:<span style="color:#ae81ff">31</span>]
</span></span><span style="display:flex;"><span>key_1 <span style="color:#f92672">=</span> keydata_1[<span style="color:#ae81ff">32</span>:<span style="color:#ae81ff">63</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Key N</span>
</span></span><span style="display:flex;"><span>keydata_N <span style="color:#f92672">=</span> HKDF(symmKey_chainKey_(N<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>), ZEROLEN, <span style="color:#e6db74">&#34;SymmetricRatchet&#34;</span>, <span style="color:#ae81ff">64</span>)
</span></span><span style="display:flex;"><span>symmKey_chainKey_N <span style="color:#f92672">=</span> keydata_N[<span style="color:#ae81ff">0</span>:<span style="color:#ae81ff">31</span>]
</span></span><span style="display:flex;"><span>key_N <span style="color:#f92672">=</span> keydata_N[<span style="color:#ae81ff">32</span>:<span style="color:#ae81ff">63</span>]
</span></span></code></pre></div><h3 id="सममत-कज-रचट-परषक-करयनवयन">सममित कुंजी रैचेट प्रेषक कार्यान्वयन</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">OutboundKeyRatchet</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">__init__</span>(self, symmKey_ck):
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>chainKey <span style="color:#f92672">=</span> symmKey_ck
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>index <span style="color:#f92672">=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">get_key</span>(self, index):
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;&#34;&#34;Generate key for specific index&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Fast-forward to desired index if needed</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">while</span> self<span style="color:#f92672">.</span>index <span style="color:#f92672">&lt;</span> index:
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>index <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>            keydata <span style="color:#f92672">=</span> HKDF(self<span style="color:#f92672">.</span>chainKey, ZEROLEN, <span style="color:#e6db74">&#34;SymmetricRatchet&#34;</span>, <span style="color:#ae81ff">64</span>)
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>chainKey <span style="color:#f92672">=</span> keydata[<span style="color:#ae81ff">0</span>:<span style="color:#ae81ff">31</span>]
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> self<span style="color:#f92672">.</span>index <span style="color:#f92672">==</span> index:
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">return</span> keydata[<span style="color:#ae81ff">32</span>:<span style="color:#ae81ff">63</span>]
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Should not reach here if called correctly</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">raise</span> <span style="color:#a6e22e">ValueError</span>(<span style="color:#e6db74">&#34;Key already generated&#34;</span>)
</span></span></code></pre></div><p><strong>प्रेषक प्रक्रिया:</strong> 1. अगला टैग और उसका सूचकांक N प्राप्त करें 2. सूचकांक N के लिए कुंजी उत्पन्न करें 3. संदेश को एन्क्रिप्ट करने के लिए कुंजी का उपयोग करें 4. कुंजी भंडारण की आवश्यकता नहीं</p>
<h3 id="सममत-कज-ratchet-करमक-कज-परवरतन-ततर-परपतकरत-क-करयनवयन">सममित कुंजी Ratchet (क्रमिक कुंजी-परिवर्तन तंत्र) प्राप्तकर्ता का कार्यान्वयन</h3>
<p><strong>रणनीति 1: Deferred Generation (स्थगित सृजन) (अनुशंसित)</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">InboundKeyRatchet</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">__init__</span>(self, symmKey_ck):
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>chainKey <span style="color:#f92672">=</span> symmKey_ck
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>index <span style="color:#f92672">=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>cache <span style="color:#f92672">=</span> {}  <span style="color:#75715e"># Optional: cache recently used keys</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">get_key</span>(self, index):
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;&#34;&#34;Generate key for specific index&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Check cache first (optional optimization)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> index <span style="color:#f92672">in</span> self<span style="color:#f92672">.</span>cache:
</span></span><span style="display:flex;"><span>            key <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>cache[index]
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">del</span> self<span style="color:#f92672">.</span>cache[index]
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> key
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Fast-forward to desired index</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">while</span> self<span style="color:#f92672">.</span>index <span style="color:#f92672">&lt;</span> index:
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>index <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>            keydata <span style="color:#f92672">=</span> HKDF(self<span style="color:#f92672">.</span>chainKey, ZEROLEN, <span style="color:#e6db74">&#34;SymmetricRatchet&#34;</span>, <span style="color:#ae81ff">64</span>)
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>chainKey <span style="color:#f92672">=</span> keydata[<span style="color:#ae81ff">0</span>:<span style="color:#ae81ff">31</span>]
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> self<span style="color:#f92672">.</span>index <span style="color:#f92672">==</span> index:
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">return</span> keydata[<span style="color:#ae81ff">32</span>:<span style="color:#ae81ff">63</span>]
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">raise</span> <span style="color:#a6e22e">ValueError</span>(<span style="color:#e6db74">&#34;Index already passed&#34;</span>)
</span></span></code></pre></div><p><strong>विलंबित जनरेशन प्रक्रिया:</strong> 1. टैग के साथ ES संदेश प्राप्त करें 2. सूचकांक N प्राप्त करने के लिए टैग का लुकअप करें 3. कुंजियाँ 0 से N तक उत्पन्न करें (यदि पहले से उत्पन्न न हों) 4. संदेश को डिक्रिप्ट करने के लिए कुंजी N का उपयोग करें 5. अब श्रृंखला कुंजी सूचकांक N पर स्थित है</p>
<p><strong>लाभ:</strong> - मेमोरी का न्यूनतम उपयोग - कुंजियाँ केवल आवश्यकता होने पर ही बनाई जाती हैं - सरल कार्यान्वयन</p>
<p><strong>कमियाँ:</strong> - पहली बार उपयोग पर 0 से N तक सभी कुंजियाँ उत्पन्न करनी होंगी - कैशिंग के बिना क्रम से बाहर (out-of-order) संदेशों को संभाल नहीं सकता</p>
<p><strong>रणनीति 2: टैग विंडो के साथ पूर्व-सृजन (वैकल्पिक)</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">InboundKeyRatchet</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">__init__</span>(self, symmKey_ck):
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>chainKey <span style="color:#f92672">=</span> symmKey_ck
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>index <span style="color:#f92672">=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>keys <span style="color:#f92672">=</span> {}  <span style="color:#75715e"># Dictionary: index -&gt; key</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">extend</span>(self, count):
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;&#34;&#34;Pre-generate &#39;count&#39; more keys&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> _ <span style="color:#f92672">in</span> range(count):
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>index <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>            keydata <span style="color:#f92672">=</span> HKDF(self<span style="color:#f92672">.</span>chainKey, ZEROLEN, <span style="color:#e6db74">&#34;SymmetricRatchet&#34;</span>, <span style="color:#ae81ff">64</span>)
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>chainKey <span style="color:#f92672">=</span> keydata[<span style="color:#ae81ff">0</span>:<span style="color:#ae81ff">31</span>]
</span></span><span style="display:flex;"><span>            key <span style="color:#f92672">=</span> keydata[<span style="color:#ae81ff">32</span>:<span style="color:#ae81ff">63</span>]
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>keys[self<span style="color:#f92672">.</span>index] <span style="color:#f92672">=</span> key
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">get_key</span>(self, index):
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;&#34;&#34;Retrieve pre-generated key&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> index <span style="color:#f92672">in</span> self<span style="color:#f92672">.</span>keys:
</span></span><span style="display:flex;"><span>            key <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>keys[index]
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">del</span> self<span style="color:#f92672">.</span>keys[index]
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> key
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">None</span>
</span></span></code></pre></div><p><strong>पूर्व-सृजन प्रक्रिया:</strong> 1. टैग विंडो से मेल खाने वाली कुंजियाँ पहले से उत्पन्न करें (उदा., 32 कुंजियाँ) 2. संदेश संख्या के आधार पर इंडेक्स की गई कुंजियाँ संग्रहीत करें 3. जब टैग प्राप्त हो, तो संबंधित कुंजी ढूँढें 4. टैग उपयोग होने पर विंडो का विस्तार करें</p>
<p><strong>फायदे:</strong> - क्रम से बाहर आने वाले संदेशों को स्वाभाविक रूप से संभालता है - तेज़ कुंजी प्राप्ति (सृजन में कोई देरी नहीं)</p>
<p><strong>कमियां:</strong> - अधिक मेमोरी उपयोग (प्रति कुंजी 32 बाइट्स बनाम प्रति टैग 8 बाइट्स) - कुंजियों को टैगों के साथ समकालित रखना आवश्यक है</p>
<p><strong>मेमोरी तुलना:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># Look-ahead of 160:</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Tags only:  160 × 16 bytes = 2.5 KB</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Tags+Keys:  160 × (16 + 32) bytes = 7.5 KB</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># For 100 sessions:</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Tags only:  250 KB</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Tags+Keys:  750 KB</span>
</span></span></code></pre></div><h3 id="session-tags-सतर-टगस-क-सथ-सममत-रचट-क-समकलन">Session Tags (सत्र टैग्स) के साथ सममित रैचेट का समकालन</h3>
<p><strong>महत्वपूर्ण आवश्यकता</strong>: सेशन टैग का इंडेक्स सममित कुंजी के इंडेक्स के बराबर होना अनिवार्य है</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># Sender</span>
</span></span><span style="display:flex;"><span>tag, index <span style="color:#f92672">=</span> outbound_tagset<span style="color:#f92672">.</span>get_next_tag()
</span></span><span style="display:flex;"><span>key <span style="color:#f92672">=</span> outbound_keyratchet<span style="color:#f92672">.</span>get_key(index)  <span style="color:#75715e"># Same index</span>
</span></span><span style="display:flex;"><span>nonce <span style="color:#f92672">=</span> construct_nonce(index)
</span></span><span style="display:flex;"><span>ciphertext <span style="color:#f92672">=</span> ENCRYPT(key, nonce, payload, tag)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Receiver</span>
</span></span><span style="display:flex;"><span>index <span style="color:#f92672">=</span> inbound_tagset<span style="color:#f92672">.</span>lookup_tag(tag)
</span></span><span style="display:flex;"><span>key <span style="color:#f92672">=</span> inbound_keyratchet<span style="color:#f92672">.</span>get_key(index)  <span style="color:#75715e"># Same index</span>
</span></span><span style="display:flex;"><span>nonce <span style="color:#f92672">=</span> construct_nonce(index)
</span></span><span style="display:flex;"><span>plaintext <span style="color:#f92672">=</span> DECRYPT(key, nonce, ciphertext, tag)
</span></span></code></pre></div><p><strong>विफलता के प्रकार:</strong></p>
<p>यदि समकालन टूट जाए: - decryption (डिक्रिप्शन) के लिए गलत कुंजी का उपयोग - MAC verification (मैसेज ऑथेंटिकेशन कोड सत्यापन) विफल - संदेश अस्वीकार कर दिया गया</p>
<p><strong>निवारण:</strong> - टैग और कुंजी के लिए हमेशा एक ही सूचकांक का उपयोग करें - किसी भी ratchet (क्रमिक-परिवर्तन तंत्र) में सूचकांकों को कभी न छोड़ें - क्रम से बाहर आए संदेशों को सावधानीपूर्वक संभालें</p>
<h3 id="सममत-ratchet-कज-अदयतन-ततर-nonce-एक-बर-परयकत-हन-वल-यदचछक-मन-नरमण">सममित Ratchet (कुंजी-अद्यतन तंत्र) Nonce (एक बार प्रयुक्त होने वाला यादृच्छिक मान) निर्माण</h3>
<p>Nonce (cryptography में एक बार उपयोग होने वाली संख्या) संदेश संख्या से व्युत्पन्न किया जाता है:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">construct_nonce</span>(index):
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    Construct 12-byte nonce for ChaCha20-Poly1305
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    Args:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        index: Message number (0-65535)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    Returns:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        nonce: 12-byte nonce
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># First 4 bytes are always zero</span>
</span></span><span style="display:flex;"><span>    nonce <span style="color:#f92672">=</span> bytearray(<span style="color:#ae81ff">12</span>)
</span></span><span style="display:flex;"><span>    nonce[<span style="color:#ae81ff">0</span>:<span style="color:#ae81ff">4</span>] <span style="color:#f92672">=</span> <span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;</span><span style="color:#ae81ff">\x00\x00\x00\x00</span><span style="color:#e6db74">&#39;</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Last 8 bytes are little-endian message number</span>
</span></span><span style="display:flex;"><span>    nonce[<span style="color:#ae81ff">4</span>:<span style="color:#ae81ff">12</span>] <span style="color:#f92672">=</span> index<span style="color:#f92672">.</span>to_bytes(<span style="color:#ae81ff">8</span>, byteorder<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;little&#39;</span>)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> bytes(nonce)
</span></span></code></pre></div><p><strong>उदाहरण:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>index <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>:     nonce <span style="color:#f92672">=</span> <span style="color:#ae81ff">0x00000000</span> <span style="color:#ae81ff">0000000000000000</span>
</span></span><span style="display:flex;"><span>index <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>:     nonce <span style="color:#f92672">=</span> <span style="color:#ae81ff">0x00000000</span> <span style="color:#ae81ff">0100000000000000</span>
</span></span><span style="display:flex;"><span>index <span style="color:#f92672">=</span> <span style="color:#ae81ff">255</span>:   nonce <span style="color:#f92672">=</span> <span style="color:#ae81ff">0x00000000</span> FF00000000000000
</span></span><span style="display:flex;"><span>index <span style="color:#f92672">=</span> <span style="color:#ae81ff">256</span>:   nonce <span style="color:#f92672">=</span> <span style="color:#ae81ff">0x00000000</span> <span style="color:#ae81ff">0001000000000000</span>
</span></span><span style="display:flex;"><span>index <span style="color:#f92672">=</span> <span style="color:#ae81ff">65535</span>: nonce <span style="color:#f92672">=</span> <span style="color:#ae81ff">0x00000000</span> FFFF000000000000
</span></span></code></pre></div><p><strong>महत्वपूर्ण गुण:</strong> - Nonce (एकबारगी प्रयुक्त मान) किसी tagset (टैग का समूह) में प्रत्येक संदेश के लिए अद्वितीय होते हैं - Nonce कभी दोहराए नहीं जाते (एक-बार-उपयोग टैग यह सुनिश्चित करते हैं) - 8-बाइट काउंटर 2^64 संदेशों की अनुमति देता है (हम केवल 2^16 का उपयोग करते हैं) - Nonce का फ़ॉर्मेट RFC 7539 की काउंटर-आधारित संरचना से मेल खाता है</p>
<hr>
<h2 id="सतर-परबधन">सत्र प्रबंधन</h2>
<h3 id="सतर-सदरभ">सत्र संदर्भ</h3>
<p>सभी इनबाउंड और आउटबाउंड सत्र किसी विशिष्ट संदर्भ से संबंधित होने चाहिए:</p>
<ol>
<li><strong>Router Context</strong>: router के स्वयं उपयोग के लिए सत्र</li>
<li><strong>Destination Context</strong>: किसी विशिष्ट स्थानीय Destination (क्लाइंट एप्लिकेशन) के लिए सत्र</li>
</ol>
<p><strong>महत्वपूर्ण नियम</strong>: कोरिलेशन हमलों को रोकने के लिए संदर्भों के बीच सेशनों को कभी भी साझा नहीं किया जाना चाहिए।</p>
<p><strong>कार्यान्वयन:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">SessionKeyManager</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;&#34;&#34;Context for managing sessions (router or destination)&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">__init__</span>(self, context_id):
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>context_id <span style="color:#f92672">=</span> context_id
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>inbound_sessions <span style="color:#f92672">=</span> {}   <span style="color:#75715e"># far_end_dest -&gt; [sessions]</span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>outbound_sessions <span style="color:#f92672">=</span> {}  <span style="color:#75715e"># far_end_dest -&gt; session</span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>static_keypair <span style="color:#f92672">=</span> generate_keypair()  <span style="color:#75715e"># Context&#39;s identity</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">get_outbound_session</span>(self, destination):
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;&#34;&#34;Get or create outbound session to destination&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> destination <span style="color:#f92672">not</span> <span style="color:#f92672">in</span> self<span style="color:#f92672">.</span>outbound_sessions:
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>outbound_sessions[destination] <span style="color:#f92672">=</span> create_outbound_session(destination)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> self<span style="color:#f92672">.</span>outbound_sessions[destination]
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">add_inbound_session</span>(self, session, destination<span style="color:#f92672">=</span><span style="color:#66d9ef">None</span>):
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;&#34;&#34;Add inbound session, optionally bound to destination&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> destination:
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> destination <span style="color:#f92672">not</span> <span style="color:#f92672">in</span> self<span style="color:#f92672">.</span>inbound_sessions:
</span></span><span style="display:flex;"><span>                self<span style="color:#f92672">.</span>inbound_sessions[destination] <span style="color:#f92672">=</span> []
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>inbound_sessions[destination]<span style="color:#f92672">.</span>append(session)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># Unbound session</span>
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>inbound_sessions[<span style="color:#66d9ef">None</span>]<span style="color:#f92672">.</span>append(session)
</span></span></code></pre></div><p><strong>Java I2P कार्यान्वयन:</strong></p>
<p>Java I2P में, <code>SessionKeyManager</code> क्लास यह कार्यक्षमता प्रदान करता है: - प्रति router एक <code>SessionKeyManager</code> - प्रत्येक स्थानीय destination (गंतव्य) के लिए एक <code>SessionKeyManager</code> - प्रत्येक संदर्भ के भीतर ECIES और ElGamal सत्रों का अलग-अलग प्रबंधन</p>
<h3 id="सशन-बइडग">सेशन बाइंडिंग</h3>
<p><strong>Binding (बाइंडिंग)</strong> किसी सत्र को किसी विशिष्ट दूरस्थ गंतव्य से संबद्ध करती है।</p>
<h3 id="बधत-सतर">बंधित सत्र</h3>
<p><strong>विशेषताएँ:</strong> - NS संदेश में प्रेषक की स्थिर कुंजी शामिल होती है - प्राप्तकर्ता प्रेषक के गंतव्य की पहचान कर सकता है - द्विदिश संचार सक्षम करता है - प्रति गंतव्य एकल आउटबाउंड सत्र - एकाधिक इनबाउंड सत्र हो सकते हैं (संक्रमण के दौरान)</p>
<p><strong>उपयोग के मामले:</strong> - स्ट्रीमिंग कनेक्शन (TCP जैसा) - उत्तर-सक्षम डेटाग्राम - कोई भी प्रोटोकॉल जिसे अनुरोध/प्रतिक्रिया की आवश्यकता हो</p>
<p><strong>बाइंडिंग प्रक्रिया:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># Alice creates bound outbound session</span>
</span></span><span style="display:flex;"><span>outbound_session <span style="color:#f92672">=</span> OutboundSession(
</span></span><span style="display:flex;"><span>    destination<span style="color:#f92672">=</span>bob_destination,
</span></span><span style="display:flex;"><span>    static_key<span style="color:#f92672">=</span>alice_static_key,
</span></span><span style="display:flex;"><span>    bound<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Alice sends NS with static key</span>
</span></span><span style="display:flex;"><span>ns_message <span style="color:#f92672">=</span> build_ns_message(
</span></span><span style="display:flex;"><span>    ephemeral_key<span style="color:#f92672">=</span>alice_ephemeral_key,
</span></span><span style="display:flex;"><span>    static_key<span style="color:#f92672">=</span>alice_static_key,  <span style="color:#75715e"># Included for binding</span>
</span></span><span style="display:flex;"><span>    payload<span style="color:#f92672">=</span>data
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Bob receives NS</span>
</span></span><span style="display:flex;"><span>bob_receives_ns(ns_message)
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Bob extracts Alice&#39;s static key</span>
</span></span><span style="display:flex;"><span>alice_static_key <span style="color:#f92672">=</span> decrypt_static_key_section(ns_message)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Bob looks up Alice&#39;s destination (from bundled LeaseSet)</span>
</span></span><span style="display:flex;"><span>alice_destination <span style="color:#f92672">=</span> lookup_destination_by_static_key(alice_static_key)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Bob creates bound inbound session</span>
</span></span><span style="display:flex;"><span>inbound_session <span style="color:#f92672">=</span> InboundSession(
</span></span><span style="display:flex;"><span>    destination<span style="color:#f92672">=</span>alice_destination,
</span></span><span style="display:flex;"><span>    bound<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Bob pairs with outbound session</span>
</span></span><span style="display:flex;"><span>outbound_session <span style="color:#f92672">=</span> OutboundSession(
</span></span><span style="display:flex;"><span>    destination<span style="color:#f92672">=</span>alice_destination,
</span></span><span style="display:flex;"><span>    bound<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>
</span></span><span style="display:flex;"><span>)
</span></span></code></pre></div><p><strong>लाभ:</strong> 1. <strong>Ephemeral-Ephemeral DH</strong> (अस्थायी-कुंजियों वाला Diffie-Hellman): उत्तर ee DH का उपयोग करता है (पूर्ण फॉरवर्ड सीक्रेसी) 2. <strong>सत्र निरंतरता</strong>: Ratchets (कुंजी-अग्रसरण तंत्र) उसी गंतव्य से जुड़ाव बनाए रखते हैं 3. <strong>सुरक्षा</strong>: सत्र हाइजैकिंग को रोकता है (स्थिर कुंजी द्वारा प्रमाणित) 4. <strong>दक्षता</strong>: प्रति गंतव्य एक ही सत्र (डुप्लीकेशन नहीं)</p>
<h3 id="unbound-सतर">Unbound सत्र</h3>
<p><strong>विशेषताएँ:</strong> - NS message में कोई स्थिर कुंजी नहीं (flags अनुभाग में सभी शून्य) - प्राप्तकर्ता प्रेषक की पहचान नहीं कर सकता - केवल एक-तरफ़ा संचार - एक ही गंतव्य के लिए एकाधिक सत्रों की अनुमति है</p>
<p><strong>उपयोग के मामले:</strong> - रॉ डेटाग्राम (भेजें और भूल जाएँ) - अनाम प्रकाशन - प्रसारण-शैली संदेश भेजना</p>
<p><strong>विशेषताएँ:</strong> - अधिक गुमनाम (प्रेषक की पहचान नहीं होती) - अधिक दक्ष (हैंडशेक में 1 DH (Diffie-Hellman कुंजी-विनिमय) बनाम 2 DH) - उत्तर संभव नहीं (प्राप्तकर्ता को यह नहीं पता कि कहाँ उत्तर देना है) - session ratcheting नहीं (क्रमिक कुंजी-परिवर्तन तंत्र; एक बार या सीमित उपयोग)</p>
<h3 id="सतर-यगमन">सत्र युग्मन</h3>
<p><strong>पेयरिंग</strong> द्विदिश संचार के लिए एक इनबाउंड सत्र को एक आउटबाउंड सत्र से जोड़ती है।</p>
<h3 id="यगमत-सतर-बनन">युग्मित सत्र बनाना</h3>
<p><strong>एलिस का दृष्टिकोण (प्रारंभकर्ता):</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># Create outbound session to Bob</span>
</span></span><span style="display:flex;"><span>outbound_session <span style="color:#f92672">=</span> create_outbound_session(bob_destination)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Create paired inbound session</span>
</span></span><span style="display:flex;"><span>inbound_session <span style="color:#f92672">=</span> create_inbound_session(
</span></span><span style="display:flex;"><span>    paired_with<span style="color:#f92672">=</span>outbound_session,
</span></span><span style="display:flex;"><span>    bound_to<span style="color:#f92672">=</span>bob_destination
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Link them</span>
</span></span><span style="display:flex;"><span>outbound_session<span style="color:#f92672">.</span>paired_inbound <span style="color:#f92672">=</span> inbound_session
</span></span><span style="display:flex;"><span>inbound_session<span style="color:#f92672">.</span>paired_outbound <span style="color:#f92672">=</span> outbound_session
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Send NS message</span>
</span></span><span style="display:flex;"><span>send_ns_message(outbound_session, payload)
</span></span></code></pre></div><p><strong>Bob का दृष्टिकोण (responder, उत्तरदाता):</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># Receive NS message</span>
</span></span><span style="display:flex;"><span>ns_message <span style="color:#f92672">=</span> receive_ns_message()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Create inbound session</span>
</span></span><span style="display:flex;"><span>inbound_session <span style="color:#f92672">=</span> create_inbound_session_from_ns(ns_message)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># If NS contains static key (bound):</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> ns_message<span style="color:#f92672">.</span>has_static_key():
</span></span><span style="display:flex;"><span>    alice_destination <span style="color:#f92672">=</span> extract_destination(ns_message)
</span></span><span style="display:flex;"><span>    inbound_session<span style="color:#f92672">.</span>bind_to(alice_destination)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Create paired outbound session</span>
</span></span><span style="display:flex;"><span>    outbound_session <span style="color:#f92672">=</span> create_outbound_session(alice_destination)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Link them</span>
</span></span><span style="display:flex;"><span>    outbound_session<span style="color:#f92672">.</span>paired_inbound <span style="color:#f92672">=</span> inbound_session
</span></span><span style="display:flex;"><span>    inbound_session<span style="color:#f92672">.</span>paired_outbound <span style="color:#f92672">=</span> outbound_session
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Send NSR</span>
</span></span><span style="display:flex;"><span>send_nsr_message(inbound_session, outbound_session, payload)
</span></span></code></pre></div><h3 id="session-pairing-सतर-पयरग-क-लभ">Session Pairing (सत्र पेयरिंग) के लाभ</h3>
<ol>
<li><strong>इन-बैंड ACKs</strong>: अलग clove (garlic संदेश का उप-भाग) के बिना संदेशों की पुष्टि की जा सकती है</li>
<li><strong>Efficient Ratcheting (कुंजी-अपडेट तंत्र)</strong>: दोनों दिशाओं का रैचेट एक-साथ आगे बढ़ता है</li>
<li><strong>फ़्लो कंट्रोल</strong>: युग्मित सत्रों के पार back-pressure (उल्टा-दबाव आधारित नियंत्रण) लागू किया जा सकता है</li>
<li><strong>स्टेट कंसिस्टेंसी</strong>: समकालित अवस्था बनाए रखना आसान होता है</li>
</ol>
<h3 id="सतर-यगमन-क-नयम">सत्र युग्मन के नियम</h3>
<ul>
<li>आउटबाउंड सत्र अयुग्मित हो सकता है (अबंधित NS)</li>
<li>बंधित NS के लिए इनबाउंड सत्र युग्मित होना चाहिए</li>
<li>युग्मन सत्र निर्माण के समय होता है, बाद में नहीं</li>
<li>युग्मित सत्रों में समान गंतव्य बाइंडिंग होती है</li>
<li>Ratchets (कुंजी-रोलओवर तंत्र) स्वतंत्र रूप से होते हैं, लेकिन समन्वित रहते हैं</li>
</ul>
<h3 id="सतर-जवनचकर">सत्र जीवनचक्र</h3>
<h3 id="सतर-जवनचकर-नरमण-चरण">सत्र जीवनचक्र: निर्माण चरण</h3>
<p><strong>निर्गामी सत्र निर्माण (Alice):</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">create_outbound_session</span>(destination, bound<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>):
</span></span><span style="display:flex;"><span>    session <span style="color:#f92672">=</span> OutboundSession()
</span></span><span style="display:flex;"><span>    session<span style="color:#f92672">.</span>destination <span style="color:#f92672">=</span> destination
</span></span><span style="display:flex;"><span>    session<span style="color:#f92672">.</span>bound <span style="color:#f92672">=</span> bound
</span></span><span style="display:flex;"><span>    session<span style="color:#f92672">.</span>state <span style="color:#f92672">=</span> SessionState<span style="color:#f92672">.</span>NEW
</span></span><span style="display:flex;"><span>    session<span style="color:#f92672">.</span>created_time <span style="color:#f92672">=</span> now()
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Generate keys for NS message</span>
</span></span><span style="display:flex;"><span>    session<span style="color:#f92672">.</span>ephemeral_keypair <span style="color:#f92672">=</span> generate_elg2_keypair()
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> bound:
</span></span><span style="display:flex;"><span>        session<span style="color:#f92672">.</span>static_key <span style="color:#f92672">=</span> context<span style="color:#f92672">.</span>static_keypair<span style="color:#f92672">.</span>public_key
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Will be populated after NSR received</span>
</span></span><span style="display:flex;"><span>    session<span style="color:#f92672">.</span>outbound_tagset <span style="color:#f92672">=</span> <span style="color:#66d9ef">None</span>
</span></span><span style="display:flex;"><span>    session<span style="color:#f92672">.</span>inbound_tagset <span style="color:#f92672">=</span> <span style="color:#66d9ef">None</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> session
</span></span></code></pre></div><p><strong>इनबाउंड सत्र निर्माण (Bob):</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">create_inbound_session_from_ns</span>(ns_message):
</span></span><span style="display:flex;"><span>    session <span style="color:#f92672">=</span> InboundSession()
</span></span><span style="display:flex;"><span>    session<span style="color:#f92672">.</span>state <span style="color:#f92672">=</span> SessionState<span style="color:#f92672">.</span>ESTABLISHED
</span></span><span style="display:flex;"><span>    session<span style="color:#f92672">.</span>created_time <span style="color:#f92672">=</span> now()
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Extract from NS</span>
</span></span><span style="display:flex;"><span>    session<span style="color:#f92672">.</span>remote_ephemeral_key <span style="color:#f92672">=</span> ns_message<span style="color:#f92672">.</span>ephemeral_key
</span></span><span style="display:flex;"><span>    session<span style="color:#f92672">.</span>remote_static_key <span style="color:#f92672">=</span> ns_message<span style="color:#f92672">.</span>static_key
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> session<span style="color:#f92672">.</span>remote_static_key:
</span></span><span style="display:flex;"><span>        session<span style="color:#f92672">.</span>bound <span style="color:#f92672">=</span> <span style="color:#66d9ef">True</span>
</span></span><span style="display:flex;"><span>        session<span style="color:#f92672">.</span>destination <span style="color:#f92672">=</span> lookup_destination(session<span style="color:#f92672">.</span>remote_static_key)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>        session<span style="color:#f92672">.</span>bound <span style="color:#f92672">=</span> <span style="color:#66d9ef">False</span>
</span></span><span style="display:flex;"><span>        session<span style="color:#f92672">.</span>destination <span style="color:#f92672">=</span> <span style="color:#66d9ef">None</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Generate keys for NSR</span>
</span></span><span style="display:flex;"><span>    session<span style="color:#f92672">.</span>ephemeral_keypair <span style="color:#f92672">=</span> generate_elg2_keypair()
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Create tagsets from KDF</span>
</span></span><span style="display:flex;"><span>    session<span style="color:#f92672">.</span>inbound_tagset <span style="color:#f92672">=</span> create_tagset_from_nsr()
</span></span><span style="display:flex;"><span>    session<span style="color:#f92672">.</span>outbound_tagset <span style="color:#f92672">=</span> create_tagset_from_nsr()
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> session
</span></span></code></pre></div><h3 id="सतर-जवनचकर-सकरय-चरण">सत्र जीवनचक्र: सक्रिय चरण</h3>
<p><strong>स्थिति संक्रमण:</strong></p>
<pre tabindex="0"><code>NEW (outbound only)
  ↓
  NS sent
  ↓
PENDING_REPLY (outbound only)
  ↓
  NSR received
  ↓
ESTABLISHED
  ↓
  ES messages exchanged
  ↓
ESTABLISHED (ongoing)
  ↓
  (optional) RATCHETING
  ↓
ESTABLISHED
</code></pre><p><strong>सक्रिय सत्र रखरखाव:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">maintain_active_session</span>(session):
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Update last activity time</span>
</span></span><span style="display:flex;"><span>    session<span style="color:#f92672">.</span>last_activity <span style="color:#f92672">=</span> now()
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Check for ratchet needed</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> session<span style="color:#f92672">.</span>outbound_tagset<span style="color:#f92672">.</span>needs_ratchet():
</span></span><span style="display:flex;"><span>        initiate_ratchet(session)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Check for incoming ratchet</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> received_nextkey_block():
</span></span><span style="display:flex;"><span>        process_ratchet(session)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Trim old tags from inbound tagset</span>
</span></span><span style="display:flex;"><span>    session<span style="color:#f92672">.</span>inbound_tagset<span style="color:#f92672">.</span>expire_old_tags()
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Check session health</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> session<span style="color:#f92672">.</span>idle_time() <span style="color:#f92672">&gt;</span> SESSION_TIMEOUT:
</span></span><span style="display:flex;"><span>        mark_session_idle(session)
</span></span></code></pre></div><h3 id="सतर-जवनचकर-समपत-चरण">सत्र जीवनचक्र: समाप्ति चरण</h3>
<p><strong>सत्र समय-सीमा मान:</strong></p>
<table style="width:100%; border-collapse:collapse; margin-bottom:1.5rem;">
  <thead>
    <tr>
      <th style="border:1px solid var(--color-border); padding:0.5rem; background:var(--color-bg-secondary); text-align:left;">Session Type</th>
      <th style="border:1px solid var(--color-border); padding:0.5rem; background:var(--color-bg-secondary); text-align:center;">Sender Timeout</th>
      <th style="border:1px solid var(--color-border); padding:0.5rem; background:var(--color-bg-secondary); text-align:center;">Receiver Timeout</th>
      <th style="border:1px solid var(--color-border); padding:0.5rem; background:var(--color-bg-secondary); text-align:left;">Notes</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">NSR tagset</td>
      <td style="border:1px solid var(--color-border); padding:0.5rem; text-align:center;">N/A</td>
      <td style="border:1px solid var(--color-border); padding:0.5rem; text-align:center;">3 minutes</td>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">Short-lived</td>
    </tr>
    <tr>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">ES tagset 0</td>
      <td style="border:1px solid var(--color-border); padding:0.5rem; text-align:center;">8 minutes</td>
      <td style="border:1px solid var(--color-border); padding:0.5rem; text-align:center;">10 minutes</td>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">Initial</td>
    </tr>
    <tr>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">ES tagset 1+</td>
      <td style="border:1px solid var(--color-border); padding:0.5rem; text-align:center;">8 minutes</td>
      <td style="border:1px solid var(--color-border); padding:0.5rem; text-align:center;">10 minutes</td>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">Ratcheted</td>
    </tr>
    <tr>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">Old tagset</td>
      <td style="border:1px solid var(--color-border); padding:0.5rem; text-align:center;">N/A</td>
      <td style="border:1px solid var(--color-border); padding:0.5rem; text-align:center;">3 minutes</td>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">After ratchet</td>
    </tr>
  </tbody>
</table>
**अवधि-समाप्ति तर्क:**
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">check_session_expiration</span>():
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> session <span style="color:#f92672">in</span> active_sessions:
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Outbound session expiration (sender)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> session<span style="color:#f92672">.</span>is_outbound():
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> session<span style="color:#f92672">.</span>idle_time() <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">8</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">60</span>:  <span style="color:#75715e"># 8 minutes</span>
</span></span><span style="display:flex;"><span>                expire_outbound_session(session)
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Inbound session expiration (receiver)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> session<span style="color:#f92672">.</span>idle_time() <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">10</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">60</span>:  <span style="color:#75715e"># 10 minutes</span>
</span></span><span style="display:flex;"><span>                expire_inbound_session(session)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Old tagsets (after ratchet)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> tagset <span style="color:#f92672">in</span> old_tagsets:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> tagset<span style="color:#f92672">.</span>age() <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">3</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">60</span>:  <span style="color:#75715e"># 3 minutes</span>
</span></span><span style="display:flex;"><span>            delete_tagset(tagset)
</span></span></code></pre></div><p><strong>महत्वपूर्ण नियम</strong>: समकालिकता भंग से बचाने के लिए आउटबाउंड सत्र इनबाउंड सत्रों से पहले अवश्य समाप्त होने चाहिए।</p>
<p><strong>सुचारू समापन:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">terminate_session</span>(session, reason<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>):
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Send Termination block (if implemented)</span>
</span></span><span style="display:flex;"><span>    send_termination_block(session, reason)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Mark session for deletion</span>
</span></span><span style="display:flex;"><span>    session<span style="color:#f92672">.</span>state <span style="color:#f92672">=</span> SessionState<span style="color:#f92672">.</span>TERMINATED
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Keep session briefly for final messages</span>
</span></span><span style="display:flex;"><span>    schedule_deletion(session, delay<span style="color:#f92672">=</span><span style="color:#ae81ff">30</span>)  <span style="color:#75715e"># 30 seconds</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Notify paired session</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> session<span style="color:#f92672">.</span>paired_session:
</span></span><span style="display:flex;"><span>        session<span style="color:#f92672">.</span>paired_session<span style="color:#f92672">.</span>mark_remote_terminated()
</span></span></code></pre></div><h3 id="कई-ns-सदश">कई NS संदेश</h3>
<p><strong>परिदृश्य</strong>: ऐलिस का NS संदेश (एक संदेश प्रकार) खो जाता है या NSR उत्तर (एक संदेश प्रकार) खो जाता है।</p>
<p><strong>ऐलिस का व्यवहार:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">OutboundSession</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">__init__</span>(self):
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>ns_messages_sent <span style="color:#f92672">=</span> []
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>ns_timer <span style="color:#f92672">=</span> <span style="color:#66d9ef">None</span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>max_ns_attempts <span style="color:#f92672">=</span> <span style="color:#ae81ff">5</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">send_ns_message</span>(self, payload):
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Generate new ephemeral key for each NS</span>
</span></span><span style="display:flex;"><span>        ephemeral_key <span style="color:#f92672">=</span> generate_elg2_keypair()
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        ns_message <span style="color:#f92672">=</span> build_ns_message(
</span></span><span style="display:flex;"><span>            ephemeral_key<span style="color:#f92672">=</span>ephemeral_key,
</span></span><span style="display:flex;"><span>            static_key<span style="color:#f92672">=</span>self<span style="color:#f92672">.</span>static_key,
</span></span><span style="display:flex;"><span>            payload<span style="color:#f92672">=</span>payload
</span></span><span style="display:flex;"><span>        )
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Store state for this NS</span>
</span></span><span style="display:flex;"><span>        ns_state <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;ephemeral_key&#39;</span>: ephemeral_key,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;chainkey&#39;</span>: compute_chainkey(ns_message),
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;hash&#39;</span>: compute_hash(ns_message),
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;tagset&#39;</span>: derive_nsr_tagset(ns_message),
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;sent_time&#39;</span>: now()
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>ns_messages_sent<span style="color:#f92672">.</span>append(ns_state)
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Send message</span>
</span></span><span style="display:flex;"><span>        send_message(ns_message)
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Set timer for retry</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> self<span style="color:#f92672">.</span>ns_timer:
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>ns_timer <span style="color:#f92672">=</span> set_timer(<span style="color:#ae81ff">1.0</span>, self<span style="color:#f92672">.</span>on_ns_timeout)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">on_ns_timeout</span>(self):
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> len(self<span style="color:#f92672">.</span>ns_messages_sent) <span style="color:#f92672">&gt;=</span> self<span style="color:#f92672">.</span>max_ns_attempts:
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># Give up</span>
</span></span><span style="display:flex;"><span>            fail_session(<span style="color:#e6db74">&#34;No NSR received after </span><span style="color:#e6db74">{self.max_ns_attempts}</span><span style="color:#e6db74"> attempts&#34;</span>)
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Retry with new NS message</span>
</span></span><span style="display:flex;"><span>        send_ns_message(self<span style="color:#f92672">.</span>payload)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">on_nsr_received</span>(self, nsr_message):
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Cancel timer</span>
</span></span><span style="display:flex;"><span>        cancel_timer(self<span style="color:#f92672">.</span>ns_timer)
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Find which NS this NSR responds to</span>
</span></span><span style="display:flex;"><span>        tag <span style="color:#f92672">=</span> nsr_message<span style="color:#f92672">.</span>tag
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> ns_state <span style="color:#f92672">in</span> self<span style="color:#f92672">.</span>ns_messages_sent:
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> tag <span style="color:#f92672">in</span> ns_state[<span style="color:#e6db74">&#39;tagset&#39;</span>]:
</span></span><span style="display:flex;"><span>                <span style="color:#75715e"># This NSR corresponds to this NS</span>
</span></span><span style="display:flex;"><span>                self<span style="color:#f92672">.</span>active_ns_state <span style="color:#f92672">=</span> ns_state
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">break</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Process NSR and complete handshake</span>
</span></span><span style="display:flex;"><span>        complete_handshake(nsr_message, self<span style="color:#f92672">.</span>active_ns_state)
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Discard other NS states</span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>ns_messages_sent <span style="color:#f92672">=</span> []
</span></span></code></pre></div><p><strong>महत्वपूर्ण गुण:</strong></p>
<ol>
<li><strong>अद्वितीय अस्थायी कुंजियाँ</strong>: प्रत्येक NS एक भिन्न अस्थायी कुंजी का उपयोग करता है</li>
<li><strong>स्वतंत्र हैंडशेक्स</strong>: प्रत्येक NS अलग हैंडशेक स्टेट बनाता है</li>
<li><strong>NSR सहसंबंध</strong>: NSR टैग यह पहचानता है कि वह किस NS को उत्तर देता है</li>
<li><strong>स्टेट क्लीनअप</strong>: अप्रयुक्त NS स्टेट्स सफल NSR के बाद हटा दिए जाते हैं</li>
</ol>
<p><strong>हमलों की रोकथाम:</strong></p>
<p>संसाधन समाप्ति को रोकने के लिए:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># Limit NS sending rate</span>
</span></span><span style="display:flex;"><span>max_ns_rate <span style="color:#f92672">=</span> <span style="color:#ae81ff">5</span> per <span style="color:#ae81ff">10</span> seconds per destination
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Limit total NS attempts</span>
</span></span><span style="display:flex;"><span>max_ns_attempts <span style="color:#f92672">=</span> <span style="color:#ae81ff">5</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Limit total pending NS states</span>
</span></span><span style="display:flex;"><span>max_pending_ns <span style="color:#f92672">=</span> <span style="color:#ae81ff">10</span> per context
</span></span></code></pre></div><h3 id="कई-nsr-सदश">कई NSR संदेश</h3>
<p><strong>परिदृश्य</strong>: बॉब कई NSR भेजता है (उदाहरण के लिए, उत्तर डेटा कई संदेशों में विभाजित)।</p>
<p><strong>Bob का व्यवहार:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">InboundSession</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">send_nsr_replies</span>(self, payload_chunks):
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># One NS received, multiple NSRs to send</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> chunk <span style="color:#f92672">in</span> payload_chunks:
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># Generate new ephemeral key for each NSR</span>
</span></span><span style="display:flex;"><span>            ephemeral_key <span style="color:#f92672">=</span> generate_elg2_keypair()
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># Get next tag from NSR tagset</span>
</span></span><span style="display:flex;"><span>            tag <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>nsr_tagset<span style="color:#f92672">.</span>get_next_tag()
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>            nsr_message <span style="color:#f92672">=</span> build_nsr_message(
</span></span><span style="display:flex;"><span>                tag<span style="color:#f92672">=</span>tag,
</span></span><span style="display:flex;"><span>                ephemeral_key<span style="color:#f92672">=</span>ephemeral_key,
</span></span><span style="display:flex;"><span>                payload<span style="color:#f92672">=</span>chunk
</span></span><span style="display:flex;"><span>            )
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>            send_message(nsr_message)
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Wait for ES message from Alice</span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>state <span style="color:#f92672">=</span> SessionState<span style="color:#f92672">.</span>AWAITING_ES
</span></span></code></pre></div><p><strong>एलिस का व्यवहार:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">OutboundSession</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">on_nsr_received</span>(self, nsr_message):
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> self<span style="color:#f92672">.</span>state <span style="color:#f92672">==</span> SessionState<span style="color:#f92672">.</span>PENDING_REPLY:
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># First NSR received</span>
</span></span><span style="display:flex;"><span>            complete_handshake(nsr_message)
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>state <span style="color:#f92672">=</span> SessionState<span style="color:#f92672">.</span>ESTABLISHED
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># Create ES sessions</span>
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>es_outbound_tagset <span style="color:#f92672">=</span> derive_es_outbound_tagset()
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>es_inbound_tagset <span style="color:#f92672">=</span> derive_es_inbound_tagset()
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># Send ES message (ACK)</span>
</span></span><span style="display:flex;"><span>            send_es_message(empty_payload)
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">elif</span> self<span style="color:#f92672">.</span>state <span style="color:#f92672">==</span> SessionState<span style="color:#f92672">.</span>ESTABLISHED:
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># Additional NSR received</span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># Decrypt and process payload</span>
</span></span><span style="display:flex;"><span>            payload <span style="color:#f92672">=</span> decrypt_nsr_payload(nsr_message)
</span></span><span style="display:flex;"><span>            process_payload(payload)
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># These NSRs are from other NS attempts, ignore handshake</span>
</span></span></code></pre></div><p><strong>Bob की सफाई:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">InboundSession</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">on_es_received</span>(self, es_message):
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># First ES received from Alice</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># This confirms which NSR Alice used</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Clean up other handshake states</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> other_ns_state <span style="color:#f92672">in</span> self<span style="color:#f92672">.</span>pending_ns_states:
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> other_ns_state <span style="color:#f92672">!=</span> self<span style="color:#f92672">.</span>active_ns_state:
</span></span><span style="display:flex;"><span>                delete_ns_state(other_ns_state)
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Delete unused NSR tagsets</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> tagset <span style="color:#f92672">in</span> self<span style="color:#f92672">.</span>nsr_tagsets:
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> tagset <span style="color:#f92672">!=</span> self<span style="color:#f92672">.</span>active_nsr_tagset:
</span></span><span style="display:flex;"><span>                delete_tagset(tagset)
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>state <span style="color:#f92672">=</span> SessionState<span style="color:#f92672">.</span>ESTABLISHED
</span></span></code></pre></div><p><strong>महत्वपूर्ण गुणधर्म:</strong></p>
<ol>
<li><strong>एकाधिक NSR अनुमत हैं</strong>: बॉब प्रति NS कई NSR भेज सकता है</li>
<li><strong>अलग-अलग अस्थायी कुंजियाँ (ephemeral keys)</strong>: प्रत्येक NSR को एक अद्वितीय अस्थायी कुंजी का उपयोग करना चाहिए</li>
<li><strong>एक ही NSR tagset</strong>: एक NS के लिए सभी NSR एक ही tagset (टैगों का समूह) का उपयोग करते हैं</li>
<li><strong>पहला ES प्रभावी होता है</strong>: ऐलिस का पहला ES तय करता है कि कौन-सा NSR सफल हुआ</li>
<li><strong>ES के बाद साफ-सफाई</strong>: ES प्राप्त होने के बाद बॉब अनुपयोगी स्टेट्स (स्थिति जानकारी) त्याग देता है</li>
</ol>
<h3 id="सतर-सटट-मशन">सत्र स्टेट मशीन</h3>
<p><strong>पूर्ण अवस्था आरेख:</strong></p>
<pre tabindex="0"><code>                    Outbound Session                    Inbound Session

                         NEW
                          |
                     send NS
                          |
                   PENDING_REPLY -------------------- receive NS ---&gt; ESTABLISHED
                          |                                                |
                   receive NSR                                        send NSR
                          |                                                |
                    ESTABLISHED &lt;---------- receive ES ------------- AWAITING_ES
                          |                     |                          |
                    ┌─────┴─────┐               |                    receive ES
                    |           |               |                          |
              send ES      receive ES           |                    ESTABLISHED
                    |           |               |                          |
                    └─────┬─────┘               |                ┌─────────┴─────────┐
                          |                     |                |                   |
                          |                     |          send ES              receive ES
                          |                     |                |                   |
                          |                     |                └─────────┬─────────┘
                          |                     |                          |
                          └─────────────────────┴──────────────────────────┘
                                              ACTIVE
                                                |
                                         idle timeout
                                                |
                                             EXPIRED
</code></pre><p><strong>स्थिति विवरण:</strong></p>
<ul>
<li><strong>NEW</strong>: आउटबाउंड सत्र बनाया गया, अभी तक कोई NS नहीं भेजा गया</li>
<li><strong>PENDING_REPLY</strong>: NS भेजा, NSR की प्रतीक्षा</li>
<li><strong>AWAITING_ES</strong>: NSR भेजा, Alice से पहले ES की प्रतीक्षा</li>
<li><strong>ESTABLISHED</strong>: हैंडशेक पूर्ण, ES भेजना/प्राप्त करना संभव है</li>
<li><strong>ACTIVE</strong>: ES संदेशों का सक्रिय रूप से आदान-प्रदान हो रहा है</li>
<li><strong>RATCHETING</strong>: DH ratchet (Diffie-Hellman आधारित क्रमिक कुंजी-परिवर्तन प्रक्रिया) जारी है (ACTIVE का उपसमुच्चय)</li>
<li><strong>EXPIRED</strong>: सत्र का समय समाप्त, हटाए जाने की प्रतीक्षा में</li>
<li><strong>TERMINATED</strong>: सत्र को स्पष्ट रूप से समाप्त किया गया</li>
</ul>
<hr>
<h2 id="पलड-पररप">पेलोड प्रारूप</h2>
<p>सभी ECIES (Elliptic Curve Integrated Encryption Scheme, दीर्घवृत्तीय वक्र एकीकृत एन्क्रिप्शन योजना) संदेशों (NS, NSR, ES) का पेलोड अनुभाग NTCP2 के समान ब्लॉक-आधारित प्रारूप का उपयोग करता है.</p>
<h3 id="बलक-सरचन">ब्लॉक संरचना</h3>
<p><strong>सामान्य प्रारूप:</strong></p>
<pre tabindex="0"><code>+----+----+----+----+----+----+----+----+
|blk |  size   |       data             |
+----+----+----+                        +
|                                       |
~               ...                     ~
|                                       |
+----+----+----+----+----+----+----+----+
|blk |  size   |       data             |
+----+----+----+                        +
|                                       |
~               ...                     ~
|                                       |
+----+----+----+----+----+----+----+----+
</code></pre><p><strong>फ़ील्ड्स:</strong></p>
<ul>
<li><code>blk</code>: 1 बाइट - ब्लॉक प्रकार संख्या</li>
<li><code>size</code>: 2 बाइट - Big-endian (बाइट क्रम जिसमें सबसे महत्वपूर्ण बाइट पहले आती है) डेटा फ़ील्ड का आकार (0-65516)</li>
<li><code>data</code>: परिवर्तनीय लंबाई - ब्लॉक-विशिष्ट डेटा</li>
</ul>
<p><strong>सीमाएँ:</strong></p>
<ul>
<li>अधिकतम ChaChaPoly (एन्क्रिप्शन स्कीम) फ्रेम: 65535 बाइट्स</li>
<li>Poly1305 MAC (संदेश प्रमाणीकरण कोड): 16 बाइट्स</li>
<li>अधिकतम कुल ब्लॉक: 65519 बाइट्स (65535 - 16)</li>
<li>अधिकतम एकल ब्लॉक: 65519 बाइट्स (3-बाइट हेडर सहित)</li>
<li>अधिकतम एकल ब्लॉक डेटा: 65516 बाइट्स</li>
</ul>
<h3 id="बलक-परकर">ब्लॉक प्रकार</h3>
<p><strong>परिभाषित ब्लॉक प्रकार:</strong></p>
<table style="width:100%; border-collapse:collapse; margin-bottom:1.5rem;">
  <thead>
    <tr>
      <th style="border:1px solid var(--color-border); padding:0.5rem; background:var(--color-bg-secondary); text-align:center;">Type</th>
      <th style="border:1px solid var(--color-border); padding:0.5rem; background:var(--color-bg-secondary); text-align:left;">Name</th>
      <th style="border:1px solid var(--color-border); padding:0.5rem; background:var(--color-bg-secondary); text-align:left;">Size</th>
      <th style="border:1px solid var(--color-border); padding:0.5rem; background:var(--color-bg-secondary); text-align:left;">Status</th>
      <th style="border:1px solid var(--color-border); padding:0.5rem; background:var(--color-bg-secondary); text-align:left;">Usage</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="border:1px solid var(--color-border); padding:0.5rem; text-align:center;">0</td>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">DateTime</td>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">7 bytes</td>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">Implemented</td>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">Required in NS</td>
    </tr>
    <tr>
      <td style="border:1px solid var(--color-border); padding:0.5rem; text-align:center;">1-3</td>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">Reserved</td>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">-</td>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">-</td>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">Future use</td>
    </tr>
    <tr>
      <td style="border:1px solid var(--color-border); padding:0.5rem; text-align:center;">4</td>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">Termination</td>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">9+ bytes</td>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">Unimplemented</td>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">Session termination</td>
    </tr>
    <tr>
      <td style="border:1px solid var(--color-border); padding:0.5rem; text-align:center;">5</td>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">Options</td>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">21+ bytes</td>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">Unimplemented</td>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">Session options</td>
    </tr>
    <tr>
      <td style="border:1px solid var(--color-border); padding:0.5rem; text-align:center;">6</td>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">MessageNumbers</td>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">5 bytes</td>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">Unimplemented</td>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">PN value</td>
    </tr>
    <tr>
      <td style="border:1px solid var(--color-border); padding:0.5rem; text-align:center;">7</td>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">NextKey</td>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">3 or 35 bytes</td>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">Implemented</td>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">DH ratchet</td>
    </tr>
    <tr>
      <td style="border:1px solid var(--color-border); padding:0.5rem; text-align:center;">8</td>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">ACK</td>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">4+ bytes</td>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">Implemented</td>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">Message acknowledgment</td>
    </tr>
    <tr>
      <td style="border:1px solid var(--color-border); padding:0.5rem; text-align:center;">9</td>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">ACK Request</td>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">3 bytes</td>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">Implemented</td>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">Request ACK</td>
    </tr>
    <tr>
      <td style="border:1px solid var(--color-border); padding:0.5rem; text-align:center;">10</td>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">Reserved</td>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">-</td>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">-</td>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">Future use</td>
    </tr>
    <tr>
      <td style="border:1px solid var(--color-border); padding:0.5rem; text-align:center;">11</td>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">Garlic Clove</td>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">Variable</td>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">Implemented</td>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">Application data</td>
    </tr>
    <tr>
      <td style="border:1px solid var(--color-border); padding:0.5rem; text-align:center;">12-223</td>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">Reserved</td>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">-</td>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">-</td>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">Future use</td>
    </tr>
    <tr>
      <td style="border:1px solid var(--color-border); padding:0.5rem; text-align:center;">224-253</td>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">Experimental</td>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">Variable</td>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">-</td>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">Testing features</td>
    </tr>
    <tr>
      <td style="border:1px solid var(--color-border); padding:0.5rem; text-align:center;">254</td>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">Padding</td>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">Variable</td>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">Implemented</td>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">Traffic shaping</td>
    </tr>
    <tr>
      <td style="border:1px solid var(--color-border); padding:0.5rem; text-align:center;">255</td>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">Reserved</td>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">-</td>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">-</td>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">Future extension</td>
    </tr>
  </tbody>
</table>
**अज्ञात ब्लॉक हैंडलिंग:**
<p>कार्यान्वयन के लिए अज्ञात प्रकार संख्या वाले ब्लॉकों को अनदेखा करना और उन्हें padding (भराव) के रूप में मानना अनिवार्य है। यह आगे की संगतता सुनिश्चित करता है।</p>
<h3 id="बलक-करम-नरधरण-नयम">ब्लॉक क्रम निर्धारण नियम</h3>
<h3 id="ns-सदश-करम">NS संदेश क्रम</h3>
<p><strong>आवश्यक:</strong> - DateTime block (दिनांक-समय ब्लॉक) सबसे पहले होना अनिवार्य है</p>
<p><strong>अनुमेय:</strong> - Garlic Clove (garlic encryption में संदेश का उप-घटक) (type 11) - विकल्प (type 5) - यदि कार्यान्वित हो - पैडिंग (type 254)</p>
<p><strong>निषिद्ध:</strong> - NextKey, ACK, ACK Request, Termination, MessageNumbers</p>
<p><strong>वैध NS पेलोड का उदाहरण:</strong></p>
<pre tabindex="0"><code>DateTime (0) | Garlic Clove (11) | Garlic Clove (11) | Padding (254)
</code></pre><h3 id="nsr-सदश-क-करम">NSR संदेशों का क्रम</h3>
<p><strong>आवश्यक:</strong> - कोई नहीं (पेलोड खाली हो सकता है)</p>
<p><strong>अनुमत:</strong> - Garlic Clove (Garlic संदेश का उप-खंड) (प्रकार 11) - विकल्प (प्रकार 5) - यदि कार्यान्वित किया गया हो - पैडिंग (प्रकार 254)</p>
<p><strong>निषिद्ध:</strong> - DateTime, NextKey, ACK, ACK Request, Termination, MessageNumbers</p>
<p><strong>वैध NSR पेलोड का उदाहरण:</strong></p>
<pre tabindex="0"><code>Garlic Clove (11) | Garlic Clove (11) | Padding (254)
</code></pre><p>या</p>
<pre tabindex="0"><code>(empty - ACK only)
</code></pre><h3 id="es-सदश-क-करम">ES संदेशों का क्रम</h3>
<p><strong>आवश्यक:</strong> - कोई नहीं (payload (डेटा सामग्री) खाली हो सकता है)</p>
<p><strong>अनुमत (किसी भी क्रम में):</strong> - Garlic Clove (garlic संदेश का &lsquo;clove&rsquo; घटक) (प्रकार 11) - NextKey (प्रकार 7) - ACK (प्रकार 8) - ACK Request (प्रकार 9) - Termination (प्रकार 4) - यदि कार्यान्वित हो - MessageNumbers (प्रकार 6) - यदि कार्यान्वित हो - Options (प्रकार 5) - यदि कार्यान्वित हो - Padding (प्रकार 254)</p>
<p><strong>विशेष नियम:</strong> - Termination (समाप्ति) का ब्लॉक अंतिम ब्लॉक होना ही चाहिए (Padding (भराई) को छोड़कर) - Padding का ब्लॉक अंतिम ब्लॉक होना ही चाहिए - एक से अधिक Garlic Cloves (garlic संदेश के उप-घटक) अनुमत हैं - अधिकतम 2 NextKey (अगली कुंजी) ब्लॉक अनुमत हैं (फ़ॉरवर्ड और रिवर्स) - एक से अधिक Padding ब्लॉक अनुमत नहीं हैं</p>
<p><strong>वैध ES पेलोड के उदाहरण:</strong></p>
<pre tabindex="0"><code>Garlic Clove (11) | ACK (8) | Padding (254)
</code></pre><pre tabindex="0"><code>NextKey (7) | Garlic Clove (11) | Garlic Clove (11)
</code></pre><pre tabindex="0"><code>NextKey (7) forward | NextKey (7) reverse | Garlic Clove (11)
</code></pre><pre tabindex="0"><code>ACK Request (9) | Garlic Clove (11) | Termination (4) | Padding (254)
</code></pre><h3 id="datetime-बलक-परकर-0">DateTime ब्लॉक (प्रकार 0)</h3>
<p><strong>उद्देश्य</strong>: replay (दोहराए गए हमले) की रोकथाम और clock skew (घड़ियों के समय में अंतर) के सत्यापन के लिए टाइमस्टैम्प</p>
<p><strong>आकार</strong>: 7 बाइट (3 बाइट हेडर + 4 बाइट डेटा)</p>
<p><strong>प्रारूप:</strong></p>
<pre tabindex="0"><code>+----+----+----+----+----+----+----+
| 0  |    4    |     timestamp     |
+----+----+----+----+----+----+----+
</code></pre><p><strong>फ़ील्ड्स:</strong></p>
<ul>
<li><code>blk</code>: 0</li>
<li><code>size</code>: 4 (big-endian - सबसे महत्वपूर्ण बाइट पहले)</li>
<li><code>timestamp</code>: 4 बाइट - सेकंड में Unix टाइमस्टैम्प (unsigned - बिना साइन, big-endian)</li>
</ul>
<p><strong>टाइमस्टैम्प प्रारूप:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>timestamp <span style="color:#f92672">=</span> int(time<span style="color:#f92672">.</span>time())  <span style="color:#75715e"># Seconds since 1970-01-01 00:00:00 UTC</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Wraps around in year 2106 (4-byte unsigned maximum)</span>
</span></span></code></pre></div><p><strong>मान्यकरण नियम:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>MAX_CLOCK_SKEW_PAST <span style="color:#f92672">=</span> <span style="color:#ae81ff">5</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">60</span>      <span style="color:#75715e"># 5 minutes</span>
</span></span><span style="display:flex;"><span>MAX_CLOCK_SKEW_FUTURE <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">60</span>    <span style="color:#75715e"># 2 minutes</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">validate_datetime</span>(timestamp):
</span></span><span style="display:flex;"><span>    now <span style="color:#f92672">=</span> int(time<span style="color:#f92672">.</span>time())
</span></span><span style="display:flex;"><span>    age <span style="color:#f92672">=</span> now <span style="color:#f92672">-</span> timestamp
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> age <span style="color:#f92672">&lt;</span> <span style="color:#f92672">-</span>MAX_CLOCK_SKEW_FUTURE:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">False</span>  <span style="color:#75715e"># Too far in future</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> age <span style="color:#f92672">&gt;</span> MAX_CLOCK_SKEW_PAST:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">False</span>  <span style="color:#75715e"># Too old</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">True</span>
</span></span></code></pre></div><p><strong>रीप्ले रोकथाम:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ReplayFilter</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">__init__</span>(self, duration<span style="color:#f92672">=</span><span style="color:#ae81ff">5</span><span style="color:#f92672">*</span><span style="color:#ae81ff">60</span>):
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>duration <span style="color:#f92672">=</span> duration  <span style="color:#75715e"># 5 minutes</span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>seen_messages <span style="color:#f92672">=</span> BloomFilter(size<span style="color:#f92672">=</span><span style="color:#ae81ff">100000</span>, false_positive_rate<span style="color:#f92672">=</span><span style="color:#ae81ff">0.001</span>)
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>cleanup_timer <span style="color:#f92672">=</span> RepeatTimer(<span style="color:#ae81ff">60</span>, self<span style="color:#f92672">.</span>cleanup)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">check_replay</span>(self, ephemeral_key, timestamp):
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Check timestamp validity</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> validate_datetime(timestamp):
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">False</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Check if ephemeral key seen recently</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> ephemeral_key <span style="color:#f92672">in</span> self<span style="color:#f92672">.</span>seen_messages:
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">False</span>  <span style="color:#75715e"># Replay attack</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Add to seen messages</span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>seen_messages<span style="color:#f92672">.</span>add(ephemeral_key)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">True</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">cleanup</span>(self):
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Expire old entries (Bloom filter automatically ages out)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">pass</span>
</span></span></code></pre></div><p><strong>कार्यान्वयन संबंधी नोट्स:</strong></p>
<ol>
<li><strong>NS संदेश</strong>: DateTime (तिथि-समय) अनिवार्य रूप से पहला ब्लॉक होना चाहिए</li>
<li><strong>NSR/ES संदेश</strong>: DateTime आम तौर पर शामिल नहीं होता</li>
<li><strong>रीप्ले विंडो</strong>: 5 मिनट न्यूनतम अनुशंसित है</li>
<li><strong>ब्लूम फ़िल्टर</strong>: कुशल रीप्ले पहचान के लिए अनुशंसित</li>
<li><strong>क्लॉक स्क्यू</strong>: 5 मिनट पीछे, 2 मिनट आगे तक अनुमति दें</li>
</ol>
<h3 id="garlic-clove-block-i2p-म-garlic-encryption-क-भतर-क-clove-बलक-परकर-11">Garlic Clove Block (I2P में garlic encryption के भीतर का &lsquo;clove&rsquo; ब्लॉक) (प्रकार 11)</h3>
<p><strong>उद्देश्य</strong>: प्रेषण के लिए I2NP संदेशों को एनकैप्सुलेट करता है</p>
<p><strong>स्वरूप:</strong></p>
<pre tabindex="0"><code>+----+----+----+----+----+----+----+----+
| 11 |  size   |                        |
+----+----+----+                        +
|      Delivery Instructions            |
~                                       ~
|                                       |
+----+----+----+----+----+----+----+----+
|type|  Message_ID       | Expiration  |
+----+----+----+----+----+----+----+----+
     |      I2NP Message body           |
+----+                                  +
~                                       ~
|                                       |
+----+----+----+----+----+----+----+----+
</code></pre><p><strong>फ़ील्ड्स:</strong></p>
<ul>
<li><code>blk</code>: 11</li>
<li><code>size</code>: clove (garlic संदेश की इकाई) का कुल आकार (परिवर्तनीय)</li>
<li><code>Delivery Instructions</code>: जैसा कि I2NP विशिष्टता में निर्दिष्ट है</li>
<li><code>type</code>: I2NP संदेश प्रकार (1 बाइट)</li>
<li><code>Message_ID</code>: I2NP संदेश ID (4 बाइट)</li>
<li><code>Expiration</code>: सेकंड में Unix टाइमस्टैम्प (4 बाइट)</li>
<li><code>I2NP Message body</code>: परिवर्तनीय लंबाई वाला संदेश डेटा</li>
</ul>
<p><strong>डिलीवरी निर्देश प्रारूप:</strong></p>
<p><strong>स्थानीय वितरण</strong> (1 बाइट):</p>
<pre tabindex="0"><code>+----+
|0x00|
+----+
</code></pre><p><strong>डेस्टिनेशन डिलीवरी</strong> (33 बाइट्स):</p>
<pre tabindex="0"><code>+----+----+----+----+----+----+----+----+
|0x01|                                  |
+----+        Destination Hash         +
|              32 bytes                 |
+                                       +
|                                       |
+----+----+----+----+----+----+----+----+
</code></pre><p><strong>Router डिलीवरी</strong> (33 बाइट्स):</p>
<pre tabindex="0"><code>+----+----+----+----+----+----+----+----+
|0x02|                                  |
+----+         Router Hash              +
|              32 bytes                 |
+                                       +
|                                       |
+----+----+----+----+----+----+----+----+
</code></pre><p><strong>Tunnel डिलीवरी</strong> (37 बाइट्स):</p>
<pre tabindex="0"><code>+----+----+----+----+----+----+----+----+
|0x03|         Tunnel ID                |
+----+----+----+----+----+              +
|           Router Hash                 |
+              32 bytes                 +
|                                       |
+                                       +
|                                       |
+----+----+----+----+----+----+----+----+
</code></pre><p><strong>I2NP संदेश हेडर</strong> (कुल 9 बाइट):</p>
<pre tabindex="0"><code>+----+----+----+----+----+----+----+----+
|type|      msg_id       |  expiration   |
+----+----+----+----+----+----+----+----+
     |                                   |
</code></pre><ul>
<li><code>type</code>: I2NP (I2P का नेटवर्क प्रोटोकॉल) संदेश प्रकार (Database Store, Database Lookup, Data, आदि)</li>
<li><code>msg_id</code>: 4-बाइट संदेश पहचानकर्ता</li>
<li><code>expiration</code>: 4-बाइट Unix टाइमस्टैम्प (सेकंड)</li>
</ul>
<p><strong>ElGamal Clove Format से महत्वपूर्ण अंतर:</strong></p>
<ol>
<li><strong>कोई प्रमाणपत्र नहीं</strong>: प्रमाणपत्र फ़ील्ड छोड़ा गया (ElGamal में अप्रयुक्त)</li>
<li><strong>कोई Clove ID नहीं</strong>: Clove ID (garlic encryption में प्रयुक्त उप-संदेश की पहचान) छोड़ा गया (हमेशा 0 होता था)</li>
<li><strong>कोई Clove Expiration नहीं</strong>: इसके बजाय I2NP संदेश की समाप्ति का उपयोग करता है</li>
<li><strong>संक्षिप्त हेडर</strong>: 9-बाइट I2NP हेडर बनाम बड़ा ElGamal फ़ॉर्मैट</li>
<li><strong>हर Clove एक अलग ब्लॉक है</strong>: कोई CloveSet (Clove का समूह) संरचना नहीं</li>
</ol>
<p><strong>एकाधिक Cloves (कलियाँ):</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># Multiple Garlic Cloves in one message</span>
</span></span><span style="display:flex;"><span>payload <span style="color:#f92672">=</span> [
</span></span><span style="display:flex;"><span>    build_datetime_block(),
</span></span><span style="display:flex;"><span>    build_garlic_clove(i2np_message_1),
</span></span><span style="display:flex;"><span>    build_garlic_clove(i2np_message_2),
</span></span><span style="display:flex;"><span>    build_garlic_clove(i2np_message_3),
</span></span><span style="display:flex;"><span>    build_padding_block()
</span></span><span style="display:flex;"><span>]
</span></span></code></pre></div><p><strong>Cloves (garlic संदेश के घटक) में आम I2NP संदेश प्रकार:</strong></p>
<table style="width:100%; border-collapse:collapse; margin-bottom:1.5rem;">
  <thead>
    <tr>
      <th style="border:1px solid var(--color-border); padding:0.5rem; background:var(--color-bg-secondary); text-align:center;">Type</th>
      <th style="border:1px solid var(--color-border); padding:0.5rem; background:var(--color-bg-secondary); text-align:left;">Name</th>
      <th style="border:1px solid var(--color-border); padding:0.5rem; background:var(--color-bg-secondary); text-align:left;">Usage</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="border:1px solid var(--color-border); padding:0.5rem; text-align:center;">1</td>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">DatabaseStore</td>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">Publishing LeaseSet</td>
    </tr>
    <tr>
      <td style="border:1px solid var(--color-border); padding:0.5rem; text-align:center;">2</td>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">DatabaseLookup</td>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">Requesting LeaseSet</td>
    </tr>
    <tr>
      <td style="border:1px solid var(--color-border); padding:0.5rem; text-align:center;">5</td>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">DeliveryStatus</td>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">ACK (legacy, avoid in ECIES)</td>
    </tr>
    <tr>
      <td style="border:1px solid var(--color-border); padding:0.5rem; text-align:center;">20</td>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">Data</td>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">Streaming data</td>
    </tr>
    <tr>
      <td style="border:1px solid var(--color-border); padding:0.5rem; text-align:center;">21</td>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">Garlic</td>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">Nested garlic messages</td>
    </tr>
  </tbody>
</table>
**Clove (garlic संदेश का उपघटक) का प्रसंस्करण:**
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">process_garlic_clove</span>(clove_data):
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Parse delivery instructions</span>
</span></span><span style="display:flex;"><span>    delivery_type <span style="color:#f92672">=</span> clove_data[<span style="color:#ae81ff">0</span>]
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> delivery_type <span style="color:#f92672">==</span> <span style="color:#ae81ff">0x00</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Local delivery</span>
</span></span><span style="display:flex;"><span>        offset <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">elif</span> delivery_type <span style="color:#f92672">==</span> <span style="color:#ae81ff">0x01</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Destination delivery</span>
</span></span><span style="display:flex;"><span>        dest_hash <span style="color:#f92672">=</span> clove_data[<span style="color:#ae81ff">1</span>:<span style="color:#ae81ff">33</span>]
</span></span><span style="display:flex;"><span>        offset <span style="color:#f92672">=</span> <span style="color:#ae81ff">33</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">elif</span> delivery_type <span style="color:#f92672">==</span> <span style="color:#ae81ff">0x02</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Router delivery</span>
</span></span><span style="display:flex;"><span>        router_hash <span style="color:#f92672">=</span> clove_data[<span style="color:#ae81ff">1</span>:<span style="color:#ae81ff">33</span>]
</span></span><span style="display:flex;"><span>        offset <span style="color:#f92672">=</span> <span style="color:#ae81ff">33</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">elif</span> delivery_type <span style="color:#f92672">==</span> <span style="color:#ae81ff">0x03</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Tunnel delivery</span>
</span></span><span style="display:flex;"><span>        tunnel_id <span style="color:#f92672">=</span> struct<span style="color:#f92672">.</span>unpack(<span style="color:#e6db74">&#39;&gt;I&#39;</span>, clove_data[<span style="color:#ae81ff">1</span>:<span style="color:#ae81ff">5</span>])[<span style="color:#ae81ff">0</span>]
</span></span><span style="display:flex;"><span>        router_hash <span style="color:#f92672">=</span> clove_data[<span style="color:#ae81ff">5</span>:<span style="color:#ae81ff">37</span>]
</span></span><span style="display:flex;"><span>        offset <span style="color:#f92672">=</span> <span style="color:#ae81ff">37</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Parse I2NP header</span>
</span></span><span style="display:flex;"><span>    i2np_type <span style="color:#f92672">=</span> clove_data[offset]
</span></span><span style="display:flex;"><span>    msg_id <span style="color:#f92672">=</span> struct<span style="color:#f92672">.</span>unpack(<span style="color:#e6db74">&#39;&gt;I&#39;</span>, clove_data[offset<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>:offset<span style="color:#f92672">+</span><span style="color:#ae81ff">5</span>])[<span style="color:#ae81ff">0</span>]
</span></span><span style="display:flex;"><span>    expiration <span style="color:#f92672">=</span> struct<span style="color:#f92672">.</span>unpack(<span style="color:#e6db74">&#39;&gt;I&#39;</span>, clove_data[offset<span style="color:#f92672">+</span><span style="color:#ae81ff">5</span>:offset<span style="color:#f92672">+</span><span style="color:#ae81ff">9</span>])[<span style="color:#ae81ff">0</span>]
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Extract I2NP body</span>
</span></span><span style="display:flex;"><span>    i2np_body <span style="color:#f92672">=</span> clove_data[offset<span style="color:#f92672">+</span><span style="color:#ae81ff">9</span>:]
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Process message</span>
</span></span><span style="display:flex;"><span>    process_i2np_message(i2np_type, msg_id, expiration, i2np_body)
</span></span></code></pre></div><h3 id="nextkey-block-अगल-कज-बलक-परकर-7">NextKey Block (अगली कुंजी ब्लॉक) (प्रकार 7)</h3>
<p><strong>उद्देश्य</strong>: DH ratchet (क्रमिक कुंजी अद्यतन तंत्र) कुंजी आदान-प्रदान</p>
<p><strong>प्रारूप (कुंजी मौजूद - 38 बाइट):</strong></p>
<pre tabindex="0"><code>+----+----+----+----+----+----+----+----+
| 7  |   35    |flag|  key ID |         |
+----+----+----+----+----+----+         +
|                                       |
+     Next DH Ratchet Public Key        +
|              32 bytes                 |
+                                       +
|                                       |
+                             +----+----+
|                             |
+----+----+----+----+----+----+
</code></pre><p><strong>प्रारूप (केवल कुंजी आईडी - 6 बाइट्स):</strong></p>
<pre tabindex="0"><code>+----+----+----+----+----+----+
| 7  |    3    |flag|  key ID |
+----+----+----+----+----+----+
</code></pre><p><strong>फ़ील्ड्स:</strong></p>
<ul>
<li><code>blk</code>: 7</li>
<li><code>size</code>: 3 (केवल ID) या 35 (कुंजी सहित)</li>
<li><code>flag</code>: 1 बाइट - फ़्लैग बिट्स</li>
<li><code>key ID</code>: 2 बाइट्स - Big-endian (उच्चतम-क्रम बाइट पहले) कुंजी पहचानकर्ता (0-32767)</li>
<li><code>Public Key</code>: 32 बाइट्स - X25519 सार्वजनिक कुंजी (little-endian; निम्नतम-क्रम बाइट पहले), यदि फ़्लैग बिट 0 = 1</li>
</ul>
<p><strong>फ्लैग बिट्स:</strong></p>
<pre tabindex="0"><code>Bit 7 6 5 4 3 2 1 0
    | | | | | | | |
    | | | | | | | +-- Bit 0: Key present (1) or ID only (0)
    | | | | | | +---- Bit 1: Reverse key (1) or forward key (0)
    | | | | | +------ Bit 2: Request reverse key (1) or no request (0)
    | | | | |
    +-+-+-+-+-------- Bits 3-7: Reserved (set to 0)
</code></pre><p><strong>फ़्लैग उदाहरण:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># Forward key present</span>
</span></span><span style="display:flex;"><span>flags <span style="color:#f92672">=</span> <span style="color:#ae81ff">0x01</span>  <span style="color:#75715e"># Binary: 00000001</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Reverse key present</span>
</span></span><span style="display:flex;"><span>flags <span style="color:#f92672">=</span> <span style="color:#ae81ff">0x03</span>  <span style="color:#75715e"># Binary: 00000011</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Forward key ID only (ACK)</span>
</span></span><span style="display:flex;"><span>flags <span style="color:#f92672">=</span> <span style="color:#ae81ff">0x00</span>  <span style="color:#75715e"># Binary: 00000000</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Reverse key ID only (ACK)</span>
</span></span><span style="display:flex;"><span>flags <span style="color:#f92672">=</span> <span style="color:#ae81ff">0x02</span>  <span style="color:#75715e"># Binary: 00000010</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Forward key ID with reverse request</span>
</span></span><span style="display:flex;"><span>flags <span style="color:#f92672">=</span> <span style="color:#ae81ff">0x04</span>  <span style="color:#75715e"># Binary: 00000100</span>
</span></span></code></pre></div><p><strong>कुंजी ID के नियम:</strong></p>
<ul>
<li>ID क्रमिक होते हैं: 0, 1, 2, &hellip;, 32767</li>
<li>ID केवल तभी बढ़ता है जब नई कुंजी उत्पन्न की जाती है</li>
<li>अगले ratchet (कुंजी आगे बढ़ाने की प्रक्रिया) तक कई संदेशों के लिए वही ID उपयोग की जाती है</li>
<li>अधिकतम ID 32767 है (इसके बाद नया सत्र शुरू करना आवश्यक है)</li>
</ul>
<p><strong>उपयोग के उदाहरण:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># Initiating ratchet (sender generates new key)</span>
</span></span><span style="display:flex;"><span>nextkey <span style="color:#f92672">=</span> NextKeyBlock(
</span></span><span style="display:flex;"><span>    flags<span style="color:#f92672">=</span><span style="color:#ae81ff">0x01</span>,           <span style="color:#75715e"># Key present, forward</span>
</span></span><span style="display:flex;"><span>    key_id<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>    public_key<span style="color:#f92672">=</span>sender_new_pk
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Replying to ratchet (receiver generates new key)</span>
</span></span><span style="display:flex;"><span>nextkey <span style="color:#f92672">=</span> NextKeyBlock(
</span></span><span style="display:flex;"><span>    flags<span style="color:#f92672">=</span><span style="color:#ae81ff">0x03</span>,           <span style="color:#75715e"># Key present, reverse</span>
</span></span><span style="display:flex;"><span>    key_id<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>    public_key<span style="color:#f92672">=</span>receiver_new_pk
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Acknowledging ratchet (no new key from sender)</span>
</span></span><span style="display:flex;"><span>nextkey <span style="color:#f92672">=</span> NextKeyBlock(
</span></span><span style="display:flex;"><span>    flags<span style="color:#f92672">=</span><span style="color:#ae81ff">0x02</span>,           <span style="color:#75715e"># ID only, reverse</span>
</span></span><span style="display:flex;"><span>    key_id<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Requesting reverse ratchet</span>
</span></span><span style="display:flex;"><span>nextkey <span style="color:#f92672">=</span> NextKeyBlock(
</span></span><span style="display:flex;"><span>    flags<span style="color:#f92672">=</span><span style="color:#ae81ff">0x04</span>,           <span style="color:#75715e"># Request reverse, forward ID</span>
</span></span><span style="display:flex;"><span>    key_id<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>)
</span></span></code></pre></div><p><strong>प्रसंस्करण तर्क:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">process_nextkey_block</span>(block):
</span></span><span style="display:flex;"><span>    flags <span style="color:#f92672">=</span> block<span style="color:#f92672">.</span>flags
</span></span><span style="display:flex;"><span>    key_id <span style="color:#f92672">=</span> block<span style="color:#f92672">.</span>key_id
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    key_present <span style="color:#f92672">=</span> (flags <span style="color:#f92672">&amp;</span> <span style="color:#ae81ff">0x01</span>) <span style="color:#f92672">!=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>    is_reverse <span style="color:#f92672">=</span> (flags <span style="color:#f92672">&amp;</span> <span style="color:#ae81ff">0x02</span>) <span style="color:#f92672">!=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>    request_reverse <span style="color:#f92672">=</span> (flags <span style="color:#f92672">&amp;</span> <span style="color:#ae81ff">0x04</span>) <span style="color:#f92672">!=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> key_present:
</span></span><span style="display:flex;"><span>        public_key <span style="color:#f92672">=</span> block<span style="color:#f92672">.</span>public_key
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> is_reverse:
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># Reverse key received</span>
</span></span><span style="display:flex;"><span>            perform_dh_ratchet(receiver_key<span style="color:#f92672">=</span>public_key, key_id<span style="color:#f92672">=</span>key_id)
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># Sender should ACK with own key ID</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># Forward key received</span>
</span></span><span style="display:flex;"><span>            perform_dh_ratchet(sender_key<span style="color:#f92672">=</span>public_key, key_id<span style="color:#f92672">=</span>key_id)
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># Receiver should reply with reverse key</span>
</span></span><span style="display:flex;"><span>            send_reverse_key(generate_new_key())
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Key ID only (ACK)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> is_reverse:
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># Reverse key ACK</span>
</span></span><span style="display:flex;"><span>            confirm_reverse_ratchet(key_id)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># Forward key ACK</span>
</span></span><span style="display:flex;"><span>            confirm_forward_ratchet(key_id)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> request_reverse:
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Sender requests receiver to generate new key</span>
</span></span><span style="display:flex;"><span>        send_reverse_key(generate_new_key())
</span></span></code></pre></div><p><strong>एकाधिक NextKey Blocks (अगली कुंजी के ब्लॉक्स):</strong></p>
<p>जब दोनों दिशाओं में ratcheting (कुंजी-परिवर्तन प्रक्रिया) एक साथ हो रही हो, तब एक ही ES (एक संदेश प्रकार) संदेश में अधिकतम 2 NextKey blocks (अगली कुंजी वाले ब्लॉक) हो सकते हैं:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># Both directions ratcheting</span>
</span></span><span style="display:flex;"><span>payload <span style="color:#f92672">=</span> [
</span></span><span style="display:flex;"><span>    NextKeyBlock(flags<span style="color:#f92672">=</span><span style="color:#ae81ff">0x01</span>, key_id<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span>, public_key<span style="color:#f92672">=</span>forward_key),  <span style="color:#75715e"># Forward</span>
</span></span><span style="display:flex;"><span>    NextKeyBlock(flags<span style="color:#f92672">=</span><span style="color:#ae81ff">0x03</span>, key_id<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>, public_key<span style="color:#f92672">=</span>reverse_key),  <span style="color:#75715e"># Reverse</span>
</span></span><span style="display:flex;"><span>    build_garlic_clove(data)
</span></span><span style="display:flex;"><span>]
</span></span></code></pre></div><h3 id="ack-बलक-परकर-8">ACK ब्लॉक (प्रकार 8)</h3>
<p><strong>उद्देश्य</strong>: प्राप्त संदेशों की पुष्टि in-band (उसी चैनल में) करना</p>
<p><strong>प्रारूप (एकल ACK - 7 बाइट्स):</strong></p>
<pre tabindex="0"><code>+----+----+----+----+----+----+----+
| 8  |    4    |tagsetid |   N     |
+----+----+----+----+----+----+----+
</code></pre><p><strong>प्रारूप (कई ACKs (पुष्टिकरण)):</strong></p>
<pre tabindex="0"><code>+----+----+----+----+----+----+----+----+
| 8  |  size   |tagsetid |   N     |    |
+----+----+----+----+----+----+----+    +
|            more ACKs                  |
~               ...                     ~
|                                       |
+----+----+----+----+----+----+----+----+
</code></pre><p><strong>फ़ील्ड्स:</strong></p>
<ul>
<li><code>blk</code>: 8</li>
<li><code>size</code>: 4 * ACKs (स्वीकृतियाँ) की संख्या (न्यूनतम 4)</li>
<li>प्रत्येक ACK के लिए:
<ul>
<li><code>tagsetid</code>: 2 बाइट - Big-endian (बिग-एंडियन बाइट क्रम) टैग सेट ID (0-65535)</li>
<li><code>N</code>: 2 बाइट - Big-endian संदेश संख्या (0-65535)</li>
</ul>
</li>
</ul>
<p><strong>टैग सेट ID का निर्धारण:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># Tag set 0 (initial, after NSR)</span>
</span></span><span style="display:flex;"><span>tagset_id <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># After first ratchet (tag set 1)</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Both Alice and Bob sent key ID 0</span>
</span></span><span style="display:flex;"><span>tagset_id <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># After second ratchet (tag set 2)</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Alice sent key ID 1, Bob still using key ID 0</span>
</span></span><span style="display:flex;"><span>tagset_id <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># After third ratchet (tag set 3)</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Alice still using key ID 1, Bob sent key ID 1</span>
</span></span><span style="display:flex;"><span>tagset_id <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">3</span>
</span></span></code></pre></div><p><strong>एकल ACK (स्वीकृति संकेत) उदाहरण:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># ACK message from tag set 5, message number 127</span>
</span></span><span style="display:flex;"><span>ack_block <span style="color:#f92672">=</span> ACKBlock(
</span></span><span style="display:flex;"><span>    tagset_id<span style="color:#f92672">=</span><span style="color:#ae81ff">5</span>,
</span></span><span style="display:flex;"><span>    message_number<span style="color:#f92672">=</span><span style="color:#ae81ff">127</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Wire format (7 bytes):</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 08 00 04 00 05 00 7F</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># |  |  |  |  |  |  |</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># |  |  |  |  |  |  +-- N (127)</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># |  |  |  |  +--------- N high byte</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># |  |  |  +------------ tagset_id (5)</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># |  |  +--------------- tagset_id high byte</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># |  +------------------ size (4)</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># +--------------------- type (8)</span>
</span></span></code></pre></div><p><strong>कई ACKs का उदाहरण:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># ACK three messages</span>
</span></span><span style="display:flex;"><span>ack_block <span style="color:#f92672">=</span> ACKBlock([
</span></span><span style="display:flex;"><span>    (tagset_id<span style="color:#f92672">=</span><span style="color:#ae81ff">3</span>, N<span style="color:#f92672">=</span><span style="color:#ae81ff">42</span>),
</span></span><span style="display:flex;"><span>    (tagset_id<span style="color:#f92672">=</span><span style="color:#ae81ff">3</span>, N<span style="color:#f92672">=</span><span style="color:#ae81ff">43</span>),
</span></span><span style="display:flex;"><span>    (tagset_id<span style="color:#f92672">=</span><span style="color:#ae81ff">4</span>, N<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex;"><span>])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Wire format (15 bytes):</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 08 00 0C 00 03 00 2A 00 03 00 2B 00 04 00 00</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#                (ts=3, N=42) (ts=3, N=43) (ts=4, N=0)</span>
</span></span></code></pre></div><p><strong>प्रसंस्करण:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">process_ack_block</span>(block):
</span></span><span style="display:flex;"><span>    num_acks <span style="color:#f92672">=</span> block<span style="color:#f92672">.</span>size <span style="color:#f92672">//</span> <span style="color:#ae81ff">4</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(num_acks):
</span></span><span style="display:flex;"><span>        offset <span style="color:#f92672">=</span> i <span style="color:#f92672">*</span> <span style="color:#ae81ff">4</span>
</span></span><span style="display:flex;"><span>        tagset_id <span style="color:#f92672">=</span> struct<span style="color:#f92672">.</span>unpack(<span style="color:#e6db74">&#39;&gt;H&#39;</span>, block<span style="color:#f92672">.</span>data[offset:offset<span style="color:#f92672">+</span><span style="color:#ae81ff">2</span>])[<span style="color:#ae81ff">0</span>]
</span></span><span style="display:flex;"><span>        message_num <span style="color:#f92672">=</span> struct<span style="color:#f92672">.</span>unpack(<span style="color:#e6db74">&#39;&gt;H&#39;</span>, block<span style="color:#f92672">.</span>data[offset<span style="color:#f92672">+</span><span style="color:#ae81ff">2</span>:offset<span style="color:#f92672">+</span><span style="color:#ae81ff">4</span>])[<span style="color:#ae81ff">0</span>]
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Mark message as acknowledged</span>
</span></span><span style="display:flex;"><span>        mark_acked(tagset_id, message_num)
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># May trigger retransmission timeout cancellation</span>
</span></span><span style="display:flex;"><span>        cancel_retransmit_timer(tagset_id, message_num)
</span></span></code></pre></div><p><strong>ACKs (स्वीकृति संकेत) कब भेजें:</strong></p>
<ol>
<li><strong>स्पष्ट ACK अनुरोध</strong>: ACK (पुष्टि) अनुरोध ब्लॉक का हमेशा उत्तर दें</li>
<li><strong>LeaseSet वितरण</strong>: जब प्रेषक संदेश में LeaseSet शामिल करे</li>
<li><strong>सत्र स्थापना</strong>: NS/NSR का ACK कर सकता है (हालाँकि प्रोटोकॉल ES के माध्यम से निहित ACK को प्राथमिकता देता है)</li>
<li><strong>Ratchet (क्रिप्टोग्राफिक रैचेट तंत्र) पुष्टि</strong>: NextKey (अगली कुंजी) की प्राप्ति का ACK कर सकता है</li>
<li><strong>एप्लिकेशन लेयर</strong>: जैसा उच्च-स्तरीय प्रोटोकॉल द्वारा आवश्यक हो (उदा., Streaming)</li>
</ol>
<p><strong>ACK (पुष्टिकरण) टाइमिंग:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ACKManager</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">__init__</span>(self):
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>pending_acks <span style="color:#f92672">=</span> []
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>ack_timer <span style="color:#f92672">=</span> <span style="color:#66d9ef">None</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">request_ack</span>(self, tagset_id, message_num):
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>pending_acks<span style="color:#f92672">.</span>append((tagset_id, message_num))
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> self<span style="color:#f92672">.</span>ack_timer:
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># Delay ACK briefly to allow higher layer to respond</span>
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>ack_timer <span style="color:#f92672">=</span> set_timer(<span style="color:#ae81ff">0.1</span>, self<span style="color:#f92672">.</span>send_acks)  <span style="color:#75715e"># 100ms</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">send_acks</span>(self):
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> self<span style="color:#f92672">.</span>pending_acks <span style="color:#f92672">and</span> <span style="color:#f92672">not</span> has_outbound_data():
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># No higher layer data, send explicit ACK</span>
</span></span><span style="display:flex;"><span>            send_es_message(build_ack_block(self<span style="color:#f92672">.</span>pending_acks))
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Otherwise, ACK will piggyback on next ES message</span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>pending_acks <span style="color:#f92672">=</span> []
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>ack_timer <span style="color:#f92672">=</span> <span style="color:#66d9ef">None</span>
</span></span></code></pre></div><h3 id="ack-अनरध-बलक-परकर-9">ACK अनुरोध ब्लॉक (प्रकार 9)</h3>
<p><strong>उद्देश्य</strong>: वर्तमान संदेश के लिए in-band (उसी संचार चैनल में) प्राप्ति-पुष्टिकरण का अनुरोध</p>
<p><strong>प्रारूप:</strong></p>
<pre tabindex="0"><code>+----+----+----+----+
| 9  |    1    |flg |
+----+----+----+----+
</code></pre><p><strong>फ़ील्ड्स:</strong></p>
<ul>
<li><code>blk</code>: 9</li>
<li><code>size</code>: 1</li>
<li><code>flg</code>: 1 बाइट - Flags (संकेतक) (सभी बिट्स वर्तमान में अप्रयुक्त हैं, 0 पर सेट)</li>
</ul>
<p><strong>उपयोग:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># Request ACK for this message</span>
</span></span><span style="display:flex;"><span>payload <span style="color:#f92672">=</span> [
</span></span><span style="display:flex;"><span>    build_ack_request_block(),
</span></span><span style="display:flex;"><span>    build_garlic_clove(important_data)
</span></span><span style="display:flex;"><span>]
</span></span></code></pre></div><p><strong>प्राप्तकर्ता की प्रतिक्रिया:</strong></p>
<p>जब ACK Request (स्वीकृति अनुरोध) प्राप्त होता है:</p>
<ol>
<li><strong>तुरंत डेटा के साथ</strong>: तुरंत प्रतिक्रिया में ACK (पुष्टिकरण) ब्लॉक शामिल करें</li>
<li><strong>तुरंत डेटा के बिना</strong>: टाइमर शुरू करें (उदा., 100ms) और यदि टाइमर समाप्त हो जाए तो ACK के साथ खाली ES भेजें</li>
<li><strong>टैग सेट ID</strong>: वर्तमान इनबाउंड टैग सेट ID का उपयोग करें</li>
<li><strong>संदेश संख्या</strong>: प्राप्त सत्र टैग से संबद्ध संदेश संख्या का उपयोग करें</li>
</ol>
<p><strong>प्रसंस्करण:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">process_ack_request</span>(message):
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Extract message identification</span>
</span></span><span style="display:flex;"><span>    tagset_id <span style="color:#f92672">=</span> message<span style="color:#f92672">.</span>tagset_id
</span></span><span style="display:flex;"><span>    message_num <span style="color:#f92672">=</span> message<span style="color:#f92672">.</span>message_num
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Schedule ACK</span>
</span></span><span style="display:flex;"><span>    schedule_ack(tagset_id, message_num)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># If no data to send immediately, start timer</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> has_pending_data():
</span></span><span style="display:flex;"><span>        set_timer(<span style="color:#ae81ff">0.1</span>, <span style="color:#66d9ef">lambda</span>: send_ack_only(tagset_id, message_num))
</span></span></code></pre></div><p><strong>ACK Request (पुष्टिकरण अनुरोध) का उपयोग कब करें:</strong></p>
<ol>
<li><strong>महत्वपूर्ण संदेश</strong>: जिनकी पुष्टि अनिवार्य है</li>
<li><strong>LeaseSet प्रेषण</strong>: जब एक LeaseSet को बंडल किया जा रहा हो</li>
<li><strong>Session Ratchet (सत्र रैचेट—कुंजी-क्रम अद्यतन तंत्र)</strong>: NextKey block भेजने के बाद (अगली कुंजी वाला ब्लॉक)</li>
<li><strong>प्रेषण समाप्ति</strong>: जब प्रेषक के पास भेजने के लिए और डेटा न हो, पर पुष्टि चाहिए</li>
</ol>
<p><strong>कब उपयोग नहीं करना चाहिए:</strong></p>
<ol>
<li><strong>Streaming Protocol (स्ट्रीमिंग प्रोटोकॉल)</strong>: स्ट्रीमिंग लेयर ACKs (प्राप्ति-पुष्टि संदेश) को संभालती है</li>
<li><strong>उच्च-आवृत्ति संदेश</strong>: हर संदेश पर ACK Request (प्राप्ति-पुष्टि का अनुरोध) से बचें (overhead)</li>
<li><strong>गैर-महत्वपूर्ण Datagrams (स्वतंत्र पैकेट)</strong>: आमतौर पर कच्चे datagrams को ACKs की आवश्यकता नहीं होती</li>
</ol>
<h3 id="समपन-बलक-परकर-4">समापन ब्लॉक (प्रकार 4)</h3>
<p><strong>स्थिति</strong>: लागू नहीं किया गया</p>
<p><strong>उद्देश्य</strong>: सेशन को सुगमतापूर्वक समाप्त करना</p>
<p><strong>प्रारूप:</strong></p>
<pre tabindex="0"><code>+----+----+----+----+----+----+----+----+
| 4  |  size   | rsn|     addl data     |
+----+----+----+----+                   +
~               ...                     ~
+----+----+----+----+----+----+----+----+
</code></pre><p><strong>फ़ील्ड्स:</strong></p>
<ul>
<li><code>blk</code>: 4</li>
<li><code>size</code>: 1 या अधिक बाइट्स</li>
<li><code>rsn</code>: 1 बाइट - कारण कोड</li>
<li><code>addl data</code>: वैकल्पिक अतिरिक्त डेटा (प्रारूप कारण पर निर्भर करता है)</li>
</ul>
<p><strong>कारण कोड:</strong></p>
<table style="width:100%; border-collapse:collapse; margin-bottom:1.5rem;">
  <thead>
    <tr>
      <th style="border:1px solid var(--color-border); padding:0.5rem; background:var(--color-bg-secondary); text-align:center;">Code</th>
      <th style="border:1px solid var(--color-border); padding:0.5rem; background:var(--color-bg-secondary); text-align:left;">Meaning</th>
      <th style="border:1px solid var(--color-border); padding:0.5rem; background:var(--color-bg-secondary); text-align:left;">Additional Data</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="border:1px solid var(--color-border); padding:0.5rem; text-align:center;">0</td>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">Normal close / unspecified</td>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">None</td>
    </tr>
    <tr>
      <td style="border:1px solid var(--color-border); padding:0.5rem; text-align:center;">1</td>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">Termination received</td>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">None</td>
    </tr>
    <tr>
      <td style="border:1px solid var(--color-border); padding:0.5rem; text-align:center;">2</td>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">Idle timeout</td>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">None (implementation-specific)</td>
    </tr>
    <tr>
      <td style="border:1px solid var(--color-border); padding:0.5rem; text-align:center;">3</td>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">Resource exhaustion</td>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">None (implementation-specific)</td>
    </tr>
    <tr>
      <td style="border:1px solid var(--color-border); padding:0.5rem; text-align:center;">4+</td>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">Reserved</td>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">Implementation-specific</td>
    </tr>
  </tbody>
</table>
**उपयोग (जब कार्यान्वित किया जाएगा):**
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># Normal session close</span>
</span></span><span style="display:flex;"><span>termination <span style="color:#f92672">=</span> TerminationBlock(
</span></span><span style="display:flex;"><span>    reason<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>    additional_data<span style="color:#f92672">=</span><span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;&#39;</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Session termination due to received termination</span>
</span></span><span style="display:flex;"><span>termination <span style="color:#f92672">=</span> TerminationBlock(
</span></span><span style="display:flex;"><span>    reason<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>,
</span></span><span style="display:flex;"><span>    additional_data<span style="color:#f92672">=</span><span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;&#39;</span>
</span></span><span style="display:flex;"><span>)
</span></span></code></pre></div><p><strong>नियम:</strong></p>
<ul>
<li>Padding (डेटा भराई) को छोड़कर यह अवश्य अंतिम ब्लॉक होना चाहिए</li>
<li>यदि Termination (समापन) मौजूद हो, तो Padding अवश्य उसके बाद आना चाहिए</li>
<li>NS या NSR संदेशों में अनुमति नहीं है</li>
<li>केवल ES संदेशों में अनुमति है</li>
</ul>
<h3 id="वकलप-बलक-परकर-5">विकल्प ब्लॉक (प्रकार 5)</h3>
<p><strong>स्थिति</strong>: लागू नहीं किया गया</p>
<p><strong>उद्देश्य</strong>: सत्र पैरामीटर पर सहमति बनाना</p>
<p><strong>प्रारूप:</strong></p>
<pre tabindex="0"><code>+----+----+----+----+----+----+----+----+
| 5  |  size   |ver |flg |STL |STimeout |
+----+----+----+----+----+----+----+----+
|  SOTW   |  RITW   |tmin|tmax|rmin|rmax|
+----+----+----+----+----+----+----+----+
|  tdmy   |  rdmy   |  tdelay |  rdelay |
+----+----+----+----+----+----+----+----+
|              more_options             |
~               ...                     ~
|                                       |
+----+----+----+----+----+----+----+----+
</code></pre><p><strong>फ़ील्ड्स:</strong></p>
<ul>
<li><code>blk</code>: 5</li>
<li><code>size</code>: 21 या अधिक बाइट</li>
<li><code>ver</code>: 1 बाइट - प्रोटोकॉल संस्करण (0 होना चाहिए)</li>
<li><code>flg</code>: 1 बाइट - फ्लैग्स (सभी बिट्स वर्तमान में अनुपयोगी)</li>
<li><code>STL</code>: 1 बाइट - सेशन टैग लंबाई (8 होना चाहिए)</li>
<li><code>STimeout</code>: 2 बाइट - सेशन आइडल टाइमआउट सेकंड में (बिग-एंडियन)</li>
<li><code>SOTW</code>: 2 बाइट - प्रेषक आउटबाउंड टैग विंडो (बिग-एंडियन)</li>
<li><code>RITW</code>: 2 बाइट - रिसीवर इनबाउंड टैग विंडो (बिग-एंडियन)</li>
<li><code>tmin</code>, <code>tmax</code>, <code>rmin</code>, <code>rmax</code>: प्रत्येक 1 बाइट - पैडिंग पैरामीटर (4.4 फिक्स्ड-पॉइंट)</li>
<li><code>tdmy</code>: 2 बाइट - भेजने के लिए तैयार अधिकतम डमी ट्रैफिक (बाइट/सेकंड, बिग-एंडियन)</li>
<li><code>rdmy</code>: 2 बाइट - अनुरोधित डमी ट्रैफिक (बाइट/सेकंड, बिग-एंडियन)</li>
<li><code>tdelay</code>: 2 बाइट - सम्मिलित करने के लिए तैयार अधिकतम इंट्रा-मैसेज देरी (msec, बिग-एंडियन)</li>
<li><code>rdelay</code>: 2 बाइट - अनुरोधित इंट्रा-मैसेज देरी (msec, बिग-एंडियन)</li>
<li><code>more_options</code>: परिवर्तनीय - भविष्य के एक्सटेंशन</li>
</ul>
<p><strong>पैडिंग पैरामीटर (4.4 स्थिर-बिंदु):</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">encode_padding_ratio</span>(ratio):
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    Encode padding ratio as 4.4 fixed-point
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    ratio: 0.0 to 15.9375
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    returns: 0x00 to 0xFF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> int(ratio <span style="color:#f92672">*</span> <span style="color:#ae81ff">16</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">decode_padding_ratio</span>(encoded):
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    Decode 4.4 fixed-point to ratio
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    encoded: 0x00 to 0xFF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    returns: 0.0 to 15.9375
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> encoded <span style="color:#f92672">/</span> <span style="color:#ae81ff">16.0</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Examples:</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 0x00 = 0.0 (no padding)</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 0x01 = 0.0625 (6.25% padding)</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 0x10 = 1.0 (100% padding - double traffic)</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 0x80 = 8.0 (800% padding - 9x traffic)</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 0xFF = 15.9375 (1593.75% padding)</span>
</span></span></code></pre></div><p><strong>टैग विंडो नेगोशिएशन:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># SOTW: Sender&#39;s recommendation for receiver&#39;s inbound window</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># RITW: Sender&#39;s declaration of own inbound window</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Receiver calculates actual inbound window:</span>
</span></span><span style="display:flex;"><span>inbound_window <span style="color:#f92672">=</span> calculate_window(
</span></span><span style="display:flex;"><span>    sender_suggestion<span style="color:#f92672">=</span>SOTW,
</span></span><span style="display:flex;"><span>    own_constraints<span style="color:#f92672">=</span>MAX_INBOUND_TAGS,
</span></span><span style="display:flex;"><span>    own_resources<span style="color:#f92672">=</span>available_memory()
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Sender uses:</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># - RITW to know how far ahead receiver will accept</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># - Own SOTW to hint optimal window size</span>
</span></span></code></pre></div><p><strong>डिफ़ॉल्ट मान (जब विकल्पों का नेगोशिएशन नहीं हुआ हो):</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>DEFAULT_OPTIONS <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#39;version&#39;</span>: <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#39;session_tag_length&#39;</span>: <span style="color:#ae81ff">8</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#39;session_timeout&#39;</span>: <span style="color:#ae81ff">600</span>,  <span style="color:#75715e"># 10 minutes</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#39;sender_outbound_tag_window&#39;</span>: <span style="color:#ae81ff">160</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#39;receiver_inbound_tag_window&#39;</span>: <span style="color:#ae81ff">160</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#39;tmin&#39;</span>: <span style="color:#ae81ff">0x00</span>,  <span style="color:#75715e"># No minimum padding</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#39;tmax&#39;</span>: <span style="color:#ae81ff">0x10</span>,  <span style="color:#75715e"># Up to 100% padding</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#39;rmin&#39;</span>: <span style="color:#ae81ff">0x00</span>,  <span style="color:#75715e"># No minimum requested</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#39;rmax&#39;</span>: <span style="color:#ae81ff">0x10</span>,  <span style="color:#75715e"># Up to 100% requested</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#39;tdmy&#39;</span>: <span style="color:#ae81ff">0</span>,     <span style="color:#75715e"># No dummy traffic</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#39;rdmy&#39;</span>: <span style="color:#ae81ff">0</span>,     <span style="color:#75715e"># No dummy traffic requested</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#39;tdelay&#39;</span>: <span style="color:#ae81ff">0</span>,   <span style="color:#75715e"># No delay</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#39;rdelay&#39;</span>: <span style="color:#ae81ff">0</span>    <span style="color:#75715e"># No delay requested</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="messagenumbers-बलक-परकर-6">MessageNumbers ब्लॉक (प्रकार 6)</h3>
<p><strong>स्थिति</strong>: लागू नहीं किया गया</p>
<p><strong>उद्देश्य</strong>: पिछले टैग सेट में भेजे गए अंतिम संदेश को इंगित करना (अंतर का पता लगाने में सक्षम बनाता है)</p>
<p><strong>प्रारूप:</strong></p>
<pre tabindex="0"><code>+----+----+----+----+----+
| 6  |    2    |  PN    |
+----+----+----+----+----+
</code></pre><p><strong>फ़ील्ड्स:</strong></p>
<ul>
<li><code>blk</code>: 6</li>
<li><code>size</code>: 2</li>
<li><code>PN</code>: 2 बाइट - पिछले टैग सेट का अंतिम संदेश क्रमांक (big-endian (बाइट क्रम जिसमें सबसे महत्वपूर्ण बाइट पहले आती है), 0-65535)</li>
</ul>
<p><strong>PN (Previous Number) की परिभाषा:</strong></p>
<p>PN पिछले टैग सेट में भेजे गए अंतिम टैग का सूचकांक है।</p>
<p><strong>उपयोग (कार्यान्वित होने पर):</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># After ratcheting to new tag set</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Old tag set: sent messages 0-4095</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># New tag set: sending first message</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>payload <span style="color:#f92672">=</span> [
</span></span><span style="display:flex;"><span>    MessageNumbersBlock(PN<span style="color:#f92672">=</span><span style="color:#ae81ff">4095</span>),
</span></span><span style="display:flex;"><span>    build_garlic_clove(data)
</span></span><span style="display:flex;"><span>]
</span></span></code></pre></div><p><strong>प्राप्तकर्ता के लाभ:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">process_message_numbers</span>(pn_value):
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Receiver can now:</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 1. Determine if any messages were skipped</span>
</span></span><span style="display:flex;"><span>    highest_received_in_old_tagset <span style="color:#f92672">=</span> <span style="color:#ae81ff">4090</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> pn_value <span style="color:#f92672">&gt;</span> highest_received_in_old_tagset:
</span></span><span style="display:flex;"><span>        missing_count <span style="color:#f92672">=</span> pn_value <span style="color:#f92672">-</span> highest_received_in_old_tagset
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># 5 messages were never received</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 2. Delete tags higher than PN from old tagset</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> tag_index <span style="color:#f92672">in</span> range(pn_value <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>, MAX_TAG_INDEX):
</span></span><span style="display:flex;"><span>        delete_tag(old_tagset, tag_index)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 3. Expire tags ≤ PN after grace period (e.g., 2 minutes)</span>
</span></span><span style="display:flex;"><span>    schedule_deletion(old_tagset, delay<span style="color:#f92672">=</span><span style="color:#ae81ff">120</span>)
</span></span></code></pre></div><p><strong>नियम:</strong></p>
<ul>
<li>tag set (टैग का समूह) 0 में कदापि नहीं भेजा जाना चाहिए (कोई पूर्व tag set नहीं)</li>
<li>केवल ES messages (ES प्रकार के संदेश) में भेजा जाता है</li>
<li>नए tag set के प्रथम संदेश(संदेशों) में ही भेजा जाता है</li>
<li>PN value (PN मान) प्रेषक के दृष्टिकोण से होती है (आखिरी टैग जो प्रेषक ने भेजा)</li>
</ul>
<p><strong>Signal से संबंध:</strong></p>
<p>Signal Double Ratchet (Signal प्रोटोकॉल का डबल रैचेट एल्गोरिद्म) में, PN संदेश हेडर में होता है। ECIES (एलिप्टिक कर्व-आधारित समेकित एन्क्रिप्शन स्कीम) में, यह एन्क्रिप्टेड पेलोड में होता है और वैकल्पिक है।</p>
<h3 id="पडग-बलक-टइप-254">पैडिंग ब्लॉक (टाइप 254)</h3>
<p><strong>उद्देश्य</strong>: ट्रैफिक विश्लेषण के प्रति प्रतिरोध और संदेश आकार का छुपाव</p>
<p><strong>प्रारूप:</strong></p>
<pre tabindex="0"><code>+----+----+----+----+----+----+----+----+
|254 |  size   |      padding           |
+----+----+----+                        +
|                                       |
~               ...                     ~
|                                       |
+----+----+----+----+----+----+----+----+
</code></pre><p><strong>फ़ील्ड्स:</strong></p>
<ul>
<li><code>blk</code>: 254</li>
<li><code>size</code>: 0-65516 बाइट्स (big-endian, सबसे महत्त्वपूर्ण बाइट पहले)</li>
<li><code>padding</code>: यादृच्छिक या शून्य डेटा</li>
</ul>
<p><strong>नियम:</strong></p>
<ul>
<li>यह संदेश में अंतिम ब्लॉक होना चाहिए</li>
<li>एक से अधिक Padding (भराई) ब्लॉक की अनुमति नहीं है</li>
<li>शून्य लंबाई हो सकती है (केवल 3-बाइट हेडर)</li>
<li>Padding डेटा शून्य या यादृच्छिक बाइट्स हो सकता है</li>
</ul>
<p><strong>डिफ़ॉल्ट पैडिंग:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>DEFAULT_PADDING_MIN <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>DEFAULT_PADDING_MAX <span style="color:#f92672">=</span> <span style="color:#ae81ff">15</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">generate_default_padding</span>():
</span></span><span style="display:flex;"><span>    size <span style="color:#f92672">=</span> random<span style="color:#f92672">.</span>randint(DEFAULT_PADDING_MIN, DEFAULT_PADDING_MAX)
</span></span><span style="display:flex;"><span>    data <span style="color:#f92672">=</span> random<span style="color:#f92672">.</span>bytes(size)  <span style="color:#75715e"># or zeros</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> PaddingBlock(size, data)
</span></span></code></pre></div><p><strong>ट्रैफ़िक विश्लेषण प्रतिरोध रणनीतियाँ:</strong></p>
<p><strong>रणनीति 1: यादृच्छिक आकार (डिफ़ॉल्ट)</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># Add 0-15 bytes random padding to each message</span>
</span></span><span style="display:flex;"><span>padding_size <span style="color:#f92672">=</span> random<span style="color:#f92672">.</span>randint(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">15</span>)
</span></span><span style="display:flex;"><span>padding_block <span style="color:#f92672">=</span> PaddingBlock(padding_size, random<span style="color:#f92672">.</span>bytes(padding_size))
</span></span></code></pre></div><p><strong>रणनीति 2: गुणज तक राउंड करें</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># Round total message size to next multiple of 64</span>
</span></span><span style="display:flex;"><span>target_size <span style="color:#f92672">=</span> ((message_size <span style="color:#f92672">+</span> <span style="color:#ae81ff">63</span>) <span style="color:#f92672">//</span> <span style="color:#ae81ff">64</span>) <span style="color:#f92672">*</span> <span style="color:#ae81ff">64</span>
</span></span><span style="display:flex;"><span>padding_size <span style="color:#f92672">=</span> target_size <span style="color:#f92672">-</span> message_size <span style="color:#f92672">-</span> <span style="color:#ae81ff">3</span>  <span style="color:#75715e"># -3 for block header</span>
</span></span><span style="display:flex;"><span>padding_block <span style="color:#f92672">=</span> PaddingBlock(padding_size, random<span style="color:#f92672">.</span>bytes(padding_size))
</span></span></code></pre></div><p><strong>रणनीति 3: स्थिर संदेश आकार</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># Always send 1KB messages</span>
</span></span><span style="display:flex;"><span>TARGET_MESSAGE_SIZE <span style="color:#f92672">=</span> <span style="color:#ae81ff">1024</span>
</span></span><span style="display:flex;"><span>padding_size <span style="color:#f92672">=</span> TARGET_MESSAGE_SIZE <span style="color:#f92672">-</span> message_size <span style="color:#f92672">-</span> <span style="color:#ae81ff">3</span>
</span></span><span style="display:flex;"><span>padding_block <span style="color:#f92672">=</span> PaddingBlock(padding_size, random<span style="color:#f92672">.</span>bytes(padding_size))
</span></span></code></pre></div><p><strong>रणनीति 4: समझौता-आधारित पैडिंग (विकल्प ब्लॉक)</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># Calculate padding based on negotiated parameters</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># tmin, tmax from Options block</span>
</span></span><span style="display:flex;"><span>min_padding <span style="color:#f92672">=</span> int(payload_size <span style="color:#f92672">*</span> tmin_ratio)
</span></span><span style="display:flex;"><span>max_padding <span style="color:#f92672">=</span> int(payload_size <span style="color:#f92672">*</span> tmax_ratio)
</span></span><span style="display:flex;"><span>padding_size <span style="color:#f92672">=</span> random<span style="color:#f92672">.</span>randint(min_padding, max_padding)
</span></span><span style="display:flex;"><span>padding_block <span style="color:#f92672">=</span> PaddingBlock(padding_size, random<span style="color:#f92672">.</span>bytes(padding_size))
</span></span></code></pre></div><p><strong>सिर्फ Padding (भराव) वाले संदेश:</strong></p>
<p>संदेश पूरी तरह पैडिंग से बने हो सकते हैं (कोई एप्लिकेशन डेटा नहीं):</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># Dummy traffic message</span>
</span></span><span style="display:flex;"><span>payload <span style="color:#f92672">=</span> [
</span></span><span style="display:flex;"><span>    PaddingBlock(random<span style="color:#f92672">.</span>randint(<span style="color:#ae81ff">100</span>, <span style="color:#ae81ff">500</span>), random<span style="color:#f92672">.</span>bytes(<span style="color:#f92672">...</span>))
</span></span><span style="display:flex;"><span>]
</span></span></code></pre></div><p><strong>कार्यान्वयन संबंधी टिप्पणियाँ:</strong></p>
<ol>
<li><strong>सभी-शून्य पैडिंग</strong>: स्वीकार्य (ChaCha20 द्वारा एन्क्रिप्ट किया जाएगा)</li>
<li><strong>यादृच्छिक पैडिंग</strong>: एन्क्रिप्शन के बाद कोई अतिरिक्त सुरक्षा प्रदान नहीं करती, लेकिन अधिक एंट्रॉपी (यादृच्छिकता का परिमाण) का उपयोग करती है</li>
<li><strong>प्रदर्शन</strong>: यादृच्छिक पैडिंग उत्पन्न करना संसाधन-गहन हो सकता है; शून्य का उपयोग करने पर विचार करें</li>
<li><strong>मेमोरी</strong>: बड़े पैडिंग ब्लॉक बैंडविड्थ की खपत करते हैं; अधिकतम आकार पर सावधानी बरतें</li>
</ol>
<hr>
<h2 id="करयनवयन-मरगदरशक">कार्यान्वयन मार्गदर्शिका</h2>
<h3 id="परवपकषए">पूर्वापेक्षाएँ</h3>
<p><strong>क्रिप्टोग्राफिक लाइब्रेरीज़:</strong></p>
<ul>
<li><strong>X25519</strong>: libsodium, NaCl, या Bouncy Castle</li>
<li><strong>ChaCha20-Poly1305</strong>: libsodium, OpenSSL 1.1.0+, या Bouncy Castle</li>
<li><strong>SHA-256</strong>: OpenSSL, Bouncy Castle, या भाषा का अंतर्निर्मित समर्थन</li>
<li><strong>Elligator2</strong>: सीमित लाइब्रेरी समर्थन; कस्टम कार्यान्वयन की आवश्यकता हो सकती है</li>
</ul>
<p><strong>Elligator2 का कार्यान्वयन:</strong></p>
<p>Elligator2 (एक क्रिप्टोग्राफ़िक तकनीक) का व्यापक रूप से लागू नहीं किया गया है। विकल्प:</p>
<ol>
<li><strong>OBFS4</strong>: Tor के obfs4 pluggable transport (सेंसरशिप-परिहार के लिए मॉड्यूलर परिवहन तंत्र) में Elligator2 का कार्यान्वयन शामिल है</li>
<li><strong>कस्टम कार्यान्वयन</strong>: <a href="https://elligator.cr.yp.to/elligator-20130828.pdf">Elligator2 शोध-पत्र</a>
 पर आधारित</li>
<li><strong>kleshni/Elligator</strong>: GitHub पर संदर्भ कार्यान्वयन</li>
</ol>
<p><strong>Java I2P नोट:</strong> Java I2P net.i2p.crypto.eddsa लाइब्रेरी का उपयोग करता है, जिसमें कस्टम Elligator2 (एक क्रिप्टोग्राफिक मैपिंग तकनीक) जोड़ शामिल हैं।</p>
<h3 id="अनशसत-करयनवयन-करम">अनुशंसित कार्यान्वयन क्रम</h3>
<p><strong>चरण 1: कोर क्रिप्टोग्राफ़ी</strong> 1. X25519 DH (Diffie‑Hellman — डिफ़ी‑हेलमैन) कुंजी उत्पन्न करना और विनिमय 2. ChaCha20‑Poly1305 AEAD (Authenticated Encryption with Associated Data — संबद्ध डेटा सहित प्रमाणित एन्क्रिप्शन) एन्क्रिप्शन/डीक्रिप्शन 3. SHA‑256 हैशिंग और MixHash (हैश मिश्रण प्रक्रिया) 4. HKDF (HMAC‑based Key Derivation Function — HMAC‑आधारित कुंजी व्युत्पत्ति फ़ंक्शन) कुंजी व्युत्पत्ति 5. Elligator2 एन्कोडिंग/डीकोडिंग (प्रारम्भ में टेस्ट वेक्टर का उपयोग किया जा सकता है)</p>
<p><strong>चरण 2: संदेश प्रारूप</strong> 1. NS संदेश (unbound) - सबसे सरल प्रारूप 2. NS संदेश (bound) - स्थिर कुंजी जोड़ता है 3. NSR संदेश 4. ES संदेश 5. ब्लॉक पार्सिंग और उत्पादन</p>
<p><strong>चरण 3: सत्र प्रबंधन</strong> 1. सत्र निर्माण और भंडारण 2. टैग सेट प्रबंधन (प्रेषक और प्राप्तकर्ता) 3. सत्र टैग ratchet (क्रमिक कुंजी-अद्यतन तंत्र) 4. सममित कुंजी ratchet 5. टैग लुकअप और विंडो प्रबंधन</p>
<p><strong>चरण 4: DH Ratcheting (Diffie-Hellman आधारित रैचेटिंग तकनीक)</strong> 1. NextKey block का प्रसंस्करण 2. DH ratchet KDF (Key Derivation Function, कुंजी व्युत्पन्न फ़ंक्शन) 3. रैचेट के बाद Tag set (टैगों का समूह) का निर्माण 4. एकाधिक Tag set का प्रबंधन</p>
<p><strong>चरण 5: प्रोटोकॉल लॉजिक</strong> 1. NS/NSR/ES स्टेट मशीन 2. रीप्ले रोकथाम (DateTime, Bloom filter) 3. पुनः-प्रेषण लॉजिक (एकाधिक NS/NSR) 4. ACK प्रबंधन</p>
<p><strong>चरण 6: एकीकरण</strong> 1. I2NP Garlic Clove (Garlic संदेश की उप-इकाई) प्रसंस्करण 2. LeaseSet समूहीकरण 3. स्ट्रीमिंग प्रोटोकॉल एकीकरण 4. डेटाग्राम प्रोटोकॉल एकीकरण</p>
<h3 id="परषक-करयनवयन">प्रेषक कार्यान्वयन</h3>
<p><strong>आउटबाउंड सत्र जीवनचक्र:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">OutboundSession</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">__init__</span>(self, destination, bound<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>):
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>destination <span style="color:#f92672">=</span> destination
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>bound <span style="color:#f92672">=</span> bound
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>state <span style="color:#f92672">=</span> SessionState<span style="color:#f92672">.</span>NEW
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Keys for NS message</span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>ephemeral_keypair <span style="color:#f92672">=</span> generate_elg2_keypair()
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> bound:
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>static_key <span style="color:#f92672">=</span> context<span style="color:#f92672">.</span>static_keypair
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Will be populated after NSR</span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>outbound_tagset <span style="color:#f92672">=</span> <span style="color:#66d9ef">None</span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>outbound_keyratchet <span style="color:#f92672">=</span> <span style="color:#66d9ef">None</span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>inbound_tagset <span style="color:#f92672">=</span> <span style="color:#66d9ef">None</span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>inbound_keyratchet <span style="color:#f92672">=</span> <span style="color:#66d9ef">None</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Timing</span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>created_time <span style="color:#f92672">=</span> now()
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>last_activity <span style="color:#f92672">=</span> now()
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Retransmission</span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>ns_attempts <span style="color:#f92672">=</span> []
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>ns_timer <span style="color:#f92672">=</span> <span style="color:#66d9ef">None</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">send_initial_message</span>(self, payload):
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;&#34;&#34;Send NS message&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Build NS message</span>
</span></span><span style="display:flex;"><span>        ns_message <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>build_ns_message(payload)
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Send</span>
</span></span><span style="display:flex;"><span>        send_to_network(self<span style="color:#f92672">.</span>destination, ns_message)
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Track for retransmission</span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>ns_attempts<span style="color:#f92672">.</span>append({
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;message&#39;</span>: ns_message,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;time&#39;</span>: now(),
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;ephemeral_key&#39;</span>: self<span style="color:#f92672">.</span>ephemeral_keypair,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;kdf_state&#39;</span>: self<span style="color:#f92672">.</span>save_kdf_state()
</span></span><span style="display:flex;"><span>        })
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Start timer</span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>ns_timer <span style="color:#f92672">=</span> set_timer(<span style="color:#ae81ff">1.0</span>, self<span style="color:#f92672">.</span>on_ns_timeout)
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>state <span style="color:#f92672">=</span> SessionState<span style="color:#f92672">.</span>PENDING_REPLY
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">build_ns_message</span>(self, payload):
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;&#34;&#34;Construct NS message&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># KDF initialization</span>
</span></span><span style="display:flex;"><span>        chainKey, h <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>initialize_kdf()
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Ephemeral key section</span>
</span></span><span style="display:flex;"><span>        elg2_ephemeral <span style="color:#f92672">=</span> ENCODE_ELG2(self<span style="color:#f92672">.</span>ephemeral_keypair<span style="color:#f92672">.</span>public_key)
</span></span><span style="display:flex;"><span>        h <span style="color:#f92672">=</span> SHA256(h <span style="color:#f92672">||</span> self<span style="color:#f92672">.</span>destination<span style="color:#f92672">.</span>static_key)
</span></span><span style="display:flex;"><span>        h <span style="color:#f92672">=</span> SHA256(h <span style="color:#f92672">||</span> self<span style="color:#f92672">.</span>ephemeral_keypair<span style="color:#f92672">.</span>public_key)
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># es DH</span>
</span></span><span style="display:flex;"><span>        es_shared <span style="color:#f92672">=</span> DH(self<span style="color:#f92672">.</span>ephemeral_keypair<span style="color:#f92672">.</span>private_key, 
</span></span><span style="display:flex;"><span>                       self<span style="color:#f92672">.</span>destination<span style="color:#f92672">.</span>static_key)
</span></span><span style="display:flex;"><span>        keydata <span style="color:#f92672">=</span> HKDF(chainKey, es_shared, <span style="color:#e6db74">&#34;&#34;</span>, <span style="color:#ae81ff">64</span>)
</span></span><span style="display:flex;"><span>        chainKey <span style="color:#f92672">=</span> keydata[<span style="color:#ae81ff">0</span>:<span style="color:#ae81ff">31</span>]
</span></span><span style="display:flex;"><span>        k_static <span style="color:#f92672">=</span> keydata[<span style="color:#ae81ff">32</span>:<span style="color:#ae81ff">63</span>]
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Encrypt static key section</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> self<span style="color:#f92672">.</span>bound:
</span></span><span style="display:flex;"><span>            static_section <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>static_key<span style="color:#f92672">.</span>public_key
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>            static_section <span style="color:#f92672">=</span> bytes(<span style="color:#ae81ff">32</span>)
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        static_ciphertext <span style="color:#f92672">=</span> ENCRYPT(k_static, <span style="color:#ae81ff">0</span>, static_section, h)
</span></span><span style="display:flex;"><span>        h <span style="color:#f92672">=</span> SHA256(h <span style="color:#f92672">||</span> static_ciphertext)
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># ss DH (if bound)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> self<span style="color:#f92672">.</span>bound:
</span></span><span style="display:flex;"><span>            ss_shared <span style="color:#f92672">=</span> DH(self<span style="color:#f92672">.</span>static_key<span style="color:#f92672">.</span>private_key, 
</span></span><span style="display:flex;"><span>                          self<span style="color:#f92672">.</span>destination<span style="color:#f92672">.</span>static_key)
</span></span><span style="display:flex;"><span>            keydata <span style="color:#f92672">=</span> HKDF(chainKey, ss_shared, <span style="color:#e6db74">&#34;&#34;</span>, <span style="color:#ae81ff">64</span>)
</span></span><span style="display:flex;"><span>            chainKey <span style="color:#f92672">=</span> keydata[<span style="color:#ae81ff">0</span>:<span style="color:#ae81ff">31</span>]
</span></span><span style="display:flex;"><span>            k_payload <span style="color:#f92672">=</span> keydata[<span style="color:#ae81ff">32</span>:<span style="color:#ae81ff">63</span>]
</span></span><span style="display:flex;"><span>            nonce <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>            k_payload <span style="color:#f92672">=</span> k_static
</span></span><span style="display:flex;"><span>            nonce <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Build payload blocks</span>
</span></span><span style="display:flex;"><span>        payload_data <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>build_ns_payload(payload)
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Encrypt payload</span>
</span></span><span style="display:flex;"><span>        payload_ciphertext <span style="color:#f92672">=</span> ENCRYPT(k_payload, nonce, payload_data, h)
</span></span><span style="display:flex;"><span>        h <span style="color:#f92672">=</span> SHA256(h <span style="color:#f92672">||</span> payload_ciphertext)
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Save KDF state for NSR processing</span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>ns_chainkey <span style="color:#f92672">=</span> chainKey
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>ns_hash <span style="color:#f92672">=</span> h
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Assemble message</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> elg2_ephemeral <span style="color:#f92672">+</span> static_ciphertext <span style="color:#f92672">+</span> payload_ciphertext
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">build_ns_payload</span>(self, application_data):
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;&#34;&#34;Build NS payload blocks&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        blocks <span style="color:#f92672">=</span> []
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># DateTime block (required, first)</span>
</span></span><span style="display:flex;"><span>        blocks<span style="color:#f92672">.</span>append(build_datetime_block())
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Garlic Clove(s) with application data</span>
</span></span><span style="display:flex;"><span>        blocks<span style="color:#f92672">.</span>append(build_garlic_clove(application_data))
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Optionally bundle LeaseSet</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> should_send_leaseset():
</span></span><span style="display:flex;"><span>            blocks<span style="color:#f92672">.</span>append(build_garlic_clove(build_leaseset_store()))
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Padding</span>
</span></span><span style="display:flex;"><span>        blocks<span style="color:#f92672">.</span>append(build_padding_block(random<span style="color:#f92672">.</span>randint(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">15</span>)))
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> encode_blocks(blocks)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">on_nsr_received</span>(self, nsr_message):
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;&#34;&#34;Process NSR and establish ES session&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Cancel retransmission timer</span>
</span></span><span style="display:flex;"><span>        cancel_timer(self<span style="color:#f92672">.</span>ns_timer)
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Parse NSR</span>
</span></span><span style="display:flex;"><span>        tag <span style="color:#f92672">=</span> nsr_message[<span style="color:#ae81ff">0</span>:<span style="color:#ae81ff">8</span>]
</span></span><span style="display:flex;"><span>        elg2_bob_ephemeral <span style="color:#f92672">=</span> nsr_message[<span style="color:#ae81ff">8</span>:<span style="color:#ae81ff">40</span>]
</span></span><span style="display:flex;"><span>        key_section_mac <span style="color:#f92672">=</span> nsr_message[<span style="color:#ae81ff">40</span>:<span style="color:#ae81ff">56</span>]
</span></span><span style="display:flex;"><span>        payload_ciphertext <span style="color:#f92672">=</span> nsr_message[<span style="color:#ae81ff">56</span>:]
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Find corresponding NS attempt</span>
</span></span><span style="display:flex;"><span>        ns_state <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>find_ns_by_tag(tag)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> ns_state:
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">raise</span> <span style="color:#a6e22e">ValueError</span>(<span style="color:#e6db74">&#34;NSR tag doesn&#39;t match any NS&#34;</span>)
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Restore KDF state</span>
</span></span><span style="display:flex;"><span>        chainKey <span style="color:#f92672">=</span> ns_state[<span style="color:#e6db74">&#39;chainkey&#39;</span>]
</span></span><span style="display:flex;"><span>        h <span style="color:#f92672">=</span> ns_state[<span style="color:#e6db74">&#39;hash&#39;</span>]
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Decode Bob&#39;s ephemeral key</span>
</span></span><span style="display:flex;"><span>        bob_ephemeral <span style="color:#f92672">=</span> DECODE_ELG2(elg2_bob_ephemeral)
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Mix tag and Bob&#39;s ephemeral into hash</span>
</span></span><span style="display:flex;"><span>        h <span style="color:#f92672">=</span> SHA256(h <span style="color:#f92672">||</span> tag)
</span></span><span style="display:flex;"><span>        h <span style="color:#f92672">=</span> SHA256(h <span style="color:#f92672">||</span> bob_ephemeral)
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># ee DH</span>
</span></span><span style="display:flex;"><span>        ee_shared <span style="color:#f92672">=</span> DH(self<span style="color:#f92672">.</span>ephemeral_keypair<span style="color:#f92672">.</span>private_key, bob_ephemeral)
</span></span><span style="display:flex;"><span>        keydata <span style="color:#f92672">=</span> HKDF(chainKey, ee_shared, <span style="color:#e6db74">&#34;&#34;</span>, <span style="color:#ae81ff">32</span>)
</span></span><span style="display:flex;"><span>        chainKey <span style="color:#f92672">=</span> keydata[<span style="color:#ae81ff">0</span>:<span style="color:#ae81ff">31</span>]
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># se DH</span>
</span></span><span style="display:flex;"><span>        se_shared <span style="color:#f92672">=</span> DH(self<span style="color:#f92672">.</span>static_key<span style="color:#f92672">.</span>private_key, bob_ephemeral)
</span></span><span style="display:flex;"><span>        keydata <span style="color:#f92672">=</span> HKDF(chainKey, se_shared, <span style="color:#e6db74">&#34;&#34;</span>, <span style="color:#ae81ff">64</span>)
</span></span><span style="display:flex;"><span>        chainKey <span style="color:#f92672">=</span> keydata[<span style="color:#ae81ff">0</span>:<span style="color:#ae81ff">31</span>]
</span></span><span style="display:flex;"><span>        k_key_section <span style="color:#f92672">=</span> keydata[<span style="color:#ae81ff">32</span>:<span style="color:#ae81ff">63</span>]
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Verify key section MAC</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">try</span>:
</span></span><span style="display:flex;"><span>            DECRYPT(k_key_section, <span style="color:#ae81ff">0</span>, key_section_mac, h)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">except</span> AuthenticationError:
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">raise</span> <span style="color:#a6e22e">ValueError</span>(<span style="color:#e6db74">&#34;NSR key section MAC verification failed&#34;</span>)
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        h <span style="color:#f92672">=</span> SHA256(h <span style="color:#f92672">||</span> key_section_mac)
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Split for bidirectional ES</span>
</span></span><span style="display:flex;"><span>        keydata <span style="color:#f92672">=</span> HKDF(chainKey, ZEROLEN, <span style="color:#e6db74">&#34;&#34;</span>, <span style="color:#ae81ff">64</span>)
</span></span><span style="display:flex;"><span>        k_ab <span style="color:#f92672">=</span> keydata[<span style="color:#ae81ff">0</span>:<span style="color:#ae81ff">31</span>]  <span style="color:#75715e"># Alice → Bob</span>
</span></span><span style="display:flex;"><span>        k_ba <span style="color:#f92672">=</span> keydata[<span style="color:#ae81ff">32</span>:<span style="color:#ae81ff">63</span>]  <span style="color:#75715e"># Bob → Alice</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Initialize ES tagsets</span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>outbound_tagset <span style="color:#f92672">=</span> DH_INITIALIZE(chainKey, k_ab)
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>inbound_tagset <span style="color:#f92672">=</span> DH_INITIALIZE(chainKey, k_ba)
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Decrypt NSR payload</span>
</span></span><span style="display:flex;"><span>        k_nsr <span style="color:#f92672">=</span> HKDF(k_ba, ZEROLEN, <span style="color:#e6db74">&#34;AttachPayloadKDF&#34;</span>, <span style="color:#ae81ff">32</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">try</span>:
</span></span><span style="display:flex;"><span>            payload <span style="color:#f92672">=</span> DECRYPT(k_nsr, <span style="color:#ae81ff">0</span>, payload_ciphertext, h)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">except</span> AuthenticationError:
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">raise</span> <span style="color:#a6e22e">ValueError</span>(<span style="color:#e6db74">&#34;NSR payload MAC verification failed&#34;</span>)
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Process NSR payload blocks</span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>process_payload_blocks(payload)
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Session established</span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>state <span style="color:#f92672">=</span> SessionState<span style="color:#f92672">.</span>ESTABLISHED
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>last_activity <span style="color:#f92672">=</span> now()
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Send ES message (implicit ACK)</span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>send_es_ack()
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">send_es_message</span>(self, payload):
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;&#34;&#34;Send ES message&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> self<span style="color:#f92672">.</span>state <span style="color:#f92672">!=</span> SessionState<span style="color:#f92672">.</span>ESTABLISHED:
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">raise</span> <span style="color:#a6e22e">ValueError</span>(<span style="color:#e6db74">&#34;Session not established&#34;</span>)
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Get next tag and key</span>
</span></span><span style="display:flex;"><span>        tag, index <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>outbound_tagset<span style="color:#f92672">.</span>get_next_tag()
</span></span><span style="display:flex;"><span>        key <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>outbound_keyratchet<span style="color:#f92672">.</span>get_key(index)
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Construct nonce</span>
</span></span><span style="display:flex;"><span>        nonce <span style="color:#f92672">=</span> construct_nonce(index)
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Build payload blocks</span>
</span></span><span style="display:flex;"><span>        payload_data <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>build_es_payload(payload)
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># AEAD encryption</span>
</span></span><span style="display:flex;"><span>        ciphertext <span style="color:#f92672">=</span> ENCRYPT(key, nonce, payload_data, tag)
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Assemble message</span>
</span></span><span style="display:flex;"><span>        es_message <span style="color:#f92672">=</span> tag <span style="color:#f92672">+</span> ciphertext
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Send</span>
</span></span><span style="display:flex;"><span>        send_to_network(self<span style="color:#f92672">.</span>destination, es_message)
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Update activity</span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>last_activity <span style="color:#f92672">=</span> now()
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Check if ratchet needed</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> self<span style="color:#f92672">.</span>outbound_tagset<span style="color:#f92672">.</span>should_ratchet():
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>initiate_ratchet()
</span></span></code></pre></div><h3 id="रसवर-क-करयनवयन">रिसीवर का कार्यान्वयन</h3>
<p><strong>आगत सत्र जीवनचक्र:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">InboundSession</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">__init__</span>(self):
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>state <span style="color:#f92672">=</span> <span style="color:#66d9ef">None</span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>bound <span style="color:#f92672">=</span> <span style="color:#66d9ef">False</span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>destination <span style="color:#f92672">=</span> <span style="color:#66d9ef">None</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Keys</span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>remote_ephemeral_key <span style="color:#f92672">=</span> <span style="color:#66d9ef">None</span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>remote_static_key <span style="color:#f92672">=</span> <span style="color:#66d9ef">None</span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>ephemeral_keypair <span style="color:#f92672">=</span> <span style="color:#66d9ef">None</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Tagsets</span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>inbound_tagset <span style="color:#f92672">=</span> <span style="color:#66d9ef">None</span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>outbound_tagset <span style="color:#f92672">=</span> <span style="color:#66d9ef">None</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Timing</span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>created_time <span style="color:#f92672">=</span> <span style="color:#66d9ef">None</span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>last_activity <span style="color:#f92672">=</span> <span style="color:#66d9ef">None</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Paired session</span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>paired_outbound <span style="color:#f92672">=</span> <span style="color:#66d9ef">None</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@staticmethod</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">try_decrypt_ns</span>(message):
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;&#34;&#34;Attempt to decrypt as NS message&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Parse NS structure</span>
</span></span><span style="display:flex;"><span>        elg2_ephemeral <span style="color:#f92672">=</span> message[<span style="color:#ae81ff">0</span>:<span style="color:#ae81ff">32</span>]
</span></span><span style="display:flex;"><span>        static_ciphertext <span style="color:#f92672">=</span> message[<span style="color:#ae81ff">32</span>:<span style="color:#ae81ff">80</span>]  <span style="color:#75715e"># 32 + 16</span>
</span></span><span style="display:flex;"><span>        payload_ciphertext <span style="color:#f92672">=</span> message[<span style="color:#ae81ff">80</span>:]
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Decode ephemeral key</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">try</span>:
</span></span><span style="display:flex;"><span>            alice_ephemeral <span style="color:#f92672">=</span> DECODE_ELG2(elg2_ephemeral)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">except</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">None</span>  <span style="color:#75715e"># Not a valid Elligator2 encoding</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Check replay</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> is_replay(alice_ephemeral):
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">None</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># KDF initialization</span>
</span></span><span style="display:flex;"><span>        chainKey, h <span style="color:#f92672">=</span> initialize_kdf()
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Mix keys</span>
</span></span><span style="display:flex;"><span>        h <span style="color:#f92672">=</span> SHA256(h <span style="color:#f92672">||</span> context<span style="color:#f92672">.</span>static_keypair<span style="color:#f92672">.</span>public_key)
</span></span><span style="display:flex;"><span>        h <span style="color:#f92672">=</span> SHA256(h <span style="color:#f92672">||</span> alice_ephemeral)
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># es DH</span>
</span></span><span style="display:flex;"><span>        es_shared <span style="color:#f92672">=</span> DH(context<span style="color:#f92672">.</span>static_keypair<span style="color:#f92672">.</span>private_key, alice_ephemeral)
</span></span><span style="display:flex;"><span>        keydata <span style="color:#f92672">=</span> HKDF(chainKey, es_shared, <span style="color:#e6db74">&#34;&#34;</span>, <span style="color:#ae81ff">64</span>)
</span></span><span style="display:flex;"><span>        chainKey <span style="color:#f92672">=</span> keydata[<span style="color:#ae81ff">0</span>:<span style="color:#ae81ff">31</span>]
</span></span><span style="display:flex;"><span>        k_static <span style="color:#f92672">=</span> keydata[<span style="color:#ae81ff">32</span>:<span style="color:#ae81ff">63</span>]
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Decrypt static key section</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">try</span>:
</span></span><span style="display:flex;"><span>            static_data <span style="color:#f92672">=</span> DECRYPT(k_static, <span style="color:#ae81ff">0</span>, static_ciphertext, h)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">except</span> AuthenticationError:
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">None</span>  <span style="color:#75715e"># Not a valid NS message</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        h <span style="color:#f92672">=</span> SHA256(h <span style="color:#f92672">||</span> static_ciphertext)
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Check if bound or unbound</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> static_data <span style="color:#f92672">==</span> bytes(<span style="color:#ae81ff">32</span>):
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># Unbound</span>
</span></span><span style="display:flex;"><span>            alice_static_key <span style="color:#f92672">=</span> <span style="color:#66d9ef">None</span>
</span></span><span style="display:flex;"><span>            k_payload <span style="color:#f92672">=</span> k_static
</span></span><span style="display:flex;"><span>            nonce <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># Bound - perform ss DH</span>
</span></span><span style="display:flex;"><span>            alice_static_key <span style="color:#f92672">=</span> static_data
</span></span><span style="display:flex;"><span>            ss_shared <span style="color:#f92672">=</span> DH(context<span style="color:#f92672">.</span>static_keypair<span style="color:#f92672">.</span>private_key, alice_static_key)
</span></span><span style="display:flex;"><span>            keydata <span style="color:#f92672">=</span> HKDF(chainKey, ss_shared, <span style="color:#e6db74">&#34;&#34;</span>, <span style="color:#ae81ff">64</span>)
</span></span><span style="display:flex;"><span>            chainKey <span style="color:#f92672">=</span> keydata[<span style="color:#ae81ff">0</span>:<span style="color:#ae81ff">31</span>]
</span></span><span style="display:flex;"><span>            k_payload <span style="color:#f92672">=</span> keydata[<span style="color:#ae81ff">32</span>:<span style="color:#ae81ff">63</span>]
</span></span><span style="display:flex;"><span>            nonce <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Decrypt payload</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">try</span>:
</span></span><span style="display:flex;"><span>            payload <span style="color:#f92672">=</span> DECRYPT(k_payload, nonce, payload_ciphertext, h)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">except</span> AuthenticationError:
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">None</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        h <span style="color:#f92672">=</span> SHA256(h <span style="color:#f92672">||</span> payload_ciphertext)
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Create session</span>
</span></span><span style="display:flex;"><span>        session <span style="color:#f92672">=</span> InboundSession()
</span></span><span style="display:flex;"><span>        session<span style="color:#f92672">.</span>state <span style="color:#f92672">=</span> SessionState<span style="color:#f92672">.</span>ESTABLISHED
</span></span><span style="display:flex;"><span>        session<span style="color:#f92672">.</span>created_time <span style="color:#f92672">=</span> now()
</span></span><span style="display:flex;"><span>        session<span style="color:#f92672">.</span>last_activity <span style="color:#f92672">=</span> now()
</span></span><span style="display:flex;"><span>        session<span style="color:#f92672">.</span>remote_ephemeral_key <span style="color:#f92672">=</span> alice_ephemeral
</span></span><span style="display:flex;"><span>        session<span style="color:#f92672">.</span>remote_static_key <span style="color:#f92672">=</span> alice_static_key
</span></span><span style="display:flex;"><span>        session<span style="color:#f92672">.</span>bound <span style="color:#f92672">=</span> (alice_static_key <span style="color:#f92672">is</span> <span style="color:#f92672">not</span> <span style="color:#66d9ef">None</span>)
</span></span><span style="display:flex;"><span>        session<span style="color:#f92672">.</span>ns_chainkey <span style="color:#f92672">=</span> chainKey
</span></span><span style="display:flex;"><span>        session<span style="color:#f92672">.</span>ns_hash <span style="color:#f92672">=</span> h
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Extract destination if bound</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> session<span style="color:#f92672">.</span>bound:
</span></span><span style="display:flex;"><span>            session<span style="color:#f92672">.</span>destination <span style="color:#f92672">=</span> extract_destination_from_payload(payload)
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Process payload</span>
</span></span><span style="display:flex;"><span>        session<span style="color:#f92672">.</span>process_payload_blocks(payload)
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> session
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">send_nsr_reply</span>(self, reply_payload):
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;&#34;&#34;Send NSR message&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Generate NSR tagset</span>
</span></span><span style="display:flex;"><span>        tagsetKey <span style="color:#f92672">=</span> HKDF(self<span style="color:#f92672">.</span>ns_chainkey, ZEROLEN, <span style="color:#e6db74">&#34;SessionReplyTags&#34;</span>, <span style="color:#ae81ff">32</span>)
</span></span><span style="display:flex;"><span>        nsr_tagset <span style="color:#f92672">=</span> DH_INITIALIZE(self<span style="color:#f92672">.</span>ns_chainkey, tagsetKey)
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Get tag</span>
</span></span><span style="display:flex;"><span>        tag, _ <span style="color:#f92672">=</span> nsr_tagset<span style="color:#f92672">.</span>get_next_tag()
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Mix tag into hash</span>
</span></span><span style="display:flex;"><span>        h <span style="color:#f92672">=</span> SHA256(self<span style="color:#f92672">.</span>ns_hash <span style="color:#f92672">||</span> tag)
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Generate ephemeral key</span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>ephemeral_keypair <span style="color:#f92672">=</span> generate_elg2_keypair()
</span></span><span style="display:flex;"><span>        bob_ephemeral <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>ephemeral_keypair<span style="color:#f92672">.</span>public_key
</span></span><span style="display:flex;"><span>        elg2_bob_ephemeral <span style="color:#f92672">=</span> ENCODE_ELG2(bob_ephemeral)
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Mix ephemeral key</span>
</span></span><span style="display:flex;"><span>        h <span style="color:#f92672">=</span> SHA256(h <span style="color:#f92672">||</span> bob_ephemeral)
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        chainKey <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>ns_chainkey
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># ee DH</span>
</span></span><span style="display:flex;"><span>        ee_shared <span style="color:#f92672">=</span> DH(self<span style="color:#f92672">.</span>ephemeral_keypair<span style="color:#f92672">.</span>private_key, 
</span></span><span style="display:flex;"><span>                      self<span style="color:#f92672">.</span>remote_ephemeral_key)
</span></span><span style="display:flex;"><span>        keydata <span style="color:#f92672">=</span> HKDF(chainKey, ee_shared, <span style="color:#e6db74">&#34;&#34;</span>, <span style="color:#ae81ff">32</span>)
</span></span><span style="display:flex;"><span>        chainKey <span style="color:#f92672">=</span> keydata[<span style="color:#ae81ff">0</span>:<span style="color:#ae81ff">31</span>]
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># se DH</span>
</span></span><span style="display:flex;"><span>        se_shared <span style="color:#f92672">=</span> DH(context<span style="color:#f92672">.</span>static_keypair<span style="color:#f92672">.</span>private_key, 
</span></span><span style="display:flex;"><span>                      self<span style="color:#f92672">.</span>remote_ephemeral_key)
</span></span><span style="display:flex;"><span>        keydata <span style="color:#f92672">=</span> HKDF(chainKey, se_shared, <span style="color:#e6db74">&#34;&#34;</span>, <span style="color:#ae81ff">64</span>)
</span></span><span style="display:flex;"><span>        chainKey <span style="color:#f92672">=</span> keydata[<span style="color:#ae81ff">0</span>:<span style="color:#ae81ff">31</span>]
</span></span><span style="display:flex;"><span>        k_key_section <span style="color:#f92672">=</span> keydata[<span style="color:#ae81ff">32</span>:<span style="color:#ae81ff">63</span>]
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Encrypt key section (empty)</span>
</span></span><span style="display:flex;"><span>        key_section_ciphertext <span style="color:#f92672">=</span> ENCRYPT(k_key_section, <span style="color:#ae81ff">0</span>, ZEROLEN, h)
</span></span><span style="display:flex;"><span>        h <span style="color:#f92672">=</span> SHA256(h <span style="color:#f92672">||</span> key_section_ciphertext)
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Split for bidirectional ES</span>
</span></span><span style="display:flex;"><span>        keydata <span style="color:#f92672">=</span> HKDF(chainKey, ZEROLEN, <span style="color:#e6db74">&#34;&#34;</span>, <span style="color:#ae81ff">64</span>)
</span></span><span style="display:flex;"><span>        k_ab <span style="color:#f92672">=</span> keydata[<span style="color:#ae81ff">0</span>:<span style="color:#ae81ff">31</span>]  <span style="color:#75715e"># Alice → Bob</span>
</span></span><span style="display:flex;"><span>        k_ba <span style="color:#f92672">=</span> keydata[<span style="color:#ae81ff">32</span>:<span style="color:#ae81ff">63</span>]  <span style="color:#75715e"># Bob → Alice</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Initialize ES tagsets</span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>inbound_tagset <span style="color:#f92672">=</span> DH_INITIALIZE(chainKey, k_ab)
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>outbound_tagset <span style="color:#f92672">=</span> DH_INITIALIZE(chainKey, k_ba)
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Build reply payload</span>
</span></span><span style="display:flex;"><span>        payload_data <span style="color:#f92672">=</span> build_payload_blocks(reply_payload)
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Encrypt payload</span>
</span></span><span style="display:flex;"><span>        k_nsr <span style="color:#f92672">=</span> HKDF(k_ba, ZEROLEN, <span style="color:#e6db74">&#34;AttachPayloadKDF&#34;</span>, <span style="color:#ae81ff">32</span>)
</span></span><span style="display:flex;"><span>        payload_ciphertext <span style="color:#f92672">=</span> ENCRYPT(k_nsr, <span style="color:#ae81ff">0</span>, payload_data, h)
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Assemble NSR</span>
</span></span><span style="display:flex;"><span>        nsr_message <span style="color:#f92672">=</span> tag <span style="color:#f92672">+</span> elg2_bob_ephemeral <span style="color:#f92672">+</span> key_section_ciphertext <span style="color:#f92672">+</span> payload_ciphertext
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Send</span>
</span></span><span style="display:flex;"><span>        send_to_network(self<span style="color:#f92672">.</span>destination, nsr_message)
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Wait for ES</span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>state <span style="color:#f92672">=</span> SessionState<span style="color:#f92672">.</span>AWAITING_ES
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>last_activity <span style="color:#f92672">=</span> now()
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">on_es_received</span>(self, es_message):
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;&#34;&#34;Process first ES message&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> self<span style="color:#f92672">.</span>state <span style="color:#f92672">==</span> SessionState<span style="color:#f92672">.</span>AWAITING_ES:
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># First ES received, confirms session</span>
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>state <span style="color:#f92672">=</span> SessionState<span style="color:#f92672">.</span>ESTABLISHED
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Process ES message</span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>process_es_message(es_message)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">process_es_message</span>(self, es_message):
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;&#34;&#34;Decrypt and process ES message&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Extract tag</span>
</span></span><span style="display:flex;"><span>        tag <span style="color:#f92672">=</span> es_message[<span style="color:#ae81ff">0</span>:<span style="color:#ae81ff">8</span>]
</span></span><span style="display:flex;"><span>        ciphertext <span style="color:#f92672">=</span> es_message[<span style="color:#ae81ff">8</span>:]
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Look up tag</span>
</span></span><span style="display:flex;"><span>        index <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>inbound_tagset<span style="color:#f92672">.</span>lookup_tag(tag)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> index <span style="color:#f92672">is</span> <span style="color:#66d9ef">None</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">raise</span> <span style="color:#a6e22e">ValueError</span>(<span style="color:#e6db74">&#34;Tag not found&#34;</span>)
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Get key</span>
</span></span><span style="display:flex;"><span>        key <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>inbound_keyratchet<span style="color:#f92672">.</span>get_key(index)
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Construct nonce</span>
</span></span><span style="display:flex;"><span>        nonce <span style="color:#f92672">=</span> construct_nonce(index)
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Decrypt</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">try</span>:
</span></span><span style="display:flex;"><span>            payload <span style="color:#f92672">=</span> DECRYPT(key, nonce, ciphertext, tag)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">except</span> AuthenticationError:
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">raise</span> <span style="color:#a6e22e">ValueError</span>(<span style="color:#e6db74">&#34;ES MAC verification failed&#34;</span>)
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Process blocks</span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>process_payload_blocks(payload)
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Update activity</span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>last_activity <span style="color:#f92672">=</span> now()
</span></span></code></pre></div><h3 id="सदश-वरगकरण">संदेश वर्गीकरण</h3>
<p><strong>संदेश प्रकारों का भेद:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">classify_message</span>(message):
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;&#34;&#34;Determine message type&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Minimum lengths</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> len(message) <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">24</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">None</span>  <span style="color:#75715e"># Too short</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Check for session tag (8 bytes)</span>
</span></span><span style="display:flex;"><span>    tag <span style="color:#f92672">=</span> message[<span style="color:#ae81ff">0</span>:<span style="color:#ae81ff">8</span>]
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Try ES decryption first (most common)</span>
</span></span><span style="display:flex;"><span>    session <span style="color:#f92672">=</span> lookup_session_by_tag(tag)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> session:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> (<span style="color:#e6db74">&#39;ES&#39;</span>, session)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Try NSR decryption (tag + Elligator2 key)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> len(message) <span style="color:#f92672">&gt;=</span> <span style="color:#ae81ff">72</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Check if bytes 8-40 are valid Elligator2</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">try</span>:
</span></span><span style="display:flex;"><span>            nsr_ephemeral <span style="color:#f92672">=</span> DECODE_ELG2(message[<span style="color:#ae81ff">8</span>:<span style="color:#ae81ff">40</span>])
</span></span><span style="display:flex;"><span>            nsr_session <span style="color:#f92672">=</span> find_pending_nsr_by_tag(tag)
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> nsr_session:
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">return</span> (<span style="color:#e6db74">&#39;NSR&#39;</span>, nsr_session)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">except</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">pass</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Try NS decryption (starts with Elligator2 key)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> len(message) <span style="color:#f92672">&gt;=</span> <span style="color:#ae81ff">96</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">try</span>:
</span></span><span style="display:flex;"><span>            ns_ephemeral <span style="color:#f92672">=</span> DECODE_ELG2(message[<span style="color:#ae81ff">0</span>:<span style="color:#ae81ff">32</span>])
</span></span><span style="display:flex;"><span>            ns_session <span style="color:#f92672">=</span> InboundSession<span style="color:#f92672">.</span>try_decrypt_ns(message)
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> ns_session:
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">return</span> (<span style="color:#e6db74">&#39;NS&#39;</span>, ns_session)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">except</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">pass</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Check ElGamal/AES (for dual-key compatibility)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> len(message) <span style="color:#f92672">&gt;=</span> <span style="color:#ae81ff">514</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (len(message) <span style="color:#f92672">-</span> <span style="color:#ae81ff">2</span>) <span style="color:#f92672">%</span> <span style="color:#ae81ff">16</span> <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># Might be ElGamal NS</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> (<span style="color:#e6db74">&#39;ELGAMAL_NS&#39;</span>, <span style="color:#66d9ef">None</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">elif</span> len(message) <span style="color:#f92672">%</span> <span style="color:#ae81ff">16</span> <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># Might be ElGamal ES</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> (<span style="color:#e6db74">&#39;ELGAMAL_ES&#39;</span>, <span style="color:#66d9ef">None</span>)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">None</span>  <span style="color:#75715e"># Unknown message type</span>
</span></span></code></pre></div><h3 id="सतर-परबधन-क-सरवततम-परथए">सत्र प्रबंधन की सर्वोत्तम प्रथाएँ</h3>
<p><strong>सत्र संग्रहण:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">SessionKeyManager</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">__init__</span>(self):
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Outbound sessions (one per destination)</span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>outbound_sessions <span style="color:#f92672">=</span> {}  <span style="color:#75715e"># destination -&gt; OutboundSession</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Inbound sessions (multiple per destination during transition)</span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>inbound_sessions <span style="color:#f92672">=</span> []  <span style="color:#75715e"># [InboundSession]</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Session tag lookup (fast path for ES messages)</span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>tag_to_session <span style="color:#f92672">=</span> {}  <span style="color:#75715e"># tag -&gt; InboundSession</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Limits</span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>max_inbound_sessions <span style="color:#f92672">=</span> <span style="color:#ae81ff">1000</span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>max_tags_per_session <span style="color:#f92672">=</span> <span style="color:#ae81ff">160</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">get_outbound_session</span>(self, destination):
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;&#34;&#34;Get or create outbound session&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> destination <span style="color:#f92672">not</span> <span style="color:#f92672">in</span> self<span style="color:#f92672">.</span>outbound_sessions:
</span></span><span style="display:flex;"><span>            session <span style="color:#f92672">=</span> OutboundSession(destination)
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>outbound_sessions[destination] <span style="color:#f92672">=</span> session
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> self<span style="color:#f92672">.</span>outbound_sessions[destination]
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">add_inbound_session</span>(self, session):
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;&#34;&#34;Add new inbound session&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Check limits</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> len(self<span style="color:#f92672">.</span>inbound_sessions) <span style="color:#f92672">&gt;=</span> self<span style="color:#f92672">.</span>max_inbound_sessions:
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>expire_oldest_session()
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>inbound_sessions<span style="color:#f92672">.</span>append(session)
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Add tags to lookup table</span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>register_session_tags(session)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">register_session_tags</span>(self, session):
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;&#34;&#34;Register session&#39;s tags in lookup table&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> tag <span style="color:#f92672">in</span> session<span style="color:#f92672">.</span>inbound_tagset<span style="color:#f92672">.</span>get_all_tags():
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>tag_to_session[tag] <span style="color:#f92672">=</span> session
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">lookup_tag</span>(self, tag):
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;&#34;&#34;Fast tag lookup&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> self<span style="color:#f92672">.</span>tag_to_session<span style="color:#f92672">.</span>get(tag)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">expire_sessions</span>(self):
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;&#34;&#34;Periodic session expiration&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        now_time <span style="color:#f92672">=</span> now()
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Expire outbound sessions</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> dest, session <span style="color:#f92672">in</span> list(self<span style="color:#f92672">.</span>outbound_sessions<span style="color:#f92672">.</span>items()):
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> session<span style="color:#f92672">.</span>idle_time(now_time) <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">8</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">60</span>:
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">del</span> self<span style="color:#f92672">.</span>outbound_sessions[dest]
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Expire inbound sessions</span>
</span></span><span style="display:flex;"><span>        expired <span style="color:#f92672">=</span> []
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> session <span style="color:#f92672">in</span> self<span style="color:#f92672">.</span>inbound_sessions:
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> session<span style="color:#f92672">.</span>idle_time(now_time) <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">10</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">60</span>:
</span></span><span style="display:flex;"><span>                expired<span style="color:#f92672">.</span>append(session)
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> session <span style="color:#f92672">in</span> expired:
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>remove_inbound_session(session)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">remove_inbound_session</span>(self, session):
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;&#34;&#34;Remove inbound session and clean up tags&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>inbound_sessions<span style="color:#f92672">.</span>remove(session)
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Remove tags from lookup</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> tag <span style="color:#f92672">in</span> session<span style="color:#f92672">.</span>inbound_tagset<span style="color:#f92672">.</span>get_all_tags():
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> tag <span style="color:#f92672">in</span> self<span style="color:#f92672">.</span>tag_to_session:
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">del</span> self<span style="color:#f92672">.</span>tag_to_session[tag]
</span></span></code></pre></div><p><strong>मेमोरी प्रबंधन:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">TagMemoryManager</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">__init__</span>(self, max_memory_kb<span style="color:#f92672">=</span><span style="color:#ae81ff">10240</span>):  <span style="color:#75715e"># 10 MB default</span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>max_memory <span style="color:#f92672">=</span> max_memory_kb <span style="color:#f92672">*</span> <span style="color:#ae81ff">1024</span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>current_memory <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>max_tags_per_session <span style="color:#f92672">=</span> <span style="color:#ae81ff">160</span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>min_tags_per_session <span style="color:#f92672">=</span> <span style="color:#ae81ff">32</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">calculate_tag_memory</span>(self, session):
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;&#34;&#34;Calculate memory used by session tags&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        tag_count <span style="color:#f92672">=</span> len(session<span style="color:#f92672">.</span>inbound_tagset<span style="color:#f92672">.</span>tags)
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Each tag: 8 bytes (tag) + 2 bytes (index) + 32 bytes (key, optional)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># + overhead</span>
</span></span><span style="display:flex;"><span>        bytes_per_tag <span style="color:#f92672">=</span> <span style="color:#ae81ff">16</span> <span style="color:#66d9ef">if</span> session<span style="color:#f92672">.</span>defer_keys <span style="color:#66d9ef">else</span> <span style="color:#ae81ff">48</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> tag_count <span style="color:#f92672">*</span> bytes_per_tag
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">check_pressure</span>(self):
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;&#34;&#34;Check if under memory pressure&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> self<span style="color:#f92672">.</span>current_memory <span style="color:#f92672">&gt;</span> (self<span style="color:#f92672">.</span>max_memory <span style="color:#f92672">*</span> <span style="color:#ae81ff">0.9</span>)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">handle_pressure</span>(self):
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;&#34;&#34;Reduce memory usage when under pressure&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> self<span style="color:#f92672">.</span>check_pressure():
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Strategy 1: Reduce look-ahead windows</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> session <span style="color:#f92672">in</span> all_sessions:
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> session<span style="color:#f92672">.</span>look_ahead <span style="color:#f92672">&gt;</span> self<span style="color:#f92672">.</span>min_tags_per_session:
</span></span><span style="display:flex;"><span>                session<span style="color:#f92672">.</span>reduce_look_ahead(self<span style="color:#f92672">.</span>min_tags_per_session)
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Strategy 2: Trim old tags aggressively</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> session <span style="color:#f92672">in</span> all_sessions:
</span></span><span style="display:flex;"><span>            session<span style="color:#f92672">.</span>inbound_tagset<span style="color:#f92672">.</span>trim_behind(aggressive<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>)
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Strategy 3: Refuse new ratchets</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> session <span style="color:#f92672">in</span> all_sessions:
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> session<span style="color:#f92672">.</span>outbound_tagset<span style="color:#f92672">.</span>should_ratchet():
</span></span><span style="display:flex;"><span>                session<span style="color:#f92672">.</span>defer_ratchet <span style="color:#f92672">=</span> <span style="color:#66d9ef">True</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Strategy 4: Expire idle sessions early</span>
</span></span><span style="display:flex;"><span>        expire_idle_sessions(threshold<span style="color:#f92672">=</span><span style="color:#ae81ff">5</span><span style="color:#f92672">*</span><span style="color:#ae81ff">60</span>)  <span style="color:#75715e"># 5 min instead of 10</span>
</span></span></code></pre></div><h3 id="परकषण-रणनतय">परीक्षण रणनीतियाँ</h3>
<p><strong>इकाई परीक्षण:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">test_x25519_dh</span>():
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;&#34;&#34;Test X25519 key exchange&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    alice_sk <span style="color:#f92672">=</span> GENERATE_PRIVATE()
</span></span><span style="display:flex;"><span>    alice_pk <span style="color:#f92672">=</span> DERIVE_PUBLIC(alice_sk)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    bob_sk <span style="color:#f92672">=</span> GENERATE_PRIVATE()
</span></span><span style="display:flex;"><span>    bob_pk <span style="color:#f92672">=</span> DERIVE_PUBLIC(bob_sk)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Both sides compute same shared secret</span>
</span></span><span style="display:flex;"><span>    alice_shared <span style="color:#f92672">=</span> DH(alice_sk, bob_pk)
</span></span><span style="display:flex;"><span>    bob_shared <span style="color:#f92672">=</span> DH(bob_sk, alice_pk)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">assert</span> alice_shared <span style="color:#f92672">==</span> bob_shared
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">test_elligator2_encode_decode</span>():
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;&#34;&#34;Test Elligator2 roundtrip&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    sk <span style="color:#f92672">=</span> GENERATE_PRIVATE_ELG2()
</span></span><span style="display:flex;"><span>    pk <span style="color:#f92672">=</span> DERIVE_PUBLIC(sk)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    encoded <span style="color:#f92672">=</span> ENCODE_ELG2(pk)
</span></span><span style="display:flex;"><span>    decoded <span style="color:#f92672">=</span> DECODE_ELG2(encoded)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">assert</span> decoded <span style="color:#f92672">==</span> pk
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">test_chacha_poly_encrypt_decrypt</span>():
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;&#34;&#34;Test ChaCha20-Poly1305 AEAD&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    key <span style="color:#f92672">=</span> CSRNG(<span style="color:#ae81ff">32</span>)
</span></span><span style="display:flex;"><span>    nonce <span style="color:#f92672">=</span> construct_nonce(<span style="color:#ae81ff">42</span>)
</span></span><span style="display:flex;"><span>    plaintext <span style="color:#f92672">=</span> <span style="color:#e6db74">b</span><span style="color:#e6db74">&#34;Hello, I2P!&#34;</span>
</span></span><span style="display:flex;"><span>    ad <span style="color:#f92672">=</span> <span style="color:#e6db74">b</span><span style="color:#e6db74">&#34;associated_data&#34;</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    ciphertext <span style="color:#f92672">=</span> ENCRYPT(key, nonce, plaintext, ad)
</span></span><span style="display:flex;"><span>    decrypted <span style="color:#f92672">=</span> DECRYPT(key, nonce, ciphertext, ad)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">assert</span> decrypted <span style="color:#f92672">==</span> plaintext
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">test_session_tag_ratchet</span>():
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;&#34;&#34;Test session tag generation&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    sessTag_ck <span style="color:#f92672">=</span> CSRNG(<span style="color:#ae81ff">32</span>)
</span></span><span style="display:flex;"><span>    tagset <span style="color:#f92672">=</span> SessionTagRatchet(sessTag_ck)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Generate 100 tags</span>
</span></span><span style="display:flex;"><span>    tags <span style="color:#f92672">=</span> [tagset<span style="color:#f92672">.</span>get_next_tag() <span style="color:#66d9ef">for</span> _ <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">100</span>)]
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># All tags should be unique</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">assert</span> len(set(tags)) <span style="color:#f92672">==</span> <span style="color:#ae81ff">100</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Each tag should be 8 bytes</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> tag <span style="color:#f92672">in</span> tags:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">assert</span> len(tag) <span style="color:#f92672">==</span> <span style="color:#ae81ff">8</span>
</span></span></code></pre></div><p><strong>एकीकरण परीक्षण:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">test_ns_nsr_handshake</span>():
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;&#34;&#34;Test NS/NSR handshake&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Alice creates outbound session</span>
</span></span><span style="display:flex;"><span>    alice_session <span style="color:#f92672">=</span> OutboundSession(bob_destination, bound<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Alice sends NS</span>
</span></span><span style="display:flex;"><span>    ns_message <span style="color:#f92672">=</span> alice_session<span style="color:#f92672">.</span>build_ns_message(<span style="color:#e6db74">b</span><span style="color:#e6db74">&#34;Hello Bob&#34;</span>)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Bob receives NS</span>
</span></span><span style="display:flex;"><span>    bob_session <span style="color:#f92672">=</span> InboundSession<span style="color:#f92672">.</span>try_decrypt_ns(ns_message)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">assert</span> bob_session <span style="color:#f92672">is</span> <span style="color:#f92672">not</span> <span style="color:#66d9ef">None</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">assert</span> bob_session<span style="color:#f92672">.</span>bound <span style="color:#f92672">==</span> <span style="color:#66d9ef">True</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Bob sends NSR</span>
</span></span><span style="display:flex;"><span>    nsr_message <span style="color:#f92672">=</span> bob_session<span style="color:#f92672">.</span>build_nsr_message(<span style="color:#e6db74">b</span><span style="color:#e6db74">&#34;Hello Alice&#34;</span>)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Alice receives NSR</span>
</span></span><span style="display:flex;"><span>    alice_session<span style="color:#f92672">.</span>on_nsr_received(nsr_message)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">assert</span> alice_session<span style="color:#f92672">.</span>state <span style="color:#f92672">==</span> SessionState<span style="color:#f92672">.</span>ESTABLISHED
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Both should have matching ES tagsets</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># (Cannot directly compare, but can test by sending ES messages)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">test_es_bidirectional</span>():
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;&#34;&#34;Test ES messages in both directions&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># (After NS/NSR handshake)</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Alice sends ES to Bob</span>
</span></span><span style="display:flex;"><span>    es_alice_to_bob <span style="color:#f92672">=</span> alice_session<span style="color:#f92672">.</span>send_es_message(<span style="color:#e6db74">b</span><span style="color:#e6db74">&#34;Data from Alice&#34;</span>)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Bob receives ES</span>
</span></span><span style="display:flex;"><span>    bob_session<span style="color:#f92672">.</span>process_es_message(es_alice_to_bob)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Bob sends ES to Alice</span>
</span></span><span style="display:flex;"><span>    es_bob_to_alice <span style="color:#f92672">=</span> bob_session<span style="color:#f92672">.</span>send_es_message(<span style="color:#e6db74">b</span><span style="color:#e6db74">&#34;Data from Bob&#34;</span>)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Alice receives ES</span>
</span></span><span style="display:flex;"><span>    alice_session<span style="color:#f92672">.</span>process_es_message(es_bob_to_alice)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">test_dh_ratchet</span>():
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;&#34;&#34;Test DH ratchet&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># (After established session)</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Alice initiates ratchet</span>
</span></span><span style="display:flex;"><span>    alice_session<span style="color:#f92672">.</span>initiate_ratchet()
</span></span><span style="display:flex;"><span>    nextkey_alice <span style="color:#f92672">=</span> build_nextkey_block(
</span></span><span style="display:flex;"><span>        flags<span style="color:#f92672">=</span><span style="color:#ae81ff">0x01</span>,
</span></span><span style="display:flex;"><span>        key_id<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>        public_key<span style="color:#f92672">=</span>alice_new_key
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Send to Bob</span>
</span></span><span style="display:flex;"><span>    bob_session<span style="color:#f92672">.</span>process_nextkey_block(nextkey_alice)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Bob replies</span>
</span></span><span style="display:flex;"><span>    nextkey_bob <span style="color:#f92672">=</span> build_nextkey_block(
</span></span><span style="display:flex;"><span>        flags<span style="color:#f92672">=</span><span style="color:#ae81ff">0x03</span>,
</span></span><span style="display:flex;"><span>        key_id<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>        public_key<span style="color:#f92672">=</span>bob_new_key
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Send to Alice</span>
</span></span><span style="display:flex;"><span>    alice_session<span style="color:#f92672">.</span>process_nextkey_block(nextkey_bob)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Both should now be using new tagsets</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">assert</span> alice_session<span style="color:#f92672">.</span>outbound_tagset<span style="color:#f92672">.</span>id <span style="color:#f92672">==</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">assert</span> bob_session<span style="color:#f92672">.</span>inbound_tagset<span style="color:#f92672">.</span>id <span style="color:#f92672">==</span> <span style="color:#ae81ff">1</span>
</span></span></code></pre></div><p><strong>परीक्षण वेक्टर:</strong></p>
<p>विनिर्देश के अनुसार परीक्षण वेक्टर कार्यान्वित करें:</p>
<ol>
<li><strong>Noise IK Handshake</strong>: Noise के मानक परीक्षण वेक्टरों का उपयोग करें</li>
<li><strong>HKDF</strong>: RFC 5869 के परीक्षण वेक्टरों का उपयोग करें</li>
<li><strong>ChaCha20-Poly1305</strong>: RFC 7539 के परीक्षण वेक्टरों का उपयोग करें</li>
<li><strong>Elligator2</strong>: Elligator2 शोध-पत्र या OBFS4 से परीक्षण वेक्टरों का उपयोग करें</li>
</ol>
<p><strong>अंतरसंचालनीयता परीक्षण:</strong></p>
<ol>
<li><strong>Java I2P</strong>: Java I2P संदर्भ कार्यान्वयन के विरुद्ध परीक्षण करें</li>
<li><strong>i2pd</strong>: C++ i2pd कार्यान्वयन के विरुद्ध परीक्षण करें</li>
<li><strong>पैकेट कैप्चर</strong>: संदेश प्रारूपों को सत्यापित करने के लिए Wireshark dissector (पैकेट विश्लेषक मॉड्यूल, यदि उपलब्ध हो) का उपयोग करें</li>
<li><strong>अंतर-कार्यान्वयन</strong>: ऐसा टेस्ट हार्नेस बनाएँ जो कार्यान्वयनों के बीच भेज/प्राप्त कर सके</li>
</ol>
<h3 id="परदरशन-सबध-वचर">प्रदर्शन संबंधी विचार</h3>
<p><strong>कुंजी निर्माण:</strong></p>
<p>Elligator2 (एक क्रिप्टोग्राफिक मैपिंग तकनीक) के लिए कुंजी उत्पन्न करना गणनात्मक रूप से महंगा है (50% अस्वीकृति दर):</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">KeyPool</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;&#34;&#34;Pre-generate keys in background thread&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">__init__</span>(self, pool_size<span style="color:#f92672">=</span><span style="color:#ae81ff">10</span>):
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>pool <span style="color:#f92672">=</span> Queue(maxsize<span style="color:#f92672">=</span>pool_size)
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>generator_thread <span style="color:#f92672">=</span> Thread(target<span style="color:#f92672">=</span>self<span style="color:#f92672">.</span>generate_keys, daemon<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>)
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>generator_thread<span style="color:#f92672">.</span>start()
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">generate_keys</span>(self):
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">while</span> <span style="color:#66d9ef">True</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> self<span style="color:#f92672">.</span>pool<span style="color:#f92672">.</span>full():
</span></span><span style="display:flex;"><span>                keypair <span style="color:#f92672">=</span> generate_elg2_keypair()
</span></span><span style="display:flex;"><span>                <span style="color:#75715e"># Also compute encoded form</span>
</span></span><span style="display:flex;"><span>                encoded <span style="color:#f92672">=</span> ENCODE_ELG2(keypair<span style="color:#f92672">.</span>public_key)
</span></span><span style="display:flex;"><span>                self<span style="color:#f92672">.</span>pool<span style="color:#f92672">.</span>put((keypair, encoded))
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>                sleep(<span style="color:#ae81ff">0.1</span>)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">get_keypair</span>(self):
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">try</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> self<span style="color:#f92672">.</span>pool<span style="color:#f92672">.</span>get(timeout<span style="color:#f92672">=</span><span style="color:#ae81ff">1.0</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">except</span> Empty:
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># Pool exhausted, generate inline</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> generate_elg2_keypair()
</span></span></code></pre></div><p><strong>टैग लुकअप:</strong></p>
<p>O(1) टैग खोज के लिए हैश तालिकाएँ उपयोग करें:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">FastTagLookup</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">__init__</span>(self):
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>tag_to_session <span style="color:#f92672">=</span> {}  <span style="color:#75715e"># Python dict is hash table</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">add_tag</span>(self, tag, session, index):
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># 8-byte tag as bytes is hashable</span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>tag_to_session[tag] <span style="color:#f92672">=</span> (session, index)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">lookup_tag</span>(self, tag):
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> self<span style="color:#f92672">.</span>tag_to_session<span style="color:#f92672">.</span>get(tag)
</span></span></code></pre></div><p><strong>मेमोरी अनुकूलन:</strong></p>
<p>सममित कुंजी उत्पन्न करने को स्थगित करें:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">DeferredKeyRatchet</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;&#34;&#34;Only generate keys when needed&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">__init__</span>(self, symmKey_ck):
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>chainKey <span style="color:#f92672">=</span> symmKey_ck
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>index <span style="color:#f92672">=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>cache <span style="color:#f92672">=</span> LRUCache(maxsize<span style="color:#f92672">=</span><span style="color:#ae81ff">32</span>)  <span style="color:#75715e"># Cache recent keys</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">get_key</span>(self, index):
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Check cache first</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> index <span style="color:#f92672">in</span> self<span style="color:#f92672">.</span>cache:
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> self<span style="color:#f92672">.</span>cache[index]
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Generate keys up to index</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">while</span> self<span style="color:#f92672">.</span>index <span style="color:#f92672">&lt;</span> index:
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>index <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>            keydata <span style="color:#f92672">=</span> HKDF(self<span style="color:#f92672">.</span>chainKey, ZEROLEN, <span style="color:#e6db74">&#34;SymmetricRatchet&#34;</span>, <span style="color:#ae81ff">64</span>)
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>chainKey <span style="color:#f92672">=</span> keydata[<span style="color:#ae81ff">0</span>:<span style="color:#ae81ff">31</span>]
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> self<span style="color:#f92672">.</span>index <span style="color:#f92672">==</span> index:
</span></span><span style="display:flex;"><span>                key <span style="color:#f92672">=</span> keydata[<span style="color:#ae81ff">32</span>:<span style="color:#ae81ff">63</span>]
</span></span><span style="display:flex;"><span>                self<span style="color:#f92672">.</span>cache[index] <span style="color:#f92672">=</span> key
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">return</span> key
</span></span></code></pre></div><p><strong>बैच प्रसंस्करण:</strong></p>
<p>कई संदेशों को बैच में संसाधित करें:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">process_message_batch</span>(messages):
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;&#34;&#34;Process multiple messages efficiently&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    results <span style="color:#f92672">=</span> []
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Group by type</span>
</span></span><span style="display:flex;"><span>    ns_messages <span style="color:#f92672">=</span> []
</span></span><span style="display:flex;"><span>    nsr_messages <span style="color:#f92672">=</span> []
</span></span><span style="display:flex;"><span>    es_messages <span style="color:#f92672">=</span> []
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> msg <span style="color:#f92672">in</span> messages:
</span></span><span style="display:flex;"><span>        msg_type <span style="color:#f92672">=</span> classify_message(msg)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> msg_type[<span style="color:#ae81ff">0</span>] <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;NS&#39;</span>:
</span></span><span style="display:flex;"><span>            ns_messages<span style="color:#f92672">.</span>append(msg)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">elif</span> msg_type[<span style="color:#ae81ff">0</span>] <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;NSR&#39;</span>:
</span></span><span style="display:flex;"><span>            nsr_messages<span style="color:#f92672">.</span>append(msg)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">elif</span> msg_type[<span style="color:#ae81ff">0</span>] <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;ES&#39;</span>:
</span></span><span style="display:flex;"><span>            es_messages<span style="color:#f92672">.</span>append(msg)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Process in batches</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># ES messages are most common, process first</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> msg <span style="color:#f92672">in</span> es_messages:
</span></span><span style="display:flex;"><span>        results<span style="color:#f92672">.</span>append(process_es_message(msg))
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> msg <span style="color:#f92672">in</span> nsr_messages:
</span></span><span style="display:flex;"><span>        results<span style="color:#f92672">.</span>append(process_nsr_message(msg))
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> msg <span style="color:#f92672">in</span> ns_messages:
</span></span><span style="display:flex;"><span>        results<span style="color:#f92672">.</span>append(process_ns_message(msg))
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> results
</span></span></code></pre></div><hr>
<h2 id="सरकष-सबध-वचर">सुरक्षा संबंधी विचार</h2>
<h3 id="धमक-मडल">धमकी मॉडल</h3>
<p><strong>विरोधी की क्षमताएँ:</strong></p>
<ol>
<li><strong>निष्क्रिय निरीक्षक</strong>: समस्त नेटवर्क ट्रैफ़िक की निगरानी कर सकता है</li>
<li><strong>सक्रिय हमलावर</strong>: संदेशों को इंजेक्ट, संशोधित, ड्रॉप, और रिप्ले (दोहराकर भेजना) कर सकता है</li>
<li><strong>समझौता-ग्रस्त नोड</strong>: किसी router या गंतव्य को समझौता-ग्रस्त बना सकता है</li>
<li><strong>ट्रैफ़िक विश्लेषण</strong>: ट्रैफ़िक पैटर्न का सांख्यिकीय विश्लेषण कर सकता है</li>
</ol>
<p><strong>सुरक्षा लक्ष्य:</strong></p>
<ol>
<li><strong>गोपनीयता</strong>: संदेश की सामग्री पर्यवेक्षक से छिपी रहती है</li>
<li><strong>प्रमाणीकरण</strong>: प्रेषक की पहचान सत्यापित (बाउंड सत्रों के लिए)</li>
<li><strong>Forward Secrecy</strong> (आगे की गोपनीयता): कुंजियों से समझौता हो जाने पर भी पुराने संदेश गोपनीय बने रहते हैं</li>
<li><strong>रीप्ले-रोकथाम</strong>: पुराने संदेशों का रीप्ले संभव नहीं</li>
<li><strong>ट्रैफ़िक अस्पष्टकरण</strong>: हैंडशेक यादृच्छिक डेटा से अप्रभेद्य</li>
</ol>
<h3 id="करपटगरफक-धरणए">क्रिप्टोग्राफिक धारणाएँ</h3>
<p><strong>कठिनता मान्यताएँ:</strong></p>
<ol>
<li><strong>X25519 CDH</strong>: Curve25519 पर Computational Diffie-Hellman समस्या कठिन है</li>
<li><strong>ChaCha20 PRF</strong>: ChaCha20 एक छद्म-यादृच्छिक फ़ंक्शन (pseudorandom function) है</li>
<li><strong>Poly1305 MAC</strong>: Poly1305 चुने हुए संदेश आक्रमण (chosen message attack) के तहत जालसाजी-प्रतिरोधी है</li>
<li><strong>SHA-256 CR</strong>: SHA-256 टकराव-प्रतिरोधी है</li>
<li><strong>HKDF Security</strong>: HKDF समान रूप से वितरित कुंजियों को निकालता और विस्तारित करता है</li>
</ol>
<p><strong>सुरक्षा स्तर:</strong></p>
<ul>
<li><strong>X25519</strong>: ~128-बिट सुरक्षा (वक्र का क्रम 2^252)</li>
<li><strong>ChaCha20</strong>: 256-बिट कुंजियाँ, 256-बिट सुरक्षा</li>
<li><strong>Poly1305</strong>: 128-बिट सुरक्षा (टकराव की संभावना)</li>
<li><strong>SHA-256</strong>: 128-बिट टकराव-प्रतिरोध, 256-बिट पूर्व-छवि प्रतिरोध</li>
</ul>
<h3 id="कज-परबधन">कुंजी प्रबंधन</h3>
<p><strong>कुंजी निर्माण:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># CRITICAL: Use cryptographically secure RNG</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">CSRNG</span>(length):
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># GOOD: os.urandom, secrets.token_bytes (Python)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># GOOD: /dev/urandom (Linux)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># GOOD: BCryptGenRandom (Windows)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># BAD: random.random(), Math.random() (NOT cryptographically secure)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> os<span style="color:#f92672">.</span>urandom(length)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># CRITICAL: Validate keys</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">validate_x25519_key</span>(pubkey):
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Check for weak keys (all zeros, small order points)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> pubkey <span style="color:#f92672">==</span> bytes(<span style="color:#ae81ff">32</span>):
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">raise</span> WeakKeyError(<span style="color:#e6db74">&#34;All-zero public key&#34;</span>)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Perform DH to check for weak shared secrets</span>
</span></span><span style="display:flex;"><span>    test_shared <span style="color:#f92672">=</span> DH(test_private_key, pubkey)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> test_shared <span style="color:#f92672">==</span> bytes(<span style="color:#ae81ff">32</span>):
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">raise</span> WeakKeyError(<span style="color:#e6db74">&#34;Results in zero shared secret&#34;</span>)
</span></span></code></pre></div><p><strong>कुंजी भंडारण:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># CRITICAL: Protect private keys</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">SecureKeyStorage</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">__init__</span>(self):
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Store in memory with protection</span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>keys <span style="color:#f92672">=</span> {}
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Option 1: Memory locking (prevent swapping to disk)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># mlock(self.keys)</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Option 2: Encrypted storage</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># self.encryption_key = derive_from_password()</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">store_key</span>(self, key_id, private_key):
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Option: Encrypt before storage</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># encrypted = encrypt(private_key, self.encryption_key)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># self.keys[key_id] = encrypted</span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>keys[key_id] <span style="color:#f92672">=</span> private_key
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">delete_key</span>(self, key_id):
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Securely wipe memory</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> key_id <span style="color:#f92672">in</span> self<span style="color:#f92672">.</span>keys:
</span></span><span style="display:flex;"><span>            key <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>keys[key_id]
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># Overwrite with zeros before deletion</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(len(key)):
</span></span><span style="display:flex;"><span>                key[i] <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">del</span> self<span style="color:#f92672">.</span>keys[key_id]
</span></span></code></pre></div><p><strong>कुंजी परिवर्तन:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># CRITICAL: Rotate keys regularly</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">KeyRotationPolicy</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">__init__</span>(self):
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>max_messages_per_tagset <span style="color:#f92672">=</span> <span style="color:#ae81ff">4096</span>  <span style="color:#75715e"># Ratchet before 65535</span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>max_tagset_age <span style="color:#f92672">=</span> <span style="color:#ae81ff">10</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">60</span>       <span style="color:#75715e"># 10 minutes</span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>max_session_age <span style="color:#f92672">=</span> <span style="color:#ae81ff">60</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">60</span>      <span style="color:#75715e"># 1 hour</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">should_ratchet</span>(self, tagset):
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> (tagset<span style="color:#f92672">.</span>messages_sent <span style="color:#f92672">&gt;=</span> self<span style="color:#f92672">.</span>max_messages_per_tagset <span style="color:#f92672">or</span>
</span></span><span style="display:flex;"><span>                tagset<span style="color:#f92672">.</span>age() <span style="color:#f92672">&gt;=</span> self<span style="color:#f92672">.</span>max_tagset_age)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">should_replace_session</span>(self, session):
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> session<span style="color:#f92672">.</span>age() <span style="color:#f92672">&gt;=</span> self<span style="color:#f92672">.</span>max_session_age
</span></span></code></pre></div><h3 id="हमल-क-शमन-उपय">हमलों के शमन उपाय</h3>
<h3 id="रपल-हमल-क-शमन-उपय">रीप्ले हमले के शमन उपाय</h3>
<p><strong>DateTime वैधता जांच:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>MAX_CLOCK_SKEW_PAST <span style="color:#f92672">=</span> <span style="color:#ae81ff">5</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">60</span>
</span></span><span style="display:flex;"><span>MAX_CLOCK_SKEW_FUTURE <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">60</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">validate_datetime</span>(timestamp):
</span></span><span style="display:flex;"><span>    now <span style="color:#f92672">=</span> int(time<span style="color:#f92672">.</span>time())
</span></span><span style="display:flex;"><span>    age <span style="color:#f92672">=</span> now <span style="color:#f92672">-</span> timestamp
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> age <span style="color:#f92672">&lt;</span> <span style="color:#f92672">-</span>MAX_CLOCK_SKEW_FUTURE:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">raise</span> ReplayError(<span style="color:#e6db74">&#34;Timestamp too far in future&#34;</span>)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> age <span style="color:#f92672">&gt;</span> MAX_CLOCK_SKEW_PAST:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">raise</span> ReplayError(<span style="color:#e6db74">&#34;Timestamp too old&#34;</span>)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">True</span>
</span></span></code></pre></div><p><strong>NS संदेशों के लिए Bloom Filter (प्रायिकता-आधारित फ़िल्टर):</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ReplayFilter</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">__init__</span>(self, capacity<span style="color:#f92672">=</span><span style="color:#ae81ff">100000</span>, error_rate<span style="color:#f92672">=</span><span style="color:#ae81ff">0.001</span>, duration<span style="color:#f92672">=</span><span style="color:#ae81ff">5</span><span style="color:#f92672">*</span><span style="color:#ae81ff">60</span>):
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>bloom <span style="color:#f92672">=</span> BloomFilter(capacity<span style="color:#f92672">=</span>capacity, error_rate<span style="color:#f92672">=</span>error_rate)
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>duration <span style="color:#f92672">=</span> duration
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>entries <span style="color:#f92672">=</span> []  <span style="color:#75715e"># (timestamp, ephemeral_key)</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">check_replay</span>(self, ephemeral_key, timestamp):
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Validate timestamp</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> validate_datetime(timestamp):
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">False</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Check Bloom filter</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> ephemeral_key <span style="color:#f92672">in</span> self<span style="color:#f92672">.</span>bloom:
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># Potential replay (or false positive)</span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># Check exact match in entries</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">for</span> ts, key <span style="color:#f92672">in</span> self<span style="color:#f92672">.</span>entries:
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span> key <span style="color:#f92672">==</span> ephemeral_key:
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">False</span>  <span style="color:#75715e"># Definite replay</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Add to filter</span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>bloom<span style="color:#f92672">.</span>add(ephemeral_key)
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>entries<span style="color:#f92672">.</span>append((timestamp, ephemeral_key))
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Expire old entries</span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>expire_old_entries()
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">True</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">expire_old_entries</span>(self):
</span></span><span style="display:flex;"><span>        now <span style="color:#f92672">=</span> int(time<span style="color:#f92672">.</span>time())
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>entries <span style="color:#f92672">=</span> [(ts, key) <span style="color:#66d9ef">for</span> ts, key <span style="color:#f92672">in</span> self<span style="color:#f92672">.</span>entries
</span></span><span style="display:flex;"><span>                       <span style="color:#66d9ef">if</span> now <span style="color:#f92672">-</span> ts <span style="color:#f92672">&lt;</span> self<span style="color:#f92672">.</span>duration]
</span></span></code></pre></div><p><strong>Session Tag (सत्र टैग) का एक-बार उपयोग:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">process_session_tag</span>(tag):
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Look up tag</span>
</span></span><span style="display:flex;"><span>    entry <span style="color:#f92672">=</span> tagset<span style="color:#f92672">.</span>lookup_tag(tag)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> entry <span style="color:#f92672">is</span> <span style="color:#66d9ef">None</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">raise</span> <span style="color:#a6e22e">ValueError</span>(<span style="color:#e6db74">&#34;Invalid session tag&#34;</span>)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># CRITICAL: Remove tag immediately (one-time use)</span>
</span></span><span style="display:flex;"><span>    tagset<span style="color:#f92672">.</span>remove_tag(tag)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Use associated key</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> entry<span style="color:#f92672">.</span>key, entry<span style="color:#f92672">.</span>index
</span></span></code></pre></div><h3 id="key-compromise-impersonation-kci-कज-समझत-क-करण-परतरपण-शमन-उपय">Key Compromise Impersonation (KCI) (कुंजी-समझौते के कारण प्रतिरूपण) शमन उपाय</h3>
<p><strong>समस्या</strong>: NS संदेश प्रमाणीकरण KCI (कुंजी से समझौता होने पर प्रतिरूपण) के प्रति असुरक्षित है (प्रमाणीकरण स्तर 1)</p>
<p><strong>शमन</strong>:</p>
<ol>
<li>यथाशीघ्र NSR (प्रमाणीकरण स्तर 2) में संक्रमण करें</li>
<li>सुरक्षा-आवश्यक कार्यों के लिए NS payload (NS संदेश का डेटा भाग) पर भरोसा न करें</li>
<li>अपरिवर्तनीय कार्रवाइयाँ करने से पहले NSR की पुष्टि की प्रतीक्षा करें</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">process_ns_message</span>(ns_message):
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># NS authenticated at Level 1 (KCI vulnerable)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Do NOT perform security-critical operations yet</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Extract sender&#39;s static key</span>
</span></span><span style="display:flex;"><span>    sender_key <span style="color:#f92672">=</span> ns_message<span style="color:#f92672">.</span>static_key
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Mark session as pending Level 2 authentication</span>
</span></span><span style="display:flex;"><span>    session<span style="color:#f92672">.</span>auth_level <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>    session<span style="color:#f92672">.</span>sender_key <span style="color:#f92672">=</span> sender_key
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Send NSR</span>
</span></span><span style="display:flex;"><span>    send_nsr_reply(session)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">process_first_es_message</span>(es_message):
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Now we have Level 2 authentication (KCI resistant)</span>
</span></span><span style="display:flex;"><span>    session<span style="color:#f92672">.</span>auth_level <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Safe to perform security-critical operations</span>
</span></span><span style="display:flex;"><span>    process_security_critical_operation(es_message)
</span></span></code></pre></div><h3 id="denial-of-service-सव-असवकरण-क-शमन-उपय">Denial-of-Service (सेवा-अस्वीकरण) के शमन उपाय</h3>
<p><strong>NS फ्लड सुरक्षा:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">NSFloodProtection</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">__init__</span>(self):
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>ns_count <span style="color:#f92672">=</span> defaultdict(int)  <span style="color:#75715e"># source -&gt; count</span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>ns_timestamps <span style="color:#f92672">=</span> defaultdict(list)  <span style="color:#75715e"># source -&gt; [timestamps]</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>max_ns_per_source <span style="color:#f92672">=</span> <span style="color:#ae81ff">5</span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>rate_window <span style="color:#f92672">=</span> <span style="color:#ae81ff">10</span>  <span style="color:#75715e"># seconds</span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>max_concurrent_ns <span style="color:#f92672">=</span> <span style="color:#ae81ff">100</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">check_ns_allowed</span>(self, source):
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Global limit</span>
</span></span><span style="display:flex;"><span>        total_pending <span style="color:#f92672">=</span> sum(self<span style="color:#f92672">.</span>ns_count<span style="color:#f92672">.</span>values())
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> total_pending <span style="color:#f92672">&gt;=</span> self<span style="color:#f92672">.</span>max_concurrent_ns:
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">False</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Per-source rate limit</span>
</span></span><span style="display:flex;"><span>        now <span style="color:#f92672">=</span> time<span style="color:#f92672">.</span>time()
</span></span><span style="display:flex;"><span>        timestamps <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>ns_timestamps[source]
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Remove old timestamps</span>
</span></span><span style="display:flex;"><span>        timestamps <span style="color:#f92672">=</span> [ts <span style="color:#66d9ef">for</span> ts <span style="color:#f92672">in</span> timestamps <span style="color:#66d9ef">if</span> now <span style="color:#f92672">-</span> ts <span style="color:#f92672">&lt;</span> self<span style="color:#f92672">.</span>rate_window]
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>ns_timestamps[source] <span style="color:#f92672">=</span> timestamps
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Check rate</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> len(timestamps) <span style="color:#f92672">&gt;=</span> self<span style="color:#f92672">.</span>max_ns_per_source:
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">False</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Allow NS</span>
</span></span><span style="display:flex;"><span>        timestamps<span style="color:#f92672">.</span>append(now)
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>ns_count[source] <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">True</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">on_session_established</span>(self, source):
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Decrease pending count</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> self<span style="color:#f92672">.</span>ns_count[source] <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span>:
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>ns_count[source] <span style="color:#f92672">-=</span> <span style="color:#ae81ff">1</span>
</span></span></code></pre></div><p><strong>टैग संग्रहण सीमाएँ:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">TagStorageLimit</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">__init__</span>(self, max_tags<span style="color:#f92672">=</span><span style="color:#ae81ff">1000000</span>):
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>max_tags <span style="color:#f92672">=</span> max_tags
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>current_tags <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">can_create_session</span>(self, look_ahead):
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> self<span style="color:#f92672">.</span>current_tags <span style="color:#f92672">+</span> look_ahead <span style="color:#f92672">&gt;</span> self<span style="color:#f92672">.</span>max_tags:
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">False</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">True</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">add_tags</span>(self, count):
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>current_tags <span style="color:#f92672">+=</span> count
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">remove_tags</span>(self, count):
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>current_tags <span style="color:#f92672">-=</span> count
</span></span></code></pre></div><p><strong>अनुकूली संसाधन प्रबंधन:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">AdaptiveResourceManager</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">__init__</span>(self):
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>load_level <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>  <span style="color:#75715e"># 0 = low, 1 = medium, 2 = high, 3 = critical</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">adjust_parameters</span>(self):
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> self<span style="color:#f92672">.</span>load_level <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># Normal operation</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> {
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#39;max_look_ahead&#39;</span>: <span style="color:#ae81ff">160</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#39;max_sessions&#39;</span>: <span style="color:#ae81ff">1000</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#39;session_timeout&#39;</span>: <span style="color:#ae81ff">10</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">60</span>
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">elif</span> self<span style="color:#f92672">.</span>load_level <span style="color:#f92672">==</span> <span style="color:#ae81ff">1</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># Moderate load</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> {
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#39;max_look_ahead&#39;</span>: <span style="color:#ae81ff">80</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#39;max_sessions&#39;</span>: <span style="color:#ae81ff">800</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#39;session_timeout&#39;</span>: <span style="color:#ae81ff">8</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">60</span>
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">elif</span> self<span style="color:#f92672">.</span>load_level <span style="color:#f92672">==</span> <span style="color:#ae81ff">2</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># High load</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> {
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#39;max_look_ahead&#39;</span>: <span style="color:#ae81ff">32</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#39;max_sessions&#39;</span>: <span style="color:#ae81ff">500</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#39;session_timeout&#39;</span>: <span style="color:#ae81ff">5</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">60</span>
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">else</span>:  <span style="color:#75715e"># load_level == 3</span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># Critical load</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> {
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#39;max_look_ahead&#39;</span>: <span style="color:#ae81ff">16</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#39;max_sessions&#39;</span>: <span style="color:#ae81ff">200</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#39;session_timeout&#39;</span>: <span style="color:#ae81ff">3</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">60</span>
</span></span><span style="display:flex;"><span>            }
</span></span></code></pre></div><h3 id="टरफक-वशलषण-परतरध">ट्रैफ़िक विश्लेषण प्रतिरोध</h3>
<p><strong>Elligator2 एन्कोडिंग:</strong></p>
<p>हैंडशेक संदेशों को यादृच्छिक डेटा से अप्रभेद्य बनाता है:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># NS and NSR start with Elligator2-encoded ephemeral keys</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Observer cannot distinguish from random 32-byte string</span>
</span></span></code></pre></div><p><strong>पैडिंग रणनीतियाँ:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># Resist message size fingerprinting</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">add_padding</span>(payload, strategy<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;random&#39;</span>):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> strategy <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;random&#39;</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Random padding 0-15 bytes</span>
</span></span><span style="display:flex;"><span>        size <span style="color:#f92672">=</span> random<span style="color:#f92672">.</span>randint(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">15</span>)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">elif</span> strategy <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;round&#39;</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Round to next 64-byte boundary</span>
</span></span><span style="display:flex;"><span>        target <span style="color:#f92672">=</span> ((len(payload) <span style="color:#f92672">+</span> <span style="color:#ae81ff">63</span>) <span style="color:#f92672">//</span> <span style="color:#ae81ff">64</span>) <span style="color:#f92672">*</span> <span style="color:#ae81ff">64</span>
</span></span><span style="display:flex;"><span>        size <span style="color:#f92672">=</span> target <span style="color:#f92672">-</span> len(payload) <span style="color:#f92672">-</span> <span style="color:#ae81ff">3</span>  <span style="color:#75715e"># -3 for block header</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">elif</span> strategy <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;fixed&#39;</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Always 1KB messages</span>
</span></span><span style="display:flex;"><span>        size <span style="color:#f92672">=</span> <span style="color:#ae81ff">1024</span> <span style="color:#f92672">-</span> len(payload) <span style="color:#f92672">-</span> <span style="color:#ae81ff">3</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> build_padding_block(size)
</span></span></code></pre></div><p><strong>टाइमिंग हमले:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># CRITICAL: Use constant-time operations</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">constant_time_compare</span>(a, b):
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;&#34;&#34;Constant-time byte string comparison&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> len(a) <span style="color:#f92672">!=</span> len(b):
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">False</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    result <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> x, y <span style="color:#f92672">in</span> zip(a, b):
</span></span><span style="display:flex;"><span>        result <span style="color:#f92672">|=</span> x <span style="color:#f92672">^</span> y
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> result <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># CRITICAL: Constant-time MAC verification</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">verify_mac</span>(computed_mac, received_mac):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> constant_time_compare(computed_mac, received_mac):
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Always take same time regardless of where comparison fails</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">raise</span> AuthenticationError(<span style="color:#e6db74">&#34;MAC verification failed&#34;</span>)
</span></span></code></pre></div><h3 id="करयनवयन-म-समनय-गलतय">कार्यान्वयन में सामान्य गलतियाँ</h3>
<p><strong>सामान्य गलतियाँ:</strong></p>
<ol>
<li><strong>Nonce का पुन: उपयोग</strong>: (key, nonce) युग्मों का कभी भी पुन: उपयोग न करें
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># BAD: Reusing nonce with same key</span>
</span></span><span style="display:flex;"><span>ciphertext1 <span style="color:#f92672">=</span> ENCRYPT(key, nonce, plaintext1, ad1)
</span></span><span style="display:flex;"><span>ciphertext2 <span style="color:#f92672">=</span> ENCRYPT(key, nonce, plaintext2, ad2)  <span style="color:#75715e"># CATASTROPHIC</span>
</span></span></code></pre></div></li>
</ol>
<h1 id="सह-हर-सदश-क-लए-अलग-nonce-एक-बर-परयकत-यदचछक-मन----ciphertext1--encryptkey-nonce1-plaintext1-ad1----ciphertext2--encryptkey-nonce2-plaintext2-ad2">सही: हर संदेश के लिए अलग nonce (एक बार प्रयुक्त यादृच्छिक मान)    ciphertext1 = ENCRYPT(key, nonce1, plaintext1, ad1)    ciphertext2 = ENCRYPT(key, nonce2, plaintext2, ad2)</h1>
<pre tabindex="0"><code>
2. **Ephemeral Key Reuse**: Generate fresh ephemeral key for each NS/NSR
```python
# गलत: अस्थायी कुंजी का पुन: उपयोग    ephemeral_key = generate_elg2_keypair()    send_ns_message(ephemeral_key)    send_ns_message(ephemeral_key)  # गलत

# अच्छा: प्रत्येक संदेश के लिए नई कुंजी    send_ns_message(generate_elg2_keypair())    send_ns_message(generate_elg2_keypair())
</code></pre><ol start="3">
<li><strong>Weak RNG</strong>: Use cryptographically secure random number generator
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"></code></pre></div></li>
</ol>
<h1 id="खरब-गर-करपटगरफक-rng-यदचछक-सखय-जनक----import-random----key--bytesrandomrandint0-255-for-_-in-range32---असरकषत">खराब: गैर-क्रिप्टोग्राफ़िक RNG (यादृच्छिक संख्या जनक)    import random    key = bytes([random.randint(0, 255) for _ in range(32)])  # असुरक्षित</h1>
<h1 id="अचछ-करपटगरफक-रप-स-सरकषत-rng-रडम-नबर-जनरटर----import-os----key--osurandom32">अच्छा: क्रिप्टोग्राफ़िक रूप से सुरक्षित RNG (रैंडम नंबर जनरेटर)    import os    key = os.urandom(32)</h1>
<pre tabindex="0"><code>
4. **Timing Attacks**: Use constant-time comparisons
```python
# खराब: शीघ्र-निकास तुलना    if computed_mac == received_mac:  # टाइमिंग लीक

    pass

# सही: स्थिर-समय तुलना    if constant_time_compare(computed_mac, received_mac):

    pass
</code></pre><ol start="5">
<li><strong>Incomplete MAC Verification</strong>: Always verify before using data
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"></code></pre></div></li>
</ol>
<h1 id="खरब-सतयपन-स-पहल-डकरपट-करन----plaintext--chacha20_decryptkey-nonce-ciphertext----mac_ok--verify_macmac-plaintext---बहत-दर-ह-चक----if-not-mac_ok">खराब: सत्यापन से पहले डिक्रिप्ट करना    plaintext = chacha20_decrypt(key, nonce, ciphertext)    mac_ok = verify_mac(mac, plaintext)  # बहुत देर हो चुकी    if not mac_ok:</h1>
<pre><code>   return error
</code></pre>
<h1 id="सह-aead-सबदध-डट-सहत-परमणत-एनकरपशन-डकरपट-करन-स-पहल-सतयपन-करत-ह----try">सही: AEAD (संबद्ध डेटा सहित प्रमाणित एन्क्रिप्शन) डिक्रिप्ट करने से पहले सत्यापन करता है    try:</h1>
<pre><code>   plaintext = DECRYPT(key, nonce, ciphertext, ad)  # Verifies MAC first
</code></pre>
<p>except AuthenticationError:</p>
<pre><code>   return error
</code></pre>
<pre tabindex="0"><code>
6. **Key Deletion**: Securely wipe keys from memory
```python
# गलत: सरल हटाना    del private_key  # अब भी मेमोरी में

# उचित: हटाने से पहले ओवरराइट करें    for i in range(len(private_key)):

    private_key[i] = 0
del private_key
</code></pre><h3 id="security-audits">Security Audits</h3>
<p><strong>Recommended Audits:</strong></p>
<ol>
<li><strong>Cryptographic Review</strong>: Expert review of KDF chains and DH operations</li>
<li><strong>Implementation Audit</strong>: Code review for timing attacks, key management, RNG usage</li>
<li><strong>Protocol Analysis</strong>: Formal verification of handshake security properties</li>
<li><strong>Side-Channel Analysis</strong>: Timing, power, and cache attacks</li>
<li><strong>Fuzzing</strong>: Random input testing for parser robustness</li>
</ol>
<p><strong>Test Cases:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># सुरक्षा-महत्त्वपूर्ण परीक्षण मामले</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">test_nonce_uniqueness</span>():
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;&#34;&#34;Ensure nonces are never reused&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    nonces <span style="color:#f92672">=</span> set()
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">10000</span>):
</span></span><span style="display:flex;"><span>        nonce <span style="color:#f92672">=</span> construct_nonce(i)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">assert</span> nonce <span style="color:#f92672">not</span> <span style="color:#f92672">in</span> nonces
</span></span><span style="display:flex;"><span>        nonces<span style="color:#f92672">.</span>add(nonce)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">test_key_isolation</span>():
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;&#34;&#34;Ensure sessions don&#39;t share keys&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    session1 <span style="color:#f92672">=</span> create_session(destination1)
</span></span><span style="display:flex;"><span>    session2 <span style="color:#f92672">=</span> create_session(destination2)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">assert</span> session1<span style="color:#f92672">.</span>key <span style="color:#f92672">!=</span> session2<span style="color:#f92672">.</span>key
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">test_replay_prevention</span>():
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;&#34;&#34;Ensure replay attacks are detected&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    ns_message <span style="color:#f92672">=</span> create_ns_message()
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># First delivery succeeds</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">assert</span> process_ns_message(ns_message) <span style="color:#f92672">==</span> <span style="color:#66d9ef">True</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Replay fails</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">assert</span> process_ns_message(ns_message) <span style="color:#f92672">==</span> <span style="color:#66d9ef">False</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">test_mac_verification</span>():
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;&#34;&#34;Ensure MAC verification is enforced&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    key <span style="color:#f92672">=</span> CSRNG(<span style="color:#ae81ff">32</span>)
</span></span><span style="display:flex;"><span>    nonce <span style="color:#f92672">=</span> construct_nonce(<span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex;"><span>    plaintext <span style="color:#f92672">=</span> <span style="color:#e6db74">b</span><span style="color:#e6db74">&#34;test&#34;</span>
</span></span><span style="display:flex;"><span>    ad <span style="color:#f92672">=</span> <span style="color:#e6db74">b</span><span style="color:#e6db74">&#34;test_ad&#34;</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    ciphertext <span style="color:#f92672">=</span> ENCRYPT(key, nonce, plaintext, ad)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Correct MAC verifies</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">assert</span> DECRYPT(key, nonce, ciphertext, ad) <span style="color:#f92672">==</span> plaintext
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Corrupted MAC fails</span>
</span></span><span style="display:flex;"><span>    corrupted <span style="color:#f92672">=</span> ciphertext[:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">+</span> bytes([ciphertext[<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">^</span> <span style="color:#ae81ff">0xFF</span>])
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">with</span> pytest<span style="color:#f92672">.</span>raises(AuthenticationError):
</span></span><span style="display:flex;"><span>        DECRYPT(key, nonce, corrupted, ad)
</span></span></code></pre></div><hr>
<h2 id="configuration-and-deployment">Configuration and Deployment</h2>
<h3 id="i2cp-configuration">I2CP Configuration</h3>
<p><strong>Enable ECIES Encryption:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-properties" data-lang="properties"><span style="display:flex;"><span><span style="color:#75715e"># केवल ECIES (अण्डाकार वक्र एकीकृत एन्क्रिप्शन योजना) (नए परिनियोजन के लिए अनुशंसित)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">i2cp.leaseSetEncType</span><span style="color:#f92672">=</span><span style="color:#e6db74">4</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># द्वि-कुंजी (संगतता के लिए ECIES + ElGamal)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">i2cp.leaseSetEncType</span><span style="color:#f92672">=</span><span style="color:#e6db74">4,0</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># केवल ElGamal (पुराना, अनुशंसित नहीं)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">i2cp.leaseSetEncType</span><span style="color:#f92672">=</span><span style="color:#e6db74">0</span>
</span></span></code></pre></div><p><strong>LeaseSet Type:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-properties" data-lang="properties"><span style="display:flex;"><span><span style="color:#75715e"># मानक LS2 (सबसे सामान्य)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">i2cp.leaseSetType</span><span style="color:#f92672">=</span><span style="color:#e6db74">3</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># कूटबद्ध LS2 (blinded destinations, अर्थात पहचान-अस्पष्ट किए गए destinations)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">i2cp.leaseSetType</span><span style="color:#f92672">=</span><span style="color:#e6db74">5</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Meta LS2 (कई गंतव्य)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">i2cp.leaseSetType</span><span style="color:#f92672">=</span><span style="color:#e6db74">7</span>
</span></span></code></pre></div><p><strong>Additional Options:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-properties" data-lang="properties"><span style="display:flex;"><span><span style="color:#75715e"># ECIES (Elliptic Curve Integrated Encryption Scheme, दीर्घवृत्तीय वक्र एकीकृत एन्क्रिप्शन योजना) के लिए स्थिर कुंजी (वैकल्पिक, यदि निर्दिष्ट न हो तो स्वतः उत्पन्न हो जाती है)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 32-बाइट की X25519 सार्वजनिक कुंजी, Base64-कूटबद्ध</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">i2cp.leaseSetPrivateKey</span><span style="color:#f92672">=</span><span style="color:#e6db74">&lt;base64-encoded-key&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># LeaseSet के लिए हस्ताक्षर प्रकार</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">i2cp.leaseSetSigningPrivateKey</span><span style="color:#f92672">=</span><span style="color:#e6db74">&lt;base64-encoded-key&gt; i2cp.leaseSetSigningType=7  # Ed25519</span>
</span></span></code></pre></div><h3 id="java-i2p-configuration">Java I2P Configuration</h3>
<p><strong>router.config:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-properties" data-lang="properties"><span style="display:flex;"><span><span style="color:#75715e"># Router-से-router ECIES (दीर्घवृत्तीय वक्र एकीकृत एन्क्रिप्शन योजना)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">i2p.router.useECIES</span><span style="color:#f92672">=</span><span style="color:#e6db74">true</span>
</span></span></code></pre></div><p><strong>Build Properties:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#75715e">// I2CP क्लाइंट्स (Java) Properties props = new Properties(); props.setProperty(&#34;i2cp.leaseSetEncType&#34;, &#34;4&#34;); props.setProperty(&#34;i2cp.leaseSetType&#34;, &#34;3&#34;);</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>I2PSession session <span style="color:#f92672">=</span> i2pClient.<span style="color:#a6e22e">createSession</span>(props);
</span></span></code></pre></div><h3 id="i2pd-configuration">i2pd Configuration</h3>
<p><strong>i2pd.conf:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ini" data-lang="ini"><span style="display:flex;"><span><span style="color:#66d9ef">[सीमाएँ]</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ECIES (एलिप्टिक कर्व इंटीग्रेटेड एन्क्रिप्शन स्कीम) सत्रों की मेमोरी सीमा</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">ecies.memory</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">128M</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">[ecies (एलिप्टिक कर्व एकीकृत एन्क्रिप्शन योजना)]</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ECIES (एलिप्टिक कर्व इंटीग्रेटेड एन्क्रिप्शन स्कीम) सक्षम करें</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">enabled</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">true</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># केवल ECIES (Elliptic Curve Integrated Encryption Scheme) या द्वि-कुंजी</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">compatibility</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">true  # true = द्वि-कुंजी, false = केवल ECIES</span>
</span></span></code></pre></div><p><strong>Tunnels Configuration:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ini" data-lang="ini"><span style="display:flex;"><span><span style="color:#a6e22e">[my-service] type</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">http host = 127.0.0.1 port = 8080 keys = my-service-keys.dat</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># केवल ECIES (दीर्घवृत्तीय वक्र समेकित एन्क्रिप्शन योजना)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">ecies</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">true</span>
</span></span></code></pre></div><h3 id="compatibility-matrix">Compatibility Matrix</h3>
<p><strong>Router Version Support:</strong></p>
<table style="width:100%; border-collapse:collapse; margin-bottom:1.5rem;">
  <thead>
    <tr>
      <th style="border:1px solid var(--color-border); padding:0.5rem; background:var(--color-bg-secondary); text-align:left;">Version</th>
      <th style="border:1px solid var(--color-border); padding:0.5rem; background:var(--color-bg-secondary); text-align:center;">ECIES Support</th>
      <th style="border:1px solid var(--color-border); padding:0.5rem; background:var(--color-bg-secondary); text-align:center;">LS2 Support</th>
      <th style="border:1px solid var(--color-border); padding:0.5rem; background:var(--color-bg-secondary); text-align:center;">Dual-Key</th>
      <th style="border:1px solid var(--color-border); padding:0.5rem; background:var(--color-bg-secondary); text-align:left;">Notes</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">&lt; 0.9.38</td>
      <td style="border:1px solid var(--color-border); padding:0.5rem; text-align:center;">❌ No</td>
      <td style="border:1px solid var(--color-border); padding:0.5rem; text-align:center;">❌ No</td>
      <td style="border:1px solid var(--color-border); padding:0.5rem; text-align:center;">N/A</td>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">Legacy only</td>
    </tr>
    <tr>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">0.9.38-0.9.45</td>
      <td style="border:1px solid var(--color-border); padding:0.5rem; text-align:center;">❌ No</td>
      <td style="border:1px solid var(--color-border); padding:0.5rem; text-align:center;">✅ Yes</td>
      <td style="border:1px solid var(--color-border); padding:0.5rem; text-align:center;">N/A</td>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">LS2 only</td>
    </tr>
    <tr>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">0.9.46-0.9.50</td>
      <td style="border:1px solid var(--color-border); padding:0.5rem; text-align:center;">✅ Yes</td>
      <td style="border:1px solid var(--color-border); padding:0.5rem; text-align:center;">✅ Yes</td>
      <td style="border:1px solid var(--color-border); padding:0.5rem; text-align:center;">✅ Yes</td>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">Initial ECIES</td>
    </tr>
    <tr>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">1.5.0+</td>
      <td style="border:1px solid var(--color-border); padding:0.5rem; text-align:center;">✅ Yes</td>
      <td style="border:1px solid var(--color-border); padding:0.5rem; text-align:center;">✅ Yes</td>
      <td style="border:1px solid var(--color-border); padding:0.5rem; text-align:center;">✅ Yes</td>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">Current</td>
    </tr>
    <tr>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">2.0.0+</td>
      <td style="border:1px solid var(--color-border); padding:0.5rem; text-align:center;">✅ Yes</td>
      <td style="border:1px solid var(--color-border); padding:0.5rem; text-align:center;">✅ Yes</td>
      <td style="border:1px solid var(--color-border); padding:0.5rem; text-align:center;">✅ Yes</td>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">Current</td>
    </tr>
  </tbody>
</table>
<p><strong>Destination Compatibility:</strong></p>
<table style="width:100%; border-collapse:collapse; margin-bottom:1.5rem;">
  <thead>
    <tr>
      <th style="border:1px solid var(--color-border); padding:0.5rem; background:var(--color-bg-secondary); text-align:left;">Destination Type</th>
      <th style="border:1px solid var(--color-border); padding:0.5rem; background:var(--color-bg-secondary); text-align:left;">Can Connect To</th>
      <th style="border:1px solid var(--color-border); padding:0.5rem; background:var(--color-bg-secondary); text-align:left;">Notes</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">ECIES-only</td>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">ECIES-only, Dual-key</td>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">Requires 0.9.46+ routers</td>
    </tr>
    <tr>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">Dual-key</td>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">Any</td>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">Maximum compatibility</td>
    </tr>
    <tr>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">ElGamal-only</td>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">ElGamal-only, Dual-key</td>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">Legacy</td>
    </tr>
  </tbody>
</table>
<p><strong>FloodFill Requirements:</strong></p>
<ul>
<li><strong>ECIES-only destinations</strong>: Require majority of floodfills on 0.9.46+ for encrypted lookups</li>
<li><strong>Dual-key destinations</strong>: Work with any floodfill version</li>
<li><strong>Current status</strong>: Near 100% floodfill adoption as of 2025</li>
</ul>
<h3 id="migration-guide">Migration Guide</h3>
<p><strong>Migrating from ElGamal to ECIES:</strong></p>
<p><strong>Step 1: Enable Dual-Key Mode</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-properties" data-lang="properties"><span style="display:flex;"><span><span style="color:#75715e"># ElGamal (एक सार्वजनिक‑कुंजी कूटलेखन योजना) को बनाए रखते हुए ECIES (Elliptic Curve Integrated Encryption Scheme — दीर्घवृत्तीय वक्र समेकित कूटलेखन योजना) जोड़ें</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">i2cp.leaseSetEncType</span><span style="color:#f92672">=</span><span style="color:#e6db74">4,0</span>
</span></span></code></pre></div><p><strong>Step 2: Monitor Connections</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># कनेक्शन प्रकार जाँचें</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>i2prouter.exe status
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># या</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>http://127.0.0.1:7657/peers
</span></span></code></pre></div><p><strong>Step 3: Switch to ECIES-Only (after testing)</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-properties" data-lang="properties"><span style="display:flex;"><span><span style="color:#75715e"># ElGamal (पब्लिक-की क्रिप्टोसिस्टम) को हटाएँ</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">i2cp.leaseSetEncType</span><span style="color:#f92672">=</span><span style="color:#e6db74">4</span>
</span></span></code></pre></div><p><strong>Step 4: Restart Application</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># I2P router या एप्लिकेशन को पुनः प्रारंभ करें</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>systemctl restart i2p
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># या</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>i2prouter.exe restart
</span></span></code></pre></div><p><strong>Rollback Plan:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-properties" data-lang="properties"><span style="display:flex;"><span><span style="color:#75715e"># यदि समस्याएँ हों तो केवल ElGamal (एक सार्वजनिक‑कुंजी क्रिप्टोसिस्टम) पर लौटें</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">i2cp.leaseSetEncType</span><span style="color:#f92672">=</span><span style="color:#e6db74">0</span>
</span></span></code></pre></div><h3 id="performance-tuning">Performance Tuning</h3>
<p><strong>Session Limits:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-properties" data-lang="properties"><span style="display:flex;"><span><span style="color:#75715e"># इनबाउंड सत्रों की अधिकतम संख्या</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">i2p.router.maxInboundSessions</span><span style="color:#f92672">=</span><span style="color:#e6db74">1000</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># आउटबाउंड सत्रों की अधिकतम संख्या</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">i2p.router.maxOutboundSessions</span><span style="color:#f92672">=</span><span style="color:#e6db74">1000</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># सत्र समय-सीमा (सेकंड)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">i2p.router.sessionTimeout</span><span style="color:#f92672">=</span><span style="color:#e6db74">600</span>
</span></span></code></pre></div><p><strong>Memory Limits:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-properties" data-lang="properties"><span style="display:flex;"><span><span style="color:#75715e"># टैग भंडारण सीमा (KB)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">i2p.ecies.maxTagMemory</span><span style="color:#f92672">=</span><span style="color:#e6db74">10240  # 10 MB</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Look-ahead window (आगे देखने की विंडो)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">i2p.ecies.tagLookAhead</span><span style="color:#f92672">=</span><span style="color:#e6db74">160 i2p.ecies.tagLookAheadMin=32</span>
</span></span></code></pre></div><p><strong>Ratchet Policy:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-properties" data-lang="properties"><span style="display:flex;"><span><span style="color:#75715e"># ratchet (क्रिप्टोग्राफ़िक कुंजी-अद्यतन तंत्र) से पहले के संदेश</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">i2p.ecies.ratchetThreshold</span><span style="color:#f92672">=</span><span style="color:#e6db74">4096</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ratchet (कुंजी अद्यतन तंत्र) से पहले का समय (सेकंड)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">i2p.ecies.ratchetTimeout</span><span style="color:#f92672">=</span><span style="color:#e6db74">600  # 10 मिनट</span>
</span></span></code></pre></div><h3 id="monitoring-and-debugging">Monitoring and Debugging</h3>
<p><strong>Logging:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-properties" data-lang="properties"><span style="display:flex;"><span><span style="color:#75715e"># ECIES (इलिप्टिक कर्व इंटीग्रेटेड एन्क्रिप्शन स्कीम) डीबग लॉगिंग सक्षम करें</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">logger.i2p.router.transport.ecies</span><span style="color:#f92672">=</span><span style="color:#e6db74">DEBUG</span>
</span></span></code></pre></div><p><strong>Metrics:</strong></p>
<p>Monitor these metrics:</p>
<ol>
<li><strong>NS Success Rate</strong>: Percentage of NS messages receiving NSR</li>
<li><strong>Session Establishment Time</strong>: Time from NS to first ES</li>
<li><strong>Tag Storage Usage</strong>: Current memory usage for tags</li>
<li><strong>Ratchet Frequency</strong>: How often sessions ratchet</li>
<li><strong>Session Lifetime</strong>: Average session duration</li>
</ol>
<p><strong>Common Issues:</strong></p>
<ol>
<li>
<p><strong>NS Timeout</strong>: No NSR received</p>
<ul>
<li>Check destination is online</li>
<li>Check floodfill availability</li>
<li>Verify LeaseSet published correctly</li>
</ul>
</li>
<li>
<p><strong>High Memory Usage</strong>: Too many tags stored</p>
<ul>
<li>Reduce look-ahead window</li>
<li>Decrease session timeout</li>
<li>Implement aggressive expiration</li>
</ul>
</li>
<li>
<p><strong>Frequent Ratchets</strong>: Sessions ratcheting too often</p>
<ul>
<li>Increase ratchet threshold</li>
<li>Check for retransmissions</li>
</ul>
</li>
<li>
<p><strong>Session Failures</strong>: ES messages failing to decrypt</p>
<ul>
<li>Verify tag synchronization</li>
<li>Check for replay attacks</li>
<li>Validate nonce construction</li>
</ul>
</li>
</ol>
<hr>
<h2 id="references">References</h2>
<h3 id="specifications">Specifications</h3>
<ol>
<li><strong>ECIES Proposal</strong>: <a href="../../../../hi/proposals/144-ecies-x25519-aead-ratchet/">Proposal 144</a>
</li>
<li><strong>I2NP</strong>: <a href="../../../../hi/docs/specs/i2np/">I2NP Specification</a>
</li>
<li><strong>Common Structures</strong>: <a href="../../../../hi/docs/specs/common-structures/">Common Structures Specification</a>
</li>
<li><strong>NTCP2</strong>: <a href="../../../../hi/docs/specs/ntcp2/">NTCP2 Specification</a>
</li>
<li><strong>SSU2</strong>: <a href="../../../../hi/docs/specs/ssu2/">SSU2 Specification</a>
</li>
<li><strong>I2CP</strong>: <a href="../../../../hi/docs/specs/i2cp/">I2CP Specification</a>
</li>
<li><strong>ElGamal/AES+SessionTags</strong>: <a href="../../../../hi/docs/legacy/elgamal-aes/">ElGamal/AES Specification</a>
</li>
</ol>
<h3 id="cryptographic-standards">Cryptographic Standards</h3>
<ol>
<li><strong>Noise Protocol Framework</strong>: <a href="https://noiseprotocol.org/noise.html">Noise Specification</a>
 (Revision 34, 2018-07-11)</li>
<li><strong>Signal Double Ratchet</strong>: <a href="https://signal.org/docs/specifications/doubleratchet/">Signal Specification</a>
</li>
<li><strong>RFC 7748</strong>: <a href="https://tools.ietf.org/html/rfc7748">Elliptic Curves for Security (X25519)</a>
</li>
<li><strong>RFC 7539</strong>: <a href="https://tools.ietf.org/html/rfc7539">ChaCha20 and Poly1305 for IETF Protocols</a>
</li>
<li><strong>RFC 5869</strong>: <a href="https://tools.ietf.org/html/rfc5869">HKDF (HMAC-based Key Derivation Function)</a>
</li>
<li><strong>RFC 2104</strong>: <a href="https://tools.ietf.org/html/rfc2104">HMAC: Keyed-Hashing for Message Authentication</a>
</li>
<li><strong>Elligator2</strong>: <a href="https://elligator.cr.yp.to/elligator-20130828.pdf">Elligator Paper</a>
</li>
</ol>
<h3 id="implementation-resources">Implementation Resources</h3>
<ol>
<li><strong>Java I2P</strong>: <a href="https://github.com/i2p/i2p.i2p">i2p.i2p Repository</a>
</li>
<li><strong>i2pd (C++)</strong>: <a href="https://github.com/PurpleI2P/i2pd">i2pd Repository</a>
</li>
<li><strong>OBFS4 (Elligator2)</strong>: <a href="https://gitlab.com/yawning/obfs4">obfs4proxy Repository</a>
</li>
</ol>
<h3 id="additional-information">Additional Information</h3>
<ol>
<li><strong>I2P Website</strong>: <a href="../../../../hi/">/</a>
</li>
<li><strong>I2P Forum</strong>: <a href="https://i2pforum.net">https://i2pforum.net</a>
</li>
<li><strong>I2P Wiki</strong>: <a href="https://wiki.i2p-projekt.de">https://wiki.i2p-projekt.de</a>
</li>
</ol>
<hr>
<h2 id="appendix-a-kdf-summary">Appendix A: KDF Summary</h2>
<p><strong>All KDF Operations in ECIES:</strong></p>
<table style="width:100%; border-collapse:collapse; margin-bottom:1.5rem;">
  <thead>
    <tr>
      <th style="border:1px solid var(--color-border); padding:0.5rem; background:var(--color-bg-secondary); text-align:left;">Operation</th>
      <th style="border:1px solid var(--color-border); padding:0.5rem; background:var(--color-bg-secondary); text-align:left;">Input</th>
      <th style="border:1px solid var(--color-border); padding:0.5rem; background:var(--color-bg-secondary); text-align:left;">Info String</th>
      <th style="border:1px solid var(--color-border); padding:0.5rem; background:var(--color-bg-secondary); text-align:left;">Output</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">NS Initial ChainKey</td>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">protocol_name</td>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">(none - SHA256)</td>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">h, chainKey</td>
    </tr>
    <tr>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">NS Static Key Section</td>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">chainKey, es_shared</td>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">""</td>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">chainKey, k</td>
    </tr>
    <tr>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">NS Payload Section (bound)</td>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">chainKey, ss_shared</td>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">""</td>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">chainKey, k</td>
    </tr>
    <tr>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">NSR Tagset</td>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">chainKey</td>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">"SessionReplyTags"</td>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">tagsetKey</td>
    </tr>
    <tr>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">NSR ee DH</td>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">chainKey, ee_shared</td>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">""</td>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">chainKey</td>
    </tr>
    <tr>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">NSR se DH</td>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">chainKey, se_shared</td>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">""</td>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">chainKey, k</td>
    </tr>
    <tr>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">NSR Split</td>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">chainKey</td>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">""</td>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">k_ab, k_ba</td>
    </tr>
    <tr>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">NSR Payload</td>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">k_ba</td>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">"AttachPayloadKDF"</td>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">k_nsr</td>
    </tr>
    <tr>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">DH Initialize</td>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">rootKey, k</td>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">"KDFDHRatchetStep"</td>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">nextRootKey, chainKey</td>
    </tr>
    <tr>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">Tag and Key Chain Keys</td>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">chainKey</td>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">"TagAndKeyGenKeys"</td>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">sessTag_ck, symmKey_ck</td>
    </tr>
    <tr>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">Session Tag Init</td>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">sessTag_ck</td>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">"STInitialization"</td>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">chainKey, CONSTANT</td>
    </tr>
    <tr>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">Session Tag Gen</td>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">chainKey, CONSTANT</td>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">"SessionTagKeyGen"</td>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">chainKey, tag</td>
    </tr>
    <tr>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">Symmetric Key Gen</td>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">chainKey</td>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">"SymmetricRatchet"</td>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">chainKey, key</td>
    </tr>
    <tr>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">DH Ratchet</td>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">sharedSecret</td>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">"XDHRatchetTagSet"</td>
      <td style="border:1px solid var(--color-border); padding:0.5rem;">tagsetKey</td>
    </tr>
  </tbody>
</table>
<hr>
<h2 id="appendix-b-message-size-calculator">Appendix B: Message Size Calculator</h2>
<p><strong>Calculate message sizes for capacity planning:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">calculate_ns_size</span>(payload_size, bound<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>):
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;&#34;&#34;Calculate New Session message size&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    ephemeral_key <span style="color:#f92672">=</span> <span style="color:#ae81ff">32</span>
</span></span><span style="display:flex;"><span>    static_section <span style="color:#f92672">=</span> <span style="color:#ae81ff">32</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">16</span>  <span style="color:#75715e"># encrypted + MAC</span>
</span></span><span style="display:flex;"><span>    payload_encrypted <span style="color:#f92672">=</span> payload_size <span style="color:#f92672">+</span> <span style="color:#ae81ff">16</span>  <span style="color:#75715e"># + MAC</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> ephemeral_key <span style="color:#f92672">+</span> static_section <span style="color:#f92672">+</span> payload_encrypted
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">calculate_nsr_size</span>(payload_size):
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;&#34;&#34;Calculate New Session Reply message size&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    tag <span style="color:#f92672">=</span> <span style="color:#ae81ff">8</span>
</span></span><span style="display:flex;"><span>    ephemeral_key <span style="color:#f92672">=</span> <span style="color:#ae81ff">32</span>
</span></span><span style="display:flex;"><span>    key_section_mac <span style="color:#f92672">=</span> <span style="color:#ae81ff">16</span>
</span></span><span style="display:flex;"><span>    payload_encrypted <span style="color:#f92672">=</span> payload_size <span style="color:#f92672">+</span> <span style="color:#ae81ff">16</span>  <span style="color:#75715e"># + MAC</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> tag <span style="color:#f92672">+</span> ephemeral_key <span style="color:#f92672">+</span> key_section_mac <span style="color:#f92672">+</span> payload_encrypted
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">calculate_es_size</span>(payload_size):
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;&#34;&#34;Calculate Existing Session message size&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    tag <span style="color:#f92672">=</span> <span style="color:#ae81ff">8</span>
</span></span><span style="display:flex;"><span>    payload_encrypted <span style="color:#f92672">=</span> payload_size <span style="color:#f92672">+</span> <span style="color:#ae81ff">16</span>  <span style="color:#75715e"># + MAC</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> tag <span style="color:#f92672">+</span> payload_encrypted
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># उदाहरण</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">&#34;NS (बंधित, 1KB पेलोड):&#34;</span>, calculate_ns_size(<span style="color:#ae81ff">1024</span>, bound<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>), <span style="color:#e6db74">&#34;बाइट्स&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># आउटपुट: 1120 बाइट्स</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">&#34;NSR (1KB पेलोड):&#34;</span>, calculate_nsr_size(<span style="color:#ae81ff">1024</span>), <span style="color:#e6db74">&#34;बाइट्स&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># आउटपुट: 1096 बाइट्स</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">&#34;ES (1KB पेलोड):&#34;</span>, calculate_es_size(<span style="color:#ae81ff">1024</span>), <span style="color:#e6db74">&#34;बाइट्स&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># आउटपुट: 1048 बाइट्स</span>
</span></span></code></pre></div><hr>
<h2 id="appendix-c-glossary">Appendix C: Glossary</h2>
<p><strong>AEAD</strong>: Authenticated Encryption with Associated Data - encryption mode that provides both confidentiality and authenticity</p>
<p><strong>Authentication Level</strong>: Noise protocol security property indicating strength of sender identity verification</p>
<p><strong>Binding</strong>: Association of a session with a specific far-end destination</p>
<p><strong>ChaCha20</strong>: Stream cipher designed by Daniel J. Bernstein</p>
<p><strong>ChainKey</strong>: Cryptographic key used in HKDF chains to derive subsequent keys</p>
<p><strong>Confidentiality Level</strong>: Noise protocol security property indicating strength of forward secrecy</p>
<p><strong>DH</strong>: Diffie-Hellman key agreement protocol</p>
<p><strong>Elligator2</strong>: Encoding technique to make elliptic curve points indistinguishable from random</p>
<p><strong>Ephemeral Key</strong>: Short-lived key used only for a single handshake</p>
<p><strong>ES</strong>: Existing Session message (used after handshake completion)</p>
<p><strong>Forward Secrecy</strong>: Property ensuring past communications remain secure if keys are compromised</p>
<p><strong>Garlic Clove</strong>: I2NP message container for end-to-end delivery</p>
<p><strong>HKDF</strong>: HMAC-based Key Derivation Function</p>
<p><strong>IK Pattern</strong>: Noise handshake pattern where initiator sends static key immediately</p>
<p><strong>KCI</strong>: Key Compromise Impersonation attack</p>
<p><strong>KDF</strong>: Key Derivation Function - cryptographic function for generating keys from other keys</p>
<p><strong>LeaseSet</strong>: I2P structure containing a destination&rsquo;s public keys and tunnel information</p>
<p><strong>LS2</strong>: LeaseSet version 2 with encryption type support</p>
<p><strong>MAC</strong>: Message Authentication Code - cryptographic checksum proving authenticity</p>
<p><strong>MixHash</strong>: Noise protocol function for maintaining running hash transcript</p>
<p><strong>NS</strong>: New Session message (initiates new session)</p>
<p><strong>NSR</strong>: New Session Reply message (response to NS)</p>
<p><strong>Nonce</strong>: Number used once - ensures unique encryption even with same key</p>
<p><strong>Pairing</strong>: Linking an inbound session with an outbound session for bidirectional communication</p>
<p><strong>Poly1305</strong>: Message authentication code designed by Daniel J. Bernstein</p>
<p><strong>Ratchet</strong>: Cryptographic mechanism for deriving sequential keys</p>
<p><strong>Session Tag</strong>: 8-byte one-time identifier for existing session messages</p>
<p><strong>Static Key</strong>: Long-term key associated with a destination&rsquo;s identity</p>
<p><strong>Tag Set</strong>: Collection of session tags derived from a common root</p>
<p><strong>X25519</strong>: Elliptic curve Diffie-Hellman key agreement using Curve25519</p>
<hr>

                </article>

                
                <nav class="page-nav">
                    
                        <a href="../../../../hi/docs/specs/ecies-hybrid/" class="page-nav-link prev">
                            <span class="nav-label">← Previous</span>
                            <span class="nav-title">ECIES-X25519-AEAD-Ratchet हाइब्रिड एन्क्रिप्शन</span>
                        </a>
                    
                    
                        <a href="../../../../hi/docs/specs/blockfile/" class="page-nav-link next">
                            <span class="nav-label">Next →</span>
                            <span class="nav-title">Blockfile विनिर्देश</span>
                        </a>
                    
                </nav>

                
                <div class="docs-feedback">
                    <p>Was this page helpful?</p>
                    <div class="feedback-buttons" id="feedback-buttons">
                        <button class="feedback-btn" id="feedback-yes">👍 Yes</button>
                        <button class="feedback-btn" id="feedback-no">👎 No</button>
                    </div>

                    
                    <div class="feedback-form-container" id="feedback-form-container" style="display: none;">
                        <p class="feedback-form-title">We're sorry to hear that. How can we improve this page?</p>
                        <form id="feedback-form">
                            <div class="form-group">
                                <label for="feedback-email">Email (optional - if you'd like a response)</label>
                                <input type="email" id="feedback-email" name="email" placeholder="your@email.com">
                            </div>
                            <div class="form-group">
                                <label for="feedback-message">Feedback *</label>
                                <textarea id="feedback-message" name="message" rows="4" required placeholder="Tell us what we can improve..."></textarea>
                            </div>
                            <button type="submit" class="btn-submit-feedback" id="feedback-submit-btn">
                                <span class="btn-text">Submit Feedback</span>
                                <span class="btn-loading" style="display: none;">Sending...</span>
                            </button>
                        </form>
                    </div>

                    
                    <div class="feedback-message" id="feedback-success" style="display: none;">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                            <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" stroke-width="2"/>
                        </svg>
                        <span id="feedback-success-text">Thanks for your feedback!</span>
                    </div>
                    <div class="feedback-message feedback-error" id="feedback-error" style="display: none;">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                            <circle cx="12" cy="12" r="10" stroke-width="2"/>
                            <path d="M12 8v4M12 16h.01" stroke-width="2" stroke-linecap="round"/>
                        </svg>
                        <span id="feedback-error-text">Something went wrong. Please try again.</span>
                    </div>

                    <p class="feedback-note">
                        Found an issue? <a href="https://gitlab.com/stormycloud-group/i-2-p-www-v-2/-/blob/main/hugo-site/content/hi/docs/specs/ecies.md?ref_type=heads" target="_blank">Edit this page on GitLab</a>
                    </p>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
.docs-page {
    min-height: 100vh;
    padding: var(--spacing-xl) 0;
}

.breadcrumbs {
    display: flex;
    align-items: center;
    gap: var(--spacing-xs);
    margin-bottom: var(--spacing-lg);
    font-size: 0.875rem;
    color: var(--color-text-muted);
}

.breadcrumbs a {
    color: var(--color-text-muted);
    text-decoration: none;
    transition: color var(--transition-fast);
}

.breadcrumbs a:hover {
    color: var(--color-primary);
}

.separator {
    color: var(--color-border);
}

.current {
    color: var(--color-text);
}

 
.translation-disclaimer {
    background: #fef3c7;
    border: 1px solid #f59e0b;
    border-radius: var(--radius-md);
    padding: var(--spacing-md);
    margin-bottom: var(--spacing-lg);
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: var(--spacing-md);
    flex-wrap: wrap;
}

.dark .translation-disclaimer {
    background: #78350f;
    border-color: #d97706;
}

.disclaimer-message {
    color: #92400e;
    font-size: 0.875rem;
}

.dark .disclaimer-message {
    color: #fde047;
}

.disclaimer-link {
    color: #92400e;
    font-weight: 600;
    text-decoration: underline;
    white-space: nowrap;
}

.dark .disclaimer-link {
    color: #fde047;
}

 
.article-header {
    margin-bottom: var(--spacing-2xl);
}

.article-title {
    font-size: 2.5rem;
    margin: 0 0 var(--spacing-md) 0;
    color: var(--color-text);
}

.article-description {
    font-size: 1.125rem;
    color: var(--color-text-secondary);
    margin-bottom: var(--spacing-md);
}

.article-meta {
    display: flex;
    gap: var(--spacing-lg);
    flex-wrap: wrap;
}

.meta-item {
    display: flex;
    align-items: center;
    gap: var(--spacing-xs);
    font-size: 0.875rem;
    color: var(--color-text-muted);
}

.meta-item svg {
    color: var(--color-primary);
}

 
.docs-layout {
    display: block;
}

.docs-layout--with-toc {
    display: grid;
    grid-template-columns: 260px 1fr;
    gap: var(--spacing-2xl);
    align-items: start;
}

 
.docs-toc-sidebar {
    position: sticky;
    top: 100px;
    max-height: calc(100vh - 120px);
    overflow-y: auto;
}

.toc-nav {
    background: var(--color-bg-secondary);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-lg);
    padding: var(--spacing-md);
}

.toc-header {
    display: flex;
    align-items: center;
    gap: var(--spacing-sm);
    font-weight: 700;
    font-size: 0.875rem;
    color: var(--color-text);
    padding-bottom: var(--spacing-md);
    margin-bottom: var(--spacing-md);
    border-bottom: 1px solid var(--color-border);
}

.toc-content {
    max-height: calc(100vh - 250px);
    overflow-y: auto;
}

.toc-content::-webkit-scrollbar {
    width: 4px;
}

.toc-content::-webkit-scrollbar-track {
    background: transparent;
}

.toc-content::-webkit-scrollbar-thumb {
    background: var(--color-border);
    border-radius: 2px;
}

.toc-content::-webkit-scrollbar-thumb:hover {
    background: var(--color-text-muted);
}

.toc-nav ul {
    list-style: none;
    padding-left: 0;
    margin: 0;
}

.toc-nav li {
    margin-bottom: 0.25rem;
}

.toc-nav ul ul {
    padding-left: var(--spacing-md);
    margin-top: 0.25rem;
}

.toc-nav a {
    color: var(--color-text-secondary);
    text-decoration: none;
    font-size: 0.8125rem;
    display: block;
    padding: 0.25rem 0.5rem;
    border-radius: var(--radius-sm);
    transition: all var(--transition-fast);
    line-height: 1.4;
}

.toc-nav a:hover {
    color: var(--color-primary);
    background: var(--color-bg-tertiary);
}

 
.docs-main {
    min-width: 0;
    max-width: 900px;
}

 
.article-content {
    line-height: 1.8;
    color: var(--color-text);
}

.article-content h2 {
    margin-top: var(--spacing-2xl);
    margin-bottom: var(--spacing-md);
    font-size: 1.75rem;
    scroll-margin-top: 100px;
}

.article-content h3 {
    margin-top: var(--spacing-xl);
    margin-bottom: var(--spacing-sm);
    font-size: 1.375rem;
    scroll-margin-top: 100px;
}

.article-content h4 {
    margin-top: var(--spacing-lg);
    margin-bottom: var(--spacing-xs);
    font-size: 1.125rem;
    scroll-margin-top: 100px;
}

.article-content p {
    margin-bottom: var(--spacing-md);
}

.article-content ul,
.article-content ol {
    margin-bottom: var(--spacing-md);
    padding-left: var(--spacing-xl);
}

.article-content li {
    margin-bottom: var(--spacing-xs);
}

.article-content code {
    background: var(--color-bg-secondary);
    padding: 0.125rem 0.375rem;
    border-radius: var(--radius-sm);
    font-size: 0.875em;
    font-family: 'Courier New', monospace;
}

.article-content pre {
    background: var(--color-bg-secondary);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-md);
    padding: var(--spacing-md);
    overflow-x: auto;
    margin-bottom: var(--spacing-md);
}

.article-content pre code {
    background: none;
    padding: 0;
}

.article-content img {
    max-width: 100%;
    height: auto;
    border-radius: var(--radius-md);
    border: 1px solid var(--color-border);
    margin: var(--spacing-lg) 0;
    display: block;
}

.article-content a {
    color: var(--color-primary);
    text-decoration: none;
    border-bottom: 1px solid transparent;
    transition: border-color var(--transition-fast);
}

.article-content a:hover {
    border-bottom-color: var(--color-primary);
}

 
.page-nav {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: var(--spacing-md);
    margin-top: var(--spacing-2xl);
    padding-top: var(--spacing-xl);
    border-top: 1px solid var(--color-border);
}

.page-nav-link {
    display: flex;
    flex-direction: column;
    padding: var(--spacing-md);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-md);
    text-decoration: none;
    transition: all var(--transition-fast);
}

.page-nav-link:hover {
    border-color: var(--color-primary);
    box-shadow: var(--shadow-md);
}

.page-nav-link.next {
    text-align: right;
}

.nav-label {
    font-size: 0.875rem;
    color: var(--color-text-muted);
    margin-bottom: var(--spacing-xs);
}

.nav-title {
    font-weight: 600;
    color: var(--color-text);
}

 
.docs-feedback {
    margin-top: var(--spacing-2xl);
    padding: var(--spacing-lg);
    background: var(--color-bg-secondary);
    border-radius: var(--radius-md);
    text-align: center;
}

.feedback-buttons {
    display: flex;
    gap: var(--spacing-md);
    justify-content: center;
    margin: var(--spacing-md) 0;
}

.feedback-btn {
    padding: var(--spacing-sm) var(--spacing-lg);
    background: var(--color-bg);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-md);
    cursor: pointer;
    transition: all var(--transition-fast);
}

.feedback-btn:hover {
    border-color: var(--color-primary);
    background: var(--color-primary);
    color: white;
}

.feedback-note {
    font-size: 0.875rem;
    color: var(--color-text-muted);
    margin-top: var(--spacing-md);
}

.feedback-note a {
    color: var(--color-primary);
    text-decoration: none;
}

.feedback-note a:hover {
    text-decoration: underline;
}

 
.feedback-form-container {
    margin-top: var(--spacing-lg);
    padding: var(--spacing-lg);
    background: var(--color-bg);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-md);
    text-align: left;
}

.feedback-form-title {
    font-weight: 600;
    margin-bottom: var(--spacing-md);
    color: var(--color-text);
}

.form-group {
    margin-bottom: var(--spacing-md);
}

.form-group label {
    display: block;
    font-size: 0.875rem;
    font-weight: 600;
    margin-bottom: var(--spacing-xs);
    color: var(--color-text);
}

.form-group input[type="email"],
.form-group textarea {
    width: 100%;
    padding: var(--spacing-sm);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-md);
    background: var(--color-bg);
    color: var(--color-text);
    font-family: inherit;
    font-size: 0.9375rem;
    transition: border-color var(--transition-fast);
}

.form-group input[type="email"]:focus,
.form-group textarea:focus {
    outline: none;
    border-color: var(--color-primary);
}

.form-group textarea {
    resize: vertical;
    min-height: 100px;
}

.btn-submit-feedback {
    padding: var(--spacing-sm) var(--spacing-lg);
    background: var(--color-primary);
    color: white;
    border: none;
    border-radius: var(--radius-md);
    font-weight: 600;
    cursor: pointer;
    transition: all var(--transition-fast);
}

.btn-submit-feedback:hover:not(:disabled) {
    background: var(--color-primary-dark);
    transform: translateY(-1px);
}

.btn-submit-feedback:disabled {
    opacity: 0.6;
    cursor: not-allowed;
}

 
.feedback-message {
    display: flex;
    align-items: center;
    gap: var(--spacing-sm);
    padding: var(--spacing-md);
    background: #d1fae5;
    color: #065f46;
    border-radius: var(--radius-md);
    margin-top: var(--spacing-md);
}

.feedback-message.feedback-error {
    background: #fee2e2;
    color: #991b1b;
}

.feedback-message svg {
    flex-shrink: 0;
}

 
@media (max-width: 1024px) {
    .docs-layout--with-toc {
        grid-template-columns: 1fr;
    }

    .docs-toc-sidebar {
        position: static;
        max-height: none;
        margin-bottom: var(--spacing-xl);
    }

    .toc-content {
        max-height: 300px;
    }
}

@media (max-width: 768px) {
    .article-title {
        font-size: 1.75rem;
    }
}
</style>



<script>
document.addEventListener('DOMContentLoaded', function() {
    const tocLinks = document.querySelectorAll('.toc-nav a');
    const headings = [];

    tocLinks.forEach(link => {
        const href = link.getAttribute('href');
        if (href && href.startsWith('#')) {
            const heading = document.getElementById(href.slice(1));
            if (heading) {
                headings.push({ element: heading, link: link });
            }
        }
    });

    function updateActiveLink() {
        const scrollPos = window.scrollY + 120;
        let activeIndex = 0;

        for (let i = 0; i < headings.length; i++) {
            if (headings[i].element.offsetTop <= scrollPos) {
                activeIndex = i;
            }
        }

        tocLinks.forEach(link => link.classList.remove('active'));
        if (headings[activeIndex]) {
            headings[activeIndex].link.classList.add('active');
        }
    }

    window.addEventListener('scroll', updateActiveLink);
    updateActiveLink();
});
</script>
<style>
.toc-nav a.active {
    color: var(--color-primary);
    background: var(--color-bg-tertiary);
    font-weight: 600;
}
</style>



<script>
(function() {
    'use strict';
    
    
    let baseUrl = window.feedbackBaseUrl;
    if (!baseUrl) {
        const hostname = window.location.hostname;
        
        if (hostname.endsWith('.b32.i2p') || hostname.endsWith('.i2p')) {
            baseUrl = 'http://5kwyynf3eetgqa2nors6ctwo7doi7yu73k7uvypy5eqmm326zkiq.b32.i2p';
        } else if (hostname.endsWith('.onion')) {
            baseUrl = 'http://gfonxmohvarpmocsvllscsuszdu5rikipm6innvcwq4vpng7zzqmmfyd.onion';
        } else {
            baseUrl = 'https://feedback.i2p.net';
        }
    }
    
    const script = document.createElement('script');
    script.src = baseUrl + '/widgets/docs-feedback.js';
    script.async = true;
    script.onerror = function() {
        console.error('[Docs Feedback] Failed to load docs-feedback.js from:', baseUrl);
    };
    document.body.appendChild(script);
})();
</script>


    </main>

    <footer class="site-footer">
    <div class="container">
        <div class="footer-grid">
            <div class="footer-col footer-brand">
                <img src="../../../../images/i2plogo_lightmode.svg" alt="I2P Logo" class="footer-logo logo-light" loading="lazy" decoding="async">
                <img src="../../../../images/i2plogo_darkmode.svg" alt="I2P Logo" class="footer-logo logo-dark" loading="lazy" decoding="async">
                <p class="footer-tagline">Privacy. Security. Freedom.</p>
                <p class="footer-description">The Invisible Internet Project - A privacy-focused, anonymous network layer</p>

                <div class="footer-social-newsletter">
                    <div class="social-links">
                        <a href="https://mastodon.social/@i2p" target="_blank" rel="noopener" aria-label="Mastodon">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M21.327 8.566c0-4.339-2.843-5.61-2.843-5.61-1.433-.658-3.894-.935-6.451-.956h-.063c-2.557.021-5.016.298-6.45.956 0 0-2.843 1.272-2.843 5.61 0 .993-.019 2.181.012 3.441.103 4.243.778 8.425 4.701 9.463 1.809.479 3.362.579 4.612.51 2.268-.126 3.541-.809 3.541-.809l-.075-1.646s-1.621.511-3.441.449c-1.804-.062-3.707-.194-3.999-2.409a4.523 4.523 0 0 1-.04-.621s1.77.433 4.014.536c1.372.063 2.658-.08 3.965-.236 2.506-.299 4.688-1.843 4.962-3.254.434-2.223.398-5.424.398-5.424zm-3.353 5.59h-2.081V9.057c0-1.075-.452-1.62-1.357-1.62-1 0-1.501.647-1.501 1.927v2.791h-2.069V9.364c0-1.28-.501-1.927-1.502-1.927-.905 0-1.357.546-1.357 1.62v5.099H6.026V8.903c0-1.074.273-1.927.823-2.558.566-.631 1.307-.955 2.228-.955 1.065 0 1.872.409 2.405 1.228l.518.869.519-.869c.533-.819 1.34-1.228 2.405-1.228.92 0 1.662.324 2.228.955.549.631.822 1.484.822 2.558v5.253z"/>
                            </svg>
                        </a>
                        <a href="https://twitter.com/GetI2P" target="_blank" rel="noopener" aria-label="Twitter">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/>
                            </svg>
                        </a>
                        <a href="https://old.reddit.com/r/i2p" target="_blank" rel="noopener" aria-label="Reddit">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M12 0A12 12 0 0 0 0 12a12 12 0 0 0 12 12 12 12 0 0 0 12-12A12 12 0 0 0 12 0zm5.01 4.744c.688 0 1.25.561 1.25 1.249a1.25 1.25 0 0 1-2.498.056l-2.597-.547-.8 3.747c1.824.07 3.48.632 4.674 1.488.308-.309.73-.491 1.207-.491.968 0 1.754.786 1.754 1.754 0 .716-.435 1.333-1.01 1.614a3.111 3.111 0 0 1 .042.52c0 2.694-3.13 4.87-7.004 4.87-3.874 0-7.004-2.176-7.004-4.87 0-.183.015-.366.043-.534A1.748 1.748 0 0 1 4.028 12c0-.968.786-1.754 1.754-1.754.463 0 .898.196 1.207.49 1.207-.883 2.878-1.43 4.744-1.487l.885-4.182a.342.342 0 0 1 .14-.197.35.35 0 0 1 .238-.042l2.906.617a1.214 1.214 0 0 1 1.108-.701zM9.25 12C8.561 12 8 12.562 8 13.25c0 .687.561 1.248 1.25 1.248.687 0 1.248-.561 1.248-1.249 0-.688-.561-1.249-1.249-1.249zm5.5 0c-.687 0-1.248.561-1.248 1.25 0 .687.561 1.248 1.249 1.248.688 0 1.249-.561 1.249-1.249 0-.687-.562-1.249-1.25-1.249zm-5.466 3.99a.327.327 0 0 0-.231.094.33.33 0 0 0 0 .463c.842.842 2.484.913 2.961.913.477 0 2.105-.056 2.961-.913a.361.361 0 0 0 .029-.463.33.33 0 0 0-.464 0c-.547.533-1.684.73-2.512.73-.828 0-1.979-.196-2.512-.73a.326.326 0 0 0-.232-.095z"/>
                            </svg>
                        </a>
                        <a href="https://signal.group/#CjQKIOSUTtxlhbumAKcRsthPFkxkTUrkWcX39bbN6njLEgAIEhCTNsR0KDuiehAXZnkt42v5" target="_blank" rel="noopener" aria-label="Signal" class="signal-link">
                            <img src="../../../../images/Signal-Logo-Black.svg" alt="Signal" class="signal-logo signal-logo-light" loading="lazy" decoding="async">
                            <img src="../../../../images/Signal-Logo-White.svg" alt="Signal" class="signal-logo signal-logo-dark" loading="lazy" decoding="async">
                        </a>
                    </div>

                    
                    <div class="footer-newsletter-inline">
                        <p class="newsletter-description">I2P समाचार से अपडेट रहें:</p>
                        <form action="https://feedback.i2p.net/api/mailing-list/subscribe" method="POST" class="newsletter-form">
                            <input type="email" name="email" placeholder="अपना ईमेल दर्ज करें" required>
                            <button type="submit">सदस्यता लें</button>
                        </form>
                    </div>
                </div>
            </div>

            <div class="footer-col">
                <h3>त्वरित लिंक</h3>
                <ul>
                    <li><a href="../../../../hi/financial-support/">दान करें</a></li>
                    <li><a href="../../../../hi/docs/overview/intro/">I2P परिचय</a></li>
                </ul>
            </div>

            <div class="footer-col">
                <h3>समुदाय</h3>
                <ul>
                    <li><a href="../../../../hi/get-involved/">शामिल हो जाइए</a></li>
                    <li><a href="../../../../hi/blog/">ब्लॉग</a></li>
                    <li><a href="http://i2pforum.net/" target="_blank" rel="noopener">आधिकारिक फोरम</a></li>
                    <li><a href="../../../../hi/contact/">संपर्क करें</a></li>
                </ul>
            </div>

            <div class="footer-col">
                <h3>संसाधन</h3>
                <ul>
                    <li><a href="https://i2p-metrics.np-tokumei.net/" target="_blank" rel="noopener">I2P मेट्रिक्स</a></li>
                    <li><a href="../../../../hi/papers/">अनुसंधान</a></li>
                    <li><a href="https://i2pgit.org/" target="_blank" rel="noopener">गिटलैब</a></li>
                    <li><a href="https://www.stormycloud.org/" target="_blank" rel="noopener">स्टॉर्मीक्लाउड</a></li>
                </ul>
            </div>
        </div>

        <div class="footer-bottom">
            <p class="copyright">&copy; 2025 इनविज़िबल इंटरनेट प्रोजेक्ट। क्रिएटिव कॉमन्स के अंतर्गत लाइसेंस।</p>
            <div class="footer-links">
                <a href="../../../../hi/privacy/">गोपनीयता</a>
                <a href="../../../../hi/terms/">शर्तें</a>
                <a href="../../../../hi/about/media/">प्रेस</a>
            </div>
        </div>
    </div>
</footer>


    
    
<div class="modal-overlay" id="poll">
    <div class="modal-content poll-modal-content">
        <a href="#" class="modal-close" aria-label="बंद करें">
            <span aria-hidden="true">&times;</span>
        </a>

        <div class="modal-header">
            <h2>सामुदायिक पोल</h2>
            <p class="modal-subtitle">हम आपसे सुनना पसंद करेंगे</p>
        </div>

        <div class="modal-body">
            
            <iframe 
                id="poll-iframe"
                data-poll-id="2"
                data-api-url="https://feedback.i2p.net"
                frameborder="0"
                scrolling="no"
                style="width: 100%; border: none; min-height: 400px;">
            </iframe>
        </div>

        <div class="modal-footer">
            <p class="modal-disclaimer">
                आपका वोट I2P के भविष्य को आकार देने में मदद करता है।
            </p>
        </div>
    </div>
</div>


<script>
(function() {
    const iframe = document.getElementById('poll-iframe');
    if (!iframe) return;
    
    const hostname = window.location.hostname;
    let apiUrl = 'https://feedback.i2p.net';
    const pollId = iframe.getAttribute('data-poll-id') || '1';

    
    if (hostname.endsWith('.b32.i2p') || hostname.endsWith('.i2p')) {
        apiUrl = 'http://5kwyynf3eetgqa2nors6ctwo7doi7yu73k7uvypy5eqmm326zkiq.b32.i2p';
    }
    
    else if (hostname.endsWith('.onion')) {
        apiUrl = 'http://gfonxmohvarpmocsvllscsuszdu5rikipm6innvcwq4vpng7zzqmmfyd.onion';
    }

    
    const pollUrl = apiUrl + '/widgets/poll.html?poll_id=' + encodeURIComponent(pollId) + '&api_url=' + encodeURIComponent(apiUrl);
    iframe.src = pollUrl;
})();
</script>



    
    



    
    <script>
        (function () {
            'use strict';
            var hostname = window.location.hostname;
            var baseUrl;

            
            if (hostname.endsWith('.b32.i2p') || hostname.endsWith('.i2p')) {
                baseUrl = 'http://5kwyynf3eetgqa2nors6ctwo7doi7yu73k7uvypy5eqmm326zkiq.b32.i2p';
            } else if (hostname.endsWith('.onion')) {
                baseUrl = 'http://gfonxmohvarpmocsvllscsuszdu5rikipm6innvcwq4vpng7zzqmmfyd.onion';
            } else {
                baseUrl = 'https://feedback.i2p.net';
            }

            window.feedbackBaseUrl = baseUrl;

            
            document.querySelectorAll('[data-api-url]').forEach(function (widget) {
                widget.setAttribute('data-api-url', baseUrl);
            });

            
            document.write('<link rel="stylesheet" href="' + baseUrl + '/widgets/styles.css">');
            
        })();
    </script>

    

    
    
    

    

</body>

</html>
{{ define "main" }}
<div class="blog-page">
    <div class="container">
        <header class="blog-header">
            <h1>{{ .Title }}</h1>
            {{ with .Description }}
            <p class="blog-description">{{ . }}</p>
            {{ end }}
        </header>

        <!-- Category Filter Bar -->
        <div class="category-filter">
            <a href="{{ relLangURL "blog/" }}" class="filter-btn {{ if not .IsHome }}{{ else }}active{{ end }}">
                All Posts
                <span class="count">{{ len .Site.RegularPages }}</span>
            </a>
            {{ range .Site.Taxonomies.categories }}
            <a href="{{ .Page.Permalink }}" class="filter-btn">
                {{ .Page.Title }}
                <span class="count">{{ .Count }}</span>
            </a>
            {{ end }}
        </div>

        <!-- Post Count -->
        {{ if .Paginator.Pages }}
        <div class="post-count">
            Showing {{ add (mul (sub .Paginator.PageNumber 1) .Paginator.PagerSize) 1 }}–{{ if lt .Paginator.PageNumber .Paginator.TotalPages }}{{ mul .Paginator.PageNumber .Paginator.PagerSize }}{{ else }}{{ .Paginator.TotalNumberOfElements }}{{ end }} of {{ .Paginator.TotalNumberOfElements }} posts
        </div>

        <div class="blog-list">
            {{ range .Paginator.Pages }}
            <article class="blog-item">
                <a href="{{ .Permalink }}" class="blog-item-link">
                    <div class="blog-item-header">
                        <h2 class="blog-item-title">{{ .Title }}</h2>
                        {{ if .Date }}
                        <time class="blog-item-date" datetime="{{ .Date.Format "2006-01-02" }}">
                            {{ .Date.Format "Jan 2, 2006" }}
                        </time>
                        {{ end }}
                    </div>

                    {{ if .Description }}
                    <p class="blog-item-excerpt">{{ .Description }}</p>
                    {{ else }}
                    <p class="blog-item-excerpt">{{ .Summary | truncate 150 }}</p>
                    {{ end }}

                    <div class="blog-item-footer">
                        {{ with .Params.author }}
                        <span class="blog-item-author">{{ . }}</span>
                        {{ end }}

                        {{ with .Params.categories }}
                        <div class="blog-item-categories">
                            {{ range . }}
                            {{ $categoryURL := printf "categories/%s/" (. | urlize) }}
                            <a href="{{ relLangURL $categoryURL }}" class="category-tag">{{ . }}</a>
                            {{ end }}
                        </div>
                        {{ end }}
                    </div>
                </a>
            </article>
            {{ end }}
        </div>

        <!-- Pagination -->
        {{ if gt .Paginator.TotalPages 1 }}
        <nav class="pagination">
            {{ if .Paginator.HasPrev }}
            <a href="{{ .Paginator.Prev.URL }}" class="pagination-btn prev">
                ← Previous
            </a>
            {{ else }}
            <span class="pagination-btn prev disabled">← Previous</span>
            {{ end }}

            <div class="pagination-numbers">
                {{ $paginator := .Paginator }}
                {{ $totalPages := .Paginator.TotalPages }}
                {{ $currentPage := .Paginator.PageNumber }}

                {{ if gt $totalPages 7 }}
                    <!-- Show first page -->
                    {{ if eq $currentPage 1 }}
                    <span class="pagination-number active">1</span>
                    {{ else }}
                    <a href="{{ $paginator.First.URL }}" class="pagination-number">1</a>
                    {{ end }}

                    <!-- Show ellipsis if needed -->
                    {{ if gt $currentPage 3 }}
                    <span class="pagination-ellipsis">…</span>
                    {{ end }}

                    <!-- Show pages around current -->
                    {{ range $paginator.Pagers }}
                        {{ if and (ge .PageNumber (sub $currentPage 1)) (le .PageNumber (add $currentPage 1)) }}
                            {{ if ne .PageNumber 1 }}
                                {{ if ne .PageNumber $totalPages }}
                                    {{ if eq .PageNumber $currentPage }}
                                    <span class="pagination-number active">{{ .PageNumber }}</span>
                                    {{ else }}
                                    <a href="{{ .URL }}" class="pagination-number">{{ .PageNumber }}</a>
                                    {{ end }}
                                {{ end }}
                            {{ end }}
                        {{ end }}
                    {{ end }}

                    <!-- Show ellipsis if needed -->
                    {{ if lt $currentPage (sub $totalPages 2) }}
                    <span class="pagination-ellipsis">…</span>
                    {{ end }}

                    <!-- Show last page -->
                    {{ if eq $currentPage $totalPages }}
                    <span class="pagination-number active">{{ $totalPages }}</span>
                    {{ else }}
                    <a href="{{ $paginator.Last.URL }}" class="pagination-number">{{ $totalPages }}</a>
                    {{ end }}
                {{ else }}
                    <!-- Show all pages if 7 or fewer -->
                    {{ range $paginator.Pagers }}
                        {{ if eq .PageNumber $currentPage }}
                        <span class="pagination-number active">{{ .PageNumber }}</span>
                        {{ else }}
                        <a href="{{ .URL }}" class="pagination-number">{{ .PageNumber }}</a>
                        {{ end }}
                    {{ end }}
                {{ end }}
            </div>

            {{ if .Paginator.HasNext }}
            <a href="{{ .Paginator.Next.URL }}" class="pagination-btn next">
                Next →
            </a>
            {{ else }}
            <span class="pagination-btn next disabled">Next →</span>
            {{ end }}
        </nav>
        {{ end }}

        {{ else }}
        <div class="empty-state">
            <p>No blog posts yet.</p>
        </div>
        {{ end }}
    </div>
</div>

<style>
.blog-page {
    padding: var(--spacing-2xl) 0;
}

.blog-header {
    margin-bottom: var(--spacing-2xl);
}

.blog-header h1 {
    font-size: 2rem;
    margin-bottom: var(--spacing-sm);
}

.blog-description {
    font-size: 1rem;
    color: var(--color-text-secondary);
}

/* Category Filter */
.category-filter {
    display: flex;
    flex-wrap: wrap;
    gap: var(--spacing-xs);
    margin-bottom: var(--spacing-lg);
    padding-bottom: var(--spacing-md);
    border-bottom: 1px solid var(--color-border);
}

.filter-btn {
    display: inline-flex;
    align-items: center;
    gap: 0.25rem;
    padding: 0.25rem 0.75rem;
    background: transparent;
    border: none;
    color: var(--color-text-muted);
    text-decoration: none;
    font-size: 0.8125rem;
    font-weight: 400;
    transition: color var(--transition-fast);
}

.filter-btn:hover {
    color: var(--color-primary);
}

.filter-btn.active {
    color: var(--color-primary);
    font-weight: 600;
}

.filter-btn .count {
    color: var(--color-text-muted);
    font-size: 0.75rem;
}

.filter-btn.active .count {
    color: var(--color-primary);
}

/* Post Count */
.post-count {
    font-size: 0.875rem;
    color: var(--color-text-muted);
    margin-bottom: var(--spacing-md);
}

.blog-list {
    display: grid;
    gap: var(--spacing-md);
    max-width: 1000px;
}

.blog-item {
    border-bottom: 1px solid var(--color-border);
    padding-bottom: var(--spacing-md);
}

.blog-item:nth-child(even) {
    background-color: var(--color-bg-secondary);
    padding: var(--spacing-md);
    margin: 0 calc(var(--spacing-md) * -1);
    border-radius: var(--radius-md);
}

.blog-item:last-child {
    border-bottom: none;
}

.blog-item-link {
    display: block;
    text-decoration: none;
    color: inherit;
    transition: all var(--transition-fast);
}

.blog-item-link:hover {
    padding-left: var(--spacing-sm);
}

.blog-item-link:hover .blog-item-title {
    color: var(--color-primary);
}

.blog-item-header {
    display: flex;
    justify-content: space-between;
    align-items: baseline;
    gap: var(--spacing-md);
    margin-bottom: var(--spacing-xs);
}

.blog-item-title {
    font-size: 1.25rem;
    font-weight: 600;
    line-height: 1.3;
    transition: color var(--transition-fast);
    flex: 1;
}

.blog-item-date {
    font-size: 0.75rem;
    color: var(--color-text-muted);
    white-space: nowrap;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    font-weight: 500;
}

.blog-item-excerpt {
    color: var(--color-text-secondary);
    font-size: 0.9375rem;
    line-height: 1.5;
    margin-bottom: var(--spacing-sm);
}

.blog-item-footer {
    display: flex;
    align-items: center;
    gap: var(--spacing-md);
    font-size: 0.8125rem;
}

.blog-item-author {
    color: var(--color-text-muted);
}

.blog-item-categories {
    display: flex;
    gap: var(--spacing-xs);
    margin-left: auto;
}

.category-tag {
    padding: 0.125rem 0.5rem;
    background-color: var(--color-primary);
    color: white;
    border-radius: var(--radius-sm);
    font-size: 0.6875rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    text-decoration: none;
    transition: all var(--transition-fast);
}

.category-tag:hover {
    background-color: var(--color-secondary);
    transform: translateY(-1px);
}

/* Pagination */
.pagination {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: var(--spacing-md);
    margin-top: var(--spacing-2xl);
    padding-top: var(--spacing-xl);
    border-top: 1px solid var(--color-border);
}

.pagination-btn {
    padding: var(--spacing-sm) var(--spacing-lg);
    background: var(--color-bg);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-md);
    color: var(--color-text);
    text-decoration: none;
    font-weight: 500;
    transition: all var(--transition-fast);
}

.pagination-btn:not(.disabled):hover {
    background: var(--color-primary);
    color: white;
    border-color: var(--color-primary);
}

.pagination-btn.disabled {
    opacity: 0.4;
    cursor: not-allowed;
}

.pagination-numbers {
    display: flex;
    gap: var(--spacing-xs);
    align-items: center;
}

.pagination-number {
    min-width: 2.5rem;
    height: 2.5rem;
    display: flex;
    align-items: center;
    justify-content: center;
    background: var(--color-bg);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-md);
    color: var(--color-text);
    text-decoration: none;
    font-weight: 500;
    transition: all var(--transition-fast);
}

.pagination-number:hover {
    background: var(--color-bg-secondary);
    border-color: var(--color-primary);
}

.pagination-number.active {
    background: var(--color-primary);
    color: white;
    border-color: var(--color-primary);
}

.pagination-ellipsis {
    padding: 0 var(--spacing-xs);
    color: var(--color-text-muted);
}

.empty-state {
    text-align: center;
    padding: var(--spacing-3xl) 0;
    color: var(--color-text-muted);
}

@media (max-width: 768px) {
    .blog-header h1 {
        font-size: 1.75rem;
    }

    .category-filter {
        overflow-x: auto;
        flex-wrap: nowrap;
        -webkit-overflow-scrolling: touch;
        padding-bottom: var(--spacing-md);
    }

    .filter-btn {
        white-space: nowrap;
    }

    .pagination {
        flex-direction: column;
    }

    .pagination-numbers {
        order: -1;
        margin-bottom: var(--spacing-md);
    }

    .pagination-number {
        min-width: 2rem;
        height: 2rem;
        font-size: 0.875rem;
    }

    .blog-item-header {
        flex-direction: column;
        align-items: flex-start;
        gap: var(--spacing-xs);
    }

    .blog-item-title {
        font-size: 1.125rem;
    }

    .blog-item-footer {
        flex-direction: column;
        align-items: flex-start;
        gap: var(--spacing-xs);
    }

    .blog-item-categories {
        margin-left: 0;
    }
}
</style>
{{ end }}
